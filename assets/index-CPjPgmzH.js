function cg(F,H){for(var q=0;q<H.length;q++){const U=H[q];if(typeof U!="string"&&!Array.isArray(U)){for(const J in U)if(J!=="default"&&!(J in F)){const le=Object.getOwnPropertyDescriptor(U,J);le&&Object.defineProperty(F,J,le.get?le:{enumerable:!0,get:()=>U[J]})}}}return Object.freeze(Object.defineProperty(F,Symbol.toStringTag,{value:"Module"}))}(function(){const H=document.createElement("link").relList;if(H&&H.supports&&H.supports("modulepreload"))return;for(const J of document.querySelectorAll('link[rel="modulepreload"]'))U(J);new MutationObserver(J=>{for(const le of J)if(le.type==="childList")for(const P of le.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&U(P)}).observe(document,{childList:!0,subtree:!0});function q(J){const le={};return J.integrity&&(le.integrity=J.integrity),J.referrerPolicy&&(le.referrerPolicy=J.referrerPolicy),J.crossOrigin==="use-credentials"?le.credentials="include":J.crossOrigin==="anonymous"?le.credentials="omit":le.credentials="same-origin",le}function U(J){if(J.ep)return;J.ep=!0;const le=q(J);fetch(J.href,le)}})();function cm(F){return F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,"default")?F.default:F}var Jp={exports:{}},Kf={};var gm;function ug(){if(gm)return Kf;gm=1;var F=Symbol.for("react.transitional.element"),H=Symbol.for("react.fragment");function q(U,J,le){var P=null;if(le!==void 0&&(P=""+le),J.key!==void 0&&(P=""+J.key),"key"in J){le={};for(var d in J)d!=="key"&&(le[d]=J[d])}else le=J;return J=le.ref,{$$typeof:F,type:U,key:P,ref:J!==void 0?J:null,props:le}}return Kf.Fragment=H,Kf.jsx=q,Kf.jsxs=q,Kf}var _m;function hg(){return _m||(_m=1,Jp.exports=ug()),Jp.exports}var ol=hg(),em={exports:{}},Kt={};var ym;function dg(){if(ym)return Kt;ym=1;var F=Symbol.for("react.transitional.element"),H=Symbol.for("react.portal"),q=Symbol.for("react.fragment"),U=Symbol.for("react.strict_mode"),J=Symbol.for("react.profiler"),le=Symbol.for("react.consumer"),P=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),be=Symbol.for("react.suspense"),Ae=Symbol.for("react.memo"),Je=Symbol.for("react.lazy"),Ne=Symbol.for("react.activity"),et=Symbol.iterator;function Ct(me){return me===null||typeof me!="object"?null:(me=et&&me[et]||me["@@iterator"],typeof me=="function"?me:null)}var mt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},we=Object.assign,on={};function xi(me,Ze,st){this.props=me,this.context=Ze,this.refs=on,this.updater=st||mt}xi.prototype.isReactComponent={},xi.prototype.setState=function(me,Ze){if(typeof me!="object"&&typeof me!="function"&&me!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,me,Ze,"setState")},xi.prototype.forceUpdate=function(me){this.updater.enqueueForceUpdate(this,me,"forceUpdate")};function Jt(){}Jt.prototype=xi.prototype;function St(me,Ze,st){this.props=me,this.context=Ze,this.refs=on,this.updater=st||mt}var gi=St.prototype=new Jt;gi.constructor=St,we(gi,xi.prototype),gi.isPureReactComponent=!0;var Ai=Array.isArray;function hi(){}var Ht={H:null,A:null,T:null,S:null},ln=Object.prototype.hasOwnProperty;function _n(me,Ze,st){var ct=st.ref;return{$$typeof:F,type:me,key:Ze,ref:ct!==void 0?ct:null,props:st}}function ha(me,Ze){return _n(me.type,Ze,me.props)}function bi(me){return typeof me=="object"&&me!==null&&me.$$typeof===F}function wi(me){var Ze={"=":"=0",":":"=2"};return"$"+me.replace(/[=:]/g,function(st){return Ze[st]})}var nr=/\/+/g;function da(me,Ze){return typeof me=="object"&&me!==null&&me.key!=null?wi(""+me.key):Ze.toString(36)}function Vn(me){switch(me.status){case"fulfilled":return me.value;case"rejected":throw me.reason;default:switch(typeof me.status=="string"?me.then(hi,hi):(me.status="pending",me.then(function(Ze){me.status==="pending"&&(me.status="fulfilled",me.value=Ze)},function(Ze){me.status==="pending"&&(me.status="rejected",me.reason=Ze)})),me.status){case"fulfilled":return me.value;case"rejected":throw me.reason}}throw me}function Be(me,Ze,st,ct,Pt){var wt=typeof me;(wt==="undefined"||wt==="boolean")&&(me=null);var Yt=!1;if(me===null)Yt=!0;else switch(wt){case"bigint":case"string":case"number":Yt=!0;break;case"object":switch(me.$$typeof){case F:case H:Yt=!0;break;case Je:return Yt=me._init,Be(Yt(me._payload),Ze,st,ct,Pt)}}if(Yt)return Pt=Pt(me),Yt=ct===""?"."+da(me,0):ct,Ai(Pt)?(st="",Yt!=null&&(st=Yt.replace(nr,"$&/")+"/"),Be(Pt,Ze,st,"",function(ar){return ar})):Pt!=null&&(bi(Pt)&&(Pt=ha(Pt,st+(Pt.key==null||me&&me.key===Pt.key?"":(""+Pt.key).replace(nr,"$&/")+"/")+Yt)),Ze.push(Pt)),1;Yt=0;var fi=ct===""?".":ct+":";if(Ai(me))for(var ai=0;ai<me.length;ai++)ct=me[ai],wt=fi+da(ct,ai),Yt+=Be(ct,Ze,st,wt,Pt);else if(ai=Ct(me),typeof ai=="function")for(me=ai.call(me),ai=0;!(ct=me.next()).done;)ct=ct.value,wt=fi+da(ct,ai++),Yt+=Be(ct,Ze,st,wt,Pt);else if(wt==="object"){if(typeof me.then=="function")return Be(Vn(me),Ze,st,ct,Pt);throw Ze=String(me),Error("Objects are not valid as a React child (found: "+(Ze==="[object Object]"?"object with keys {"+Object.keys(me).join(", ")+"}":Ze)+"). If you meant to render a collection of children, use an array instead.")}return Yt}function ot(me,Ze,st){if(me==null)return me;var ct=[],Pt=0;return Be(me,ct,"","",function(wt){return Ze.call(st,wt,Pt++)}),ct}function Tt(me){if(me._status===-1){var Ze=me._result;Ze=Ze(),Ze.then(function(st){(me._status===0||me._status===-1)&&(me._status=1,me._result=st)},function(st){(me._status===0||me._status===-1)&&(me._status=2,me._result=st)}),me._status===-1&&(me._status=0,me._result=Ze)}if(me._status===1)return me._result.default;throw me._result}var pt=typeof reportError=="function"?reportError:function(me){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ze=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof me=="object"&&me!==null&&typeof me.message=="string"?String(me.message):String(me),error:me});if(!window.dispatchEvent(Ze))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",me);return}console.error(me)},li={map:ot,forEach:function(me,Ze,st){ot(me,function(){Ze.apply(this,arguments)},st)},count:function(me){var Ze=0;return ot(me,function(){Ze++}),Ze},toArray:function(me){return ot(me,function(Ze){return Ze})||[]},only:function(me){if(!bi(me))throw Error("React.Children.only expected to receive a single React element child.");return me}};return Kt.Activity=Ne,Kt.Children=li,Kt.Component=xi,Kt.Fragment=q,Kt.Profiler=J,Kt.PureComponent=St,Kt.StrictMode=U,Kt.Suspense=be,Kt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ht,Kt.__COMPILER_RUNTIME={__proto__:null,c:function(me){return Ht.H.useMemoCache(me)}},Kt.cache=function(me){return function(){return me.apply(null,arguments)}},Kt.cacheSignal=function(){return null},Kt.cloneElement=function(me,Ze,st){if(me==null)throw Error("The argument must be a React element, but you passed "+me+".");var ct=we({},me.props),Pt=me.key;if(Ze!=null)for(wt in Ze.key!==void 0&&(Pt=""+Ze.key),Ze)!ln.call(Ze,wt)||wt==="key"||wt==="__self"||wt==="__source"||wt==="ref"&&Ze.ref===void 0||(ct[wt]=Ze[wt]);var wt=arguments.length-2;if(wt===1)ct.children=st;else if(1<wt){for(var Yt=Array(wt),fi=0;fi<wt;fi++)Yt[fi]=arguments[fi+2];ct.children=Yt}return _n(me.type,Pt,ct)},Kt.createContext=function(me){return me={$$typeof:P,_currentValue:me,_currentValue2:me,_threadCount:0,Provider:null,Consumer:null},me.Provider=me,me.Consumer={$$typeof:le,_context:me},me},Kt.createElement=function(me,Ze,st){var ct,Pt={},wt=null;if(Ze!=null)for(ct in Ze.key!==void 0&&(wt=""+Ze.key),Ze)ln.call(Ze,ct)&&ct!=="key"&&ct!=="__self"&&ct!=="__source"&&(Pt[ct]=Ze[ct]);var Yt=arguments.length-2;if(Yt===1)Pt.children=st;else if(1<Yt){for(var fi=Array(Yt),ai=0;ai<Yt;ai++)fi[ai]=arguments[ai+2];Pt.children=fi}if(me&&me.defaultProps)for(ct in Yt=me.defaultProps,Yt)Pt[ct]===void 0&&(Pt[ct]=Yt[ct]);return _n(me,wt,Pt)},Kt.createRef=function(){return{current:null}},Kt.forwardRef=function(me){return{$$typeof:d,render:me}},Kt.isValidElement=bi,Kt.lazy=function(me){return{$$typeof:Je,_payload:{_status:-1,_result:me},_init:Tt}},Kt.memo=function(me,Ze){return{$$typeof:Ae,type:me,compare:Ze===void 0?null:Ze}},Kt.startTransition=function(me){var Ze=Ht.T,st={};Ht.T=st;try{var ct=me(),Pt=Ht.S;Pt!==null&&Pt(st,ct),typeof ct=="object"&&ct!==null&&typeof ct.then=="function"&&ct.then(hi,pt)}catch(wt){pt(wt)}finally{Ze!==null&&st.types!==null&&(Ze.types=st.types),Ht.T=Ze}},Kt.unstable_useCacheRefresh=function(){return Ht.H.useCacheRefresh()},Kt.use=function(me){return Ht.H.use(me)},Kt.useActionState=function(me,Ze,st){return Ht.H.useActionState(me,Ze,st)},Kt.useCallback=function(me,Ze){return Ht.H.useCallback(me,Ze)},Kt.useContext=function(me){return Ht.H.useContext(me)},Kt.useDebugValue=function(){},Kt.useDeferredValue=function(me,Ze){return Ht.H.useDeferredValue(me,Ze)},Kt.useEffect=function(me,Ze){return Ht.H.useEffect(me,Ze)},Kt.useEffectEvent=function(me){return Ht.H.useEffectEvent(me)},Kt.useId=function(){return Ht.H.useId()},Kt.useImperativeHandle=function(me,Ze,st){return Ht.H.useImperativeHandle(me,Ze,st)},Kt.useInsertionEffect=function(me,Ze){return Ht.H.useInsertionEffect(me,Ze)},Kt.useLayoutEffect=function(me,Ze){return Ht.H.useLayoutEffect(me,Ze)},Kt.useMemo=function(me,Ze){return Ht.H.useMemo(me,Ze)},Kt.useOptimistic=function(me,Ze){return Ht.H.useOptimistic(me,Ze)},Kt.useReducer=function(me,Ze,st){return Ht.H.useReducer(me,Ze,st)},Kt.useRef=function(me){return Ht.H.useRef(me)},Kt.useState=function(me){return Ht.H.useState(me)},Kt.useSyncExternalStore=function(me,Ze,st){return Ht.H.useSyncExternalStore(me,Ze,st)},Kt.useTransition=function(){return Ht.H.useTransition()},Kt.version="19.2.0",Kt}var vm;function um(){return vm||(vm=1,em.exports=dg()),em.exports}var Et=um();const fg=cm(Et);var tm={exports:{}},Wf={},im={exports:{}},nm={};var xm;function pg(){return xm||(xm=1,function(F){function H(Be,ot){var Tt=Be.length;Be.push(ot);e:for(;0<Tt;){var pt=Tt-1>>>1,li=Be[pt];if(0<J(li,ot))Be[pt]=ot,Be[Tt]=li,Tt=pt;else break e}}function q(Be){return Be.length===0?null:Be[0]}function U(Be){if(Be.length===0)return null;var ot=Be[0],Tt=Be.pop();if(Tt!==ot){Be[0]=Tt;e:for(var pt=0,li=Be.length,me=li>>>1;pt<me;){var Ze=2*(pt+1)-1,st=Be[Ze],ct=Ze+1,Pt=Be[ct];if(0>J(st,Tt))ct<li&&0>J(Pt,st)?(Be[pt]=Pt,Be[ct]=Tt,pt=ct):(Be[pt]=st,Be[Ze]=Tt,pt=Ze);else if(ct<li&&0>J(Pt,Tt))Be[pt]=Pt,Be[ct]=Tt,pt=ct;else break e}}return ot}function J(Be,ot){var Tt=Be.sortIndex-ot.sortIndex;return Tt!==0?Tt:Be.id-ot.id}if(F.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var le=performance;F.unstable_now=function(){return le.now()}}else{var P=Date,d=P.now();F.unstable_now=function(){return P.now()-d}}var be=[],Ae=[],Je=1,Ne=null,et=3,Ct=!1,mt=!1,we=!1,on=!1,xi=typeof setTimeout=="function"?setTimeout:null,Jt=typeof clearTimeout=="function"?clearTimeout:null,St=typeof setImmediate<"u"?setImmediate:null;function gi(Be){for(var ot=q(Ae);ot!==null;){if(ot.callback===null)U(Ae);else if(ot.startTime<=Be)U(Ae),ot.sortIndex=ot.expirationTime,H(be,ot);else break;ot=q(Ae)}}function Ai(Be){if(we=!1,gi(Be),!mt)if(q(be)!==null)mt=!0,hi||(hi=!0,wi());else{var ot=q(Ae);ot!==null&&Vn(Ai,ot.startTime-Be)}}var hi=!1,Ht=-1,ln=5,_n=-1;function ha(){return on?!0:!(F.unstable_now()-_n<ln)}function bi(){if(on=!1,hi){var Be=F.unstable_now();_n=Be;var ot=!0;try{e:{mt=!1,we&&(we=!1,Jt(Ht),Ht=-1),Ct=!0;var Tt=et;try{t:{for(gi(Be),Ne=q(be);Ne!==null&&!(Ne.expirationTime>Be&&ha());){var pt=Ne.callback;if(typeof pt=="function"){Ne.callback=null,et=Ne.priorityLevel;var li=pt(Ne.expirationTime<=Be);if(Be=F.unstable_now(),typeof li=="function"){Ne.callback=li,gi(Be),ot=!0;break t}Ne===q(be)&&U(be),gi(Be)}else U(be);Ne=q(be)}if(Ne!==null)ot=!0;else{var me=q(Ae);me!==null&&Vn(Ai,me.startTime-Be),ot=!1}}break e}finally{Ne=null,et=Tt,Ct=!1}ot=void 0}}finally{ot?wi():hi=!1}}}var wi;if(typeof St=="function")wi=function(){St(bi)};else if(typeof MessageChannel<"u"){var nr=new MessageChannel,da=nr.port2;nr.port1.onmessage=bi,wi=function(){da.postMessage(null)}}else wi=function(){xi(bi,0)};function Vn(Be,ot){Ht=xi(function(){Be(F.unstable_now())},ot)}F.unstable_IdlePriority=5,F.unstable_ImmediatePriority=1,F.unstable_LowPriority=4,F.unstable_NormalPriority=3,F.unstable_Profiling=null,F.unstable_UserBlockingPriority=2,F.unstable_cancelCallback=function(Be){Be.callback=null},F.unstable_forceFrameRate=function(Be){0>Be||125<Be?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ln=0<Be?Math.floor(1e3/Be):5},F.unstable_getCurrentPriorityLevel=function(){return et},F.unstable_next=function(Be){switch(et){case 1:case 2:case 3:var ot=3;break;default:ot=et}var Tt=et;et=ot;try{return Be()}finally{et=Tt}},F.unstable_requestPaint=function(){on=!0},F.unstable_runWithPriority=function(Be,ot){switch(Be){case 1:case 2:case 3:case 4:case 5:break;default:Be=3}var Tt=et;et=Be;try{return ot()}finally{et=Tt}},F.unstable_scheduleCallback=function(Be,ot,Tt){var pt=F.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?pt+Tt:pt):Tt=pt,Be){case 1:var li=-1;break;case 2:li=250;break;case 5:li=1073741823;break;case 4:li=1e4;break;default:li=5e3}return li=Tt+li,Be={id:Je++,callback:ot,priorityLevel:Be,startTime:Tt,expirationTime:li,sortIndex:-1},Tt>pt?(Be.sortIndex=Tt,H(Ae,Be),q(be)===null&&Be===q(Ae)&&(we?(Jt(Ht),Ht=-1):we=!0,Vn(Ai,Tt-pt))):(Be.sortIndex=li,H(be,Be),mt||Ct||(mt=!0,hi||(hi=!0,wi()))),Be},F.unstable_shouldYield=ha,F.unstable_wrapCallback=function(Be){var ot=et;return function(){var Tt=et;et=ot;try{return Be.apply(this,arguments)}finally{et=Tt}}}}(nm)),nm}var bm;function mg(){return bm||(bm=1,im.exports=pg()),im.exports}var am={exports:{}},Sr={};var wm;function gg(){if(wm)return Sr;wm=1;var F=um();function H(be){var Ae="https://react.dev/errors/"+be;if(1<arguments.length){Ae+="?args[]="+encodeURIComponent(arguments[1]);for(var Je=2;Je<arguments.length;Je++)Ae+="&args[]="+encodeURIComponent(arguments[Je])}return"Minified React error #"+be+"; visit "+Ae+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function q(){}var U={d:{f:q,r:function(){throw Error(H(522))},D:q,C:q,L:q,m:q,X:q,S:q,M:q},p:0,findDOMNode:null},J=Symbol.for("react.portal");function le(be,Ae,Je){var Ne=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:J,key:Ne==null?null:""+Ne,children:be,containerInfo:Ae,implementation:Je}}var P=F.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(be,Ae){if(be==="font")return"";if(typeof Ae=="string")return Ae==="use-credentials"?Ae:""}return Sr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=U,Sr.createPortal=function(be,Ae){var Je=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ae||Ae.nodeType!==1&&Ae.nodeType!==9&&Ae.nodeType!==11)throw Error(H(299));return le(be,Ae,null,Je)},Sr.flushSync=function(be){var Ae=P.T,Je=U.p;try{if(P.T=null,U.p=2,be)return be()}finally{P.T=Ae,U.p=Je,U.d.f()}},Sr.preconnect=function(be,Ae){typeof be=="string"&&(Ae?(Ae=Ae.crossOrigin,Ae=typeof Ae=="string"?Ae==="use-credentials"?Ae:"":void 0):Ae=null,U.d.C(be,Ae))},Sr.prefetchDNS=function(be){typeof be=="string"&&U.d.D(be)},Sr.preinit=function(be,Ae){if(typeof be=="string"&&Ae&&typeof Ae.as=="string"){var Je=Ae.as,Ne=d(Je,Ae.crossOrigin),et=typeof Ae.integrity=="string"?Ae.integrity:void 0,Ct=typeof Ae.fetchPriority=="string"?Ae.fetchPriority:void 0;Je==="style"?U.d.S(be,typeof Ae.precedence=="string"?Ae.precedence:void 0,{crossOrigin:Ne,integrity:et,fetchPriority:Ct}):Je==="script"&&U.d.X(be,{crossOrigin:Ne,integrity:et,fetchPriority:Ct,nonce:typeof Ae.nonce=="string"?Ae.nonce:void 0})}},Sr.preinitModule=function(be,Ae){if(typeof be=="string")if(typeof Ae=="object"&&Ae!==null){if(Ae.as==null||Ae.as==="script"){var Je=d(Ae.as,Ae.crossOrigin);U.d.M(be,{crossOrigin:Je,integrity:typeof Ae.integrity=="string"?Ae.integrity:void 0,nonce:typeof Ae.nonce=="string"?Ae.nonce:void 0})}}else Ae==null&&U.d.M(be)},Sr.preload=function(be,Ae){if(typeof be=="string"&&typeof Ae=="object"&&Ae!==null&&typeof Ae.as=="string"){var Je=Ae.as,Ne=d(Je,Ae.crossOrigin);U.d.L(be,Je,{crossOrigin:Ne,integrity:typeof Ae.integrity=="string"?Ae.integrity:void 0,nonce:typeof Ae.nonce=="string"?Ae.nonce:void 0,type:typeof Ae.type=="string"?Ae.type:void 0,fetchPriority:typeof Ae.fetchPriority=="string"?Ae.fetchPriority:void 0,referrerPolicy:typeof Ae.referrerPolicy=="string"?Ae.referrerPolicy:void 0,imageSrcSet:typeof Ae.imageSrcSet=="string"?Ae.imageSrcSet:void 0,imageSizes:typeof Ae.imageSizes=="string"?Ae.imageSizes:void 0,media:typeof Ae.media=="string"?Ae.media:void 0})}},Sr.preloadModule=function(be,Ae){if(typeof be=="string")if(Ae){var Je=d(Ae.as,Ae.crossOrigin);U.d.m(be,{as:typeof Ae.as=="string"&&Ae.as!=="script"?Ae.as:void 0,crossOrigin:Je,integrity:typeof Ae.integrity=="string"?Ae.integrity:void 0})}else U.d.m(be)},Sr.requestFormReset=function(be){U.d.r(be)},Sr.unstable_batchedUpdates=function(be,Ae){return be(Ae)},Sr.useFormState=function(be,Ae,Je){return P.H.useFormState(be,Ae,Je)},Sr.useFormStatus=function(){return P.H.useHostTransitionStatus()},Sr.version="19.2.0",Sr}var Tm;function Fm(){if(Tm)return am.exports;Tm=1;function F(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(F)}catch(H){console.error(H)}}return F(),am.exports=gg(),am.exports}var Sm;function _g(){if(Sm)return Wf;Sm=1;var F=mg(),H=um(),q=Fm();function U(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function J(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function le(i){var s=i,c=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(c=s.return),i=s.return;while(i)}return s.tag===3?c:null}function P(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function d(i){if(i.tag===31){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function be(i){if(le(i)!==i)throw Error(U(188))}function Ae(i){var s=i.alternate;if(!s){if(s=le(i),s===null)throw Error(U(188));return s!==i?null:i}for(var c=i,p=s;;){var b=c.return;if(b===null)break;var S=b.alternate;if(S===null){if(p=b.return,p!==null){c=p;continue}break}if(b.child===S.child){for(S=b.child;S;){if(S===c)return be(b),i;if(S===p)return be(b),s;S=S.sibling}throw Error(U(188))}if(c.return!==p.return)c=b,p=S;else{for(var R=!1,X=b.child;X;){if(X===c){R=!0,c=b,p=S;break}if(X===p){R=!0,p=b,c=S;break}X=X.sibling}if(!R){for(X=S.child;X;){if(X===c){R=!0,c=S,p=b;break}if(X===p){R=!0,p=S,c=b;break}X=X.sibling}if(!R)throw Error(U(189))}}if(c.alternate!==p)throw Error(U(190))}if(c.tag!==3)throw Error(U(188));return c.stateNode.current===c?i:s}function Je(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=Je(i),s!==null)return s;i=i.sibling}return null}var Ne=Object.assign,et=Symbol.for("react.element"),Ct=Symbol.for("react.transitional.element"),mt=Symbol.for("react.portal"),we=Symbol.for("react.fragment"),on=Symbol.for("react.strict_mode"),xi=Symbol.for("react.profiler"),Jt=Symbol.for("react.consumer"),St=Symbol.for("react.context"),gi=Symbol.for("react.forward_ref"),Ai=Symbol.for("react.suspense"),hi=Symbol.for("react.suspense_list"),Ht=Symbol.for("react.memo"),ln=Symbol.for("react.lazy"),_n=Symbol.for("react.activity"),ha=Symbol.for("react.memo_cache_sentinel"),bi=Symbol.iterator;function wi(i){return i===null||typeof i!="object"?null:(i=bi&&i[bi]||i["@@iterator"],typeof i=="function"?i:null)}var nr=Symbol.for("react.client.reference");function da(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===nr?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case we:return"Fragment";case xi:return"Profiler";case on:return"StrictMode";case Ai:return"Suspense";case hi:return"SuspenseList";case _n:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case mt:return"Portal";case St:return i.displayName||"Context";case Jt:return(i._context.displayName||"Context")+".Consumer";case gi:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Ht:return s=i.displayName||null,s!==null?s:da(i.type)||"Memo";case ln:s=i._payload,i=i._init;try{return da(i(s))}catch{}}return null}var Vn=Array.isArray,Be=H.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ot=q.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Tt={pending:!1,data:null,method:null,action:null},pt=[],li=-1;function me(i){return{current:i}}function Ze(i){0>li||(i.current=pt[li],pt[li]=null,li--)}function st(i,s){li++,pt[li]=i.current,i.current=s}var ct=me(null),Pt=me(null),wt=me(null),Yt=me(null);function fi(i,s){switch(st(wt,s),st(Pt,i),st(ct,null),s.nodeType){case 9:case 11:i=(i=s.documentElement)&&(i=i.namespaceURI)?Bf(i):0;break;default:if(i=s.tagName,s=s.namespaceURI)s=Bf(s),i=Rp(s,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}Ze(ct),st(ct,i)}function ai(){Ze(ct),Ze(Pt),Ze(wt)}function ar(i){i.memoizedState!==null&&st(Yt,i);var s=ct.current,c=Rp(s,i.type);s!==c&&(st(Pt,i),st(ct,c))}function Mr(i){Pt.current===i&&(Ze(ct),Ze(Pt)),Yt.current===i&&(Ze(Yt),ue._currentValue=Tt)}var ta,Er;function ki(i){if(ta===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);ta=s&&s[1]||"",Er=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ta+i+Er}var Za=!1;function Ci(i,s){if(!i||Za)return"";Za=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(s){var Ye=function(){throw Error()};if(Object.defineProperty(Ye.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ye,[])}catch(Oe){var Le=Oe}Reflect.construct(i,[],Ye)}else{try{Ye.call()}catch(Oe){Le=Oe}i.call(Ye.prototype)}}else{try{throw Error()}catch(Oe){Le=Oe}(Ye=i())&&typeof Ye.catch=="function"&&Ye.catch(function(){})}}catch(Oe){if(Oe&&Le&&typeof Oe.stack=="string")return[Oe.stack,Le.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=p.DetermineComponentFrameRoot(),R=S[0],X=S[1];if(R&&X){var he=R.split(`
`),Re=X.split(`
`);for(b=p=0;p<he.length&&!he[p].includes("DetermineComponentFrameRoot");)p++;for(;b<Re.length&&!Re[b].includes("DetermineComponentFrameRoot");)b++;if(p===he.length||b===Re.length)for(p=he.length-1,b=Re.length-1;1<=p&&0<=b&&he[p]!==Re[b];)b--;for(;1<=p&&0<=b;p--,b--)if(he[p]!==Re[b]){if(p!==1||b!==1)do if(p--,b--,0>b||he[p]!==Re[b]){var Ge=`
`+he[p].replace(" at new "," at ");return i.displayName&&Ge.includes("<anonymous>")&&(Ge=Ge.replace("<anonymous>",i.displayName)),Ge}while(1<=p&&0<=b);break}}}finally{Za=!1,Error.prepareStackTrace=c}return(c=i?i.displayName||i.name:"")?ki(c):""}function xo(i,s){switch(i.tag){case 26:case 27:case 5:return ki(i.type);case 16:return ki("Lazy");case 13:return i.child!==s&&s!==null?ki("Suspense Fallback"):ki("Suspense");case 19:return ki("SuspenseList");case 0:case 15:return Ci(i.type,!1);case 11:return Ci(i.type.render,!1);case 1:return Ci(i.type,!0);case 31:return ki("Activity");default:return""}}function Vs(i){try{var s="",c=null;do s+=xo(i,c),c=i,i=i.return;while(i);return s}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}var rr=Object.prototype.hasOwnProperty,Gs=F.unstable_scheduleCallback,Zs=F.unstable_cancelCallback,qs=F.unstable_shouldYield,Vr=F.unstable_requestPaint,pn=F.unstable_now,ll=F.unstable_getCurrentPriorityLevel,sr=F.unstable_ImmediatePriority,cl=F.unstable_UserBlockingPriority,Hs=F.unstable_NormalPriority,bo=F.unstable_LowPriority,ge=F.unstable_IdlePriority,V=F.log,N=F.unstable_setDisableYieldValue,Y=null,ie=null;function ce(i){if(typeof V=="function"&&N(i),ie&&typeof ie.setStrictMode=="function")try{ie.setStrictMode(Y,i)}catch{}}var pe=Math.clz32?Math.clz32:De,ze=Math.log,ye=Math.LN2;function De(i){return i>>>=0,i===0?32:31-(ze(i)/ye|0)|0}var He=256,je=262144,dt=4194304;function xe(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Gt(i,s,c){var p=i.pendingLanes;if(p===0)return 0;var b=0,S=i.suspendedLanes,R=i.pingedLanes;i=i.warmLanes;var X=p&134217727;return X!==0?(p=X&~S,p!==0?b=xe(p):(R&=X,R!==0?b=xe(R):c||(c=X&~i,c!==0&&(b=xe(c))))):(X=p&~S,X!==0?b=xe(X):R!==0?b=xe(R):c||(c=p&~i,c!==0&&(b=xe(c)))),b===0?0:s!==0&&s!==b&&(s&S)===0&&(S=b&-b,c=s&-s,S>=c||S===32&&(c&4194048)!==0)?s:b}function zi(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function vt(i,s){switch(i){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qt(){var i=dt;return dt<<=1,(dt&62914560)===0&&(dt=4194304),i}function _i(i){for(var s=[],c=0;31>c;c++)s.push(i);return s}function Ni(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function Gn(i,s,c,p,b,S){var R=i.pendingLanes;i.pendingLanes=c,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=c,i.entangledLanes&=c,i.errorRecoveryDisabledLanes&=c,i.shellSuspendCounter=0;var X=i.entanglements,he=i.expirationTimes,Re=i.hiddenUpdates;for(c=R&~c;0<c;){var Ge=31-pe(c),Ye=1<<Ge;X[Ge]=0,he[Ge]=-1;var Le=Re[Ge];if(Le!==null)for(Re[Ge]=null,Ge=0;Ge<Le.length;Ge++){var Oe=Le[Ge];Oe!==null&&(Oe.lane&=-536870913)}c&=~Ye}p!==0&&Yi(i,p,0),S!==0&&b===0&&i.tag!==0&&(i.suspendedLanes|=S&~(R&~s))}function Yi(i,s,c){i.pendingLanes|=s,i.suspendedLanes&=~s;var p=31-pe(s);i.entangledLanes|=s,i.entanglements[p]=i.entanglements[p]|1073741824|c&261930}function yn(i,s){var c=i.entangledLanes|=s;for(i=i.entanglements;c;){var p=31-pe(c),b=1<<p;b&s|i[p]&s&&(i[p]|=s),c&=~b}}function Vi(i,s){var c=s&-s;return c=(c&42)!==0?1:vn(c),(c&(i.suspendedLanes|s))!==0?0:c}function vn(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function Ve(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function cn(){var i=ot.p;return i!==0?i:(i=window.event,i===void 0?32:rn(i.type))}function fa(i,s){var c=ot.p;try{return ot.p=i,s()}finally{ot.p=c}}var qa=Math.random().toString(36).slice(2),ci="__reactFiber$"+qa,$e="__reactProps$"+qa,It="__reactContainer$"+qa,Zt="__reactEvents$"+qa,Ar="__reactListeners$"+qa,Ul="__reactHandles$"+qa,ls="__reactResources$"+qa,Bt="__reactMarker$"+qa;function wo(i){delete i[ci],delete i[$e],delete i[Zt],delete i[Ar],delete i[Ul]}function or(i){var s=i[ci];if(s)return s;for(var c=i.parentNode;c;){if(s=c[It]||c[ci]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(i=Vf(i);i!==null;){if(c=i[ci])return c;i=Vf(i)}return s}i=c,c=i.parentNode}return null}function wa(i){if(i=i[ci]||i[It]){var s=i.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return i}return null}function lr(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(U(33))}function Gr(i){var s=i[ls];return s||(s=i[ls]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function en(i){i[Bt]=!0}var Nl=new Set,ia={};function yi(i,s){Cr(i,s),Cr(i+"Capture",s)}function Cr(i,s){for(ia[i]=s,i=0;i<s.length;i++)Nl.add(s[i])}var To=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),xn={},Xs={};function cs(i){return rr.call(Xs,i)?!0:rr.call(xn,i)?!1:To.test(i)?Xs[i]=!0:(xn[i]=!0,!1)}function us(i,s,c){if(cs(s))if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var p=s.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+c)}}function ul(i,s,c){if(c===null)i.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+c)}}function Zr(i,s,c,p){if(p===null)i.removeAttribute(c);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(c);return}i.setAttributeNS(s,c,""+p)}}function na(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Uc(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Vd(i,s,c){var p=Object.getOwnPropertyDescriptor(i.constructor.prototype,s);if(!i.hasOwnProperty(s)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var b=p.get,S=p.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return b.call(this)},set:function(R){c=""+R,S.call(this,R)}}),Object.defineProperty(i,s,{enumerable:p.enumerable}),{getValue:function(){return c},setValue:function(R){c=""+R},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function Nc(i){if(!i._valueTracker){var s=Uc(i)?"checked":"value";i._valueTracker=Vd(i,s,""+i[s])}}function Nh(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var c=s.getValue(),p="";return i&&(p=Uc(i)?i.checked?"true":"false":i.value),i=p,i!==c?(s.setValue(i),!0):!1}function Vl(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Vh=/[\n"\\]/g;function ka(i){return i.replace(Vh,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Gl(i,s,c,p,b,S,R,X){i.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?i.type=R:i.removeAttribute("type"),s!=null?R==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+na(s)):i.value!==""+na(s)&&(i.value=""+na(s)):R!=="submit"&&R!=="reset"||i.removeAttribute("value"),s!=null?Zl(i,R,na(s)):c!=null?Zl(i,R,na(c)):p!=null&&i.removeAttribute("value"),b==null&&S!=null&&(i.defaultChecked=!!S),b!=null&&(i.checked=b&&typeof b!="function"&&typeof b!="symbol"),X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"?i.name=""+na(X):i.removeAttribute("name")}function Nu(i,s,c,p,b,S,R,X){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(i.type=S),s!=null||c!=null){if(!(S!=="submit"&&S!=="reset"||s!=null)){Nc(i);return}c=c!=null?""+na(c):"",s=s!=null?""+na(s):c,X||s===i.value||(i.value=s),i.defaultValue=s}p=p??b,p=typeof p!="function"&&typeof p!="symbol"&&!!p,i.checked=X?i.checked:!!p,i.defaultChecked=!!p,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(i.name=R),Nc(i)}function Zl(i,s,c){s==="number"&&Vl(i.ownerDocument)===i||i.defaultValue===""+c||(i.defaultValue=""+c)}function hs(i,s,c,p){if(i=i.options,s){s={};for(var b=0;b<c.length;b++)s["$"+c[b]]=!0;for(c=0;c<i.length;c++)b=s.hasOwnProperty("$"+i[c].value),i[c].selected!==b&&(i[c].selected=b),b&&p&&(i[c].defaultSelected=!0)}else{for(c=""+na(c),s=null,b=0;b<i.length;b++){if(i[b].value===c){i[b].selected=!0,p&&(i[b].defaultSelected=!0);return}s!==null||i[b].disabled||(s=i[b])}s!==null&&(s.selected=!0)}}function hl(i,s,c){if(s!=null&&(s=""+na(s),s!==i.value&&(i.value=s),c==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=c!=null?""+na(c):""}function dl(i,s,c,p){if(s==null){if(p!=null){if(c!=null)throw Error(U(92));if(Vn(p)){if(1<p.length)throw Error(U(93));p=p[0]}c=p}c==null&&(c=""),s=c}c=na(s),i.defaultValue=c,p=i.textContent,p===c&&p!==""&&p!==null&&(i.value=p),Nc(i)}function ds(i,s){if(s){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=s;return}}i.textContent=s}var fl=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function So(i,s,c){var p=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?p?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":p?i.setProperty(s,c):typeof c!="number"||c===0||fl.has(s)?s==="float"?i.cssFloat=c:i[s]=(""+c).trim():i[s]=c+"px"}function Vu(i,s,c){if(s!=null&&typeof s!="object")throw Error(U(62));if(i=i.style,c!=null){for(var p in c)!c.hasOwnProperty(p)||s!=null&&s.hasOwnProperty(p)||(p.indexOf("--")===0?i.setProperty(p,""):p==="float"?i.cssFloat="":i[p]="");for(var b in s)p=s[b],s.hasOwnProperty(b)&&c[b]!==p&&So(i,b,p)}else for(var S in s)s.hasOwnProperty(S)&&So(i,S,s[S])}function Gu(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fs=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Mo=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Dt(i){return Mo.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function Ft(){}var Ys=null;function cr(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var jn=null,bn=null;function Zn(i){var s=wa(i);if(s&&(i=s.stateNode)){var c=i[$e]||null;e:switch(i=s.stateNode,s.type){case"input":if(Gl(i,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+ka(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var p=c[s];if(p!==i&&p.form===i.form){var b=p[$e]||null;if(!b)throw Error(U(90));Gl(p,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<c.length;s++)p=c[s],p.form===i.form&&Nh(p)}break e;case"textarea":hl(i,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&hs(i,!!c.multiple,s,!1)}}}var un=!1;function Bi(i,s,c){if(un)return i(s,c);un=!0;try{var p=i(s);return p}finally{if(un=!1,(jn!==null||bn!==null)&&(yd(),jn&&(s=jn,i=bn,bn=jn=null,Zn(s),i)))for(s=0;s<i.length;s++)Zn(i[s])}}function pl(i,s){var c=i.stateNode;if(c===null)return null;var p=c[$e]||null;if(p===null)return null;c=p[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(i=i.type,p=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!p;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(U(231,s,typeof c));return c}var tn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),aa=!1;if(tn)try{var ra={};Object.defineProperty(ra,"passive",{get:function(){aa=!0}}),window.addEventListener("test",ra,ra),window.removeEventListener("test",ra,ra)}catch{aa=!1}var ur=null,hr=null,$i=null;function Eo(){if($i)return $i;var i,s=hr,c=s.length,p,b="value"in ur?ur.value:ur.textContent,S=b.length;for(i=0;i<c&&s[i]===b[i];i++);var R=c-i;for(p=1;p<=R&&s[c-p]===b[S-p];p++);return $i=b.slice(i,1<p?1-p:void 0)}function zr(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function qr(){return!0}function ii(){return!1}function sa(i){function s(c,p,b,S,R){this._reactName=c,this._targetInst=b,this.type=p,this.nativeEvent=S,this.target=R,this.currentTarget=null;for(var X in i)i.hasOwnProperty(X)&&(c=i[X],this[X]=c?c(S):S[X]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?qr:ii,this.isPropagationStopped=ii,this}return Ne(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=qr)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=qr)},persist:function(){},isPersistent:qr}),s}var Ot={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ut=sa(Ot),$s=Ne({},Ot,{view:0,detail:0}),ei=sa($s),Ks,Ba,ps,ms=Ne({},$s,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qc,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==ps&&(ps&&i.type==="mousemove"?(Ks=i.screenX-ps.screenX,Ba=i.screenY-ps.screenY):Ba=Ks=0,ps=i),Ks)},movementY:function(i){return"movementY"in i?i.movementY:Ba}}),ml=sa(ms),ql=Ne({},ms,{dataTransfer:0}),Vc=sa(ql),Gc=Ne({},$s,{relatedTarget:0}),Ao=sa(Gc),gl=Ne({},Ot,{animationName:0,elapsedTime:0,pseudoElement:0}),Ws=sa(gl),qn=Ne({},Ot,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Hl=sa(qn),Gh=Ne({},Ot,{data:0}),Xl=sa(Gh),pi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Zc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Yl(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=dr[i])?!!s[i]:!1}function qc(){return Yl}var Co=Ne({},$s,{key:function(i){if(i.key){var s=pi[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=zr(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Zc[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qc,charCode:function(i){return i.type==="keypress"?zr(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?zr(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),gs=sa(Co),Zu=Ne({},ms,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Zh=sa(Zu),qh=Ne({},$s,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qc}),Hc=sa(qh),Xc=Ne({},Ot,{propertyName:0,elapsedTime:0,pseudoElement:0}),Pr=sa(Xc),$l=Ne({},ms,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),_l=sa($l),Yc=Ne({},Ot,{newState:0,oldState:0}),Kl=sa(Yc),qu=[9,13,27,32],fr=tn&&"CompositionEvent"in window,Wl=null;tn&&"documentMode"in document&&(Wl=document.documentMode);var Hu=tn&&"TextEvent"in window&&!Wl,_s=tn&&(!fr||Wl&&8<Wl&&11>=Wl),yl=" ",Xu=!1;function vl(i,s){switch(i){case"keyup":return qu.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hh(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var pr=!1;function Gd(i,s){switch(i){case"compositionend":return Hh(s);case"keypress":return s.which!==32?null:(Xu=!0,yl);case"textInput":return i=s.data,i===yl&&Xu?null:i;default:return null}}function Xh(i,s){if(pr)return i==="compositionend"||!fr&&vl(i,s)?(i=Eo(),$i=hr=ur=null,pr=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return _s&&s.locale!=="ko"?null:s.data;default:return null}}var Zd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Yu(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!Zd[i.type]:s==="textarea"}function $c(i,s,c,p){jn?bn?bn.push(p):bn=[p]:jn=p,s=Dh(s,"onChange"),0<s.length&&(c=new Ut("onChange","change",null,c,p),i.push({event:c,listeners:s}))}var zo=null,Po=null;function $u(i){Pp(i,0)}function Ql(i){var s=lr(i);if(Nh(s))return i}function Qs(i,s){if(i==="change")return s}var Ku=!1;if(tn){var Kc;if(tn){var Hr="oninput"in document;if(!Hr){var Yh=document.createElement("div");Yh.setAttribute("oninput","return;"),Hr=typeof Yh.oninput=="function"}Kc=Hr}else Kc=!1;Ku=Kc&&(!document.documentMode||9<document.documentMode)}function Jl(){zo&&(zo.detachEvent("onpropertychange",$h),Po=zo=null)}function $h(i){if(i.propertyName==="value"&&Ql(Po)){var s=[];$c(s,Po,i,cr(i)),Bi($u,s)}}function qd(i,s,c){i==="focusin"?(Jl(),zo=s,Po=c,zo.attachEvent("onpropertychange",$h)):i==="focusout"&&Jl()}function Wc(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Ql(Po)}function Wu(i,s){if(i==="click")return Ql(s)}function Kh(i,s){if(i==="input"||i==="change")return Ql(s)}function Qu(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var Ta=typeof Object.is=="function"?Object.is:Qu;function ys(i,s){if(Ta(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var c=Object.keys(i),p=Object.keys(s);if(c.length!==p.length)return!1;for(p=0;p<c.length;p++){var b=c[p];if(!rr.call(s,b)||!Ta(i[b],s[b]))return!1}return!0}function Xr(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Qc(i,s){var c=Xr(i);i=0;for(var p;c;){if(c.nodeType===3){if(p=i+c.textContent.length,i<=s&&p>=s)return{node:c,offset:s-i};i=p}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Xr(c)}}function Jc(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?Jc(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function ec(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=Vl(i.document);s instanceof i.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)i=s.contentWindow;else break;s=Vl(i.document)}return s}function eu(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}var Ju=tn&&"documentMode"in document&&11>=document.documentMode,mr=null,tc=null,ni=null,eh=!1;function Wh(i,s,c){var p=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;eh||mr==null||mr!==Vl(p)||(p=mr,"selectionStart"in p&&eu(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),ni&&ys(ni,p)||(ni=p,p=Dh(tc,"onSelect"),0<p.length&&(s=new Ut("onSelect","select",null,s,c),i.push({event:s,listeners:p}),s.target=mr)))}function Do(i,s){var c={};return c[i.toLowerCase()]=s.toLowerCase(),c["Webkit"+i]="webkit"+s,c["Moz"+i]="moz"+s,c}var Io={animationend:Do("Animation","AnimationEnd"),animationiteration:Do("Animation","AnimationIteration"),animationstart:Do("Animation","AnimationStart"),transitionrun:Do("Transition","TransitionRun"),transitionstart:Do("Transition","TransitionStart"),transitioncancel:Do("Transition","TransitionCancel"),transitionend:Do("Transition","TransitionEnd")},th={},ih={};tn&&(ih=document.createElement("div").style,"AnimationEvent"in window||(delete Io.animationend.animation,delete Io.animationiteration.animation,delete Io.animationstart.animation),"TransitionEvent"in window||delete Io.transitionend.transition);function Yr(i){if(th[i])return th[i];if(!Io[i])return i;var s=Io[i],c;for(c in s)if(s.hasOwnProperty(c)&&c in ih)return th[i]=s[c];return i}var ic=Yr("animationend"),nc=Yr("animationiteration"),tu=Yr("animationstart"),Ro=Yr("transitionrun"),ac=Yr("transitionstart"),xl=Yr("transitioncancel"),Ha=Yr("transitionend"),nh=new Map,iu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");iu.push("scrollEnd");function Xa(i,s){nh.set(i,s),yi(s,[i])}var $r=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},Sa=[],vs=0,Lo=0;function ko(){for(var i=vs,s=Lo=vs=0;s<i;){var c=Sa[s];Sa[s++]=null;var p=Sa[s];Sa[s++]=null;var b=Sa[s];Sa[s++]=null;var S=Sa[s];if(Sa[s++]=null,p!==null&&b!==null){var R=p.pending;R===null?b.next=b:(b.next=R.next,R.next=b),p.pending=b}S!==0&&ah(c,b,S)}}function rc(i,s,c,p){Sa[vs++]=i,Sa[vs++]=s,Sa[vs++]=c,Sa[vs++]=p,Lo|=p,i.lanes|=p,i=i.alternate,i!==null&&(i.lanes|=p)}function Js(i,s,c,p){return rc(i,s,c,p),bl(i)}function gr(i,s){return rc(i,null,null,s),bl(i)}function ah(i,s,c){i.lanes|=c;var p=i.alternate;p!==null&&(p.lanes|=c);for(var b=!1,S=i.return;S!==null;)S.childLanes|=c,p=S.alternate,p!==null&&(p.childLanes|=c),S.tag===22&&(i=S.stateNode,i===null||i._visibility&1||(b=!0)),i=S,S=S.return;return i.tag===3?(S=i.stateNode,b&&s!==null&&(b=31-pe(c),i=S.hiddenUpdates,p=i[b],p===null?i[b]=[s]:p.push(s),s.lane=c|536870912),S):null}function bl(i){if(50<il)throw il=0,kn=null,Error(U(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var Nt={};function nu(i,s,c,p){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ya(i,s,c,p){return new nu(i,s,c,p)}function au(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Ma(i,s){var c=i.alternate;return c===null?(c=Ya(i.tag,s,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=s,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&65011712,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,s=i.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c.refCleanup=i.refCleanup,c}function Qh(i,s){i.flags&=65011714;var c=i.alternate;return c===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=c.childLanes,i.lanes=c.lanes,i.child=c.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=c.memoizedProps,i.memoizedState=c.memoizedState,i.updateQueue=c.updateQueue,i.type=c.type,s=c.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function ru(i,s,c,p,b,S){var R=0;if(p=i,typeof i=="function")au(i)&&(R=1);else if(typeof i=="string")R=z(i,c,ct.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case _n:return i=Ya(31,c,s,b),i.elementType=_n,i.lanes=S,i;case we:return eo(c.children,b,S,s);case on:R=8,b|=24;break;case xi:return i=Ya(12,c,s,b|2),i.elementType=xi,i.lanes=S,i;case Ai:return i=Ya(13,c,s,b),i.elementType=Ai,i.lanes=S,i;case hi:return i=Ya(19,c,s,b),i.elementType=hi,i.lanes=S,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case St:R=10;break e;case Jt:R=9;break e;case gi:R=11;break e;case Ht:R=14;break e;case ln:R=16,p=null;break e}R=29,c=Error(U(130,i===null?"null":typeof i,"")),p=null}return s=Ya(R,c,s,b),s.elementType=i,s.type=p,s.lanes=S,s}function eo(i,s,c,p){return i=Ya(7,i,p,s),i.lanes=c,i}function su(i,s,c){return i=Ya(6,i,null,s),i.lanes=c,i}function ou(i){var s=Ya(18,null,null,0);return s.stateNode=i,s}function wl(i,s,c){return s=Ya(4,i.children!==null?i.children:[],i.key,s),s.lanes=c,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}var to=new WeakMap;function pa(i,s){if(typeof i=="object"&&i!==null){var c=to.get(i);return c!==void 0?c:(s={value:i,source:s,stack:Vs(s)},to.set(i,s),s)}return{value:i,source:s,stack:Vs(s)}}var io=[],Bo=0,Oo=null,no=0,Ea=[],Hn=0,Dr=null,Kr=1,Oa="";function Wr(i,s){io[Bo++]=no,io[Bo++]=Oo,Oo=i,no=s}function lu(i,s,c){Ea[Hn++]=Kr,Ea[Hn++]=Oa,Ea[Hn++]=Dr,Dr=i;var p=Kr;i=Oa;var b=32-pe(p)-1;p&=~(1<<b),c+=1;var S=32-pe(s)+b;if(30<S){var R=b-b%5;S=(p&(1<<R)-1).toString(32),p>>=R,b-=R,Kr=1<<32-pe(s)+b|c<<b|p,Oa=S+i}else Kr=1<<S|c<<b|p,Oa=i}function jo(i){i.return!==null&&(Wr(i,1),lu(i,1,0))}function sc(i){for(;i===Oo;)Oo=io[--Bo],io[Bo]=null,no=io[--Bo],io[Bo]=null;for(;i===Dr;)Dr=Ea[--Hn],Ea[Hn]=null,Oa=Ea[--Hn],Ea[Hn]=null,Kr=Ea[--Hn],Ea[Hn]=null}function rh(i,s){Ea[Hn++]=Kr,Ea[Hn++]=Oa,Ea[Hn++]=Dr,Kr=s.id,Oa=s.overflow,Dr=i}var Xn=null,Pi=null,Qt=!1,xs=null,Aa=!1,Gi=Error(U(519));function ma(i){var s=Error(U(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Uo(pa(s,i)),Gi}function Ca(i){var s=i.stateNode,c=i.type,p=i.memoizedProps;switch(s[ci]=i,s[$e]=p,c){case"dialog":si("cancel",s),si("close",s);break;case"iframe":case"object":case"embed":si("load",s);break;case"video":case"audio":for(c=0;c<Ph.length;c++)si(Ph[c],s);break;case"source":si("error",s);break;case"img":case"image":case"link":si("error",s),si("load",s);break;case"details":si("toggle",s);break;case"input":si("invalid",s),Nu(s,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0);break;case"select":si("invalid",s);break;case"textarea":si("invalid",s),dl(s,p.value,p.defaultValue,p.children)}c=p.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||p.suppressHydrationWarning===!0||kf(s.textContent,c)?(p.popover!=null&&(si("beforetoggle",s),si("toggle",s)),p.onScroll!=null&&si("scroll",s),p.onScrollEnd!=null&&si("scrollend",s),p.onClick!=null&&(s.onclick=Ft),s=!0):s=!1,s||ma(i,!0)}function Fo(i){for(Xn=i.return;Xn;)switch(Xn.tag){case 5:case 31:case 13:Aa=!1;return;case 27:case 3:Aa=!0;return;default:Xn=Xn.return}}function bs(i){if(i!==Xn)return!1;if(!Qt)return Fo(i),Qt=!0,!1;var s=i.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=i.type,c=!(c!=="form"&&c!=="button")||Dd(i.type,i.memoizedProps)),c=!c),c&&Pi&&ma(i),Fo(i),s===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(U(317));Pi=kd(i)}else if(s===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(U(317));Pi=kd(i)}else s===27?(s=Pi,nl(i.type)?(i=Kn,Kn=null,Pi=i):Pi=s):Pi=Xn?La(i.stateNode.nextSibling):null;return!0}function ao(){Pi=Xn=null,Qt=!1}function ro(){var i=xs;return i!==null&&(Ua===null?Ua=i:Ua.push.apply(Ua,i),xs=null),i}function Uo(i){xs===null?xs=[i]:xs.push(i)}var No=me(null),ws=null,Ir=null;function Qr(i,s,c){st(No,s._currentValue),s._currentValue=c}function $a(i){i._currentValue=No.current,Ze(No)}function cu(i,s,c){for(;i!==null;){var p=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,p!==null&&(p.childLanes|=s)):p!==null&&(p.childLanes&s)!==s&&(p.childLanes|=s),i===c)break;i=i.return}}function oc(i,s,c,p){var b=i.child;for(b!==null&&(b.return=i);b!==null;){var S=b.dependencies;if(S!==null){var R=b.child;S=S.firstContext;e:for(;S!==null;){var X=S;S=b;for(var he=0;he<s.length;he++)if(X.context===s[he]){S.lanes|=c,X=S.alternate,X!==null&&(X.lanes|=c),cu(S.return,c,i),p||(R=null);break e}S=X.next}}else if(b.tag===18){if(R=b.return,R===null)throw Error(U(341));R.lanes|=c,S=R.alternate,S!==null&&(S.lanes|=c),cu(R,c,i),R=null}else R=b.child;if(R!==null)R.return=b;else for(R=b;R!==null;){if(R===i){R=null;break}if(b=R.sibling,b!==null){b.return=R.return,R=b;break}R=R.return}b=R}}function Ka(i,s,c,p){i=null;for(var b=s,S=!1;b!==null;){if(!S){if((b.flags&524288)!==0)S=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var R=b.alternate;if(R===null)throw Error(U(387));if(R=R.memoizedProps,R!==null){var X=b.type;Ta(b.pendingProps.value,R.value)||(i!==null?i.push(X):i=[X])}}else if(b===Yt.current){if(R=b.alternate,R===null)throw Error(U(387));R.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(i!==null?i.push(ue):i=[ue])}b=b.return}i!==null&&oc(s,i,c,p),s.flags|=262144}function lc(i){for(i=i.firstContext;i!==null;){if(!Ta(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Ts(i){ws=i,Ir=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function Fn(i){return sh(ws,i)}function Ss(i,s){return ws===null&&Ts(i),sh(i,s)}function sh(i,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},Ir===null){if(i===null)throw Error(U(308));Ir=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else Ir=Ir.next=s;return c}var Jh=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(c,p){i.push(p)}};this.abort=function(){s.aborted=!0,i.forEach(function(c){return c()})}},ed=F.unstable_scheduleCallback,td=F.unstable_NormalPriority,hn={$$typeof:St,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function uu(){return{controller:new Jh,data:new Map,refCount:0}}function Pn(i){i.refCount--,i.refCount===0&&ed(td,function(){i.controller.abort()})}var Un=null,ga=0,Dn=0,Vo=null;function Tl(i,s){if(Un===null){var c=Un=[];ga=0,Dn=Ch(),Vo={status:"pending",value:void 0,then:function(p){c.push(p)}}}return ga++,s.then(id,id),s}function id(){if(--ga===0&&Un!==null){Vo!==null&&(Vo.status="fulfilled");var i=Un;Un=null,Dn=0,Vo=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function cc(i,s){var c=[],p={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return i.then(function(){p.status="fulfilled",p.value=s;for(var b=0;b<c.length;b++)(0,c[b])(s)},function(b){for(p.status="rejected",p.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),p}var oh=Be.S;Be.S=function(i,s){vf=pn(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&Tl(i,s),oh!==null&&oh(i,s)};var Ms=me(null);function hu(){var i=Ms.current;return i!==null?i:Ei.pooledCache}function Jr(i,s){s===null?st(Ms,Ms.current):st(Ms,s.pool)}function es(){var i=hu();return i===null?null:{parent:hn._currentValue,pool:i}}var rt=Error(U(460)),du=Error(U(474)),Sl=Error(U(542)),uc={then:function(){}};function ts(i){return i=i.status,i==="fulfilled"||i==="rejected"}function Ml(i,s,c){switch(c=i[c],c===void 0?i.push(s):c!==s&&(s.then(Ft,Ft),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,pu(i),i;default:if(typeof s.status=="string")s.then(Ft,Ft);else{if(i=Ei,i!==null&&100<i.shellSuspendCounter)throw Error(U(482));i=s,i.status="pending",i.then(function(p){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=p}},function(p){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=p}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,pu(i),i}throw jt=s,rt}}function Es(i){try{var s=i._init;return s(i._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(jt=c,rt):c}}var jt=null;function fu(){if(jt===null)throw Error(U(459));var i=jt;return jt=null,i}function pu(i){if(i===rt||i===Sl)throw Error(U(483))}var Rr=null,El=0;function hc(i){var s=El;return El+=1,Rr===null&&(Rr=[]),Ml(Rr,i,s)}function Go(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function Zo(i,s){throw s.$$typeof===et?Error(U(525)):(i=Object.prototype.toString.call(s),Error(U(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function dc(i){function s(Te,ve){if(i){var Ee=Te.deletions;Ee===null?(Te.deletions=[ve],Te.flags|=16):Ee.push(ve)}}function c(Te,ve){if(!i)return null;for(;ve!==null;)s(Te,ve),ve=ve.sibling;return null}function p(Te){for(var ve=new Map;Te!==null;)Te.key!==null?ve.set(Te.key,Te):ve.set(Te.index,Te),Te=Te.sibling;return ve}function b(Te,ve){return Te=Ma(Te,ve),Te.index=0,Te.sibling=null,Te}function S(Te,ve,Ee){return Te.index=Ee,i?(Ee=Te.alternate,Ee!==null?(Ee=Ee.index,Ee<ve?(Te.flags|=67108866,ve):Ee):(Te.flags|=67108866,ve)):(Te.flags|=1048576,ve)}function R(Te){return i&&Te.alternate===null&&(Te.flags|=67108866),Te}function X(Te,ve,Ee,qe){return ve===null||ve.tag!==6?(ve=su(Ee,Te.mode,qe),ve.return=Te,ve):(ve=b(ve,Ee),ve.return=Te,ve)}function he(Te,ve,Ee,qe){var At=Ee.type;return At===we?Ge(Te,ve,Ee.props.children,qe,Ee.key):ve!==null&&(ve.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===ln&&Es(At)===ve.type)?(ve=b(ve,Ee.props),Go(ve,Ee),ve.return=Te,ve):(ve=ru(Ee.type,Ee.key,Ee.props,null,Te.mode,qe),Go(ve,Ee),ve.return=Te,ve)}function Re(Te,ve,Ee,qe){return ve===null||ve.tag!==4||ve.stateNode.containerInfo!==Ee.containerInfo||ve.stateNode.implementation!==Ee.implementation?(ve=wl(Ee,Te.mode,qe),ve.return=Te,ve):(ve=b(ve,Ee.children||[]),ve.return=Te,ve)}function Ge(Te,ve,Ee,qe,At){return ve===null||ve.tag!==7?(ve=eo(Ee,Te.mode,qe,At),ve.return=Te,ve):(ve=b(ve,Ee),ve.return=Te,ve)}function Ye(Te,ve,Ee){if(typeof ve=="string"&&ve!==""||typeof ve=="number"||typeof ve=="bigint")return ve=su(""+ve,Te.mode,Ee),ve.return=Te,ve;if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case Ct:return Ee=ru(ve.type,ve.key,ve.props,null,Te.mode,Ee),Go(Ee,ve),Ee.return=Te,Ee;case mt:return ve=wl(ve,Te.mode,Ee),ve.return=Te,ve;case ln:return ve=Es(ve),Ye(Te,ve,Ee)}if(Vn(ve)||wi(ve))return ve=eo(ve,Te.mode,Ee,null),ve.return=Te,ve;if(typeof ve.then=="function")return Ye(Te,hc(ve),Ee);if(ve.$$typeof===St)return Ye(Te,Ss(Te,ve),Ee);Zo(Te,ve)}return null}function Le(Te,ve,Ee,qe){var At=ve!==null?ve.key:null;if(typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint")return At!==null?null:X(Te,ve,""+Ee,qe);if(typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case Ct:return Ee.key===At?he(Te,ve,Ee,qe):null;case mt:return Ee.key===At?Re(Te,ve,Ee,qe):null;case ln:return Ee=Es(Ee),Le(Te,ve,Ee,qe)}if(Vn(Ee)||wi(Ee))return At!==null?null:Ge(Te,ve,Ee,qe,null);if(typeof Ee.then=="function")return Le(Te,ve,hc(Ee),qe);if(Ee.$$typeof===St)return Le(Te,ve,Ss(Te,Ee),qe);Zo(Te,Ee)}return null}function Oe(Te,ve,Ee,qe,At){if(typeof qe=="string"&&qe!==""||typeof qe=="number"||typeof qe=="bigint")return Te=Te.get(Ee)||null,X(ve,Te,""+qe,At);if(typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case Ct:return Te=Te.get(qe.key===null?Ee:qe.key)||null,he(ve,Te,qe,At);case mt:return Te=Te.get(qe.key===null?Ee:qe.key)||null,Re(ve,Te,qe,At);case ln:return qe=Es(qe),Oe(Te,ve,Ee,qe,At)}if(Vn(qe)||wi(qe))return Te=Te.get(Ee)||null,Ge(ve,Te,qe,At,null);if(typeof qe.then=="function")return Oe(Te,ve,Ee,hc(qe),At);if(qe.$$typeof===St)return Oe(Te,ve,Ee,Ss(ve,qe),At);Zo(ve,qe)}return null}function yt(Te,ve,Ee,qe){for(var At=null,vi=null,bt=ve,Wt=ve=0,Rt=null;bt!==null&&Wt<Ee.length;Wt++){bt.index>Wt?(Rt=bt,bt=null):Rt=bt.sibling;var Xt=Le(Te,bt,Ee[Wt],qe);if(Xt===null){bt===null&&(bt=Rt);break}i&&bt&&Xt.alternate===null&&s(Te,bt),ve=S(Xt,ve,Wt),vi===null?At=Xt:vi.sibling=Xt,vi=Xt,bt=Rt}if(Wt===Ee.length)return c(Te,bt),Qt&&Wr(Te,Wt),At;if(bt===null){for(;Wt<Ee.length;Wt++)bt=Ye(Te,Ee[Wt],qe),bt!==null&&(ve=S(bt,ve,Wt),vi===null?At=bt:vi.sibling=bt,vi=bt);return Qt&&Wr(Te,Wt),At}for(bt=p(bt);Wt<Ee.length;Wt++)Rt=Oe(bt,Te,Wt,Ee[Wt],qe),Rt!==null&&(i&&Rt.alternate!==null&&bt.delete(Rt.key===null?Wt:Rt.key),ve=S(Rt,ve,Wt),vi===null?At=Rt:vi.sibling=Rt,vi=Rt);return i&&bt.forEach(function(Tr){return s(Te,Tr)}),Qt&&Wr(Te,Wt),At}function kt(Te,ve,Ee,qe){if(Ee==null)throw Error(U(151));for(var At=null,vi=null,bt=ve,Wt=ve=0,Rt=null,Xt=Ee.next();bt!==null&&!Xt.done;Wt++,Xt=Ee.next()){bt.index>Wt?(Rt=bt,bt=null):Rt=bt.sibling;var Tr=Le(Te,bt,Xt.value,qe);if(Tr===null){bt===null&&(bt=Rt);break}i&&bt&&Tr.alternate===null&&s(Te,bt),ve=S(Tr,ve,Wt),vi===null?At=Tr:vi.sibling=Tr,vi=Tr,bt=Rt}if(Xt.done)return c(Te,bt),Qt&&Wr(Te,Wt),At;if(bt===null){for(;!Xt.done;Wt++,Xt=Ee.next())Xt=Ye(Te,Xt.value,qe),Xt!==null&&(ve=S(Xt,ve,Wt),vi===null?At=Xt:vi.sibling=Xt,vi=Xt);return Qt&&Wr(Te,Wt),At}for(bt=p(bt);!Xt.done;Wt++,Xt=Ee.next())Xt=Oe(bt,Te,Wt,Xt.value,qe),Xt!==null&&(i&&Xt.alternate!==null&&bt.delete(Xt.key===null?Wt:Xt.key),ve=S(Xt,ve,Wt),vi===null?At=Xt:vi.sibling=Xt,vi=Xt);return i&&bt.forEach(function(Fs){return s(Te,Fs)}),Qt&&Wr(Te,Wt),At}function Xi(Te,ve,Ee,qe){if(typeof Ee=="object"&&Ee!==null&&Ee.type===we&&Ee.key===null&&(Ee=Ee.props.children),typeof Ee=="object"&&Ee!==null){switch(Ee.$$typeof){case Ct:e:{for(var At=Ee.key;ve!==null;){if(ve.key===At){if(At=Ee.type,At===we){if(ve.tag===7){c(Te,ve.sibling),qe=b(ve,Ee.props.children),qe.return=Te,Te=qe;break e}}else if(ve.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===ln&&Es(At)===ve.type){c(Te,ve.sibling),qe=b(ve,Ee.props),Go(qe,Ee),qe.return=Te,Te=qe;break e}c(Te,ve);break}else s(Te,ve);ve=ve.sibling}Ee.type===we?(qe=eo(Ee.props.children,Te.mode,qe,Ee.key),qe.return=Te,Te=qe):(qe=ru(Ee.type,Ee.key,Ee.props,null,Te.mode,qe),Go(qe,Ee),qe.return=Te,Te=qe)}return R(Te);case mt:e:{for(At=Ee.key;ve!==null;){if(ve.key===At)if(ve.tag===4&&ve.stateNode.containerInfo===Ee.containerInfo&&ve.stateNode.implementation===Ee.implementation){c(Te,ve.sibling),qe=b(ve,Ee.children||[]),qe.return=Te,Te=qe;break e}else{c(Te,ve);break}else s(Te,ve);ve=ve.sibling}qe=wl(Ee,Te.mode,qe),qe.return=Te,Te=qe}return R(Te);case ln:return Ee=Es(Ee),Xi(Te,ve,Ee,qe)}if(Vn(Ee))return yt(Te,ve,Ee,qe);if(wi(Ee)){if(At=wi(Ee),typeof At!="function")throw Error(U(150));return Ee=At.call(Ee),kt(Te,ve,Ee,qe)}if(typeof Ee.then=="function")return Xi(Te,ve,hc(Ee),qe);if(Ee.$$typeof===St)return Xi(Te,ve,Ss(Te,Ee),qe);Zo(Te,Ee)}return typeof Ee=="string"&&Ee!==""||typeof Ee=="number"||typeof Ee=="bigint"?(Ee=""+Ee,ve!==null&&ve.tag===6?(c(Te,ve.sibling),qe=b(ve,Ee),qe.return=Te,Te=qe):(c(Te,ve),qe=su(Ee,Te.mode,qe),qe.return=Te,Te=qe),R(Te)):c(Te,ve)}return function(Te,ve,Ee,qe){try{El=0;var At=Xi(Te,ve,Ee,qe);return Rr=null,At}catch(bt){if(bt===rt||bt===Sl)throw bt;var vi=Ya(29,bt,null,Te.mode);return vi.lanes=qe,vi.return=Te,vi}finally{}}}var so=dc(!0),lh=dc(!1),As=!1;function ch(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Lr(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function ri(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function Cs(i,s,c){var p=i.updateQueue;if(p===null)return null;if(p=p.shared,(mi&2)!==0){var b=p.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),p.pending=s,s=bl(i),ah(i,null,c),s}return rc(i,p,s,c),bl(i)}function zs(i,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var p=s.lanes;p&=i.pendingLanes,c|=p,s.lanes=c,yn(i,c)}}function fc(i,s){var c=i.updateQueue,p=i.alternate;if(p!==null&&(p=p.updateQueue,c===p)){var b=null,S=null;if(c=c.firstBaseUpdate,c!==null){do{var R={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};S===null?b=S=R:S=S.next=R,c=c.next}while(c!==null);S===null?b=S=s:S=S.next=s}else b=S=s;c={baseState:p.baseState,firstBaseUpdate:b,lastBaseUpdate:S,shared:p.shared,callbacks:p.callbacks},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=s:i.next=s,c.lastBaseUpdate=s}var mu=!1;function qo(){if(mu){var i=Vo;if(i!==null)throw i}}function Ho(i,s,c,p){mu=!1;var b=i.updateQueue;As=!1;var S=b.firstBaseUpdate,R=b.lastBaseUpdate,X=b.shared.pending;if(X!==null){b.shared.pending=null;var he=X,Re=he.next;he.next=null,R===null?S=Re:R.next=Re,R=he;var Ge=i.alternate;Ge!==null&&(Ge=Ge.updateQueue,X=Ge.lastBaseUpdate,X!==R&&(X===null?Ge.firstBaseUpdate=Re:X.next=Re,Ge.lastBaseUpdate=he))}if(S!==null){var Ye=b.baseState;R=0,Ge=Re=he=null,X=S;do{var Le=X.lane&-536870913,Oe=Le!==X.lane;if(Oe?(oi&Le)===Le:(p&Le)===Le){Le!==0&&Le===Dn&&(mu=!0),Ge!==null&&(Ge=Ge.next={lane:0,tag:X.tag,payload:X.payload,callback:null,next:null});e:{var yt=i,kt=X;Le=s;var Xi=c;switch(kt.tag){case 1:if(yt=kt.payload,typeof yt=="function"){Ye=yt.call(Xi,Ye,Le);break e}Ye=yt;break e;case 3:yt.flags=yt.flags&-65537|128;case 0:if(yt=kt.payload,Le=typeof yt=="function"?yt.call(Xi,Ye,Le):yt,Le==null)break e;Ye=Ne({},Ye,Le);break e;case 2:As=!0}}Le=X.callback,Le!==null&&(i.flags|=64,Oe&&(i.flags|=8192),Oe=b.callbacks,Oe===null?b.callbacks=[Le]:Oe.push(Le))}else Oe={lane:Le,tag:X.tag,payload:X.payload,callback:X.callback,next:null},Ge===null?(Re=Ge=Oe,he=Ye):Ge=Ge.next=Oe,R|=Le;if(X=X.next,X===null){if(X=b.shared.pending,X===null)break;Oe=X,X=Oe.next,Oe.next=null,b.lastBaseUpdate=Oe,b.shared.pending=null}}while(!0);Ge===null&&(he=Ye),b.baseState=he,b.firstBaseUpdate=Re,b.lastBaseUpdate=Ge,S===null&&(b.shared.lanes=0),Dl|=R,i.lanes=R,i.memoizedState=Ye}}function uh(i,s){if(typeof i!="function")throw Error(U(191,i));i.call(s)}function _r(i,s){var c=i.callbacks;if(c!==null)for(i.callbacks=null,i=0;i<c.length;i++)uh(c[i],s)}var yr=me(null),ht=me(0);function xt(i,s){i=Or,st(ht,i),st(yr,s),Or=i|s.baseLanes}function Xo(){st(ht,Or),st(yr,yr.current)}function gu(){Or=ht.current,Ze(yr),Ze(ht)}var oa=me(null),Oi=null;function is(i){var s=i.alternate;st(wn,wn.current&1),st(oa,i),Oi===null&&(s===null||yr.current!==null||s.memoizedState!==null)&&(Oi=i)}function Wa(i){st(wn,wn.current),st(oa,i),Oi===null&&(Oi=i)}function hh(i){i.tag===22?(st(wn,wn.current),st(oa,i),Oi===null&&(Oi=i)):oo()}function oo(){st(wn,wn.current),st(oa,oa.current)}function Qa(i){Ze(oa),Oi===i&&(Oi=null),Ze(wn)}var wn=me(0);function Ja(i){for(var s=i;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Uf(c)||Nf(c)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var di=0,gt=null,Ti=null,Ki=null,Yo=!1,lo=!1,za=!1,$o=0,kr=0,Ps=null,pc=0;function nn(){throw Error(U(321))}function co(i,s){if(s===null)return!1;for(var c=0;c<s.length&&c<i.length;c++)if(!Ta(i[c],s[c]))return!1;return!0}function Ds(i,s,c,p,b,S){return di=S,gt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Be.H=i===null||i.memoizedState===null?dh:yu,za=!1,S=c(p,b),za=!1,lo&&(S=mc(s,c,p,b)),_u(i),S}function _u(i){Be.H=zl;var s=Ti!==null&&Ti.next!==null;if(di=0,Ki=Ti=gt=null,Yo=!1,kr=0,Ps=null,s)throw Error(U(300));i===null||Ln||(i=i.dependencies,i!==null&&lc(i)&&(Ln=!0))}function mc(i,s,c,p){gt=i;var b=0;do{if(lo&&(Ps=null),kr=0,lo=!1,25<=b)throw Error(U(301));if(b+=1,Ki=Ti=null,i.updateQueue!=null){var S=i.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}Be.H=po,S=s(c,p)}while(lo);return S}function Ko(){var i=Be.H,s=i.useState()[0];return s=typeof s.then=="function"?r(s):s,i=i.useState()[0],(Ti!==null?Ti.memoizedState:null)!==i&&(gt.flags|=1024),s}function gc(){var i=$o!==0;return $o=0,i}function Al(i,s,c){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~c}function Cl(i){if(Yo){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}Yo=!1}di=0,Ki=Ti=gt=null,lo=!1,kr=$o=0,Ps=null}function la(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ki===null?gt.memoizedState=Ki=i:Ki=Ki.next=i,Ki}function f(){if(Ti===null){var i=gt.alternate;i=i!==null?i.memoizedState:null}else i=Ti.next;var s=Ki===null?gt.memoizedState:Ki.next;if(s!==null)Ki=s,Ti=i;else{if(i===null)throw gt.alternate===null?Error(U(467)):Error(U(310));Ti=i,i={memoizedState:Ti.memoizedState,baseState:Ti.baseState,baseQueue:Ti.baseQueue,queue:Ti.queue,next:null},Ki===null?gt.memoizedState=Ki=i:Ki=Ki.next=i}return Ki}function e(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function r(i){var s=kr;return kr+=1,Ps===null&&(Ps=[]),i=Ml(Ps,i,s),s=gt,(Ki===null?s.memoizedState:Ki.next)===null&&(s=s.alternate,Be.H=s===null||s.memoizedState===null?dh:yu),i}function l(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return r(i);if(i.$$typeof===St)return Fn(i)}throw Error(U(438,String(i)))}function h(i){var s=null,c=gt.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var p=gt.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(s={data:p.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=e(),gt.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(i),p=0;p<i;p++)c[p]=ha;return s.index++,c}function m(i,s){return typeof s=="function"?s(i):s}function y(i){var s=f();return w(s,Ti,i)}function w(i,s,c){var p=i.queue;if(p===null)throw Error(U(311));p.lastRenderedReducer=c;var b=i.baseQueue,S=p.pending;if(S!==null){if(b!==null){var R=b.next;b.next=S.next,S.next=R}s.baseQueue=b=S,p.pending=null}if(S=i.baseState,b===null)i.memoizedState=S;else{s=b.next;var X=R=null,he=null,Re=s,Ge=!1;do{var Ye=Re.lane&-536870913;if(Ye!==Re.lane?(oi&Ye)===Ye:(di&Ye)===Ye){var Le=Re.revertLane;if(Le===0)he!==null&&(he=he.next={lane:0,revertLane:0,gesture:null,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null}),Ye===Dn&&(Ge=!0);else if((di&Le)===Le){Re=Re.next,Le===Dn&&(Ge=!0);continue}else Ye={lane:0,revertLane:Re.revertLane,gesture:null,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null},he===null?(X=he=Ye,R=S):he=he.next=Ye,gt.lanes|=Le,Dl|=Le;Ye=Re.action,za&&c(S,Ye),S=Re.hasEagerState?Re.eagerState:c(S,Ye)}else Le={lane:Ye,revertLane:Re.revertLane,gesture:Re.gesture,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null},he===null?(X=he=Le,R=S):he=he.next=Le,gt.lanes|=Ye,Dl|=Ye;Re=Re.next}while(Re!==null&&Re!==s);if(he===null?R=S:he.next=X,!Ta(S,i.memoizedState)&&(Ln=!0,Ge&&(c=Vo,c!==null)))throw c;i.memoizedState=S,i.baseState=R,i.baseQueue=he,p.lastRenderedState=S}return b===null&&(p.lanes=0),[i.memoizedState,p.dispatch]}function T(i){var s=f(),c=s.queue;if(c===null)throw Error(U(311));c.lastRenderedReducer=i;var p=c.dispatch,b=c.pending,S=s.memoizedState;if(b!==null){c.pending=null;var R=b=b.next;do S=i(S,R.action),R=R.next;while(R!==b);Ta(S,s.memoizedState)||(Ln=!0),s.memoizedState=S,s.baseQueue===null&&(s.baseState=S),c.lastRenderedState=S}return[S,p]}function A(i,s,c){var p=gt,b=f(),S=Qt;if(S){if(c===void 0)throw Error(U(407));c=c()}else c=s();var R=!Ta((Ti||b).memoizedState,c);if(R&&(b.memoizedState=c,Ln=!0),b=b.queue,ui(D.bind(null,p,b,i),[i]),b.getSnapshot!==s||R||Ki!==null&&Ki.memoizedState.tag&1){if(p.flags|=2048,Ke(9,{destroy:void 0},I.bind(null,p,b,c,s),null),Ei===null)throw Error(U(349));S||(di&127)!==0||C(p,s,c)}return c}function C(i,s,c){i.flags|=16384,i={getSnapshot:s,value:c},s=gt.updateQueue,s===null?(s=e(),gt.updateQueue=s,s.stores=[i]):(c=s.stores,c===null?s.stores=[i]:c.push(i))}function I(i,s,c,p){s.value=c,s.getSnapshot=p,O(s)&&G(i)}function D(i,s,c){return c(function(){O(s)&&G(i)})}function O(i){var s=i.getSnapshot;i=i.value;try{var c=s();return!Ta(i,c)}catch{return!0}}function G(i){var s=gr(i,2);s!==null&&ir(s,i,2)}function K(i){var s=la();if(typeof i=="function"){var c=i;if(i=c(),za){ce(!0);try{c()}finally{ce(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:i},s}function W(i,s,c,p){return i.baseState=c,w(i,Ti,typeof p=="function"?p:m)}function Q(i,s,c,p,b){if(Mi(i))throw Error(U(485));if(i=s.action,i!==null){var S={payload:b,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){S.listeners.push(R)}};Be.T!==null?c(!0):S.isTransition=!1,p(S),c=s.pending,c===null?(S.next=s.pending=S,ne(s,S)):(S.next=c.next,s.pending=c.next=S)}}function ne(i,s){var c=s.action,p=s.payload,b=i.state;if(s.isTransition){var S=Be.T,R={};Be.T=R;try{var X=c(b,p),he=Be.S;he!==null&&he(R,X),se(i,s,X)}catch(Re){oe(i,s,Re)}finally{S!==null&&R.types!==null&&(S.types=R.types),Be.T=S}}else try{S=c(b,p),se(i,s,S)}catch(Re){oe(i,s,Re)}}function se(i,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(p){te(i,s,p)},function(p){return oe(i,s,p)}):te(i,s,c)}function te(i,s,c){s.status="fulfilled",s.value=c,de(s),i.state=c,s=i.pending,s!==null&&(c=s.next,c===s?i.pending=null:(c=c.next,s.next=c,ne(i,c)))}function oe(i,s,c){var p=i.pending;if(i.pending=null,p!==null){p=p.next;do s.status="rejected",s.reason=c,de(s),s=s.next;while(s!==p)}i.action=null}function de(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function ae(i,s){return s}function fe(i,s){if(Qt){var c=Ei.formState;if(c!==null){e:{var p=gt;if(Qt){if(Pi){t:{for(var b=Pi,S=Aa;b.nodeType!==8;){if(!S){b=null;break t}if(b=La(b.nextSibling),b===null){b=null;break t}}S=b.data,b=S==="F!"||S==="F"?b:null}if(b){Pi=La(b.nextSibling),p=b.data==="F!";break e}}ma(p)}p=!1}p&&(s=c[0])}}return c=la(),c.memoizedState=c.baseState=s,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ae,lastRenderedState:s},c.queue=p,c=gn.bind(null,gt,p),p.dispatch=c,p=K(!1),S=Rn.bind(null,gt,!1,p.queue),p=la(),b={state:s,dispatch:null,action:i,pending:null},p.queue=b,c=Q.bind(null,gt,b,S,c),b.dispatch=c,p.memoizedState=i,[s,c,!1]}function Pe(i){var s=f();return Se(s,Ti,i)}function Se(i,s,c){if(s=w(i,s,ae)[0],i=y(m)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var p=r(s)}catch(R){throw R===rt?Sl:R}else p=s;s=f();var b=s.queue,S=b.dispatch;return c!==s.memoizedState&&(gt.flags|=2048,Ke(9,{destroy:void 0},Ce.bind(null,b,c),null)),[p,S,i]}function Ce(i,s){i.action=s}function Ie(i){var s=f(),c=Ti;if(c!==null)return Se(s,c,i);f(),s=s.memoizedState,c=f();var p=c.queue.dispatch;return c.memoizedState=i,[s,p,!1]}function Ke(i,s,c,p){return i={tag:i,create:c,deps:p,inst:s,next:null},s=gt.updateQueue,s===null&&(s=e(),gt.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=i.next=i:(p=c.next,c.next=i,i.next=p,s.lastEffect=i),i}function We(){return f().memoizedState}function Fe(i,s,c,p){var b=la();gt.flags|=i,b.memoizedState=Ke(1|s,{destroy:void 0},c,p===void 0?null:p)}function lt(i,s,c,p){var b=f();p=p===void 0?null:p;var S=b.memoizedState.inst;Ti!==null&&p!==null&&co(p,Ti.memoizedState.deps)?b.memoizedState=Ke(s,S,c,p):(gt.flags|=i,b.memoizedState=Ke(1|s,S,c,p))}function Lt(i,s){Fe(8390656,8,i,s)}function ui(i,s){lt(2048,8,i,s)}function Vt(i){gt.flags|=4;var s=gt.updateQueue;if(s===null)s=e(),gt.updateQueue=s,s.events=[i];else{var c=s.events;c===null?s.events=[i]:c.push(i)}}function Si(i){var s=f().memoizedState;return Vt({ref:s,nextImpl:i}),function(){if((mi&2)!==0)throw Error(U(440));return s.impl.apply(void 0,arguments)}}function Wi(i,s){return lt(4,2,i,s)}function Di(i,s){return lt(4,4,i,s)}function Tn(i,s){if(typeof s=="function"){i=i();var c=s(i);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function Zi(i,s,c){c=c!=null?c.concat([i]):null,lt(4,4,Tn.bind(null,s,i),c)}function In(){}function qi(i,s){var c=f();s=s===void 0?null:s;var p=c.memoizedState;return s!==null&&co(s,p[1])?p[0]:(c.memoizedState=[i,s],i)}function mn(i,s){var c=f();s=s===void 0?null:s;var p=c.memoizedState;if(s!==null&&co(s,p[1]))return p[0];if(p=i(),za){ce(!0);try{i()}finally{ce(!1)}}return c.memoizedState=[p,s],p}function ca(i,s,c){return c===void 0||(di&1073741824)!==0&&(oi&261930)===0?i.memoizedState=s:(i.memoizedState=c,i=bf(),gt.lanes|=i,Dl|=i,c)}function uo(i,s,c,p){return Ta(c,s)?c:yr.current!==null?(i=ca(i,c,p),Ta(i,s)||(Ln=!0),i):(di&42)===0||(di&1073741824)!==0&&(oi&261930)===0?(Ln=!0,i.memoizedState=c):(i=bf(),gt.lanes|=i,Dl|=i,s)}function ns(i,s,c,p,b){var S=ot.p;ot.p=S!==0&&8>S?S:8;var R=Be.T,X={};Be.T=X,Rn(i,!1,s,c);try{var he=b(),Re=Be.S;if(Re!==null&&Re(X,he),he!==null&&typeof he=="object"&&typeof he.then=="function"){var Ge=cc(he,p);Hi(i,s,Ge,tr(i))}else Hi(i,s,p,tr(i))}catch(Ye){Hi(i,s,{then:function(){},status:"rejected",reason:Ye},tr())}finally{ot.p=S,R!==null&&X.types!==null&&(R.types=X.types),Be.T=R}}function as(){}function Is(i,s,c,p){if(i.tag!==5)throw Error(U(476));var b=Wo(i).queue;ns(i,b,s,Tt,c===null?as:function(){return ho(i),c(p)})}function Wo(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:Tt,baseState:Tt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:Tt},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:m,lastRenderedState:c},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function ho(i){var s=Wo(i);s.next===null&&(s=i.alternate.memoizedState),Hi(i,s.next.queue,{},tr())}function _a(){return Fn(ue)}function ya(){return f().memoizedState}function rs(){return f().memoizedState}function fo(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var c=tr();i=ri(c);var p=Cs(s,i,c);p!==null&&(ir(p,s,c),zs(p,s,c)),s={cache:uu()},i.payload=s;return}s=s.return}}function _c(i,s,c){var p=tr();c={lane:p,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Mi(i)?vr(s,c):(c=Js(i,s,c,p),c!==null&&(ir(c,i,p),Rs(c,s,p)))}function gn(i,s,c){var p=tr();Hi(i,s,c,p)}function Hi(i,s,c,p){var b={lane:p,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Mi(i))vr(s,b);else{var S=i.alternate;if(i.lanes===0&&(S===null||S.lanes===0)&&(S=s.lastRenderedReducer,S!==null))try{var R=s.lastRenderedState,X=S(R,c);if(b.hasEagerState=!0,b.eagerState=X,Ta(X,R))return rc(i,s,b,0),Ei===null&&ko(),!1}catch{}finally{}if(c=Js(i,s,b,p),c!==null)return ir(c,i,p),Rs(c,s,p),!0}return!1}function Rn(i,s,c,p){if(p={lane:2,revertLane:Ch(),gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},Mi(i)){if(s)throw Error(U(479))}else s=Js(i,c,p,2),s!==null&&ir(s,i,2)}function Mi(i){var s=i.alternate;return i===gt||s!==null&&s===gt}function vr(i,s){lo=Yo=!0;var c=i.pending;c===null?s.next=s:(s.next=c.next,c.next=s),i.pending=s}function Rs(i,s,c){if((c&4194048)!==0){var p=s.lanes;p&=i.pendingLanes,c|=p,s.lanes=c,yn(i,c)}}var zl={readContext:Fn,use:l,useCallback:nn,useContext:nn,useEffect:nn,useImperativeHandle:nn,useLayoutEffect:nn,useInsertionEffect:nn,useMemo:nn,useReducer:nn,useRef:nn,useState:nn,useDebugValue:nn,useDeferredValue:nn,useTransition:nn,useSyncExternalStore:nn,useId:nn,useHostTransitionStatus:nn,useFormState:nn,useActionState:nn,useOptimistic:nn,useMemoCache:nn,useCacheRefresh:nn};zl.useEffectEvent=nn;var dh={readContext:Fn,use:l,useCallback:function(i,s){return la().memoizedState=[i,s===void 0?null:s],i},useContext:Fn,useEffect:Lt,useImperativeHandle:function(i,s,c){c=c!=null?c.concat([i]):null,Fe(4194308,4,Tn.bind(null,s,i),c)},useLayoutEffect:function(i,s){return Fe(4194308,4,i,s)},useInsertionEffect:function(i,s){Fe(4,2,i,s)},useMemo:function(i,s){var c=la();s=s===void 0?null:s;var p=i();if(za){ce(!0);try{i()}finally{ce(!1)}}return c.memoizedState=[p,s],p},useReducer:function(i,s,c){var p=la();if(c!==void 0){var b=c(s);if(za){ce(!0);try{c(s)}finally{ce(!1)}}}else b=s;return p.memoizedState=p.baseState=b,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:b},p.queue=i,i=i.dispatch=_c.bind(null,gt,i),[p.memoizedState,i]},useRef:function(i){var s=la();return i={current:i},s.memoizedState=i},useState:function(i){i=K(i);var s=i.queue,c=gn.bind(null,gt,s);return s.dispatch=c,[i.memoizedState,c]},useDebugValue:In,useDeferredValue:function(i,s){var c=la();return ca(c,i,s)},useTransition:function(){var i=K(!1);return i=ns.bind(null,gt,i.queue,!0,!1),la().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,c){var p=gt,b=la();if(Qt){if(c===void 0)throw Error(U(407));c=c()}else{if(c=s(),Ei===null)throw Error(U(349));(oi&127)!==0||C(p,s,c)}b.memoizedState=c;var S={value:c,getSnapshot:s};return b.queue=S,Lt(D.bind(null,p,S,i),[i]),p.flags|=2048,Ke(9,{destroy:void 0},I.bind(null,p,S,c,s),null),c},useId:function(){var i=la(),s=Ei.identifierPrefix;if(Qt){var c=Oa,p=Kr;c=(p&~(1<<32-pe(p)-1)).toString(32)+c,s="_"+s+"R_"+c,c=$o++,0<c&&(s+="H"+c.toString(32)),s+="_"}else c=pc++,s="_"+s+"r_"+c.toString(32)+"_";return i.memoizedState=s},useHostTransitionStatus:_a,useFormState:fe,useActionState:fe,useOptimistic:function(i){var s=la();s.memoizedState=s.baseState=i;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=Rn.bind(null,gt,!0,c),c.dispatch=s,[i,s]},useMemoCache:h,useCacheRefresh:function(){return la().memoizedState=fo.bind(null,gt)},useEffectEvent:function(i){var s=la(),c={impl:i};return s.memoizedState=c,function(){if((mi&2)!==0)throw Error(U(440));return c.impl.apply(void 0,arguments)}}},yu={readContext:Fn,use:l,useCallback:qi,useContext:Fn,useEffect:ui,useImperativeHandle:Zi,useInsertionEffect:Wi,useLayoutEffect:Di,useMemo:mn,useReducer:y,useRef:We,useState:function(){return y(m)},useDebugValue:In,useDeferredValue:function(i,s){var c=f();return uo(c,Ti.memoizedState,i,s)},useTransition:function(){var i=y(m)[0],s=f().memoizedState;return[typeof i=="boolean"?i:r(i),s]},useSyncExternalStore:A,useId:ya,useHostTransitionStatus:_a,useFormState:Pe,useActionState:Pe,useOptimistic:function(i,s){var c=f();return W(c,Ti,i,s)},useMemoCache:h,useCacheRefresh:rs};yu.useEffectEvent=Si;var po={readContext:Fn,use:l,useCallback:qi,useContext:Fn,useEffect:ui,useImperativeHandle:Zi,useInsertionEffect:Wi,useLayoutEffect:Di,useMemo:mn,useReducer:T,useRef:We,useState:function(){return T(m)},useDebugValue:In,useDeferredValue:function(i,s){var c=f();return Ti===null?ca(c,i,s):uo(c,Ti.memoizedState,i,s)},useTransition:function(){var i=T(m)[0],s=f().memoizedState;return[typeof i=="boolean"?i:r(i),s]},useSyncExternalStore:A,useId:ya,useHostTransitionStatus:_a,useFormState:Ie,useActionState:Ie,useOptimistic:function(i,s){var c=f();return Ti!==null?W(c,Ti,i,s):(c.baseState=i,[i,c.queue.dispatch])},useMemoCache:h,useCacheRefresh:rs};po.useEffectEvent=Si;function Ls(i,s,c,p){s=i.memoizedState,c=c(p,s),c=c==null?s:Ne({},s,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var yc={enqueueSetState:function(i,s,c){i=i._reactInternals;var p=tr(),b=ri(p);b.payload=s,c!=null&&(b.callback=c),s=Cs(i,b,p),s!==null&&(ir(s,i,p),zs(s,i,p))},enqueueReplaceState:function(i,s,c){i=i._reactInternals;var p=tr(),b=ri(p);b.tag=1,b.payload=s,c!=null&&(b.callback=c),s=Cs(i,b,p),s!==null&&(ir(s,i,p),zs(s,i,p))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var c=tr(),p=ri(c);p.tag=2,s!=null&&(p.callback=s),s=Cs(i,p,c),s!==null&&(ir(s,i,c),zs(s,i,c))}};function vc(i,s,c,p,b,S,R){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(p,S,R):s.prototype&&s.prototype.isPureReactComponent?!ys(c,p)||!ys(b,S):!0}function vu(i,s,c,p){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,p),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,p),s.state!==i&&yc.enqueueReplaceState(s,s.state,null)}function Pa(i,s){var c=s;if("ref"in s){c={};for(var p in s)p!=="ref"&&(c[p]=s[p])}if(i=i.defaultProps){c===s&&(c=Ne({},c));for(var b in i)c[b]===void 0&&(c[b]=i[b])}return c}function ks(i){$r(i)}function xc(i){console.error(i)}function tp(i){$r(i)}function xu(i,s){try{var c=i.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(p){setTimeout(function(){throw p})}}function Hd(i,s,c){try{var p=i.onCaughtError;p(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function bu(i,s,c){return c=ri(c),c.tag=3,c.payload={element:null},c.callback=function(){xu(i,s)},c}function Xd(i){return i=ri(i),i.tag=3,i}function ip(i,s,c,p){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var S=p.value;i.payload=function(){return b(S)},i.callback=function(){Hd(s,c,p)}}var R=c.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(i.callback=function(){Hd(s,c,p),typeof b!="function"&&(Il===null?Il=new Set([this]):Il.add(this));var X=p.stack;this.componentDidCatch(p.value,{componentStack:X!==null?X:""})})}function Yd(i,s,c,p,b){if(c.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(s=c.alternate,s!==null&&Ka(s,c,b,!0),c=oa.current,c!==null){switch(c.tag){case 31:case 13:return Oi===null?vd():c.alternate===null&&Mn===0&&(Mn=3),c.flags&=-257,c.flags|=65536,c.lanes=b,p===uc?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([p]):s.add(p),Mh(i,p,b)),!1;case 22:return c.flags|=65536,p===uc?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([p])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([p]):c.add(p)),Mh(i,p,b)),!1}throw Error(U(435,c.tag))}return Mh(i,p,b),vd(),!1}if(Qt)return s=oa.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,p!==Gi&&(i=Error(U(422),{cause:p}),Uo(pa(i,c)))):(p!==Gi&&(s=Error(U(423),{cause:p}),Uo(pa(s,c))),i=i.current.alternate,i.flags|=65536,b&=-b,i.lanes|=b,p=pa(p,c),b=bu(i.stateNode,p,b),fc(i,b),Mn!==4&&(Mn=2)),!1;var S=Error(U(520),{cause:p});if(S=pa(S,c),Pu===null?Pu=[S]:Pu.push(S),Mn!==4&&(Mn=2),s===null)return!0;p=pa(p,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,i=b&-b,c.lanes|=i,i=bu(c.stateNode,p,i),fc(c,i),!1;case 1:if(s=c.type,S=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Il===null||!Il.has(S))))return c.flags|=65536,b&=-b,c.lanes|=b,b=Xd(b),ip(b,i,c,p),fc(c,b),!1}c=c.return}while(c!==null);return!1}var $d=Error(U(461)),Ln=!1;function va(i,s,c,p){s.child=i===null?lh(s,null,c,p):so(s,i.child,c,p)}function Kd(i,s,c,p,b){c=c.render;var S=s.ref;if("ref"in p){var R={};for(var X in p)X!=="ref"&&(R[X]=p[X])}else R=p;return Ts(s),p=Ds(i,s,c,R,S,b),X=gc(),i!==null&&!Ln?(Al(i,s,b),mo(i,s,b)):(Qt&&X&&jo(s),s.flags|=1,va(i,s,p,b),s.child)}function bc(i,s,c,p,b){if(i===null){var S=c.type;return typeof S=="function"&&!au(S)&&S.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=S,np(i,s,S,p,b)):(i=ru(c.type,null,p,s,s.mode,b),i.ref=s.ref,i.return=s,s.child=i)}if(S=i.child,!ph(i,b)){var R=S.memoizedProps;if(c=c.compare,c=c!==null?c:ys,c(R,p)&&i.ref===s.ref)return mo(i,s,b)}return s.flags|=1,i=Ma(S,p),i.ref=s.ref,i.return=s,s.child=i}function np(i,s,c,p,b){if(i!==null){var S=i.memoizedProps;if(ys(S,p)&&i.ref===s.ref)if(Ln=!1,s.pendingProps=p=S,ph(i,b))(i.flags&131072)!==0&&(Ln=!0);else return s.lanes=i.lanes,mo(i,s,b)}return rd(i,s,c,p,b)}function wc(i,s,c,p){var b=p.children,S=i!==null?i.memoizedState:null;if(i===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.mode==="hidden"){if((s.flags&128)!==0){if(S=S!==null?S.baseLanes|c:c,i!==null){for(p=s.child=i.child,b=0;p!==null;)b=b|p.lanes|p.childLanes,p=p.sibling;p=b&~S}else p=0,s.child=null;return fh(i,s,S,c,p)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&Jr(s,S!==null?S.cachePool:null),S!==null?xt(s,S):Xo(),hh(s);else return p=s.lanes=536870912,fh(i,s,S!==null?S.baseLanes|c:c,c,p)}else S!==null?(Jr(s,S.cachePool),xt(s,S),oo(),s.memoizedState=null):(i!==null&&Jr(s,null),Xo(),oo());return va(i,s,b,c),s.child}function Pl(i,s){return i!==null&&i.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function fh(i,s,c,p,b){var S=hu();return S=S===null?null:{parent:hn._currentValue,pool:S},s.memoizedState={baseLanes:c,cachePool:S},i!==null&&Jr(s,null),Xo(),hh(s),i!==null&&Ka(i,s,p,!0),s.childLanes=b,null}function nd(i,s){return s=wu({mode:s.mode,children:s.children},i.mode),s.ref=i.ref,i.child=s,s.return=i,s}function ap(i,s,c){return so(s,i.child,null,c),i=nd(s,s.pendingProps),i.flags|=2,Qa(s),s.memoizedState=null,i}function Np(i,s,c){var p=s.pendingProps,b=(s.flags&128)!==0;if(s.flags&=-129,i===null){if(Qt){if(p.mode==="hidden")return i=nd(s,p),s.lanes=536870912,Pl(null,i);if(Wa(s),(i=Pi)?(i=Lh(i,Aa),i=i!==null&&i.data==="&"?i:null,i!==null&&(s.memoizedState={dehydrated:i,treeContext:Dr!==null?{id:Kr,overflow:Oa}:null,retryLane:536870912,hydrationErrors:null},c=ou(i),c.return=s,s.child=c,Xn=s,Pi=null)):i=null,i===null)throw ma(s);return s.lanes=536870912,null}return nd(s,p)}var S=i.memoizedState;if(S!==null){var R=S.dehydrated;if(Wa(s),b)if(s.flags&256)s.flags&=-257,s=ap(i,s,c);else if(s.memoizedState!==null)s.child=i.child,s.flags|=128,s=null;else throw Error(U(558));else if(Ln||Ka(i,s,c,!1),b=(c&i.childLanes)!==0,Ln||b){if(p=Ei,p!==null&&(R=Vi(p,c),R!==0&&R!==S.retryLane))throw S.retryLane=R,gr(i,R),ir(p,i,R),$d;vd(),s=ap(i,s,c)}else i=S.treeContext,Pi=La(R.nextSibling),Xn=s,Qt=!0,xs=null,Aa=!1,i!==null&&rh(s,i),s=nd(s,p),s.flags|=4096;return s}return i=Ma(i.child,{mode:p.mode,children:p.children}),i.ref=s.ref,s.child=i,i.return=s,i}function ad(i,s){var c=s.ref;if(c===null)i!==null&&i.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(U(284));(i===null||i.ref!==c)&&(s.flags|=4194816)}}function rd(i,s,c,p,b){return Ts(s),c=Ds(i,s,c,p,void 0,b),p=gc(),i!==null&&!Ln?(Al(i,s,b),mo(i,s,b)):(Qt&&p&&jo(s),s.flags|=1,va(i,s,c,b),s.child)}function sd(i,s,c,p,b,S){return Ts(s),s.updateQueue=null,c=mc(s,p,c,b),_u(i),p=gc(),i!==null&&!Ln?(Al(i,s,S),mo(i,s,S)):(Qt&&p&&jo(s),s.flags|=1,va(i,s,c,S),s.child)}function Wd(i,s,c,p,b){if(Ts(s),s.stateNode===null){var S=Nt,R=c.contextType;typeof R=="object"&&R!==null&&(S=Fn(R)),S=new c(p,S),s.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=yc,s.stateNode=S,S._reactInternals=s,S=s.stateNode,S.props=p,S.state=s.memoizedState,S.refs={},ch(s),R=c.contextType,S.context=typeof R=="object"&&R!==null?Fn(R):Nt,S.state=s.memoizedState,R=c.getDerivedStateFromProps,typeof R=="function"&&(Ls(s,c,R,p),S.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(R=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),R!==S.state&&yc.enqueueReplaceState(S,S.state,null),Ho(s,p,S,b),qo(),S.state=s.memoizedState),typeof S.componentDidMount=="function"&&(s.flags|=4194308),p=!0}else if(i===null){S=s.stateNode;var X=s.memoizedProps,he=Pa(c,X);S.props=he;var Re=S.context,Ge=c.contextType;R=Nt,typeof Ge=="object"&&Ge!==null&&(R=Fn(Ge));var Ye=c.getDerivedStateFromProps;Ge=typeof Ye=="function"||typeof S.getSnapshotBeforeUpdate=="function",X=s.pendingProps!==X,Ge||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(X||Re!==R)&&vu(s,S,p,R),As=!1;var Le=s.memoizedState;S.state=Le,Ho(s,p,S,b),qo(),Re=s.memoizedState,X||Le!==Re||As?(typeof Ye=="function"&&(Ls(s,c,Ye,p),Re=s.memoizedState),(he=As||vc(s,c,he,p,Le,Re,R))?(Ge||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(s.flags|=4194308)):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=p,s.memoizedState=Re),S.props=p,S.state=Re,S.context=R,p=he):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),p=!1)}else{S=s.stateNode,Lr(i,s),R=s.memoizedProps,Ge=Pa(c,R),S.props=Ge,Ye=s.pendingProps,Le=S.context,Re=c.contextType,he=Nt,typeof Re=="object"&&Re!==null&&(he=Fn(Re)),X=c.getDerivedStateFromProps,(Re=typeof X=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(R!==Ye||Le!==he)&&vu(s,S,p,he),As=!1,Le=s.memoizedState,S.state=Le,Ho(s,p,S,b),qo();var Oe=s.memoizedState;R!==Ye||Le!==Oe||As||i!==null&&i.dependencies!==null&&lc(i.dependencies)?(typeof X=="function"&&(Ls(s,c,X,p),Oe=s.memoizedState),(Ge=As||vc(s,c,Ge,p,Le,Oe,he)||i!==null&&i.dependencies!==null&&lc(i.dependencies))?(Re||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(p,Oe,he),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(p,Oe,he)),typeof S.componentDidUpdate=="function"&&(s.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof S.componentDidUpdate!="function"||R===i.memoizedProps&&Le===i.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||R===i.memoizedProps&&Le===i.memoizedState||(s.flags|=1024),s.memoizedProps=p,s.memoizedState=Oe),S.props=p,S.state=Oe,S.context=he,p=Ge):(typeof S.componentDidUpdate!="function"||R===i.memoizedProps&&Le===i.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||R===i.memoizedProps&&Le===i.memoizedState||(s.flags|=1024),p=!1)}return S=p,ad(i,s),p=(s.flags&128)!==0,S||p?(S=s.stateNode,c=p&&typeof c.getDerivedStateFromError!="function"?null:S.render(),s.flags|=1,i!==null&&p?(s.child=so(s,i.child,null,b),s.child=so(s,null,c,b)):va(i,s,c,b),s.memoizedState=S.state,i=s.child):i=mo(i,s,b),i}function Qd(i,s,c,p){return ao(),s.flags|=256,va(i,s,c,p),s.child}var Jd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ef(i){return{baseLanes:i,cachePool:es()}}function od(i,s,c){return i=i!==null?i.childLanes&~c:0,s&&(i|=jr),i}function tf(i,s,c){var p=s.pendingProps,b=!1,S=(s.flags&128)!==0,R;if((R=S)||(R=i!==null&&i.memoizedState===null?!1:(wn.current&2)!==0),R&&(b=!0,s.flags&=-129),R=(s.flags&32)!==0,s.flags&=-33,i===null){if(Qt){if(b?is(s):oo(),(i=Pi)?(i=Lh(i,Aa),i=i!==null&&i.data!=="&"?i:null,i!==null&&(s.memoizedState={dehydrated:i,treeContext:Dr!==null?{id:Kr,overflow:Oa}:null,retryLane:536870912,hydrationErrors:null},c=ou(i),c.return=s,s.child=c,Xn=s,Pi=null)):i=null,i===null)throw ma(s);return Nf(i)?s.lanes=32:s.lanes=536870912,null}var X=p.children;return p=p.fallback,b?(oo(),b=s.mode,X=wu({mode:"hidden",children:X},b),p=eo(p,b,c,null),X.return=s,p.return=s,X.sibling=p,s.child=X,p=s.child,p.memoizedState=ef(c),p.childLanes=od(i,R,c),s.memoizedState=Jd,Pl(null,p)):(is(s),nf(s,X))}var he=i.memoizedState;if(he!==null&&(X=he.dehydrated,X!==null)){if(S)s.flags&256?(is(s),s.flags&=-257,s=ld(i,s,c)):s.memoizedState!==null?(oo(),s.child=i.child,s.flags|=128,s=null):(oo(),X=p.fallback,b=s.mode,p=wu({mode:"visible",children:p.children},b),X=eo(X,b,c,null),X.flags|=2,p.return=s,X.return=s,p.sibling=X,s.child=p,so(s,i.child,null,c),p=s.child,p.memoizedState=ef(c),p.childLanes=od(i,R,c),s.memoizedState=Jd,s=Pl(null,p));else if(is(s),Nf(X)){if(R=X.nextSibling&&X.nextSibling.dataset,R)var Re=R.dgst;R=Re,p=Error(U(419)),p.stack="",p.digest=R,Uo({value:p,source:null,stack:null}),s=ld(i,s,c)}else if(Ln||Ka(i,s,c,!1),R=(c&i.childLanes)!==0,Ln||R){if(R=Ei,R!==null&&(p=Vi(R,c),p!==0&&p!==he.retryLane))throw he.retryLane=p,gr(i,p),ir(R,i,p),$d;Uf(X)||vd(),s=ld(i,s,c)}else Uf(X)?(s.flags|=192,s.child=i.child,s=null):(i=he.treeContext,Pi=La(X.nextSibling),Xn=s,Qt=!0,xs=null,Aa=!1,i!==null&&rh(s,i),s=nf(s,p.children),s.flags|=4096);return s}return b?(oo(),X=p.fallback,b=s.mode,he=i.child,Re=he.sibling,p=Ma(he,{mode:"hidden",children:p.children}),p.subtreeFlags=he.subtreeFlags&65011712,Re!==null?X=Ma(Re,X):(X=eo(X,b,c,null),X.flags|=2),X.return=s,p.return=s,p.sibling=X,s.child=p,Pl(null,p),p=s.child,X=i.child.memoizedState,X===null?X=ef(c):(b=X.cachePool,b!==null?(he=hn._currentValue,b=b.parent!==he?{parent:he,pool:he}:b):b=es(),X={baseLanes:X.baseLanes|c,cachePool:b}),p.memoizedState=X,p.childLanes=od(i,R,c),s.memoizedState=Jd,Pl(i.child,p)):(is(s),c=i.child,i=c.sibling,c=Ma(c,{mode:"visible",children:p.children}),c.return=s,c.sibling=null,i!==null&&(R=s.deletions,R===null?(s.deletions=[i],s.flags|=16):R.push(i)),s.child=c,s.memoizedState=null,c)}function nf(i,s){return s=wu({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function wu(i,s){return i=Ya(22,i,null,s),i.lanes=0,i}function ld(i,s,c){return so(s,i.child,null,c),i=nf(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function cd(i,s,c){i.lanes|=s;var p=i.alternate;p!==null&&(p.lanes|=s),cu(i.return,s,c)}function Tc(i,s,c,p,b,S){var R=i.memoizedState;R===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:p,tail:c,tailMode:b,treeForkCount:S}:(R.isBackwards=s,R.rendering=null,R.renderingStartTime=0,R.last=p,R.tail=c,R.tailMode=b,R.treeForkCount=S)}function ja(i,s,c){var p=s.pendingProps,b=p.revealOrder,S=p.tail;p=p.children;var R=wn.current,X=(R&2)!==0;if(X?(R=R&1|2,s.flags|=128):R&=1,st(wn,R),va(i,s,p,c),p=Qt?no:0,!X&&i!==null&&(i.flags&128)!==0)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&cd(i,c,s);else if(i.tag===19)cd(i,c,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(b){case"forwards":for(c=s.child,b=null;c!==null;)i=c.alternate,i!==null&&Ja(i)===null&&(b=c),c=c.sibling;c=b,c===null?(b=s.child,s.child=null):(b=c.sibling,c.sibling=null),Tc(s,!1,b,c,S,p);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=s.child,s.child=null;b!==null;){if(i=b.alternate,i!==null&&Ja(i)===null){s.child=b;break}i=b.sibling,b.sibling=c,c=b,b=i}Tc(s,!0,c,null,S,p);break;case"together":Tc(s,!1,null,null,void 0,p);break;default:s.memoizedState=null}return s.child}function mo(i,s,c){if(i!==null&&(s.dependencies=i.dependencies),Dl|=s.lanes,(c&s.childLanes)===0)if(i!==null){if(Ka(i,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(U(153));if(s.child!==null){for(i=s.child,c=Ma(i,i.pendingProps),s.child=c,c.return=s;i.sibling!==null;)i=i.sibling,c=c.sibling=Ma(i,i.pendingProps),c.return=s;c.sibling=null}return s.child}function ph(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&lc(i)))}function Vp(i,s,c){switch(s.tag){case 3:fi(s,s.stateNode.containerInfo),Qr(s,hn,i.memoizedState.cache),ao();break;case 27:case 5:ar(s);break;case 4:fi(s,s.stateNode.containerInfo);break;case 10:Qr(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Wa(s),null;break;case 13:var p=s.memoizedState;if(p!==null)return p.dehydrated!==null?(is(s),s.flags|=128,null):(c&s.child.childLanes)!==0?tf(i,s,c):(is(s),i=mo(i,s,c),i!==null?i.sibling:null);is(s);break;case 19:var b=(i.flags&128)!==0;if(p=(c&s.childLanes)!==0,p||(Ka(i,s,c,!1),p=(c&s.childLanes)!==0),b){if(p)return ja(i,s,c);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),st(wn,wn.current),p)break;return null;case 22:return s.lanes=0,wc(i,s,c,s.pendingProps);case 24:Qr(s,hn,i.memoizedState.cache)}return mo(i,s,c)}function af(i,s,c){if(i!==null)if(i.memoizedProps!==s.pendingProps)Ln=!0;else{if(!ph(i,c)&&(s.flags&128)===0)return Ln=!1,Vp(i,s,c);Ln=(i.flags&131072)!==0}else Ln=!1,Qt&&(s.flags&1048576)!==0&&lu(s,no,s.index);switch(s.lanes=0,s.tag){case 16:e:{var p=s.pendingProps;if(i=Es(s.elementType),s.type=i,typeof i=="function")au(i)?(p=Pa(i,p),s.tag=1,s=Wd(null,s,i,p,c)):(s.tag=0,s=rd(null,s,i,p,c));else{if(i!=null){var b=i.$$typeof;if(b===gi){s.tag=11,s=Kd(null,s,i,p,c);break e}else if(b===Ht){s.tag=14,s=bc(null,s,i,p,c);break e}}throw s=da(i)||i,Error(U(306,s,""))}}return s;case 0:return rd(i,s,s.type,s.pendingProps,c);case 1:return p=s.type,b=Pa(p,s.pendingProps),Wd(i,s,p,b,c);case 3:e:{if(fi(s,s.stateNode.containerInfo),i===null)throw Error(U(387));p=s.pendingProps;var S=s.memoizedState;b=S.element,Lr(i,s),Ho(s,p,null,c);var R=s.memoizedState;if(p=R.cache,Qr(s,hn,p),p!==S.cache&&oc(s,[hn],c,!0),qo(),p=R.element,S.isDehydrated)if(S={element:p,isDehydrated:!1,cache:R.cache},s.updateQueue.baseState=S,s.memoizedState=S,s.flags&256){s=Qd(i,s,p,c);break e}else if(p!==b){b=pa(Error(U(424)),s),Uo(b),s=Qd(i,s,p,c);break e}else{switch(i=s.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Pi=La(i.firstChild),Xn=s,Qt=!0,xs=null,Aa=!0,c=lh(s,null,p,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(ao(),p===b){s=mo(i,s,c);break e}va(i,s,p,c)}s=s.child}return s;case 26:return ad(i,s),i===null?(c=Od(s.type,null,s.pendingProps,null))?s.memoizedState=c:Qt||(c=s.type,i=s.pendingProps,p=Ih(wt.current).createElement(c),p[ci]=s,p[$e]=i,Fi(p,c,i),en(p),s.stateNode=p):s.memoizedState=Od(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return ar(s),i===null&&Qt&&(p=s.stateNode=Gf(s.type,s.pendingProps,wt.current),Xn=s,Aa=!0,b=Pi,nl(s.type)?(Kn=b,Pi=La(p.firstChild)):Pi=b),va(i,s,s.pendingProps.children,c),ad(i,s),i===null&&(s.flags|=4194304),s.child;case 5:return i===null&&Qt&&((b=p=Pi)&&(p=Rd(p,s.type,s.pendingProps,Aa),p!==null?(s.stateNode=p,Xn=s,Pi=La(p.firstChild),Aa=!1,b=!0):b=!1),b||ma(s)),ar(s),b=s.type,S=s.pendingProps,R=i!==null?i.memoizedProps:null,p=S.children,Dd(b,S)?p=null:R!==null&&Dd(b,R)&&(s.flags|=32),s.memoizedState!==null&&(b=Ds(i,s,Ko,null,null,c),ue._currentValue=b),ad(i,s),va(i,s,p,c),s.child;case 6:return i===null&&Qt&&((i=c=Pi)&&(c=Ld(c,s.pendingProps,Aa),c!==null?(s.stateNode=c,Xn=s,Pi=null,i=!0):i=!1),i||ma(s)),null;case 13:return tf(i,s,c);case 4:return fi(s,s.stateNode.containerInfo),p=s.pendingProps,i===null?s.child=so(s,null,p,c):va(i,s,p,c),s.child;case 11:return Kd(i,s,s.type,s.pendingProps,c);case 7:return va(i,s,s.pendingProps,c),s.child;case 8:return va(i,s,s.pendingProps.children,c),s.child;case 12:return va(i,s,s.pendingProps.children,c),s.child;case 10:return p=s.pendingProps,Qr(s,s.type,p.value),va(i,s,p.children,c),s.child;case 9:return b=s.type._context,p=s.pendingProps.children,Ts(s),b=Fn(b),p=p(b),s.flags|=1,va(i,s,p,c),s.child;case 14:return bc(i,s,s.type,s.pendingProps,c);case 15:return np(i,s,s.type,s.pendingProps,c);case 19:return ja(i,s,c);case 31:return Np(i,s,c);case 22:return wc(i,s,c,s.pendingProps);case 24:return Ts(s),p=Fn(hn),i===null?(b=hu(),b===null&&(b=Ei,S=uu(),b.pooledCache=S,S.refCount++,S!==null&&(b.pooledCacheLanes|=c),b=S),s.memoizedState={parent:p,cache:b},ch(s),Qr(s,hn,b)):((i.lanes&c)!==0&&(Lr(i,s),Ho(s,null,null,c),qo()),b=i.memoizedState,S=s.memoizedState,b.parent!==p?(b={parent:p,cache:p},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),Qr(s,hn,p)):(p=S.cache,Qr(s,hn,p),p!==b.cache&&oc(s,[hn],c,!0))),va(i,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(U(156,s.tag))}function Qo(i){i.flags|=4}function rf(i,s,c,p,b){if((s=(i.mode&32)!==0)&&(s=!1),s){if(i.flags|=16777216,(b&335544128)===b)if(i.stateNode.complete)i.flags|=8192;else if(_p())i.flags|=8192;else throw jt=uc,du}else i.flags&=-16777217}function sf(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!k(s))if(_p())i.flags|=8192;else throw jt=uc,du}function ud(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?qt():536870912,i.lanes|=s,zu|=s)}function Sc(i,s){if(!Qt)switch(i.tailMode){case"hidden":s=i.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var p=null;c!==null;)c.alternate!==null&&(p=c),c=c.sibling;p===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:p.sibling=null}}function an(i){var s=i.alternate!==null&&i.alternate.child===i.child,c=0,p=0;if(s)for(var b=i.child;b!==null;)c|=b.lanes|b.childLanes,p|=b.subtreeFlags&65011712,p|=b.flags&65011712,b.return=i,b=b.sibling;else for(b=i.child;b!==null;)c|=b.lanes|b.childLanes,p|=b.subtreeFlags,p|=b.flags,b.return=i,b=b.sibling;return i.subtreeFlags|=p,i.childLanes=c,s}function rp(i,s,c){var p=s.pendingProps;switch(sc(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return an(s),null;case 1:return an(s),null;case 3:return c=s.stateNode,p=null,i!==null&&(p=i.memoizedState.cache),s.memoizedState.cache!==p&&(s.flags|=2048),$a(hn),ai(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(i===null||i.child===null)&&(bs(s)?Qo(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,ro())),an(s),null;case 26:var b=s.type,S=s.memoizedState;return i===null?(Qo(s),S!==null?(an(s),sf(s,S)):(an(s),rf(s,b,null,p,c))):S?S!==i.memoizedState?(Qo(s),an(s),sf(s,S)):(an(s),s.flags&=-16777217):(i=i.memoizedProps,i!==p&&Qo(s),an(s),rf(s,b,i,p,c)),null;case 27:if(Mr(s),c=wt.current,b=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==p&&Qo(s);else{if(!p){if(s.stateNode===null)throw Error(U(166));return an(s),null}i=ct.current,bs(s)?Ca(s):(i=Gf(b,p,c),s.stateNode=i,Qo(s))}return an(s),null;case 5:if(Mr(s),b=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==p&&Qo(s);else{if(!p){if(s.stateNode===null)throw Error(U(166));return an(s),null}if(S=ct.current,bs(s))Ca(s);else{var R=Ih(wt.current);switch(S){case 1:S=R.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:S=R.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":S=R.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":S=R.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":S=R.createElement("div"),S.innerHTML="<script><\/script>",S=S.removeChild(S.firstChild);break;case"select":S=typeof p.is=="string"?R.createElement("select",{is:p.is}):R.createElement("select"),p.multiple?S.multiple=!0:p.size&&(S.size=p.size);break;default:S=typeof p.is=="string"?R.createElement(b,{is:p.is}):R.createElement(b)}}S[ci]=s,S[$e]=p;e:for(R=s.child;R!==null;){if(R.tag===5||R.tag===6)S.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===s)break e;for(;R.sibling===null;){if(R.return===null||R.return===s)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}s.stateNode=S;e:switch(Fi(S,b,p),b){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}p&&Qo(s)}}return an(s),rf(s,s.type,i===null?null:i.memoizedProps,s.pendingProps,c),null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==p&&Qo(s);else{if(typeof p!="string"&&s.stateNode===null)throw Error(U(166));if(i=wt.current,bs(s)){if(i=s.stateNode,c=s.memoizedProps,p=null,b=Xn,b!==null)switch(b.tag){case 27:case 5:p=b.memoizedProps}i[ci]=s,i=!!(i.nodeValue===c||p!==null&&p.suppressHydrationWarning===!0||kf(i.nodeValue,c)),i||ma(s,!0)}else i=Ih(i).createTextNode(p),i[ci]=s,s.stateNode=i}return an(s),null;case 31:if(c=s.memoizedState,i===null||i.memoizedState!==null){if(p=bs(s),c!==null){if(i===null){if(!p)throw Error(U(318));if(i=s.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(U(557));i[ci]=s}else ao(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;an(s),i=!1}else c=ro(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=c),i=!0;if(!i)return s.flags&256?(Qa(s),s):(Qa(s),null);if((s.flags&128)!==0)throw Error(U(558))}return an(s),null;case 13:if(p=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(b=bs(s),p!==null&&p.dehydrated!==null){if(i===null){if(!b)throw Error(U(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(U(317));b[ci]=s}else ao(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;an(s),b=!1}else b=ro(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?(Qa(s),s):(Qa(s),null)}return Qa(s),(s.flags&128)!==0?(s.lanes=c,s):(c=p!==null,i=i!==null&&i.memoizedState!==null,c&&(p=s.child,b=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(b=p.alternate.memoizedState.cachePool.pool),S=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(S=p.memoizedState.cachePool.pool),S!==b&&(p.flags|=2048)),c!==i&&c&&(s.child.flags|=8192),ud(s,s.updateQueue),an(s),null);case 4:return ai(),i===null&&_o(s.stateNode.containerInfo),an(s),null;case 10:return $a(s.type),an(s),null;case 19:if(Ze(wn),p=s.memoizedState,p===null)return an(s),null;if(b=(s.flags&128)!==0,S=p.rendering,S===null)if(b)Sc(p,!1);else{if(Mn!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(S=Ja(i),S!==null){for(s.flags|=128,Sc(p,!1),i=S.updateQueue,s.updateQueue=i,ud(s,i),s.subtreeFlags=0,i=c,c=s.child;c!==null;)Qh(c,i),c=c.sibling;return st(wn,wn.current&1|2),Qt&&Wr(s,p.treeForkCount),s.child}i=i.sibling}p.tail!==null&&pn()>md&&(s.flags|=128,b=!0,Sc(p,!1),s.lanes=4194304)}else{if(!b)if(i=Ja(S),i!==null){if(s.flags|=128,b=!0,i=i.updateQueue,s.updateQueue=i,ud(s,i),Sc(p,!0),p.tail===null&&p.tailMode==="hidden"&&!S.alternate&&!Qt)return an(s),null}else 2*pn()-p.renderingStartTime>md&&c!==536870912&&(s.flags|=128,b=!0,Sc(p,!1),s.lanes=4194304);p.isBackwards?(S.sibling=s.child,s.child=S):(i=p.last,i!==null?i.sibling=S:s.child=S,p.last=S)}return p.tail!==null?(i=p.tail,p.rendering=i,p.tail=i.sibling,p.renderingStartTime=pn(),i.sibling=null,c=wn.current,st(wn,b?c&1|2:c&1),Qt&&Wr(s,p.treeForkCount),i):(an(s),null);case 22:case 23:return Qa(s),gu(),p=s.memoizedState!==null,i!==null?i.memoizedState!==null!==p&&(s.flags|=8192):p&&(s.flags|=8192),p?(c&536870912)!==0&&(s.flags&128)===0&&(an(s),s.subtreeFlags&6&&(s.flags|=8192)):an(s),c=s.updateQueue,c!==null&&ud(s,c.retryQueue),c=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),p=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(p=s.memoizedState.cachePool.pool),p!==c&&(s.flags|=2048),i!==null&&Ze(Ms),null;case 24:return c=null,i!==null&&(c=i.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),$a(hn),an(s),null;case 25:return null;case 30:return null}throw Error(U(156,s.tag))}function Gp(i,s){switch(sc(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return $a(hn),ai(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return Mr(s),null;case 31:if(s.memoizedState!==null){if(Qa(s),s.alternate===null)throw Error(U(340));ao()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 13:if(Qa(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(U(340));ao()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return Ze(wn),null;case 4:return ai(),null;case 10:return $a(s.type),null;case 22:case 23:return Qa(s),gu(),i!==null&&Ze(Ms),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return $a(hn),null;case 25:return null;default:return null}}function sp(i,s){switch(sc(s),s.tag){case 3:$a(hn),ai();break;case 26:case 27:case 5:Mr(s);break;case 4:ai();break;case 31:s.memoizedState!==null&&Qa(s);break;case 13:Qa(s);break;case 19:Ze(wn);break;case 10:$a(s.type);break;case 22:case 23:Qa(s),gu(),i!==null&&Ze(Ms);break;case 24:$a(hn)}}function mh(i,s){try{var c=s.updateQueue,p=c!==null?c.lastEffect:null;if(p!==null){var b=p.next;c=b;do{if((c.tag&i)===i){p=void 0;var S=c.create,R=c.inst;p=S(),R.destroy=p}c=c.next}while(c!==b)}}catch(X){Ii(s,s.return,X)}}function Bs(i,s,c){try{var p=s.updateQueue,b=p!==null?p.lastEffect:null;if(b!==null){var S=b.next;p=S;do{if((p.tag&i)===i){var R=p.inst,X=R.destroy;if(X!==void 0){R.destroy=void 0,b=s;var he=c,Re=X;try{Re()}catch(Ge){Ii(b,he,Ge)}}}p=p.next}while(p!==S)}}catch(Ge){Ii(s,s.return,Ge)}}function hd(i){var s=i.updateQueue;if(s!==null){var c=i.stateNode;try{_r(s,c)}catch(p){Ii(i,i.return,p)}}}function of(i,s,c){c.props=Pa(i.type,i.memoizedProps),c.state=i.memoizedState;try{c.componentWillUnmount()}catch(p){Ii(i,s,p)}}function Os(i,s){try{var c=i.ref;if(c!==null){switch(i.tag){case 26:case 27:case 5:var p=i.stateNode;break;case 30:p=i.stateNode;break;default:p=i.stateNode}typeof c=="function"?i.refCleanup=c(p):c.current=p}}catch(b){Ii(i,s,b)}}function xr(i,s){var c=i.ref,p=i.refCleanup;if(c!==null)if(typeof p=="function")try{p()}catch(b){Ii(i,s,b)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){Ii(i,s,b)}else c.current=null}function op(i){var s=i.type,c=i.memoizedProps,p=i.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&p.focus();break e;case"img":c.src?p.src=c.src:c.srcSet&&(p.srcset=c.srcSet)}}catch(b){Ii(i,i.return,b)}}function lf(i,s,c){try{var p=i.stateNode;ju(p,i.type,c,s),p[$e]=s}catch(b){Ii(i,i.return,b)}}function lp(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&nl(i.type)||i.tag===4}function cf(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||lp(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&nl(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function uf(i,s,c){var p=i.tag;if(p===5||p===6)i=i.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(i,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(i),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=Ft));else if(p!==4&&(p===27&&nl(i.type)&&(c=i.stateNode,s=null),i=i.child,i!==null))for(uf(i,s,c),i=i.sibling;i!==null;)uf(i,s,c),i=i.sibling}function dd(i,s,c){var p=i.tag;if(p===5||p===6)i=i.stateNode,s?c.insertBefore(i,s):c.appendChild(i);else if(p!==4&&(p===27&&nl(i.type)&&(c=i.stateNode),i=i.child,i!==null))for(dd(i,s,c),i=i.sibling;i!==null;)dd(i,s,c),i=i.sibling}function cp(i){var s=i.stateNode,c=i.memoizedProps;try{for(var p=i.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);Fi(s,p,c),s[ci]=i,s[$e]=c}catch(S){Ii(i,i.return,S)}}var js=!1,Yn=!1,fd=!1,Tu=typeof WeakSet=="function"?WeakSet:Set,xa=null;function Sn(i,s){if(i=i.containerInfo,zd=tt,i=ec(i),eu(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var p=c.getSelection&&c.getSelection();if(p&&p.rangeCount!==0){c=p.anchorNode;var b=p.anchorOffset,S=p.focusNode;p=p.focusOffset;try{c.nodeType,S.nodeType}catch{c=null;break e}var R=0,X=-1,he=-1,Re=0,Ge=0,Ye=i,Le=null;t:for(;;){for(var Oe;Ye!==c||b!==0&&Ye.nodeType!==3||(X=R+b),Ye!==S||p!==0&&Ye.nodeType!==3||(he=R+p),Ye.nodeType===3&&(R+=Ye.nodeValue.length),(Oe=Ye.firstChild)!==null;)Le=Ye,Ye=Oe;for(;;){if(Ye===i)break t;if(Le===c&&++Re===b&&(X=R),Le===S&&++Ge===p&&(he=R),(Oe=Ye.nextSibling)!==null)break;Ye=Le,Le=Ye.parentNode}Ye=Oe}c=X===-1||he===-1?null:{start:X,end:he}}else c=null}c=c||{start:0,end:0}}else c=null;for(Pd={focusedElem:i,selectionRange:c},tt=!1,xa=s;xa!==null;)if(s=xa,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,xa=i;else for(;xa!==null;){switch(s=xa,S=s.alternate,i=s.flags,s.tag){case 0:if((i&4)!==0&&(i=s.updateQueue,i=i!==null?i.events:null,i!==null))for(c=0;c<i.length;c++)b=i[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&S!==null){i=void 0,c=s,b=S.memoizedProps,S=S.memoizedState,p=c.stateNode;try{var yt=Pa(c.type,b);i=p.getSnapshotBeforeUpdate(yt,S),p.__reactInternalSnapshotBeforeUpdate=i}catch(kt){Ii(c,c.return,kt)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,c=i.nodeType,c===9)Id(i);else if(c===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Id(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(U(163))}if(i=s.sibling,i!==null){i.return=s.return,xa=i;break}xa=s.return}}function Mc(i,s,c){var p=c.flags;switch(c.tag){case 0:case 11:case 15:er(i,c),p&4&&mh(5,c);break;case 1:if(er(i,c),p&4)if(i=c.stateNode,s===null)try{i.componentDidMount()}catch(R){Ii(c,c.return,R)}else{var b=Pa(c.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(b,s,i.__reactInternalSnapshotBeforeUpdate)}catch(R){Ii(c,c.return,R)}}p&64&&hd(c),p&512&&Os(c,c.return);break;case 3:if(er(i,c),p&64&&(i=c.updateQueue,i!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{_r(i,s)}catch(R){Ii(c,c.return,R)}}break;case 27:s===null&&p&4&&cp(c);case 26:case 5:er(i,c),s===null&&p&4&&op(c),p&512&&Os(c,c.return);break;case 12:er(i,c);break;case 31:er(i,c),p&4&&ff(i,c);break;case 13:er(i,c),p&4&&Su(i,c),p&64&&(i=c.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(c=Mp.bind(null,c),Qp(i,c))));break;case 22:if(p=c.memoizedState!==null||js,!p){s=s!==null&&s.memoizedState!==null||Yn,b=js;var S=Yn;js=p,(Yn=s)&&!S?go(i,c,(c.subtreeFlags&8772)!==0):er(i,c),js=b,Yn=S}break;case 30:break;default:er(i,c)}}function hf(i){var s=i.alternate;s!==null&&(i.alternate=null,hf(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&wo(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Qi=null,Da=!1;function Br(i,s,c){for(c=c.child;c!==null;)df(i,s,c),c=c.sibling}function df(i,s,c){if(ie&&typeof ie.onCommitFiberUnmount=="function")try{ie.onCommitFiberUnmount(Y,c)}catch{}switch(c.tag){case 26:Yn||xr(c,s),Br(i,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Yn||xr(c,s);var p=Qi,b=Da;nl(c.type)&&(Qi=c.stateNode,Da=!1),Br(i,s,c),kc(c.stateNode),Qi=p,Da=b;break;case 5:Yn||xr(c,s);case 6:if(p=Qi,b=Da,Qi=null,Br(i,s,c),Qi=p,Da=b,Qi!==null)if(Da)try{(Qi.nodeType===9?Qi.body:Qi.nodeName==="HTML"?Qi.ownerDocument.body:Qi).removeChild(c.stateNode)}catch(S){Ii(c,s,S)}else try{Qi.removeChild(c.stateNode)}catch(S){Ii(c,s,S)}break;case 18:Qi!==null&&(Da?(i=Qi,Ff(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,c.stateNode),Va(i)):Ff(Qi,c.stateNode));break;case 4:p=Qi,b=Da,Qi=c.stateNode.containerInfo,Da=!0,Br(i,s,c),Qi=p,Da=b;break;case 0:case 11:case 14:case 15:Bs(2,c,s),Yn||Bs(4,c,s),Br(i,s,c);break;case 1:Yn||(xr(c,s),p=c.stateNode,typeof p.componentWillUnmount=="function"&&of(c,s,p)),Br(i,s,c);break;case 21:Br(i,s,c);break;case 22:Yn=(p=Yn)||c.memoizedState!==null,Br(i,s,c),Yn=p;break;default:Br(i,s,c)}}function ff(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{Va(i)}catch(c){Ii(s,s.return,c)}}}function Su(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Va(i)}catch(c){Ii(s,s.return,c)}}function pf(i){switch(i.tag){case 31:case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new Tu),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new Tu),s;default:throw Error(U(435,i.tag))}}function Jo(i,s){var c=pf(i);s.forEach(function(p){if(!c.has(p)){c.add(p);var b=Xp.bind(null,i,p);p.then(b,b)}})}function Ia(i,s){var c=s.deletions;if(c!==null)for(var p=0;p<c.length;p++){var b=c[p],S=i,R=s,X=R;e:for(;X!==null;){switch(X.tag){case 27:if(nl(X.type)){Qi=X.stateNode,Da=!1;break e}break;case 5:Qi=X.stateNode,Da=!1;break e;case 3:case 4:Qi=X.stateNode.containerInfo,Da=!0;break e}X=X.return}if(Qi===null)throw Error(U(160));df(S,R,b),Qi=null,Da=!1,S=b.alternate,S!==null&&(S.return=null),b.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Mu(s,i),s=s.sibling}var Fa=null;function Mu(i,s){var c=i.alternate,p=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Ia(s,i),br(i),p&4&&(Bs(3,i,i.return),mh(3,i),Bs(5,i,i.return));break;case 1:Ia(s,i),br(i),p&512&&(Yn||c===null||xr(c,c.return)),p&64&&js&&(i=i.updateQueue,i!==null&&(p=i.callbacks,p!==null&&(c=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=c===null?p:c.concat(p))));break;case 26:var b=Fa;if(Ia(s,i),br(i),p&512&&(Yn||c===null||xr(c,c.return)),p&4){var S=c!==null?c.memoizedState:null;if(p=i.memoizedState,c===null)if(p===null)if(i.stateNode===null){e:{p=i.type,c=i.memoizedProps,b=b.ownerDocument||b;t:switch(p){case"title":S=b.getElementsByTagName("title")[0],(!S||S[Bt]||S[ci]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=b.createElement(p),b.head.insertBefore(S,b.querySelector("head > title"))),Fi(S,p,c),S[ci]=i,en(S),p=S;break e;case"link":var R=M("link","href",b).get(p+(c.href||""));if(R){for(var X=0;X<R.length;X++)if(S=R[X],S.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&S.getAttribute("rel")===(c.rel==null?null:c.rel)&&S.getAttribute("title")===(c.title==null?null:c.title)&&S.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){R.splice(X,1);break t}}S=b.createElement(p),Fi(S,p,c),b.head.appendChild(S);break;case"meta":if(R=M("meta","content",b).get(p+(c.content||""))){for(X=0;X<R.length;X++)if(S=R[X],S.getAttribute("content")===(c.content==null?null:""+c.content)&&S.getAttribute("name")===(c.name==null?null:c.name)&&S.getAttribute("property")===(c.property==null?null:c.property)&&S.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&S.getAttribute("charset")===(c.charSet==null?null:c.charSet)){R.splice(X,1);break t}}S=b.createElement(p),Fi(S,p,c),b.head.appendChild(S);break;default:throw Error(U(468,p))}S[ci]=i,en(S),p=S}i.stateNode=p}else E(b,i.type,i.stateNode);else i.stateNode=u(b,p,i.memoizedProps);else S!==p?(S===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):S.count--,p===null?E(b,i.type,i.stateNode):u(b,p,i.memoizedProps)):p===null&&i.stateNode!==null&&lf(i,i.memoizedProps,c.memoizedProps)}break;case 27:Ia(s,i),br(i),p&512&&(Yn||c===null||xr(c,c.return)),c!==null&&p&4&&lf(i,i.memoizedProps,c.memoizedProps);break;case 5:if(Ia(s,i),br(i),p&512&&(Yn||c===null||xr(c,c.return)),i.flags&32){b=i.stateNode;try{ds(b,"")}catch(yt){Ii(i,i.return,yt)}}p&4&&i.stateNode!=null&&(b=i.memoizedProps,lf(i,b,c!==null?c.memoizedProps:b)),p&1024&&(fd=!0);break;case 6:if(Ia(s,i),br(i),p&4){if(i.stateNode===null)throw Error(U(162));p=i.memoizedProps,c=i.stateNode;try{c.nodeValue=p}catch(yt){Ii(i,i.return,yt)}}break;case 3:if(x=null,b=Fa,Fa=kh(s.containerInfo),Ia(s,i),Fa=b,br(i),p&4&&c!==null&&c.memoizedState.isDehydrated)try{Va(s.containerInfo)}catch(yt){Ii(i,i.return,yt)}fd&&(fd=!1,mf(i));break;case 4:p=Fa,Fa=kh(i.stateNode.containerInfo),Ia(s,i),br(i),Fa=p;break;case 12:Ia(s,i),br(i);break;case 31:Ia(s,i),br(i),p&4&&(p=i.updateQueue,p!==null&&(i.updateQueue=null,Jo(i,p)));break;case 13:Ia(s,i),br(i),i.child.flags&8192&&i.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(bh=pn()),p&4&&(p=i.updateQueue,p!==null&&(i.updateQueue=null,Jo(i,p)));break;case 22:b=i.memoizedState!==null;var he=c!==null&&c.memoizedState!==null,Re=js,Ge=Yn;if(js=Re||b,Yn=Ge||he,Ia(s,i),Yn=Ge,js=Re,br(i),p&8192)e:for(s=i.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(c===null||he||js||Yn||Ec(i)),c=null,s=i;;){if(s.tag===5||s.tag===26){if(c===null){he=c=s;try{if(S=he.stateNode,b)R=S.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{X=he.stateNode;var Ye=he.memoizedProps.style,Le=Ye!=null&&Ye.hasOwnProperty("display")?Ye.display:null;X.style.display=Le==null||typeof Le=="boolean"?"":(""+Le).trim()}}catch(yt){Ii(he,he.return,yt)}}}else if(s.tag===6){if(c===null){he=s;try{he.stateNode.nodeValue=b?"":he.memoizedProps}catch(yt){Ii(he,he.return,yt)}}}else if(s.tag===18){if(c===null){he=s;try{var Oe=he.stateNode;b?Rh(Oe,!0):Rh(he.stateNode,!1)}catch(yt){Ii(he,he.return,yt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}p&4&&(p=i.updateQueue,p!==null&&(c=p.retryQueue,c!==null&&(p.retryQueue=null,Jo(i,c))));break;case 19:Ia(s,i),br(i),p&4&&(p=i.updateQueue,p!==null&&(i.updateQueue=null,Jo(i,p)));break;case 30:break;case 21:break;default:Ia(s,i),br(i)}}function br(i){var s=i.flags;if(s&2){try{for(var c,p=i.return;p!==null;){if(lp(p)){c=p;break}p=p.return}if(c==null)throw Error(U(160));switch(c.tag){case 27:var b=c.stateNode,S=cf(i);dd(i,S,b);break;case 5:var R=c.stateNode;c.flags&32&&(ds(R,""),c.flags&=-33);var X=cf(i);dd(i,X,R);break;case 3:case 4:var he=c.stateNode.containerInfo,Re=cf(i);uf(i,Re,he);break;default:throw Error(U(161))}}catch(Ge){Ii(i,i.return,Ge)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function mf(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;mf(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function er(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)Mc(i,s.alternate,s),s=s.sibling}function Ec(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:Bs(4,s,s.return),Ec(s);break;case 1:xr(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&of(s,s.return,c),Ec(s);break;case 27:kc(s.stateNode);case 26:case 5:xr(s,s.return),Ec(s);break;case 22:s.memoizedState===null&&Ec(s);break;case 30:Ec(s);break;default:Ec(s)}i=i.sibling}}function go(i,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var p=s.alternate,b=i,S=s,R=S.flags;switch(S.tag){case 0:case 11:case 15:go(b,S,c),mh(4,S);break;case 1:if(go(b,S,c),p=S,b=p.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Re){Ii(p,p.return,Re)}if(p=S,b=p.updateQueue,b!==null){var X=p.stateNode;try{var he=b.shared.hiddenCallbacks;if(he!==null)for(b.shared.hiddenCallbacks=null,b=0;b<he.length;b++)uh(he[b],X)}catch(Re){Ii(p,p.return,Re)}}c&&R&64&&hd(S),Os(S,S.return);break;case 27:cp(S);case 26:case 5:go(b,S,c),c&&p===null&&R&4&&op(S),Os(S,S.return);break;case 12:go(b,S,c);break;case 31:go(b,S,c),c&&R&4&&ff(b,S);break;case 13:go(b,S,c),c&&R&4&&Su(b,S);break;case 22:S.memoizedState===null&&go(b,S,c),Os(S,S.return);break;case 30:break;default:go(b,S,c)}s=s.sibling}}function Ac(i,s){var c=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==c&&(i!=null&&i.refCount++,c!=null&&Pn(c))}function gh(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Pn(i))}function ss(i,s,c,p){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)gf(i,s,c,p),s=s.sibling}function gf(i,s,c,p){var b=s.flags;switch(s.tag){case 0:case 11:case 15:ss(i,s,c,p),b&2048&&mh(9,s);break;case 1:ss(i,s,c,p);break;case 3:ss(i,s,c,p),b&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Pn(i)));break;case 12:if(b&2048){ss(i,s,c,p),i=s.stateNode;try{var S=s.memoizedProps,R=S.id,X=S.onPostCommit;typeof X=="function"&&X(R,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(he){Ii(s,s.return,he)}}else ss(i,s,c,p);break;case 31:ss(i,s,c,p);break;case 13:ss(i,s,c,p);break;case 23:break;case 22:S=s.stateNode,R=s.alternate,s.memoizedState!==null?S._visibility&2?ss(i,s,c,p):_h(i,s):S._visibility&2?ss(i,s,c,p):(S._visibility|=2,Eu(i,s,c,p,(s.subtreeFlags&10256)!==0||!1)),b&2048&&Ac(R,s);break;case 24:ss(i,s,c,p),b&2048&&gh(s.alternate,s);break;default:ss(i,s,c,p)}}function Eu(i,s,c,p,b){for(b=b&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var S=i,R=s,X=c,he=p,Re=R.flags;switch(R.tag){case 0:case 11:case 15:Eu(S,R,X,he,b),mh(8,R);break;case 23:break;case 22:var Ge=R.stateNode;R.memoizedState!==null?Ge._visibility&2?Eu(S,R,X,he,b):_h(S,R):(Ge._visibility|=2,Eu(S,R,X,he,b)),b&&Re&2048&&Ac(R.alternate,R);break;case 24:Eu(S,R,X,he,b),b&&Re&2048&&gh(R.alternate,R);break;default:Eu(S,R,X,he,b)}s=s.sibling}}function _h(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=i,p=s,b=p.flags;switch(p.tag){case 22:_h(c,p),b&2048&&Ac(p.alternate,p);break;case 24:_h(c,p),b&2048&&gh(p.alternate,p);break;default:_h(c,p)}s=s.sibling}}var yh=8192;function Au(i,s,c){if(i.subtreeFlags&yh)for(i=i.child;i!==null;)up(i,s,c),i=i.sibling}function up(i,s,c){switch(i.tag){case 26:Au(i,s,c),i.flags&yh&&i.memoizedState!==null&&B(c,Fa,i.memoizedState,i.memoizedProps);break;case 5:Au(i,s,c);break;case 3:case 4:var p=Fa;Fa=kh(i.stateNode.containerInfo),Au(i,s,c),Fa=p;break;case 22:i.memoizedState===null&&(p=i.alternate,p!==null&&p.memoizedState!==null?(p=yh,yh=16777216,Au(i,s,c),yh=p):Au(i,s,c));break;default:Au(i,s,c)}}function Cc(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function vh(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var p=s[c];xa=p,dp(p,i)}Cc(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)hp(i),i=i.sibling}function hp(i){switch(i.tag){case 0:case 11:case 15:vh(i),i.flags&2048&&Bs(9,i,i.return);break;case 3:vh(i);break;case 12:vh(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&2&&(i.return===null||i.return.tag!==13)?(s._visibility&=-3,xh(i)):vh(i);break;default:vh(i)}}function xh(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var p=s[c];xa=p,dp(p,i)}Cc(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:Bs(8,s,s.return),xh(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,xh(s));break;default:xh(s)}i=i.sibling}}function dp(i,s){for(;xa!==null;){var c=xa;switch(c.tag){case 0:case 11:case 15:Bs(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var p=c.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Pn(c.memoizedState.cache)}if(p=c.child,p!==null)p.return=c,xa=p;else e:for(c=i;xa!==null;){p=xa;var b=p.sibling,S=p.return;if(hf(p),p===c){xa=null;break e}if(b!==null){b.return=S,xa=b;break e}xa=S}}}var fp={getCacheForType:function(i){var s=Fn(hn),c=s.data.get(i);return c===void 0&&(c=i(),s.data.set(i,c)),c},cacheSignal:function(){return Fn(hn).controller.signal}},Zp=typeof WeakMap=="function"?WeakMap:Map,mi=0,Ei=null,ti=null,oi=0,ji=0,wr=null,el=!1,Cu=!1,_f=!1,Or=0,Mn=0,Dl=0,zc=0,yf=0,jr=0,zu=0,Pu=null,Ua=null,pd=!1,bh=0,vf=0,md=1/0,Pc=null,Il=null,$n=0,Rl=null,Du=null,tl=0,gd=0,xf=null,pp=null,il=0,kn=null;function tr(){return(mi&2)!==0&&oi!==0?oi&-oi:Be.T!==null?Ch():cn()}function bf(){if(jr===0)if((oi&536870912)===0||Qt){var i=je;je<<=1,(je&3932160)===0&&(je=262144),jr=i}else jr=536870912;return i=oa.current,i!==null&&(i.flags|=32),jr}function ir(i,s,c){(i===Ei&&(ji===2||ji===9)||i.cancelPendingCommit!==null)&&(Iu(i,0),Ll(i,oi,jr,!1)),Ni(i,c),((mi&2)===0||i!==Ei)&&(i===Ei&&((mi&2)===0&&(zc|=c),Mn===4&&Ll(i,oi,jr,!1)),Ra(i))}function _d(i,s,c){if((mi&6)!==0)throw Error(U(327));var p=!c&&(s&127)===0&&(s&i.expiredLanes)===0||zi(i,s),b=p?Hp(i,s):Tf(i,s,!0),S=p;do{if(b===0){Cu&&!p&&Ll(i,s,0,!1);break}else{if(c=i.current.alternate,S&&!mp(c)){b=Tf(i,s,!1),S=!1;continue}if(b===2){if(S=s,i.errorRecoveryDisabledLanes&S)var R=0;else R=i.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){s=R;e:{var X=i;b=Pu;var he=X.current.memoizedState.isDehydrated;if(he&&(Iu(X,R).flags|=256),R=Tf(X,R,!1),R!==2){if(_f&&!he){X.errorRecoveryDisabledLanes|=S,zc|=S,b=4;break e}S=Ua,Ua=b,S!==null&&(Ua===null?Ua=S:Ua.push.apply(Ua,S))}b=R}if(S=!1,b!==2)continue}}if(b===1){Iu(i,0),Ll(i,s,0,!0);break}e:{switch(p=i,S=b,S){case 0:case 1:throw Error(U(345));case 4:if((s&4194048)!==s)break;case 6:Ll(p,s,jr,!el);break e;case 2:Ua=null;break;case 3:case 5:break;default:throw Error(U(329))}if((s&62914560)===s&&(b=bh+300-pn(),10<b)){if(Ll(p,s,jr,!el),Gt(p,0,!0)!==0)break e;tl=s,p.timeoutHandle=Of(Dc.bind(null,p,c,Ua,Pc,pd,s,jr,zc,zu,el,S,"Throttled",-0,0),b);break e}Dc(p,c,Ua,Pc,pd,s,jr,zc,zu,el,S,null,-0,0)}}break}while(!0);Ra(i)}function Dc(i,s,c,p,b,S,R,X,he,Re,Ge,Ye,Le,Oe){if(i.timeoutHandle=-1,Ye=s.subtreeFlags,Ye&8192||(Ye&16785408)===16785408){Ye={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ft},up(s,S,Ye);var yt=(S&62914560)===S?bh-pn():(S&4194048)===S?vf-pn():0;if(yt=Z(Ye,yt),yt!==null){tl=S,i.cancelPendingCommit=yt(wh.bind(null,i,s,S,c,p,b,R,X,he,Ge,Ye,null,Le,Oe)),Ll(i,S,R,!Re);return}}wh(i,s,S,c,p,b,R,X,he)}function mp(i){for(var s=i;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var p=0;p<c.length;p++){var b=c[p],S=b.getSnapshot;b=b.value;try{if(!Ta(S(),b))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ll(i,s,c,p){s&=~yf,s&=~zc,i.suspendedLanes|=s,i.pingedLanes&=~s,p&&(i.warmLanes|=s),p=i.expirationTimes;for(var b=s;0<b;){var S=31-pe(b),R=1<<S;p[S]=-1,b&=~R}c!==0&&Yi(i,c,s)}function yd(){return(mi&6)===0?(Lu(0),!1):!0}function wf(){if(ti!==null){if(ji===0)var i=ti.return;else i=ti,Ir=ws=null,Cl(i),Rr=null,El=0,i=ti;for(;i!==null;)sp(i.alternate,i),i=i.return;ti=null}}function Iu(i,s){var c=i.timeoutHandle;c!==-1&&(i.timeoutHandle=-1,kp(c)),c=i.cancelPendingCommit,c!==null&&(i.cancelPendingCommit=null,c()),tl=0,wf(),Ei=i,ti=c=Ma(i.current,null),oi=s,ji=0,wr=null,el=!1,Cu=zi(i,s),_f=!1,zu=jr=yf=zc=Dl=Mn=0,Ua=Pu=null,pd=!1,(s&8)!==0&&(s|=s&32);var p=i.entangledLanes;if(p!==0)for(i=i.entanglements,p&=s;0<p;){var b=31-pe(p),S=1<<b;s|=i[b],p&=~S}return Or=s,ko(),c}function gp(i,s){gt=null,Be.H=zl,s===rt||s===Sl?(s=fu(),ji=3):s===du?(s=fu(),ji=4):ji=s===$d?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,wr=s,ti===null&&(Mn=1,xu(i,pa(s,i.current)))}function _p(){var i=oa.current;return i===null?!0:(oi&4194048)===oi?Oi===null:(oi&62914560)===oi||(oi&536870912)!==0?i===Oi:!1}function yp(){var i=Be.H;return Be.H=zl,i===null?zl:i}function vp(){var i=Be.A;return Be.A=fp,i}function vd(){Mn=4,el||(oi&4194048)!==oi&&oa.current!==null||(Cu=!0),(Dl&134217727)===0&&(zc&134217727)===0||Ei===null||Ll(Ei,oi,jr,!1)}function Tf(i,s,c){var p=mi;mi|=2;var b=yp(),S=vp();(Ei!==i||oi!==s)&&(Pc=null,Iu(i,s)),s=!1;var R=Mn;e:do try{if(ji!==0&&ti!==null){var X=ti,he=wr;switch(ji){case 8:wf(),R=6;break e;case 3:case 2:case 9:case 6:oa.current===null&&(s=!0);var Re=ji;if(ji=0,wr=null,Fr(i,X,he,Re),c&&Cu){R=0;break e}break;default:Re=ji,ji=0,wr=null,Fr(i,X,he,Re)}}qp(),R=Mn;break}catch(Ge){gp(i,Ge)}while(!0);return s&&i.shellSuspendCounter++,Ir=ws=null,mi=p,Be.H=b,Be.A=S,ti===null&&(Ei=null,oi=0,ko()),R}function qp(){for(;ti!==null;)xd(ti)}function Hp(i,s){var c=mi;mi|=2;var p=yp(),b=vp();Ei!==i||oi!==s?(Pc=null,md=pn()+500,Iu(i,s)):Cu=zi(i,s);e:do try{if(ji!==0&&ti!==null){s=ti;var S=wr;t:switch(ji){case 1:ji=0,wr=null,Fr(i,s,S,1);break;case 2:case 9:if(ts(S)){ji=0,wr=null,Sf(s);break}s=function(){ji!==2&&ji!==9||Ei!==i||(ji=7),Ra(i)},S.then(s,s);break e;case 3:ji=7;break e;case 4:ji=5;break e;case 7:ts(S)?(ji=0,wr=null,Sf(s)):(ji=0,wr=null,Fr(i,s,S,7));break;case 5:var R=null;switch(ti.tag){case 26:R=ti.memoizedState;case 5:case 27:var X=ti;if(R?k(R):X.stateNode.complete){ji=0,wr=null;var he=X.sibling;if(he!==null)ti=he;else{var Re=X.return;Re!==null?(ti=Re,kl(Re)):ti=null}break t}}ji=0,wr=null,Fr(i,s,S,5);break;case 6:ji=0,wr=null,Fr(i,s,S,6);break;case 8:wf(),Mn=6;break e;default:throw Error(U(462))}}xp();break}catch(Ge){gp(i,Ge)}while(!0);return Ir=ws=null,Be.H=p,Be.A=b,mi=c,ti!==null?0:(Ei=null,oi=0,ko(),Mn)}function xp(){for(;ti!==null&&!qs();)xd(ti)}function xd(i){var s=af(i.alternate,i,Or);i.memoizedProps=i.pendingProps,s===null?kl(i):ti=s}function Sf(i){var s=i,c=s.alternate;switch(s.tag){case 15:case 0:s=sd(c,s,s.pendingProps,s.type,void 0,oi);break;case 11:s=sd(c,s,s.pendingProps,s.type.render,s.ref,oi);break;case 5:Cl(s);default:sp(c,s),s=ti=Qh(s,Or),s=af(c,s,Or)}i.memoizedProps=i.pendingProps,s===null?kl(i):ti=s}function Fr(i,s,c,p){Ir=ws=null,Cl(s),Rr=null,El=0;var b=s.return;try{if(Yd(i,b,s,c,oi)){Mn=1,xu(i,pa(c,i.current)),ti=null;return}}catch(S){if(b!==null)throw ti=b,S;Mn=1,xu(i,pa(c,i.current)),ti=null;return}s.flags&32768?(Qt||p===1?i=!0:Cu||(oi&536870912)!==0?i=!1:(el=i=!0,(p===2||p===9||p===3||p===6)&&(p=oa.current,p!==null&&p.tag===13&&(p.flags|=16384))),Ic(s,i)):kl(s)}function kl(i){var s=i;do{if((s.flags&32768)!==0){Ic(s,el);return}i=s.return;var c=rp(s.alternate,s,Or);if(c!==null){ti=c;return}if(s=s.sibling,s!==null){ti=s;return}ti=s=i}while(s!==null);Mn===0&&(Mn=5)}function Ic(i,s){do{var c=Gp(i.alternate,i);if(c!==null){c.flags&=32767,ti=c;return}if(c=i.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(i=i.sibling,i!==null)){ti=i;return}ti=i=c}while(i!==null);Mn=6,ti=null}function wh(i,s,c,p,b,S,R,X,he){i.cancelPendingCommit=null;do Sh();while($n!==0);if((mi&6)!==0)throw Error(U(327));if(s!==null){if(s===i.current)throw Error(U(177));if(S=s.lanes|s.childLanes,S|=Lo,Gn(i,c,S,R,X,he),i===Ei&&(ti=Ei=null,oi=0),Du=s,Rl=i,tl=c,gd=S,xf=b,pp=p,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,Yp(Hs,function(){return Tp(),null})):(i.callbackNode=null,i.callbackPriority=0),p=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||p){p=Be.T,Be.T=null,b=ot.p,ot.p=2,R=mi,mi|=4;try{Sn(i,s,c)}finally{mi=R,ot.p=b,Be.T=p}}$n=1,Th(),bp(),wp()}}function Th(){if($n===1){$n=0;var i=Rl,s=Du,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=Be.T,Be.T=null;var p=ot.p;ot.p=2;var b=mi;mi|=4;try{Mu(s,i);var S=Pd,R=ec(i.containerInfo),X=S.focusedElem,he=S.selectionRange;if(R!==X&&X&&X.ownerDocument&&Jc(X.ownerDocument.documentElement,X)){if(he!==null&&eu(X)){var Re=he.start,Ge=he.end;if(Ge===void 0&&(Ge=Re),"selectionStart"in X)X.selectionStart=Re,X.selectionEnd=Math.min(Ge,X.value.length);else{var Ye=X.ownerDocument||document,Le=Ye&&Ye.defaultView||window;if(Le.getSelection){var Oe=Le.getSelection(),yt=X.textContent.length,kt=Math.min(he.start,yt),Xi=he.end===void 0?kt:Math.min(he.end,yt);!Oe.extend&&kt>Xi&&(R=Xi,Xi=kt,kt=R);var Te=Qc(X,kt),ve=Qc(X,Xi);if(Te&&ve&&(Oe.rangeCount!==1||Oe.anchorNode!==Te.node||Oe.anchorOffset!==Te.offset||Oe.focusNode!==ve.node||Oe.focusOffset!==ve.offset)){var Ee=Ye.createRange();Ee.setStart(Te.node,Te.offset),Oe.removeAllRanges(),kt>Xi?(Oe.addRange(Ee),Oe.extend(ve.node,ve.offset)):(Ee.setEnd(ve.node,ve.offset),Oe.addRange(Ee))}}}}for(Ye=[],Oe=X;Oe=Oe.parentNode;)Oe.nodeType===1&&Ye.push({element:Oe,left:Oe.scrollLeft,top:Oe.scrollTop});for(typeof X.focus=="function"&&X.focus(),X=0;X<Ye.length;X++){var qe=Ye[X];qe.element.scrollLeft=qe.left,qe.element.scrollTop=qe.top}}tt=!!zd,Pd=zd=null}finally{mi=b,ot.p=p,Be.T=c}}i.current=s,$n=2}}function bp(){if($n===2){$n=0;var i=Rl,s=Du,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=Be.T,Be.T=null;var p=ot.p;ot.p=2;var b=mi;mi|=4;try{Mc(i,s.alternate,s)}finally{mi=b,ot.p=p,Be.T=c}}$n=3}}function wp(){if($n===4||$n===3){$n=0,Vr();var i=Rl,s=Du,c=tl,p=pp;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?$n=5:($n=0,Du=Rl=null,Mf(i,i.pendingLanes));var b=i.pendingLanes;if(b===0&&(Il=null),Ve(c),s=s.stateNode,ie&&typeof ie.onCommitFiberRoot=="function")try{ie.onCommitFiberRoot(Y,s,void 0,(s.current.flags&128)===128)}catch{}if(p!==null){s=Be.T,b=ot.p,ot.p=2,Be.T=null;try{for(var S=i.onRecoverableError,R=0;R<p.length;R++){var X=p[R];S(X.value,{componentStack:X.stack})}}finally{Be.T=s,ot.p=b}}(tl&3)!==0&&Sh(),Ra(i),b=i.pendingLanes,(c&261930)!==0&&(b&42)!==0?i===kn?il++:(il=0,kn=i):il=0,Lu(0)}}function Mf(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,Pn(s)))}function Sh(){return Th(),bp(),wp(),Tp()}function Tp(){if($n!==5)return!1;var i=Rl,s=gd;gd=0;var c=Ve(tl),p=Be.T,b=ot.p;try{ot.p=32>c?32:c,Be.T=null,c=xf,xf=null;var S=Rl,R=tl;if($n=0,Du=Rl=null,tl=0,(mi&6)!==0)throw Error(U(331));var X=mi;if(mi|=4,hp(S.current),gf(S,S.current,R,c),mi=X,Lu(0,!1),ie&&typeof ie.onPostCommitFiberRoot=="function")try{ie.onPostCommitFiberRoot(Y,S)}catch{}return!0}finally{ot.p=b,Be.T=p,Mf(i,s)}}function Ef(i,s,c){s=pa(c,s),s=bu(i.stateNode,s,2),i=Cs(i,s,2),i!==null&&(Ni(i,2),Ra(i))}function Ii(i,s,c){if(i.tag===3)Ef(i,i,c);else for(;s!==null;){if(s.tag===3){Ef(s,i,c);break}else if(s.tag===1){var p=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Il===null||!Il.has(p))){i=pa(c,i),c=Xd(2),p=Cs(s,c,2),p!==null&&(ip(c,p,s,i),Ni(p,2),Ra(p));break}}s=s.return}}function Mh(i,s,c){var p=i.pingCache;if(p===null){p=i.pingCache=new Zp;var b=new Set;p.set(s,b)}else b=p.get(s),b===void 0&&(b=new Set,p.set(s,b));b.has(c)||(_f=!0,b.add(c),i=Af.bind(null,i,s,c),s.then(i,i))}function Af(i,s,c){var p=i.pingCache;p!==null&&p.delete(s),i.pingedLanes|=i.suspendedLanes&c,i.warmLanes&=~c,Ei===i&&(oi&c)===c&&(Mn===4||Mn===3&&(oi&62914560)===oi&&300>pn()-bh?(mi&2)===0&&Iu(i,0):yf|=c,zu===oi&&(zu=0)),Ra(i)}function Sp(i,s){s===0&&(s=qt()),i=gr(i,s),i!==null&&(Ni(i,s),Ra(i))}function Mp(i){var s=i.memoizedState,c=0;s!==null&&(c=s.retryLane),Sp(i,c)}function Xp(i,s){var c=0;switch(i.tag){case 31:case 13:var p=i.stateNode,b=i.memoizedState;b!==null&&(c=b.retryLane);break;case 19:p=i.stateNode;break;case 22:p=i.stateNode._retryCache;break;default:throw Error(U(314))}p!==null&&p.delete(s),Sp(i,c)}function Yp(i,s){return Gs(i,s)}var bd=null,Ru=null,Cf=!1,Eh=!1,wd=!1,Na=0;function Ra(i){i!==Ru&&i.next===null&&(Ru===null?bd=Ru=i:Ru=Ru.next=i),Eh=!0,Cf||(Cf=!0,Pf())}function Lu(i,s){if(!wd&&Eh){wd=!0;do for(var c=!1,p=bd;p!==null;){if(i!==0){var b=p.pendingLanes;if(b===0)var S=0;else{var R=p.suspendedLanes,X=p.pingedLanes;S=(1<<31-pe(42|i)+1)-1,S&=b&~(R&~X),S=S&201326741?S&201326741|1:S?S|2:0}S!==0&&(c=!0,Ap(p,S))}else S=oi,S=Gt(p,p===Ei?S:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(S&3)===0||zi(p,S)||(c=!0,Ap(p,S));p=p.next}while(c);wd=!1}}function zf(){Ep()}function Ep(){Eh=Cf=!1;var i=0;Na!==0&&Lp()&&(i=Na);for(var s=pn(),c=null,p=bd;p!==null;){var b=p.next,S=Ah(p,s);S===0?(p.next=null,c===null?bd=b:c.next=b,b===null&&(Ru=c)):(c=p,(i!==0||(S&3)!==0)&&(Eh=!0)),p=b}$n!==0&&$n!==5||Lu(i),Na!==0&&(Na=0)}function Ah(i,s){for(var c=i.suspendedLanes,p=i.pingedLanes,b=i.expirationTimes,S=i.pendingLanes&-62914561;0<S;){var R=31-pe(S),X=1<<R,he=b[R];he===-1?((X&c)===0||(X&p)!==0)&&(b[R]=vt(X,s)):he<=s&&(i.expiredLanes|=X),S&=~X}if(s=Ei,c=oi,c=Gt(i,i===s?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),p=i.callbackNode,c===0||i===s&&(ji===2||ji===9)||i.cancelPendingCommit!==null)return p!==null&&p!==null&&Zs(p),i.callbackNode=null,i.callbackPriority=0;if((c&3)===0||zi(i,c)){if(s=c&-c,s===i.callbackPriority)return s;switch(p!==null&&Zs(p),Ve(c)){case 2:case 8:c=cl;break;case 32:c=Hs;break;case 268435456:c=ge;break;default:c=Hs}return p=Td.bind(null,i),c=Gs(c,p),i.callbackPriority=s,i.callbackNode=c,s}return p!==null&&p!==null&&Zs(p),i.callbackPriority=2,i.callbackNode=null,2}function Td(i,s){if($n!==0&&$n!==5)return i.callbackNode=null,i.callbackPriority=0,null;var c=i.callbackNode;if(Sh()&&i.callbackNode!==c)return null;var p=oi;return p=Gt(i,i===Ei?p:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),p===0?null:(_d(i,p,s),Ah(i,pn()),i.callbackNode!=null&&i.callbackNode===c?Td.bind(null,i):null)}function Ap(i,s){if(Sh())return null;_d(i,s,!0)}function Pf(){Kp(function(){(mi&6)!==0?Gs(sr,zf):Ep()})}function Ch(){if(Na===0){var i=Dn;i===0&&(i=He,He<<=1,(He&261888)===0&&(He=256)),Na=i}return Na}function Rc(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Dt(""+i)}function Df(i,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,i.id&&c.setAttribute("form",i.id),s.parentNode.insertBefore(c,s),i=new FormData(i),c.parentNode.removeChild(c),i}function Cp(i,s,c,p,b){if(s==="submit"&&c&&c.stateNode===b){var S=Rc((b[$e]||null).action),R=p.submitter;R&&(s=(s=R[$e]||null)?Rc(s.formAction):R.getAttribute("formAction"),s!==null&&(S=s,R=null));var X=new Ut("action","action",null,p,b);i.push({event:X,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Na!==0){var he=R?Df(b,R):new FormData(b);Is(c,{pending:!0,data:he,method:b.method,action:S},null,he)}}else typeof S=="function"&&(X.preventDefault(),he=R?Df(b,R):new FormData(b),Is(c,{pending:!0,data:he,method:b.method,action:S},S,he))},currentTarget:b}]})}}for(var zh=0;zh<iu.length;zh++){var Sd=iu[zh],Md=Sd.toLowerCase(),zp=Sd[0].toUpperCase()+Sd.slice(1);Xa(Md,"on"+zp)}Xa(ic,"onAnimationEnd"),Xa(nc,"onAnimationIteration"),Xa(tu,"onAnimationStart"),Xa("dblclick","onDoubleClick"),Xa("focusin","onFocus"),Xa("focusout","onBlur"),Xa(Ro,"onTransitionRun"),Xa(ac,"onTransitionStart"),Xa(xl,"onTransitionCancel"),Xa(Ha,"onTransitionEnd"),Cr("onMouseEnter",["mouseout","mouseover"]),Cr("onMouseLeave",["mouseout","mouseover"]),Cr("onPointerEnter",["pointerout","pointerover"]),Cr("onPointerLeave",["pointerout","pointerover"]),yi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),yi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),yi("onBeforeInput",["compositionend","keypress","textInput","paste"]),yi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),yi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),yi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ph="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$p=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ph));function Pp(i,s){s=(s&4)!==0;for(var c=0;c<i.length;c++){var p=i[c],b=p.event;p=p.listeners;e:{var S=void 0;if(s)for(var R=p.length-1;0<=R;R--){var X=p[R],he=X.instance,Re=X.currentTarget;if(X=X.listener,he!==S&&b.isPropagationStopped())break e;S=X,b.currentTarget=Re;try{S(b)}catch(Ge){$r(Ge)}b.currentTarget=null,S=he}else for(R=0;R<p.length;R++){if(X=p[R],he=X.instance,Re=X.currentTarget,X=X.listener,he!==S&&b.isPropagationStopped())break e;S=X,b.currentTarget=Re;try{S(b)}catch(Ge){$r(Ge)}b.currentTarget=null,S=he}}}}function si(i,s){var c=s[Zt];c===void 0&&(c=s[Zt]=new Set);var p=i+"__bubble";c.has(p)||(Rf(s,i,2,!1),c.add(p))}function If(i,s,c){var p=0;s&&(p|=4),Rf(c,i,p,s)}var ku="_reactListening"+Math.random().toString(36).slice(2);function _o(i){if(!i[ku]){i[ku]=!0,Nl.forEach(function(c){c!=="selectionchange"&&($p.has(c)||If(c,!1,i),If(c,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[ku]||(s[ku]=!0,If("selectionchange",!1,s))}}function Rf(i,s,c,p){switch(rn(s)){case 2:var b=Ue;break;case 8:b=Mt;break;default:b=zt}c=b.bind(null,s,c,i),b=void 0,!aa||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),p?b!==void 0?i.addEventListener(s,c,{capture:!0,passive:b}):i.addEventListener(s,c,!0):b!==void 0?i.addEventListener(s,c,{passive:b}):i.addEventListener(s,c,!1)}function Ed(i,s,c,p,b){var S=p;if((s&1)===0&&(s&2)===0&&p!==null)e:for(;;){if(p===null)return;var R=p.tag;if(R===3||R===4){var X=p.stateNode.containerInfo;if(X===b)break;if(R===4)for(R=p.return;R!==null;){var he=R.tag;if((he===3||he===4)&&R.stateNode.containerInfo===b)return;R=R.return}for(;X!==null;){if(R=or(X),R===null)return;if(he=R.tag,he===5||he===6||he===26||he===27){p=S=R;continue e}X=X.parentNode}}p=p.return}Bi(function(){var Re=S,Ge=cr(c),Ye=[];e:{var Le=nh.get(i);if(Le!==void 0){var Oe=Ut,yt=i;switch(i){case"keypress":if(zr(c)===0)break e;case"keydown":case"keyup":Oe=gs;break;case"focusin":yt="focus",Oe=Ao;break;case"focusout":yt="blur",Oe=Ao;break;case"beforeblur":case"afterblur":Oe=Ao;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Oe=ml;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Oe=Vc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Oe=Hc;break;case ic:case nc:case tu:Oe=Ws;break;case Ha:Oe=Pr;break;case"scroll":case"scrollend":Oe=ei;break;case"wheel":Oe=_l;break;case"copy":case"cut":case"paste":Oe=Hl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Oe=Zh;break;case"toggle":case"beforetoggle":Oe=Kl}var kt=(s&4)!==0,Xi=!kt&&(i==="scroll"||i==="scrollend"),Te=kt?Le!==null?Le+"Capture":null:Le;kt=[];for(var ve=Re,Ee;ve!==null;){var qe=ve;if(Ee=qe.stateNode,qe=qe.tag,qe!==5&&qe!==26&&qe!==27||Ee===null||Te===null||(qe=pl(ve,Te),qe!=null&&kt.push(Bu(ve,qe,Ee))),Xi)break;ve=ve.return}0<kt.length&&(Le=new Oe(Le,yt,null,c,Ge),Ye.push({event:Le,listeners:kt}))}}if((s&7)===0){e:{if(Le=i==="mouseover"||i==="pointerover",Oe=i==="mouseout"||i==="pointerout",Le&&c!==Ys&&(yt=c.relatedTarget||c.fromElement)&&(or(yt)||yt[It]))break e;if((Oe||Le)&&(Le=Ge.window===Ge?Ge:(Le=Ge.ownerDocument)?Le.defaultView||Le.parentWindow:window,Oe?(yt=c.relatedTarget||c.toElement,Oe=Re,yt=yt?or(yt):null,yt!==null&&(Xi=le(yt),kt=yt.tag,yt!==Xi||kt!==5&&kt!==27&&kt!==6)&&(yt=null)):(Oe=null,yt=Re),Oe!==yt)){if(kt=ml,qe="onMouseLeave",Te="onMouseEnter",ve="mouse",(i==="pointerout"||i==="pointerover")&&(kt=Zh,qe="onPointerLeave",Te="onPointerEnter",ve="pointer"),Xi=Oe==null?Le:lr(Oe),Ee=yt==null?Le:lr(yt),Le=new kt(qe,ve+"leave",Oe,c,Ge),Le.target=Xi,Le.relatedTarget=Ee,qe=null,or(Ge)===Re&&(kt=new kt(Te,ve+"enter",yt,c,Ge),kt.target=Ee,kt.relatedTarget=Xi,qe=kt),Xi=qe,Oe&&yt)t:{for(kt=Dp,Te=Oe,ve=yt,Ee=0,qe=Te;qe;qe=kt(qe))Ee++;qe=0;for(var At=ve;At;At=kt(At))qe++;for(;0<Ee-qe;)Te=kt(Te),Ee--;for(;0<qe-Ee;)ve=kt(ve),qe--;for(;Ee--;){if(Te===ve||ve!==null&&Te===ve.alternate){kt=Te;break t}Te=kt(Te),ve=kt(ve)}kt=null}else kt=null;Oe!==null&&Lf(Ye,Le,Oe,kt,!1),yt!==null&&Xi!==null&&Lf(Ye,Xi,yt,kt,!0)}}e:{if(Le=Re?lr(Re):window,Oe=Le.nodeName&&Le.nodeName.toLowerCase(),Oe==="select"||Oe==="input"&&Le.type==="file")var vi=Qs;else if(Yu(Le))if(Ku)vi=Kh;else{vi=Wc;var bt=qd}else Oe=Le.nodeName,!Oe||Oe.toLowerCase()!=="input"||Le.type!=="checkbox"&&Le.type!=="radio"?Re&&Gu(Re.elementType)&&(vi=Qs):vi=Wu;if(vi&&(vi=vi(i,Re))){$c(Ye,vi,c,Ge);break e}bt&&bt(i,Le,Re),i==="focusout"&&Re&&Le.type==="number"&&Re.memoizedProps.value!=null&&Zl(Le,"number",Le.value)}switch(bt=Re?lr(Re):window,i){case"focusin":(Yu(bt)||bt.contentEditable==="true")&&(mr=bt,tc=Re,ni=null);break;case"focusout":ni=tc=mr=null;break;case"mousedown":eh=!0;break;case"contextmenu":case"mouseup":case"dragend":eh=!1,Wh(Ye,c,Ge);break;case"selectionchange":if(Ju)break;case"keydown":case"keyup":Wh(Ye,c,Ge)}var Wt;if(fr)e:{switch(i){case"compositionstart":var Rt="onCompositionStart";break e;case"compositionend":Rt="onCompositionEnd";break e;case"compositionupdate":Rt="onCompositionUpdate";break e}Rt=void 0}else pr?vl(i,c)&&(Rt="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(Rt="onCompositionStart");Rt&&(_s&&c.locale!=="ko"&&(pr||Rt!=="onCompositionStart"?Rt==="onCompositionEnd"&&pr&&(Wt=Eo()):(ur=Ge,hr="value"in ur?ur.value:ur.textContent,pr=!0)),bt=Dh(Re,Rt),0<bt.length&&(Rt=new Xl(Rt,i,null,c,Ge),Ye.push({event:Rt,listeners:bt}),Wt?Rt.data=Wt:(Wt=Hh(c),Wt!==null&&(Rt.data=Wt)))),(Wt=Hu?Gd(i,c):Xh(i,c))&&(Rt=Dh(Re,"onBeforeInput"),0<Rt.length&&(bt=new Xl("onBeforeInput","beforeinput",null,c,Ge),Ye.push({event:bt,listeners:Rt}),bt.data=Wt)),Cp(Ye,i,Re,c,Ge)}Pp(Ye,s)})}function Bu(i,s,c){return{instance:i,listener:s,currentTarget:c}}function Dh(i,s){for(var c=s+"Capture",p=[];i!==null;){var b=i,S=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||S===null||(b=pl(i,c),b!=null&&p.unshift(Bu(i,b,S)),b=pl(i,s),b!=null&&p.push(Bu(i,b,S))),i.tag===3)return p;i=i.return}return[]}function Dp(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Lf(i,s,c,p,b){for(var S=s._reactName,R=[];c!==null&&c!==p;){var X=c,he=X.alternate,Re=X.stateNode;if(X=X.tag,he!==null&&he===p)break;X!==5&&X!==26&&X!==27||Re===null||(he=Re,b?(Re=pl(c,S),Re!=null&&R.unshift(Bu(c,Re,he))):b||(Re=pl(c,S),Re!=null&&R.push(Bu(c,Re,he)))),c=c.return}R.length!==0&&i.push({event:s,listeners:R})}var Ad=/\r\n?/g,Ip=/\u0000|\uFFFD/g;function Ou(i){return(typeof i=="string"?i:""+i).replace(Ad,`
`).replace(Ip,"")}function kf(i,s){return s=Ou(s),Ou(i)===s}function Ri(i,s,c,p,b,S){switch(c){case"children":typeof p=="string"?s==="body"||s==="textarea"&&p===""||ds(i,p):(typeof p=="number"||typeof p=="bigint")&&s!=="body"&&ds(i,""+p);break;case"className":ul(i,"class",p);break;case"tabIndex":ul(i,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":ul(i,c,p);break;case"style":Vu(i,p,S);break;case"data":if(s!=="object"){ul(i,"data",p);break}case"src":case"href":if(p===""&&(s!=="a"||c!=="href")){i.removeAttribute(c);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){i.removeAttribute(c);break}p=Dt(""+p),i.setAttribute(c,p);break;case"action":case"formAction":if(typeof p=="function"){i.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(c==="formAction"?(s!=="input"&&Ri(i,s,"name",b.name,b,null),Ri(i,s,"formEncType",b.formEncType,b,null),Ri(i,s,"formMethod",b.formMethod,b,null),Ri(i,s,"formTarget",b.formTarget,b,null)):(Ri(i,s,"encType",b.encType,b,null),Ri(i,s,"method",b.method,b,null),Ri(i,s,"target",b.target,b,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){i.removeAttribute(c);break}p=Dt(""+p),i.setAttribute(c,p);break;case"onClick":p!=null&&(i.onclick=Ft);break;case"onScroll":p!=null&&si("scroll",i);break;case"onScrollEnd":p!=null&&si("scrollend",i);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(U(61));if(c=p.__html,c!=null){if(b.children!=null)throw Error(U(60));i.innerHTML=c}}break;case"multiple":i.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":i.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){i.removeAttribute("xlink:href");break}c=Dt(""+p),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(c,""+p):i.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(c,""):i.removeAttribute(c);break;case"capture":case"download":p===!0?i.setAttribute(c,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(c,p):i.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?i.setAttribute(c,p):i.removeAttribute(c);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?i.removeAttribute(c):i.setAttribute(c,p);break;case"popover":si("beforetoggle",i),si("toggle",i),us(i,"popover",p);break;case"xlinkActuate":Zr(i,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Zr(i,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Zr(i,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Zr(i,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Zr(i,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Zr(i,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Zr(i,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Zr(i,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Zr(i,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":us(i,"is",p);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=fs.get(c)||c,us(i,c,p))}}function Cd(i,s,c,p,b,S){switch(c){case"style":Vu(i,p,S);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(U(61));if(c=p.__html,c!=null){if(b.children!=null)throw Error(U(60));i.innerHTML=c}}break;case"children":typeof p=="string"?ds(i,p):(typeof p=="number"||typeof p=="bigint")&&ds(i,""+p);break;case"onScroll":p!=null&&si("scroll",i);break;case"onScrollEnd":p!=null&&si("scrollend",i);break;case"onClick":p!=null&&(i.onclick=Ft);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ia.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),s=c.slice(2,b?c.length-7:void 0),S=i[$e]||null,S=S!=null?S[c]:null,typeof S=="function"&&i.removeEventListener(s,S,b),typeof p=="function")){typeof S!="function"&&S!==null&&(c in i?i[c]=null:i.hasAttribute(c)&&i.removeAttribute(c)),i.addEventListener(s,p,b);break e}c in i?i[c]=p:p===!0?i.setAttribute(c,""):us(i,c,p)}}}function Fi(i,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":si("error",i),si("load",i);var p=!1,b=!1,S;for(S in c)if(c.hasOwnProperty(S)){var R=c[S];if(R!=null)switch(S){case"src":p=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(U(137,s));default:Ri(i,s,S,R,c,null)}}b&&Ri(i,s,"srcSet",c.srcSet,c,null),p&&Ri(i,s,"src",c.src,c,null);return;case"input":si("invalid",i);var X=S=R=b=null,he=null,Re=null;for(p in c)if(c.hasOwnProperty(p)){var Ge=c[p];if(Ge!=null)switch(p){case"name":b=Ge;break;case"type":R=Ge;break;case"checked":he=Ge;break;case"defaultChecked":Re=Ge;break;case"value":S=Ge;break;case"defaultValue":X=Ge;break;case"children":case"dangerouslySetInnerHTML":if(Ge!=null)throw Error(U(137,s));break;default:Ri(i,s,p,Ge,c,null)}}Nu(i,S,X,he,Re,R,b,!1);return;case"select":si("invalid",i),p=R=S=null;for(b in c)if(c.hasOwnProperty(b)&&(X=c[b],X!=null))switch(b){case"value":S=X;break;case"defaultValue":R=X;break;case"multiple":p=X;default:Ri(i,s,b,X,c,null)}s=S,c=R,i.multiple=!!p,s!=null?hs(i,!!p,s,!1):c!=null&&hs(i,!!p,c,!0);return;case"textarea":si("invalid",i),S=b=p=null;for(R in c)if(c.hasOwnProperty(R)&&(X=c[R],X!=null))switch(R){case"value":p=X;break;case"defaultValue":b=X;break;case"children":S=X;break;case"dangerouslySetInnerHTML":if(X!=null)throw Error(U(91));break;default:Ri(i,s,R,X,c,null)}dl(i,p,b,S);return;case"option":for(he in c)if(c.hasOwnProperty(he)&&(p=c[he],p!=null))switch(he){case"selected":i.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:Ri(i,s,he,p,c,null)}return;case"dialog":si("beforetoggle",i),si("toggle",i),si("cancel",i),si("close",i);break;case"iframe":case"object":si("load",i);break;case"video":case"audio":for(p=0;p<Ph.length;p++)si(Ph[p],i);break;case"image":si("error",i),si("load",i);break;case"details":si("toggle",i);break;case"embed":case"source":case"link":si("error",i),si("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Re in c)if(c.hasOwnProperty(Re)&&(p=c[Re],p!=null))switch(Re){case"children":case"dangerouslySetInnerHTML":throw Error(U(137,s));default:Ri(i,s,Re,p,c,null)}return;default:if(Gu(s)){for(Ge in c)c.hasOwnProperty(Ge)&&(p=c[Ge],p!==void 0&&Cd(i,s,Ge,p,c,void 0));return}}for(X in c)c.hasOwnProperty(X)&&(p=c[X],p!=null&&Ri(i,s,X,p,c,null))}function ju(i,s,c,p){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,S=null,R=null,X=null,he=null,Re=null,Ge=null;for(Oe in c){var Ye=c[Oe];if(c.hasOwnProperty(Oe)&&Ye!=null)switch(Oe){case"checked":break;case"value":break;case"defaultValue":he=Ye;default:p.hasOwnProperty(Oe)||Ri(i,s,Oe,null,p,Ye)}}for(var Le in p){var Oe=p[Le];if(Ye=c[Le],p.hasOwnProperty(Le)&&(Oe!=null||Ye!=null))switch(Le){case"type":S=Oe;break;case"name":b=Oe;break;case"checked":Re=Oe;break;case"defaultChecked":Ge=Oe;break;case"value":R=Oe;break;case"defaultValue":X=Oe;break;case"children":case"dangerouslySetInnerHTML":if(Oe!=null)throw Error(U(137,s));break;default:Oe!==Ye&&Ri(i,s,Le,Oe,p,Ye)}}Gl(i,R,X,he,Re,Ge,S,b);return;case"select":Oe=R=X=Le=null;for(S in c)if(he=c[S],c.hasOwnProperty(S)&&he!=null)switch(S){case"value":break;case"multiple":Oe=he;default:p.hasOwnProperty(S)||Ri(i,s,S,null,p,he)}for(b in p)if(S=p[b],he=c[b],p.hasOwnProperty(b)&&(S!=null||he!=null))switch(b){case"value":Le=S;break;case"defaultValue":X=S;break;case"multiple":R=S;default:S!==he&&Ri(i,s,b,S,p,he)}s=X,c=R,p=Oe,Le!=null?hs(i,!!c,Le,!1):!!p!=!!c&&(s!=null?hs(i,!!c,s,!0):hs(i,!!c,c?[]:"",!1));return;case"textarea":Oe=Le=null;for(X in c)if(b=c[X],c.hasOwnProperty(X)&&b!=null&&!p.hasOwnProperty(X))switch(X){case"value":break;case"children":break;default:Ri(i,s,X,null,p,b)}for(R in p)if(b=p[R],S=c[R],p.hasOwnProperty(R)&&(b!=null||S!=null))switch(R){case"value":Le=b;break;case"defaultValue":Oe=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(U(91));break;default:b!==S&&Ri(i,s,R,b,p,S)}hl(i,Le,Oe);return;case"option":for(var yt in c)if(Le=c[yt],c.hasOwnProperty(yt)&&Le!=null&&!p.hasOwnProperty(yt))switch(yt){case"selected":i.selected=!1;break;default:Ri(i,s,yt,null,p,Le)}for(he in p)if(Le=p[he],Oe=c[he],p.hasOwnProperty(he)&&Le!==Oe&&(Le!=null||Oe!=null))switch(he){case"selected":i.selected=Le&&typeof Le!="function"&&typeof Le!="symbol";break;default:Ri(i,s,he,Le,p,Oe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var kt in c)Le=c[kt],c.hasOwnProperty(kt)&&Le!=null&&!p.hasOwnProperty(kt)&&Ri(i,s,kt,null,p,Le);for(Re in p)if(Le=p[Re],Oe=c[Re],p.hasOwnProperty(Re)&&Le!==Oe&&(Le!=null||Oe!=null))switch(Re){case"children":case"dangerouslySetInnerHTML":if(Le!=null)throw Error(U(137,s));break;default:Ri(i,s,Re,Le,p,Oe)}return;default:if(Gu(s)){for(var Xi in c)Le=c[Xi],c.hasOwnProperty(Xi)&&Le!==void 0&&!p.hasOwnProperty(Xi)&&Cd(i,s,Xi,void 0,p,Le);for(Ge in p)Le=p[Ge],Oe=c[Ge],!p.hasOwnProperty(Ge)||Le===Oe||Le===void 0&&Oe===void 0||Cd(i,s,Ge,Le,p,Oe);return}}for(var Te in c)Le=c[Te],c.hasOwnProperty(Te)&&Le!=null&&!p.hasOwnProperty(Te)&&Ri(i,s,Te,null,p,Le);for(Ye in p)Le=p[Ye],Oe=c[Ye],!p.hasOwnProperty(Ye)||Le===Oe||Le==null&&Oe==null||Ri(i,s,Ye,Le,p,Oe)}function Fu(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Lc(){if(typeof performance.getEntriesByType=="function"){for(var i=0,s=0,c=performance.getEntriesByType("resource"),p=0;p<c.length;p++){var b=c[p],S=b.transferSize,R=b.initiatorType,X=b.duration;if(S&&X&&Fu(R)){for(R=0,X=b.responseEnd,p+=1;p<c.length;p++){var he=c[p],Re=he.startTime;if(Re>X)break;var Ge=he.transferSize,Ye=he.initiatorType;Ge&&Fu(Ye)&&(he=he.responseEnd,R+=Ge*(he<X?1:(X-Re)/(he-Re)))}if(--p,s+=8*(S+R)/(b.duration/1e3),i++,10<i)break}}if(0<i)return s/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var zd=null,Pd=null;function Ih(i){return i.nodeType===9?i:i.ownerDocument}function Bf(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Rp(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function Dd(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var yo=null;function Lp(){var i=window.event;return i&&i.type==="popstate"?i===yo?!1:(yo=i,!0):(yo=null,!1)}var Of=typeof setTimeout=="function"?setTimeout:void 0,kp=typeof clearTimeout=="function"?clearTimeout:void 0,jf=typeof Promise=="function"?Promise:void 0,Kp=typeof queueMicrotask=="function"?queueMicrotask:typeof jf<"u"?function(i){return jf.resolve(null).then(i).catch(Wp)}:Of;function Wp(i){setTimeout(function(){throw i})}function nl(i){return i==="head"}function Ff(i,s){var c=s,p=0;do{var b=c.nextSibling;if(i.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(p===0){i.removeChild(b),Va(s);return}p--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")p++;else if(c==="html")kc(i.ownerDocument.documentElement);else if(c==="head"){c=i.ownerDocument.head,kc(c);for(var S=c.firstChild;S;){var R=S.nextSibling,X=S.nodeName;S[Bt]||X==="SCRIPT"||X==="STYLE"||X==="LINK"&&S.rel.toLowerCase()==="stylesheet"||c.removeChild(S),S=R}}else c==="body"&&kc(i.ownerDocument.body);c=b}while(c);Va(s)}function Rh(i,s){var c=i;i=0;do{var p=c.nextSibling;if(c.nodeType===1?s?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(s?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),p&&p.nodeType===8)if(c=p.data,c==="/$"){if(i===0)break;i--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||i++;c=p}while(c)}function Id(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Id(c),wo(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}i.removeChild(c)}}function Rd(i,s,c,p){for(;i.nodeType===1;){var b=c;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!p&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(p){if(!i[Bt])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(S=i.getAttribute("rel"),S==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(S!==b.rel||i.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||i.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||i.getAttribute("title")!==(b.title==null?null:b.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(S=i.getAttribute("src"),(S!==(b.src==null?null:b.src)||i.getAttribute("type")!==(b.type==null?null:b.type)||i.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&S&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var S=b.name==null?null:""+b.name;if(b.type==="hidden"&&i.getAttribute("name")===S)return i}else return i;if(i=La(i.nextSibling),i===null)break}return null}function Ld(i,s,c){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!c||(i=La(i.nextSibling),i===null))return null;return i}function Lh(i,s){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!s||(i=La(i.nextSibling),i===null))return null;return i}function Uf(i){return i.data==="$?"||i.data==="$~"}function Nf(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function Qp(i,s){var c=i.ownerDocument;if(i.data==="$~")i._reactRetry=s;else if(i.data!=="$?"||c.readyState!=="loading")s();else{var p=function(){s(),c.removeEventListener("DOMContentLoaded",p)};c.addEventListener("DOMContentLoaded",p),i._reactRetry=p}}function La(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return i}var Kn=null;function kd(i){i=i.nextSibling;for(var s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="/$"||c==="/&"){if(s===0)return La(i.nextSibling);s--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||s++}i=i.nextSibling}return null}function Vf(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(s===0)return i;s--}else c!=="/$"&&c!=="/&"||s++}i=i.previousSibling}return null}function Gf(i,s,c){switch(s=Ih(c),i){case"html":if(i=s.documentElement,!i)throw Error(U(452));return i;case"head":if(i=s.head,!i)throw Error(U(453));return i;case"body":if(i=s.body,!i)throw Error(U(454));return i;default:throw Error(U(451))}}function kc(i){for(var s=i.attributes;s.length;)i.removeAttributeNode(s[0]);wo(i)}var os=new Map,Zf=new Set;function kh(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var al=ot.d;ot.d={f:Bp,r:qf,D:Bh,C:Xf,L:Op,m:Yf,X:Oh,S:Bd,M:$f};function Bp(){var i=al.f(),s=yd();return i||s}function qf(i){var s=wa(i);s!==null&&s.tag===5&&s.type==="form"?ho(s):al.r(i)}var Bl=typeof document>"u"?null:document;function Hf(i,s,c){var p=Bl;if(p&&typeof s=="string"&&s){var b=ka(s);b='link[rel="'+i+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),Zf.has(b)||(Zf.add(b),i={rel:i,crossOrigin:c,href:s},p.querySelector(b)===null&&(s=p.createElement("link"),Fi(s,"link",i),en(s),p.head.appendChild(s)))}}function Bh(i){al.D(i),Hf("dns-prefetch",i,null)}function Xf(i,s){al.C(i,s),Hf("preconnect",i,s)}function Op(i,s,c){al.L(i,s,c);var p=Bl;if(p&&i&&s){var b='link[rel="preload"][as="'+ka(s)+'"]';s==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+ka(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+ka(c.imageSizes)+'"]')):b+='[href="'+ka(i)+'"]';var S=b;switch(s){case"style":S=Ol(i);break;case"script":S=n(i)}os.has(S)||(i=Ne({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:i,as:s},c),os.set(S,i),p.querySelector(b)!==null||s==="style"&&p.querySelector(jh(S))||s==="script"&&p.querySelector(o(S))||(s=p.createElement("link"),Fi(s,"link",i),en(s),p.head.appendChild(s)))}}function Yf(i,s){al.m(i,s);var c=Bl;if(c&&i){var p=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+ka(p)+'"][href="'+ka(i)+'"]',S=b;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=n(i)}if(!os.has(S)&&(i=Ne({rel:"modulepreload",href:i},s),os.set(S,i),c.querySelector(b)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(o(S)))return}p=c.createElement("link"),Fi(p,"link",i),en(p),c.head.appendChild(p)}}}function Bd(i,s,c){al.S(i,s,c);var p=Bl;if(p&&i){var b=Gr(p).hoistableStyles,S=Ol(i);s=s||"default";var R=b.get(S);if(!R){var X={loading:0,preload:null};if(R=p.querySelector(jh(S)))X.loading=5;else{i=Ne({rel:"stylesheet",href:i,"data-precedence":s},c),(c=os.get(S))&&_(i,c);var he=R=p.createElement("link");en(he),Fi(he,"link",i),he._p=new Promise(function(Re,Ge){he.onload=Re,he.onerror=Ge}),he.addEventListener("load",function(){X.loading|=1}),he.addEventListener("error",function(){X.loading|=2}),X.loading|=4,g(R,s,p)}R={type:"stylesheet",instance:R,count:1,state:X},b.set(S,R)}}}function Oh(i,s){al.X(i,s);var c=Bl;if(c&&i){var p=Gr(c).hoistableScripts,b=n(i),S=p.get(b);S||(S=c.querySelector(o(b)),S||(i=Ne({src:i,async:!0},s),(s=os.get(b))&&v(i,s),S=c.createElement("script"),en(S),Fi(S,"link",i),c.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},p.set(b,S))}}function $f(i,s){al.M(i,s);var c=Bl;if(c&&i){var p=Gr(c).hoistableScripts,b=n(i),S=p.get(b);S||(S=c.querySelector(o(b)),S||(i=Ne({src:i,async:!0,type:"module"},s),(s=os.get(b))&&v(i,s),S=c.createElement("script"),en(S),Fi(S,"link",i),c.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},p.set(b,S))}}function Od(i,s,c,p){var b=(b=wt.current)?kh(b):null;if(!b)throw Error(U(446));switch(i){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=Ol(c.href),c=Gr(b).hoistableStyles,p=c.get(s),p||(p={type:"style",instance:null,count:0,state:null},c.set(s,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){i=Ol(c.href);var S=Gr(b).hoistableStyles,R=S.get(i);if(R||(b=b.ownerDocument||b,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(i,R),(S=b.querySelector(jh(i)))&&!S._p&&(R.instance=S,R.state.loading=5),os.has(i)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},os.set(i,c),S||t(b,i,c,R.state))),s&&p===null)throw Error(U(528,""));return R}if(s&&p!==null)throw Error(U(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=n(c),c=Gr(b).hoistableScripts,p=c.get(s),p||(p={type:"script",instance:null,count:0,state:null},c.set(s,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(U(444,i))}}function Ol(i){return'href="'+ka(i)+'"'}function jh(i){return'link[rel="stylesheet"]['+i+"]"}function a(i){return Ne({},i,{"data-precedence":i.precedence,precedence:null})}function t(i,s,c,p){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?p.loading=1:(s=i.createElement("link"),p.preload=s,s.addEventListener("load",function(){return p.loading|=1}),s.addEventListener("error",function(){return p.loading|=2}),Fi(s,"link",c),en(s),i.head.appendChild(s))}function n(i){return'[src="'+ka(i)+'"]'}function o(i){return"script[async]"+i}function u(i,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var p=i.querySelector('style[data-href~="'+ka(c.href)+'"]');if(p)return s.instance=p,en(p),p;var b=Ne({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return p=(i.ownerDocument||i).createElement("style"),en(p),Fi(p,"style",b),g(p,c.precedence,i),s.instance=p;case"stylesheet":b=Ol(c.href);var S=i.querySelector(jh(b));if(S)return s.state.loading|=4,s.instance=S,en(S),S;p=a(c),(b=os.get(b))&&_(p,b),S=(i.ownerDocument||i).createElement("link"),en(S);var R=S;return R._p=new Promise(function(X,he){R.onload=X,R.onerror=he}),Fi(S,"link",p),s.state.loading|=4,g(S,c.precedence,i),s.instance=S;case"script":return S=n(c.src),(b=i.querySelector(o(S)))?(s.instance=b,en(b),b):(p=c,(b=os.get(S))&&(p=Ne({},c),v(p,b)),i=i.ownerDocument||i,b=i.createElement("script"),en(b),Fi(b,"link",p),i.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(U(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(p=s.instance,s.state.loading|=4,g(p,c.precedence,i));return s.instance}function g(i,s,c){for(var p=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=p.length?p[p.length-1]:null,S=b,R=0;R<p.length;R++){var X=p[R];if(X.dataset.precedence===s)S=X;else if(S!==b)break}S?S.parentNode.insertBefore(i,S.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(i,s.firstChild))}function _(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function v(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var x=null;function M(i,s,c){if(x===null){var p=new Map,b=x=new Map;b.set(c,p)}else b=x,p=b.get(c),p||(p=new Map,b.set(c,p));if(p.has(i))return p;for(p.set(i,null),c=c.getElementsByTagName(i),b=0;b<c.length;b++){var S=c[b];if(!(S[Bt]||S[ci]||i==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var R=S.getAttribute(s)||"";R=i+R;var X=p.get(R);X?X.push(S):p.set(R,[S])}}return p}function E(i,s,c){i=i.ownerDocument||i,i.head.insertBefore(c,s==="title"?i.querySelector("head > title"):null)}function z(i,s,c){if(c===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return i=s.disabled,typeof s.precedence=="string"&&i==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function k(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function B(i,s,c,p){if(c.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=Ol(p.href),S=s.querySelector(jh(b));if(S){s=S._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(i.count++,i=$.bind(i),s.then(i,i)),c.state.loading|=4,c.instance=S,en(S);return}S=s.ownerDocument||s,p=a(p),(b=os.get(b))&&_(p,b),S=S.createElement("link"),en(S);var R=S;R._p=new Promise(function(X,he){R.onload=X,R.onerror=he}),Fi(S,"link",p),c.instance=S}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(i.count++,c=$.bind(i),s.addEventListener("load",c),s.addEventListener("error",c))}}var j=0;function Z(i,s){return i.stylesheets&&i.count===0&&_e(i,i.stylesheets),0<i.count||0<i.imgCount?function(c){var p=setTimeout(function(){if(i.stylesheets&&_e(i,i.stylesheets),i.unsuspend){var S=i.unsuspend;i.unsuspend=null,S()}},6e4+s);0<i.imgBytes&&j===0&&(j=62500*Lc());var b=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&_e(i,i.stylesheets),i.unsuspend)){var S=i.unsuspend;i.unsuspend=null,S()}},(i.imgBytes>j?50:800)+s);return i.unsuspend=c,function(){i.unsuspend=null,clearTimeout(p),clearTimeout(b)}}:null}function $(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)_e(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var ee=null;function _e(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,ee=new Map,s.forEach(re,i),ee=null,$.call(i))}function re(i,s){if(!(s.state.loading&4)){var c=ee.get(i);if(c)var p=c.get(null);else{c=new Map,ee.set(i,c);for(var b=i.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<b.length;S++){var R=b[S];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(c.set(R.dataset.precedence,R),p=R)}p&&c.set(null,p)}b=s.instance,R=b.getAttribute("data-precedence"),S=c.get(R)||p,S===p&&c.set(null,b),c.set(R,b),this.count++,p=$.bind(this),b.addEventListener("load",p),b.addEventListener("error",p),S?S.parentNode.insertBefore(b,S.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(b,i.firstChild)),s.state.loading|=4}}var ue={$$typeof:St,Provider:null,Consumer:null,_currentValue:Tt,_currentValue2:Tt,_threadCount:0};function Me(i,s,c,p,b,S,R,X,he){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_i(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_i(0),this.hiddenUpdates=_i(null),this.identifierPrefix=p,this.onUncaughtError=b,this.onCaughtError=S,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=he,this.incompleteTransitions=new Map}function ke(i,s,c,p,b,S,R,X,he,Re,Ge,Ye){return i=new Me(i,s,c,R,he,Re,Ge,Ye,X),s=1,S===!0&&(s|=24),S=Ya(3,null,null,s),i.current=S,S.stateNode=i,s=uu(),s.refCount++,i.pooledCache=s,s.refCount++,S.memoizedState={element:p,isDehydrated:c,cache:s},ch(S),i}function Xe(i){return i?(i=Nt,i):Nt}function at(i,s,c,p,b,S){b=Xe(b),p.context===null?p.context=b:p.pendingContext=b,p=ri(s),p.payload={element:c},S=S===void 0?null:S,S!==null&&(p.callback=S),c=Cs(i,p,s),c!==null&&(ir(c,i,s),zs(c,i,s))}function Qe(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<s?c:s}}function it(i,s){Qe(i,s),(i=i.alternate)&&Qe(i,s)}function ft(i){if(i.tag===13||i.tag===31){var s=gr(i,67108864);s!==null&&ir(s,i,67108864),it(i,67108864)}}function nt(i){if(i.tag===13||i.tag===31){var s=tr();s=vn(s);var c=gr(i,s);c!==null&&ir(c,i,s),it(i,s)}}var tt=!0;function Ue(i,s,c,p){var b=Be.T;Be.T=null;var S=ot.p;try{ot.p=2,zt(i,s,c,p)}finally{ot.p=S,Be.T=b}}function Mt(i,s,c,p){var b=Be.T;Be.T=null;var S=ot.p;try{ot.p=8,zt(i,s,c,p)}finally{ot.p=S,Be.T=b}}function zt(i,s,c,p){if(tt){var b=_t(p);if(b===null)Ed(i,s,p,ut,c),Qn(i,p);else if(Ur(b,i,s,c,p))p.stopPropagation();else if(Qn(i,p),s&4&&-1<ua.indexOf(i)){for(;b!==null;){var S=wa(b);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var R=xe(S.pendingLanes);if(R!==0){var X=S;for(X.pendingLanes|=2,X.entangledLanes|=2;R;){var he=1<<31-pe(R);X.entanglements[1]|=he,R&=~he}Ra(S),(mi&6)===0&&(md=pn()+500,Lu(0))}}break;case 31:case 13:X=gr(S,2),X!==null&&ir(X,S,2),yd(),it(S,2)}if(S=_t(p),S===null&&Ed(i,s,p,ut,c),S===b)break;b=S}b!==null&&p.stopPropagation()}else Ed(i,s,p,null,c)}}function _t(i){return i=cr(i),$t(i)}var ut=null;function $t(i){if(ut=null,i=or(i),i!==null){var s=le(i);if(s===null)i=null;else{var c=s.tag;if(c===13){if(i=P(s),i!==null)return i;i=null}else if(c===31){if(i=d(s),i!==null)return i;i=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return ut=i,null}function rn(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ll()){case sr:return 2;case cl:return 8;case Hs:case bo:return 32;case ge:return 268435456;default:return 32}default:return 32}}var En=!1,dn=null,Wn=null,Bn=null,An=new Map,Li=new Map,Ji=[],ua="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Qn(i,s){switch(i){case"focusin":case"focusout":dn=null;break;case"dragenter":case"dragleave":Wn=null;break;case"mouseover":case"mouseout":Bn=null;break;case"pointerover":case"pointerout":An.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Li.delete(s.pointerId)}}function Jn(i,s,c,p,b,S){return i===null||i.nativeEvent!==S?(i={blockedOn:s,domEventName:c,eventSystemFlags:p,nativeEvent:S,targetContainers:[b]},s!==null&&(s=wa(s),s!==null&&ft(s)),i):(i.eventSystemFlags|=p,s=i.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),i)}function Ur(i,s,c,p,b){switch(s){case"focusin":return dn=Jn(dn,i,s,c,p,b),!0;case"dragenter":return Wn=Jn(Wn,i,s,c,p,b),!0;case"mouseover":return Bn=Jn(Bn,i,s,c,p,b),!0;case"pointerover":var S=b.pointerId;return An.set(S,Jn(An.get(S)||null,i,s,c,p,b)),!0;case"gotpointercapture":return S=b.pointerId,Li.set(S,Jn(Li.get(S)||null,i,s,c,p,b)),!0}return!1}function Nn(i){var s=or(i.target);if(s!==null){var c=le(s);if(c!==null){if(s=c.tag,s===13){if(s=P(c),s!==null){i.blockedOn=s,fa(i.priority,function(){nt(c)});return}}else if(s===31){if(s=d(c),s!==null){i.blockedOn=s,fa(i.priority,function(){nt(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function ba(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var c=_t(i.nativeEvent);if(c===null){c=i.nativeEvent;var p=new c.constructor(c.type,c);Ys=p,c.target.dispatchEvent(p),Ys=null}else return s=wa(c),s!==null&&ft(s),i.blockedOn=c,!1;s.shift()}return!0}function On(i,s,c){ba(i)&&c.delete(s)}function ea(){En=!1,dn!==null&&ba(dn)&&(dn=null),Wn!==null&&ba(Wn)&&(Wn=null),Bn!==null&&ba(Bn)&&(Bn=null),An.forEach(On),Li.forEach(On)}function Cn(i,s){i.blockedOn===s&&(i.blockedOn=null,En||(En=!0,F.unstable_scheduleCallback(F.unstable_NormalPriority,ea)))}var fn=null;function Ui(i){fn!==i&&(fn=i,F.unstable_scheduleCallback(F.unstable_NormalPriority,function(){fn===i&&(fn=null);for(var s=0;s<i.length;s+=3){var c=i[s],p=i[s+1],b=i[s+2];if(typeof p!="function"){if($t(p||c)===null)continue;break}var S=wa(c);S!==null&&(i.splice(s,3),s-=3,Is(S,{pending:!0,data:b,method:c.method,action:p},p,b))}}))}function Va(i){function s(he){return Cn(he,i)}dn!==null&&Cn(dn,i),Wn!==null&&Cn(Wn,i),Bn!==null&&Cn(Bn,i),An.forEach(s),Li.forEach(s);for(var c=0;c<Ji.length;c++){var p=Ji[c];p.blockedOn===i&&(p.blockedOn=null)}for(;0<Ji.length&&(c=Ji[0],c.blockedOn===null);)Nn(c),c.blockedOn===null&&Ji.shift();if(c=(i.ownerDocument||i).$$reactFormReplay,c!=null)for(p=0;p<c.length;p+=3){var b=c[p],S=c[p+1],R=b[$e]||null;if(typeof S=="function")R||Ui(c);else if(R){var X=null;if(S&&S.hasAttribute("formAction")){if(b=S,R=S[$e]||null)X=R.formAction;else if($t(b)!==null)continue}else X=R.action;typeof X=="function"?c[p+1]=X:(c.splice(p,3),p-=3),Ui(c)}}}function Bc(){function i(S){S.canIntercept&&S.info==="react-transition"&&S.intercept({handler:function(){return new Promise(function(R){return b=R})},focusReset:"manual",scroll:"manual"})}function s(){b!==null&&(b(),b=null),p||setTimeout(c,20)}function c(){if(!p&&!navigation.transition){var S=navigation.currentEntry;S&&S.url!=null&&navigation.navigate(S.url,{state:S.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var p=!1,b=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(c,100),function(){p=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),b!==null&&(b(),b=null)}}}function Nr(i){this._internalRoot=i}jd.prototype.render=Nr.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(U(409));var c=s.current,p=tr();at(c,p,i,s,null,null)},jd.prototype.unmount=Nr.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;at(i.current,2,null,i,null,null),yd(),s[It]=null}};function jd(i){this._internalRoot=i}jd.prototype.unstable_scheduleHydration=function(i){if(i){var s=cn();i={blockedOn:null,target:i,priority:s};for(var c=0;c<Ji.length&&s!==0&&s<Ji[c].priority;c++);Ji.splice(c,0,i),c===0&&Nn(i)}};var Oc=H.version;if(Oc!=="19.2.0")throw Error(U(527,Oc,"19.2.0"));ot.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(U(188)):(i=Object.keys(i).join(","),Error(U(268,i)));return i=Ae(s),i=i!==null?Je(i):null,i=i===null?null:i.stateNode,i};var jc={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Be,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rl.isDisabled&&rl.supportsFiber)try{Y=rl.inject(jc),ie=rl}catch{}}return Wf.createRoot=function(i,s){if(!J(i))throw Error(U(299));var c=!1,p="",b=ks,S=xc,R=tp;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(p=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(S=s.onCaughtError),s.onRecoverableError!==void 0&&(R=s.onRecoverableError)),s=ke(i,1,!1,null,null,c,p,null,b,S,R,Bc),i[It]=s.current,_o(i),new Nr(s)},Wf.hydrateRoot=function(i,s,c){if(!J(i))throw Error(U(299));var p=!1,b="",S=ks,R=xc,X=tp,he=null;return c!=null&&(c.unstable_strictMode===!0&&(p=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(S=c.onUncaughtError),c.onCaughtError!==void 0&&(R=c.onCaughtError),c.onRecoverableError!==void 0&&(X=c.onRecoverableError),c.formState!==void 0&&(he=c.formState)),s=ke(i,1,!0,s,c??null,p,b,he,S,R,X,Bc),s.context=Xe(null),c=s.current,p=tr(),p=vn(p),b=ri(p),b.callback=null,Cs(c,b,p),c=p,s.current.lanes=c,Ni(s,c),Ra(s),i[It]=s.current,_o(i),new jd(s)},Wf.version="19.2.0",Wf}var Mm;function yg(){if(Mm)return tm.exports;Mm=1;function F(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(F)}catch(H){console.error(H)}}return F(),tm.exports=_g(),tm.exports}var vg=yg();const xg=cm(vg),bg="modulepreload",wg=function(F){return"/vite-react-map-gl-template/"+F},Em={},Tg=function(H,q,U){let J=Promise.resolve();if(q&&q.length>0){let Ae=function(Je){return Promise.all(Je.map(Ne=>Promise.resolve(Ne).then(et=>({status:"fulfilled",value:et}),et=>({status:"rejected",reason:et}))))};var P=Ae;document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),be=d?.nonce||d?.getAttribute("nonce");J=Ae(q.map(Je=>{if(Je=wg(Je),Je in Em)return;Em[Je]=!0;const Ne=Je.endsWith(".css"),et=Ne?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${Je}"]${et}`))return;const Ct=document.createElement("link");if(Ct.rel=Ne?"stylesheet":bg,Ne||(Ct.as="script"),Ct.crossOrigin="",Ct.href=Je,be&&Ct.setAttribute("nonce",be),document.head.appendChild(Ct),Ne)return new Promise((mt,we)=>{Ct.addEventListener("load",mt),Ct.addEventListener("error",()=>we(new Error(`Unable to preload CSS for ${Je}`)))})}))}function le(d){const be=new Event("vite:preloadError",{cancelable:!0});if(be.payload=d,window.dispatchEvent(be),!be.defaultPrevented)throw d}return J.then(d=>{for(const be of d||[])be.status==="rejected"&&le(be.reason);return H().catch(le)})},Sg=Et.createContext(null);function Mg(F,H){const q=Array.isArray(F)?F[0]:F?F.x:0,U=Array.isArray(F)?F[1]:F?F.y:0,J=Array.isArray(H)?H[0]:H?H.x:0,le=Array.isArray(H)?H[1]:H?H.y:0;return q===J&&U===le}function Fl(F,H){if(F===H)return!0;if(!F||!H)return!1;if(Array.isArray(F)){if(!Array.isArray(H)||F.length!==H.length)return!1;for(let q=0;q<F.length;q++)if(!Fl(F[q],H[q]))return!1;return!0}else if(Array.isArray(H))return!1;if(typeof F=="object"&&typeof H=="object"){const q=Object.keys(F),U=Object.keys(H);if(q.length!==U.length)return!1;for(const J of q)if(!H.hasOwnProperty(J)||!Fl(F[J],H[J]))return!1;return!0}return!1}function Am(F){return{longitude:F.center.lng,latitude:F.center.lat,zoom:F.zoom,pitch:F.pitch,bearing:F.bearing,padding:F.padding}}function Cm(F,H){const q=H.viewState||H,U={};if("longitude"in q&&"latitude"in q&&(q.longitude!==F.center.lng||q.latitude!==F.center.lat)){const J=F.center.constructor;U.center=new J(q.longitude,q.latitude)}return"zoom"in q&&q.zoom!==F.zoom&&(U.zoom=q.zoom),"bearing"in q&&q.bearing!==F.bearing&&(U.bearing=q.bearing),"pitch"in q&&q.pitch!==F.pitch&&(U.pitch=q.pitch),q.padding&&F.padding&&!Fl(q.padding,F.padding)&&(U.padding=q.padding),U}const Eg=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function zm(F){if(!F)return null;if(typeof F=="string"||("toJS"in F&&(F=F.toJS()),!F.layers))return F;const H={};for(const U of F.layers)H[U.id]=U;const q=F.layers.map(U=>{let J=null;"interactive"in U&&(J=Object.assign({},U),delete J.interactive);const le=H[U.ref];if(le){J=J||Object.assign({},U),delete J.ref;for(const P of Eg)P in le&&(J[P]=le[P])}return J||U});return{...F,layers:q}}const Pm={version:8,sources:{},layers:[]},Dm={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Im={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Rm={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Ag=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Cg=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Nd{constructor(H,q,U){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=J=>{const le=this.props[Rm[J.type]];le?le(J):J.type==="error"&&console.error(J.error)},this._onCameraEvent=J=>{if(this._internalUpdate)return;J.viewState=this._propsedCameraUpdate||Am(this._map.transform);const le=this.props[Im[J.type]];le&&le(J)},this._onCameraUpdate=J=>this._internalUpdate?J:(this._propsedCameraUpdate=Am(J),Cm(J,this.props)),this._onPointerEvent=J=>{(J.type==="mousemove"||J.type==="mouseout")&&this._updateHover(J);const le=this.props[Dm[J.type]];le&&(this.props.interactiveLayerIds&&J.type!=="mouseover"&&J.type!=="mouseout"&&(J.features=this._hoveredFeatures||this._queryRenderedFeatures(J.point)),le(J),delete J.features)},this._MapClass=H,this.props=q,this._initialize(U)}get map(){return this._map}setProps(H){const q=this.props;this.props=H;const U=this._updateSettings(H,q),J=this._updateSize(H),le=this._updateViewState(H);this._updateStyle(H,q),this._updateStyleComponents(H),this._updateHandlers(H,q),(U||J||le&&!this._map.isMoving())&&this.redraw()}static reuse(H,q){const U=Nd.savedMaps.pop();if(!U)return null;const J=U.map,le=J.getContainer();for(q.className=le.className;le.childNodes.length>0;)q.appendChild(le.childNodes[0]);J._container=q;const P=J._resizeObserver;P&&(P.disconnect(),P.observe(q)),U.setProps({...H,styleDiffing:!1}),J.resize();const{initialViewState:d}=H;return d&&(d.bounds?J.fitBounds(d.bounds,{...d.fitBoundsOptions,duration:0}):U._updateViewState(d)),J.isStyleLoaded()?J.fire("load"):J.once("style.load",()=>J.fire("load")),J._update(),U}_initialize(H){const{props:q}=this,{mapStyle:U=Pm}=q,J={...q,...q.initialViewState,container:H,style:zm(U)},le=J.initialViewState||J.viewState||J;if(Object.assign(J,{center:[le.longitude||0,le.latitude||0],zoom:le.zoom||0,pitch:le.pitch||0,bearing:le.bearing||0}),q.gl){const d=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=d,q.gl)}const P=new this._MapClass(J);le.padding&&P.setPadding(le.padding),q.cursor&&(P.getCanvas().style.cursor=q.cursor),P.transformCameraUpdate=this._onCameraUpdate,P.on("style.load",()=>{this._styleComponents={light:P.getLight(),sky:P.getSky(),projection:P.getProjection?.(),terrain:P.getTerrain()},this._updateStyleComponents(this.props)}),P.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const d in Dm)P.on(d,this._onPointerEvent);for(const d in Im)P.on(d,this._onCameraEvent);for(const d in Rm)P.on(d,this._onEvent);this._map=P}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),Nd.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const H=this._map;H.style&&(H._frame&&(H._frame.cancel(),H._frame=null),H._render())}_updateSize(H){const{viewState:q}=H;if(q){const U=this._map;if(q.width!==U.transform.width||q.height!==U.transform.height)return U.resize(),!0}return!1}_updateViewState(H){const q=this._map,U=q.transform;if(!q.isMoving()){const le=Cm(U,H);if(Object.keys(le).length>0)return this._internalUpdate=!0,q.jumpTo(le),this._internalUpdate=!1,!0}return!1}_updateSettings(H,q){const U=this._map;let J=!1;for(const le of Ag)le in H&&!Fl(H[le],q[le])&&(J=!0,U[`set${le[0].toUpperCase()}${le.slice(1)}`]?.call(U,H[le]));return J}_updateStyle(H,q){if(H.cursor!==q.cursor&&(this._map.getCanvas().style.cursor=H.cursor||""),H.mapStyle!==q.mapStyle){const{mapStyle:U=Pm,styleDiffing:J=!0}=H,le={diff:J};"localIdeographFontFamily"in H&&(le.localIdeographFontFamily=H.localIdeographFontFamily),this._map.setStyle(zm(U),le)}}_updateStyleComponents({light:H,projection:q,sky:U,terrain:J}){const le=this._map,P=this._styleComponents;le.style._loaded&&(H&&!Fl(H,P.light)&&(P.light=H,le.setLight(H)),q&&!Fl(q,P.projection)&&q!==P.projection?.type&&(P.projection=typeof q=="string"?{type:q}:q,le.setProjection?.(P.projection)),U&&!Fl(U,P.sky)&&(P.sky=U,le.setSky(U)),J!==void 0&&!Fl(J,P.terrain)&&(!J||le.getSource(J.source))&&(P.terrain=J,le.setTerrain(J)))}_updateHandlers(H,q){const U=this._map;for(const J of Cg){const le=H[J]??!0,P=q[J]??!0;Fl(le,P)||(le?U[J].enable(le):U[J].disable())}}_queryRenderedFeatures(H){const q=this._map,{interactiveLayerIds:U=[]}=this.props;try{return q.queryRenderedFeatures(H,{layers:U.filter(q.getLayer.bind(q))})}catch{return[]}}_updateHover(H){const{props:q}=this;if(q.interactiveLayerIds&&(q.onMouseMove||q.onMouseEnter||q.onMouseLeave)){const J=H.type,le=this._hoveredFeatures?.length>0,P=this._queryRenderedFeatures(H.point),d=P.length>0;!d&&le&&(H.type="mouseleave",this._onPointerEvent(H)),this._hoveredFeatures=P,d&&!le&&(H.type="mouseenter",this._onPointerEvent(H)),H.type=J}else this._hoveredFeatures=null}}Nd.savedMaps=[];const zg=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Pg(F){if(!F)return null;const H=F.map,q={getMap:()=>H};for(const U of Dg(H))!(U in q)&&!zg.includes(U)&&(q[U]=H[U].bind(H));return q}function Dg(F){const H=new Set;let q=F;for(;q;){for(const U of Object.getOwnPropertyNames(q))U[0]!=="_"&&typeof F[U]=="function"&&U!=="fire"&&U!=="setEventedParent"&&H.add(U);q=Object.getPrototypeOf(q)}return Array.from(H)}const Ig=typeof document<"u"?Et.useLayoutEffect:Et.useEffect;function Rg(F,H){const{RTLTextPlugin:q,maxParallelImageRequests:U,workerCount:J,workerUrl:le}=H;if(q&&F.getRTLTextPluginStatus&&F.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:P,lazy:d=!0}=typeof q=="string"?{pluginUrl:q}:q;F.setRTLTextPlugin(P,be=>{be&&console.error(be)},d)}U!==void 0&&F.setMaxParallelImageRequests(U),J!==void 0&&F.setWorkerCount(J),le!==void 0&&F.setWorkerUrl(le)}const Fp=Et.createContext(null);function Lg(F,H){const q=Et.useContext(Sg),[U,J]=Et.useState(null),le=Et.useRef(),{current:P}=Et.useRef({mapLib:null,map:null});Et.useEffect(()=>{const Ae=F.mapLib;let Je=!0,Ne;return Promise.resolve(Ae||Tg(()=>Promise.resolve().then(()=>Yg),void 0)).then(et=>{if(!Je)return;if(!et)throw new Error("Invalid mapLib");const Ct="Map"in et?et:et.default;if(!Ct.Map)throw new Error("Invalid mapLib");Rg(Ct,F),F.reuseMaps&&(Ne=Nd.reuse(F,le.current)),Ne||(Ne=new Nd(Ct.Map,F,le.current)),P.map=Pg(Ne),P.mapLib=Ct,J(Ne),q?.onMapMount(P.map,F.id)}).catch(et=>{const{onError:Ct}=F;Ct?Ct({type:"error",target:null,originalEvent:null,error:et}):console.error(et)}),()=>{Je=!1,Ne&&(q?.onMapUnmount(F.id),F.reuseMaps?Ne.recycle():Ne.destroy())}},[]),Ig(()=>{U&&U.setProps(F)}),Et.useImperativeHandle(H,()=>P.map,[U]);const d=Et.useMemo(()=>({position:"relative",width:"100%",height:"100%",...F.style}),[F.style]),be={height:"100%"};return Et.createElement("div",{id:F.id,ref:le,style:d},U&&Et.createElement(Fp.Provider,{value:P},Et.createElement("div",{"mapboxgl-children":"",style:be},F.children)))}const kg=Et.forwardRef(Lg);var Um=Fm();const Bg=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Fc(F,H){if(!F||!H)return;const q=F.style;for(const U in H){const J=H[U];Number.isFinite(J)&&!Bg.test(U)?q[U]=`${J}px`:q[U]=J}}function Nm(F,H){if(F===H)return null;const q=Lm(F),U=Lm(H),J=[];for(const le of U)q.has(le)||J.push(le);for(const le of q)U.has(le)||J.push(le);return J.length===0?null:J}function Lm(F){return new Set(F?F.trim().split(/\s+/):[])}Et.memo(Et.forwardRef((F,H)=>{const{map:q,mapLib:U}=Et.useContext(Fp),J=Et.useRef({props:F}),le=Et.useMemo(()=>{let xi=!1;Et.Children.forEach(F.children,gi=>{gi&&(xi=!0)});const Jt={...F,element:xi?document.createElement("div"):void 0},St=new U.Marker(Jt);return St.setLngLat([F.longitude,F.latitude]),St.getElement().addEventListener("click",gi=>{J.current.props.onClick?.({type:"click",target:St,originalEvent:gi})}),St.on("dragstart",gi=>{const Ai=gi;Ai.lngLat=le.getLngLat(),J.current.props.onDragStart?.(Ai)}),St.on("drag",gi=>{const Ai=gi;Ai.lngLat=le.getLngLat(),J.current.props.onDrag?.(Ai)}),St.on("dragend",gi=>{const Ai=gi;Ai.lngLat=le.getLngLat(),J.current.props.onDragEnd?.(Ai)}),St},[]);Et.useEffect(()=>(le.addTo(q.getMap()),()=>{le.remove()}),[]);const{longitude:P,latitude:d,offset:be,style:Ae,draggable:Je=!1,popup:Ne=null,rotation:et=0,rotationAlignment:Ct="auto",pitchAlignment:mt="auto"}=F;Et.useEffect(()=>{Fc(le.getElement(),Ae)},[Ae]),Et.useImperativeHandle(H,()=>le,[]);const we=J.current.props;(le.getLngLat().lng!==P||le.getLngLat().lat!==d)&&le.setLngLat([P,d]),be&&!Mg(le.getOffset(),be)&&le.setOffset(be),le.isDraggable()!==Je&&le.setDraggable(Je),le.getRotation()!==et&&le.setRotation(et),le.getRotationAlignment()!==Ct&&le.setRotationAlignment(Ct),le.getPitchAlignment()!==mt&&le.setPitchAlignment(mt),le.getPopup()!==Ne&&le.setPopup(Ne);const on=Nm(we.className,F.className);if(on)for(const xi of on)le.toggleClassName(xi);return J.current.props=F,Um.createPortal(F.children,le.getElement())}));Et.memo(Et.forwardRef((F,H)=>{const{map:q,mapLib:U}=Et.useContext(Fp),J=Et.useMemo(()=>document.createElement("div"),[]),le=Et.useRef({props:F}),P=Et.useMemo(()=>{const d={...F},be=new U.Popup(d);return be.setLngLat([F.longitude,F.latitude]),be.once("open",Ae=>{le.current.props.onOpen?.(Ae)}),be},[]);if(Et.useEffect(()=>{const d=be=>{le.current.props.onClose?.(be)};return P.on("close",d),P.setDOMContent(J).addTo(q.getMap()),()=>{P.off("close",d),P.isOpen()&&P.remove()}},[]),Et.useEffect(()=>{Fc(P.getElement(),F.style)},[F.style]),Et.useImperativeHandle(H,()=>P,[]),P.isOpen()){const d=le.current.props;(P.getLngLat().lng!==F.longitude||P.getLngLat().lat!==F.latitude)&&P.setLngLat([F.longitude,F.latitude]),F.offset&&!Fl(d.offset,F.offset)&&P.setOffset(F.offset),(d.anchor!==F.anchor||d.maxWidth!==F.maxWidth)&&(P.options.anchor=F.anchor,P.setMaxWidth(F.maxWidth));const be=Nm(d.className,F.className);if(be)for(const Ae of be)P.toggleClassName(Ae);le.current.props=F}return Um.createPortal(F.children,J)}));function Uh(F,H,q,U){const J=Et.useContext(Fp),le=Et.useMemo(()=>F(J),[]);return Et.useEffect(()=>{const P=H,d=null,be=typeof H=="function"?H:null,{map:Ae}=J;return Ae.hasControl(le)||(Ae.addControl(le,P?.position),d&&d(J)),()=>{be&&be(J),Ae.hasControl(le)&&Ae.removeControl(le)}},[]),le}function Og(F){const H=Uh(({mapLib:q})=>new q.AttributionControl(F),{position:F.position});return Et.useEffect(()=>{Fc(H._container,F.style)},[F.style]),null}Et.memo(Og);function jg(F){const H=Uh(({mapLib:q})=>new q.FullscreenControl({container:F.containerId&&document.getElementById(F.containerId)}),{position:F.position});return Et.useEffect(()=>{Fc(H._controlContainer,F.style)},[F.style]),null}Et.memo(jg);function Fg(F,H){const q=Et.useRef({props:F}),U=Uh(({mapLib:J})=>{const le=new J.GeolocateControl(F),P=le._setupUI;return le._setupUI=()=>{le._container.hasChildNodes()||P()},le.on("geolocate",d=>{q.current.props.onGeolocate?.(d)}),le.on("error",d=>{q.current.props.onError?.(d)}),le.on("outofmaxbounds",d=>{q.current.props.onOutOfMaxBounds?.(d)}),le.on("trackuserlocationstart",d=>{q.current.props.onTrackUserLocationStart?.(d)}),le.on("trackuserlocationend",d=>{q.current.props.onTrackUserLocationEnd?.(d)}),le},{position:F.position});return q.current.props=F,Et.useImperativeHandle(H,()=>U,[]),Et.useEffect(()=>{Fc(U._container,F.style)},[F.style]),null}const Ug=Et.memo(Et.forwardRef(Fg));function Ng(F){const H=Uh(({mapLib:q})=>new q.NavigationControl(F),{position:F.position});return Et.useEffect(()=>{Fc(H._container,F.style)},[F.style]),null}const Vg=Et.memo(Ng);function Gg(F){const H=Uh(({mapLib:le})=>new le.ScaleControl(F),{position:F.position}),q=Et.useRef(F),U=q.current;q.current=F;const{style:J}=F;return F.maxWidth!==void 0&&F.maxWidth!==U.maxWidth&&(H.options.maxWidth=F.maxWidth),F.unit!==void 0&&F.unit!==U.unit&&H.setUnit(F.unit),Et.useEffect(()=>{Fc(H._container,J)},[J]),null}Et.memo(Gg);function Zg(F){const H=Uh(({mapLib:q})=>new q.TerrainControl(F),{position:F.position});return Et.useEffect(()=>{Fc(H._container,F.style)},[F.style]),null}Et.memo(Zg);function qg(F){const H=Uh(({mapLib:q})=>new q.LogoControl(F),{position:F.position});return Et.useEffect(()=>{Fc(H._container,F.style)},[F.style]),null}Et.memo(qg);var jp={exports:{}};var Hg=jp.exports,km;function Xg(){return km||(km=1,function(F,H){(function(q,U){F.exports=U()})(Hg,function(){var q={},U={};function J(P,d,be){if(U[P]=be,P==="index"){var Ae="var sharedModule = {}; ("+U.shared+")(sharedModule); ("+U.worker+")(sharedModule);",Je={};return U.shared(Je),U.index(q,Je),typeof window<"u"&&q.setWorkerUrl(window.URL.createObjectURL(new Blob([Ae],{type:"text/javascript"}))),q}}J("shared",["exports"],function(P){function d(a,t,n,o){return new(n||(n=Promise))(function(u,g){function _(M){try{x(o.next(M))}catch(E){g(E)}}function v(M){try{x(o.throw(M))}catch(E){g(E)}}function x(M){var E;M.done?u(M.value):(E=M.value,E instanceof n?E:new n(function(z){z(E)})).then(_,v)}x((o=o.apply(a,t||[])).next())})}function be(a,t){this.x=a,this.y=t}function Ae(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Je,Ne;typeof SuppressedError=="function"&&SuppressedError,be.prototype={clone(){return new be(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,t){return this.clone()._rotateAround(a,t)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const t=a.x-this.x,n=a.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,t){return Math.atan2(this.x*t-this.y*a,this.x*a+this.y*t)},_matMult(a){const t=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=t,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const t=Math.cos(a),n=Math.sin(a),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround(a,t){const n=Math.cos(a),o=Math.sin(a),u=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:be},be.convert=function(a){if(a instanceof be)return a;if(Array.isArray(a))return new be(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new be(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};var et=function(){if(Ne)return Je;function a(t,n,o,u){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=u}return Ne=1,Je=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,u=0;u<8;u++){var g=this.sampleCurveX(o)-t;if(Math.abs(g)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=g/_}var v=0,x=1;for(o=t,u=0;u<20&&(g=this.sampleCurveX(o),!(Math.abs(g-t)<n));u++)t>g?v=o:x=o,o=.5*(x-v)+v;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Je}(),Ct=Ae(et);let mt,we;function on(){return mt==null&&(mt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),mt}function xi(){if(we==null&&(we=!1,on())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const u=4*o;t.fillStyle=`rgb(${u},${u+1},${u+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){we=!0;break}}}return we||!1}var Jt=1e-6,St=typeof Float32Array<"u"?Float32Array:Array;function gi(){var a=new St(9);return St!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Ai(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function hi(){var a=new St(3);return St!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Ht(a){var t=a[0],n=a[1],o=a[2];return Math.sqrt(t*t+n*n+o*o)}function ln(a,t,n){var o=new St(3);return o[0]=a,o[1]=t,o[2]=n,o}function _n(a,t,n){return a[0]=t[0]+n[0],a[1]=t[1]+n[1],a[2]=t[2]+n[2],a}function ha(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a[2]=t[2]*n,a}function bi(a,t,n){var o=t[0],u=t[1],g=t[2],_=n[0],v=n[1],x=n[2];return a[0]=u*x-g*v,a[1]=g*_-o*x,a[2]=o*v-u*_,a}var wi,nr=Ht;function da(a,t,n){var o=t[0],u=t[1],g=t[2],_=t[3];return a[0]=n[0]*o+n[4]*u+n[8]*g+n[12]*_,a[1]=n[1]*o+n[5]*u+n[9]*g+n[13]*_,a[2]=n[2]*o+n[6]*u+n[10]*g+n[14]*_,a[3]=n[3]*o+n[7]*u+n[11]*g+n[15]*_,a}function Vn(){var a=new St(4);return St!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Be(a,t,n,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",g=Math.PI/360;t*=g,o*=g,n*=g;var _=Math.sin(t),v=Math.cos(t),x=Math.sin(n),M=Math.cos(n),E=Math.sin(o),z=Math.cos(o);switch(u){case"xyz":a[0]=_*M*z+v*x*E,a[1]=v*x*z-_*M*E,a[2]=v*M*E+_*x*z,a[3]=v*M*z-_*x*E;break;case"xzy":a[0]=_*M*z-v*x*E,a[1]=v*x*z-_*M*E,a[2]=v*M*E+_*x*z,a[3]=v*M*z+_*x*E;break;case"yxz":a[0]=_*M*z+v*x*E,a[1]=v*x*z-_*M*E,a[2]=v*M*E-_*x*z,a[3]=v*M*z+_*x*E;break;case"yzx":a[0]=_*M*z+v*x*E,a[1]=v*x*z+_*M*E,a[2]=v*M*E-_*x*z,a[3]=v*M*z-_*x*E;break;case"zxy":a[0]=_*M*z-v*x*E,a[1]=v*x*z+_*M*E,a[2]=v*M*E+_*x*z,a[3]=v*M*z-_*x*E;break;case"zyx":a[0]=_*M*z-v*x*E,a[1]=v*x*z+_*M*E,a[2]=v*M*E-_*x*z,a[3]=v*M*z+_*x*E;break;default:throw new Error("Unknown angle order "+u)}return a}function ot(){var a=new St(2);return St!=Float32Array&&(a[0]=0,a[1]=0),a}function Tt(a,t){var n=new St(2);return n[0]=a,n[1]=t,n}hi(),wi=new St(4),St!=Float32Array&&(wi[0]=0,wi[1]=0,wi[2]=0,wi[3]=0),hi(),ln(1,0,0),ln(0,1,0),Vn(),Vn(),gi(),ot();const pt=8192;function li(a,t,n){return t*(pt/(a.tileSize*Math.pow(2,n-a.tileID.overscaledZ)))}function me(a,t){return(a%t+t)%t}function Ze(a,t,n){return a*(1-n)+t*n}function st(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,n=t*a;return 4*(a<.5?n:3*(a-t)+n-.75)}function ct(a,t,n,o){const u=new Ct(a,t,n,o);return g=>u.solve(g)}const Pt=ct(.25,.1,.25,1);function wt(a,t,n){return Math.min(n,Math.max(t,a))}function Yt(a,t,n){const o=n-t,u=((a-t)%o+o)%o+t;return u===t?n:u}function fi(a,...t){for(const n of t)for(const o in n)a[o]=n[o];return a}let ai=1;function ar(a,t,n){const o={};for(const u in a)o[u]=t.call(this,a[u],u,a);return o}function Mr(a,t,n){const o={};for(const u in a)t.call(this,a[u],u,a)&&(o[u]=a[u]);return o}function ta(a){return Array.isArray(a)?a.map(ta):typeof a=="object"&&a?ar(a,ta):a}const Er={};function ki(a){Er[a]||(typeof console<"u"&&console.warn(a),Er[a]=!0)}function Za(a,t,n){return(n.y-a.y)*(t.x-a.x)>(t.y-a.y)*(n.x-a.x)}function Ci(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let xo=null;function Vs(a){if(xo==null){const t=a.navigator?a.navigator.userAgent:null;xo=!!a.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return xo}function rr(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const Gs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Zs(a,t,n,o,u){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(a,{timestamp:0});try{const _=g?.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const v=_.startsWith("BGR"),x=new Uint8ClampedArray(o*u*4);if(yield g.copyTo(x,function(M,E,z,k,B){const j=4*Math.max(-E,0),Z=(Math.max(0,z)-z)*k*4+j,$=4*k,ee=Math.max(0,E),_e=Math.max(0,z);return{rect:{x:ee,y:_e,width:Math.min(M.width,E+k)-ee,height:Math.min(M.height,z+B)-_e},layout:[{offset:Z,stride:$}]}}(a,t,n,o,u)),v)for(let M=0;M<x.length;M+=4){const E=x[M];x[M]=x[M+2],x[M+2]=E}return x}finally{g.close()}})}let qs,Vr;function pn(a,t,n,o){return a.addEventListener(t,n,o),{unsubscribe:()=>{a.removeEventListener(t,n,o)}}}function ll(a){return a*Math.PI/180}function sr(a){return a/Math.PI*180}const cl={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Hs={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},bo="AbortError";function ge(){return new Error(bo)}const V={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function N(a){return V.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const Y="global-dispatcher";class ie extends Error{constructor(t,n,o,u){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=u}}const ce=()=>Ci(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,pe=function(a,t){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const o=N(a.url);if(o)return o(a,t);if(Ci(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:Y},t)}if(!(/^file:/.test(n=a.url)||/^file:/.test(ce())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,u){return d(this,void 0,void 0,function*(){const g=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:ce(),signal:u.signal});let _,v;o.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");try{_=yield fetch(g)}catch(M){throw new ie(0,M.message,o.url,new Blob)}if(!_.ok){const M=yield _.blob();throw new ie(_.status,_.statusText,o.url,M)}v=o.type==="arrayBuffer"||o.type==="image"?_.arrayBuffer():o.type==="json"?_.json():_.text();const x=yield v;if(u.signal.aborted)throw ge();return{data:x,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(a,t);if(Ci(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:Y},t)}var n;return function(o,u){return new Promise((g,_)=>{var v;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const M in o.headers)x.setRequestHeader(M,o.headers[M]);o.type==="json"&&(x.responseType="text",!((v=o.headers)===null||v===void 0)&&v.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{_(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let M=x.response;if(o.type==="json")try{M=JSON.parse(x.response)}catch(E){return void _(E)}g({data:M,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const M=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});_(new ie(x.status,x.statusText,o.url,M))}},u.signal.addEventListener("abort",()=>{x.abort(),_(ge())}),x.send(o.body)})}(a,t)};function ze(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const t=new URL(a),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function ye(a,t,n){n[a]&&n[a].indexOf(t)!==-1||(n[a]=n[a]||[],n[a].push(t))}function De(a,t,n){if(n&&n[a]){const o=n[a].indexOf(t);o!==-1&&n[a].splice(o,1)}}class He{constructor(t,n={}){fi(this,n),this.type=t}}class je extends He{constructor(t,n={}){super("error",fi({error:t},n))}}class dt{on(t,n){return this._listeners=this._listeners||{},ye(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return De(t,n,this._listeners),De(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ye(t,n,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,n){typeof t=="string"&&(t=new He(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of u)v.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of g)De(o,v,this._oneTimeListeners),v.call(this,t);const _=this._eventedParent;_&&(fi(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof je&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Gt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function zi(a,t){const n={};for(const o in a)o!=="ref"&&(n[o]=a[o]);return Gt.forEach(o=>{o in t&&(n[o]=t[o])}),n}function vt(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let n=0;n<a.length;n++)if(!vt(a[n],t[n]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const n in a)if(!vt(a[n],t[n]))return!1;return!0}return a===t}function qt(a,t){a.push(t)}function _i(a,t,n){qt(n,{command:"addSource",args:[a,t[a]]})}function Ni(a,t,n){qt(t,{command:"removeSource",args:[a]}),n[a]=!0}function Gn(a,t,n,o){Ni(a,n,o),_i(a,t,n)}function Yi(a,t,n){let o;for(o in a[n])if(Object.prototype.hasOwnProperty.call(a[n],o)&&o!=="data"&&!vt(a[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!vt(a[n][o],t[n][o]))return!1;return!0}function yn(a,t,n,o,u,g){a=a||{},t=t||{};for(const _ in a)Object.prototype.hasOwnProperty.call(a,_)&&(vt(a[_],t[_])||n.push({command:g,args:[o,_,t[_],u]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(a,_)&&(vt(a[_],t[_])||n.push({command:g,args:[o,_,t[_],u]}))}function Vi(a){return a.id}function vn(a,t){return a[t.id]=t,a}class Ve{constructor(t,n,o,u){this.message=(t?`${t}: `:"")+o,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function cn(a,...t){for(const n of t)for(const o in n)a[o]=n[o];return a}class fa extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class qa{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,u]of n)this.bindings[o]=u}concat(t){return new qa(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ci={kind:"null"},$e={kind:"number"},It={kind:"string"},Zt={kind:"boolean"},Ar={kind:"color"},Ul={kind:"projectionDefinition"},ls={kind:"object"},Bt={kind:"value"},wo={kind:"collator"},or={kind:"formatted"},wa={kind:"padding"},lr={kind:"colorArray"},Gr={kind:"numberArray"},en={kind:"resolvedImage"},Nl={kind:"variableAnchorOffsetCollection"};function ia(a,t){return{kind:"array",itemType:a,N:t}}function yi(a){if(a.kind==="array"){const t=yi(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const Cr=[ci,$e,It,Zt,Ar,Ul,or,ls,ia(Bt),wa,Gr,lr,en,Nl];function To(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!To(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const n of Cr)if(!To(n,t))return null}}return`Expected ${yi(a)} but found ${yi(t)} instead.`}function xn(a,t){return t.some(n=>n.kind===a.kind)}function Xs(a,t){return t.some(n=>n==="null"?a===null:n==="array"?Array.isArray(a):n==="object"?a&&!Array.isArray(a)&&typeof a=="object":n===typeof a)}function cs(a,t){return a.kind==="array"&&t.kind==="array"?a.itemType.kind===t.itemType.kind&&typeof a.N=="number":a.kind===t.kind}const us=.96422,ul=.82521,Zr=4/29,na=6/29,Uc=3*na*na,Vd=na*na*na,Nc=Math.PI/180,Nh=180/Math.PI;function Vl(a){return(a%=360)<0&&(a+=360),a}function Vh([a,t,n,o]){let u,g;const _=Gl((.2225045*(a=ka(a))+.7168786*(t=ka(t))+.0606169*(n=ka(n)))/1);a===t&&t===n?u=g=_:(u=Gl((.4360747*a+.3850649*t+.1430804*n)/us),g=Gl((.0139322*a+.0971045*t+.7141733*n)/ul));const v=116*_-16;return[v<0?0:v,500*(u-_),200*(_-g),o]}function ka(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Gl(a){return a>Vd?Math.pow(a,1/3):a/Uc+Zr}function Nu([a,t,n,o]){let u=(a+16)/116,g=isNaN(t)?u:u+t/500,_=isNaN(n)?u:u-n/200;return u=1*hs(u),g=us*hs(g),_=ul*hs(_),[Zl(3.1338561*g-1.6168667*u-.4906146*_),Zl(-.9787684*g+1.9161415*u+.033454*_),Zl(.0719453*g-.2289914*u+1.4052427*_),o]}function Zl(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function hs(a){return a>na?a*a*a:Uc*(a-Zr)}const hl=Object.hasOwn||function(a,t){return Object.prototype.hasOwnProperty.call(a,t)};function dl(a,t){return hl(a,t)?a[t]:void 0}function ds(a){return parseInt(a.padEnd(2,a),16)/255}function fl(a,t){return So(t?a/100:a,0,1)}function So(a,t,n){return Math.min(Math.max(t,a),n)}function Vu(a){return!a.some(Number.isNaN)}const Gu={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function fs(a,t,n){return a+n*(t-a)}function Mo(a,t,n){return a.map((o,u)=>fs(o,t[u],n))}class Dt{constructor(t,n,o,u=1,g=!0){this.r=t,this.g=n,this.b=o,this.a=u,g||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[t,n,o,u]))}static parse(t){if(t instanceof Dt)return t;if(typeof t!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=dl(Gu,o);if(u){const[_,v,x]=u;return[_/255,v/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const _=o.length<6?1:2;let v=1;return[ds(o.slice(v,v+=_)),ds(o.slice(v,v+=_)),ds(o.slice(v,v+=_)),ds(o.slice(v,v+_)||"ff")]}if(o.startsWith("rgb")){const _=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,x,M,E,z,k,B,j,Z,$,ee,_e]=_,re=[E||" ",B||" ",$].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const ue=[M,k,Z].join(""),Me=ue==="%%%"?100:ue===""?255:0;if(Me){const ke=[So(+x/Me,0,1),So(+z/Me,0,1),So(+j/Me,0,1),ee?fl(+ee,_e):1];if(Vu(ke))return ke}}return}}const g=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,v,x,M,E,z,k,B,j]=g,Z=[x||" ",E||" ",k].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const $=[+v,So(+M,0,100),So(+z,0,100),B?fl(+B,j):1];if(Vu($))return function([ee,_e,re,ue]){function Me(ke){const Xe=(ke+ee/30)%12,at=_e*Math.min(re,1-re);return re-at*Math.max(-1,Math.min(Xe-3,9-Xe,1))}return ee=Vl(ee),_e/=100,re/=100,[Me(0),Me(8),Me(4),ue]}($)}}}(t);return n?new Dt(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:u}=this,g=u||1/0;return this.overwriteGetter("rgb",[t/g,n/g,o/g,u])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,o,u,g]=Vh(t),_=Math.sqrt(o*o+u*u);return[Math.round(1e4*_)?Vl(Math.atan2(u,o)*Nh):NaN,_,n,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Vh(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,u]=this.rgb;return`rgba(${[t,n,o].map(g=>Math.round(255*g)).join(",")},${u})`}static interpolate(t,n,o,u="rgb"){switch(u){case"rgb":{const[g,_,v,x]=Mo(t.rgb,n.rgb,o);return new Dt(g,_,v,x,!1)}case"hcl":{const[g,_,v,x]=t.hcl,[M,E,z,k]=n.hcl;let B,j;if(isNaN(g)||isNaN(M))isNaN(g)?isNaN(M)?B=NaN:(B=M,v!==1&&v!==0||(j=E)):(B=g,z!==1&&z!==0||(j=_));else{let re=M-g;M>g&&re>180?re-=360:M<g&&g-M>180&&(re+=360),B=g+o*re}const[Z,$,ee,_e]=function([re,ue,Me,ke]){return re=isNaN(re)?0:re*Nc,Nu([Me,Math.cos(re)*ue,Math.sin(re)*ue,ke])}([B,j??fs(_,E,o),fs(v,z,o),fs(x,k,o)]);return new Dt(Z,$,ee,_e,!1)}case"lab":{const[g,_,v,x]=Nu(Mo(t.lab,n.lab,o));return new Dt(g,_,v,x,!1)}}}}Dt.black=new Dt(0,0,0,1),Dt.white=new Dt(1,1,1,1),Dt.transparent=new Dt(0,0,0,0),Dt.red=new Dt(1,0,0,1);class Ft{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ys=["bottom","center","top"];class cr{constructor(t,n,o,u,g,_){this.text=t,this.image=n,this.scale=o,this.fontStack=u,this.textColor=g,this.verticalAlign=_}}class jn{constructor(t){this.sections=t}static fromString(t){return new jn([new cr(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof jn?t:jn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class bn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof bn)return t;if(typeof t=="number")return new bn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new bn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new bn(Mo(t.values,n.values,o))}}class Zn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Zn)return t;if(typeof t=="number")return new Zn([t]);if(Array.isArray(t)){for(const n of t)if(typeof n!="number")return;return new Zn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){return new Zn(Mo(t.values,n.values,o))}}class un{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof un)return t;if(typeof t=="string"){const o=Dt.parse(t);return o?new un([o]):void 0}if(!Array.isArray(t))return;const n=[];for(const o of t){if(typeof o!="string")return;const u=Dt.parse(o);if(!u)return;n.push(u)}return new un(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o,u="rgb"){const g=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let _=0;_<t.values.length;_++)g.push(Dt.interpolate(t.values[_],n.values[_],o,u));return new un(g)}}class Bi extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const pl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class tn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof tn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],u=t[n+1];if(typeof o!="string"||!pl.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new tn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,o){const u=t.values,g=n.values;if(u.length!==g.length)throw new Bi(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const _=[];for(let v=0;v<u.length;v+=2){if(u[v]!==g[v])throw new Bi(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${u[v]}, to[${v}]: ${g[v]}`);_.push(u[v]);const[x,M]=u[v+1],[E,z]=g[v+1];_.push([fs(x,E,o),fs(M,z,o)])}return new tn(_)}}class aa{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new aa({name:t,available:!1}):null}}class ra{constructor(t,n,o){this.from=t,this.to=n,this.transition=o}static interpolate(t,n,o){return new ra(t,n,o)}static parse(t){return t instanceof ra?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new ra(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new ra(t.from,t.to,t.transition):typeof t=="string"?new ra(t,t,1):void 0}}function ur(a,t,n,o){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[a,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[a,t,n,o]:[a,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function hr(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof ra||a instanceof Dt||a instanceof Ft||a instanceof jn||a instanceof bn||a instanceof Zn||a instanceof un||a instanceof tn||a instanceof aa)return!0;if(Array.isArray(a)){for(const t of a)if(!hr(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!hr(a[t]))return!1;return!0}return!1}function $i(a){if(a===null)return ci;if(typeof a=="string")return It;if(typeof a=="boolean")return Zt;if(typeof a=="number")return $e;if(a instanceof Dt)return Ar;if(a instanceof ra)return Ul;if(a instanceof Ft)return wo;if(a instanceof jn)return or;if(a instanceof bn)return wa;if(a instanceof Zn)return Gr;if(a instanceof un)return lr;if(a instanceof tn)return Nl;if(a instanceof aa)return en;if(Array.isArray(a)){const t=a.length;let n;for(const o of a){const u=$i(o);if(n){if(n===u)continue;n=Bt;break}n=u}return ia(n||Bt,t)}return ls}function Eo(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof Dt||a instanceof ra||a instanceof jn||a instanceof bn||a instanceof Zn||a instanceof un||a instanceof tn||a instanceof aa?a.toString():JSON.stringify(a)}class zr{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!hr(t[1]))return n.error("invalid value");const o=t[1];let u=$i(o);const g=n.expectedType;return u.kind!=="array"||u.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(u=g),new zr(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const qr={string:It,number:$e,boolean:Zt,object:ls};class ii{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,u=1;const g=t[0];if(g==="array"){let v,x;if(t.length>2){const M=t[1];if(typeof M!="string"||!(M in qr)||M==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=qr[M],u++}else v=Bt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=t[2],u++}o=ia(v,x)}else{if(!qr[g])throw new Error(`Types doesn't contain name = ${g}`);o=qr[g]}const _=[];for(;u<t.length;u++){const v=n.parse(t[u],u,Bt);if(!v)return null;_.push(v)}return new ii(o,_)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!To(this.type,$i(o)))return o;if(n===this.args.length-1)throw new Bi(`Expected value to be of type ${yi(this.type)}, but found ${yi($i(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const sa={"to-boolean":Zt,"to-color":Ar,"to-number":$e,"to-string":It};class Ot{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!sa[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const u=sa[o],g=[];for(let _=1;_<t.length;_++){const v=n.parse(t[_],_,Bt);if(!v)return null;g.push(v)}return new Ot(u,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const u of this.args){if(n=u.evaluate(t),o=null,n instanceof Dt)return n;if(typeof n=="string"){const g=t.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:ur(n[0],n[1],n[2],n[3]),!o))return new Dt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Bi(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const u=bn.parse(n);if(u)return u}throw new Bi(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const o of this.args){n=o.evaluate(t);const u=Zn.parse(n);if(u)return u}throw new Bi(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const o of this.args){n=o.evaluate(t);const u=un.parse(n);if(u)return u}throw new Bi(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const u=tn.parse(n);if(u)return u}throw new Bi(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Bi(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return jn.fromString(Eo(this.args[0].evaluate(t)));case"resolvedImage":return aa.fromString(Eo(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Eo(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Ut=["Unknown","Point","LineString","Polygon"];class $s{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ut[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=Dt.parse(t),this._parseColorCache.set(t,n)),n}}class ei{constructor(t,n,o=[],u,g=new qa,_=[]){this.registry=t,this.path=o,this.key=o.map(v=>`[${v}]`).join(""),this.scope=g,this.errors=_,this.expectedType=u,this._isConstant=n}parse(t,n,o,u,g={}){return n?this.concat(n,o,u)._parse(t,g):this._parse(t,g)}_parse(t,n){function o(u,g,_){return _==="assert"?new ii(g,[u]):_==="coerce"?new Ot(g,[u]):u}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=t[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[u];if(g){let _=g.parse(t,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,x=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||x.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(x.kind)||v.kind==="colorArray"&&["value","string","array"].includes(x.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))_=o(_,v,n.typeAnnotation||"coerce");else if(this.checkSubtype(v,x))return null}else _=o(_,v,n.typeAnnotation||"assert")}if(!(_ instanceof zr)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const v=new $s;try{_=new zr(_.type,_.evaluate(v))}catch(x){return this.error(x.message),null}}return _}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const u=typeof t=="number"?this.path.concat(t):this.path,g=o?this.scope.concat(o):this.scope;return new ei(this.registry,this._isConstant,u,n||null,g,this.errors)}error(t,...n){const o=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new fa(o,t))}checkSubtype(t,n){const o=To(t,n);return o&&this.error(o),o}}class Ks{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let g=1;g<t.length-1;g+=2){const _=t[g];if(typeof _!="string")return n.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const v=n.parse(t[g+1],g+1);if(!v)return null;o.push([_,v])}const u=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return u?new Ks(o,u):null}outputDefined(){return this.result.outputDefined()}}class Ba{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new Ba(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ps{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,$e),u=n.parse(t[2],2,ia(n.expectedType||Bt));return o&&u?new ps(u.type.itemType,o,u):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new Bi(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Bi(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Bi(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ms{constructor(t,n){this.type=Zt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Bt),u=n.parse(t[2],2,Bt);return o&&u?xn(o.type,[Zt,It,$e,ci,Bt])?new ms(o,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${yi(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!Xs(n,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${yi($i(n))} instead.`);if(!Xs(o,["string","array"]))throw new Bi(`Expected second argument to be of type array or string, but found ${yi($i(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ml{constructor(t,n,o){this.type=$e,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Bt),u=n.parse(t[2],2,Bt);if(!o||!u)return null;if(!xn(o.type,[Zt,It,$e,ci,Bt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${yi(o.type)} instead`);if(t.length===4){const g=n.parse(t[3],3,$e);return g?new ml(o,u,g):null}return new ml(o,u)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!Xs(n,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${yi($i(n))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(t)),Xs(o,["string"])){const g=o.indexOf(n,u);return g===-1?-1:[...o.slice(0,g)].length}if(Xs(o,["array"]))return o.indexOf(n,u);throw new Bi(`Expected second argument to be of type array or string, but found ${yi($i(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ql{constructor(t,n,o,u,g,_){this.inputType=t,this.type=n,this.input=o,this.cases=u,this.outputs=g,this.otherwise=_}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const g={},_=[];for(let M=2;M<t.length-1;M+=2){let E=t[M];const z=t[M+1];Array.isArray(E)||(E=[E]);const k=n.concat(M);if(E.length===0)return k.error("Expected at least one branch label.");for(const j of E){if(typeof j!="number"&&typeof j!="string")return k.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return k.error("Numeric branch labels must be integer values.");if(o){if(k.checkSubtype(o,$i(j)))return null}else o=$i(j);if(g[String(j)]!==void 0)return k.error("Branch labels must be unique.");g[String(j)]=_.length}const B=n.parse(z,M,u);if(!B)return null;u=u||B.type,_.push(B)}const v=n.parse(t[1],1,Bt);if(!v)return null;const x=n.parse(t[t.length-1],t.length-1,u);return x?v.type.kind!=="value"&&n.concat(1).checkSubtype(o,v.type)?null:new ql(o,u,v,g,_,x):null}evaluate(t){const n=this.input.evaluate(t);return($i(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Vc{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const u=[];for(let _=1;_<t.length-1;_+=2){const v=n.parse(t[_],_,Zt);if(!v)return null;const x=n.parse(t[_+1],_+1,o);if(!x)return null;u.push([v,x]),o=o||x.type}const g=n.parse(t[t.length-1],t.length-1,o);if(!g)return null;if(!o)throw new Error("Can't infer output type");return new Vc(o,u,g)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Gc{constructor(t,n,o,u){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=u}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Bt),u=n.parse(t[2],2,$e);if(!o||!u)return null;if(!xn(o.type,[ia(Bt),It,Bt]))return n.error(`Expected first argument to be of type array or string, but found ${yi(o.type)} instead`);if(t.length===4){const g=n.parse(t[3],3,$e);return g?new Gc(o.type,o,u,g):null}return new Gc(o.type,o,u)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let u;if(this.endIndex&&(u=this.endIndex.evaluate(t)),Xs(n,["string"]))return[...n].slice(o,u).join("");if(Xs(n,["array"]))return n.slice(o,u);throw new Bi(`Expected first argument to be of type array or string, but found ${yi($i(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Ao(a,t){const n=a.length-1;let o,u,g=0,_=n,v=0;for(;g<=_;)if(v=Math.floor((g+_)/2),o=a[v],u=a[v+1],o<=t){if(v===n||t<u)return v;g=v+1}else{if(!(o>t))throw new Bi("Input is not a number.");_=v-1}return 0}class gl{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[u,g]of o)this.labels.push(u),this.outputs.push(g)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,$e);if(!o)return null;const u=[];let g=null;n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let _=1;_<t.length;_+=2){const v=_===1?-1/0:t[_],x=t[_+1],M=_,E=_+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const z=n.parse(x,E,g);if(!z)return null;g=g||z.type,u.push([v,z])}return new gl(g,o,u)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const g=n.length;return u>=n[g-1]?o[g-1].evaluate(t):o[Ao(n,u)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Ws(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var qn,Hl,Gh=function(){if(Hl)return qn;function a(t,n,o,u){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=o,this.p2y=u}return Hl=1,qn=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,u=0;u<8;u++){var g=this.sampleCurveX(o)-t;if(Math.abs(g)<n)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=g/_}var v=0,x=1;for(o=t,u=0;u<20&&(g=this.sampleCurveX(o),!(Math.abs(g-t)<n));u++)t>g?v=o:x=o,o=.5*(x-v)+v;return o},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},qn}(),Xl=Ws(Gh);class pi{constructor(t,n,o,u,g){this.type=t,this.operator=n,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[_,v]of g)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(t,n,o,u){let g=0;if(t.name==="exponential")g=Zc(n,t.base,o,u);else if(t.name==="linear")g=Zc(n,1,o,u);else if(t.name==="cubic-bezier"){const _=t.controlPoints;g=new Xl(_[0],_[1],_[2],_[3]).solve(Zc(n,1,o,u))}return g}static parse(t,n){let[o,u,g,..._]=t;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const M=u[1];if(typeof M!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(M.length!==4||M.some(E=>typeof E!="number"||E<0||E>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,$e),!g)return null;const v=[];let x=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||n.expectedType==lr?n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType):x=Ar;for(let M=0;M<_.length;M+=2){const E=_[M],z=_[M+1],k=M+3,B=M+4;if(typeof E!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(v.length&&v[v.length-1][0]>=E)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const j=n.parse(z,B,x);if(!j)return null;x=x||j.type,v.push([E,j])}return cs(x,$e)||cs(x,Ul)||cs(x,Ar)||cs(x,wa)||cs(x,Gr)||cs(x,lr)||cs(x,Nl)||cs(x,ia($e))?new pi(x,o,u,g,v):n.error(`Type ${yi(x)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const u=this.input.evaluate(t);if(u<=n[0])return o[0].evaluate(t);const g=n.length;if(u>=n[g-1])return o[g-1].evaluate(t);const _=Ao(n,u),v=pi.interpolationFactor(this.interpolation,u,n[_],n[_+1]),x=o[_].evaluate(t),M=o[_+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return fs(x,M,v);case"color":return Dt.interpolate(x,M,v);case"padding":return bn.interpolate(x,M,v);case"colorArray":return un.interpolate(x,M,v);case"numberArray":return Zn.interpolate(x,M,v);case"variableAnchorOffsetCollection":return tn.interpolate(x,M,v);case"array":return Mo(x,M,v);case"projectionDefinition":return ra.interpolate(x,M,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return Dt.interpolate(x,M,v,"hcl");case"colorArray":return un.interpolate(x,M,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Dt.interpolate(x,M,v,"lab");case"colorArray":return un.interpolate(x,M,v,"lab")}}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Zc(a,t,n,o){const u=o-n,g=a-n;return u===0?0:t===1?g/u:(Math.pow(t,g)-1)/(Math.pow(t,u)-1)}const dr={color:Dt.interpolate,number:fs,padding:bn.interpolate,numberArray:Zn.interpolate,colorArray:un.interpolate,variableAnchorOffsetCollection:tn.interpolate,array:Mo};class Yl{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o=null;const u=n.expectedType;u&&u.kind!=="value"&&(o=u);const g=[];for(const v of t.slice(1)){const x=n.parse(v,1+g.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,g.push(x)}if(!o)throw new Error("No output type");const _=u&&g.some(v=>To(u,v.type));return new Yl(_?Bt:o,g)}evaluate(t){let n,o=null,u=0;for(const g of this.args)if(u++,o=g.evaluate(t),o&&o instanceof aa&&!o.available&&(n||(n=o.name),o=null,u===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function qc(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Co(a,t,n,o){return o.compare(t,n)===0}function gs(a,t,n){const o=a!=="=="&&a!=="!=";return class Vm{constructor(g,_,v){this.type=Zt,this.lhs=g,this.rhs=_,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const v=g[0];let x=_.parse(g[1],1,Bt);if(!x)return null;if(!qc(v,x.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${yi(x.type)}'.`);let M=_.parse(g[2],2,Bt);if(!M)return null;if(!qc(v,M.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${yi(M.type)}'.`);if(x.type.kind!==M.type.kind&&x.type.kind!=="value"&&M.type.kind!=="value")return _.error(`Cannot compare types '${yi(x.type)}' and '${yi(M.type)}'.`);o&&(x.type.kind==="value"&&M.type.kind!=="value"?x=new ii(M.type,[x]):x.type.kind!=="value"&&M.type.kind==="value"&&(M=new ii(x.type,[M])));let E=null;if(g.length===4){if(x.type.kind!=="string"&&M.type.kind!=="string"&&x.type.kind!=="value"&&M.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(E=_.parse(g[3],3,wo),!E)return null}return new Vm(x,M,E)}evaluate(g){const _=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(o&&this.hasUntypedArgument){const x=$i(_),M=$i(v);if(x.kind!==M.kind||x.kind!=="string"&&x.kind!=="number")throw new Bi(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${x.kind}, ${M.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=$i(_),M=$i(v);if(x.kind!=="string"||M.kind!=="string")return t(g,_,v)}return this.collator?n(g,_,v,this.collator.evaluate(g)):t(g,_,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Zu=gs("==",function(a,t,n){return t===n},Co),Zh=gs("!=",function(a,t,n){return t!==n},function(a,t,n,o){return!Co(0,t,n,o)}),qh=gs("<",function(a,t,n){return t<n},function(a,t,n,o){return o.compare(t,n)<0}),Hc=gs(">",function(a,t,n){return t>n},function(a,t,n,o){return o.compare(t,n)>0}),Xc=gs("<=",function(a,t,n){return t<=n},function(a,t,n,o){return o.compare(t,n)<=0}),Pr=gs(">=",function(a,t,n){return t>=n},function(a,t,n,o){return o.compare(t,n)>=0});class $l{constructor(t,n,o){this.type=wo,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const u=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Zt);if(!u)return null;const g=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Zt);if(!g)return null;let _=null;return o.locale&&(_=n.parse(o.locale,1,It),!_)?null:new $l(u,g,_)}evaluate(t){return new Ft(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class _l{constructor(t,n,o,u,g){this.type=It,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=g}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,$e);if(!o)return null;const u=t[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let g=null;if(u.locale&&(g=n.parse(u.locale,1,It),!g))return null;let _=null;if(u.currency&&(_=n.parse(u.currency,1,It),!_))return null;let v=null;if(u["min-fraction-digits"]&&(v=n.parse(u["min-fraction-digits"],1,$e),!v))return null;let x=null;return u["max-fraction-digits"]&&(x=n.parse(u["max-fraction-digits"],1,$e),!x)?null:new _l(o,g,_,v,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Yc{constructor(t){this.type=or,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const u=[];let g=!1;for(let _=1;_<=t.length-1;++_){const v=t[_];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let x=null;if(v["font-scale"]&&(x=n.parse(v["font-scale"],1,$e),!x))return null;let M=null;if(v["text-font"]&&(M=n.parse(v["text-font"],1,ia(It)),!M))return null;let E=null;if(v["text-color"]&&(E=n.parse(v["text-color"],1,Ar),!E))return null;let z=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!Ys.includes(v["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(z=n.parse(v["vertical-align"],1,It),!z)return null}const k=u[u.length-1];k.scale=x,k.font=M,k.textColor=E,k.verticalAlign=z}else{const x=n.parse(t[_],1,Bt);if(!x)return null;const M=x.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,u.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Yc(u)}evaluate(t){return new jn(this.sections.map(n=>{const o=n.content.evaluate(t);return $i(o)===en?new cr("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new cr(Eo(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class Kl{constructor(t){this.type=en,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,It);return o?new Kl(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=aa.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class qu{constructor(t){this.type=$e,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${yi(o.type)} instead.`):new qu(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Bi(`Expected value to be of type string or array, but found ${yi($i(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const fr=8192;function Wl(a,t){const n=(180+a[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,u=Math.pow(2,t.z);return[Math.round(n*u*fr),Math.round(o*u*fr)]}function Hu(a,t){const n=Math.pow(2,t.z);return[(u=(a[0]/fr+t.x)/n,360*u-180),(o=(a[1]/fr+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function _s(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function yl(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function Xu(a,t,n){const o=a[0]-t[0],u=a[1]-t[1],g=a[0]-n[0],_=a[1]-n[1];return o*_-g*u==0&&o*g<=0&&u*_<=0}function vl(a,t,n,o){return(u=[o[0]-n[0],o[1]-n[1]])[0]*(g=[t[0]-a[0],t[1]-a[1]])[1]-u[1]*g[0]!=0&&!(!Yu(a,t,n,o)||!Yu(n,o,a,t));var u,g}function Hh(a,t,n){for(const o of n)for(let u=0;u<o.length-1;++u)if(vl(a,t,o[u],o[u+1]))return!0;return!1}function pr(a,t,n=!1){let o=!1;for(const v of t)for(let x=0;x<v.length-1;x++){if(Xu(a,v[x],v[x+1]))return n;(g=v[x])[1]>(u=a)[1]!=(_=v[x+1])[1]>u[1]&&u[0]<(_[0]-g[0])*(u[1]-g[1])/(_[1]-g[1])+g[0]&&(o=!o)}var u,g,_;return o}function Gd(a,t){for(const n of t)if(pr(a,n))return!0;return!1}function Xh(a,t){for(const n of a)if(!pr(n,t))return!1;for(let n=0;n<a.length-1;++n)if(Hh(a[n],a[n+1],t))return!1;return!0}function Zd(a,t){for(const n of t)if(Xh(a,n))return!0;return!1}function Yu(a,t,n,o){const u=o[0]-n[0],g=o[1]-n[1],_=(a[0]-n[0])*g-u*(a[1]-n[1]),v=(t[0]-n[0])*g-u*(t[1]-n[1]);return _>0&&v<0||_<0&&v>0}function $c(a,t,n){const o=[];for(let u=0;u<a.length;u++){const g=[];for(let _=0;_<a[u].length;_++){const v=Wl(a[u][_],n);_s(t,v),g.push(v)}o.push(g)}return o}function zo(a,t,n){const o=[];for(let u=0;u<a.length;u++){const g=$c(a[u],t,n);o.push(g)}return o}function Po(a,t,n,o){if(a[0]<n[0]||a[0]>n[2]){const u=.5*o;let g=a[0]-n[0]>u?-o:n[0]-a[0]>u?o:0;g===0&&(g=a[0]-n[2]>u?-o:n[2]-a[0]>u?o:0),a[0]+=g}_s(t,a)}function $u(a,t,n,o){const u=Math.pow(2,o.z)*fr,g=[o.x*fr,o.y*fr],_=[];for(const v of a)for(const x of v){const M=[x.x+g[0],x.y+g[1]];Po(M,t,n,u),_.push(M)}return _}function Ql(a,t,n,o){const u=Math.pow(2,o.z)*fr,g=[o.x*fr,o.y*fr],_=[];for(const x of a){const M=[];for(const E of x){const z=[E.x+g[0],E.y+g[1]];_s(t,z),M.push(z)}_.push(M)}if(t[2]-t[0]<=u/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const x of _)for(const M of x)Po(M,t,n,u)}var v;return _}class Qs{constructor(t,n){this.type=Zt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(hr(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const u=[];for(const g of o.features){const{type:_,coordinates:v}=g.geometry;_==="Polygon"&&u.push(v),_==="MultiPolygon"&&u.push(...v)}if(u.length)return new Qs(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Qs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Qs(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const v=$c(o.coordinates,g,_),x=$u(n.geometry(),u,g,_);if(!yl(u,g))return!1;for(const M of x)if(!pr(M,v))return!1}if(o.type==="MultiPolygon"){const v=zo(o.coordinates,g,_),x=$u(n.geometry(),u,g,_);if(!yl(u,g))return!1;for(const M of x)if(!Gd(M,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const u=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const v=$c(o.coordinates,g,_),x=Ql(n.geometry(),u,g,_);if(!yl(u,g))return!1;for(const M of x)if(!Xh(M,v))return!1}if(o.type==="MultiPolygon"){const v=zo(o.coordinates,g,_),x=Ql(n.geometry(),u,g,_);if(!yl(u,g))return!1;for(const M of x)if(!Zd(M,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ku=class{constructor(a=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=a,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:t,compare:n}=this,o=t[a];for(;a>0;){const u=a-1>>1,g=t[u];if(n(o,g)>=0)break;t[a]=g,a=u}t[a]=o}_down(a){const{data:t,compare:n}=this,o=this.length>>1,u=t[a];for(;a<o;){let g=1+(a<<1);const _=g+1;if(_<this.length&&n(t[_],t[g])<0&&(g=_),n(t[g],u)>=0)break;t[a]=t[g],a=g}t[a]=u}};function Kc(a,t,n=0,o=a.length-1,u=Yh){for(;o>n;){if(o-n>600){const x=o-n+1,M=t-n+1,E=Math.log(x),z=.5*Math.exp(2*E/3),k=.5*Math.sqrt(E*z*(x-z)/x)*(M-x/2<0?-1:1);Kc(a,t,Math.max(n,Math.floor(t-M*z/x+k)),Math.min(o,Math.floor(t+(x-M)*z/x+k)),u)}const g=a[t];let _=n,v=o;for(Hr(a,n,t),u(a[o],g)>0&&Hr(a,n,o);_<v;){for(Hr(a,_,v),_++,v--;u(a[_],g)<0;)_++;for(;u(a[v],g)>0;)v--}u(a[n],g)===0?Hr(a,n,v):(v++,Hr(a,v,o)),v<=t&&(n=v+1),t<=v&&(o=v-1)}}function Hr(a,t,n){const o=a[t];a[t]=a[n],a[n]=o}function Yh(a,t){return a<t?-1:a>t?1:0}function Jl(a,t){if(a.length<=1)return[a];const n=[];let o,u;for(const g of a){const _=qd(g);_!==0&&(g.area=Math.abs(_),u===void 0&&(u=_<0),u===_<0?(o&&n.push(o),o=[g]):o.push(g))}if(o&&n.push(o),t>1)for(let g=0;g<n.length;g++)n[g].length<=t||(Kc(n[g],t,1,n[g].length-1,$h),n[g]=n[g].slice(0,t));return n}function $h(a,t){return t.area-a.area}function qd(a){let t=0;for(let n,o,u=0,g=a.length,_=g-1;u<g;_=u++)n=a[u],o=a[_],t+=(o.x-n.x)*(n.y+o.y);return t}const Wc=1/298.257223563,Wu=Wc*(2-Wc),Kh=Math.PI/180;class Qu{constructor(t){const n=6378.137*Kh*1e3,o=Math.cos(t*Kh),u=1/(1-Wu*(1-o*o)),g=Math.sqrt(u);this.kx=n*g*o,this.ky=n*g*u*(1-Wu)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,u=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(t,n){let o,u,g,_,v=1/0;for(let x=0;x<t.length-1;x++){let M=t[x][0],E=t[x][1],z=this.wrap(t[x+1][0]-M)*this.kx,k=(t[x+1][1]-E)*this.ky,B=0;z===0&&k===0||(B=(this.wrap(n[0]-M)*this.kx*z+(n[1]-E)*this.ky*k)/(z*z+k*k),B>1?(M=t[x+1][0],E=t[x+1][1]):B>0&&(M+=z/this.kx*B,E+=k/this.ky*B)),z=this.wrap(n[0]-M)*this.kx,k=(n[1]-E)*this.ky;const j=z*z+k*k;j<v&&(v=j,o=M,u=E,g=x,_=B)}return{point:[o,u],index:g,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Ta(a,t){return t[0]-a[0]}function ys(a){return a[1]-a[0]+1}function Xr(a,t){return a[1]>=a[0]&&a[1]<t}function Qc(a,t){if(a[0]>a[1])return[null,null];const n=ys(a);if(t){if(n===2)return[a,null];const u=Math.floor(n/2);return[[a[0],a[0]+u],[a[0]+u,a[1]]]}if(n===1)return[a,null];const o=Math.floor(n/2)-1;return[[a[0],a[0]+o],[a[0]+o+1,a[1]]]}function Jc(a,t){if(!Xr(t,a.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)_s(n,a[o]);return n}function ec(a){const t=[1/0,1/0,-1/0,-1/0];for(const n of a)for(const o of n)_s(t,o);return t}function eu(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function Ju(a,t,n){if(!eu(a)||!eu(t))return NaN;let o=0,u=0;return a[2]<t[0]&&(o=t[0]-a[2]),a[0]>t[2]&&(o=a[0]-t[2]),a[1]>t[3]&&(u=a[1]-t[3]),a[3]<t[1]&&(u=t[1]-a[3]),n.distance([0,0],[o,u])}function mr(a,t,n){const o=n.pointOnLine(t,a);return n.distance(a,o.point)}function tc(a,t,n,o,u){const g=Math.min(mr(a,[n,o],u),mr(t,[n,o],u)),_=Math.min(mr(n,[a,t],u),mr(o,[a,t],u));return Math.min(g,_)}function ni(a,t,n,o,u){if(!Xr(t,a.length)||!Xr(o,n.length))return 1/0;let g=1/0;for(let _=t[0];_<t[1];++_){const v=a[_],x=a[_+1];for(let M=o[0];M<o[1];++M){const E=n[M],z=n[M+1];if(vl(v,x,E,z))return 0;g=Math.min(g,tc(v,x,E,z,u))}}return g}function eh(a,t,n,o,u){if(!Xr(t,a.length)||!Xr(o,n.length))return NaN;let g=1/0;for(let _=t[0];_<=t[1];++_)for(let v=o[0];v<=o[1];++v)if(g=Math.min(g,u.distance(a[_],n[v])),g===0)return g;return g}function Wh(a,t,n){if(pr(a,t,!0))return 0;let o=1/0;for(const u of t){const g=u[0],_=u[u.length-1];if(g!==_&&(o=Math.min(o,mr(a,[_,g],n)),o===0))return o;const v=n.pointOnLine(u,a);if(o=Math.min(o,n.distance(a,v.point)),o===0)return o}return o}function Do(a,t,n,o){if(!Xr(t,a.length))return NaN;for(let g=t[0];g<=t[1];++g)if(pr(a[g],n,!0))return 0;let u=1/0;for(let g=t[0];g<t[1];++g){const _=a[g],v=a[g+1];for(const x of n)for(let M=0,E=x.length,z=E-1;M<E;z=M++){const k=x[z],B=x[M];if(vl(_,v,k,B))return 0;u=Math.min(u,tc(_,v,k,B,o))}}return u}function Io(a,t){for(const n of a)for(const o of n)if(pr(o,t,!0))return!0;return!1}function th(a,t,n,o=1/0){const u=ec(a),g=ec(t);if(o!==1/0&&Ju(u,g,n)>=o)return o;if(yl(u,g)){if(Io(a,t))return 0}else if(Io(t,a))return 0;let _=1/0;for(const v of a)for(let x=0,M=v.length,E=M-1;x<M;E=x++){const z=v[E],k=v[x];for(const B of t)for(let j=0,Z=B.length,$=Z-1;j<Z;$=j++){const ee=B[$],_e=B[j];if(vl(z,k,ee,_e))return 0;_=Math.min(_,tc(z,k,ee,_e,n))}}return _}function ih(a,t,n,o,u,g){if(!g)return;const _=Ju(Jc(o,g),u,n);_<t&&a.push([_,g,[0,0]])}function Yr(a,t,n,o,u,g,_){if(!g||!_)return;const v=Ju(Jc(o,g),Jc(u,_),n);v<t&&a.push([v,g,_])}function ic(a,t,n,o,u=1/0){let g=Math.min(o.distance(a[0],n[0][0]),u);if(g===0)return g;const _=new Ku([[0,[0,a.length-1],[0,0]]],Ta),v=ec(n);for(;_.length>0;){const x=_.pop();if(x[0]>=g)continue;const M=x[1],E=t?50:100;if(ys(M)<=E){if(!Xr(M,a.length))return NaN;if(t){const z=Do(a,M,n,o);if(isNaN(z)||z===0)return z;g=Math.min(g,z)}else for(let z=M[0];z<=M[1];++z){const k=Wh(a[z],n,o);if(g=Math.min(g,k),g===0)return 0}}else{const z=Qc(M,t);ih(_,g,o,a,v,z[0]),ih(_,g,o,a,v,z[1])}}return g}function nc(a,t,n,o,u,g=1/0){let _=Math.min(g,u.distance(a[0],n[0]));if(_===0)return _;const v=new Ku([[0,[0,a.length-1],[0,n.length-1]]],Ta);for(;v.length>0;){const x=v.pop();if(x[0]>=_)continue;const M=x[1],E=x[2],z=t?50:100,k=o?50:100;if(ys(M)<=z&&ys(E)<=k){if(!Xr(M,a.length)&&Xr(E,n.length))return NaN;let B;if(t&&o)B=ni(a,M,n,E,u),_=Math.min(_,B);else if(t&&!o){const j=a.slice(M[0],M[1]+1);for(let Z=E[0];Z<=E[1];++Z)if(B=mr(n[Z],j,u),_=Math.min(_,B),_===0)return _}else if(!t&&o){const j=n.slice(E[0],E[1]+1);for(let Z=M[0];Z<=M[1];++Z)if(B=mr(a[Z],j,u),_=Math.min(_,B),_===0)return _}else B=eh(a,M,n,E,u),_=Math.min(_,B)}else{const B=Qc(M,t),j=Qc(E,o);Yr(v,_,u,a,n,B[0],j[0]),Yr(v,_,u,a,n,B[0],j[1]),Yr(v,_,u,a,n,B[1],j[0]),Yr(v,_,u,a,n,B[1],j[1])}}return _}function tu(a){return a.type==="MultiPolygon"?a.coordinates.map(t=>({type:"Polygon",coordinates:t})):a.type==="MultiLineString"?a.coordinates.map(t=>({type:"LineString",coordinates:t})):a.type==="MultiPoint"?a.coordinates.map(t=>({type:"Point",coordinates:t})):[a]}class Ro{constructor(t,n){this.type=$e,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(hr(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new Ro(o,o.features.map(u=>tu(u.geometry)).flat());if(o.type==="Feature")return new Ro(o,tu(o.geometry));if("type"in o&&"coordinates"in o)return new Ro(o,tu(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const u=n.geometry(),g=u.flat().map(x=>Hu([x.x,x.y],n.canonical));if(u.length===0)return NaN;const _=new Qu(g[0][1]);let v=1/0;for(const x of o){switch(x.type){case"Point":v=Math.min(v,nc(g,!1,[x.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,nc(g,!1,x.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,ic(g,!1,x.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const u=n.geometry(),g=u.flat().map(x=>Hu([x.x,x.y],n.canonical));if(u.length===0)return NaN;const _=new Qu(g[0][1]);let v=1/0;for(const x of o){switch(x.type){case"Point":v=Math.min(v,nc(g,!0,[x.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,nc(g,!0,x.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,ic(g,!0,x.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,o){const u=n.geometry();if(u.length===0||u[0].length===0)return NaN;const g=Jl(u,0).map(x=>x.map(M=>M.map(E=>Hu([E.x,E.y],n.canonical)))),_=new Qu(g[0][0][0][1]);let v=1/0;for(const x of o)for(const M of g){switch(x.type){case"Point":v=Math.min(v,ic([x.coordinates],!1,M,_,v));break;case"LineString":v=Math.min(v,ic(x.coordinates,!0,M,_,v));break;case"Polygon":v=Math.min(v,th(M,x.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ac{constructor(t){this.type=Bt,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?n.error("Global state property must be defined."):typeof o!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new ac(o)}evaluate(t){var n;const o=(n=t.globals)===null||n===void 0?void 0:n.globalState;return o&&Object.keys(o).length!==0?dl(o,this.key):null}eachChild(){}outputDefined(){return!1}}const xl={"==":Zu,"!=":Zh,">":Hc,"<":qh,">=":Pr,"<=":Xc,array:ii,at:ps,boolean:ii,case:Vc,coalesce:Yl,collator:$l,format:Yc,image:Kl,in:ms,"index-of":ml,interpolate:pi,"interpolate-hcl":pi,"interpolate-lab":pi,length:qu,let:Ks,literal:zr,match:ql,number:ii,"number-format":_l,object:ii,slice:Gc,step:gl,string:ii,"to-boolean":Ot,"to-color":Ot,"to-number":Ot,"to-string":Ot,var:Ba,within:Qs,distance:Ro,"global-state":ac};class Ha{constructor(t,n,o,u){this.name=t,this.type=n,this._evaluate=o,this.args=u}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],u=Ha.definitions[o];if(!u)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=_.filter(([M])=>!Array.isArray(M)||M.length===t.length-1);let x=null;for(const[M,E]of v){x=new ei(n.registry,Sa,n.path,null,n.scope);const z=[];let k=!1;for(let B=1;B<t.length;B++){const j=t[B],Z=Array.isArray(M)?M[B-1]:M.type,$=x.parse(j,1+z.length,Z);if(!$){k=!0;break}z.push($)}if(!k)if(Array.isArray(M)&&M.length!==z.length)x.error(`Expected ${M.length} arguments, but found ${z.length} instead.`);else{for(let B=0;B<z.length;B++){const j=Array.isArray(M)?M[B]:M.type,Z=z[B];x.concat(B+1).checkSubtype(j,Z.type)}if(x.errors.length===0)return new Ha(o,g,E,z)}}if(v.length===1)n.errors.push(...x.errors);else{const M=(v.length?v:_).map(([z])=>{return k=z,Array.isArray(k)?`(${k.map(yi).join(", ")})`:`(${yi(k.type)}...)`;var k}).join(" | "),E=[];for(let z=1;z<t.length;z++){const k=n.parse(t[z],1+E.length);if(!k)return null;E.push(yi(k.type))}n.error(`Expected arguments of type ${M}, but found (${E.join(", ")}) instead.`)}return null}static register(t,n){Ha.definitions=n;for(const o in n)t[o]=Ha}}function nh(a,[t,n,o,u]){t=t.evaluate(a),n=n.evaluate(a),o=o.evaluate(a);const g=u?u.evaluate(a):1,_=ur(t,n,o,g);if(_)throw new Bi(_);return new Dt(t/255,n/255,o/255,g,!1)}function iu(a,t){return a in t}function Xa(a,t){const n=t[a];return n===void 0?null:n}function $r(a){return{type:a}}function Sa(a){if(a instanceof Ba)return Sa(a.boundExpression);if(a instanceof Ha&&a.name==="error"||a instanceof $l||a instanceof Qs||a instanceof Ro||a instanceof ac)return!1;const t=a instanceof Ot||a instanceof ii;let n=!0;return a.eachChild(o=>{n=t?n&&Sa(o):n&&o instanceof zr}),!!n&&vs(a)&&ko(a,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function vs(a){if(a instanceof Ha&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Qs||a instanceof Ro)return!1;let t=!0;return a.eachChild(n=>{t&&!vs(n)&&(t=!1)}),t}function Lo(a){if(a instanceof Ha&&a.name==="feature-state")return!1;let t=!0;return a.eachChild(n=>{t&&!Lo(n)&&(t=!1)}),t}function ko(a,t){if(a instanceof Ha&&t.indexOf(a.name)>=0)return!1;let n=!0;return a.eachChild(o=>{n&&!ko(o,t)&&(n=!1)}),n}function rc(a){return{result:"success",value:a}}function Js(a){return{result:"error",value:a}}function gr(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function ah(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function bl(a){return!!a.expression&&a.expression.interpolated}function Nt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function nu(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&$i(a)===ls}function Ya(a){return a}function au(a,t){const n=a.stops&&typeof a.stops[0][0]=="object",o=n||!(n||a.property!==void 0),u=a.type||(bl(t)?"exponential":"interval"),g=function(E){switch(E.type){case"color":return Dt.parse;case"padding":return bn.parse;case"numberArray":return Zn.parse;case"colorArray":return un.parse;default:return null}}(t);if(g&&((a=cn({},a)).stops&&(a.stops=a.stops.map(E=>[E[0],g(E[1])])),a.default=g(a.default?a.default:t.default)),a.colorSpace&&(_=a.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var _;const v=function(E){switch(E){case"exponential":return eo;case"interval":return ru;case"categorical":return Qh;case"identity":return su;default:throw new Error(`Unknown function type "${E}"`)}}(u);let x,M;if(u==="categorical"){x=Object.create(null);for(const E of a.stops)x[E[0]]=E[1];M=typeof a.stops[0][0]}if(n){const E={},z=[];for(let j=0;j<a.stops.length;j++){const Z=a.stops[j],$=Z[0].zoom;E[$]===void 0&&(E[$]={zoom:$,type:a.type,property:a.property,default:a.default,stops:[]},z.push($)),E[$].stops.push([Z[0].value,Z[1]])}const k=[];for(const j of z)k.push([E[j].zoom,au(E[j],t)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:pi.interpolationFactor.bind(void 0,B),zoomStops:k.map(j=>j[0]),evaluate:({zoom:j},Z)=>eo({stops:k,base:a.base},t,j).evaluate(j,Z)}}if(o){const E=u==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:pi.interpolationFactor.bind(void 0,E),zoomStops:a.stops.map(z=>z[0]),evaluate:({zoom:z})=>v(a,t,z,x,M)}}return{kind:"source",evaluate(E,z){const k=z&&z.properties?z.properties[a.property]:void 0;return k===void 0?Ma(a.default,t.default):v(a,t,k,x,M)}}}function Ma(a,t,n){return a!==void 0?a:t!==void 0?t:n!==void 0?n:void 0}function Qh(a,t,n,o,u){return Ma(typeof n===u?o[n]:void 0,a.default,t.default)}function ru(a,t,n){if(Nt(n)!=="number")return Ma(a.default,t.default);const o=a.stops.length;if(o===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[o-1][0])return a.stops[o-1][1];const u=Ao(a.stops.map(g=>g[0]),n);return a.stops[u][1]}function eo(a,t,n){const o=a.base!==void 0?a.base:1;if(Nt(n)!=="number")return Ma(a.default,t.default);const u=a.stops.length;if(u===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[u-1][0])return a.stops[u-1][1];const g=Ao(a.stops.map(E=>E[0]),n),_=function(E,z,k,B){const j=B-k,Z=E-k;return j===0?0:z===1?Z/j:(Math.pow(z,Z)-1)/(Math.pow(z,j)-1)}(n,o,a.stops[g][0],a.stops[g+1][0]),v=a.stops[g][1],x=a.stops[g+1][1],M=dr[t.type]||Ya;return typeof v.evaluate=="function"?{evaluate(...E){const z=v.evaluate.apply(void 0,E),k=x.evaluate.apply(void 0,E);if(z!==void 0&&k!==void 0)return M(z,k,_,a.colorSpace)}}:M(v,x,_,a.colorSpace)}function su(a,t,n){switch(t.type){case"color":n=Dt.parse(n);break;case"formatted":n=jn.fromString(n.toString());break;case"resolvedImage":n=aa.fromString(n.toString());break;case"padding":n=bn.parse(n);break;case"colorArray":n=un.parse(n);break;case"numberArray":n=Zn.parse(n);break;default:Nt(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return Ma(n,a.default,t.default)}Ha.register(xl,{error:[{kind:"error"},[It],(a,[t])=>{throw new Bi(t.evaluate(a))}],typeof:[It,[Bt],(a,[t])=>yi($i(t.evaluate(a)))],"to-rgba":[ia($e,4),[Ar],(a,[t])=>{const[n,o,u,g]=t.evaluate(a).rgb;return[255*n,255*o,255*u,g]}],rgb:[Ar,[$e,$e,$e],nh],rgba:[Ar,[$e,$e,$e,$e],nh],has:{type:Zt,overloads:[[[It],(a,[t])=>iu(t.evaluate(a),a.properties())],[[It,ls],(a,[t,n])=>iu(t.evaluate(a),n.evaluate(a))]]},get:{type:Bt,overloads:[[[It],(a,[t])=>Xa(t.evaluate(a),a.properties())],[[It,ls],(a,[t,n])=>Xa(t.evaluate(a),n.evaluate(a))]]},"feature-state":[Bt,[It],(a,[t])=>Xa(t.evaluate(a),a.featureState||{})],properties:[ls,[],a=>a.properties()],"geometry-type":[It,[],a=>a.geometryType()],id:[Bt,[],a=>a.id()],zoom:[$e,[],a=>a.globals.zoom],"heatmap-density":[$e,[],a=>a.globals.heatmapDensity||0],elevation:[$e,[],a=>a.globals.elevation||0],"line-progress":[$e,[],a=>a.globals.lineProgress||0],accumulated:[Bt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[$e,$r($e),(a,t)=>{let n=0;for(const o of t)n+=o.evaluate(a);return n}],"*":[$e,$r($e),(a,t)=>{let n=1;for(const o of t)n*=o.evaluate(a);return n}],"-":{type:$e,overloads:[[[$e,$e],(a,[t,n])=>t.evaluate(a)-n.evaluate(a)],[[$e],(a,[t])=>-t.evaluate(a)]]},"/":[$e,[$e,$e],(a,[t,n])=>t.evaluate(a)/n.evaluate(a)],"%":[$e,[$e,$e],(a,[t,n])=>t.evaluate(a)%n.evaluate(a)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(a,[t,n])=>Math.pow(t.evaluate(a),n.evaluate(a))],sqrt:[$e,[$e],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[$e,[$e],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[$e,[$e],(a,[t])=>Math.log(t.evaluate(a))],log2:[$e,[$e],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[$e,[$e],(a,[t])=>Math.sin(t.evaluate(a))],cos:[$e,[$e],(a,[t])=>Math.cos(t.evaluate(a))],tan:[$e,[$e],(a,[t])=>Math.tan(t.evaluate(a))],asin:[$e,[$e],(a,[t])=>Math.asin(t.evaluate(a))],acos:[$e,[$e],(a,[t])=>Math.acos(t.evaluate(a))],atan:[$e,[$e],(a,[t])=>Math.atan(t.evaluate(a))],min:[$e,$r($e),(a,t)=>Math.min(...t.map(n=>n.evaluate(a)))],max:[$e,$r($e),(a,t)=>Math.max(...t.map(n=>n.evaluate(a)))],abs:[$e,[$e],(a,[t])=>Math.abs(t.evaluate(a))],round:[$e,[$e],(a,[t])=>{const n=t.evaluate(a);return n<0?-Math.round(-n):Math.round(n)}],floor:[$e,[$e],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[$e,[$e],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[Zt,[It,Bt],(a,[t,n])=>a.properties()[t.value]===n.value],"filter-id-==":[Zt,[Bt],(a,[t])=>a.id()===t.value],"filter-type-==":[Zt,[It],(a,[t])=>a.geometryType()===t.value],"filter-<":[Zt,[It,Bt],(a,[t,n])=>{const o=a.properties()[t.value],u=n.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Zt,[Bt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[Zt,[It,Bt],(a,[t,n])=>{const o=a.properties()[t.value],u=n.value;return typeof o==typeof u&&o>u}],"filter-id->":[Zt,[Bt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[Zt,[It,Bt],(a,[t,n])=>{const o=a.properties()[t.value],u=n.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Zt,[Bt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[Zt,[It,Bt],(a,[t,n])=>{const o=a.properties()[t.value],u=n.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Zt,[Bt],(a,[t])=>{const n=a.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[Zt,[Bt],(a,[t])=>t.value in a.properties()],"filter-has-id":[Zt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Zt,[ia(It)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[Zt,[ia(Bt)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[Zt,[It,ia(Bt)],(a,[t,n])=>n.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[Zt,[It,ia(Bt)],(a,[t,n])=>function(o,u,g,_){for(;g<=_;){const v=g+_>>1;if(u[v]===o)return!0;u[v]>o?_=v-1:g=v+1}return!1}(a.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Zt,overloads:[[[Zt,Zt],(a,[t,n])=>t.evaluate(a)&&n.evaluate(a)],[$r(Zt),(a,t)=>{for(const n of t)if(!n.evaluate(a))return!1;return!0}]]},any:{type:Zt,overloads:[[[Zt,Zt],(a,[t,n])=>t.evaluate(a)||n.evaluate(a)],[$r(Zt),(a,t)=>{for(const n of t)if(n.evaluate(a))return!0;return!1}]]},"!":[Zt,[Zt],(a,[t])=>!t.evaluate(a)],"is-supported-script":[Zt,[It],(a,[t])=>{const n=a.globals&&a.globals.isSupportedScript;return!n||n(t.evaluate(a))}],upcase:[It,[It],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[It,[It],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[It,$r(Bt),(a,t)=>t.map(n=>Eo(n.evaluate(a))).join("")],"resolved-locale":[It,[wo],(a,[t])=>t.evaluate(a).resolvedLocale()]});class ou{constructor(t,n,o){this.expression=t,this._warningHistory={},this._evaluator=new $s,this._defaultValue=n?function(u){if(u.type==="color"&&nu(u.default))return new Dt(0,0,0,0);switch(u.type){case"color":return Dt.parse(u.default)||null;case"padding":return bn.parse(u.default)||null;case"numberArray":return Zn.parse(u.default)||null;case"colorArray":return un.parse(u.default)||null;case"variableAnchorOffsetCollection":return tn.parse(u.default)||null;case"projectionDefinition":return ra.parse(u.default)||null;default:return u.default===void 0?null:u.default}}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=o}evaluateWithoutErrorHandling(t,n,o,u,g,_){return this._globalState&&(t=Hn(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,u,g,_){this._globalState&&(t=Hn(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Bi(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function wl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in xl}function to(a,t,n){const o=new ei(xl,Sa,[],t?function(g){const _={color:Ar,string:It,number:$e,enum:It,boolean:Zt,formatted:or,padding:wa,numberArray:Gr,colorArray:lr,projectionDefinition:Ul,resolvedImage:en,variableAnchorOffsetCollection:Nl};return g.type==="array"?ia(_[g.value]||Bt,g.length):_[g.type]}(t):void 0),u=o.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?rc(new ou(u,t,n)):Js(o.errors)}class pa{constructor(t,n,o){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Lo(n.expression),this.globalStateRefs=Ea(n.expression),this._globalState=o}evaluateWithoutErrorHandling(t,n,o,u,g,_){return this._globalState&&(t=Hn(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,g,_)}evaluate(t,n,o,u,g,_){return this._globalState&&(t=Hn(t,this._globalState)),this._styleExpression.evaluate(t,n,o,u,g,_)}}class io{constructor(t,n,o,u,g){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Lo(n.expression),this.globalStateRefs=Ea(n.expression),this.interpolationType=u,this._globalState=g}evaluateWithoutErrorHandling(t,n,o,u,g,_){return this._globalState&&(t=Hn(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,n,o,u,g,_)}evaluate(t,n,o,u,g,_){return this._globalState&&(t=Hn(t,this._globalState)),this._styleExpression.evaluate(t,n,o,u,g,_)}interpolationFactor(t,n,o){return this.interpolationType?pi.interpolationFactor(this.interpolationType,t,n,o):0}}function Bo(a,t,n){const o=to(a,t,n);if(o.result==="error")return o;const u=o.value.expression,g=vs(u);if(!g&&!gr(t))return Js([new fa("","data expressions not supported")]);const _=ko(u,["zoom"]);if(!_&&!ah(t))return Js([new fa("","zoom expressions not supported")]);const v=no(u);return v||_?v instanceof fa?Js([v]):v instanceof pi&&!bl(t)?Js([new fa("",'"interpolate" expressions cannot be used with this property')]):rc(v?new io(g?"camera":"composite",o.value,v.labels,v instanceof pi?v.interpolation:void 0,n):new pa(g?"constant":"source",o.value,n)):Js([new fa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Oo{constructor(t,n){this._parameters=t,this._specification=n,cn(this,au(this._parameters,this._specification))}static deserialize(t){return new Oo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function no(a){let t=null;if(a instanceof Ks)t=no(a.result);else if(a instanceof Yl){for(const n of a.args)if(t=no(n),t)break}else(a instanceof gl||a instanceof pi)&&a.input instanceof Ha&&a.input.name==="zoom"&&(t=a);return t instanceof fa||a.eachChild(n=>{const o=no(n);o instanceof fa?t=o:!t&&o?t=new fa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new fa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ea(a,t=new Set){return a instanceof ac&&t.add(a.key),a.eachChild(n=>{Ea(n,t)}),t}function Hn(a,t){const{zoom:n,heatmapDensity:o,elevation:u,lineProgress:g,isSupportedScript:_,accumulated:v}=a??{};return{zoom:n,heatmapDensity:o,elevation:u,lineProgress:g,isSupportedScript:_,accumulated:v,globalState:t}}function Dr(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!Dr(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Kr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Oa(a,t){if(a==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Dr(a)||(a=jo(a));const n=to(a,Kr,t);if(n.result==="error")throw new Error(n.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,u,g)=>n.value.evaluate(o,u,{},g),needGeometry:lu(a),getGlobalStateRefs:()=>Ea(n.value.expression)}}function Wr(a,t){return a<t?-1:a>t?1:0}function lu(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(lu(a[t]))return!0;return!1}function jo(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?sc(a[1],a[2],"=="):t==="!="?Pi(sc(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?sc(a[1],a[2],t):t==="any"?(n=a.slice(1),["any"].concat(n.map(jo))):t==="all"?["all"].concat(a.slice(1).map(jo)):t==="none"?["all"].concat(a.slice(1).map(jo).map(Pi)):t==="in"?rh(a[1],a.slice(2)):t==="!in"?Pi(rh(a[1],a.slice(2))):t==="has"?Xn(a[1]):t!=="!has"||Pi(Xn(a[1]));var n}function sc(a,t,n){switch(a){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,a,t]}}function rh(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",a,["literal",t.sort(Wr)]]:["filter-in-small",a,["literal",t]]}}function Xn(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Pi(a){return["!",a]}function Qt(a){const t=typeof a;if(t==="number"||t==="boolean"||t==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let u="[";for(const g of a)u+=`${Qt(g)},`;return`${u}]`}const n=Object.keys(a).sort();let o="{";for(let u=0;u<n.length;u++)o+=`${JSON.stringify(n[u])}:${Qt(a[n[u]])},`;return`${o}}`}function xs(a){let t="";for(const n of Gt)t+=`/${Qt(a[n])}`;return t}function Aa(a){const t=a.value;return t?[new Ve(a.key,t,"constants have been deprecated as of v8")]:[]}function Gi(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function ma(a){if(Array.isArray(a))return a.map(ma);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const n in a)t[n]=ma(a[n]);return t}return Gi(a)}function Ca(a){const t=a.key,n=a.value,o=a.valueSpec||{},u=a.objectElementValidators||{},g=a.style,_=a.styleSpec,v=a.validateSpec;let x=[];const M=Nt(n);if(M!=="object")return[new Ve(t,n,`object expected, ${M} found`)];for(const E in n){const z=E.split(".")[0],k=dl(o,z)||o["*"];let B;if(dl(u,z))B=u[z];else if(dl(o,z))B=v;else if(u["*"])B=u["*"];else{if(!o["*"]){x.push(new Ve(t,n[E],`unknown property "${E}"`));continue}B=v}x=x.concat(B({key:(t&&`${t}.`)+E,value:n[E],valueSpec:k,style:g,styleSpec:_,object:n,objectKey:E,validateSpec:v},n))}for(const E in o)u[E]||o[E].required&&o[E].default===void 0&&n[E]===void 0&&x.push(new Ve(t,n,`missing required property "${E}"`));return x}function Fo(a){const t=a.value,n=a.valueSpec,o=a.style,u=a.styleSpec,g=a.key,_=a.arrayElementValidator||a.validateSpec;if(Nt(t)!=="array")return[new Ve(g,t,`array expected, ${Nt(t)} found`)];if(n.length&&t.length!==n.length)return[new Ve(g,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ve(g,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let v={type:n.value,values:n.values};u.$version<7&&(v.function=n.function),Nt(n.value)==="object"&&(v=n.value);let x=[];for(let M=0;M<t.length;M++)x=x.concat(_({array:t,arrayIndex:M,value:t[M],valueSpec:v,validateSpec:a.validateSpec,style:o,styleSpec:u,key:`${g}[${M}]`}));return x}function bs(a){const t=a.key,n=a.value,o=a.valueSpec;let u=Nt(n);return u==="number"&&n!=n&&(u="NaN"),u!=="number"?[new Ve(t,n,`number expected, ${u} found`)]:"minimum"in o&&n<o.minimum?[new Ve(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Ve(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function ao(a){const t=a.valueSpec,n=Gi(a.value.type);let o,u,g,_={};const v=n!=="categorical"&&a.value.property===void 0,x=!v,M=Nt(a.value.stops)==="array"&&Nt(a.value.stops[0])==="array"&&Nt(a.value.stops[0][0])==="object",E=Ca({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(B){if(n==="identity")return[new Ve(B.key,B.value,'identity function may not have a "stops" property')];let j=[];const Z=B.value;return j=j.concat(Fo({key:B.key,value:Z,valueSpec:B.valueSpec,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:z})),Nt(Z)==="array"&&Z.length===0&&j.push(new Ve(B.key,Z,"array must have at least one stop")),j},default:function(B){return B.validateSpec({key:B.key,value:B.value,valueSpec:t,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec})}}});return n==="identity"&&v&&E.push(new Ve(a.key,a.value,'missing required property "property"')),n==="identity"||a.value.stops||E.push(new Ve(a.key,a.value,'missing required property "stops"')),n==="exponential"&&a.valueSpec.expression&&!bl(a.valueSpec)&&E.push(new Ve(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(x&&!gr(a.valueSpec)?E.push(new Ve(a.key,a.value,"property functions not supported")):v&&!ah(a.valueSpec)&&E.push(new Ve(a.key,a.value,"zoom functions not supported"))),n!=="categorical"&&!M||a.value.property!==void 0||E.push(new Ve(a.key,a.value,'"property" property is required')),E;function z(B){let j=[];const Z=B.value,$=B.key;if(Nt(Z)!=="array")return[new Ve($,Z,`array expected, ${Nt(Z)} found`)];if(Z.length!==2)return[new Ve($,Z,`array length 2 expected, length ${Z.length} found`)];if(M){if(Nt(Z[0])!=="object")return[new Ve($,Z,`object expected, ${Nt(Z[0])} found`)];if(Z[0].zoom===void 0)return[new Ve($,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new Ve($,Z,"object stop key must have value")];if(g&&g>Gi(Z[0].zoom))return[new Ve($,Z[0].zoom,"stop zoom values must appear in ascending order")];Gi(Z[0].zoom)!==g&&(g=Gi(Z[0].zoom),u=void 0,_={}),j=j.concat(Ca({key:`${$}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:bs,value:k}}))}else j=j.concat(k({key:`${$}[0]`,value:Z[0],validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec},Z));return wl(ma(Z[1]))?j.concat([new Ve(`${$}[1]`,Z[1],"expressions are not allowed in function stops.")]):j.concat(B.validateSpec({key:`${$}[1]`,value:Z[1],valueSpec:t,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec}))}function k(B,j){const Z=Nt(B.value),$=Gi(B.value),ee=B.value!==null?B.value:j;if(o){if(Z!==o)return[new Ve(B.key,ee,`${Z} stop domain type must match previous stop domain type ${o}`)]}else o=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new Ve(B.key,ee,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&n!=="categorical"){let _e=`number expected, ${Z} found`;return gr(t)&&n===void 0&&(_e+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ve(B.key,ee,_e)]}return n!=="categorical"||Z!=="number"||isFinite($)&&Math.floor($)===$?n!=="categorical"&&Z==="number"&&u!==void 0&&$<u?[new Ve(B.key,ee,"stop domain values must appear in ascending order")]:(u=$,n==="categorical"&&$ in _?[new Ve(B.key,ee,"stop domain values must be unique")]:(_[$]=!0,[])):[new Ve(B.key,ee,`integer expected, found ${$}`)]}}function ro(a){const t=(a.expressionContext==="property"?Bo:to)(ma(a.value),a.valueSpec);if(t.result==="error")return t.value.map(o=>new Ve(`${a.key}${o.key}`,a.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!n.outputDefined())return[new Ve(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Lo(n))return[new Ve(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Lo(n))return[new Ve(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!ko(n,["zoom","feature-state"]))return[new Ve(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!vs(n))return[new Ve(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Uo(a){const t=a.key,n=a.value,o=Nt(n);return o!=="string"?[new Ve(t,n,`color expected, ${o} found`)]:Dt.parse(String(n))?[]:[new Ve(t,n,`color expected, "${n}" found`)]}function No(a){const t=a.key,n=a.value,o=a.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(Gi(n))===-1&&u.push(new Ve(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(Gi(n))===-1&&u.push(new Ve(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function ws(a){return Dr(ma(a.value))?ro(cn({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ir(a)}function Ir(a){const t=a.value,n=a.key;if(Nt(t)!=="array")return[new Ve(n,t,`array expected, ${Nt(t)} found`)];const o=a.styleSpec;let u,g=[];if(t.length<1)return[new Ve(n,t,"filter array must have at least 1 element")];switch(g=g.concat(No({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:a.style,styleSpec:a.styleSpec})),Gi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Gi(t[1])==="$type"&&g.push(new Ve(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new Ve(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(u=Nt(t[1]),u!=="string"&&g.push(new Ve(`${n}[1]`,t[1],`string expected, ${u} found`)));for(let _=2;_<t.length;_++)u=Nt(t[_]),Gi(t[1])==="$type"?g=g.concat(No({key:`${n}[${_}]`,value:t[_],valueSpec:o.geometry_type,style:a.style,styleSpec:a.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&g.push(new Ve(`${n}[${_}]`,t[_],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)g=g.concat(Ir({key:`${n}[${_}]`,value:t[_],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":u=Nt(t[1]),t.length!==2?g.push(new Ve(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):u!=="string"&&g.push(new Ve(`${n}[1]`,t[1],`string expected, ${u} found`))}return g}function Qr(a,t){const n=a.key,o=a.validateSpec,u=a.style,g=a.styleSpec,_=a.value,v=a.objectKey,x=g[`${t}_${a.layerType}`];if(!x)return[];const M=v.match(/^(.*)-transition$/);if(t==="paint"&&M&&x[M[1]]&&x[M[1]].transition)return o({key:n,value:_,valueSpec:g.transition,style:u,styleSpec:g});const E=a.valueSpec||x[v];if(!E)return[new Ve(n,_,`unknown property "${v}"`)];let z;if(Nt(_)==="string"&&gr(E)&&!E.tokens&&(z=/^{([^}]+)}$/.exec(_)))return[new Ve(n,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const k=[];return a.layerType==="symbol"&&v==="text-font"&&nu(ma(_))&&Gi(_.type)==="identity"&&k.push(new Ve(n,_,'"text-font" does not support identity functions')),k.concat(o({key:a.key,value:_,valueSpec:E,style:u,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:v}))}function $a(a){return Qr(a,"paint")}function cu(a){return Qr(a,"layout")}function oc(a){let t=[];const n=a.value,o=a.key,u=a.style,g=a.styleSpec;if(Nt(n)!=="object")return[new Ve(o,n,`object expected, ${Nt(n)} found`)];n.type||n.ref||t.push(new Ve(o,n,'either "type" or "ref" is required'));let _=Gi(n.type);const v=Gi(n.ref);if(n.id){const x=Gi(n.id);for(let M=0;M<a.arrayIndex;M++){const E=u.layers[M];Gi(E.id)===x&&t.push(new Ve(o,n.id,`duplicate layer id "${n.id}", previously used at line ${E.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(M=>{M in n&&t.push(new Ve(o,n[M],`"${M}" is prohibited for ref layers`))}),u.layers.forEach(M=>{Gi(M.id)===v&&(x=M)}),x?x.ref?t.push(new Ve(o,n.ref,"ref cannot reference another ref layer")):_=Gi(x.type):t.push(new Ve(o,n.ref,`ref layer "${v}" not found`))}else if(_!=="background")if(n.source){const x=u.sources&&u.sources[n.source],M=x&&Gi(x.type);x?M==="vector"&&_==="raster"?t.push(new Ve(o,n.source,`layer "${n.id}" requires a raster source`)):M!=="raster-dem"&&_==="hillshade"||M!=="raster-dem"&&_==="color-relief"?t.push(new Ve(o,n.source,`layer "${n.id}" requires a raster-dem source`)):M==="raster"&&_!=="raster"?t.push(new Ve(o,n.source,`layer "${n.id}" requires a vector source`)):M!=="vector"||n["source-layer"]?M==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?t.push(new Ve(o,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_!=="line"||!n.paint||!n.paint["line-gradient"]||M==="geojson"&&x.lineMetrics||t.push(new Ve(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ve(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ve(o,n.source,`source "${n.source}" not found`))}else t.push(new Ve(o,n,'missing required property "source"'));return t=t.concat(Ca({key:o,value:n,valueSpec:g.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${o}.type`,value:n.type,valueSpec:g.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:n,objectKey:"type"}),filter:ws,layout:x=>Ca({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":M=>cu(cn({layerType:_},M))}}),paint:x=>Ca({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":M=>$a(cn({layerType:_},M))}})}})),t}function Ka(a){const t=a.value,n=a.key,o=Nt(t);return o!=="string"?[new Ve(n,t,`string expected, ${o} found`)]:[]}const lc={promoteId:function({key:a,value:t}){if(Nt(t)==="string")return Ka({key:a,value:t});{const n=[];for(const o in t)n.push(...Ka({key:`${a}.${o}`,value:t[o]}));return n}}};function Ts(a){const t=a.value,n=a.key,o=a.styleSpec,u=a.style,g=a.validateSpec;if(!t.type)return[new Ve(n,t,'"type" is required')];const _=Gi(t.type);let v;switch(_){case"vector":case"raster":return v=Ca({key:n,value:t,valueSpec:o[`source_${_.replace("-","_")}`],style:a.style,styleSpec:o,objectElementValidators:lc,validateSpec:g}),v;case"raster-dem":return v=function(x){var M;const E=(M=x.sourceName)!==null&&M!==void 0?M:"",z=x.value,k=x.styleSpec,B=k.source_raster_dem,j=x.style;let Z=[];const $=Nt(z);if(z===void 0)return Z;if($!=="object")return Z.push(new Ve("source_raster_dem",z,`object expected, ${$} found`)),Z;const ee=Gi(z.encoding)==="custom",_e=["redFactor","greenFactor","blueFactor","baseShift"],re=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const ue in z)!ee&&_e.includes(ue)?Z.push(new Ve(ue,z[ue],`In "${E}": "${ue}" is only valid when "encoding" is set to "custom". ${re} encoding found`)):B[ue]?Z=Z.concat(x.validateSpec({key:ue,value:z[ue],valueSpec:B[ue],validateSpec:x.validateSpec,style:j,styleSpec:k})):Z.push(new Ve(ue,z[ue],`unknown property "${ue}"`));return Z}({sourceName:n,value:t,style:a.style,styleSpec:o,validateSpec:g}),v;case"geojson":if(v=Ca({key:n,value:t,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:g,objectElementValidators:lc}),t.cluster)for(const x in t.clusterProperties){const[M,E]=t.clusterProperties[x],z=typeof M=="string"?[M,["accumulated"],["get",x]]:M;v.push(...ro({key:`${n}.${x}.map`,value:E,expressionContext:"cluster-map"})),v.push(...ro({key:`${n}.${x}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return v;case"video":return Ca({key:n,value:t,valueSpec:o.source_video,style:u,validateSpec:g,styleSpec:o});case"image":return Ca({key:n,value:t,valueSpec:o.source_image,style:u,validateSpec:g,styleSpec:o});case"canvas":return[new Ve(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return No({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Fn(a){const t=a.value,n=a.styleSpec,o=n.light,u=a.style;let g=[];const _=Nt(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new Ve("light",t,`object expected, ${_} found`)]),g;for(const v in t){const x=v.match(/^(.*)-transition$/);g=g.concat(x&&o[x[1]]&&o[x[1]].transition?a.validateSpec({key:v,value:t[v],valueSpec:n.transition,validateSpec:a.validateSpec,style:u,styleSpec:n}):o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:a.validateSpec,style:u,styleSpec:n}):[new Ve(v,t[v],`unknown property "${v}"`)])}return g}function Ss(a){const t=a.value,n=a.styleSpec,o=n.sky,u=a.style,g=Nt(t);if(t===void 0)return[];if(g!=="object")return[new Ve("sky",t,`object expected, ${g} found`)];let _=[];for(const v in t)_=_.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],style:u,styleSpec:n}):[new Ve(v,t[v],`unknown property "${v}"`)]);return _}function sh(a){const t=a.value,n=a.styleSpec,o=n.terrain,u=a.style;let g=[];const _=Nt(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new Ve("terrain",t,`object expected, ${_} found`)]),g;for(const v in t)g=g.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:a.validateSpec,style:u,styleSpec:n}):[new Ve(v,t[v],`unknown property "${v}"`)]);return g}function Jh(a){let t=[];const n=a.value,o=a.key;if(Array.isArray(n)){const u=[],g=[];for(const _ in n)n[_].id&&u.includes(n[_].id)&&t.push(new Ve(o,n,`all the sprites' ids must be unique, but ${n[_].id} is duplicated`)),u.push(n[_].id),n[_].url&&g.includes(n[_].url)&&t.push(new Ve(o,n,`all the sprites' URLs must be unique, but ${n[_].url} is duplicated`)),g.push(n[_].url),t=t.concat(Ca({key:`${o}[${_}]`,value:n[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return t}return Ka({key:o,value:n})}function ed(a){return t=a.value,t&&t.constructor===Object?[]:[new Ve(a.key,a.value,`object expected, ${Nt(a.value)} found`)];var t}const td={"*":()=>[],array:Fo,boolean:function(a){const t=a.value,n=a.key,o=Nt(t);return o!=="boolean"?[new Ve(n,t,`boolean expected, ${o} found`)]:[]},number:bs,color:Uo,constants:Aa,enum:No,filter:ws,function:ao,layer:oc,object:Ca,source:Ts,light:Fn,sky:Ss,terrain:sh,projection:function(a){const t=a.value,n=a.styleSpec,o=n.projection,u=a.style,g=Nt(t);if(t===void 0)return[];if(g!=="object")return[new Ve("projection",t,`object expected, ${g} found`)];let _=[];for(const v in t)_=_.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],style:u,styleSpec:n}):[new Ve(v,t[v],`unknown property "${v}"`)]);return _},projectionDefinition:function(a){const t=a.key;let n=a.value;n=n instanceof String?n.valueOf():n;const o=Nt(n);return o!=="array"||function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"}(n)||function(u){return!!["interpolate","step","literal"].includes(u[0])}(n)?["array","string"].includes(o)?[]:[new Ve(t,n,`projection expected, invalid type "${o}" found`)]:[new Ve(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:Ka,formatted:function(a){return Ka(a).length===0?[]:ro(a)},resolvedImage:function(a){return Ka(a).length===0?[]:ro(a)},padding:function(a){const t=a.key,n=a.value;if(Nt(n)==="array"){if(n.length<1||n.length>4)return[new Ve(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let u=[];for(let g=0;g<n.length;g++)u=u.concat(a.validateSpec({key:`${t}[${g}]`,value:n[g],validateSpec:a.validateSpec,valueSpec:o}));return u}return bs({key:t,value:n,valueSpec:{}})},numberArray:function(a){const t=a.key,n=a.value;if(Nt(n)==="array"){const o={type:"number"};if(n.length<1)return[new Ve(t,n,"array length at least 1 expected, length 0 found")];let u=[];for(let g=0;g<n.length;g++)u=u.concat(a.validateSpec({key:`${t}[${g}]`,value:n[g],validateSpec:a.validateSpec,valueSpec:o}));return u}return bs({key:t,value:n,valueSpec:{}})},colorArray:function(a){const t=a.key,n=a.value;if(Nt(n)==="array"){if(n.length<1)return[new Ve(t,n,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<n.length;u++)o=o.concat(Uo({key:`${t}[${u}]`,value:n[u]}));return o}return Uo({key:t,value:n})},variableAnchorOffsetCollection:function(a){const t=a.key,n=a.value,o=Nt(n),u=a.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Ve(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<n.length;_+=2)g=g.concat(No({key:`${t}[${_}]`,value:n[_],valueSpec:u.layout_symbol["text-anchor"]})),g=g.concat(Fo({key:`${t}[${_+1}]`,value:n[_+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:u}));return g},sprite:Jh,state:ed};function hn(a){const t=a.value,n=a.valueSpec,o=a.styleSpec;return a.validateSpec=hn,n.expression&&nu(Gi(t))?ao(a):n.expression&&wl(ma(t))?ro(a):n.type&&td[n.type]?td[n.type](a):Ca(cn({},a,{valueSpec:n.type?o[n.type]:n}))}function uu(a){const t=a.value,n=a.key,o=Ka(a);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Ve(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Ve(n,t,'"glyphs" url must include a "{range}" token'))),o}function Pn(a,t=xe){let n=[];return n=n.concat(hn({key:"",value:a,valueSpec:t.$root,styleSpec:t,style:a,validateSpec:hn,objectElementValidators:{glyphs:uu,"*":()=>[]}})),a.constants&&(n=n.concat(Aa({key:"constants",value:a.constants}))),ga(n)}function Un(a){return function(t){return a(Object.assign({},t,{validateSpec:hn}))}}function ga(a){return[].concat(a).sort((t,n)=>t.line-n.line)}function Dn(a){return function(...t){return ga(a.apply(this,t))}}Pn.source=Dn(Un(Ts)),Pn.sprite=Dn(Un(Jh)),Pn.glyphs=Dn(Un(uu)),Pn.light=Dn(Un(Fn)),Pn.sky=Dn(Un(Ss)),Pn.terrain=Dn(Un(sh)),Pn.state=Dn(Un(ed)),Pn.layer=Dn(Un(oc)),Pn.filter=Dn(Un(ws)),Pn.paintProperty=Dn(Un($a)),Pn.layoutProperty=Dn(Un(cu));const Vo=xe,Tl=Pn,id=Tl.light,cc=Tl.sky,oh=Tl.paintProperty,Ms=Tl.layoutProperty;function hu(a,t){let n=!1;if(t&&t.length)for(const o of t)a.fire(new je(new Error(o.message))),n=!0;return n}class Jr{constructor(t,n,o){const u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(n=_[1])+2*(o=_[2]);for(let x=0;x<this.d*this.d;x++){const M=_[3+x],E=_[3+x+1];u.push(M===E?null:_.subarray(M,E))}const v=_[3+u.length+1];this.keys=_.subarray(_[3+u.length],v),this.bboxes=_.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let _=0;_<this.d*this.d;_++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const g=o/n*t;this.min=-g,this.max=t+g}insert(t,n,o,u,g){this._forEachCell(n,o,u,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,u,g,_){this.cells[g].push(_)}query(t,n,o,u,g){const _=this.min,v=this.max;if(t<=_&&n<=_&&v<=o&&v<=u&&!g)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,n,o,u,this._queryCell,x,{},g),x}}_queryCell(t,n,o,u,g,_,v,x){const M=this.cells[g];if(M!==null){const E=this.keys,z=this.bboxes;for(let k=0;k<M.length;k++){const B=M[k];if(v[B]===void 0){const j=4*B;(x?x(z[j+0],z[j+1],z[j+2],z[j+3]):t<=z[j+2]&&n<=z[j+3]&&o>=z[j+0]&&u>=z[j+1])?(v[B]=!0,_.push(E[B])):v[B]=!1}}}}_forEachCell(t,n,o,u,g,_,v,x){const M=this._convertToCellCoord(t),E=this._convertToCellCoord(n),z=this._convertToCellCoord(o),k=this._convertToCellCoord(u);for(let B=M;B<=z;B++)for(let j=E;j<=k;j++){const Z=this.d*j+B;if((!x||x(this._convertFromCellCoord(B),this._convertFromCellCoord(j),this._convertFromCellCoord(B+1),this._convertFromCellCoord(j+1)))&&g.call(this,t,n,o,u,Z,_,v,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let _=0;_<this.cells.length;_++)o+=this.cells[_].length;const u=new Int32Array(n+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let g=n;for(let _=0;_<t.length;_++){const v=t[_];u[3+_]=g,u.set(v,g),g+=v.length}return u[3+t.length]=g,u.set(this.keys,g),g+=this.keys.length,u[3+t.length+1]=g,u.set(this.bboxes,g),g+=this.bboxes.length,u.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new Jr(t.buffer)}}const es={};function rt(a,t,n={}){if(es[a])throw new Error(`${a} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:a,writeable:!1}),es[a]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}rt("Object",Object),rt("Set",Set),rt("TransferableGridIndex",Jr),rt("Color",Dt),rt("Error",Error),rt("AJAXError",ie),rt("ResolvedImage",aa),rt("StylePropertyFunction",Oo),rt("StyleExpression",ou,{omit:["_evaluator"]}),rt("ZoomDependentExpression",io),rt("ZoomConstantExpression",pa),rt("CompoundExpression",Ha,{omit:["_evaluate"]});for(const a in xl)xl[a]._classRegistryKey||rt(`Expression_${a}`,xl[a]);function du(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Sl(a){return a.$name||a.constructor._classRegistryKey}function uc(a){return!function(t){if(t===null||typeof t!="object")return!1;const n=Sl(t);return!(!n||n==="Object")}(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||du(a)||rr(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function ts(a,t){if(uc(a))return(du(a)||rr(a))&&t&&t.push(a),ArrayBuffer.isView(a)&&t&&t.push(a.buffer),a instanceof ImageData&&t&&t.push(a.data.buffer),a;if(Array.isArray(a)){const g=[];for(const _ of a)g.push(ts(_,t));return g}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);const n=Sl(a);if(!n)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!es[n])throw new Error(`${n} is not registered.`);const{klass:o}=es[n],u=o.serialize?o.serialize(a,t):{};if(o.serialize){if(t&&u===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in a){if(!a.hasOwnProperty(g)||es[n].omit.indexOf(g)>=0)continue;const _=a[g];u[g]=es[n].shallow.indexOf(g)>=0?_:ts(_,t)}a instanceof Error&&(u.message=a.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(u.$name=n),u}function Ml(a){if(uc(a))return a;if(Array.isArray(a))return a.map(Ml);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);const t=Sl(a)||"Object";if(!es[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=es[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(a);const o=Object.create(n.prototype);for(const u of Object.keys(a)){if(u==="$name")continue;const g=a[u];o[u]=es[t].shallow.indexOf(u)>=0?g:Ml(g)}return o}class Es{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const jt={"Latin-1 Supplement":a=>a>=128&&a<=255,"Hangul Jamo":a=>a>=4352&&a<=4607,Khmer:a=>a>=6016&&a<=6143,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Kanbun:a=>a>=12688&&a<=12703,"CJK Strokes":a=>a>=12736&&a<=12783,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Hangul Syllables":a=>a>=44032&&a<=55215,"Private Use Area":a=>a>=57344&&a<=63743,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function fu(a){for(const t of a)if(Zo(t.charCodeAt(0)))return!0;return!1}function pu(a){for(const t of a)if(!hc(t.charCodeAt(0)))return!1;return!0}function Rr(a){const t=a.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const El=Rr(["Arab","Dupl","Mong","Ougr","Syrc"]);function hc(a){return!El.test(String.fromCodePoint(a))}const Go=Rr(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Zo(a){return!(a!==746&&a!==747&&(a<4352||!(jt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||jt["CJK Compatibility"](a)||jt["CJK Strokes"](a)||!(!jt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||jt["Enclosed CJK Letters and Months"](a)||jt["Ideographic Description Characters"](a)||jt.Kanbun(a)||jt.Katakana(a)&&a!==12540||!(!jt["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!jt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||jt["Vertical Forms"](a)||jt["Yijing Hexagram Symbols"](a)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(a))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(a))||Go.test(String.fromCodePoint(a)))))}function dc(a){return!(Zo(a)||function(t){return!!(jt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||jt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||jt["Letterlike Symbols"](t)||jt["Number Forms"](t)||jt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||jt["Control Pictures"](t)&&t!==9251||jt["Optical Character Recognition"](t)||jt["Enclosed Alphanumerics"](t)||jt["Geometric Shapes"](t)||jt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||jt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||jt["CJK Symbols and Punctuation"](t)||jt.Katakana(t)||jt["Private Use Area"](t)||jt["CJK Compatibility Forms"](t)||jt["Small Form Variants"](t)||jt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(a))}const so=Rr(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function lh(a){return so.test(String.fromCodePoint(a))}function As(a,t){return!(!t&&lh(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||jt.Khmer(a))}function ch(a){for(const t of a)if(lh(t.charCodeAt(0)))return!0;return!1}const Lr=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){if(Lr.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(a,t){return d(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(a.pluginStatus!=="loading")return this.setState(a),a;const n=a.pluginURL,o=new Promise(g=>{this.loadScriptResolve=g});t(n);const u=new Promise(g=>setTimeout(()=>g(),this.TIMEOUT));if(yield Promise.race([o,u]),this.isParsed()){const g={pluginStatus:"loaded",pluginURL:n};return this.setState(g),g}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)})}};class ri{constructor(t,n){this.isSupportedScript=Cs,this.zoom=t,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new Es,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Es,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}function Cs(a){return function(t,n){for(const o of t)if(!As(o.charCodeAt(0),n))return!1;return!0}(a,Lr.getRTLTextPluginStatus()==="loaded")}class zs{constructor(t,n,o){this.property=t,this.value=n,this.expression=function(u,g,_){if(nu(u))return new Oo(u,g);if(wl(u)){const v=Bo(u,g,_);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=u;return g.type==="color"&&typeof u=="string"?v=Dt.parse(u):g.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?g.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?g.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?v=tn.parse(u):g.type==="projectionDefinition"&&typeof u=="string"&&(v=ra.parse(u)):v=un.parse(u):v=Zn.parse(u):v=bn.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>v}}}(n===void 0?t.specification.default:n,t.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class fc{constructor(t,n){this.property=t,this.value=new zs(t,void 0,n)}transitioned(t,n){return new qo(this.property,this.value,n,fi({},t.transition,this.transition),t.now)}untransitioned(){return new qo(this.property,this.value,null,{},0)}}class mu{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=n}getValue(t){return ta(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new fc(this._values[t].property,this._globalState)),this._values[t].value=new zs(this._values[t].property,n===null?void 0:ta(n),this._globalState)}getTransition(t){return ta(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new fc(this._values[t].property,this._globalState)),this._values[t].transition=ta(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const u=this.getTransition(n);u!==void 0&&(t[`${n}-transition`]=u)}return t}transitioned(t,n){const o=new Ho(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(t,n._values[u]);return o}untransitioned(){const t=new Ho(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class qo{constructor(t,n,o,u,g){this.property=t,this.value=n,this.begin=g+u.delay||0,this.end=this.begin+u.duration||0,t.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const u=t.now||0,g=this.value.possiblyEvaluate(t,n,o),_=this.prior;if(_){if(u>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(u<this.begin)return _.possiblyEvaluate(t,n,o);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,n,o),g,st(v))}}return g}}class Ho{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const u=new yr(this._properties);for(const g of Object.keys(this._values))u._values[g]=this._values[g].possiblyEvaluate(t,n,o);return u}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class uh{constructor(t,n){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=n}hasValue(t){return this._values[t].value!==void 0}getValue(t){return ta(this._values[t].value)}setValue(t,n){this._values[t]=new zs(this._values[t].property,n===null?void 0:ta(n),this._globalState)}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const u=new yr(this._properties);for(const g of Object.keys(this._values))u._values[g]=this._values[g].possiblyEvaluate(t,n,o);return u}}class _r{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,u){return this.property.evaluate(this.value,this.parameters,t,n,o,u)}}class yr{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class ht{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const u=dr[this.specification.type];return u?u(t,n,o):t}}class xt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,u){return new _r(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,u)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new _r(this,{kind:"constant",value:void 0},t.parameters);const u=dr[this.specification.type];if(u){const g=u(t.value.value,n.value.value,o);return new _r(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,n,o,u,g,_){return t.kind==="constant"?t.value:t.evaluate(n,o,u,g,_)}}class Xo extends xt{possiblyEvaluate(t,n,o,u){if(t.value===void 0)return new _r(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const g=t.expression.evaluate(n,null,{},o,u),_=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,v=this._calculate(_,_,_,n);return new _r(this,{kind:"constant",value:v},n)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new _r(this,{kind:"constant",value:g},n)}return new _r(this,t.expression,n)}evaluate(t,n,o,u,g,_){if(t.kind==="source"){const v=t.evaluate(n,o,u,g,_);return this._calculate(v,v,v,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,u),t.evaluate({zoom:Math.floor(n.zoom)},o,u),t.evaluate({zoom:Math.floor(n.zoom)+1},o,u),n):t.value}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class gu{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(n,null,{},o,u);return this._calculate(g,g,g,n)}return this._calculate(t.expression.evaluate(new ri(Math.floor(n.zoom-1),n)),t.expression.evaluate(new ri(Math.floor(n.zoom),n)),t.expression.evaluate(new ri(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class oa{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,u){return!!t.expression.evaluate(n,null,{},o,u)}interpolate(){return!1}}class Oi{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const u=this.defaultPropertyValues[n]=new zs(o,void 0,void 0),g=this.defaultTransitionablePropertyValues[n]=new fc(o,void 0);this.defaultTransitioningPropertyValues[n]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=u.possiblyEvaluate({})}}}rt("DataDrivenProperty",xt),rt("DataConstantProperty",ht),rt("CrossFadedDataDrivenProperty",Xo),rt("CrossFadedProperty",gu),rt("ColorRampProperty",oa);const is="-transition";class Wa extends dt{constructor(t,n,o){if(super(),this.id=t.id,this.type=t.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Oa(t.filter,o)),n.layout&&(this._unevaluatedLayout=new uh(n.layout,o)),n.paint)){this._transitionablePaint=new mu(n.paint,o);for(const u in t.paint)this.setPaintProperty(u,t.paint[u],{validate:!1});for(const u in t.layout)this.setLayoutProperty(u,t.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new yr(n.paint)}}setFilter(t){this.filter=t,this._featureFilter=Oa(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[n];for(const u of o.getGlobalStateRefs())t.add(u)}for(const n of this._featureFilter.getGlobalStateRefs())t.add(n);return t}getPaintAffectingGlobalStateRefs(){var t;const n=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const g of u.getGlobalStateRefs()){const _=(t=n.get(g))!==null&&t!==void 0?t:[];_.push({name:o,value:u.value}),n.set(g,_)}}return n}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Ms,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(is)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(oh,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(is))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const u=this._transitionablePaint._values[t],g=u.property.specification["property-type"]==="cross-faded-data-driven",_=u.value.isDataDriven(),v=u.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(t,v,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t,n=!1){return!!(this.minzoom&&t<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Mr(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,u,g={}){return(!g||g.validate!==!1)&&hu(this,t.call(Tl,{key:n,layerType:this.type,objectKey:o,value:u,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof _r&&gr(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let hh;var oo={get paint(){return hh=hh||new Oi({"raster-opacity":new ht(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new ht(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ht(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ht(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new ht(xe.paint_raster["raster-saturation"]),"raster-contrast":new ht(xe.paint_raster["raster-contrast"]),"raster-resampling":new ht(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new ht(xe.paint_raster["raster-fade-duration"])})}};class Qa extends Wa{constructor(t,n){super(t,oo,n)}}const wn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ja{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class di{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function gt(a,t=1){let n=0,o=0;return{members:a.map(u=>{const g=wn[u.type].BYTES_PER_ELEMENT,_=n=Ti(n,Math.max(t,g)),v=u.components||1;return o=Math.max(o,g),n+=g*v,{name:u.name,type:u.type,components:v,offset:_}}),size:Ti(n,Math.max(o,t)),alignment:t}}function Ti(a,t){return Math.ceil(a/t)*t}class Ki extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.int16[u+0]=n,this.int16[u+1]=o,t}}Ki.prototype.bytesPerElement=4,rt("StructArrayLayout2i4",Ki);class Yo extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const g=3*t;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=u,t}}Yo.prototype.bytesPerElement=6,rt("StructArrayLayout3i6",Yo);class lo extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,u)}emplace(t,n,o,u,g){const _=4*t;return this.int16[_+0]=n,this.int16[_+1]=o,this.int16[_+2]=u,this.int16[_+3]=g,t}}lo.prototype.bytesPerElement=8,rt("StructArrayLayout4i8",lo);class za extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,g,_)}emplace(t,n,o,u,g,_,v){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=g,this.int16[x+4]=_,this.int16[x+5]=v,t}}za.prototype.bytesPerElement=12,rt("StructArrayLayout2i4i12",za);class $o extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,g,_)}emplace(t,n,o,u,g,_,v){const x=4*t,M=8*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.uint8[M+4]=u,this.uint8[M+5]=g,this.uint8[M+6]=_,this.uint8[M+7]=v,t}}$o.prototype.bytesPerElement=8,rt("StructArrayLayout2i4ub8",$o);class kr extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.float32[u+0]=n,this.float32[u+1]=o,t}}kr.prototype.bytesPerElement=8,rt("StructArrayLayout2f8",kr);class Ps extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,g,_,v,x,M,E){const z=this.length;return this.resize(z+1),this.emplace(z,t,n,o,u,g,_,v,x,M,E)}emplace(t,n,o,u,g,_,v,x,M,E,z){const k=10*t;return this.uint16[k+0]=n,this.uint16[k+1]=o,this.uint16[k+2]=u,this.uint16[k+3]=g,this.uint16[k+4]=_,this.uint16[k+5]=v,this.uint16[k+6]=x,this.uint16[k+7]=M,this.uint16[k+8]=E,this.uint16[k+9]=z,t}}Ps.prototype.bytesPerElement=20,rt("StructArrayLayout10ui20",Ps);class pc extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,g,_,v,x){const M=this.length;return this.resize(M+1),this.emplace(M,t,n,o,u,g,_,v,x)}emplace(t,n,o,u,g,_,v,x,M){const E=8*t;return this.uint16[E+0]=n,this.uint16[E+1]=o,this.uint16[E+2]=u,this.uint16[E+3]=g,this.uint16[E+4]=_,this.uint16[E+5]=v,this.uint16[E+6]=x,this.uint16[E+7]=M,t}}pc.prototype.bytesPerElement=16,rt("StructArrayLayout8ui16",pc);class nn extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,g,_,v,x,M,E,z,k){const B=this.length;return this.resize(B+1),this.emplace(B,t,n,o,u,g,_,v,x,M,E,z,k)}emplace(t,n,o,u,g,_,v,x,M,E,z,k,B){const j=12*t;return this.int16[j+0]=n,this.int16[j+1]=o,this.int16[j+2]=u,this.int16[j+3]=g,this.uint16[j+4]=_,this.uint16[j+5]=v,this.uint16[j+6]=x,this.uint16[j+7]=M,this.int16[j+8]=E,this.int16[j+9]=z,this.int16[j+10]=k,this.int16[j+11]=B,t}}nn.prototype.bytesPerElement=24,rt("StructArrayLayout4i4ui4i24",nn);class co extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const g=3*t;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=u,t}}co.prototype.bytesPerElement=12,rt("StructArrayLayout3f12",co);class Ds extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}Ds.prototype.bytesPerElement=4,rt("StructArrayLayout1ul4",Ds);class _u extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,g,_,v,x,M){const E=this.length;return this.resize(E+1),this.emplace(E,t,n,o,u,g,_,v,x,M)}emplace(t,n,o,u,g,_,v,x,M,E){const z=10*t,k=5*t;return this.int16[z+0]=n,this.int16[z+1]=o,this.int16[z+2]=u,this.int16[z+3]=g,this.int16[z+4]=_,this.int16[z+5]=v,this.uint32[k+3]=x,this.uint16[z+8]=M,this.uint16[z+9]=E,t}}_u.prototype.bytesPerElement=20,rt("StructArrayLayout6i1ul2ui20",_u);class mc extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,g,_)}emplace(t,n,o,u,g,_,v){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=g,this.int16[x+4]=_,this.int16[x+5]=v,t}}mc.prototype.bytesPerElement=12,rt("StructArrayLayout2i2i2i12",mc);class Ko extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,u,g)}emplace(t,n,o,u,g,_){const v=4*t,x=8*t;return this.float32[v+0]=n,this.float32[v+1]=o,this.float32[v+2]=u,this.int16[x+6]=g,this.int16[x+7]=_,t}}Ko.prototype.bytesPerElement=16,rt("StructArrayLayout2f1f2i16",Ko);class gc extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,u,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,u,g,_)}emplace(t,n,o,u,g,_,v){const x=16*t,M=4*t,E=8*t;return this.uint8[x+0]=n,this.uint8[x+1]=o,this.float32[M+1]=u,this.float32[M+2]=g,this.int16[E+6]=_,this.int16[E+7]=v,t}}gc.prototype.bytesPerElement=16,rt("StructArrayLayout2ub2f2i16",gc);class Al extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const g=3*t;return this.uint16[g+0]=n,this.uint16[g+1]=o,this.uint16[g+2]=u,t}}Al.prototype.bytesPerElement=6,rt("StructArrayLayout3ui6",Al);class Cl extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,g,_,v,x,M,E,z,k,B,j,Z,$,ee){const _e=this.length;return this.resize(_e+1),this.emplace(_e,t,n,o,u,g,_,v,x,M,E,z,k,B,j,Z,$,ee)}emplace(t,n,o,u,g,_,v,x,M,E,z,k,B,j,Z,$,ee,_e){const re=24*t,ue=12*t,Me=48*t;return this.int16[re+0]=n,this.int16[re+1]=o,this.uint16[re+2]=u,this.uint16[re+3]=g,this.uint32[ue+2]=_,this.uint32[ue+3]=v,this.uint32[ue+4]=x,this.uint16[re+10]=M,this.uint16[re+11]=E,this.uint16[re+12]=z,this.float32[ue+7]=k,this.float32[ue+8]=B,this.uint8[Me+36]=j,this.uint8[Me+37]=Z,this.uint8[Me+38]=$,this.uint32[ue+10]=ee,this.int16[re+22]=_e,t}}Cl.prototype.bytesPerElement=48,rt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Cl);class la extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u,g,_,v,x,M,E,z,k,B,j,Z,$,ee,_e,re,ue,Me,ke,Xe,at,Qe,it,ft,nt){const tt=this.length;return this.resize(tt+1),this.emplace(tt,t,n,o,u,g,_,v,x,M,E,z,k,B,j,Z,$,ee,_e,re,ue,Me,ke,Xe,at,Qe,it,ft,nt)}emplace(t,n,o,u,g,_,v,x,M,E,z,k,B,j,Z,$,ee,_e,re,ue,Me,ke,Xe,at,Qe,it,ft,nt,tt){const Ue=32*t,Mt=16*t;return this.int16[Ue+0]=n,this.int16[Ue+1]=o,this.int16[Ue+2]=u,this.int16[Ue+3]=g,this.int16[Ue+4]=_,this.int16[Ue+5]=v,this.int16[Ue+6]=x,this.int16[Ue+7]=M,this.uint16[Ue+8]=E,this.uint16[Ue+9]=z,this.uint16[Ue+10]=k,this.uint16[Ue+11]=B,this.uint16[Ue+12]=j,this.uint16[Ue+13]=Z,this.uint16[Ue+14]=$,this.uint16[Ue+15]=ee,this.uint16[Ue+16]=_e,this.uint16[Ue+17]=re,this.uint16[Ue+18]=ue,this.uint16[Ue+19]=Me,this.uint16[Ue+20]=ke,this.uint16[Ue+21]=Xe,this.uint16[Ue+22]=at,this.uint32[Mt+12]=Qe,this.float32[Mt+13]=it,this.float32[Mt+14]=ft,this.uint16[Ue+30]=nt,this.uint16[Ue+31]=tt,t}}la.prototype.bytesPerElement=64,rt("StructArrayLayout8i15ui1ul2f2ui64",la);class f extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}f.prototype.bytesPerElement=4,rt("StructArrayLayout1f4",f);class e extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const g=3*t;return this.uint16[6*t+0]=n,this.float32[g+1]=o,this.float32[g+2]=u,t}}e.prototype.bytesPerElement=12,rt("StructArrayLayout1ui2f12",e);class r extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const u=this.length;return this.resize(u+1),this.emplace(u,t,n,o)}emplace(t,n,o,u){const g=4*t;return this.uint32[2*t+0]=n,this.uint16[g+2]=o,this.uint16[g+3]=u,t}}r.prototype.bytesPerElement=8,rt("StructArrayLayout1ul2ui8",r);class l extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const u=2*t;return this.uint16[u+0]=n,this.uint16[u+1]=o,t}}l.prototype.bytesPerElement=4,rt("StructArrayLayout2ui4",l);class h extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}h.prototype.bytesPerElement=2,rt("StructArrayLayout1ui2",h);class m extends di{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,u){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,u)}emplace(t,n,o,u,g){const _=4*t;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=u,this.float32[_+3]=g,t}}m.prototype.bytesPerElement=16,rt("StructArrayLayout4f16",m);class y extends Ja{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new be(this.anchorPointX,this.anchorPointY)}}y.prototype.size=20;class w extends _u{get(t){return new y(this,t)}}rt("CollisionBoxArray",w);class T extends Ja{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}T.prototype.size=48;class A extends Cl{get(t){return new T(this,t)}}rt("PlacedSymbolArray",A);class C extends Ja{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}C.prototype.size=64;class I extends la{get(t){return new C(this,t)}}rt("SymbolInstanceArray",I);class D extends f{getoffsetX(t){return this.float32[1*t+0]}}rt("GlyphOffsetArray",D);class O extends Yo{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}rt("SymbolLineVertexArray",O);class G extends Ja{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}G.prototype.size=12;class K extends e{get(t){return new G(this,t)}}rt("TextAnchorOffsetArray",K);class W extends Ja{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}W.prototype.size=8;class Q extends r{get(t){return new W(this,t)}}rt("FeatureIndexArray",Q);class ne extends Ki{}class se extends Ki{}class te extends Ki{}class oe extends za{}class de extends $o{}class ae extends kr{}class fe extends Ps{}class Pe extends pc{}class Se extends nn{}class Ce extends co{}class Ie extends Ds{}class Ke extends mc{}class We extends gc{}class Fe extends Al{}class lt extends l{}const Lt=gt([{name:"a_pos",components:2,type:"Int16"}],4),{members:ui}=Lt;class Vt{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,o,u){const g=this.segments[this.segments.length-1];return t>Vt.MAX_VERTEX_ARRAY_LENGTH&&ki(`Max vertices per segment is ${Vt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Vt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!g||g.vertexLength+t>Vt.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==u?this.createNewSegment(n,o,u):g}createNewSegment(t,n,o){const u={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(t,n,o){return this.prepareSegment(0,t,n,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,u){return new Vt([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function Si(a,t){return 256*(a=wt(Math.floor(a),0,255))+wt(Math.floor(t),0,255)}Vt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rt("SegmentVector",Vt);const Wi=gt([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Di=gt([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Tn,Zi,In,qi={exports:{}},mn={exports:{}},ca={exports:{}},uo=function(){if(In)return qi.exports;In=1;var a=(Tn||(Tn=1,mn.exports=function(n,o){var u,g,_,v,x,M,E,z;for(g=n.length-(u=3&n.length),_=o,x=3432918353,M=461845907,z=0;z<g;)E=255&n.charCodeAt(z)|(255&n.charCodeAt(++z))<<8|(255&n.charCodeAt(++z))<<16|(255&n.charCodeAt(++z))<<24,++z,_=27492+(65535&(v=5*(65535&(_=(_^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*M+(((E>>>16)*M&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(E=0,u){case 3:E^=(255&n.charCodeAt(z+2))<<16;case 2:E^=(255&n.charCodeAt(z+1))<<8;case 1:_^=E=(65535&(E=(E=(65535&(E^=255&n.charCodeAt(z)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*M+(((E>>>16)*M&65535)<<16)&4294967295}return _^=n.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),mn.exports),t=(Zi||(Zi=1,ca.exports=function(n,o){for(var u,g=n.length,_=o^g,v=0;g>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(v)|(255&n.charCodeAt(++v))<<8|(255&n.charCodeAt(++v))<<16|(255&n.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),g-=4,++v;switch(g){case 3:_^=(255&n.charCodeAt(v+2))<<16;case 2:_^=(255&n.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&n.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),ca.exports);return qi.exports=a,qi.exports.murmur3=a,qi.exports.murmur2=t,qi.exports}(),ns=Ae(uo);class as{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,u){this.ids.push(Is(t)),this.positions.push(n,o,u)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Is(t);let o=0,u=this.ids.length-1;for(;o<u;){const _=o+u>>1;this.ids[_]>=n?u=_:o=_+1}const g=[];for(;this.ids[o]===n;)g.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return g}static serialize(t,n){const o=new Float64Array(t.ids),u=new Uint32Array(t.positions);return Wo(o,u,0,o.length-1),n&&n.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(t){const n=new as;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function Is(a){const t=+a;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ns(String(a))}function Wo(a,t,n,o){for(;n<o;){const u=a[n+o>>1];let g=n-1,_=o+1;for(;;){do g++;while(a[g]<u);do _--;while(a[_]>u);if(g>=_)break;ho(a,g,_),ho(t,3*g,3*_),ho(t,3*g+1,3*_+1),ho(t,3*g+2,3*_+2)}_-n<o-_?(Wo(a,t,n,_),n=_+1):(Wo(a,t,_+1,o),o=_)}}function ho(a,t,n){const o=a[t];a[t]=a[n],a[n]=o}rt("FeaturePositionMap",as);class _a{constructor(t,n){this.gl=t.gl,this.location=n}}class ya extends _a{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class rs extends _a{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class fo extends _a{constructor(t,n){super(t,n),this.current=Dt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const _c=new Float32Array(16);function gn(a){return[Si(255*a.r,255*a.g),Si(255*a.b,255*a.a)]}class Hi{constructor(t,n,o){this.value=t,this.uniformNames=n.map(u=>`u_${u}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new fo(t,n):new ya(t,n)}}class Rn{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setConstantDashPositions(t,n){this.dashTo=[0,t.y,t.height,t.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(t,n,o,u){let g=null;u==="u_pattern_to"?g=this.patternTo:u==="u_pattern_from"?g=this.patternFrom:u==="u_dasharray_to"?g=this.dashTo:u==="u_dasharray_from"?g=this.dashFrom:u==="u_pixel_ratio_to"?g=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(g=this.pixelRatioFrom),g!==null&&t.set(g)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new rs(t,n):new ya(t,n)}}class Mi{constructor(t,n,o,u){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(t,n,o){const u=this.paintVertexArray.length,g=this.expression.evaluate(new ri(0,o),n,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(u,t,g)}updatePaintArray(t,n,o,u,g){const _=this.expression.evaluate(new ri(0,g),o,u);this._setPaintValue(t,n,_)}_setPaintValue(t,n,o){if(this.type==="color"){const u=gn(o);for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,u[0],u[1])}else{for(let u=t;u<n;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class vr{constructor(t,n,o,u,g,_){this.expression=t,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=o,this.useIntegerZoom=u,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,n,o){const u=this.expression.evaluate(new ri(this.zoom,o),n,{},o.canonical,[],o.formattedSection),g=this.expression.evaluate(new ri(this.zoom+1,o),n,{},o.canonical,[],o.formattedSection),_=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(_,t,u,g)}updatePaintArray(t,n,o,u,g){const _=this.expression.evaluate(new ri(this.zoom,g),o,u),v=this.expression.evaluate(new ri(this.zoom+1,g),o,u);this._setPaintValue(t,n,_,v)}_setPaintValue(t,n,o,u){if(this.type==="color"){const g=gn(o),_=gn(u);for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,g[0],g[1],_[0],_[1])}else{for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,u=wt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(u)}getBinding(t,n,o){return new ya(t,n)}}class Rs{constructor(t,n,o,u,g,_){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=u,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,n,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(u,t,this.getPositionIds(n),o)}updatePaintArray(t,n,o,u,g){this._setPaintValues(t,n,this.getPositionIds(o),g)}_setPaintValues(t,n,o,u){const g=this.getPositions(u);if(!g||!o)return;const _=g[o.min],v=g[o.mid],x=g[o.max];if(_&&v&&x)for(let M=t;M<n;M++)this.emplace(this.zoomInPaintVertexArray,M,v,_),this.emplace(this.zoomOutPaintVertexArray,M,v,x)}upload(t){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class zl extends Rs{getPositions(t){return t.imagePositions}getPositionIds(t){return t.patterns&&t.patterns[this.layerId]}getVertexAttributes(){return Wi.members}emplace(t,n,o,u){t.emplace(n,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class dh extends Rs{getPositions(t){return t.dashPositions}getPositionIds(t){return t.dashes&&t.dashes[this.layerId]}getVertexAttributes(){return Di.members}emplace(t,n,o,u){t.emplace(n,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class yu{constructor(t,n,o){this.binders={},this._buffers=[];const u=[];for(const g in t.paint._values){if(!o(g))continue;const _=t.paint.get(g);if(!(_ instanceof _r&&gr(_.property.specification)))continue;const v=Ls(g,t.type),x=_.value,M=_.property.specification.type,E=_.property.useIntegerZoom,z=_.property.specification["property-type"],k=z==="cross-faded"||z==="cross-faded-data-driven";if(x.kind==="constant")this.binders[g]=k?new Rn(x.value,v):new Hi(x.value,v,M),u.push(`/u_${g}`);else if(x.kind==="source"||k){const B=yc(g,M,"source");this.binders[g]=k?g==="line-dasharray"?new dh(x,M,E,n,B,t.id):new zl(x,M,E,n,B,t.id):new Mi(x,v,M,B),u.push(`/a_${g}`)}else{const B=yc(g,M,"composite");this.binders[g]=new vr(x,v,M,E,n,B),u.push(`/z_${g}`)}}this.cacheKey=u.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Mi||n instanceof vr?n.maxValue:0}populatePaintArrays(t,n,o){for(const u in this.binders){const g=this.binders[u];(g instanceof Mi||g instanceof vr||g instanceof Rs)&&g.populatePaintArray(t,n,o)}}setConstantPatternPositions(t,n){for(const o in this.binders){const u=this.binders[o];u instanceof Rn&&u.setConstantPatternPositions(t,n)}}setConstantDashPositions(t,n){for(const o in this.binders){const u=this.binders[o];u instanceof Rn&&u.setConstantDashPositions(t,n)}}updatePaintArrays(t,n,o,u,g){let _=!1;for(const v in t){const x=n.getPositions(v);for(const M of x){const E=o.feature(M.index);for(const z in this.binders){const k=this.binders[z];if((k instanceof Mi||k instanceof vr||k instanceof Rs)&&k.expression.isStateDependent===!0){const B=u.paint.get(z);k.expression=B.value,k.updatePaintArray(M.start,M.end,E,t[v],g),_=!0}}}}return _}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Hi||o instanceof Rn)&&t.push(...o.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Mi||o instanceof vr)for(let u=0;u<o.paintVertexAttributes.length;u++)t.push(o.paintVertexAttributes[u].name);else if(o instanceof Rs){const u=o.getVertexAttributes();for(const g of u)t.push(g.name)}}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Hi||o instanceof Rn||o instanceof vr)for(const u of o.uniformNames)t.push(u)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const u in this.binders){const g=this.binders[u];if(g instanceof Hi||g instanceof Rn||g instanceof vr){for(const _ of g.uniformNames)if(n[_]){const v=g.getBinding(t,n[_],_);o.push({name:_,property:u,binding:v})}}}return o}setUniforms(t,n,o,u){for(const{name:g,property:_,binding:v}of n)this.binders[_].setUniform(v,u,o.get(_),g)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof Rs){const u=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Mi||o instanceof vr)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof Mi||o instanceof vr||o instanceof Rs)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Mi||n instanceof vr||n instanceof Rs)&&n.destroy()}}}class po{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const u of t)this.programConfigurations[u.id]=new yu(u,n,o);this.needsUpload=!1,this._featureMap=new as,this._bufferOffset=0}populatePaintArrays(t,n,o,u){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(t,n,u);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,u){for(const g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,n,g,u)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Ls(a,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}function yc(a,t,n){const o={color:{source:kr,composite:m},number:{source:f,composite:kr}},u=function(g){return{"line-pattern":{source:fe,composite:fe},"fill-pattern":{source:fe,composite:fe},"fill-extrusion-pattern":{source:fe,composite:fe},"line-dasharray":{source:Pe,composite:Pe}}[g]}(a);return u&&u[n]||o[t][n]}rt("ConstantBinder",Hi),rt("CrossFadedConstantBinder",Rn),rt("SourceExpressionBinder",Mi),rt("CrossFadedPatternBinder",zl),rt("CrossFadedDasharrayBinder",dh),rt("CompositeExpressionBinder",vr),rt("ProgramConfiguration",yu,{omit:["_buffers"]}),rt("ProgramConfigurationSet",po);const vc=Math.pow(2,14)-1,vu=-vc-1;function Pa(a){const t=pt/a.extent,n=a.loadGeometry();for(let o=0;o<n.length;o++){const u=n[o];for(let g=0;g<u.length;g++){const _=u[g],v=Math.round(_.x*t),x=Math.round(_.y*t);_.x=wt(v,vu,vc),_.y=wt(x,vu,vc),(v<_.x||v>_.x+1||x<_.y||x>_.y+1)&&ki("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function ks(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?Pa(a):[]}}const xc=-32768;function tp(a,t,n,o,u){a.emplaceBack(xc+8*t+o,xc+8*n+u)}class xu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new se,this.indexArray=new Fe,this.segments=new Vt,this.programConfigurations=new po(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const u=this.layers[0],g=[];let _=null,v=!1,x=u.type==="heatmap";if(u.type==="circle"){const E=u;_=E.layout.get("circle-sort-key"),v=!_.isConstant(),x=x||E.paint.get("circle-pitch-alignment")==="map"}const M=x?n.subdivisionGranularity.circle:1;for(const{feature:E,id:z,index:k,sourceLayerIndex:B}of t){const j=this.layers[0]._featureFilter.needGeometry,Z=ks(E,j);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),Z,o))continue;const $=v?_.evaluate(Z,{},o):void 0,ee={id:z,properties:E.properties,type:E.type,sourceLayerIndex:B,index:k,geometry:j?Z.geometry:Pa(E),patterns:{},sortKey:$};g.push(ee)}v&&g.sort((E,z)=>E.sortKey-z.sortKey);for(const E of g){const{geometry:z,index:k,sourceLayerIndex:B}=E,j=t[k].feature;this.addFeature(E,z,k,o,M),n.featureIndex.insert(j,z,k,B,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ui),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,u,g=1){let _;switch(g){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${g}; valid values are 1, 3, 5, 7.`)}const v=_.length;for(const x of n)for(const M of x){const E=M.x,z=M.y;if(E<0||E>=pt||z<0||z>=pt)continue;const k=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,t.sortKey),B=k.vertexLength;for(let j=0;j<v;j++)for(let Z=0;Z<v;Z++)tp(this.layoutVertexArray,E,z,_[Z],_[j]);for(let j=0;j<v-1;j++)for(let Z=0;Z<v-1;Z++){const $=B+j*v+Z,ee=B+(j+1)*v+Z;this.indexArray.emplaceBack($,ee+1,$+1),this.indexArray.emplaceBack($,ee,ee+1)}k.vertexLength+=v*v,k.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:{},canonical:u})}}function Hd(a,t){for(let n=0;n<a.length;n++)if(bc(t,a[n]))return!0;for(let n=0;n<t.length;n++)if(bc(a,t[n]))return!0;return!!Yd(a,t)}function bu(a,t,n){return!!bc(a,t)||!!Ln(t,a,n)}function Xd(a,t){if(a.length===1)return Kd(t,a[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let u=0;u<o.length;u++)if(bc(a,o[u]))return!0}for(let n=0;n<a.length;n++)if(Kd(t,a[n]))return!0;for(let n=0;n<t.length;n++)if(Yd(a,t[n]))return!0;return!1}function ip(a,t,n){if(a.length>1){if(Yd(a,t))return!0;for(let o=0;o<t.length;o++)if(Ln(t[o],a,n))return!0}for(let o=0;o<a.length;o++)if(Ln(a[o],t,n))return!0;return!1}function Yd(a,t){if(a.length===0||t.length===0)return!1;for(let n=0;n<a.length-1;n++){const o=a[n],u=a[n+1];for(let g=0;g<t.length-1;g++)if($d(o,u,t[g],t[g+1]))return!0}return!1}function $d(a,t,n,o){return Za(a,n,o)!==Za(t,n,o)&&Za(a,t,n)!==Za(a,t,o)}function Ln(a,t,n){const o=n*n;if(t.length===1)return a.distSqr(t[0])<o;for(let u=1;u<t.length;u++)if(va(a,t[u-1],t[u])<o)return!0;return!1}function va(a,t,n){const o=t.distSqr(n);if(o===0)return a.distSqr(t);const u=((a.x-t.x)*(n.x-t.x)+(a.y-t.y)*(n.y-t.y))/o;return a.distSqr(u<0?t:u>1?n:n.sub(t)._mult(u)._add(t))}function Kd(a,t){let n,o,u,g=!1;for(let _=0;_<a.length;_++){n=a[_];for(let v=0,x=n.length-1;v<n.length;x=v++)o=n[v],u=n[x],o.y>t.y!=u.y>t.y&&t.x<(u.x-o.x)*(t.y-o.y)/(u.y-o.y)+o.x&&(g=!g)}return g}function bc(a,t){let n=!1;for(let o=0,u=a.length-1;o<a.length;u=o++){const g=a[o],_=a[u];g.y>t.y!=_.y>t.y&&t.x<(_.x-g.x)*(t.y-g.y)/(_.y-g.y)+g.x&&(n=!n)}return n}function np(a,t,n){const o=n[0],u=n[2];if(a.x<o.x&&t.x<o.x||a.x>u.x&&t.x>u.x||a.y<o.y&&t.y<o.y||a.y>u.y&&t.y>u.y)return!1;const g=Za(a,t,n[0]);return g!==Za(a,t,n[1])||g!==Za(a,t,n[2])||g!==Za(a,t,n[3])}function wc(a,t,n){const o=t.paint.get(a).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(a)}function Pl(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function fh(a,t,n,o,u){if(!t[0]&&!t[1])return a;const g=be.convert(t)._mult(u);n==="viewport"&&g._rotate(-o);const _=[];for(let v=0;v<a.length;v++)_.push(a[v].sub(g));return _}function nd({queryGeometry:a,size:t},n){return bu(a,n,t)}function ap({queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u},g){return bu(a,g,t*(n.projectTileCoordinates(g.x,g.y,o,u).signedDistanceFromCamera/n.cameraToCenterDistance))}function Np({queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u},g){const _=n.projectTileCoordinates(g.x,g.y,o,u).signedDistanceFromCamera,v=t*(n.cameraToCenterDistance/_);return bu(a,sd(g,n,o,u),v)}function ad({queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u},g){return bu(a,sd(g,n,o,u),t)}function rd({queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u,pitchAlignment:g="map",pitchScale:_="map"},v){const x=g==="map"?_==="map"?nd:ap:_==="map"?Np:ad,M={queryGeometry:a,size:t,transform:n,unwrappedTileID:o,getElevation:u};for(const E of v)for(const z of E)if(x(M,z))return!0;return!1}function sd(a,t,n,o){const u=t.projectTileCoordinates(a.x,a.y,n,o).point;return new be((.5*u.x+.5)*t.width,(.5*-u.y+.5)*t.height)}let Wd,Qd;rt("CircleBucket",xu,{omit:["layers"]});var Jd={get paint(){return Qd=Qd||new Oi({"circle-radius":new xt(xe.paint_circle["circle-radius"]),"circle-color":new xt(xe.paint_circle["circle-color"]),"circle-blur":new xt(xe.paint_circle["circle-blur"]),"circle-opacity":new xt(xe.paint_circle["circle-opacity"]),"circle-translate":new ht(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new ht(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ht(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ht(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xt(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xt(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xt(xe.paint_circle["circle-stroke-opacity"])})},get layout(){return Wd=Wd||new Oi({"circle-sort-key":new xt(xe.layout_circle["circle-sort-key"])})}};class ef extends Wa{constructor(t,n){super(t,Jd,n)}createBucket(t){return new xu(t)}queryRadius(t){const n=t;return wc("circle-radius",this,n)+wc("circle-stroke-width",this,n)+Pl(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:g,pixelsToTileUnits:_,unwrappedTileID:v,getElevation:x}){const M=fh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-g.bearingInRadians,_),E=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),z=this.paint.get("circle-pitch-scale"),k=this.paint.get("circle-pitch-alignment");let B,j;return k==="map"?(B=M,j=E*_):(B=function(Z,$,ee,_e){return Z.map(re=>sd(re,$,ee,_e))}(M,g,v,x),j=E),rd({queryGeometry:B,size:j,transform:g,unwrappedTileID:v,getElevation:x,pitchAlignment:k,pitchScale:z},u)}}class od extends xu{}let tf;rt("HeatmapBucket",od,{omit:["layers"]});var nf={get paint(){return tf=tf||new Oi({"heatmap-radius":new xt(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xt(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ht(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new oa(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ht(xe.paint_heatmap["heatmap-opacity"])})}};function wu(a,{width:t,height:n},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${t*n*o}`)}else u=new Uint8Array(t*n*o);return a.width=t,a.height=n,a.data=u,a}function ld(a,{width:t,height:n},o){if(t===a.width&&n===a.height)return;const u=wu({},{width:t,height:n},o);cd(a,u,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,t),height:Math.min(a.height,n)},o),a.width=t,a.height=n,a.data=u.data}function cd(a,t,n,o,u,g){if(u.width===0||u.height===0)return t;if(u.width>a.width||u.height>a.height||n.x>a.width-u.width||n.y>a.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>t.width||u.height>t.height||o.x>t.width-u.width||o.y>t.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const _=a.data,v=t.data;if(_===v)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const M=((n.y+x)*a.width+n.x)*g,E=((o.y+x)*t.width+o.x)*g;for(let z=0;z<u.width*g;z++)v[E+z]=_[M+z]}return t}class Tc{constructor(t,n){wu(this,t,1,n)}resize(t){ld(this,t,1)}clone(){return new Tc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,g){cd(t,n,o,u,g,1)}}class ja{constructor(t,n){wu(this,t,4,n)}resize(t){ld(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new ja({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,u,g){cd(t,n,o,u,g,4)}setPixel(t,n,o){const u=4*(t*this.width+n);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function mo(a){const t={},n=a.resolution||256,o=a.clips?a.clips.length:1,u=a.image||new ja({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const g=(_,v,x)=>{t[a.evaluationKey]=x;const M=a.expression.evaluate(t);u.setPixel(_/4/n,v/4,M)};if(a.clips)for(let _=0,v=0;_<o;++_,v+=4*n)for(let x=0,M=0;x<n;x++,M+=4){const E=x/(n-1),{start:z,end:k}=a.clips[_];g(v,M,z*(1-E)+k*E)}else for(let _=0,v=0;_<n;_++,v+=4)g(0,v,_/(n-1));return u}rt("AlphaImage",Tc),rt("RGBAImage",ja);const ph="big-fb";class Vp extends Wa{createBucket(t){return new od(t)}constructor(t,n){super(t,nf,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mo({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ph)&&this.heatmapFbos.delete(ph)}queryRadius(t){return wc("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:g,pixelsToTileUnits:_,unwrappedTileID:v,getElevation:x}){return rd({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(n,o)*_,transform:g,unwrappedTileID:v,getElevation:x},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let af;var Qo={get paint(){return af=af||new Oi({"hillshade-illumination-direction":new ht(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new ht(xe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new ht(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ht(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ht(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ht(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ht(xe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new ht(xe.paint_hillshade["hillshade-method"])})}};class rf extends Wa{constructor(t,n){super(t,Qo,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const g=Math.max(t.length,n.length,o.length,u.length);t=t.concat(Array(g-t.length).fill(t.at(-1))),n=n.concat(Array(g-n.length).fill(n.at(-1))),o=o.concat(Array(g-o.length).fill(o.at(-1))),u=u.concat(Array(g-u.length).fill(u.at(-1)));const _=n.map(ll);return{directionRadians:t.map(ll),altitudeRadians:_,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let sf;var ud={get paint(){return sf=sf||new Oi({"color-relief-opacity":new ht(xe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new oa(xe["paint_color-relief"]["color-relief-color"])})}};class Sc{constructor(t,n,o,u){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(n,u)}update(t,n,o){const{width:u,height:g}=t,_=!(this.size&&this.size[0]===u&&this.size[1]===g||o),{context:v}=this,{gl:x}=v;if(this.useMipmap=!!(n&&n.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!n||n.premultiply!==!1)),_)this.size=[u,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||rr(t)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,u,g,0,this.format,x.UNSIGNED_BYTE,t.data);else{const{x:M,y:E}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||rr(t)?x.texSubImage2D(x.TEXTURE_2D,0,M,E,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,M,E,u,g,x.RGBA,x.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),v.pixelStoreUnpackFlipY.setDefault(),v.pixelStoreUnpack.setDefault(),v.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,n,o){const{context:u}=this,{gl:g}=u;g.bindTexture(g.TEXTURE_2D,this.texture),o!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,o||t),this.filter=t),n!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,n),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class an{constructor(t,n,o,u=1,g=1,_=1,v=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void ki(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const x=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=g,this.blueFactor=_,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<x;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(x,M)]=this.data[this._idx(x-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,x)]=this.data[this._idx(M,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<x;M++)for(let E=0;E<x;E++){const z=this.get(M,E);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(t,n){const o=new Uint8Array(this.data.buffer),u=4*this._idx(t,n);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return rp(t,this.getUnpackVector())}getPixels(){return new ja({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,g=n*this.dim+this.dim,_=o*this.dim,v=o*this.dim+this.dim;switch(n){case-1:u=g-1;break;case 1:g=u+1}switch(o){case-1:_=v-1;break;case 1:v=_+1}const x=-n*this.dim,M=-o*this.dim;for(let E=_;E<v;E++)for(let z=u;z<g;z++)this.data[this._idx(z,E)]=t.data[this._idx(z+x,E+M)]}}function rp(a,t){const n=t[0],o=t[1],u=t[2],g=t[3],_=Math.min(n,o,u),v=Math.round((a+g)/_);return{r:Math.floor(v*_/n)%256,g:Math.floor(v*_/o)%256,b:Math.floor(v*_/u)%256}}rt("DEMData",an);class Gp extends Wa{constructor(t,n){super(t,ud,n)}_createColorRamp(t){const n={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof pa&&o._styleExpression.expression instanceof pi){this.colorRampExpression=o;const _=o._styleExpression.expression;n.elevationStops=_.labels,n.colorStops=[];for(const v of n.elevationStops)n.colorStops.push(_.evaluate({globals:{elevation:v}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[Dt.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=t)return n;const u={elevationStops:[],colorStops:[]},g=(n.elevationStops.length-1)/(t-1);for(let _=0;_<n.elevationStops.length-.5;_+=g)u.elevationStops.push(n.elevationStops[Math.round(_)]),u.colorStops.push(n.colorStops[Math.round(_)]);return ki(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${t}, provided: ${n.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,n,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(n),g=new ja({width:u.colorStops.length,height:1}),_=new ja({width:u.colorStops.length,height:1});for(let v=0;v<u.elevationStops.length;v++){const x=rp(u.elevationStops[v],o);_.setPixel(0,v,new Dt(x.r/255,x.g/255,x.b/255,1)),g.setPixel(0,v,u.colorStops[v])}return this.colorRampTextures={elevationTexture:new Sc(t,_,t.gl.RGBA),colorTexture:new Sc(t,g,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const sp=gt([{name:"a_pos",components:2,type:"Int16"}],4),{members:mh}=sp;function Bs(a,t,n){const o=n.patternDependencies;let u=!1;for(const g of t){const _=g.paint.get(`${a}-pattern`);_.isConstant()||(u=!0);const v=_.constantOr(null);v&&(u=!0,o[v.to]=!0,o[v.from]=!0)}return u}function hd(a,t,n,o,u){const{zoom:g}=o,_=u.patternDependencies;for(const v of t){const x=v.paint.get(`${a}-pattern`).value;if(x.kind!=="constant"){let M=x.evaluate({zoom:g-1},n,{},u.availableImages),E=x.evaluate({zoom:g},n,{},u.availableImages),z=x.evaluate({zoom:g+1},n,{},u.availableImages);M=M&&M.name?M.name:M,E=E&&E.name?E.name:E,z=z&&z.name?z.name:z,_[M]=!0,_[E]=!0,_[z]=!0,n.patterns[v.id]={min:M,mid:E,max:z}}}return n}function of(a,t,n,o,u){let g;if(u===function(_,v,x,M){let E=0;for(let z=v,k=x-M;z<x;z+=M)E+=(_[k]-_[z])*(_[z+1]+_[k+1]),k=z;return E}(a,t,n,o)>0)for(let _=t;_<n;_+=o)g=ff(_/o|0,a[_],a[_+1],g);else for(let _=n-o;_>=t;_-=o)g=ff(_/o|0,a[_],a[_+1],g);return g&&Mc(g,g.next)&&(Su(g),g=g.next),g}function Os(a,t){if(!a)return a;t||(t=a);let n,o=a;do if(n=!1,o.steiner||!Mc(o,o.next)&&Sn(o.prev,o,o.next)!==0)o=o.next;else{if(Su(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function xr(a,t,n,o,u,g,_){if(!a)return;!_&&g&&function(x,M,E,z){let k=x;do k.z===0&&(k.z=js(k.x,k.y,M,E,z)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==x);k.prevZ.nextZ=null,k.prevZ=null,function(B){let j,Z=1;do{let $,ee=B;B=null;let _e=null;for(j=0;ee;){j++;let re=ee,ue=0;for(let ke=0;ke<Z&&(ue++,re=re.nextZ,re);ke++);let Me=Z;for(;ue>0||Me>0&&re;)ue!==0&&(Me===0||!re||ee.z<=re.z)?($=ee,ee=ee.nextZ,ue--):($=re,re=re.nextZ,Me--),_e?_e.nextZ=$:B=$,$.prevZ=_e,_e=$;ee=re}_e.nextZ=null,Z*=2}while(j>1)}(k)}(a,o,u,g);let v=a;for(;a.prev!==a.next;){const x=a.prev,M=a.next;if(g?lf(a,o,u,g):op(a))t.push(x.i,a.i,M.i),Su(a),a=M.next,v=M.next;else if((a=M)===v){_?_===1?xr(a=lp(Os(a),t),t,n,o,u,g,2):_===2&&cf(a,t,n,o,u,g):xr(Os(a),t,n,o,u,g,1);break}}}function op(a){const t=a.prev,n=a,o=a.next;if(Sn(t,n,o)>=0)return!1;const u=t.x,g=n.x,_=o.x,v=t.y,x=n.y,M=o.y,E=Math.min(u,g,_),z=Math.min(v,x,M),k=Math.max(u,g,_),B=Math.max(v,x,M);let j=o.next;for(;j!==t;){if(j.x>=E&&j.x<=k&&j.y>=z&&j.y<=B&&Tu(u,v,g,x,_,M,j.x,j.y)&&Sn(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function lf(a,t,n,o){const u=a.prev,g=a,_=a.next;if(Sn(u,g,_)>=0)return!1;const v=u.x,x=g.x,M=_.x,E=u.y,z=g.y,k=_.y,B=Math.min(v,x,M),j=Math.min(E,z,k),Z=Math.max(v,x,M),$=Math.max(E,z,k),ee=js(B,j,t,n,o),_e=js(Z,$,t,n,o);let re=a.prevZ,ue=a.nextZ;for(;re&&re.z>=ee&&ue&&ue.z<=_e;){if(re.x>=B&&re.x<=Z&&re.y>=j&&re.y<=$&&re!==u&&re!==_&&Tu(v,E,x,z,M,k,re.x,re.y)&&Sn(re.prev,re,re.next)>=0||(re=re.prevZ,ue.x>=B&&ue.x<=Z&&ue.y>=j&&ue.y<=$&&ue!==u&&ue!==_&&Tu(v,E,x,z,M,k,ue.x,ue.y)&&Sn(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;re&&re.z>=ee;){if(re.x>=B&&re.x<=Z&&re.y>=j&&re.y<=$&&re!==u&&re!==_&&Tu(v,E,x,z,M,k,re.x,re.y)&&Sn(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;ue&&ue.z<=_e;){if(ue.x>=B&&ue.x<=Z&&ue.y>=j&&ue.y<=$&&ue!==u&&ue!==_&&Tu(v,E,x,z,M,k,ue.x,ue.y)&&Sn(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function lp(a,t){let n=a;do{const o=n.prev,u=n.next.next;!Mc(o,u)&&hf(o,n,n.next,u)&&Br(o,u)&&Br(u,o)&&(t.push(o.i,n.i,u.i),Su(n),Su(n.next),n=a=u),n=n.next}while(n!==a);return Os(n)}function cf(a,t,n,o,u,g){let _=a;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&xa(_,v)){let x=df(_,v);return _=Os(_,_.next),x=Os(x,x.next),xr(_,t,n,o,u,g,0),void xr(x,t,n,o,u,g,0)}v=v.next}_=_.next}while(_!==a)}function uf(a,t){let n=a.x-t.x;return n===0&&(n=a.y-t.y,n===0)&&(n=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function dd(a,t){const n=function(u,g){let _=g;const v=u.x,x=u.y;let M,E=-1/0;if(Mc(u,_))return _;do{if(Mc(u,_.next))return _.next;if(x<=_.y&&x>=_.next.y&&_.next.y!==_.y){const Z=_.x+(x-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(Z<=v&&Z>E&&(E=Z,M=_.x<_.next.x?_:_.next,Z===v))return M}_=_.next}while(_!==g);if(!M)return null;const z=M,k=M.x,B=M.y;let j=1/0;_=M;do{if(v>=_.x&&_.x>=k&&v!==_.x&&fd(x<B?v:E,x,k,B,x<B?E:v,x,_.x,_.y)){const Z=Math.abs(x-_.y)/(v-_.x);Br(_,u)&&(Z<j||Z===j&&(_.x>M.x||_.x===M.x&&cp(M,_)))&&(M=_,j=Z)}_=_.next}while(_!==z);return M}(a,t);if(!n)return t;const o=df(n,a);return Os(o,o.next),Os(n,n.next)}function cp(a,t){return Sn(a.prev,a,t.prev)<0&&Sn(t.next,a,a.next)<0}function js(a,t,n,o,u){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-n)*u|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Yn(a){let t=a,n=a;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==a);return n}function fd(a,t,n,o,u,g,_,v){return(u-_)*(t-v)>=(a-_)*(g-v)&&(a-_)*(o-v)>=(n-_)*(t-v)&&(n-_)*(g-v)>=(u-_)*(o-v)}function Tu(a,t,n,o,u,g,_,v){return!(a===_&&t===v)&&fd(a,t,n,o,u,g,_,v)}function xa(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!function(n,o){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==o.i&&u.next.i!==o.i&&hf(u,u.next,n,o))return!0;u=u.next}while(u!==n);return!1}(a,t)&&(Br(a,t)&&Br(t,a)&&function(n,o){let u=n,g=!1;const _=(n.x+o.x)/2,v=(n.y+o.y)/2;do u.y>v!=u.next.y>v&&u.next.y!==u.y&&_<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(g=!g),u=u.next;while(u!==n);return g}(a,t)&&(Sn(a.prev,a,t.prev)||Sn(a,t.prev,t))||Mc(a,t)&&Sn(a.prev,a,a.next)>0&&Sn(t.prev,t,t.next)>0)}function Sn(a,t,n){return(t.y-a.y)*(n.x-t.x)-(t.x-a.x)*(n.y-t.y)}function Mc(a,t){return a.x===t.x&&a.y===t.y}function hf(a,t,n,o){const u=Da(Sn(a,t,n)),g=Da(Sn(a,t,o)),_=Da(Sn(n,o,a)),v=Da(Sn(n,o,t));return u!==g&&_!==v||!(u!==0||!Qi(a,n,t))||!(g!==0||!Qi(a,o,t))||!(_!==0||!Qi(n,a,o))||!(v!==0||!Qi(n,t,o))}function Qi(a,t,n){return t.x<=Math.max(a.x,n.x)&&t.x>=Math.min(a.x,n.x)&&t.y<=Math.max(a.y,n.y)&&t.y>=Math.min(a.y,n.y)}function Da(a){return a>0?1:a<0?-1:0}function Br(a,t){return Sn(a.prev,a,a.next)<0?Sn(a,t,a.next)>=0&&Sn(a,a.prev,t)>=0:Sn(a,t,a.prev)<0||Sn(a,a.next,t)<0}function df(a,t){const n=pf(a.i,a.x,a.y),o=pf(t.i,t.x,t.y),u=a.next,g=t.prev;return a.next=t,t.prev=a,n.next=u,u.prev=n,o.next=n,n.prev=o,g.next=o,o.prev=g,o}function ff(a,t,n,o){const u=pf(a,t,n);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function Su(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function pf(a,t,n){return{i:a,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Jo{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class Ia{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}Ia.noSubdivision=new Ia({fill:new Jo(0,0),line:new Jo(0,0),tile:new Jo(0,0),stencil:new Jo(0,0),circle:1}),rt("SubdivisionGranularityExpression",Jo),rt("SubdivisionGranularitySetting",Ia);const Fa=-32768,Mu=32767;class br{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=pt/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|n+32768}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),u=0|Math.round(n),g=this._getKey(o,u);if(this._vertexDictionary.has(g))return this._vertexDictionary.get(g);const _=this._vertexBuffer.length/2;return this._vertexDictionary.set(g,_),this._vertexBuffer.push(o,u),_}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(u,g){const _=[];for(let v=0;v<g.length;v+=3){const x=g[v],M=g[v+1],E=g[v+2],z=u[2*x],k=u[2*x+1];(u[2*M]-z)*(u[2*E+1]-k)-(u[2*M+1]-k)*(u[2*E]-z)>0?(_.push(x),_.push(E),_.push(M)):(_.push(x),_.push(M),_.push(E))}return _}(this._vertexBuffer,t);const n=[],o=t.length;for(let u=0;u<o;u+=3){const g=[t[u+0],t[u+1],t[u+2]],_=[this._vertexBuffer[2*t[u+0]+0],this._vertexBuffer[2*t[u+0]+1],this._vertexBuffer[2*t[u+1]+0],this._vertexBuffer[2*t[u+1]+1],this._vertexBuffer[2*t[u+2]+0],this._vertexBuffer[2*t[u+2]+1]];let v=1/0,x=1/0,M=-1/0,E=-1/0;for(let Z=0;Z<3;Z++){const $=_[2*Z],ee=_[2*Z+1];v=Math.min(v,$),M=Math.max(M,$),x=Math.min(x,ee),E=Math.max(E,ee)}if(v===M||x===E)continue;const z=Math.floor(v/this._granularityCellSize),k=Math.ceil(M/this._granularityCellSize),B=Math.floor(x/this._granularityCellSize),j=Math.ceil(E/this._granularityCellSize);if(z!==k||B!==j)for(let Z=B;Z<j;Z++){const $=this._scanlineGenerateVertexRingForCellRow(Z,_,g);Ec(this._vertexBuffer,$,n)}else n.push(...g)}return n}_scanlineGenerateVertexRingForCellRow(t,n,o){const u=t*this._granularityCellSize,g=u+this._granularityCellSize,_=[];for(let v=0;v<3;v++){const x=n[2*v],M=n[2*v+1],E=n[2*(v+1)%6],z=n[(2*(v+1)+1)%6],k=n[2*(v+2)%6],B=n[(2*(v+2)+1)%6],j=E-x,Z=z-M,$=j===0,ee=Z===0,_e=(u-M)/Z,re=(g-M)/Z,ue=Math.min(_e,re),Me=Math.max(_e,re);if(!ee&&(ue>=1||Me<=0)||ee&&(M<u||M>g)){z>=u&&z<=g&&_.push(o[(v+1)%3]);continue}!ee&&ue>0&&_.push(this._vertexToIndex(x+j*ue,M+Z*ue));const ke=x+j*Math.max(ue,0),Xe=x+j*Math.min(Me,1);$||this._generateIntraEdgeVertices(_,x,M,E,z,ke,Xe),!ee&&Me<1&&_.push(this._vertexToIndex(x+j*Me,M+Z*Me)),(ee||z>=u&&z<=g)&&_.push(o[(v+1)%3]),!ee&&(z<=u||z>=g)&&this._generateInterEdgeVertices(_,x,M,E,z,k,B,Xe,u,g)}return _}_generateIntraEdgeVertices(t,n,o,u,g,_,v){const x=u-n,M=g-o,E=M===0,z=E?Math.min(n,u):Math.min(_,v),k=E?Math.max(n,u):Math.max(_,v),B=Math.floor(z/this._granularityCellSize)+1,j=Math.ceil(k/this._granularityCellSize)-1;if(E?n<u:_<v)for(let Z=B;Z<=j;Z++){const $=Z*this._granularityCellSize;t.push(this._vertexToIndex($,o+M*($-n)/x))}else for(let Z=j;Z>=B;Z--){const $=Z*this._granularityCellSize;t.push(this._vertexToIndex($,o+M*($-n)/x))}}_generateInterEdgeVertices(t,n,o,u,g,_,v,x,M,E){const z=g-o,k=_-u,B=v-g,j=(M-g)/B,Z=(E-g)/B,$=Math.min(j,Z),ee=Math.max(j,Z),_e=u+k*$;let re=Math.floor(Math.min(_e,x)/this._granularityCellSize)+1,ue=Math.ceil(Math.max(_e,x)/this._granularityCellSize)-1,Me=x<_e;const ke=B===0;if(ke&&(v===M||v===E))return;if(ke||$>=1||ee<=0){const at=o-v,Qe=_+(n-_)*Math.min((M-v)/at,(E-v)/at);re=Math.floor(Math.min(Qe,x)/this._granularityCellSize)+1,ue=Math.ceil(Math.max(Qe,x)/this._granularityCellSize)-1,Me=x<Qe}const Xe=z>0?E:M;if(Me)for(let at=re;at<=ue;at++)t.push(this._vertexToIndex(at*this._granularityCellSize,Xe));else for(let at=ue;at>=re;at--)t.push(this._vertexToIndex(at*this._granularityCellSize,Xe))}_generateOutline(t){const n=[];for(const o of t){const u=er(o,this._granularity,!0),g=this._pointArrayToIndices(u),_=[];for(let v=1;v<g.length;v++)_.push(g[v-1]),_.push(g[v]);n.push(_)}return n}_handlePoles(t){let n=!1,o=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(n||o)&&this._fillPoles(t,n,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const o=t[n+1];o===Fa&&(t[n+1]=-32767),o===Mu&&(t[n+1]=32766)}}_generatePoleQuad(t,n,o,u,g,_){u>g!=(_===Fa)?(t.push(n),t.push(o),t.push(this._vertexToIndex(u,_)),t.push(o),t.push(this._vertexToIndex(g,_)),t.push(this._vertexToIndex(u,_))):(t.push(o),t.push(n),t.push(this._vertexToIndex(u,_)),t.push(this._vertexToIndex(g,_)),t.push(o),t.push(this._vertexToIndex(u,_)))}_fillPoles(t,n,o){const u=this._vertexBuffer,g=pt,_=t.length;for(let v=2;v<_;v+=3){const x=t[v-2],M=t[v-1],E=t[v],z=u[2*x],k=u[2*x+1],B=u[2*M],j=u[2*M+1],Z=u[2*E],$=u[2*E+1];n&&(k===0&&j===0&&this._generatePoleQuad(t,x,M,z,B,Fa),j===0&&$===0&&this._generatePoleQuad(t,M,E,B,Z,Fa),$===0&&k===0&&this._generatePoleQuad(t,E,x,Z,z,Fa)),o&&(k===g&&j===g&&this._generatePoleQuad(t,x,M,z,B,Mu),j===g&&$===g&&this._generatePoleQuad(t,M,E,B,Z,Mu),$===g&&k===g&&this._generatePoleQuad(t,E,x,Z,z,Mu))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=function(v){const x=[],M=[];for(const E of v)if(E.length!==0){E!==v[0]&&x.push(M.length/2);for(let z=0;z<E.length;z++)M.push(E[z].x),M.push(E[z].y)}return{flattened:M,holeIndices:x}}(t);let g;this._initializeVertices(o);try{const v=function(M,E,z=2){const k=E&&E.length,B=k?E[0]*z:M.length;let j=of(M,0,B,z,!0);const Z=[];if(!j||j.next===j.prev)return Z;let $,ee,_e;if(k&&(j=function(re,ue,Me,ke){const Xe=[];for(let at=0,Qe=ue.length;at<Qe;at++){const it=of(re,ue[at]*ke,at<Qe-1?ue[at+1]*ke:re.length,ke,!1);it===it.next&&(it.steiner=!0),Xe.push(Yn(it))}Xe.sort(uf);for(let at=0;at<Xe.length;at++)Me=dd(Xe[at],Me);return Me}(M,E,j,z)),M.length>80*z){$=M[0],ee=M[1];let re=$,ue=ee;for(let Me=z;Me<B;Me+=z){const ke=M[Me],Xe=M[Me+1];ke<$&&($=ke),Xe<ee&&(ee=Xe),ke>re&&(re=ke),Xe>ue&&(ue=Xe)}_e=Math.max(re-$,ue-ee),_e=_e!==0?32767/_e:0}return xr(j,Z,z,$,ee,_e,0),Z}(o,u),x=this._convertIndices(o,v);g=this._subdivideTrianglesScanline(x)}catch(v){console.error(v)}let _=[];return n&&(_=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(g),{verticesFlattened:this._vertexBuffer,indicesTriangles:g,indicesLineList:_}}_convertIndices(t,n){const o=[];for(let u=0;u<n.length;u++)o.push(this._vertexToIndex(t[2*n[u]],t[2*n[u]+1]));return o}_pointArrayToIndices(t){const n=[];for(let o=0;o<t.length;o++){const u=t[o];n.push(this._vertexToIndex(u.x,u.y))}return n}}function mf(a,t,n,o=!0){return new br(n,t).subdividePolygonInternal(a,o)}function er(a,t,n=!1){if(!a||a.length<1)return[];if(a.length<2)return[];const o=a[0],u=a[a.length-1],g=n&&(o.x!==u.x||o.y!==u.y);if(t<2)return g?[...a,a[0]]:[...a];const _=Math.floor(pt/t),v=[];v.push(new be(a[0].x,a[0].y));const x=a.length,M=g?x:x-1;for(let E=0;E<M;E++){const z=a[E],k=E<x-1?a[E+1]:a[0],B=z.x,j=z.y,Z=k.x,$=k.y,ee=B!==Z,_e=j!==$;if(!ee&&!_e)continue;const re=Z-B,ue=$-j,Me=Math.abs(re),ke=Math.abs(ue);let Xe=B,at=j;for(;;){const it=re>0?(Math.floor(Xe/_)+1)*_:(Math.ceil(Xe/_)-1)*_,ft=ue>0?(Math.floor(at/_)+1)*_:(Math.ceil(at/_)-1)*_,nt=Math.abs(Xe-it),tt=Math.abs(at-ft),Ue=Math.abs(Xe-Z),Mt=Math.abs(at-$),zt=ee?nt/Me:Number.POSITIVE_INFINITY,_t=_e?tt/ke:Number.POSITIVE_INFINITY;if((Ue<=nt||!ee)&&(Mt<=tt||!_e))break;if(zt<_t&&ee||!_e){Xe=it,at+=ue*zt;const ut=new be(Xe,Math.round(at));v[v.length-1].x===ut.x&&v[v.length-1].y===ut.y||v.push(ut)}else{Xe+=re*_t,at=ft;const ut=new be(Math.round(Xe),at);v[v.length-1].x===ut.x&&v[v.length-1].y===ut.y||v.push(ut)}}const Qe=new be(Z,$);v[v.length-1].x===Qe.x&&v[v.length-1].y===Qe.y||v.push(Qe)}return v}function Ec(a,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=a[2*t[0]];for(let x=1;x<t.length;x++){const M=a[2*t[x]];M<u&&(u=M,o=x)}const g=t.length;let _=o,v=(_+1)%g;for(;;){const x=_-1>=0?_-1:g-1,M=(v+1)%g,E=a[2*t[x]],z=a[2*t[M]],k=a[2*t[_]],B=a[2*t[_]+1],j=a[2*t[v]+1];let Z=!1;if(E<z)Z=!0;else if(E>z)Z=!1;else{const $=j-B,ee=-(a[2*t[v]]-k),_e=B<j?1:-1;((E-k)*$+(a[2*t[x]+1]-B)*ee)*_e>((z-k)*$+(a[2*t[M]+1]-B)*ee)*_e&&(Z=!0)}if(Z){const $=t[x],ee=t[_],_e=t[v];$!==ee&&$!==_e&&ee!==_e&&n.push(_e,ee,$),_--,_<0&&(_=g-1)}else{const $=t[M],ee=t[_],_e=t[v];$!==ee&&$!==_e&&ee!==_e&&n.push(_e,ee,$),v++,v>=g&&(v=0)}if(x===M)break}}function go(a,t,n,o,u,g,_,v,x){const M=u.length/2,E=_&&v&&x;if(M<Vt.MAX_VERTEX_ARRAY_LENGTH){const z=t.prepareSegment(M,n,o),k=z.vertexLength;for(let Z=0;Z<g.length;Z+=3)o.emplaceBack(k+g[Z],k+g[Z+1],k+g[Z+2]);let B,j;z.vertexLength+=M,z.primitiveLength+=g.length/3,E&&(j=_.prepareSegment(M,n,v),B=j.vertexLength,j.vertexLength+=M);for(let Z=0;Z<u.length;Z+=2)a(u[Z],u[Z+1]);if(E)for(let Z=0;Z<x.length;Z++){const $=x[Z];for(let ee=1;ee<$.length;ee+=2)v.emplaceBack(B+$[ee-1],B+$[ee]);j.primitiveLength+=$.length/2}}else(function(z,k,B,j,Z,$){const ee=[];for(let ke=0;ke<j.length/2;ke++)ee.push(-1);const _e={count:0};let re=0,ue=z.getOrCreateLatestSegment(k,B),Me=ue.vertexLength;for(let ke=2;ke<Z.length;ke+=3){const Xe=Z[ke-2],at=Z[ke-1],Qe=Z[ke];let it=ee[Xe]<re,ft=ee[at]<re,nt=ee[Qe]<re;ue.vertexLength+((it?1:0)+(ft?1:0)+(nt?1:0))>Vt.MAX_VERTEX_ARRAY_LENGTH&&(ue=z.createNewSegment(k,B),re=_e.count,it=!0,ft=!0,nt=!0,Me=0);const tt=Ac(ee,j,$,_e,Xe,it,ue),Ue=Ac(ee,j,$,_e,at,ft,ue),Mt=Ac(ee,j,$,_e,Qe,nt,ue);B.emplaceBack(Me+tt-re,Me+Ue-re,Me+Mt-re),ue.primitiveLength++}})(t,n,o,u,g,a),E&&function(z,k,B,j,Z,$){const ee=[];for(let ke=0;ke<j.length/2;ke++)ee.push(-1);const _e={count:0};let re=0,ue=z.getOrCreateLatestSegment(k,B),Me=ue.vertexLength;for(let ke=0;ke<Z.length;ke++){const Xe=Z[ke];for(let at=1;at<Z[ke].length;at+=2){const Qe=Xe[at-1],it=Xe[at];let ft=ee[Qe]<re,nt=ee[it]<re;ue.vertexLength+((ft?1:0)+(nt?1:0))>Vt.MAX_VERTEX_ARRAY_LENGTH&&(ue=z.createNewSegment(k,B),re=_e.count,ft=!0,nt=!0,Me=0);const tt=Ac(ee,j,$,_e,Qe,ft,ue),Ue=Ac(ee,j,$,_e,it,nt,ue);B.emplaceBack(Me+tt-re,Me+Ue-re),ue.primitiveLength++}}}(_,n,v,u,x,a),t.forceNewSegmentOnNextPrepare(),_?.forceNewSegmentOnNextPrepare()}function Ac(a,t,n,o,u,g,_){if(g){const v=o.count;return n(t[2*u],t[2*u+1]),a[u]=o.count,o.count++,_.vertexLength++,v}return a[u]}class gh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new te,this.indexArray=new Fe,this.indexArray2=new lt,this.programConfigurations=new po(t.layers,t.zoom),this.segments=new Vt,this.segments2=new Vt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasDependencies=Bs("fill",this.layers,n);const u=this.layers[0].layout.get("fill-sort-key"),g=!u.isConstant(),_=[];for(const{feature:v,id:x,index:M,sourceLayerIndex:E}of t){const z=this.layers[0]._featureFilter.needGeometry,k=ks(v,z);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),k,o))continue;const B=g?u.evaluate(k,{},o,n.availableImages):void 0,j={id:x,properties:v.properties,type:v.type,sourceLayerIndex:E,index:M,geometry:z?k.geometry:Pa(v),patterns:{},sortKey:B};_.push(j)}g&&_.sort((v,x)=>v.sortKey-x.sortKey);for(const v of _){const{geometry:x,index:M,sourceLayerIndex:E}=v;if(this.hasDependencies){const z=hd("fill",this.layers,v,{zoom:this.zoom},n);this.patternFeatures.push(z)}else this.addFeature(v,x,M,o,{},n.subdivisionGranularity);n.featureIndex.insert(t[M].feature,x,M,E,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}addFeatures(t,n,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,mh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,u,g,_){for(const v of Jl(n,500)){const x=mf(v,u,_.fill.getGranularityForZoomLevel(u.z)),M=this.layoutVertexArray;go((E,z)=>{M.emplaceBack(E,z)},this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:g,canonical:u})}}let ss,gf;rt("FillBucket",gh,{omit:["layers","patternFeatures"]});var Eu={get paint(){return gf=gf||new Oi({"fill-antialias":new ht(xe.paint_fill["fill-antialias"]),"fill-opacity":new xt(xe.paint_fill["fill-opacity"]),"fill-color":new xt(xe.paint_fill["fill-color"]),"fill-outline-color":new xt(xe.paint_fill["fill-outline-color"]),"fill-translate":new ht(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new ht(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xo(xe.paint_fill["fill-pattern"])})},get layout(){return ss=ss||new Oi({"fill-sort-key":new xt(xe.layout_fill["fill-sort-key"])})}};class _h extends Wa{constructor(t,n){super(t,Eu,n)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new gh(t)}queryRadius(){return Pl(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:o,pixelsToTileUnits:u}){return Xd(fh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),n)}isTileClipped(){return!0}}const yh=gt([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Au=gt([{name:"a_centroid",components:2,type:"Int16"}],4),{members:up}=yh;class Cc{constructor(t,n,o,u,g){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=u,this._values=g,t.readFields(vh,this,n)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos,o=[];let u,g=1,_=0,v=0,x=0;for(;t.pos<n;){if(_<=0){const M=t.readVarint();g=7&M,_=M>>3}if(_--,g===1||g===2)v+=t.readSVarint(),x+=t.readSVarint(),g===1&&(u&&o.push(u),u=[]),u&&u.push(new be(v,x));else{if(g!==7)throw new Error(`unknown command ${g}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos;let o=1,u=0,g=0,_=0,v=1/0,x=-1/0,M=1/0,E=-1/0;for(;t.pos<n;){if(u<=0){const z=t.readVarint();o=7&z,u=z>>3}if(u--,o===1||o===2)g+=t.readSVarint(),_+=t.readSVarint(),g<v&&(v=g),g>x&&(x=g),_<M&&(M=_),_>E&&(E=_);else if(o!==7)throw new Error(`unknown command ${o}`)}return[v,M,x,E]}toGeoJSON(t,n,o){const u=this.extent*Math.pow(2,o),g=this.extent*t,_=this.extent*n,v=this.loadGeometry();function x(k){return[360*(k.x+g)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(k.y+_)/u)*Math.PI))-90]}function M(k){return k.map(x)}let E;if(this.type===1){const k=[];for(const j of v)k.push(j[0]);const B=M(k);E=k.length===1?{type:"Point",coordinates:B[0]}:{type:"MultiPoint",coordinates:B}}else if(this.type===2){const k=v.map(M);E=k.length===1?{type:"LineString",coordinates:k[0]}:{type:"MultiLineString",coordinates:k}}else{if(this.type!==3)throw new Error("unknown feature type");{const k=function(j){const Z=j.length;if(Z<=1)return[j];const $=[];let ee,_e;for(let re=0;re<Z;re++){const ue=hp(j[re]);ue!==0&&(_e===void 0&&(_e=ue<0),_e===ue<0?(ee&&$.push(ee),ee=[j[re]]):ee&&ee.push(j[re]))}return ee&&$.push(ee),$}(v),B=[];for(const j of k)B.push(j.map(M));E=B.length===1?{type:"Polygon",coordinates:B[0]}:{type:"MultiPolygon",coordinates:B}}}const z={type:"Feature",geometry:E,properties:this.properties};return this.id!=null&&(z.id=this.id),z}}function vh(a,t,n){a===1?t.id=n.readVarint():a===2?function(o,u){const g=o.readVarint()+o.pos;for(;o.pos<g;){const _=u._keys[o.readVarint()],v=u._values[o.readVarint()];u.properties[_]=v}}(n,t):a===3?t.type=n.readVarint():a===4&&(t._geometry=n.pos)}function hp(a){let t=0;for(let n,o,u=0,g=a.length,_=g-1;u<g;_=u++)n=a[u],o=a[_],t+=(o.x-n.x)*(n.y+o.y);return t}Cc.types=["Unknown","Point","LineString","Polygon"];class xh{constructor(t,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(dp,this,n),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const n=this._pbf.readVarint()+this._pbf.pos;return new Cc(this._pbf,n,this.extent,this._keys,this._values)}}function dp(a,t,n){a===15?t.version=n.readVarint():a===1?t.name=n.readString():a===5?t.extent=n.readVarint():a===2?t._features.push(n.pos):a===3?t._keys.push(n.readString()):a===4&&t._values.push(function(o){let u=null;const g=o.readVarint()+o.pos;for(;o.pos<g;){const _=o.readVarint()>>3;u=_===1?o.readString():_===2?o.readFloat():_===3?o.readDouble():_===4?o.readVarint64():_===5?o.readVarint():_===6?o.readSVarint():_===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u}(n))}class fp{constructor(t,n){this.layers=t.readFields(Zp,{},n)}}function Zp(a,t,n){if(a===3){const o=new xh(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}const mi=Math.pow(2,13);function Ei(a,t,n,o,u,g,_,v){a.emplaceBack(t,n,2*Math.floor(o*mi)+_,u*mi*2,g*mi*2,Math.round(v))}class ti{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new oe,this.centroidVertexArray=new ne,this.indexArray=new Fe,this.programConfigurations=new po(t.layers,t.zoom),this.segments=new Vt,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasDependencies=Bs("fill-extrusion",this.layers,n);for(const{feature:u,id:g,index:_,sourceLayerIndex:v}of t){const x=this.layers[0]._featureFilter.needGeometry,M=ks(u,x);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),M,o))continue;const E={id:g,sourceLayerIndex:v,index:_,geometry:x?M.geometry:Pa(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(hd("fill-extrusion",this.layers,E,{zoom:this.zoom},n)):this.addFeature(E,E.geometry,_,o,{},n.subdivisionGranularity),n.featureIndex.insert(u,E.geometry,_,v,this.index,!0)}}addFeatures(t,n,o){for(const u of this.features){const{geometry:g}=u;this.addFeature(u,g,u.index,n,o,t.subdivisionGranularity)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,up),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Au.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,u,g,_){for(const v of Jl(n,500)){const x={x:0,y:0,sampleCount:0},M=this.layoutVertexArray.length;this.processPolygon(x,u,t,v,_);const E=this.layoutVertexArray.length-M,z=Math.floor(x.x/x.sampleCount),k=Math.floor(x.y/x.sampleCount);for(let B=0;B<E;B++)this.centroidVertexArray.emplaceBack(z,k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:g,canonical:u})}processPolygon(t,n,o,u,g){if(u.length<1||wr(u[0]))return;for(const z of u)z.length!==0&&oi(t,z);const _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=g.fill.getGranularityForZoomLevel(n.z),x=Cc.types[o.type]==="Polygon";for(const z of u){if(z.length===0||wr(z))continue;const k=er(z,v,x);this._generateSideFaces(k,_)}if(!x)return;const M=mf(u,n,v,!1),E=this.layoutVertexArray;go((z,k)=>{Ei(E,z,k,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles)}_generateSideFaces(t,n){let o=0;for(let u=1;u<t.length;u++){const g=t[u],_=t[u-1];if(ji(g,_))continue;n.segment.vertexLength+4>Vt.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=g.sub(_)._perp()._unit(),x=_.dist(g);o+x>32768&&(o=0),Ei(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,0,o),Ei(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,1,o),o+=x,Ei(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,0,o),Ei(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,1,o);const M=n.segment.vertexLength;this.indexArray.emplaceBack(M,M+2,M+1),this.indexArray.emplaceBack(M+1,M+2,M+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function oi(a,t){for(let n=0;n<t.length;n++){const o=t[n];n===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(a.x+=o.x,a.y+=o.y,a.sampleCount++)}}function ji(a,t){return a.x===t.x&&(a.x<0||a.x>pt)||a.y===t.y&&(a.y<0||a.y>pt)}function wr(a){return a.every(t=>t.x<0)||a.every(t=>t.x>pt)||a.every(t=>t.y<0)||a.every(t=>t.y>pt)}let el;rt("FillExtrusionBucket",ti,{omit:["layers","features"]});var Cu={get paint(){return el=el||new Oi({"fill-extrusion-opacity":new ht(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xt(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ht(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ht(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xo(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xt(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xt(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ht(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class _f extends Wa{constructor(t,n){super(t,Cu,n)}createBucket(t){return new ti(t)}queryRadius(){return Pl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:g,pixelsToTileUnits:_,pixelPosMatrix:v}){const x=fh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-g.bearingInRadians,_),M=this.paint.get("fill-extrusion-height").evaluate(n,o),E=this.paint.get("fill-extrusion-base").evaluate(n,o),z=function(B,j){const Z=[];for(const $ of B){const ee=[$.x,$.y,0,1];da(ee,ee,j),Z.push(new be(ee[0]/ee[3],ee[1]/ee[3]))}return Z}(x,v),k=function(B,j,Z,$){const ee=[],_e=[],re=$[8]*j,ue=$[9]*j,Me=$[10]*j,ke=$[11]*j,Xe=$[8]*Z,at=$[9]*Z,Qe=$[10]*Z,it=$[11]*Z;for(const ft of B){const nt=[],tt=[];for(const Ue of ft){const Mt=Ue.x,zt=Ue.y,_t=$[0]*Mt+$[4]*zt+$[12],ut=$[1]*Mt+$[5]*zt+$[13],$t=$[2]*Mt+$[6]*zt+$[14],rn=$[3]*Mt+$[7]*zt+$[15],En=$t+Me,dn=rn+ke,Wn=_t+Xe,Bn=ut+at,An=$t+Qe,Li=rn+it,Ji=new be((_t+re)/dn,(ut+ue)/dn);Ji.z=En/dn,nt.push(Ji);const ua=new be(Wn/Li,Bn/Li);ua.z=An/Li,tt.push(ua)}ee.push(nt),_e.push(tt)}return[ee,_e]}(u,E,M,v);return function(B,j,Z){let $=1/0;Xd(Z,j)&&($=Mn(Z,j[0]));for(let ee=0;ee<j.length;ee++){const _e=j[ee],re=B[ee];for(let ue=0;ue<_e.length-1;ue++){const Me=_e[ue],ke=[Me,_e[ue+1],re[ue+1],re[ue],Me];Hd(Z,ke)&&($=Math.min($,Mn(Z,ke)))}}return $!==1/0&&$}(k[0],k[1],z)}}function Or(a,t){return a.x*t.x+a.y*t.y}function Mn(a,t){if(a.length===1){let n=0;const o=t[n++];let u;for(;!u||o.equals(u);)if(u=t[n++],!u)return 1/0;for(;n<t.length;n++){const g=t[n],_=a[0],v=u.sub(o),x=g.sub(o),M=_.sub(o),E=Or(v,v),z=Or(v,x),k=Or(x,x),B=Or(M,v),j=Or(M,x),Z=E*k-z*z,$=(k*B-z*j)/Z,ee=(E*j-z*B)/Z,_e=o.z*(1-$-ee)+u.z*$+g.z*ee;if(isFinite(_e))return _e}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const Dl=gt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:zc}=Dl,yf=gt([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:jr}=yf,zu=Math.cos(Math.PI/180*37.5),Pu=Math.pow(2,14)/.5;class Ua{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new de,this.layoutVertexArray2=new ae,this.indexArray=new Fe,this.programConfigurations=new po(t.layers,t.zoom),this.segments=new Vt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasDependencies=Bs("line",this.layers,n)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),g=!u.isConstant(),_=[];for(const{feature:v,id:x,index:M,sourceLayerIndex:E}of t){const z=this.layers[0]._featureFilter.needGeometry,k=ks(v,z);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),k,o))continue;const B=g?u.evaluate(k,{},o):void 0,j={id:x,properties:v.properties,type:v.type,sourceLayerIndex:E,index:M,geometry:z?k.geometry:Pa(v),patterns:{},dashes:{},sortKey:B};_.push(j)}g&&_.sort((v,x)=>v.sortKey-x.sortKey);for(const v of _){const{geometry:x,index:M,sourceLayerIndex:E}=v;this.hasDependencies?(Bs("line",this.layers,n)?hd("line",this.layers,v,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,v,this.zoom,n),this.patternFeatures.push(v)):this.addFeature(v,x,M,o,{},{},n.subdivisionGranularity),n.featureIndex.insert(t[M].feature,x,M,E,this.index)}}update(t,n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(t,n,o,u){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,n,o,u,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,jr)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,u,g,_,v){const x=this.layers[0].layout,M=x.get("line-join").evaluate(t,{}),E=x.get("line-cap"),z=x.get("line-miter-limit"),k=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const B of n)this.addLine(B,t,M,E,z,k,u,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:g,dashPositions:_,canonical:u})}addLine(t,n,o,u,g,_,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=er(t,v?x.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let re=0;re<t.length-1;re++)this.totalDistance+=t[re].dist(t[re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=Cc.types[n.type]==="Polygon";let E=t.length;for(;E>=2&&t[E-1].equals(t[E-2]);)E--;let z=0;for(;z<E-1&&t[z].equals(t[z+1]);)z++;if(E<(M?3:2))return;o==="bevel"&&(g=1.05);const k=this.overscaling<=16?122880/(512*this.overscaling):0,B=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let j,Z,$,ee,_e;this.e1=this.e2=-1,M&&(j=t[E-2],_e=t[z].sub(j)._unit()._perp());for(let re=z;re<E;re++){if($=re===E-1?M?t[z+1]:void 0:t[re+1],$&&t[re].equals($))continue;_e&&(ee=_e),j&&(Z=j),j=t[re],_e=$?$.sub(j)._unit()._perp():ee,ee=ee||_e;let ue=ee.add(_e);ue.x===0&&ue.y===0||ue._unit();const Me=ee.x*_e.x+ee.y*_e.y,ke=ue.x*_e.x+ue.y*_e.y,Xe=ke!==0?1/ke:1/0,at=2*Math.sqrt(2-2*ke),Qe=ke<zu&&Z&&$,it=ee.x*_e.y-ee.y*_e.x>0;if(Qe&&re>z){const tt=j.dist(Z);if(tt>2*k){const Ue=j.sub(j.sub(Z)._mult(k/tt)._round());this.updateDistance(Z,Ue),this.addCurrentVertex(Ue,ee,0,0,B),Z=Ue}}const ft=Z&&$;let nt=ft?o:M?"butt":u;if(ft&&nt==="round"&&(Xe<_?nt="miter":Xe<=2&&(nt="fakeround")),nt==="miter"&&Xe>g&&(nt="bevel"),nt==="bevel"&&(Xe>2&&(nt="flipbevel"),Xe<g&&(nt="miter")),Z&&this.updateDistance(Z,j),nt==="miter")ue._mult(Xe),this.addCurrentVertex(j,ue,0,0,B);else if(nt==="flipbevel"){if(Xe>100)ue=_e.mult(-1);else{const tt=Xe*ee.add(_e).mag()/ee.sub(_e).mag();ue._perp()._mult(tt*(it?-1:1))}this.addCurrentVertex(j,ue,0,0,B),this.addCurrentVertex(j,ue.mult(-1),0,0,B)}else if(nt==="bevel"||nt==="fakeround"){const tt=-Math.sqrt(Xe*Xe-1),Ue=it?tt:0,Mt=it?0:tt;if(Z&&this.addCurrentVertex(j,ee,Ue,Mt,B),nt==="fakeround"){const zt=Math.round(180*at/Math.PI/20);for(let _t=1;_t<zt;_t++){let ut=_t/zt;if(ut!==.5){const rn=ut-.5;ut+=ut*rn*(ut-1)*((1.0904+Me*(Me*(3.55645-1.43519*Me)-3.2452))*rn*rn+(.848013+Me*(.215638*Me-1.06021)))}const $t=_e.sub(ee)._mult(ut)._add(ee)._unit()._mult(it?-1:1);this.addHalfVertex(j,$t.x,$t.y,!1,it,0,B)}}$&&this.addCurrentVertex(j,_e,-Ue,-Mt,B)}else if(nt==="butt")this.addCurrentVertex(j,ue,0,0,B);else if(nt==="square"){const tt=Z?1:-1;this.addCurrentVertex(j,ue,tt,tt,B)}else nt==="round"&&(Z&&(this.addCurrentVertex(j,ee,0,0,B),this.addCurrentVertex(j,ee,1,1,B,!0)),$&&(this.addCurrentVertex(j,_e,-1,-1,B,!0),this.addCurrentVertex(j,_e,0,0,B)));if(Qe&&re<E-1){const tt=j.dist($);if(tt>2*k){const Ue=j.add($.sub(j)._mult(k/tt)._round());this.updateDistance(j,Ue),this.addCurrentVertex(Ue,_e,0,0,B),j=Ue}}}}addCurrentVertex(t,n,o,u,g,_=!1){const v=n.y*u-n.x,x=-n.y-n.x*u;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,_,!1,o,g),this.addHalfVertex(t,v,x,_,!0,-u,g),this.distance>Pu/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,u,g,_))}addHalfVertex({x:t,y:n},o,u,g,_,v,x){const M=.5*(this.lineClips?this.scaledDistance*(Pu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(n<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,E,this.e2),x.primitiveLength++),_?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}hasLineDasharray(t){for(const n of t){const o=n.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(t,n,o,u){for(const g of t){const _=g.paint.get("line-dasharray");if(!_||_.value.kind==="constant")continue;const v=g.layout.get("line-cap")==="round",x={dasharray:_.value.evaluate({zoom:o-1},n,{}),round:v},M={dasharray:_.value.evaluate({zoom:o},n,{}),round:v},E={dasharray:_.value.evaluate({zoom:o+1},n,{}),round:v},z=`${x.dasharray.join(",")},${x.round}`,k=`${M.dasharray.join(",")},${M.round}`,B=`${E.dasharray.join(",")},${E.round}`;u.dashDependencies[z]=x,u.dashDependencies[k]=M,u.dashDependencies[B]=E,n.dashes[g.id]={min:z,mid:k,max:B}}}}let pd,bh;rt("LineBucket",Ua,{omit:["layers","patternFeatures"]});var vf={get paint(){return bh=bh||new Oi({"line-opacity":new xt(xe.paint_line["line-opacity"]),"line-color":new xt(xe.paint_line["line-color"]),"line-translate":new ht(xe.paint_line["line-translate"]),"line-translate-anchor":new ht(xe.paint_line["line-translate-anchor"]),"line-width":new xt(xe.paint_line["line-width"]),"line-gap-width":new xt(xe.paint_line["line-gap-width"]),"line-offset":new xt(xe.paint_line["line-offset"]),"line-blur":new xt(xe.paint_line["line-blur"]),"line-dasharray":new Xo(xe.paint_line["line-dasharray"]),"line-pattern":new Xo(xe.paint_line["line-pattern"]),"line-gradient":new oa(xe.paint_line["line-gradient"])})},get layout(){return pd=pd||new Oi({"line-cap":new ht(xe.layout_line["line-cap"]),"line-join":new xt(xe.layout_line["line-join"]),"line-miter-limit":new ht(xe.layout_line["line-miter-limit"]),"line-round-limit":new ht(xe.layout_line["line-round-limit"]),"line-sort-key":new xt(xe.layout_line["line-sort-key"])})}};class md extends xt{possiblyEvaluate(t,n){return n=new ri(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,u){return n=fi({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,u)}}let Pc;class Il extends Wa{constructor(t,n){super(t,vf,n),this.gradientVersion=0,Pc||(Pc=new md(vf.paint.properties["line-width"].specification),Pc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof gl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Pc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Ua(t)}queryRadius(t){const n=t,o=$n(wc("line-width",this,n),wc("line-gap-width",this,n)),u=wc("line-offset",this,n);return o/2+Math.abs(u)+Pl(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:o,geometry:u,transform:g,pixelsToTileUnits:_}){const v=fh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-g.bearingInRadians,_),x=_/2*$n(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),M=this.paint.get("line-offset").evaluate(n,o);return M&&(u=function(E,z){const k=[];for(let B=0;B<E.length;B++){const j=E[B],Z=[];for(let $=0;$<j.length;$++){const ee=j[$-1],_e=j[$],re=j[$+1],ue=$===0?new be(0,0):_e.sub(ee)._unit()._perp(),Me=$===j.length-1?new be(0,0):re.sub(_e)._unit()._perp(),ke=ue._add(Me)._unit(),Xe=ke.x*Me.x+ke.y*Me.y;Xe!==0&&ke._mult(1/Xe),Z.push(ke._mult(z)._add(_e))}k.push(Z)}return k}(u,M*_)),function(E,z,k){for(let B=0;B<z.length;B++){const j=z[B];if(E.length>=3){for(let Z=0;Z<j.length;Z++)if(bc(E,j[Z]))return!0}if(ip(E,j,k))return!0}return!1}(v,u,x)}isTileClipped(){return!0}}function $n(a,t){return t>0?t+2*a:a}const Rl=gt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Du=gt([{name:"a_projected_pos",components:3,type:"Float32"}],4);gt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tl=gt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);gt([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const gd=gt([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xf=gt([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function pp(a,t,n){return a.sections.forEach(o=>{o.text=function(u,g,_){const v=g.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?u=u.toLocaleUpperCase():v==="lowercase"&&(u=u.toLocaleLowerCase()),Lr.applyArabicShaping&&(u=Lr.applyArabicShaping(u)),u}(o.text,t,n)}),a}gt([{name:"triangle",components:3,type:"Uint16"}]),gt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),gt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),gt([{type:"Float32",name:"offsetX"}]),gt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),gt([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const il={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var kn=24;const tr=4294967296,bf=1/tr,ir=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class _d{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,n,o=this.length){for(;this.pos<o;){const u=this.readVarint(),g=u>>3,_=this.pos;this.type=7&u,t(g,n,this),this.pos===_&&this.skip(u)}return n}readMessage(t,n){return this.readFields(t,n,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*tr;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*tr;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const n=this.buf;let o,u;return u=n[this.pos++],o=127&u,u<128?o:(u=n[this.pos++],o|=(127&u)<<7,u<128?o:(u=n[this.pos++],o|=(127&u)<<14,u<128?o:(u=n[this.pos++],o|=(127&u)<<21,u<128?o:(u=n[this.pos],o|=(15&u)<<28,function(g,_,v){const x=v.buf;let M,E;if(E=x[v.pos++],M=(112&E)>>4,E<128||(E=x[v.pos++],M|=(127&E)<<3,E<128)||(E=x[v.pos++],M|=(127&E)<<10,E<128)||(E=x[v.pos++],M|=(127&E)<<17,E<128)||(E=x[v.pos++],M|=(127&E)<<24,E<128)||(E=x[v.pos++],M|=(1&E)<<31,E<128))return Dc(g,M,_);throw new Error("Expected varint not more than 10 bytes")}(o,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&ir?ir.decode(this.buf.subarray(n,t)):function(o,u,g){let _="",v=u;for(;v<g;){const x=o[v];let M,E,z,k=null,B=x>239?4:x>223?3:x>191?2:1;if(v+B>g)break;B===1?x<128&&(k=x):B===2?(M=o[v+1],(192&M)==128&&(k=(31&x)<<6|63&M,k<=127&&(k=null))):B===3?(M=o[v+1],E=o[v+2],(192&M)==128&&(192&E)==128&&(k=(15&x)<<12|(63&M)<<6|63&E,(k<=2047||k>=55296&&k<=57343)&&(k=null))):B===4&&(M=o[v+1],E=o[v+2],z=o[v+3],(192&M)==128&&(192&E)==128&&(192&z)==128&&(k=(15&x)<<18|(63&M)<<12|(63&E)<<6|63&z,(k<=65535||k>=1114112)&&(k=null))),k===null?(k=65533,B=1):k>65535&&(k-=65536,_+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),_+=String.fromCharCode(k),v+=B}return _}(this.buf,n,t)}readBytes(){const t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n}readPackedVarint(t=[],n){const o=this.readPackedEnd();for(;this.pos<o;)t.push(this.readVarint(n));return t}readPackedSVarint(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const n=7&t;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(t,n){this.writeVarint(t<<3|n)}realloc(t){let n=this.length||16;for(;n<this.pos+t;)n*=2;if(n!==this.length){const o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*bf),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*bf),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?function(n,o){let u,g;if(n>=0?(u=n%4294967296|0,g=n/4294967296|0):(u=~(-n%4294967296),g=~(-n/4294967296),4294967295^u?u=u+1|0:(u=0,g=g+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(_,v,x){x.buf[x.pos++]=127&_|128,_>>>=7,x.buf[x.pos++]=127&_|128,_>>>=7,x.buf[x.pos++]=127&_|128,_>>>=7,x.buf[x.pos++]=127&_|128,x.buf[x.pos]=127&(_>>>=7)}(u,0,o),function(_,v){const x=(7&_)<<4;v.buf[v.pos++]|=x|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))}(g,o)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const n=this.pos;this.pos=function(u,g,_){for(let v,x,M=0;M<g.length;M++){if(v=g.charCodeAt(M),v>55295&&v<57344){if(!x){v>56319||M+1===g.length?(u[_++]=239,u[_++]=191,u[_++]=189):x=v;continue}if(v<56320){u[_++]=239,u[_++]=191,u[_++]=189,x=v;continue}v=x-55296<<10|v-56320|65536,x=null}else x&&(u[_++]=239,u[_++]=191,u[_++]=189,x=null);v<128?u[_++]=v:(v<2048?u[_++]=v>>6|192:(v<65536?u[_++]=v>>12|224:(u[_++]=v>>18|240,u[_++]=v>>12&63|128),u[_++]=v>>6&63|128),u[_++]=63&v|128)}return _}(this.buf,t,this.pos);const o=this.pos-n;o>=128&&mp(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const n=t.length;this.writeVarint(n),this.realloc(n);for(let o=0;o<n;o++)this.buf[this.pos++]=t[o]}writeRawMessage(t,n){this.pos++;const o=this.pos;t(n,this);const u=this.pos-o;u>=128&&mp(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(t,n,o){this.writeTag(t,2),this.writeRawMessage(n,o)}writePackedVarint(t,n){n.length&&this.writeMessage(t,Ll,n)}writePackedSVarint(t,n){n.length&&this.writeMessage(t,yd,n)}writePackedBoolean(t,n){n.length&&this.writeMessage(t,gp,n)}writePackedFloat(t,n){n.length&&this.writeMessage(t,wf,n)}writePackedDouble(t,n){n.length&&this.writeMessage(t,Iu,n)}writePackedFixed32(t,n){n.length&&this.writeMessage(t,_p,n)}writePackedSFixed32(t,n){n.length&&this.writeMessage(t,yp,n)}writePackedFixed64(t,n){n.length&&this.writeMessage(t,vp,n)}writePackedSFixed64(t,n){n.length&&this.writeMessage(t,vd,n)}writeBytesField(t,n){this.writeTag(t,2),this.writeBytes(n)}writeFixed32Field(t,n){this.writeTag(t,5),this.writeFixed32(n)}writeSFixed32Field(t,n){this.writeTag(t,5),this.writeSFixed32(n)}writeFixed64Field(t,n){this.writeTag(t,1),this.writeFixed64(n)}writeSFixed64Field(t,n){this.writeTag(t,1),this.writeSFixed64(n)}writeVarintField(t,n){this.writeTag(t,0),this.writeVarint(n)}writeSVarintField(t,n){this.writeTag(t,0),this.writeSVarint(n)}writeStringField(t,n){this.writeTag(t,2),this.writeString(n)}writeFloatField(t,n){this.writeTag(t,5),this.writeFloat(n)}writeDoubleField(t,n){this.writeTag(t,1),this.writeDouble(n)}writeBooleanField(t,n){this.writeVarintField(t,+n)}}function Dc(a,t,n){return n?4294967296*t+(a>>>0):4294967296*(t>>>0)+(a>>>0)}function mp(a,t,n){const o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(let u=n.pos-1;u>=a;u--)n.buf[u+o]=n.buf[u]}function Ll(a,t){for(let n=0;n<a.length;n++)t.writeVarint(a[n])}function yd(a,t){for(let n=0;n<a.length;n++)t.writeSVarint(a[n])}function wf(a,t){for(let n=0;n<a.length;n++)t.writeFloat(a[n])}function Iu(a,t){for(let n=0;n<a.length;n++)t.writeDouble(a[n])}function gp(a,t){for(let n=0;n<a.length;n++)t.writeBoolean(a[n])}function _p(a,t){for(let n=0;n<a.length;n++)t.writeFixed32(a[n])}function yp(a,t){for(let n=0;n<a.length;n++)t.writeSFixed32(a[n])}function vp(a,t){for(let n=0;n<a.length;n++)t.writeFixed64(a[n])}function vd(a,t){for(let n=0;n<a.length;n++)t.writeSFixed64(a[n])}function Tf(a,t,n){a===1&&n.readMessage(qp,t)}function qp(a,t,n){if(a===3){const{id:o,bitmap:u,width:g,height:_,left:v,top:x,advance:M}=n.readMessage(Hp,{});t.push({id:o,bitmap:new Tc({width:g+6,height:_+6},u),metrics:{width:g,height:_,left:v,top:x,advance:M}})}}function Hp(a,t,n){a===1?t.id=n.readVarint():a===2?t.bitmap=n.readBytes():a===3?t.width=n.readVarint():a===4?t.height=n.readVarint():a===5?t.left=n.readSVarint():a===6?t.top=n.readSVarint():a===7&&(t.advance=n.readVarint())}function xp(a){let t=0,n=0;for(const _ of a)t+=_.w*_.h,n=Math.max(n,_.w);a.sort((_,v)=>v.h-_.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let u=0,g=0;for(const _ of a)for(let v=o.length-1;v>=0;v--){const x=o[v];if(!(_.w>x.w||_.h>x.h)){if(_.x=x.x,_.y=x.y,g=Math.max(g,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===x.w&&_.h===x.h){const M=o.pop();M&&v<o.length&&(o[v]=M)}else _.h===x.h?(x.x+=_.w,x.w-=_.w):_.w===x.w?(x.y+=_.h,x.h-=_.h):(o.push({x:x.x+_.w,y:x.y,w:x.w-_.w,h:_.h}),x.y+=_.h,x.h-=_.h);break}}return{w:u,h:g,fill:t/(u*g)||0}}class xd{constructor(t,{pixelRatio:n,version:o,stretchX:u,stretchY:g,content:_,textFitWidth:v,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=u,this.stretchY=g,this.content=_,this.version=o,this.textFitWidth=v,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Sf{constructor(t,n){const o={},u={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,o,g),this.addImages(n,u,g);const{w:_,h:v}=xp(g),x=new ja({width:_||1,height:v||1});for(const M in t){const E=t[M],z=o[M].paddedRect;ja.copy(E.data,x,{x:0,y:0},{x:z.x+1,y:z.y+1},E.data)}for(const M in n){const E=n[M],z=u[M].paddedRect,k=z.x+1,B=z.y+1,j=E.data.width,Z=E.data.height;ja.copy(E.data,x,{x:0,y:0},{x:k,y:B},E.data),ja.copy(E.data,x,{x:0,y:Z-1},{x:k,y:B-1},{width:j,height:1}),ja.copy(E.data,x,{x:0,y:0},{x:k,y:B+Z},{width:j,height:1}),ja.copy(E.data,x,{x:j-1,y:0},{x:k-1,y:B},{width:1,height:Z}),ja.copy(E.data,x,{x:0,y:0},{x:k+j,y:B},{width:1,height:Z})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(t,n,o){for(const u in t){const g=t[u],_={x:0,y:0,w:g.data.width+2,h:g.data.height+2};o.push(_),n[u]=new xd(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[u,g]=t.tl;o.update(n.data,void 0,{x:u,y:g})}}var Fr;rt("ImagePosition",xd),rt("ImageAtlas",Sf),P.as=void 0,(Fr=P.as||(P.as={}))[Fr.none=0]="none",Fr[Fr.horizontal=1]="horizontal",Fr[Fr.vertical=2]="vertical",Fr[Fr.horizontalOnly=3]="horizontalOnly";class kl{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,n,o){const u=new kl;return u.scale=t||1,u.fontStack=n,u.verticalAlign=o||"bottom",u}static forImage(t,n){const o=new kl;return o.imageName=t,o.verticalAlign=n||"bottom",o}}class Ic{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new Ic;for(let u=0;u<t.sections.length;u++){const g=t.sections[u];g.image?o.addImageSection(g):o.addTextSection(g,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const u=t.charCodeAt(o+1)||null,g=t.charCodeAt(o-1)||null;n+=u&&dc(u)&&!il[t[o+1]]||g&&dc(g)&&!il[t[o-1]]||!il[t[o]]?t[o]:il[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Th[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Th[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new Ic;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}getMaxImageSize(t){let n=0,o=0;for(let u=0;u<this.length();u++){const g=this.getSection(u);if(g.imageName){const _=t[g.imageName];if(!_)continue;const v=_.displaySize;n=Math.max(n,v[0]),o=Math.max(o,v[1])}}return{maxImageWidth:n,maxImageHeight:o}}addTextSection(t,n){this.text+=t.text,this.sections.push(kl.forText(t.scale,t.fontStack||n,t.verticalAlign));const o=this.sections.length-1;for(let u=0;u<t.text.length;++u)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void ki("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(kl.forImage(n,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):ki("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wh(a,t,n,o,u,g,_,v,x,M,E,z,k,B,j){const Z=Ic.fromFeature(a,u);let $;z===P.as.vertical&&Z.verticalizePunctuation();const{processBidirectionalText:ee,processStyledBidirectionalText:_e}=Lr;if(ee&&Z.sections.length===1){$=[];const Me=ee(Z.toString(),Mh(Z,M,g,t,o,B));for(const ke of Me){const Xe=new Ic;Xe.text=ke,Xe.sections=Z.sections;for(let at=0;at<ke.length;at++)Xe.sectionIndex.push(0);$.push(Xe)}}else if(_e){$=[];const Me=_e(Z.text,Z.sectionIndex,Mh(Z,M,g,t,o,B));for(const ke of Me){const Xe=new Ic;Xe.text=ke[0],Xe.sectionIndex=ke[1],Xe.sections=Z.sections,$.push(Xe)}}else $=function(Me,ke){const Xe=[],at=Me.text;let Qe=0;for(const it of ke)Xe.push(Me.substring(Qe,it)),Qe=it;return Qe<at.length&&Xe.push(Me.substring(Qe,at.length)),Xe}(Z,Mh(Z,M,g,t,o,B));const re=[],ue={positionedLines:re,text:Z.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(Me,ke,Xe,at,Qe,it,ft,nt,tt,Ue,Mt,zt){let _t=0,ut=0,$t=0,rn=0;const En=nt==="right"?1:nt==="left"?0:.5,dn=kn/zt;let Wn=0;for(const Li of Qe){Li.trim();const Ji=Li.getMaxScale(),ua={positionedGlyphs:[],lineOffset:0};Me.positionedLines[Wn]=ua;const Qn=ua.positionedGlyphs;let Jn=0;if(!Li.length()){ut+=it,++Wn;continue}const Ur=Sp(at,Li,dn);for(let ba=0;ba<Li.length();ba++){const On=Li.getSection(ba),ea=Li.getSectionIndex(ba),Cn=Li.getCharCode(ba),fn=Xp(tt,Mt,Cn);let Ui;if(On.imageName){if(Me.iconsInText=!0,On.scale=On.scale*dn,Ui=bd(On,fn,Ji,Ur,at),!Ui)continue;Jn=Math.max(Jn,Ui.imageOffset)}else if(Ui=Yp(On,Cn,fn,Ur,ke,Xe),!Ui)continue;const{rect:Va,metrics:Bc,baselineOffset:Nr}=Ui;Qn.push({glyph:Cn,imageName:On.imageName,x:_t,y:ut+Nr+-17,vertical:fn,scale:On.scale,fontStack:On.fontStack,sectionIndex:ea,metrics:Bc,rect:Va}),fn?(Me.verticalizable=!0,_t+=(On.imageName?Bc.advance:kn)*On.scale+Ue):_t+=Bc.advance*On.scale+Ue}Qn.length!==0&&($t=Math.max(_t-Ue,$t),Ru(Qn,0,Qn.length-1,En)),_t=0,ua.lineOffset=Math.max(Jn,(Ji-1)*kn);const Nn=it*Ji+Jn;ut+=Nn,rn=Math.max(Nn,rn),++Wn}const{horizontalAlign:Bn,verticalAlign:An}=Af(ft);(function(Li,Ji,ua,Qn,Jn,Ur,Nn,ba,On){const ea=(Ji-ua)*Jn;let Cn=0;Cn=Ur!==Nn?-ba*Qn- -17:-Qn*On*Nn+.5*Nn;for(const fn of Li)for(const Ui of fn.positionedGlyphs)Ui.x+=ea,Ui.y+=Cn})(Me.positionedLines,En,Bn,An,$t,rn,it,ut,Qe.length),Me.top+=-An*ut,Me.bottom=Me.top+ut,Me.left+=-Bn*$t,Me.right=Me.left+$t}(ue,t,n,o,$,_,v,x,z,M,k,j),!function(Me){for(const ke of Me)if(ke.positionedGlyphs.length!==0)return!1;return!0}(re)&&ue}const Th={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},bp={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},wp={40:!0};function Mf(a,t,n,o,u,g){if(t.imageName){const _=o[t.imageName];return _?_.displaySize[0]*t.scale*kn/g+u:0}{const _=n[t.fontStack],v=_&&_[a];return v?v.metrics.advance*t.scale+u:0}}function Sh(a,t,n,o){const u=Math.pow(a-t,2);return o?a<t?u/2:2*u:u+Math.abs(n)*n}function Tp(a,t,n){let o=0;return a===10&&(o-=1e4),n&&(o+=150),a!==40&&a!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function Ef(a,t,n,o,u,g){let _=null,v=Sh(t,n,u,g);for(const x of o){const M=Sh(t-x.x,n,u,g)+x.badness;M<=v&&(_=x,v=M)}return{index:a,x:t,priorBreak:_,badness:v}}function Ii(a){return a?Ii(a.priorBreak).concat(a.index):[]}function Mh(a,t,n,o,u,g){if(!a)return[];const _=[],v=function(z,k,B,j,Z,$){let ee=0;for(let _e=0;_e<z.length();_e++){const re=z.getSection(_e);ee+=Mf(z.getCharCode(_e),re,j,Z,k,$)}return ee/Math.max(1,Math.ceil(ee/B))}(a,t,n,o,u,g),x=a.text.indexOf("")>=0;let M=0;for(let z=0;z<a.length();z++){const k=a.getSection(z),B=a.getCharCode(z);if(Th[B]||(M+=Mf(B,k,o,u,t,g)),z<a.length()-1){const j=!((E=B)<11904)&&(!!jt["CJK Compatibility Forms"](E)||!!jt["CJK Compatibility"](E)||!!jt["CJK Strokes"](E)||!!jt["CJK Symbols and Punctuation"](E)||!!jt["Enclosed CJK Letters and Months"](E)||!!jt["Halfwidth and Fullwidth Forms"](E)||!!jt["Ideographic Description Characters"](E)||!!jt["Vertical Forms"](E)||Go.test(String.fromCodePoint(E)));(bp[B]||j||k.imageName||z!==a.length()-2&&wp[a.getCharCode(z+1)])&&_.push(Ef(z+1,M,v,_,Tp(B,a.getCharCode(z+1),j&&x),!1))}}var E;return Ii(Ef(a.length(),M,v,_,0,!0))}function Af(a){let t=.5,n=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Sp(a,t,n){const o=t.getMaxScale()*kn,{maxImageWidth:u,maxImageHeight:g}=t.getMaxImageSize(a),_=Math.max(o,g*n);return{verticalLineContentWidth:Math.max(o,u*n),horizontalLineContentHeight:_}}function Mp(a){switch(a){case"top":return 0;case"center":return .5;default:return 1}}function Xp(a,t,n){return!(a===P.as.horizontal||!t&&!Zo(n)||t&&(Th[n]||(o=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Yp(a,t,n,o,u,g){const _=g[a.fontStack],v=function(M,E,z,k){if(M&&M.rect)return M;const B=E[z.fontStack],j=B&&B[k];return j?{rect:null,metrics:j.metrics}:null}(_&&_[t],u,a,t);if(v===null)return null;let x;if(n)x=o.verticalLineContentWidth-a.scale*kn;else{const M=Mp(a.verticalAlign);x=(o.horizontalLineContentHeight-a.scale*kn)*M}return{rect:v.rect,metrics:v.metrics,baselineOffset:x}}function bd(a,t,n,o,u){const g=u[a.imageName];if(!g)return null;const _=g.paddedRect,v=g.displaySize,x={width:v[0],height:v[1],left:1,top:-3,advance:t?v[1]:v[0]};let M;if(t)M=o.verticalLineContentWidth-v[1]*a.scale;else{const E=Mp(a.verticalAlign);M=(o.horizontalLineContentHeight-v[1]*a.scale)*E}return{rect:_,metrics:x,baselineOffset:M,imageOffset:(t?v[0]:v[1])*a.scale-kn*n}}function Ru(a,t,n,o){if(o===0)return;const u=a[n],g=(a[n].x+u.metrics.advance*u.scale)*o;for(let _=t;_<=n;_++)a[_].x-=g}function Cf(a,t,n){const{horizontalAlign:o,verticalAlign:u}=Af(n),g=t[0]-a.displaySize[0]*o,_=t[1]-a.displaySize[1]*u;return{image:a,top:_,bottom:_+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function Eh(a){var t,n;let o=a.left,u=a.top,g=a.right-o,_=a.bottom-u;const v=(t=a.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(n=a.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",M=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(x==="proportional"){if(v==="stretchOnly"&&g/_<M||v==="proportional"){const E=Math.ceil(_*M);o*=E/g,g=E}}else if(v==="proportional"&&x==="stretchOnly"&&M!==0&&g/_>M){const E=Math.ceil(g/M);u*=E/_,_=E}return{x1:o,y1:u,x2:o+g,y2:u+_}}function wd(a,t,n,o,u,g){const _=a.image;let v;if(_.content){const $=_.content,ee=_.pixelRatio||1;v=[$[0]/ee,$[1]/ee,_.displaySize[0]-$[2]/ee,_.displaySize[1]-$[3]/ee]}const x=t.left*g,M=t.right*g;let E,z,k,B;n==="width"||n==="both"?(B=u[0]+x-o[3],z=u[0]+M+o[1]):(B=u[0]+(x+M-_.displaySize[0])/2,z=B+_.displaySize[0]);const j=t.top*g,Z=t.bottom*g;return n==="height"||n==="both"?(E=u[1]+j-o[0],k=u[1]+Z+o[2]):(E=u[1]+(j+Z-_.displaySize[1])/2,k=E+_.displaySize[1]),{image:_,top:E,right:z,bottom:k,left:B,collisionPadding:v}}const Na=128,Ra=32640;function Lu(a,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new ri(a+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=n;let g=0;for(;g<o.length&&o[g]<=a;)g++;g=Math.max(0,g-1);let _=g;for(;_<o.length&&o[_]<a+1;)_++;_=Math.min(o.length-1,_);const v=o[g],x=o[_];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:v,maxZoom:x,minSize:n.evaluate(new ri(v)),maxSize:n.evaluate(new ri(x)),interpolationType:u}}}function zf(a,t,n){let o="never";const u=a.get(t);return u?o=u:a.get(n)&&(o="always"),o}const Ep=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ah(a,t,n,o,u,g,_,v,x,M,E,z,k){const B=v?Math.min(Ra,Math.round(v[0])):0,j=v?Math.min(Ra,Math.round(v[1])):0;a.emplaceBack(t,n,Math.round(32*o),Math.round(32*u),g,_,(B<<1)+(x?1:0),j,16*M,16*E,256*z,256*k)}function Td(a,t,n){a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n)}function Ap(a){for(const t of a.sections)if(ch(t.text))return!0;return!1}class Pf{constructor(t){this.layoutVertexArray=new Se,this.indexArray=new Fe,this.programConfigurations=t,this.segments=new Vt,this.dynamicLayoutVertexArray=new Ce,this.opacityVertexArray=new Ie,this.hasVisibleVertices=!1,this.placedSymbolArray=new A}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Rl.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Du.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ep,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}rt("SymbolBuffers",Pf);class Ch{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Vt,this.collisionVertexArray=new We}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,tl.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}rt("CollisionBuffers",Ch);class Rc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=Vs(globalThis)?Math.min(t.overscaling,128):t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Lu(this.zoom,n["text-size"]),this.iconSizeData=Lu(this.zoom,n["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),g=o.get("symbol-z-order");this.canOverlap=zf(o,"text-overlap","text-allow-overlap")!=="never"||zf(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(_=>P.as[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID}createArrays(){this.text=new Pf(new po(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Pf(new po(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new D,this.lineVertexArray=new O,this.symbolInstances=new I,this.textAnchorOffsets=new K}calculateGlyphDependencies(t,n,o,u,g){for(let _=0;_<t.length;_++)if(n[t.charCodeAt(_)]=!0,(o||u)&&g){const v=il[t.charAt(_)];v&&(n[v.charCodeAt(0)]=!0)}}populate(t,n,o){const u=this.layers[0],g=u.layout,_=g.get("text-font"),v=g.get("text-field"),x=g.get("icon-image"),M=(v.value.kind!=="constant"||v.value.value instanceof jn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,z=g.get("symbol-sort-key");if(this.features=[],!M&&!E)return;const k=n.iconDependencies,B=n.glyphDependencies,j=n.availableImages,Z=new ri(this.zoom);for(const{feature:$,id:ee,index:_e,sourceLayerIndex:re}of t){const ue=u._featureFilter.needGeometry,Me=ks($,ue);if(!u._featureFilter.filter(Z,Me,o))continue;let ke,Xe;if(ue||(Me.geometry=Pa($)),M){const Qe=u.getValueAndResolveTokens("text-field",Me,o,j),it=jn.factory(Qe),ft=this.hasRTLText=this.hasRTLText||Ap(it);(!ft||Lr.getRTLTextPluginStatus()==="unavailable"||ft&&Lr.isParsed())&&(ke=pp(it,u,Me))}if(E){const Qe=u.getValueAndResolveTokens("icon-image",Me,o,j);Xe=Qe instanceof aa?Qe:aa.fromString(Qe)}if(!ke&&!Xe)continue;const at=this.sortFeaturesByKey?z.evaluate(Me,{},o):void 0;if(this.features.push({id:ee,text:ke,icon:Xe,index:_e,sourceLayerIndex:re,geometry:Me.geometry,properties:$.properties,type:Cc.types[$.type],sortKey:at}),Xe&&(k[Xe.name]=!0),ke){const Qe=_.evaluate(Me,{},o).join(","),it=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(P.as.vertical)>=0;for(const ft of ke.sections)if(ft.image)k[ft.image.name]=!0;else{const nt=fu(ke.toString()),tt=ft.fontStack||Qe,Ue=B[tt]=B[tt]||{};this.calculateGlyphDependencies(ft.text,Ue,it,this.allowVerticalPlacement,nt)}}}g.get("symbol-placement")==="line"&&(this.features=function($){const ee={},_e={},re=[];let ue=0;function Me(Qe){re.push($[Qe]),ue++}function ke(Qe,it,ft){const nt=_e[Qe];return delete _e[Qe],_e[it]=nt,re[nt].geometry[0].pop(),re[nt].geometry[0]=re[nt].geometry[0].concat(ft[0]),nt}function Xe(Qe,it,ft){const nt=ee[it];return delete ee[it],ee[Qe]=nt,re[nt].geometry[0].shift(),re[nt].geometry[0]=ft[0].concat(re[nt].geometry[0]),nt}function at(Qe,it,ft){const nt=ft?it[0][it[0].length-1]:it[0][0];return`${Qe}:${nt.x}:${nt.y}`}for(let Qe=0;Qe<$.length;Qe++){const it=$[Qe],ft=it.geometry,nt=it.text?it.text.toString():null;if(!nt){Me(Qe);continue}const tt=at(nt,ft),Ue=at(nt,ft,!0);if(tt in _e&&Ue in ee&&_e[tt]!==ee[Ue]){const Mt=Xe(tt,Ue,ft),zt=ke(tt,Ue,re[Mt].geometry);delete ee[tt],delete _e[Ue],_e[at(nt,re[zt].geometry,!0)]=zt,re[Mt].geometry=null}else tt in _e?ke(tt,Ue,ft):Ue in ee?Xe(tt,Ue,ft):(Me(Qe),ee[tt]=ue-1,_e[Ue]=ue-1)}return re.filter(Qe=>Qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort(($,ee)=>$.sortKey-ee.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let u=t.dist(n[t.segment+1]),g=t.dist(n[t.segment]);const _={};for(let v=t.segment+1;v<n.length;v++)_[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:u},v<n.length-1&&(u+=n[v+1].dist(n[v]));for(let v=t.segment||0;v>=0;v--)_[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:g},v>0&&(g+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){const x=_[v];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,u,g,_,v,x,M,E,z,k){const B=t.indexArray,j=t.layoutVertexArray,Z=t.segments.prepareSegment(4*n.length,j,B,this.canOverlap?_.sortKey:void 0),$=this.glyphOffsetArray.length,ee=Z.vertexLength,_e=this.allowVerticalPlacement&&v===P.as.vertical?Math.PI/2:0,re=_.text&&_.text.sections;for(let ue=0;ue<n.length;ue++){const{tl:Me,tr:ke,bl:Xe,br:at,tex:Qe,pixelOffsetTL:it,pixelOffsetBR:ft,minFontScaleX:nt,minFontScaleY:tt,glyphOffset:Ue,isSDF:Mt,sectionIndex:zt}=n[ue],_t=Z.vertexLength,ut=Ue[1];Ah(j,x.x,x.y,Me.x,ut+Me.y,Qe.x,Qe.y,o,Mt,it.x,it.y,nt,tt),Ah(j,x.x,x.y,ke.x,ut+ke.y,Qe.x+Qe.w,Qe.y,o,Mt,ft.x,it.y,nt,tt),Ah(j,x.x,x.y,Xe.x,ut+Xe.y,Qe.x,Qe.y+Qe.h,o,Mt,it.x,ft.y,nt,tt),Ah(j,x.x,x.y,at.x,ut+at.y,Qe.x+Qe.w,Qe.y+Qe.h,o,Mt,ft.x,ft.y,nt,tt),Td(t.dynamicLayoutVertexArray,x,_e),B.emplaceBack(_t,_t+2,_t+1),B.emplaceBack(_t+1,_t+2,_t+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ue[0]),ue!==n.length-1&&zt===n[ue+1].sectionIndex||t.programConfigurations.populatePaintArrays(j.length,_,_.index,{imagePositions:{},canonical:k,formattedSection:re&&re[zt]})}t.placedSymbolArray.emplaceBack(x.x,x.y,$,this.glyphOffsetArray.length-$,ee,M,E,x.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],v,0,!1,0,z)}_addCollisionDebugVertex(t,n,o,u,g,_){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,u,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,n,o,u,g,_,v){const x=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),M=x.vertexLength,E=g.layoutVertexArray,z=g.collisionVertexArray,k=v.anchorX,B=v.anchorY;this._addCollisionDebugVertex(E,z,_,k,B,new be(t,n)),this._addCollisionDebugVertex(E,z,_,k,B,new be(o,n)),this._addCollisionDebugVertex(E,z,_,k,B,new be(o,u)),this._addCollisionDebugVertex(E,z,_,k,B,new be(t,u)),x.vertexLength+=4;const j=g.indexArray;j.emplaceBack(M,M+1),j.emplaceBack(M+1,M+2),j.emplaceBack(M+2,M+3),j.emplaceBack(M+3,M),x.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,u){for(let g=t;g<n;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,u?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ch(Ke,gd.members,lt),this.iconCollisionBox=new Ch(Ke,gd.members,lt);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,u,g,_,v,x,M){const E={};for(let z=n;z<o;z++){const k=t.get(z);E.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},E.textFeatureIndex=k.featureIndex;break}for(let z=u;z<g;z++){const k=t.get(z);E.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},E.verticalTextFeatureIndex=k.featureIndex;break}for(let z=_;z<v;z++){const k=t.get(z);E.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},E.iconFeatureIndex=k.featureIndex;break}for(let z=x;z<M;z++){const k=t.get(z);E.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},E.verticalIconFeatureIndex=k.featureIndex;break}return E}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),u=o.vertexStartIndex+4*o.numGlyphs;for(let g=o.vertexStartIndex;g<u;g+=4)t.indexArray.emplaceBack(g,g+2,g+1),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),u=[],g=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const x=this.symbolInstances.get(v);u.push(0|Math.round(n*x.anchorX+o*x.anchorY)),g.push(x.featureIndex)}return _.sort((v,x)=>u[v]-u[x]||g[x]-g[v]),_}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((u,g,_)=>{u>=0&&_.indexOf(u)===g&&this.addIndicesForPlacedSymbol(this.text,u)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Df,Cp;rt("SymbolBucket",Rc,{omit:["layers","collisionBoxArray","features","compareText"]}),Rc.MAX_GLYPHS=65535,Rc.addDynamicAttributes=Td;var zh={get paint(){return Cp=Cp||new Oi({"icon-opacity":new xt(xe.paint_symbol["icon-opacity"]),"icon-color":new xt(xe.paint_symbol["icon-color"]),"icon-halo-color":new xt(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new xt(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xt(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new ht(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new ht(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new xt(xe.paint_symbol["text-opacity"]),"text-color":new xt(xe.paint_symbol["text-color"],{runtimeType:Ar,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new xt(xe.paint_symbol["text-halo-color"]),"text-halo-width":new xt(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new xt(xe.paint_symbol["text-halo-blur"]),"text-translate":new ht(xe.paint_symbol["text-translate"]),"text-translate-anchor":new ht(xe.paint_symbol["text-translate-anchor"])})},get layout(){return Df=Df||new Oi({"symbol-placement":new ht(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new ht(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ht(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xt(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ht(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ht(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ht(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ht(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new ht(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ht(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new xt(xe.layout_symbol["icon-size"]),"icon-text-fit":new ht(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ht(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new xt(xe.layout_symbol["icon-image"]),"icon-rotate":new xt(xe.layout_symbol["icon-rotate"]),"icon-padding":new xt(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new ht(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new xt(xe.layout_symbol["icon-offset"]),"icon-anchor":new xt(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ht(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ht(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ht(xe.layout_symbol["text-rotation-alignment"]),"text-field":new xt(xe.layout_symbol["text-field"]),"text-font":new xt(xe.layout_symbol["text-font"]),"text-size":new xt(xe.layout_symbol["text-size"]),"text-max-width":new xt(xe.layout_symbol["text-max-width"]),"text-line-height":new ht(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new xt(xe.layout_symbol["text-letter-spacing"]),"text-justify":new xt(xe.layout_symbol["text-justify"]),"text-radial-offset":new xt(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ht(xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new xt(xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new xt(xe.layout_symbol["text-anchor"]),"text-max-angle":new ht(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new ht(xe.layout_symbol["text-writing-mode"]),"text-rotate":new xt(xe.layout_symbol["text-rotate"]),"text-padding":new ht(xe.layout_symbol["text-padding"]),"text-keep-upright":new ht(xe.layout_symbol["text-keep-upright"]),"text-transform":new xt(xe.layout_symbol["text-transform"]),"text-offset":new xt(xe.layout_symbol["text-offset"]),"text-allow-overlap":new ht(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new ht(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new ht(xe.layout_symbol["text-ignore-placement"]),"text-optional":new ht(xe.layout_symbol["text-optional"])})}};class Sd{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ci,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rt("FormatSectionOverride",Sd,{omit:["defaultValue"]});class Md extends Wa{constructor(t,n){super(t,zh,n)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const g of o)u.indexOf(g)<0&&u.push(g);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,u){const g=this.layout.get(t).evaluate(n,{},o,u),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||wl(_.value)||!g?g:function(v,x){return x.replace(/{([^{}]+)}/g,(M,E)=>v&&E in v?String(v[E]):"")}(n.properties,g)}createBucket(t){return new Rc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of zh.paint.overridableProperties){if(!Md.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new Sd(n),u=new ou(o,n.property.specification);let g=null;g=n.value.kind==="constant"||n.value.kind==="source"?new pa("source",u):new io("composite",u,n.value.zoomStops),this.paint._values[t]=new _r(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Md.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),u=zh.paint.properties[n];let g=!1;const _=v=>{for(const x of v)if(u.overrides&&u.overrides.hasOverride(x))return void(g=!0)};if(o.value.kind==="constant"&&o.value.value instanceof jn)_(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const v=M=>{g||(M instanceof zr&&$i(M.value)===or?_(M.value.sections):M instanceof Yc?_(M.sections):M.eachChild(v))},x=o.value;x._styleExpression&&v(x._styleExpression.expression)}return g}}let zp;var Ph={get paint(){return zp=zp||new Oi({"background-color":new ht(xe.paint_background["background-color"]),"background-pattern":new gu(xe.paint_background["background-pattern"]),"background-opacity":new ht(xe.paint_background["background-opacity"])})}};class $p extends Wa{constructor(t,n){super(t,Ph,n)}}class Pp extends Wa{constructor(t,n){super(t,{},n),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class si{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const If={once:!0},ku=63710088e-1;class _o{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _o(Yt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,u=t.lat*n,g=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((t.lng-this.lng)*n);return ku*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof _o)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new _o(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new _o(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Rf=2*Math.PI*ku;function Ed(a){return Rf*Math.cos(a*Math.PI/180)}function Bu(a){return(180+a)/360}function Dh(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Dp(a,t){return a/Ed(t)}function Lf(a){return 360*a-180}function Ad(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Ip(a,t){return a*Ed(Ad(t))}class Ou{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=_o.convert(t);return new Ou(Bu(o.lng),Dh(o.lat),Dp(n,o.lat))}toLngLat(){return new _o(Lf(this.x),Ad(this.y))}toAltitude(){return Ip(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Rf*(t=Ad(this.y),1/Math.cos(t*Math.PI/180));var t}}function kf(a,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[a*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class Ri{constructor(t,n,o){if(!function(u,g,_){return!(u<0||u>25||_<0||_>=Math.pow(2,u)||g<0||g>=Math.pow(2,u))}(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=ju(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const u=(_=this.y,v=this.z,x=kf(256*(g=this.x),256*(_=Math.pow(2,v)-_-1),v),M=kf(256*(g+1),256*(_+1),v),x[0]+","+x[1]+","+M[0]+","+M[1]);var g,_,v,x,M;const E=function(z,k,B){let j,Z="";for(let $=z;$>0;$--)j=1<<$-1,Z+=(k&j?1:0)+(B&j?2:0);return Z}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,u)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new be((t.x*n-this.x)*pt,(t.y*n-this.y)*pt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Cd{constructor(t,n){this.wrap=t,this.canonical=n,this.key=ju(t,n.z,n.z,n.x,n.y)}}class Fi{constructor(t,n,o,u,g){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Ri(o,+u,+g),this.key=ju(n,t,o,u,g)}clone(){return new Fi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new Fi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Fi(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?ju(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):ju(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-t.canonical.z;return!(n<0)&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Fi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new Fi(n,this.wrap,n,o,u),new Fi(n,this.wrap,n,o+1,u),new Fi(n,this.wrap,n,o,u+1),new Fi(n,this.wrap,n,o+1,u+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Fi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Fi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Ou(t.x-this.wrap,t.y))}}function ju(a,t,n,o,u){(a*=2)<0&&(a=-1*a-1);const g=1<<n;return(g*g*a+g*u+o).toString(36)+n.toString(36)+t.toString(36)}function Fu(a,t){return t?a.properties[t]:a.id}rt("CanonicalTileID",Ri),rt("OverscaledTileID",Fi,{omit:["terrainRttPosMatrix32f"]});class Lc{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const n=new Lc;return n.extend(t(new be(this.minX,this.minY))),n.extend(t(new be(this.maxX,this.minY))),n.extend(t(new be(this.minX,this.maxY))),n.extend(t(new be(this.maxX,this.maxY))),n}static fromPoints(t){const n=new Lc;for(const o of t)n.extend(o);return n}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class zd{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Pd{constructor(t,n,o,u,g){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=u,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class Ih{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Jr(pt,16,0),this.grid3D=new Jr(pt,16,0),this.featureIndexArray=new Q,this.promoteId=n}insert(t,n,o,u,g,_){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,g);const x=_?this.grid3D:this.grid;for(let M=0;M<n.length;M++){const E=n[M],z=[1/0,1/0,-1/0,-1/0];for(let k=0;k<E.length;k++){const B=E[k];z[0]=Math.min(z[0],B.x),z[1]=Math.min(z[1],B.y),z[2]=Math.max(z[2],B.x),z[3]=Math.max(z[3],B.y)}z[0]<pt&&z[1]<pt&&z[2]>=0&&z[3]>=0&&x.insert(v,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new fp(new _d(this.rawTileData)).layers,this.sourceLayerCoder=new zd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,u){this.loadVTLayers();const g=t.params,_=pt/t.tileSize/t.scale,v=Oa(g.filter,g.globalState),x=t.queryGeometry,M=t.queryPadding*_,E=Lc.fromPoints(x),z=this.grid.query(E.minX-M,E.minY-M,E.maxX+M,E.maxY+M),k=Lc.fromPoints(t.cameraQueryGeometry).expandBy(M),B=this.grid3D.query(k.minX,k.minY,k.maxX,k.maxY,($,ee,_e,re)=>function(ue,Me,ke,Xe,at){for(const it of ue)if(Me<=it.x&&ke<=it.y&&Xe>=it.x&&at>=it.y)return!0;const Qe=[new be(Me,ke),new be(Me,at),new be(Xe,at),new be(Xe,ke)];if(ue.length>2){for(const it of Qe)if(bc(ue,it))return!0}for(let it=0;it<ue.length-1;it++)if(np(ue[it],ue[it+1],Qe))return!0;return!1}(t.cameraQueryGeometry,$-M,ee-M,_e+M,re+M));for(const $ of B)z.push($);z.sort(Rp);const j={};let Z;for(let $=0;$<z.length;$++){const ee=z[$];if(ee===Z)continue;Z=ee;const _e=this.featureIndexArray.get(ee);let re=null;this.loadMatchingFeature(j,_e.bucketIndex,_e.sourceLayerIndex,_e.featureIndex,v,g.layers,g.availableImages,n,o,u,(ue,Me,ke)=>(re||(re=Pa(ue)),Me.queryIntersectsFeature({queryGeometry:x,feature:ue,featureState:ke,geometry:re,zoom:this.z,transform:t.transform,pixelsToTileUnits:_,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return j}loadMatchingFeature(t,n,o,u,g,_,v,x,M,E,z){const k=this.bucketLayerIDs[n];if(_&&!k.some($=>_.has($)))return;const B=this.sourceLayerCoder.decode(o),j=this.vtLayers[B].feature(u);if(g.needGeometry){const $=ks(j,!0);if(!g.filter(new ri(this.tileID.overscaledZ),$,this.tileID.canonical))return}else if(!g.filter(new ri(this.tileID.overscaledZ),j))return;const Z=this.getId(j,B);for(let $=0;$<k.length;$++){const ee=k[$];if(_&&!_.has(ee))continue;const _e=x[ee];if(!_e)continue;let re={};Z&&E&&(re=E.getState(_e.sourceLayer||"_geojsonTileLayer",Z));const ue=fi({},M[ee]);ue.paint=Bf(ue.paint,_e.paint,j,re,v),ue.layout=Bf(ue.layout,_e.layout,j,re,v);const Me=!z||z(j,_e,re);if(!Me)continue;const ke=new Pd(j,this.z,this.x,this.y,Z);ke.layer=ue;let Xe=t[ee];Xe===void 0&&(Xe=t[ee]=[]),Xe.push({featureIndex:u,feature:ke,intersectionZ:Me})}}lookupSymbolFeatures(t,n,o,u,g,_,v,x){const M={};this.loadVTLayers();const E=Oa(g.filterSpec,g.globalState);for(const z of t)this.loadMatchingFeature(M,o,u,z,E,_,v,x,n);return M}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){var o;let u=t.id;return this.promoteId&&(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(t.properties.cluster_id))),u}}function Bf(a,t,n,o,u){return ar(a,(g,_)=>{const v=t instanceof yr?t.get(_):null;return v&&v.evaluate?v.evaluate(n,o,u):v})}function Rp(a,t){return t-a}function Dd(a,t,n,o,u){const g=[];for(let _=0;_<a.length;_++){const v=a[_];let x;for(let M=0;M<v.length-1;M++){let E=v[M],z=v[M+1];E.x<t&&z.x<t||(E.x<t?E=new be(t,E.y+(t-E.x)/(z.x-E.x)*(z.y-E.y))._round():z.x<t&&(z=new be(t,E.y+(t-E.x)/(z.x-E.x)*(z.y-E.y))._round()),E.y<n&&z.y<n||(E.y<n?E=new be(E.x+(n-E.y)/(z.y-E.y)*(z.x-E.x),n)._round():z.y<n&&(z=new be(E.x+(n-E.y)/(z.y-E.y)*(z.x-E.x),n)._round()),E.x>=o&&z.x>=o||(E.x>=o?E=new be(o,E.y+(o-E.x)/(z.x-E.x)*(z.y-E.y))._round():z.x>=o&&(z=new be(o,E.y+(o-E.x)/(z.x-E.x)*(z.y-E.y))._round()),E.y>=u&&z.y>=u||(E.y>=u?E=new be(E.x+(u-E.y)/(z.y-E.y)*(z.x-E.x),u)._round():z.y>=u&&(z=new be(E.x+(u-E.y)/(z.y-E.y)*(z.x-E.x),u)._round()),x&&E.equals(x[x.length-1])||(x=[E],g.push(x)),x.push(z)))))}}return g}rt("FeatureIndex",Ih,{omit:["rawTileData","sourceLayerCoder"]});class yo extends be{constructor(t,n,o,u){super(t,n),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new yo(this.x,this.y,this.angle,this.segment)}}function Lp(a,t,n,o,u){if(t.segment===void 0||n===0)return!0;let g=t,_=t.segment+1,v=0;for(;v>-n/2;){if(_--,_<0)return!1;v-=a[_].dist(g),g=a[_]}v+=a[_].dist(a[_+1]),_++;const x=[];let M=0;for(;v<n/2;){const E=a[_],z=a[_+1];if(!z)return!1;let k=a[_-1].angleTo(E)-E.angleTo(z);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:v,angleDelta:k}),M+=k;v-x[0].distance>o;)M-=x.shift().angleDelta;if(M>u)return!1;_++,v+=E.dist(z)}return!0}function Of(a){let t=0;for(let n=0;n<a.length-1;n++)t+=a[n].dist(a[n+1]);return t}function kp(a,t,n){return a?.6*t*n:0}function jf(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function Kp(a,t,n,o,u,g){const _=kp(n,u,g),v=jf(n,o)*g;let x=0;const M=Of(a)/2;for(let E=0;E<a.length-1;E++){const z=a[E],k=a[E+1],B=z.dist(k);if(x+B>M){const j=(M-x)/B,Z=dr.number(z.x,k.x,j),$=dr.number(z.y,k.y,j),ee=new yo(Z,$,k.angleTo(z),E);return ee._round(),!_||Lp(a,ee,v,_,t)?ee:void 0}x+=B}}function Wp(a,t,n,o,u,g,_,v,x){const M=kp(o,g,_),E=jf(o,u),z=E*_,k=a[0].x===0||a[0].x===x||a[0].y===0||a[0].y===x;return t-z<t/4&&(t=z+t/4),nl(a,k?t/2*v%t:(E/2+2*g)*_*v%t,t,M,n,z,k,!1,x)}function nl(a,t,n,o,u,g,_,v,x){const M=g/2,E=Of(a);let z=0,k=t-n,B=[];for(let j=0;j<a.length-1;j++){const Z=a[j],$=a[j+1],ee=Z.dist($),_e=$.angleTo(Z);for(;k+n<z+ee;){k+=n;const re=(k-z)/ee,ue=dr.number(Z.x,$.x,re),Me=dr.number(Z.y,$.y,re);if(ue>=0&&ue<x&&Me>=0&&Me<x&&k-M>=0&&k+M<=E){const ke=new yo(ue,Me,_e,j);ke._round(),o&&!Lp(a,ke,g,o,u)||B.push(ke)}}z+=ee}return v||B.length||_||(B=nl(a,z/2,n,o,u,g,_,!0,x)),B}function Ff(a,t,n,o){const u=[],g=a.image,_=g.pixelRatio,v=g.paddedRect.w-2,x=g.paddedRect.h-2;let M={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};const E=g.stretchX||[[0,v]],z=g.stretchY||[[0,x]],k=(Ue,Mt)=>Ue+Mt[1]-Mt[0],B=E.reduce(k,0),j=z.reduce(k,0),Z=v-B,$=x-j;let ee=0,_e=B,re=0,ue=j,Me=0,ke=Z,Xe=0,at=$;if(g.content&&o){const Ue=g.content,Mt=Ue[2]-Ue[0],zt=Ue[3]-Ue[1];(g.textFitWidth||g.textFitHeight)&&(M=Eh(a)),ee=Rh(E,0,Ue[0]),re=Rh(z,0,Ue[1]),_e=Rh(E,Ue[0],Ue[2]),ue=Rh(z,Ue[1],Ue[3]),Me=Ue[0]-ee,Xe=Ue[1]-re,ke=Mt-_e,at=zt-ue}const Qe=M.x1,it=M.y1,ft=M.x2-Qe,nt=M.y2-it,tt=(Ue,Mt,zt,_t)=>{const ut=Rd(Ue.stretch-ee,_e,ft,Qe),$t=Ld(Ue.fixed-Me,ke,Ue.stretch,B),rn=Rd(Mt.stretch-re,ue,nt,it),En=Ld(Mt.fixed-Xe,at,Mt.stretch,j),dn=Rd(zt.stretch-ee,_e,ft,Qe),Wn=Ld(zt.fixed-Me,ke,zt.stretch,B),Bn=Rd(_t.stretch-re,ue,nt,it),An=Ld(_t.fixed-Xe,at,_t.stretch,j),Li=new be(ut,rn),Ji=new be(dn,rn),ua=new be(dn,Bn),Qn=new be(ut,Bn),Jn=new be($t/_,En/_),Ur=new be(Wn/_,An/_),Nn=t*Math.PI/180;if(Nn){const ea=Math.sin(Nn),Cn=Math.cos(Nn),fn=[Cn,-ea,ea,Cn];Li._matMult(fn),Ji._matMult(fn),Qn._matMult(fn),ua._matMult(fn)}const ba=Ue.stretch+Ue.fixed,On=Mt.stretch+Mt.fixed;return{tl:Li,tr:Ji,bl:Qn,br:ua,tex:{x:g.paddedRect.x+1+ba,y:g.paddedRect.y+1+On,w:zt.stretch+zt.fixed-ba,h:_t.stretch+_t.fixed-On},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Jn,pixelOffsetBR:Ur,minFontScaleX:ke/_/ft,minFontScaleY:at/_/nt,isSDF:n}};if(o&&(g.stretchX||g.stretchY)){const Ue=Id(E,Z,B),Mt=Id(z,$,j);for(let zt=0;zt<Ue.length-1;zt++){const _t=Ue[zt],ut=Ue[zt+1];for(let $t=0;$t<Mt.length-1;$t++)u.push(tt(_t,Mt[$t],ut,Mt[$t+1]))}}else u.push(tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:x+1}));return u}function Rh(a,t,n){let o=0;for(const u of a)o+=Math.max(t,Math.min(n,u[1]))-Math.max(t,Math.min(n,u[0]));return o}function Id(a,t,n){const o=[{fixed:-1,stretch:0}];for(const[u,g]of a){const _=o[o.length-1];o.push({fixed:u-_.stretch,stretch:_.stretch}),o.push({fixed:u-_.stretch,stretch:_.stretch+(g-u)})}return o.push({fixed:t+1,stretch:n}),o}function Rd(a,t,n,o){return a/t*n+o}function Ld(a,t,n,o){return a-t*n/o}rt("Anchor",yo);class Lh{constructor(t,n,o,u,g,_,v,x,M,E){var z;if(this.boxStartIndex=t.length,M){let k=_.top,B=_.bottom;const j=_.collisionPadding;j&&(k-=j[1],B+=j[3]);let Z=B-k;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{const k=!((z=_.image)===null||z===void 0)&&z.content&&(_.image.textFitWidth||_.image.textFitHeight)?Eh(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};k.y1=k.y1*v-x[0],k.y2=k.y2*v+x[2],k.x1=k.x1*v-x[3],k.x2=k.x2*v+x[1];const B=_.collisionPadding;if(B&&(k.x1-=B[0]*v,k.y1-=B[1]*v,k.x2+=B[2]*v,k.y2+=B[3]*v),E){const j=new be(k.x1,k.y1),Z=new be(k.x2,k.y1),$=new be(k.x1,k.y2),ee=new be(k.x2,k.y2),_e=E*Math.PI/180;j._rotate(_e),Z._rotate(_e),$._rotate(_e),ee._rotate(_e),k.x1=Math.min(j.x,Z.x,$.x,ee.x),k.x2=Math.max(j.x,Z.x,$.x,ee.x),k.y1=Math.min(j.y,Z.y,$.y,ee.y),k.y2=Math.max(j.y,Z.y,$.y,ee.y)}t.emplaceBack(n.x,n.y,k.x1,k.y1,k.x2,k.y2,o,u,g)}this.boxEndIndex=t.length}}class Uf{constructor(t=[],n=(o,u)=>o<u?-1:o>u?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,u=n[t];for(;t>0;){const g=t-1>>1,_=n[g];if(o(u,_)>=0)break;n[t]=_,t=g}n[t]=u}_down(t){const{data:n,compare:o}=this,u=this.length>>1,g=n[t];for(;t<u;){let _=1+(t<<1);const v=_+1;if(v<this.length&&o(n[v],n[_])<0&&(_=v),o(n[_],g)>=0)break;n[t]=n[_],t=_}n[t]=g}}function Nf(a,t=1,n=!1){const o=Lc.fromPoints(a[0]),u=Math.min(o.width(),o.height());let g=u/2;const _=new Uf([],Qp),{minX:v,minY:x,maxX:M,maxY:E}=o;if(u===0)return new be(v,x);for(let B=v;B<M;B+=u)for(let j=x;j<E;j+=u)_.push(new La(B+g,j+g,g,a));let z=function(B){let j=0,Z=0,$=0;const ee=B[0];for(let _e=0,re=ee.length,ue=re-1;_e<re;ue=_e++){const Me=ee[_e],ke=ee[ue],Xe=Me.x*ke.y-ke.x*Me.y;Z+=(Me.x+ke.x)*Xe,$+=(Me.y+ke.y)*Xe,j+=3*Xe}return new La(Z/j,$/j,0,B)}(a),k=_.length;for(;_.length;){const B=_.pop();(B.d>z.d||!z.d)&&(z=B,n&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,k)),B.max-z.d<=t||(g=B.h/2,_.push(new La(B.p.x-g,B.p.y-g,g,a)),_.push(new La(B.p.x+g,B.p.y-g,g,a)),_.push(new La(B.p.x-g,B.p.y+g,g,a)),_.push(new La(B.p.x+g,B.p.y+g,g,a)),k+=4)}return n&&(console.log(`num probes: ${k}`),console.log(`best distance: ${z.d}`)),z.p}function Qp(a,t){return t.max-a.max}function La(a,t,n,o){this.p=new be(a,t),this.h=n,this.d=function(u,g){let _=!1,v=1/0;for(let x=0;x<g.length;x++){const M=g[x];for(let E=0,z=M.length,k=z-1;E<z;k=E++){const B=M[E],j=M[k];B.y>u.y!=j.y>u.y&&u.x<(j.x-B.x)*(u.y-B.y)/(j.y-B.y)+B.x&&(_=!_),v=Math.min(v,va(u,B,j))}}return(_?1:-1)*Math.sqrt(v)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Kn;P.aI=void 0,(Kn=P.aI||(P.aI={}))[Kn.center=1]="center",Kn[Kn.left=2]="left",Kn[Kn.right=3]="right",Kn[Kn.top=4]="top",Kn[Kn.bottom=5]="bottom",Kn[Kn["top-left"]=6]="top-left",Kn[Kn["top-right"]=7]="top-right",Kn[Kn["bottom-left"]=8]="bottom-left",Kn[Kn["bottom-right"]=9]="bottom-right";const kd=Number.POSITIVE_INFINITY;function Vf(a,t){return t[1]!==kd?function(n,o,u){let g=0,_=0;switch(o=Math.abs(o),u=Math.abs(u),n){case"top-right":case"top-left":case"top":_=u-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-u}switch(n){case"top-right":case"bottom-right":case"right":g=-o;break;case"top-left":case"bottom-left":case"left":g=o}return[g,_]}(a,t[0],t[1]):function(n,o){let u=0,g=0;o<0&&(o=0);const _=o/Math.SQRT2;switch(n){case"top-right":case"top-left":g=_-7;break;case"bottom-right":case"bottom-left":g=7-_;break;case"bottom":g=7-o;break;case"top":g=o-7}switch(n){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=o;break;case"right":u=-o}return[u,g]}(a,t[0])}function Gf(a,t,n){var o;const u=a.layout,g=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(g){const v=g.values,x=[];for(let M=0;M<v.length;M+=2){const E=x[M]=v[M],z=v[M+1].map(k=>k*kn);E.startsWith("top")?z[1]-=7:E.startsWith("bottom")&&(z[1]+=7),x[M+1]=z}return new tn(x)}const _=u.get("text-variable-anchor");if(_){let v;v=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(t,{},n)*kn,kd]:u.get("text-offset").evaluate(t,{},n).map(M=>M*kn);const x=[];for(const M of _)x.push(M,Vf(M,v));return new tn(x)}return null}function kc(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function os(a,t,n,o,u,g,_,v,x,M,E,z){let k=g.textMaxSize.evaluate(t,{});k===void 0&&(k=_);const B=a.layers[0].layout,j=B.get("icon-offset").evaluate(t,{},E),Z=kh(n.horizontal),$=_/24,ee=a.tilePixelRatio*$,_e=a.tilePixelRatio*k/24,re=a.tilePixelRatio*v,ue=a.tilePixelRatio*B.get("symbol-spacing"),Me=B.get("text-padding")*a.tilePixelRatio,ke=function(zt,_t,ut,$t=1){const rn=zt.get("icon-padding").evaluate(_t,{},ut),En=rn&&rn.values;return[En[0]*$t,En[1]*$t,En[2]*$t,En[3]*$t]}(B,t,E,a.tilePixelRatio),Xe=B.get("text-max-angle")/180*Math.PI,at=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",Qe=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",it=B.get("symbol-placement"),ft=ue/2,nt=B.get("icon-text-fit");let tt;o&&nt!=="none"&&(a.allowVerticalPlacement&&n.vertical&&(tt=wd(o,n.vertical,nt,B.get("icon-text-fit-padding"),j,$)),Z&&(o=wd(o,Z,nt,B.get("icon-text-fit-padding"),j,$)));const Ue=E?z.line.getGranularityForZoomLevel(E.z):1,Mt=(zt,_t)=>{_t.x<0||_t.x>=pt||_t.y<0||_t.y>=pt||function(ut,$t,rn,En,dn,Wn,Bn,An,Li,Ji,ua,Qn,Jn,Ur,Nn,ba,On,ea,Cn,fn,Ui,Va,Bc,Nr,jd){const Oc=ut.addToLineVertexArray($t,rn);let jc,rl,i,s,c=0,p=0,b=0,S=0,R=-1,X=-1;const he={};let Re=ns("");if(ut.allowVerticalPlacement&&En.vertical){const Rt=An.layout.get("text-rotate").evaluate(Ui,{},Nr)+90;i=new Lh(Li,$t,Ji,ua,Qn,En.vertical,Jn,Ur,Nn,Rt),Bn&&(s=new Lh(Li,$t,Ji,ua,Qn,Bn,On,ea,Nn,Rt))}if(dn){const Rt=An.layout.get("icon-rotate").evaluate(Ui,{}),Xt=An.layout.get("icon-text-fit")!=="none",Tr=Ff(dn,Rt,Bc,Xt),Fs=Bn?Ff(Bn,Rt,Bc,Xt):void 0;rl=new Lh(Li,$t,Ji,ua,Qn,dn,On,ea,!1,Rt),c=4*Tr.length;const Fh=ut.iconSizeData;let jl=null;Fh.kind==="source"?(jl=[Na*An.layout.get("icon-size").evaluate(Ui,{})],jl[0]>Ra&&ki(`${ut.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Fh.kind==="composite"&&(jl=[Na*Va.compositeIconSizes[0].evaluate(Ui,{},Nr),Na*Va.compositeIconSizes[1].evaluate(Ui,{},Nr)],(jl[0]>Ra||jl[1]>Ra)&&ki(`${ut.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ut.addSymbols(ut.icon,Tr,jl,fn,Cn,Ui,P.as.none,$t,Oc.lineStartIndex,Oc.lineLength,-1,Nr),R=ut.icon.placedSymbolArray.length-1,Fs&&(p=4*Fs.length,ut.addSymbols(ut.icon,Fs,jl,fn,Cn,Ui,P.as.vertical,$t,Oc.lineStartIndex,Oc.lineLength,-1,Nr),X=ut.icon.placedSymbolArray.length-1)}const Ge=Object.keys(En.horizontal);for(const Rt of Ge){const Xt=En.horizontal[Rt];if(!jc){Re=ns(Xt.text);const Fs=An.layout.get("text-rotate").evaluate(Ui,{},Nr);jc=new Lh(Li,$t,Ji,ua,Qn,Xt,Jn,Ur,Nn,Fs)}const Tr=Xt.positionedLines.length===1;if(b+=Zf(ut,$t,Xt,Wn,An,Nn,Ui,ba,Oc,En.vertical?P.as.horizontal:P.as.horizontalOnly,Tr?Ge:[Rt],he,R,Va,Nr),Tr)break}En.vertical&&(S+=Zf(ut,$t,En.vertical,Wn,An,Nn,Ui,ba,Oc,P.as.vertical,["vertical"],he,X,Va,Nr));const Ye=jc?jc.boxStartIndex:ut.collisionBoxArray.length,Le=jc?jc.boxEndIndex:ut.collisionBoxArray.length,Oe=i?i.boxStartIndex:ut.collisionBoxArray.length,yt=i?i.boxEndIndex:ut.collisionBoxArray.length,kt=rl?rl.boxStartIndex:ut.collisionBoxArray.length,Xi=rl?rl.boxEndIndex:ut.collisionBoxArray.length,Te=s?s.boxStartIndex:ut.collisionBoxArray.length,ve=s?s.boxEndIndex:ut.collisionBoxArray.length;let Ee=-1;const qe=(Rt,Xt)=>Rt&&Rt.circleDiameter?Math.max(Rt.circleDiameter,Xt):Xt;Ee=qe(jc,Ee),Ee=qe(i,Ee),Ee=qe(rl,Ee),Ee=qe(s,Ee);const At=Ee>-1?1:0;At&&(Ee*=jd/kn),ut.glyphOffsetArray.length>=Rc.MAX_GLYPHS&&ki("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ui.sortKey!==void 0&&ut.addToSortKeyRanges(ut.symbolInstances.length,Ui.sortKey);const vi=Gf(An,Ui,Nr),[bt,Wt]=function(Rt,Xt){const Tr=Rt.length,Fs=Xt?.values;if(Fs?.length>0)for(let Fh=0;Fh<Fs.length;Fh+=2){const jl=Fs[Fh+1];Rt.emplaceBack(P.aI[Fs[Fh]],jl[0],jl[1])}return[Tr,Rt.length]}(ut.textAnchorOffsets,vi);ut.symbolInstances.emplaceBack($t.x,$t.y,he.right>=0?he.right:-1,he.center>=0?he.center:-1,he.left>=0?he.left:-1,he.vertical||-1,R,X,Re,Ye,Le,Oe,yt,kt,Xi,Te,ve,Ji,b,S,c,p,At,0,Jn,Ee,bt,Wt)}(a,_t,zt,n,o,u,tt,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,ee,[Me,Me,Me,Me],at,x,re,ke,Qe,j,t,g,M,E,_)};if(it==="line")for(const zt of Dd(t.geometry,0,0,pt,pt)){const _t=er(zt,Ue),ut=Wp(_t,ue,Xe,n.vertical||Z,o,24,_e,a.overscaling,pt);for(const $t of ut)Z&&al(a,Z.text,ft,$t)||Mt(_t,$t)}else if(it==="line-center"){for(const zt of t.geometry)if(zt.length>1){const _t=er(zt,Ue),ut=Kp(_t,Xe,n.vertical||Z,o,24,_e);ut&&Mt(_t,ut)}}else if(t.type==="Polygon")for(const zt of Jl(t.geometry,0)){const _t=Nf(zt,16);Mt(er(zt[0],Ue,!0),new yo(_t.x,_t.y,0))}else if(t.type==="LineString")for(const zt of t.geometry){const _t=er(zt,Ue);Mt(_t,new yo(_t[0].x,_t[0].y,0))}else if(t.type==="Point")for(const zt of t.geometry)for(const _t of zt)Mt([_t],new yo(_t.x,_t.y,0))}function Zf(a,t,n,o,u,g,_,v,x,M,E,z,k,B,j){const Z=function(_e,re,ue,Me,ke,Xe,at,Qe){const it=Me.layout.get("text-rotate").evaluate(Xe,{})*Math.PI/180,ft=[];for(const nt of re.positionedLines)for(const tt of nt.positionedGlyphs){if(!tt.rect)continue;const Ue=tt.rect||{};let Mt=4,zt=!0,_t=1,ut=0;const $t=(ke||Qe)&&tt.vertical,rn=tt.metrics.advance*tt.scale/2;if(Qe&&re.verticalizable&&(ut=nt.lineOffset/2-(tt.imageName?-(kn-tt.metrics.width*tt.scale)/2:(tt.scale-1)*kn)),tt.imageName){const ea=at[tt.imageName];zt=ea.sdf,_t=ea.pixelRatio,Mt=1/_t}const En=ke?[tt.x+rn,tt.y]:[0,0];let dn=ke?[0,0]:[tt.x+rn+ue[0],tt.y+ue[1]-ut],Wn=[0,0];$t&&(Wn=dn,dn=[0,0]);const Bn=tt.metrics.isDoubleResolution?2:1,An=(tt.metrics.left-Mt)*tt.scale-rn+dn[0],Li=(-tt.metrics.top-Mt)*tt.scale+dn[1],Ji=An+Ue.w/Bn*tt.scale/_t,ua=Li+Ue.h/Bn*tt.scale/_t,Qn=new be(An,Li),Jn=new be(Ji,Li),Ur=new be(An,ua),Nn=new be(Ji,ua);if($t){const ea=new be(-rn,rn- -17),Cn=-Math.PI/2,fn=12-rn,Ui=new be(22-fn,-(tt.imageName?fn:0)),Va=new be(...Wn);Qn._rotateAround(Cn,ea)._add(Ui)._add(Va),Jn._rotateAround(Cn,ea)._add(Ui)._add(Va),Ur._rotateAround(Cn,ea)._add(Ui)._add(Va),Nn._rotateAround(Cn,ea)._add(Ui)._add(Va)}if(it){const ea=Math.sin(it),Cn=Math.cos(it),fn=[Cn,-ea,ea,Cn];Qn._matMult(fn),Jn._matMult(fn),Ur._matMult(fn),Nn._matMult(fn)}const ba=new be(0,0),On=new be(0,0);ft.push({tl:Qn,tr:Jn,bl:Ur,br:Nn,tex:Ue,writingMode:re.writingMode,glyphOffset:En,sectionIndex:tt.sectionIndex,isSDF:zt,pixelOffsetTL:ba,pixelOffsetBR:On,minFontScaleX:0,minFontScaleY:0})}return ft}(0,n,v,u,g,_,o,a.allowVerticalPlacement),$=a.textSizeData;let ee=null;$.kind==="source"?(ee=[Na*u.layout.get("text-size").evaluate(_,{})],ee[0]>Ra&&ki(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):$.kind==="composite"&&(ee=[Na*B.compositeTextSizes[0].evaluate(_,{},j),Na*B.compositeTextSizes[1].evaluate(_,{},j)],(ee[0]>Ra||ee[1]>Ra)&&ki(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,Z,ee,v,g,_,M,t,x.lineStartIndex,x.lineLength,k,j);for(const _e of E)z[_e]=a.text.placedSymbolArray.length-1;return 4*Z.length}function kh(a){for(const t in a)return a[t];return null}function al(a,t,n,o){const u=a.compareText;if(t in u){const g=u[t];for(let _=g.length-1;_>=0;_--)if(o.dist(g[_])<n)return!0}else u[t]=[];return u[t].push(o),!1}const Bp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qf{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const g=Bp[15&o];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new qf(v,_,g,t)}constructor(t,n=64,o=Float64Array,u){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=Bp.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Bl(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:v}=this,x=[0,g.length-1,0],M=[];for(;x.length;){const E=x.pop()||0,z=x.pop()||0,k=x.pop()||0;if(z-k<=v){for(let $=k;$<=z;$++){const ee=_[2*$],_e=_[2*$+1];ee>=t&&ee<=o&&_e>=n&&_e<=u&&M.push(g[$])}continue}const B=k+z>>1,j=_[2*B],Z=_[2*B+1];j>=t&&j<=o&&Z>=n&&Z<=u&&M.push(g[B]),(E===0?t<=j:n<=Z)&&(x.push(k),x.push(B-1),x.push(1-E)),(E===0?o>=j:u>=Z)&&(x.push(B+1),x.push(z),x.push(1-E))}return M}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:g,nodeSize:_}=this,v=[0,u.length-1,0],x=[],M=o*o;for(;v.length;){const E=v.pop()||0,z=v.pop()||0,k=v.pop()||0;if(z-k<=_){for(let $=k;$<=z;$++)Op(g[2*$],g[2*$+1],t,n)<=M&&x.push(u[$]);continue}const B=k+z>>1,j=g[2*B],Z=g[2*B+1];Op(j,Z,t,n)<=M&&x.push(u[B]),(E===0?t-o<=j:n-o<=Z)&&(v.push(k),v.push(B-1),v.push(1-E)),(E===0?t+o>=j:n+o>=Z)&&(v.push(B+1),v.push(z),v.push(1-E))}return x}}function Bl(a,t,n,o,u,g){if(u-o<=n)return;const _=o+u>>1;Hf(a,t,_,o,u,g),Bl(a,t,n,o,_-1,1-g),Bl(a,t,n,_+1,u,1-g)}function Hf(a,t,n,o,u,g){for(;u>o;){if(u-o>600){const M=u-o+1,E=n-o+1,z=Math.log(M),k=.5*Math.exp(2*z/3),B=.5*Math.sqrt(z*k*(M-k)/M)*(E-M/2<0?-1:1);Hf(a,t,n,Math.max(o,Math.floor(n-E*k/M+B)),Math.min(u,Math.floor(n+(M-E)*k/M+B)),g)}const _=t[2*n+g];let v=o,x=u;for(Bh(a,t,o,n),t[2*u+g]>_&&Bh(a,t,o,u);v<x;){for(Bh(a,t,v,x),v++,x--;t[2*v+g]<_;)v++;for(;t[2*x+g]>_;)x--}t[2*o+g]===_?Bh(a,t,o,x):(x++,Bh(a,t,x,u)),x<=n&&(o=x+1),n<=x&&(u=x-1)}}function Bh(a,t,n,o){Xf(a,n,o),Xf(t,2*n,2*o),Xf(t,2*n+1,2*o+1)}function Xf(a,t,n){const o=a[t];a[t]=a[n],a[n]=o}function Op(a,t,n,o){const u=a-n,g=t-o;return u*u+g*g}var Yf;P.cA=void 0,(Yf=P.cA||(P.cA={})).create="create",Yf.load="load",Yf.fullLoad="fullLoad";let Bd=null,Oh=[];const $f=1e3/60,Od="loadTime",Ol="fullLoadTime",jh={mark(a){performance.mark(a)},frame(a){const t=a;Bd!=null&&Oh.push(t-Bd),Bd=t},clearMetrics(){Bd=null,Oh=[],performance.clearMeasures(Od),performance.clearMeasures(Ol);for(const a in P.cA)performance.clearMarks(P.cA[a])},getPerformanceMetrics(){performance.measure(Od,P.cA.create,P.cA.load),performance.measure(Ol,P.cA.create,P.cA.fullLoad);const a=performance.getEntriesByName(Od)[0].duration,t=performance.getEntriesByName(Ol)[0].duration,n=Oh.length,o=1/(Oh.reduce((g,_)=>g+_,0)/n/1e3),u=Oh.filter(g=>g>$f).reduce((g,_)=>g+(_-$f)/$f,0);return{loadTime:a,fullLoadTime:t,fps:o,percentDroppedFrames:u/(n+u)*100,totalFrames:n}}};P.$=Zs,P.A=St,P.B=Tl,P.C=function([a,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:a*Math.cos(t)*Math.sin(n),y:a*Math.sin(t)*Math.sin(n),z:a*Math.cos(n)}},P.D=ht,P.E=dt,P.F=dr,P.G=ri,P.H=cc,P.I=xd,P.J=Vs,P.K=class{constructor(a,t){this.target=a,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new si(()=>this.process()),this.subscription=pn(this.target,"message",n=>this.receive(n),!1),this.globalScope=Ci(self)?a:window}registerMessageHandler(a,t){this.messageHandlers[a]=t}sendAsync(a,t){return new Promise((n,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),g=t?pn(t.signal,"abort",()=>{g?.unsubscribe(),delete this.resolveRejects[u];const x={id:u,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)},If):null;this.resolveRejects[u]={resolve:x=>{g?.unsubscribe(),n(x)},reject:x=>{g?.unsubscribe(),o(x)}};const _=[],v=Object.assign(Object.assign({},a),{id:u,sourceMapId:this.mapId,origin:location.origin,data:ts(a.data,_)});this.target.postMessage(v,{transfer:_})})}receive(a){const t=a.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(Ci(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),t=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(a,t)}processTask(a,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const u=this.resolveRejects[a];return delete this.resolveRejects[a],u?void(t.error?u.reject(Ml(t.error)):u.resolve(Ml(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=Ml(t.data),o=new AbortController;this.abortControllers[a]=o;try{const u=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(a,null,u)}catch(u){this.completeTask(a,u)}})}completeTask(a,t,n){const o=[];delete this.abortControllers[a];const u={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?ts(t):null,data:ts(n,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},P.L=Y,P.M=function(){var a=new St(16);return St!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},P.N=function(a,t,n){var o,u,g,_,v,x,M,E,z,k,B,j,Z=n[0],$=n[1],ee=n[2];return t===a?(a[12]=t[0]*Z+t[4]*$+t[8]*ee+t[12],a[13]=t[1]*Z+t[5]*$+t[9]*ee+t[13],a[14]=t[2]*Z+t[6]*$+t[10]*ee+t[14],a[15]=t[3]*Z+t[7]*$+t[11]*ee+t[15]):(u=t[1],g=t[2],_=t[3],v=t[4],x=t[5],M=t[6],E=t[7],z=t[8],k=t[9],B=t[10],j=t[11],a[0]=o=t[0],a[1]=u,a[2]=g,a[3]=_,a[4]=v,a[5]=x,a[6]=M,a[7]=E,a[8]=z,a[9]=k,a[10]=B,a[11]=j,a[12]=o*Z+v*$+z*ee+t[12],a[13]=u*Z+x*$+k*ee+t[13],a[14]=g*Z+M*$+B*ee+t[14],a[15]=_*Z+E*$+j*ee+t[15]),a},P.O=function(a,t,n){var o=n[0],u=n[1],g=n[2];return a[0]=t[0]*o,a[1]=t[1]*o,a[2]=t[2]*o,a[3]=t[3]*o,a[4]=t[4]*u,a[5]=t[5]*u,a[6]=t[6]*u,a[7]=t[7]*u,a[8]=t[8]*g,a[9]=t[9]*g,a[10]=t[10]*g,a[11]=t[11]*g,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},P.P=be,P.Q=function(a,t,n){var o=t[0],u=t[1],g=t[2],_=t[3],v=t[4],x=t[5],M=t[6],E=t[7],z=t[8],k=t[9],B=t[10],j=t[11],Z=t[12],$=t[13],ee=t[14],_e=t[15],re=n[0],ue=n[1],Me=n[2],ke=n[3];return a[0]=re*o+ue*v+Me*z+ke*Z,a[1]=re*u+ue*x+Me*k+ke*$,a[2]=re*g+ue*M+Me*B+ke*ee,a[3]=re*_+ue*E+Me*j+ke*_e,a[4]=(re=n[4])*o+(ue=n[5])*v+(Me=n[6])*z+(ke=n[7])*Z,a[5]=re*u+ue*x+Me*k+ke*$,a[6]=re*g+ue*M+Me*B+ke*ee,a[7]=re*_+ue*E+Me*j+ke*_e,a[8]=(re=n[8])*o+(ue=n[9])*v+(Me=n[10])*z+(ke=n[11])*Z,a[9]=re*u+ue*x+Me*k+ke*$,a[10]=re*g+ue*M+Me*B+ke*ee,a[11]=re*_+ue*E+Me*j+ke*_e,a[12]=(re=n[12])*o+(ue=n[13])*v+(Me=n[14])*z+(ke=n[15])*Z,a[13]=re*u+ue*x+Me*k+ke*$,a[14]=re*g+ue*M+Me*B+ke*ee,a[15]=re*_+ue*E+Me*j+ke*_e,a},P.R=ja,P.S=function(a,t){const n={};for(let o=0;o<t.length;o++){const u=t[o];u in a&&(n[u]=a[u])}return n},P.T=Sc,P.U=_o,P.V=Yt,P.W=Dh,P.X=Bu,P.Y=on,P.Z=xi,P._=d,P.a=V,P.a$=function(a,t,n){return a[0]=t[0]*n[0],a[1]=t[1]*n[1],a[2]=t[2]*n[2],a[3]=t[3]*n[3],a},P.a0=Fi,P.a1=Lf,P.a2=Ad,P.a3=pt,P.a4=function(a,t){var n,o,u,g,_;if(!a)return t??{};if(!t)return a;let v=Object.assign({},a);if(t.removeAll&&(v={removeAll:!0}),t.remove){const x=new Set(t.remove);v.add&&(v.add=v.add.filter(E=>!x.has(E.id))),v.update&&(v.update=v.update.filter(E=>!x.has(E.id)));const M=new Set(((n=a.add)!==null&&n!==void 0?n:[]).map(E=>E.id));t.remove=t.remove.filter(E=>!M.has(E))}if(t.remove){const x=new Set(v.remove?v.remove.concat(t.remove):t.remove);v.remove=Array.from(x.values())}if(t.add){const x=v.add?v.add.concat(t.add):t.add,M=new Map(x.map(E=>[E.id,E]));v.add=Array.from(M.values())}if(t.update){const x=new Map((o=v.update)===null||o===void 0?void 0:o.map(M=>[M.id,M]));for(const M of t.update){const E=(u=x.get(M.id))!==null&&u!==void 0?u:{id:M.id};M.newGeometry&&(E.newGeometry=M.newGeometry),M.addOrUpdateProperties&&(E.addOrUpdateProperties=((g=E.addOrUpdateProperties)!==null&&g!==void 0?g:[]).concat(M.addOrUpdateProperties)),M.removeProperties&&(E.removeProperties=((_=E.removeProperties)!==null&&_!==void 0?_:[]).concat(M.removeProperties)),M.removeAllProperties&&(E.removeAllProperties=!0),x.set(M.id,E)}v.update=Array.from(x.values())}return v.remove&&v.add&&(v.remove=v.remove.filter(x=>v.add.findIndex(M=>M.id===x)===-1)),v},P.a5=Ou,P.a6=Lc,P.a7=25,P.a8=Ri,P.a9=a=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const o of a){const u=window.document.createElement("source");ze(o)||(t.crossOrigin="Anonymous"),u.src=o,t.appendChild(u)}})},P.aA=da,P.aB=function(a,t,n,o){const u=t.y-a.y,g=t.x-a.x,_=o.y-n.y,v=o.x-n.x,x=_*g-v*u;if(x===0)return null;const M=(v*(a.y-n.y)-_*(a.x-n.x))/x;return new be(a.x+M*g,a.y+M*u)},P.aC=Dd,P.aD=Hd,P.aE=function(a){let t=1/0,n=1/0,o=-1/0,u=-1/0;for(const g of a)t=Math.min(t,g.x),n=Math.min(n,g.y),o=Math.max(o,g.x),u=Math.max(u,g.y);return[t,n,o,u]},P.aF=kn,P.aG=li,P.aH=function(a,t,n,o,u=!1){if(!n[0]&&!n[1])return[0,0];const g=u?o==="map"?-a.bearingInRadians:0:o==="viewport"?a.bearingInRadians:0;if(g){const _=Math.sin(g),v=Math.cos(g);n=[n[0]*v-n[1]*_,n[0]*_+n[1]*v]}return[u?n[0]:li(t,n[0],a.zoom),u?n[1]:li(t,n[1],a.zoom)]},P.aJ=zf,P.aK=kc,P.aL=Af,P.aM=qf,P.aN=gt,P.aO=Ia,P.aP=ne,P.aQ=Vt,P.aR=Fe,P.aS=sr,P.aT=Ip,P.aU=ha,P.aV=_n,P.aW=function(a){var t=new St(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},P.aX=function(a,t,n){return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],a},P.aY=function(a,t){var n=t[0],o=t[1],u=t[2],g=n*n+o*o+u*u;return g>0&&(g=1/Math.sqrt(g)),a[0]=t[0]*g,a[1]=t[1]*g,a[2]=t[2]*g,a},P.aZ=bi,P.a_=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]},P.aa=Ve,P.ab=function(){return ai++},P.ac=w,P.ad=Rc,P.ae=Oa,P.af=ks,P.ag=Pd,P.ah=function(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,u,g)=>{const _=u||g;return t[o]=!_||_.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},P.ai=wt,P.aj=85.051129,P.ak=ll,P.al=function(a){return Math.pow(2,a)},P.am=Ai,P.an=Dp,P.ao=function(a){return Math.log(a)/Math.LN2},P.ap=function(a){var t=a[0],n=a[1];return t*t+n*n},P.aq=function(a){if(!a.length)return new Set;const t=Math.max(...a.map(x=>x.canonical.z));let n=1/0,o=-1/0,u=1/0,g=-1/0;const _=[];for(const x of a){const{x:M,y:E,z}=x.canonical,k=Math.pow(2,t-z),B=M*k,j=E*k;_.push({id:x,x:B,y:j}),B<n&&(n=B),B>o&&(o=B),j<u&&(u=j),j>g&&(g=j)}const v=new Set;for(const x of _)x.x!==n&&x.x!==o&&x.y!==u&&x.y!==g||v.add(x.id);return v},P.ar=function(a,t){let n=0,o=0;if(a.kind==="constant")o=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:u,minZoom:g,maxZoom:_}=a,v=u?wt(pi.interpolationFactor(u,t,g,_),0,1):0;a.kind==="camera"?o=dr.number(a.minSize,a.maxSize,v):n=v}return{uSizeT:n,uSize:o}},P.at=function(a,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:u}){return a.kind==="source"?o/Na:a.kind==="composite"?dr.number(o/Na,u/Na,n):t},P.au=function(a,t){var n=t[0],o=t[1],u=t[2],g=t[3],_=t[4],v=t[5],x=t[6],M=t[7],E=t[8],z=t[9],k=t[10],B=t[11],j=t[12],Z=t[13],$=t[14],ee=t[15],_e=n*v-o*_,re=n*x-u*_,ue=n*M-g*_,Me=o*x-u*v,ke=o*M-g*v,Xe=u*M-g*x,at=E*Z-z*j,Qe=E*$-k*j,it=E*ee-B*j,ft=z*$-k*Z,nt=z*ee-B*Z,tt=k*ee-B*$,Ue=_e*tt-re*nt+ue*ft+Me*it-ke*Qe+Xe*at;return Ue?(a[0]=(v*tt-x*nt+M*ft)*(Ue=1/Ue),a[1]=(u*nt-o*tt-g*ft)*Ue,a[2]=(Z*Xe-$*ke+ee*Me)*Ue,a[3]=(k*ke-z*Xe-B*Me)*Ue,a[4]=(x*it-_*tt-M*Qe)*Ue,a[5]=(n*tt-u*it+g*Qe)*Ue,a[6]=($*ue-j*Xe-ee*re)*Ue,a[7]=(E*Xe-k*ue+B*re)*Ue,a[8]=(_*nt-v*it+M*at)*Ue,a[9]=(o*it-n*nt-g*at)*Ue,a[10]=(j*ke-Z*ue+ee*_e)*Ue,a[11]=(z*ue-E*ke-B*_e)*Ue,a[12]=(v*Qe-_*ft-x*at)*Ue,a[13]=(n*ft-o*Qe+u*at)*Ue,a[14]=(Z*re-j*Me-$*_e)*Ue,a[15]=(E*Me-z*re+k*_e)*Ue,a):null},P.av=ot,P.aw=function(a){var t=a[0],n=a[1];return Math.sqrt(t*t+n*n)},P.ax=function(a){return a[0]=0,a[1]=0,a},P.ay=function(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a},P.az=Td,P.b=rr,P.b$=function(a,t,n){var o=t[0],u=t[1],g=t[2];return a[0]=o*n[0]+u*n[3]+g*n[6],a[1]=o*n[1]+u*n[4]+g*n[7],a[2]=o*n[2]+u*n[5]+g*n[8],a},P.b0=Ht,P.b1=function(a,t,n){const o=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return o===0?null:(-(a[0]*n[0]+a[1]*n[1]+a[2]*n[2])-n[3])/o},P.b2=nr,P.b3=function(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a[2]=t[2]*n,a[3]=t[3]*n,a},P.b4=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]},P.b5=Cd,P.b6=ju,P.b7=function(a,t,n,o,u){var g=1/Math.tan(t/2);if(a[0]=g/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,u!=null&&u!==1/0){var _=1/(o-u);a[10]=(u+o)*_,a[14]=2*u*o*_}else a[10]=-1,a[14]=-2*o;return a},P.b8=function(a){var t=new St(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},P.b9=function(a,t,n){var o=Math.sin(n),u=Math.cos(n),g=t[0],_=t[1],v=t[2],x=t[3],M=t[4],E=t[5],z=t[6],k=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*u+M*o,a[1]=_*u+E*o,a[2]=v*u+z*o,a[3]=x*u+k*o,a[4]=M*u-g*o,a[5]=E*u-_*o,a[6]=z*u-v*o,a[7]=k*u-x*o,a},P.bA=function(a,t,n,o){var u=[],g=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],g[0]=u[0],g[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),g[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),a[0]=g[0]+n[0],a[1]=g[1]+n[1],a[2]=g[2]+n[2],a},P.bB=function(a,t,n,o){var u=[],g=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],g[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),g[1]=u[1],g[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),a[0]=g[0]+n[0],a[1]=g[1]+n[1],a[2]=g[2]+n[2],a},P.bC=function(a,t,n){var o=Math.sin(n),u=Math.cos(n),g=t[0],_=t[1],v=t[2],x=t[3],M=t[8],E=t[9],z=t[10],k=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*u-M*o,a[1]=_*u-E*o,a[2]=v*u-z*o,a[3]=x*u-k*o,a[8]=g*o+M*u,a[9]=_*o+E*u,a[10]=v*o+z*u,a[11]=x*o+k*u,a},P.bD=function(a,t){const n=me(a,360),o=me(t,360),u=o-n,g=o>n?u-360:u+360;return Math.abs(u)<Math.abs(g)?u:g},P.bE=function(a){return a[0]=0,a[1]=0,a[2]=0,a},P.bF=function(a,t,n,o){const u=Math.sqrt(a*a+t*t),g=Math.sqrt(n*n+o*o);a/=u,t/=u,n/=g,o/=g;const _=Math.acos(a*n+t*o);return-t*n+a*o>0?_:-_},P.bG=function(a,t){const n=me(a,2*Math.PI),o=me(t,2*Math.PI);return Math.min(Math.abs(n-o),Math.abs(n-o+2*Math.PI),Math.abs(n-o-2*Math.PI))},P.bH=function(){const a={},t=xe.$version;for(const n in xe.$root){const o=xe.$root[n];if(o.required){let u=null;u=n==="version"?t:o.type==="array"?[]:{},u!=null&&(a[n]=u)}}return a},P.bI=Es,P.bJ=ce,P.bK=function a(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!a(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!a(t[o],n[o]))return!1;return!0}return t===n},P.bL=function(a){a=a.slice();const t=Object.create(null);for(let n=0;n<a.length;n++)t[a[n].id]=a[n];for(let n=0;n<a.length;n++)"ref"in a[n]&&(a[n]=zi(a[n],t[a[n].ref]));return a},P.bM=function(a,t){if(a.type==="custom")return new Pp(a,t);switch(a.type){case"background":return new $p(a,t);case"circle":return new ef(a,t);case"color-relief":return new Gp(a,t);case"fill":return new _h(a,t);case"fill-extrusion":return new _f(a,t);case"heatmap":return new Vp(a,t);case"hillshade":return new rf(a,t);case"line":return new Il(a,t);case"raster":return new Qa(a,t);case"symbol":return new Md(a,t)}},P.bN=a=>a.type==="raster",P.bO=ta,P.bP=function(a,t){if(!a)return[{command:"setStyle",args:[t]}];let n=[];try{if(!vt(a.version,t.version))return[{command:"setStyle",args:[t]}];vt(a.center,t.center)||n.push({command:"setCenter",args:[t.center]}),vt(a.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),vt(a.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),vt(a.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),vt(a.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),vt(a.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),vt(a.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),vt(a.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),vt(a.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),vt(a.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),vt(a.light,t.light)||n.push({command:"setLight",args:[t.light]}),vt(a.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),vt(a.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),vt(a.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},u=[];(function(_,v,x,M){let E;for(E in v=v||{},_=_||{})Object.prototype.hasOwnProperty.call(_,E)&&(Object.prototype.hasOwnProperty.call(v,E)||Ni(E,x,M));for(E in v)Object.prototype.hasOwnProperty.call(v,E)&&(Object.prototype.hasOwnProperty.call(_,E)?vt(_[E],v[E])||(_[E].type==="geojson"&&v[E].type==="geojson"&&Yi(_,v,E)?qt(x,{command:"setGeoJSONSourceData",args:[E,v[E].data]}):Gn(E,v,x,M)):_i(E,v,x))})(a.sources,t.sources,u,o);const g=[];a.layers&&a.layers.forEach(_=>{"source"in _&&o[_.source]?n.push({command:"removeLayer",args:[_.id]}):g.push(_)}),n=n.concat(u),function(_,v,x){v=v||[];const M=(_=_||[]).map(Vi),E=v.map(Vi),z=_.reduce(vn,{}),k=v.reduce(vn,{}),B=M.slice(),j=Object.create(null);let Z,$,ee,_e,re;for(let ue=0,Me=0;ue<M.length;ue++)Z=M[ue],Object.prototype.hasOwnProperty.call(k,Z)?Me++:(qt(x,{command:"removeLayer",args:[Z]}),B.splice(B.indexOf(Z,Me),1));for(let ue=0,Me=0;ue<E.length;ue++)Z=E[E.length-1-ue],B[B.length-1-ue]!==Z&&(Object.prototype.hasOwnProperty.call(z,Z)?(qt(x,{command:"removeLayer",args:[Z]}),B.splice(B.lastIndexOf(Z,B.length-Me),1)):Me++,_e=B[B.length-ue],qt(x,{command:"addLayer",args:[k[Z],_e]}),B.splice(B.length-ue,0,Z),j[Z]=!0);for(let ue=0;ue<E.length;ue++)if(Z=E[ue],$=z[Z],ee=k[Z],!j[Z]&&!vt($,ee))if(vt($.source,ee.source)&&vt($["source-layer"],ee["source-layer"])&&vt($.type,ee.type)){for(re in yn($.layout,ee.layout,x,Z,null,"setLayoutProperty"),yn($.paint,ee.paint,x,Z,null,"setPaintProperty"),vt($.filter,ee.filter)||qt(x,{command:"setFilter",args:[Z,ee.filter]}),vt($.minzoom,ee.minzoom)&&vt($.maxzoom,ee.maxzoom)||qt(x,{command:"setLayerZoomRange",args:[Z,ee.minzoom,ee.maxzoom]}),$)Object.prototype.hasOwnProperty.call($,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?yn($[re],ee[re],x,Z,re.slice(6),"setPaintProperty"):vt($[re],ee[re])||qt(x,{command:"setLayerProperty",args:[Z,re,ee[re]]}));for(re in ee)Object.prototype.hasOwnProperty.call(ee,re)&&!Object.prototype.hasOwnProperty.call($,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?yn($[re],ee[re],x,Z,re.slice(6),"setPaintProperty"):vt($[re],ee[re])||qt(x,{command:"setLayerProperty",args:[Z,re,ee[re]]}))}else qt(x,{command:"removeLayer",args:[Z]}),_e=B[B.lastIndexOf(Z)+1],qt(x,{command:"addLayer",args:[ee,_e]})}(g,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},P.bQ=function(a){const t=[],n=a.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},P.bR=ar,P.bS=Mr,P.bT=class extends _a{constructor(a,t){super(a,t),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},P.bU=fo,P.bV=class extends _a{constructor(a,t){super(a,t),this.current=_c}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let t=1;t<16;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},P.bW=rs,P.bX=class extends _a{constructor(a,t){super(a,t),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},P.bY=class extends _a{constructor(a,t){super(a,t),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},P.bZ=gi,P.b_=function(a,t){var n=Math.sin(t),o=Math.cos(t);return a[0]=o,a[1]=n,a[2]=0,a[3]=-n,a[4]=o,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},P.ba=function(a,t,n){var o=Math.sin(n),u=Math.cos(n),g=t[4],_=t[5],v=t[6],x=t[7],M=t[8],E=t[9],z=t[10],k=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=g*u+M*o,a[5]=_*u+E*o,a[6]=v*u+z*o,a[7]=x*u+k*o,a[8]=M*u-g*o,a[9]=E*u-_*o,a[10]=z*u-v*o,a[11]=k*u-x*o,a},P.bb=function(){const a=new Float32Array(16);return Ai(a),a},P.bc=function(){const a=new Float64Array(16);return Ai(a),a},P.bd=function(){return new Float64Array(16)},P.be=function(a,t,n){const o=new Float64Array(4);return Be(o,a,t-90,n),o},P.bf=function(a,t,n,o){var u,g,_,v,x,M=t[0],E=t[1],z=t[2],k=t[3],B=n[0],j=n[1],Z=n[2],$=n[3];return(g=M*B+E*j+z*Z+k*$)<0&&(g=-g,B=-B,j=-j,Z=-Z,$=-$),1-g>Jt?(u=Math.acos(g),_=Math.sin(u),v=Math.sin((1-o)*u)/_,x=Math.sin(o*u)/_):(v=1-o,x=o),a[0]=v*M+x*B,a[1]=v*E+x*j,a[2]=v*z+x*Z,a[3]=v*k+x*$,a},P.bg=function(a){const t=new Float64Array(9);var n,o,u,g,_,v,x,M,E,z,k,B,j,Z,$,ee,_e,re;z=(u=(o=a)[0])*(x=u+u),k=(g=o[1])*x,j=(_=o[2])*x,Z=_*(M=g+g),ee=(v=o[3])*x,_e=v*M,re=v*(E=_+_),(n=t)[0]=1-(B=g*M)-($=_*E),n[3]=k-re,n[6]=j+_e,n[1]=k+re,n[4]=1-z-$,n[7]=Z-ee,n[2]=j-_e,n[5]=Z+ee,n[8]=1-z-B;const ue=sr(-Math.asin(wt(t[2],-1,1)));let Me,ke;return Math.hypot(t[5],t[8])<.001?(Me=0,ke=-sr(Math.atan2(t[3],t[4]))):(Me=sr(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),ke=sr(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:Me,pitch:ue+90,bearing:ke}},P.bh=function(a,t){return a.roll==t.roll&&a.pitch==t.pitch&&a.bearing==t.bearing},P.bi=Dt,P.bj=ya,P.bk=Fa,P.bl=Mu,P.bm=Jo,P.bn=Ze,P.bo=st,P.bp=ra,P.bq=function(a,t,n,o,u){return Ze(o,u,wt((a-t)/(n-t),0,1))},P.br=me,P.bs=function(){return new Float64Array(3)},P.bt=function(a,t,n,o){return a[0]=t[0]+n[0]*o,a[1]=t[1]+n[1]*o,a[2]=t[2]+n[2]*o,a},P.bu=Be,P.bv=function(a,t,n){var o=n[0],u=n[1],g=n[2],_=n[3],v=t[0],x=t[1],M=t[2],E=u*M-g*x,z=g*v-o*M,k=o*x-u*v;return a[0]=v+_*(E+=E)+u*(k+=k)-g*(z+=z),a[1]=x+_*z+g*E-o*k,a[2]=M+_*k+o*z-u*E,a},P.bw=function(a,t,n){const o=(u=[a[0],a[1],a[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((E=u[8])*(_=u[4])-(v=u[5])*(M=u[7]))+u[1]*(-E*(g=u[3])+v*(x=u[6]))+u[2]*(M*g-_*x);var u,g,_,v,x,M,E;if(o===0)return null;const z=bi([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),k=bi([],[n[0],n[1],n[2]],[a[0],a[1],a[2]]),B=bi([],[a[0],a[1],a[2]],[t[0],t[1],t[2]]),j=ha([],z,-a[3]);return _n(j,j,ha([],k,-t[3])),_n(j,j,ha([],B,-n[3])),ha(j,j,1/o),j},P.bx=ku,P.by=function(){return new Float64Array(4)},P.bz=function(a,t,n,o){var u=[],g=[];return u[0]=t[0]-n[0],u[1]=t[1]-n[1],u[2]=t[2]-n[2],g[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),g[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),g[2]=u[2],a[0]=g[0]+n[0],a[1]=g[1]+n[1],a[2]=g[2]+n[2],a},P.c=ge,P.c0=function(a,t,n,o,u,g,_){var v=1/(t-n),x=1/(o-u),M=1/(g-_);return a[0]=-2*v,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*x,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*M,a[11]=0,a[12]=(t+n)*v,a[13]=(u+o)*x,a[14]=(_+g)*M,a[15]=1,a},P.c1=class extends _a{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(4*a.length);for(let n=0;n<a.length;n++)t[4*n]=a[n].r,t[4*n+1]=a[n].g,t[4*n+2]=a[n].b,t[4*n+3]=a[n].a;this.gl.uniform4fv(this.location,t)}}},P.c2=class extends _a{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(a);this.gl.uniform1fv(this.location,t)}}},P.c3=class extends Ko{},P.c4=xf,P.c5=class extends Al{},P.c6=ph,P.c7=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},P.c8=mo,P.c9=function(a,t,n){var o=t[0],u=t[1],g=t[2],_=n[3]*o+n[7]*u+n[11]*g+n[15];return a[0]=(n[0]*o+n[4]*u+n[8]*g+n[12])/(_=_||1),a[1]=(n[1]*o+n[5]*u+n[9]*g+n[13])/_,a[2]=(n[2]*o+n[6]*u+n[10]*g+n[14])/_,a},P.cB=function(a){return a.message===bo},P.cC=ie,P.cD=function(a,t){V.REGISTERED_PROTOCOLS[a]=t},P.cE=function(a){delete V.REGISTERED_PROTOCOLS[a]},P.cF=function(a,t){const n={};for(let u=0;u<a.length;u++){const g=t&&t[a[u].id]||xs(a[u]);t&&(t[a[u].id]=g);let _=n[g];_||(_=n[g]=[]),_.push(a[u])}const o=[];for(const u in n)o.push(n[u]);return o},P.cG=rt,P.cH=zd,P.cI=Ih,P.cJ=Sf,P.cK=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=pt/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const t=a.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new ri(a.bucket.zoom+1),a.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new ri(a.bucket.zoom+1),a.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new ri(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:E}=a.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new ri(M),a.canonical),o["text-size"].possiblyEvaluate(new ri(E),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:E}=a.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new ri(M),a.canonical),o["icon-size"].possiblyEvaluate(new ri(E),a.canonical)]}const g=n.get("text-line-height")*kn,_=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",v=n.get("text-keep-upright"),x=n.get("text-size");for(const M of a.bucket.features){const E=n.get("text-font").evaluate(M,{},a.canonical).join(","),z=x.evaluate(M,{},a.canonical),k=u.layoutTextSize.evaluate(M,{},a.canonical),B=u.layoutIconSize.evaluate(M,{},a.canonical),j={horizontal:{},vertical:void 0},Z=M.text;let $,ee=[0,0];if(Z){const ue=Z.toString(),Me=n.get("text-letter-spacing").evaluate(M,{},a.canonical)*kn,ke=pu(ue)?Me:0,Xe=n.get("text-anchor").evaluate(M,{},a.canonical),at=Gf(t,M,a.canonical);if(!at){const nt=n.get("text-radial-offset").evaluate(M,{},a.canonical);ee=nt?Vf(Xe,[nt*kn,kd]):n.get("text-offset").evaluate(M,{},a.canonical).map(tt=>tt*kn)}let Qe=_?"center":n.get("text-justify").evaluate(M,{},a.canonical);const it=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(M,{},a.canonical)*kn:1/0,ft=()=>{a.bucket.allowVerticalPlacement&&fu(ue)&&(j.vertical=wh(Z,a.glyphMap,a.glyphPositions,a.imagePositions,E,it,g,Xe,"left",ke,ee,P.as.vertical,!0,k,z))};if(!_&&at){const nt=new Set;if(Qe==="auto")for(let Ue=0;Ue<at.values.length;Ue+=2)nt.add(kc(at.values[Ue]));else nt.add(Qe);let tt=!1;for(const Ue of nt)if(!j.horizontal[Ue])if(tt)j.horizontal[Ue]=j.horizontal[0];else{const Mt=wh(Z,a.glyphMap,a.glyphPositions,a.imagePositions,E,it,g,"center",Ue,ke,ee,P.as.horizontal,!1,k,z);Mt&&(j.horizontal[Ue]=Mt,tt=Mt.positionedLines.length===1)}ft()}else{Qe==="auto"&&(Qe=kc(Xe));const nt=wh(Z,a.glyphMap,a.glyphPositions,a.imagePositions,E,it,g,Xe,Qe,ke,ee,P.as.horizontal,!1,k,z);nt&&(j.horizontal[Qe]=nt),ft(),fu(ue)&&_&&v&&(j.vertical=wh(Z,a.glyphMap,a.glyphPositions,a.imagePositions,E,it,g,Xe,Qe,ke,ee,P.as.vertical,!1,k,z))}}let _e=!1;if(M.icon&&M.icon.name){const ue=a.imageMap[M.icon.name];ue&&($=Cf(a.imagePositions[M.icon.name],n.get("icon-offset").evaluate(M,{},a.canonical),n.get("icon-anchor").evaluate(M,{},a.canonical)),_e=!!ue.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=_e:a.bucket.sdfIcons!==_e&&ki("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ue.pixelRatio!==a.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const re=kh(j.horizontal)||j.vertical;a.bucket.iconsInText=!!re&&re.iconsInText,(re||$)&&os(a.bucket,M,j,$,a.imageMap,u,k,B,ee,_e,a.canonical,a.subdivisionGranularity)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},P.cL=gh,P.cM=ti,P.cN=Ua,P.cO=fp,P.cP=_d,P.cQ=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},P.cR=function(a,t,n,o,u){return d(this,void 0,void 0,function*(){if(xi())try{return yield Zs(a,t,n,o,u)}catch{}return function(g,_,v,x,M){const E=g.width,z=g.height;qs&&Vr||(qs=new OffscreenCanvas(E,z),Vr=qs.getContext("2d",{willReadFrequently:!0})),qs.width=E,qs.height=z,Vr.drawImage(g,0,0,E,z);const k=Vr.getImageData(_,v,x,M);return Vr.clearRect(0,0,E,z),k.data}(a,t,n,o,u)})},P.cS=an,P.cT=Ae,P.cU=xh,P.cV=Cc,P.cW=to,P.cX=function(a,t){const n=new Map;if(a!=null)if(a.type==="Feature")n.set(Fu(a,t),a);else for(const o of a.features)n.set(Fu(o,t),o);return n},P.cY=function(a,t){if(a==null)return!0;if(a.type==="Feature")return Fu(a,t)!=null;if(a.type==="FeatureCollection"){const n=new Set;for(const o of a.features){const u=Fu(o,t);if(u==null||n.has(u))return!1;n.add(u)}return!0}return!1},P.cZ=function(a,t,n){var o,u,g,_;if(t.removeAll&&a.clear(),t.remove)for(const v of t.remove)a.delete(v);if(t.add)for(const v of t.add){const x=Fu(v,n);x!=null&&a.set(x,v)}if(t.update)for(const v of t.update){let x=a.get(v.id);if(x==null)continue;const M=!v.removeAllProperties&&(((o=v.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=v.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0);if((v.newGeometry||v.removeAllProperties||M)&&(x=Object.assign({},x),a.set(v.id,x),M&&(x.properties=Object.assign({},x.properties))),v.newGeometry&&(x.geometry=v.newGeometry),v.removeAllProperties)x.properties={};else if(((g=v.removeProperties)===null||g===void 0?void 0:g.length)>0)for(const E of v.removeProperties)Object.prototype.hasOwnProperty.call(x.properties,E)&&delete x.properties[E];if(((_=v.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0)for(const{key:E,value:z}of v.addOrUpdateProperties)x.properties[E]=z}},P.c_=Lr,P.ca=class extends lo{},P.cb=class extends h{},P.cc=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]&&a[4]===t[4]&&a[5]===t[5]&&a[6]===t[6]&&a[7]===t[7]&&a[8]===t[8]&&a[9]===t[9]&&a[10]===t[10]&&a[11]===t[11]&&a[12]===t[12]&&a[13]===t[13]&&a[14]===t[14]&&a[15]===t[15]},P.cd=function(a,t){var n=a[0],o=a[1],u=a[2],g=a[3],_=a[4],v=a[5],x=a[6],M=a[7],E=a[8],z=a[9],k=a[10],B=a[11],j=a[12],Z=a[13],$=a[14],ee=a[15],_e=t[0],re=t[1],ue=t[2],Me=t[3],ke=t[4],Xe=t[5],at=t[6],Qe=t[7],it=t[8],ft=t[9],nt=t[10],tt=t[11],Ue=t[12],Mt=t[13],zt=t[14],_t=t[15];return Math.abs(n-_e)<=Jt*Math.max(1,Math.abs(n),Math.abs(_e))&&Math.abs(o-re)<=Jt*Math.max(1,Math.abs(o),Math.abs(re))&&Math.abs(u-ue)<=Jt*Math.max(1,Math.abs(u),Math.abs(ue))&&Math.abs(g-Me)<=Jt*Math.max(1,Math.abs(g),Math.abs(Me))&&Math.abs(_-ke)<=Jt*Math.max(1,Math.abs(_),Math.abs(ke))&&Math.abs(v-Xe)<=Jt*Math.max(1,Math.abs(v),Math.abs(Xe))&&Math.abs(x-at)<=Jt*Math.max(1,Math.abs(x),Math.abs(at))&&Math.abs(M-Qe)<=Jt*Math.max(1,Math.abs(M),Math.abs(Qe))&&Math.abs(E-it)<=Jt*Math.max(1,Math.abs(E),Math.abs(it))&&Math.abs(z-ft)<=Jt*Math.max(1,Math.abs(z),Math.abs(ft))&&Math.abs(k-nt)<=Jt*Math.max(1,Math.abs(k),Math.abs(nt))&&Math.abs(B-tt)<=Jt*Math.max(1,Math.abs(B),Math.abs(tt))&&Math.abs(j-Ue)<=Jt*Math.max(1,Math.abs(j),Math.abs(Ue))&&Math.abs(Z-Mt)<=Jt*Math.max(1,Math.abs(Z),Math.abs(Mt))&&Math.abs($-zt)<=Jt*Math.max(1,Math.abs($),Math.abs(zt))&&Math.abs(ee-_t)<=Jt*Math.max(1,Math.abs(ee),Math.abs(_t))},P.ce=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},P.cf=a=>a.type==="symbol",P.cg=a=>a.type==="circle",P.ch=a=>a.type==="heatmap",P.ci=a=>a.type==="line",P.cj=a=>a.type==="fill",P.ck=a=>a.type==="fill-extrusion",P.cl=a=>a.type==="hillshade",P.cm=a=>a.type==="color-relief",P.cn=a=>a.type==="background",P.co=a=>a.type==="custom",P.cp=ct,P.cq=function(a,t,n){const o=Tt(t.x-n.x,t.y-n.y),u=Tt(a.x-n.x,a.y-n.y);var g,_;return sr(Math.atan2(o[0]*u[1]-o[1]*u[0],(g=o)[0]*(_=u)[0]+g[1]*_[1]))},P.cr=Pt,P.cs=function(a,t){return Hs[t]&&(a instanceof MouseEvent||a instanceof WheelEvent)},P.ct=function(a,t){return cl[t]&&"touches"in a},P.cu=function(a){return cl[a]||Hs[a]},P.cv=function(a,t,n){var o=t[0],u=t[1];return a[0]=n[0]*o+n[4]*u+n[12],a[1]=n[1]*o+n[5]*u+n[13],a},P.cw=function(a,t){const{x:n,y:o}=Ou.fromLngLat(t);return!(a<0||a>25||o<0||o>=1||n<0||n>=1)},P.cx=function(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},P.cy=class extends Yo{},P.cz=jh,P.d=ze,P.e=fi,P.f=a=>d(void 0,void 0,void 0,function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),P.g=N,P.h=a=>new Promise((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=Gs})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(a)],{type:"image/png"});o.src=a.byteLength?URL.createObjectURL(u):Gs}),P.i=Ci,P.j=(a,t)=>pe(fi(a,{type:"json"}),t),P.k=je,P.l=He,P.m=pe,P.n=(a,t)=>pe(fi(a,{type:"arrayBuffer"}),t),P.o=function(a){return new _d(a).readFields(Tf,[])},P.p=xp,P.q=Tc,P.r=Oi,P.s=pn,P.t=xe,P.u=jt,P.v=Vo,P.w=ki,P.x=mu,P.y=id,P.z=hu}),J("worker",["./shared"],function(P){class d{constructor(V,N){this.keyCache={},V&&this.replace(V,N)}replace(V,N){this._layerConfigs={},this._layers={},this.update(V,[],N)}update(V,N,Y){for(const ce of V){this._layerConfigs[ce.id]=ce;const pe=this._layers[ce.id]=P.bM(ce,Y);pe._featureFilter=P.ae(pe.filter,Y),this.keyCache[ce.id]&&delete this.keyCache[ce.id]}for(const ce of N)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};const ie=P.cF(Object.values(this._layerConfigs),this.keyCache);for(const ce of ie){const pe=ce.map(dt=>this._layers[dt.id]),ze=pe[0];if(ze.visibility==="none")continue;const ye=ze.source||"";let De=this.familiesBySource[ye];De||(De=this.familiesBySource[ye]={});const He=ze.sourceLayer||"_geojsonTileLayer";let je=De[He];je||(je=De[He]=[]),je.push(pe)}}}class be{constructor(V){const N={},Y=[];for(const ze in V){const ye=V[ze],De=N[ze]={};for(const He in ye){const je=ye[+He];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const dt={x:0,y:0,w:je.bitmap.width+2,h:je.bitmap.height+2};Y.push(dt),De[He]={rect:dt,metrics:je.metrics}}}const{w:ie,h:ce}=P.p(Y),pe=new P.q({width:ie||1,height:ce||1});for(const ze in V){const ye=V[ze];for(const De in ye){const He=ye[+De];if(!He||He.bitmap.width===0||He.bitmap.height===0)continue;const je=N[ze][De].rect;P.q.copy(He.bitmap,pe,{x:0,y:0},{x:je.x+1,y:je.y+1},He.bitmap)}}this.image=pe,this.positions=N}}P.cG("GlyphAtlas",be);class Ae{constructor(V){this.tileID=new P.a0(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[]}parse(V,N,Y,ie,ce){return P._(this,void 0,void 0,function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new P.ac;const pe=new P.cH(Object.keys(V.layers).sort()),ze=new P.cI(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const ye={},De={featureIndex:ze,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:Y,subdivisionGranularity:ce},He=N.familiesBySource[this.source];for(const Ve in He){const cn=V.layers[Ve];if(!cn)continue;cn.version===1&&P.w(`Vector tile source "${this.source}" layer "${Ve}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fa=pe.encode(Ve),qa=[];for(let ci=0;ci<cn.length;ci++){const $e=cn.feature(ci),It=ze.getId($e,Ve);qa.push({feature:$e,id:It,index:ci,sourceLayerIndex:fa})}for(const ci of He[Ve]){const $e=ci[0];$e.source!==this.source&&P.w(`layer.source = ${$e.source} does not equal this.source = ${this.source}`),$e.isHidden(this.zoom,!0)||(Je(ci,this.zoom,Y),(ye[$e.id]=$e.createBucket({index:ze.bucketLayerIDs.length,layers:ci,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fa,sourceID:this.source})).populate(qa,De,this.tileID.canonical),ze.bucketLayerIDs.push(ci.map(It=>It.id)))}}const je=P.bR(De.glyphDependencies,Ve=>Object.keys(Ve).map(Number));this.inFlightDependencies.forEach(Ve=>Ve?.abort()),this.inFlightDependencies=[];let dt=Promise.resolve({});if(Object.keys(je).length){const Ve=new AbortController;this.inFlightDependencies.push(Ve),dt=ie.sendAsync({type:"GG",data:{stacks:je,source:this.source,tileID:this.tileID,type:"glyphs"}},Ve)}const xe=Object.keys(De.iconDependencies);let Gt=Promise.resolve({});if(xe.length){const Ve=new AbortController;this.inFlightDependencies.push(Ve),Gt=ie.sendAsync({type:"GI",data:{icons:xe,source:this.source,tileID:this.tileID,type:"icons"}},Ve)}const zi=Object.keys(De.patternDependencies);let vt=Promise.resolve({});if(zi.length){const Ve=new AbortController;this.inFlightDependencies.push(Ve),vt=ie.sendAsync({type:"GI",data:{icons:zi,source:this.source,tileID:this.tileID,type:"patterns"}},Ve)}const qt=De.dashDependencies;let _i=Promise.resolve({});if(Object.keys(qt).length){const Ve=new AbortController;this.inFlightDependencies.push(Ve),_i=ie.sendAsync({type:"GDA",data:{dashes:qt}},Ve)}const[Ni,Gn,Yi,yn]=yield Promise.all([dt,Gt,vt,_i]),Vi=new be(Ni),vn=new P.cJ(Gn,Yi);for(const Ve in ye){const cn=ye[Ve];cn instanceof P.ad?(Je(cn.layers,this.zoom,Y),P.cK({bucket:cn,glyphMap:Ni,glyphPositions:Vi.positions,imageMap:Gn,imagePositions:vn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:De.subdivisionGranularity})):cn.hasDependencies&&(cn instanceof P.cL||cn instanceof P.cM||cn instanceof P.cN)&&(Je(cn.layers,this.zoom,Y),cn.addFeatures(De,this.tileID.canonical,vn.patternPositions,yn))}return this.status="done",{buckets:Object.values(ye).filter(Ve=>!Ve.isEmpty()),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Vi.image,imageAtlas:vn,dashPositions:yn,glyphMap:this.returnDependencies?Ni:null,iconMap:this.returnDependencies?Gn:null,glyphPositions:this.returnDependencies?Vi.positions:null}})}}function Je(ge,V,N){const Y=new P.G(V);for(const ie of ge)ie.recalculate(Y,N)}class Ne{constructor(V,N,Y){this.actor=V,this.layerIndex=N,this.availableImages=Y,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,N){return P._(this,void 0,void 0,function*(){const Y=yield P.n(V.request,N);try{return{vectorTile:new P.cO(new P.cP(Y.data)),rawData:Y.data,cacheControl:Y.cacheControl,expires:Y.expires}}catch(ie){const ce=new Uint8Array(Y.data);let pe=`Unable to parse the tile at ${V.request.url}, `;throw pe+=ce[0]===31&&ce[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ie.message}`,new Error(pe)}})}loadTile(V){return P._(this,void 0,void 0,function*(){const N=V.uid,Y=!!(V&&V.request&&V.request.collectResourceTiming)&&new P.cQ(V.request),ie=new Ae(V);this.loading[N]=ie;const ce=new AbortController;ie.abort=ce;try{const pe=yield this.loadVectorTile(V,ce);if(delete this.loading[N],!pe)return null;const ze=pe.rawData,ye={};pe.expires&&(ye.expires=pe.expires),pe.cacheControl&&(ye.cacheControl=pe.cacheControl);const De={};if(Y){const je=Y.finish();je&&(De.resourceTiming=JSON.parse(JSON.stringify(je)))}ie.vectorTile=pe.vectorTile;const He=ie.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);this.loaded[N]=ie,this.fetching[N]={rawTileData:ze,cacheControl:ye,resourceTiming:De};try{const je=yield He;return P.e({rawTileData:ze.slice(0)},je,ye,De)}finally{delete this.fetching[N]}}catch(pe){throw delete this.loading[N],ie.status="done",this.loaded[N]=ie,pe}})}reloadTile(V){return P._(this,void 0,void 0,function*(){const N=V.uid;if(!this.loaded||!this.loaded[N])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Y=this.loaded[N];if(Y.showCollisionBoxes=V.showCollisionBoxes,Y.status==="parsing"){const ie=yield Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);let ce;if(this.fetching[N]){const{rawTileData:pe,cacheControl:ze,resourceTiming:ye}=this.fetching[N];delete this.fetching[N],ce=P.e({rawTileData:pe.slice(0)},ie,ze,ye)}else ce=ie;return ce}if(Y.status==="done"&&Y.vectorTile)return Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity)})}abortTile(V){return P._(this,void 0,void 0,function*(){const N=this.loading,Y=V.uid;N&&N[Y]&&N[Y].abort&&(N[Y].abort.abort(),delete N[Y])})}removeTile(V){return P._(this,void 0,void 0,function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]})}}class et{constructor(){this.loaded={}}loadTile(V){return P._(this,void 0,void 0,function*(){const{uid:N,encoding:Y,rawImageData:ie,redFactor:ce,greenFactor:pe,blueFactor:ze,baseShift:ye}=V,De=ie.width+2,He=ie.height+2,je=P.b(ie)?new P.R({width:De,height:He},yield P.cR(ie,-1,-1,De,He)):ie,dt=new P.cS(N,je,Y,ce,pe,ze,ye);return this.loaded=this.loaded||{},this.loaded[N]=dt,dt})}removeTile(V){const N=this.loaded,Y=V.uid;N&&N[Y]&&delete N[Y]}}var Ct,mt,we=function(){if(mt)return Ct;function ge(N,Y){if(N.length!==0){V(N[0],Y);for(var ie=1;ie<N.length;ie++)V(N[ie],!Y)}}function V(N,Y){for(var ie=0,ce=0,pe=0,ze=N.length,ye=ze-1;pe<ze;ye=pe++){var De=(N[pe][0]-N[ye][0])*(N[ye][1]+N[pe][1]),He=ie+De;ce+=Math.abs(ie)>=Math.abs(De)?ie-He+De:De-He+ie,ie=He}ie+ce>=0!=!!Y&&N.reverse()}return mt=1,Ct=function N(Y,ie){var ce,pe=Y&&Y.type;if(pe==="FeatureCollection")for(ce=0;ce<Y.features.length;ce++)N(Y.features[ce],ie);else if(pe==="GeometryCollection")for(ce=0;ce<Y.geometries.length;ce++)N(Y.geometries[ce],ie);else if(pe==="Feature")N(Y.geometry,ie);else if(pe==="Polygon")ge(Y.coordinates,ie);else if(pe==="MultiPolygon")for(ce=0;ce<Y.coordinates.length;ce++)ge(Y.coordinates[ce],ie);return Y}}(),on=P.cT(we);class xi extends P.cV{constructor(V,N){super(new P.cP,0,N,[],[]),this.feature=V,this.type=V.type,this.properties=V.tags?V.tags:{},"id"in V&&(typeof V.id=="string"?this.id=parseInt(V.id,10):typeof V.id!="number"||isNaN(V.id)||(this.id=V.id))}loadGeometry(){const V=[],N=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const Y of N){const ie=[];for(const ce of Y)ie.push(new P.P(ce[0],ce[1]));V.push(ie)}return V}}class Jt extends P.cU{constructor(V,N){super(new P.cP),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=N?N.version:1,this.extent=N?N.extent:4096,this.length=V.length,this.features=V}feature(V){return new xi(this.features[V],this.extent)}}function St(ge,V){V.writeVarintField(15,ge.version||1),V.writeStringField(1,ge.name||""),V.writeVarintField(5,ge.extent||4096);const N={keys:[],values:[],keycache:{},valuecache:{}};for(let ce=0;ce<ge.length;ce++)N.feature=ge.feature(ce),V.writeMessage(2,gi,N);const Y=N.keys;for(const ce of Y)V.writeStringField(3,ce);const ie=N.values;for(const ce of ie)V.writeMessage(4,_n,ce)}function gi(ge,V){if(!ge.feature)return;const N=ge.feature;N.id!==void 0&&V.writeVarintField(1,N.id),V.writeMessage(2,Ai,ge),V.writeVarintField(3,N.type),V.writeMessage(4,ln,N)}function Ai(ge,V){for(const N in ge.feature?.properties){let Y=ge.feature.properties[N],ie=ge.keycache[N];if(Y===null)continue;ie===void 0&&(ge.keys.push(N),ie=ge.keys.length-1,ge.keycache[N]=ie),V.writeVarint(ie),typeof Y!="string"&&typeof Y!="boolean"&&typeof Y!="number"&&(Y=JSON.stringify(Y));const ce=typeof Y+":"+Y;let pe=ge.valuecache[ce];pe===void 0&&(ge.values.push(Y),pe=ge.values.length-1,ge.valuecache[ce]=pe),V.writeVarint(pe)}}function hi(ge,V){return(V<<3)+(7&ge)}function Ht(ge){return ge<<1^ge>>31}function ln(ge,V){const N=ge.loadGeometry(),Y=ge.type;let ie=0,ce=0;for(const pe of N){let ze=1;Y===1&&(ze=pe.length),V.writeVarint(hi(1,ze));const ye=Y===3?pe.length-1:pe.length;for(let De=0;De<ye;De++){De===1&&Y!==1&&V.writeVarint(hi(2,ye-1));const He=pe[De].x-ie,je=pe[De].y-ce;V.writeVarint(Ht(He)),V.writeVarint(Ht(je)),ie+=He,ce+=je}ge.type===3&&V.writeVarint(hi(7,1))}}function _n(ge,V){const N=typeof ge;N==="string"?V.writeStringField(1,ge):N==="boolean"?V.writeBooleanField(7,ge):N==="number"&&(ge%1!=0?V.writeDoubleField(3,ge):ge<0?V.writeSVarintField(6,ge):V.writeVarintField(5,ge))}const ha={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ge=>ge},bi=Math.fround||(wi=new Float32Array(1),ge=>(wi[0]=+ge,wi[0]));var wi;class nr{constructor(V){this.options=Object.assign(Object.create(ha),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:N,minZoom:Y,maxZoom:ie}=this.options;N&&console.time("total time");const ce=`prepare ${V.length} points`;N&&console.time(ce),this.points=V;const pe=[];for(let ye=0;ye<V.length;ye++){const De=V[ye];if(!De.geometry)continue;const[He,je]=De.geometry.coordinates,dt=bi(Be(He)),xe=bi(ot(je));pe.push(dt,xe,1/0,ye,-1,1),this.options.reduce&&pe.push(0)}let ze=this.trees[ie+1]=this._createTree(pe);N&&console.timeEnd(ce);for(let ye=ie;ye>=Y;ye--){const De=+Date.now();ze=this.trees[ye]=this._createTree(this._cluster(ze,ye)),N&&console.log("z%d: %d clusters in %dms",ye,ze.numItems,+Date.now()-De)}return N&&console.timeEnd("total time"),this}getClusters(V,N){let Y=((V[0]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,V[1]));let ce=V[2]===180?180:((V[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)Y=-180,ce=180;else if(Y>ce){const je=this.getClusters([Y,ie,180,pe],N),dt=this.getClusters([-180,ie,ce,pe],N);return je.concat(dt)}const ze=this.trees[this._limitZoom(N)],ye=ze.range(Be(Y),ot(pe),Be(ce),ot(ie)),De=ze.data,He=[];for(const je of ye){const dt=this.stride*je;He.push(De[dt+5]>1?da(De,dt,this.clusterProps):this.points[De[dt+3]])}return He}getChildren(V){const N=this._getOriginId(V),Y=this._getOriginZoom(V),ie="No cluster with the specified id.",ce=this.trees[Y];if(!ce)throw new Error(ie);const pe=ce.data;if(N*this.stride>=pe.length)throw new Error(ie);const ze=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),ye=ce.within(pe[N*this.stride],pe[N*this.stride+1],ze),De=[];for(const He of ye){const je=He*this.stride;pe[je+4]===V&&De.push(pe[je+5]>1?da(pe,je,this.clusterProps):this.points[pe[je+3]])}if(De.length===0)throw new Error(ie);return De}getLeaves(V,N,Y){const ie=[];return this._appendLeaves(ie,V,N=N||10,Y=Y||0,0),ie}getTile(V,N,Y){const ie=this.trees[this._limitZoom(V)],ce=Math.pow(2,V),{extent:pe,radius:ze}=this.options,ye=ze/pe,De=(Y-ye)/ce,He=(Y+1+ye)/ce,je={features:[]};return this._addTileFeatures(ie.range((N-ye)/ce,De,(N+1+ye)/ce,He),ie.data,N,Y,ce,je),N===0&&this._addTileFeatures(ie.range(1-ye/ce,De,1,He),ie.data,ce,Y,ce,je),N===ce-1&&this._addTileFeatures(ie.range(0,De,ye/ce,He),ie.data,-1,Y,ce,je),je.features.length?je:null}getClusterExpansionZoom(V){let N=this._getOriginZoom(V)-1;for(;N<=this.options.maxZoom;){const Y=this.getChildren(V);if(N++,Y.length!==1)break;V=Y[0].properties.cluster_id}return N}_appendLeaves(V,N,Y,ie,ce){const pe=this.getChildren(N);for(const ze of pe){const ye=ze.properties;if(ye&&ye.cluster?ce+ye.point_count<=ie?ce+=ye.point_count:ce=this._appendLeaves(V,ye.cluster_id,Y,ie,ce):ce<ie?ce++:V.push(ze),V.length===Y)break}return ce}_createTree(V){const N=new P.aM(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Y=0;Y<V.length;Y+=this.stride)N.add(V[Y],V[Y+1]);return N.finish(),N.data=V,N}_addTileFeatures(V,N,Y,ie,ce,pe){for(const ze of V){const ye=ze*this.stride,De=N[ye+5]>1;let He,je,dt;if(De)He=Vn(N,ye,this.clusterProps),je=N[ye],dt=N[ye+1];else{const zi=this.points[N[ye+3]];He=zi.properties;const[vt,qt]=zi.geometry.coordinates;je=Be(vt),dt=ot(qt)}const xe={type:1,geometry:[[Math.round(this.options.extent*(je*ce-Y)),Math.round(this.options.extent*(dt*ce-ie))]],tags:He};let Gt;Gt=De||this.options.generateId?N[ye+3]:this.points[N[ye+3]].id,Gt!==void 0&&(xe.id=Gt),pe.features.push(xe)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,N){const{radius:Y,extent:ie,reduce:ce,minPoints:pe}=this.options,ze=Y/(ie*Math.pow(2,N)),ye=V.data,De=[],He=this.stride;for(let je=0;je<ye.length;je+=He){if(ye[je+2]<=N)continue;ye[je+2]=N;const dt=ye[je],xe=ye[je+1],Gt=V.within(ye[je],ye[je+1],ze),zi=ye[je+5];let vt=zi;for(const qt of Gt){const _i=qt*He;ye[_i+2]>N&&(vt+=ye[_i+5])}if(vt>zi&&vt>=pe){let qt,_i=dt*zi,Ni=xe*zi,Gn=-1;const Yi=(je/He<<5)+(N+1)+this.points.length;for(const yn of Gt){const Vi=yn*He;if(ye[Vi+2]<=N)continue;ye[Vi+2]=N;const vn=ye[Vi+5];_i+=ye[Vi]*vn,Ni+=ye[Vi+1]*vn,ye[Vi+4]=Yi,ce&&(qt||(qt=this._map(ye,je,!0),Gn=this.clusterProps.length,this.clusterProps.push(qt)),ce(qt,this._map(ye,Vi)))}ye[je+4]=Yi,De.push(_i/vt,Ni/vt,1/0,Yi,-1,vt),ce&&De.push(Gn)}else{for(let qt=0;qt<He;qt++)De.push(ye[je+qt]);if(vt>1)for(const qt of Gt){const _i=qt*He;if(!(ye[_i+2]<=N)){ye[_i+2]=N;for(let Ni=0;Ni<He;Ni++)De.push(ye[_i+Ni])}}}}return De}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,N,Y){if(V[N+5]>1){const pe=this.clusterProps[V[N+6]];return Y?Object.assign({},pe):pe}const ie=this.points[V[N+3]].properties,ce=this.options.map(ie);return Y&&ce===ie?Object.assign({},ce):ce}}function da(ge,V,N){return{type:"Feature",id:ge[V+3],properties:Vn(ge,V,N),geometry:{type:"Point",coordinates:[(Y=ge[V],360*(Y-.5)),Tt(ge[V+1])]}};var Y}function Vn(ge,V,N){const Y=ge[V+5],ie=Y>=1e4?`${Math.round(Y/1e3)}k`:Y>=1e3?Math.round(Y/100)/10+"k":Y,ce=ge[V+6],pe=ce===-1?{}:Object.assign({},N[ce]);return Object.assign(pe,{cluster:!0,cluster_id:ge[V+3],point_count:Y,point_count_abbreviated:ie})}function Be(ge){return ge/360+.5}function ot(ge){const V=Math.sin(ge*Math.PI/180),N=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return N<0?0:N>1?1:N}function Tt(ge){const V=(180-360*ge)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function pt(ge,V,N,Y){let ie=Y;const ce=V+(N-V>>1);let pe,ze=N-V;const ye=ge[V],De=ge[V+1],He=ge[N],je=ge[N+1];for(let dt=V+3;dt<N;dt+=3){const xe=li(ge[dt],ge[dt+1],ye,De,He,je);if(xe>ie)pe=dt,ie=xe;else if(xe===ie){const Gt=Math.abs(dt-ce);Gt<ze&&(pe=dt,ze=Gt)}}ie>Y&&(pe-V>3&&pt(ge,V,pe,Y),ge[pe+2]=ie,N-pe>3&&pt(ge,pe,N,Y))}function li(ge,V,N,Y,ie,ce){let pe=ie-N,ze=ce-Y;if(pe!==0||ze!==0){const ye=((ge-N)*pe+(V-Y)*ze)/(pe*pe+ze*ze);ye>1?(N=ie,Y=ce):ye>0&&(N+=pe*ye,Y+=ze*ye)}return pe=ge-N,ze=V-Y,pe*pe+ze*ze}function me(ge,V,N,Y){const ie={id:ge??null,type:V,geometry:N,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")Ze(ie,N);else if(V==="Polygon")Ze(ie,N[0]);else if(V==="MultiLineString")for(const ce of N)Ze(ie,ce);else if(V==="MultiPolygon")for(const ce of N)Ze(ie,ce[0]);return ie}function Ze(ge,V){for(let N=0;N<V.length;N+=3)ge.minX=Math.min(ge.minX,V[N]),ge.minY=Math.min(ge.minY,V[N+1]),ge.maxX=Math.max(ge.maxX,V[N]),ge.maxY=Math.max(ge.maxY,V[N+1])}function st(ge,V,N,Y){if(!V.geometry)return;const ie=V.geometry.coordinates;if(ie&&ie.length===0)return;const ce=V.geometry.type,pe=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2);let ze=[],ye=V.id;if(N.promoteId?ye=V.properties[N.promoteId]:N.generateId&&(ye=Y||0),ce==="Point")ct(ie,ze);else if(ce==="MultiPoint")for(const De of ie)ct(De,ze);else if(ce==="LineString")Pt(ie,ze,pe,!1);else if(ce==="MultiLineString"){if(N.lineMetrics){for(const De of ie)ze=[],Pt(De,ze,pe,!1),ge.push(me(ye,"LineString",ze,V.properties));return}wt(ie,ze,pe,!1)}else if(ce==="Polygon")wt(ie,ze,pe,!0);else{if(ce!=="MultiPolygon"){if(ce==="GeometryCollection"){for(const De of V.geometry.geometries)st(ge,{id:ye,geometry:De,properties:V.properties},N,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const De of ie){const He=[];wt(De,He,pe,!0),ze.push(He)}}ge.push(me(ye,ce,ze,V.properties))}function ct(ge,V){V.push(Yt(ge[0]),fi(ge[1]),0)}function Pt(ge,V,N,Y){let ie,ce,pe=0;for(let ye=0;ye<ge.length;ye++){const De=Yt(ge[ye][0]),He=fi(ge[ye][1]);V.push(De,He,0),ye>0&&(pe+=Y?(ie*He-De*ce)/2:Math.sqrt(Math.pow(De-ie,2)+Math.pow(He-ce,2))),ie=De,ce=He}const ze=V.length-3;V[2]=1,pt(V,0,ze,N),V[ze+2]=1,V.size=Math.abs(pe),V.start=0,V.end=V.size}function wt(ge,V,N,Y){for(let ie=0;ie<ge.length;ie++){const ce=[];Pt(ge[ie],ce,N,Y),V.push(ce)}}function Yt(ge){return ge/360+.5}function fi(ge){const V=Math.sin(ge*Math.PI/180),N=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return N<0?0:N>1?1:N}function ai(ge,V,N,Y,ie,ce,pe,ze){if(Y/=V,ce>=(N/=V)&&pe<Y)return ge;if(pe<N||ce>=Y)return null;const ye=[];for(const De of ge){const He=De.geometry;let je=De.type;const dt=ie===0?De.minX:De.minY,xe=ie===0?De.maxX:De.maxY;if(dt>=N&&xe<Y){ye.push(De);continue}if(xe<N||dt>=Y)continue;let Gt=[];if(je==="Point"||je==="MultiPoint")ar(He,Gt,N,Y,ie);else if(je==="LineString")Mr(He,Gt,N,Y,ie,!1,ze.lineMetrics);else if(je==="MultiLineString")Er(He,Gt,N,Y,ie,!1);else if(je==="Polygon")Er(He,Gt,N,Y,ie,!0);else if(je==="MultiPolygon")for(const zi of He){const vt=[];Er(zi,vt,N,Y,ie,!0),vt.length&&Gt.push(vt)}if(Gt.length){if(ze.lineMetrics&&je==="LineString"){for(const zi of Gt)ye.push(me(De.id,je,zi,De.tags));continue}je!=="LineString"&&je!=="MultiLineString"||(Gt.length===1?(je="LineString",Gt=Gt[0]):je="MultiLineString"),je!=="Point"&&je!=="MultiPoint"||(je=Gt.length===3?"Point":"MultiPoint"),ye.push(me(De.id,je,Gt,De.tags))}}return ye.length?ye:null}function ar(ge,V,N,Y,ie){for(let ce=0;ce<ge.length;ce+=3){const pe=ge[ce+ie];pe>=N&&pe<=Y&&ki(V,ge[ce],ge[ce+1],ge[ce+2])}}function Mr(ge,V,N,Y,ie,ce,pe){let ze=ta(ge);const ye=ie===0?Za:Ci;let De,He,je=ge.start;for(let vt=0;vt<ge.length-3;vt+=3){const qt=ge[vt],_i=ge[vt+1],Ni=ge[vt+2],Gn=ge[vt+3],Yi=ge[vt+4],yn=ie===0?qt:_i,Vi=ie===0?Gn:Yi;let vn=!1;pe&&(De=Math.sqrt(Math.pow(qt-Gn,2)+Math.pow(_i-Yi,2))),yn<N?Vi>N&&(He=ye(ze,qt,_i,Gn,Yi,N),pe&&(ze.start=je+De*He)):yn>Y?Vi<Y&&(He=ye(ze,qt,_i,Gn,Yi,Y),pe&&(ze.start=je+De*He)):ki(ze,qt,_i,Ni),Vi<N&&yn>=N&&(He=ye(ze,qt,_i,Gn,Yi,N),vn=!0),Vi>Y&&yn<=Y&&(He=ye(ze,qt,_i,Gn,Yi,Y),vn=!0),!ce&&vn&&(pe&&(ze.end=je+De*He),V.push(ze),ze=ta(ge)),pe&&(je+=De)}let dt=ge.length-3;const xe=ge[dt],Gt=ge[dt+1],zi=ie===0?xe:Gt;zi>=N&&zi<=Y&&ki(ze,xe,Gt,ge[dt+2]),dt=ze.length-3,ce&&dt>=3&&(ze[dt]!==ze[0]||ze[dt+1]!==ze[1])&&ki(ze,ze[0],ze[1],ze[2]),ze.length&&V.push(ze)}function ta(ge){const V=[];return V.size=ge.size,V.start=ge.start,V.end=ge.end,V}function Er(ge,V,N,Y,ie,ce){for(const pe of ge)Mr(pe,V,N,Y,ie,ce,!1)}function ki(ge,V,N,Y){ge.push(V,N,Y)}function Za(ge,V,N,Y,ie,ce){const pe=(ce-V)/(Y-V);return ki(ge,ce,N+(ie-N)*pe,1),pe}function Ci(ge,V,N,Y,ie,ce){const pe=(ce-N)/(ie-N);return ki(ge,V+(Y-V)*pe,ce,1),pe}function xo(ge,V){const N=[];for(let Y=0;Y<ge.length;Y++){const ie=ge[Y],ce=ie.type;let pe;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")pe=Vs(ie.geometry,V);else if(ce==="MultiLineString"||ce==="Polygon"){pe=[];for(const ze of ie.geometry)pe.push(Vs(ze,V))}else if(ce==="MultiPolygon"){pe=[];for(const ze of ie.geometry){const ye=[];for(const De of ze)ye.push(Vs(De,V));pe.push(ye)}}N.push(me(ie.id,ce,pe,ie.tags))}return N}function Vs(ge,V){const N=[];N.size=ge.size,ge.start!==void 0&&(N.start=ge.start,N.end=ge.end);for(let Y=0;Y<ge.length;Y+=3)N.push(ge[Y]+V,ge[Y+1],ge[Y+2]);return N}function rr(ge,V){if(ge.transformed)return ge;const N=1<<ge.z,Y=ge.x,ie=ge.y;for(const ce of ge.features){const pe=ce.geometry,ze=ce.type;if(ce.geometry=[],ze===1)for(let ye=0;ye<pe.length;ye+=2)ce.geometry.push(Gs(pe[ye],pe[ye+1],V,N,Y,ie));else for(let ye=0;ye<pe.length;ye++){const De=[];for(let He=0;He<pe[ye].length;He+=2)De.push(Gs(pe[ye][He],pe[ye][He+1],V,N,Y,ie));ce.geometry.push(De)}}return ge.transformed=!0,ge}function Gs(ge,V,N,Y,ie,ce){return[Math.round(N*(ge*Y-ie)),Math.round(N*(V*Y-ce))]}function Zs(ge,V,N,Y,ie){const ce=V===ie.maxZoom?0:ie.tolerance/((1<<V)*ie.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:ge.length,source:null,x:N,y:Y,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ze of ge)qs(pe,ze,ce,ie);return pe}function qs(ge,V,N,Y){const ie=V.geometry,ce=V.type,pe=[];if(ge.minX=Math.min(ge.minX,V.minX),ge.minY=Math.min(ge.minY,V.minY),ge.maxX=Math.max(ge.maxX,V.maxX),ge.maxY=Math.max(ge.maxY,V.maxY),ce==="Point"||ce==="MultiPoint")for(let ze=0;ze<ie.length;ze+=3)pe.push(ie[ze],ie[ze+1]),ge.numPoints++,ge.numSimplified++;else if(ce==="LineString")Vr(pe,ie,ge,N,!1,!1);else if(ce==="MultiLineString"||ce==="Polygon")for(let ze=0;ze<ie.length;ze++)Vr(pe,ie[ze],ge,N,ce==="Polygon",ze===0);else if(ce==="MultiPolygon")for(let ze=0;ze<ie.length;ze++){const ye=ie[ze];for(let De=0;De<ye.length;De++)Vr(pe,ye[De],ge,N,!0,De===0)}if(pe.length){let ze=V.tags||null;if(ce==="LineString"&&Y.lineMetrics){ze={};for(const De in V.tags)ze[De]=V.tags[De];ze.mapbox_clip_start=ie.start/ie.size,ze.mapbox_clip_end=ie.end/ie.size}const ye={geometry:pe,type:ce==="Polygon"||ce==="MultiPolygon"?3:ce==="LineString"||ce==="MultiLineString"?2:1,tags:ze};V.id!==null&&(ye.id=V.id),ge.features.push(ye)}}function Vr(ge,V,N,Y,ie,ce){const pe=Y*Y;if(Y>0&&V.size<(ie?pe:Y))return void(N.numPoints+=V.length/3);const ze=[];for(let ye=0;ye<V.length;ye+=3)(Y===0||V[ye+2]>pe)&&(N.numSimplified++,ze.push(V[ye],V[ye+1])),N.numPoints++;ie&&function(ye,De){let He=0;for(let je=0,dt=ye.length,xe=dt-2;je<dt;xe=je,je+=2)He+=(ye[je]-ye[xe])*(ye[je+1]+ye[xe+1]);if(He>0===De)for(let je=0,dt=ye.length;je<dt/2;je+=2){const xe=ye[je],Gt=ye[je+1];ye[je]=ye[dt-2-je],ye[je+1]=ye[dt-1-je],ye[dt-2-je]=xe,ye[dt-1-je]=Gt}}(ze,ce),ge.push(ze)}const pn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ll{constructor(V,N){const Y=(N=this.options=function(ce,pe){for(const ze in pe)ce[ze]=pe[ze];return ce}(Object.create(pn),N)).debug;if(Y&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");let ie=function(ce,pe){const ze=[];if(ce.type==="FeatureCollection")for(let ye=0;ye<ce.features.length;ye++)st(ze,ce.features[ye],pe,ye);else st(ze,ce.type==="Feature"?ce:{geometry:ce},pe);return ze}(V,N);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ie=function(ce,pe){const ze=pe.buffer/pe.extent;let ye=ce;const De=ai(ce,1,-1-ze,ze,0,-1,2,pe),He=ai(ce,1,1-ze,2+ze,0,-1,2,pe);return(De||He)&&(ye=ai(ce,1,-ze,1+ze,0,-1,2,pe)||[],De&&(ye=xo(De,1).concat(ye)),He&&(ye=ye.concat(xo(He,-1)))),ye}(ie,N),ie.length&&this.splitTile(ie,0,0,0),Y&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,N,Y,ie,ce,pe,ze){const ye=[V,N,Y,ie],De=this.options,He=De.debug;for(;ye.length;){ie=ye.pop(),Y=ye.pop(),N=ye.pop(),V=ye.pop();const je=1<<N,dt=sr(N,Y,ie);let xe=this.tiles[dt];if(!xe&&(He>1&&console.time("creation"),xe=this.tiles[dt]=Zs(V,N,Y,ie,De),this.tileCoords.push({z:N,x:Y,y:ie}),He)){He>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,Y,ie,xe.numFeatures,xe.numPoints,xe.numSimplified),console.timeEnd("creation"));const vn=`z${N}`;this.stats[vn]=(this.stats[vn]||0)+1,this.total++}if(xe.source=V,ce==null){if(N===De.indexMaxZoom||xe.numPoints<=De.indexMaxPoints)continue}else{if(N===De.maxZoom||N===ce)continue;if(ce!=null){const vn=ce-N;if(Y!==pe>>vn||ie!==ze>>vn)continue}}if(xe.source=null,V.length===0)continue;He>1&&console.time("clipping");const Gt=.5*De.buffer/De.extent,zi=.5-Gt,vt=.5+Gt,qt=1+Gt;let _i=null,Ni=null,Gn=null,Yi=null,yn=ai(V,je,Y-Gt,Y+vt,0,xe.minX,xe.maxX,De),Vi=ai(V,je,Y+zi,Y+qt,0,xe.minX,xe.maxX,De);V=null,yn&&(_i=ai(yn,je,ie-Gt,ie+vt,1,xe.minY,xe.maxY,De),Ni=ai(yn,je,ie+zi,ie+qt,1,xe.minY,xe.maxY,De),yn=null),Vi&&(Gn=ai(Vi,je,ie-Gt,ie+vt,1,xe.minY,xe.maxY,De),Yi=ai(Vi,je,ie+zi,ie+qt,1,xe.minY,xe.maxY,De),Vi=null),He>1&&console.timeEnd("clipping"),ye.push(_i||[],N+1,2*Y,2*ie),ye.push(Ni||[],N+1,2*Y,2*ie+1),ye.push(Gn||[],N+1,2*Y+1,2*ie),ye.push(Yi||[],N+1,2*Y+1,2*ie+1)}}getTile(V,N,Y){V=+V,N=+N,Y=+Y;const ie=this.options,{extent:ce,debug:pe}=ie;if(V<0||V>24)return null;const ze=1<<V,ye=sr(V,N=N+ze&ze-1,Y);if(this.tiles[ye])return rr(this.tiles[ye],ce);pe>1&&console.log("drilling down to z%d-%d-%d",V,N,Y);let De,He=V,je=N,dt=Y;for(;!De&&He>0;)He--,je>>=1,dt>>=1,De=this.tiles[sr(He,je,dt)];return De&&De.source?(pe>1&&(console.log("found parent tile z%d-%d-%d",He,je,dt),console.time("drilling down")),this.splitTile(De.source,He,je,dt,V,N,Y),pe>1&&console.timeEnd("drilling down"),this.tiles[ye]?rr(this.tiles[ye],ce):null):null}}function sr(ge,V,N){return 32*((1<<ge)*N+V)+ge}class cl extends Ne{constructor(V,N,Y,ie=Hs){super(V,N,Y),this._dataUpdateable=new Map,this._createGeoJSONIndex=ie}loadVectorTile(V,N){return P._(this,void 0,void 0,function*(){const Y=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ie=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!ie)return null;const ce=new Jt(ie.features,{version:2,extent:P.a3});let pe=function(ze){const ye=new P.cP;return function(De,He){for(const je in De.layers)He.writeMessage(3,St,De.layers[je])}(ze,ye),ye.finish()}(ce);return pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),{vectorTile:ce,rawData:pe.buffer}})}loadData(V){return P._(this,void 0,void 0,function*(){var N;(N=this._pendingRequest)===null||N===void 0||N.abort();const Y=!!(V&&V.request&&V.request.collectResourceTiming)&&new P.cQ(V.request);this._pendingRequest=new AbortController;try{(!this._pendingData||V.request||V.data||V.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest));const ie=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ie,V),this.loaded={};const ce={data:ie};if(Y){const pe=Y.finish();pe&&(ce.resourceTiming={},ce.resourceTiming[V.source]=JSON.parse(JSON.stringify(pe)))}return ce}catch(ie){if(delete this._pendingRequest,P.cB(ie))return{abandoned:!0};throw ie}})}getData(){return P._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(V){const N=this.loaded;return N&&N[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,N){return P._(this,void 0,void 0,function*(){let Y=yield this.loadGeoJSON(V,N);if(delete this._pendingRequest,typeof Y!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(on(Y,!0),V.filter){const ie=P.cW(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ie.result==="error")throw new Error(ie.value.map(pe=>`${pe.key}: ${pe.message}`).join(", "));Y={type:"FeatureCollection",features:Y.features.filter(pe=>ie.value.evaluate({zoom:0},pe))}}return Y})}loadGeoJSON(V,N){return P._(this,void 0,void 0,function*(){const{promoteId:Y}=V;if(V.request){const ie=yield P.j(V.request,N);return this._dataUpdateable=P.cY(ie.data,Y)?P.cX(ie.data,Y):void 0,ie.data}if(typeof V.data=="string")try{const ie=JSON.parse(V.data);return this._dataUpdateable=P.cY(ie,Y)?P.cX(ie,Y):void 0,ie}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${V.source}`);return P.cZ(this._dataUpdateable,V.dataDiff,Y),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(V){return P._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}function Hs(ge,V){return V.cluster?new nr(function({superclusterOptions:N,clusterProperties:Y}){if(!Y||!N)return N;const ie={},ce={},pe={accumulated:null,zoom:0},ze={properties:null},ye=Object.keys(Y);for(const De of ye){const[He,je]=Y[De],dt=P.cW(je),xe=P.cW(typeof He=="string"?[He,["accumulated"],["get",De]]:He);ie[De]=dt.value,ce[De]=xe.value}return N.map=De=>{ze.properties=De;const He={};for(const je of ye)He[je]=ie[je].evaluate(pe,ze);return He},N.reduce=(De,He)=>{ze.properties=He;for(const je of ye)pe.accumulated=De[je],De[je]=ce[je].evaluate(pe,ze)},N}(V)).load(ge.features):function(N,Y){return new ll(N,Y)}(ge,V.geojsonVtOptions)}class bo{constructor(V){this.self=V,this.actor=new P.K(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(N,Y)=>{if(this.externalWorkerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.externalWorkerSourceTypes[N]=Y},this.self.addProtocol=P.cD,this.self.removeProtocol=P.cE,this.self.registerRTLTextPlugin=N=>{P.c_.setMethods(N)},this.actor.registerMessageHandler("LDT",(N,Y)=>this._getDEMWorkerSource(N,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RDT",(N,Y)=>P._(this,void 0,void 0,function*(){this._getDEMWorkerSource(N,Y.source).removeTile(Y)})),this.actor.registerMessageHandler("GCEZ",(N,Y)=>P._(this,void 0,void 0,function*(){return this._getWorkerSource(N,Y.type,Y.source).getClusterExpansionZoom(Y)})),this.actor.registerMessageHandler("GCC",(N,Y)=>P._(this,void 0,void 0,function*(){return this._getWorkerSource(N,Y.type,Y.source).getClusterChildren(Y)})),this.actor.registerMessageHandler("GCL",(N,Y)=>P._(this,void 0,void 0,function*(){return this._getWorkerSource(N,Y.type,Y.source).getClusterLeaves(Y)})),this.actor.registerMessageHandler("LD",(N,Y)=>this._getWorkerSource(N,Y.type,Y.source).loadData(Y)),this.actor.registerMessageHandler("GD",(N,Y)=>this._getWorkerSource(N,Y.type,Y.source).getData()),this.actor.registerMessageHandler("LT",(N,Y)=>this._getWorkerSource(N,Y.type,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RT",(N,Y)=>this._getWorkerSource(N,Y.type,Y.source).reloadTile(Y)),this.actor.registerMessageHandler("AT",(N,Y)=>this._getWorkerSource(N,Y.type,Y.source).abortTile(Y)),this.actor.registerMessageHandler("RMT",(N,Y)=>this._getWorkerSource(N,Y.type,Y.source).removeTile(Y)),this.actor.registerMessageHandler("RS",(N,Y)=>P._(this,void 0,void 0,function*(){if(!this.workerSources[N]||!this.workerSources[N][Y.type]||!this.workerSources[N][Y.type][Y.source])return;const ie=this.workerSources[N][Y.type][Y.source];delete this.workerSources[N][Y.type][Y.source],ie.removeSource!==void 0&&ie.removeSource(Y)})),this.actor.registerMessageHandler("RM",N=>P._(this,void 0,void 0,function*(){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N],this.globalStates.delete(N)})),this.actor.registerMessageHandler("SR",(N,Y)=>P._(this,void 0,void 0,function*(){this.referrer=Y})),this.actor.registerMessageHandler("SRPS",(N,Y)=>this._syncRTLPluginState(N,Y)),this.actor.registerMessageHandler("IS",(N,Y)=>P._(this,void 0,void 0,function*(){this.self.importScripts(Y)})),this.actor.registerMessageHandler("SI",(N,Y)=>this._setImages(N,Y)),this.actor.registerMessageHandler("UL",(N,Y)=>P._(this,void 0,void 0,function*(){this._getLayerIndex(N).update(Y.layers,Y.removedIds,this._getGlobalState(N))})),this.actor.registerMessageHandler("UGS",(N,Y)=>P._(this,void 0,void 0,function*(){const ie=this._getGlobalState(N);for(const ce in Y)ie[ce]=Y[ce]})),this.actor.registerMessageHandler("SL",(N,Y)=>P._(this,void 0,void 0,function*(){this._getLayerIndex(N).replace(Y,this._getGlobalState(N))}))}_getGlobalState(V){let N=this.globalStates.get(V);return N||(N={},this.globalStates.set(V,N)),N}_setImages(V,N){return P._(this,void 0,void 0,function*(){this.availableImages[V]=N;for(const Y in this.workerSources[V]){const ie=this.workerSources[V][Y];for(const ce in ie)ie[ce].availableImages=N}})}_syncRTLPluginState(V,N){return P._(this,void 0,void 0,function*(){return yield P.c_.syncState(N,this.self.importScripts)})}_getAvailableImages(V){let N=this.availableImages[V];return N||(N=[]),N}_getLayerIndex(V){let N=this.layerIndexes[V];return N||(N=this.layerIndexes[V]=new d),N}_getWorkerSource(V,N,Y){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][N]||(this.workerSources[V][N]={}),!this.workerSources[V][N][Y]){const ie={sendAsync:(ce,pe)=>(ce.targetMapId=V,this.actor.sendAsync(ce,pe))};switch(N){case"vector":this.workerSources[V][N][Y]=new Ne(ie,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][N][Y]=new cl(ie,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][N][Y]=new this.externalWorkerSourceTypes[N](ie,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][N][Y]}_getDEMWorkerSource(V,N){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][N]||(this.demWorkerSources[V][N]=new et),this.demWorkerSources[V][N]}}return P.i(self)&&(self.worker=new bo(self)),bo}),J("index",["exports","./shared"],function(P,d){var be="5.11.0";function Ae(){var f=new d.A(4);return d.A!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}let Je,Ne;const et={frame(f,e,r){const l=requestAnimationFrame(m=>{h(),e(m)}),{unsubscribe:h}=d.s(f.signal,"abort",()=>{h(),cancelAnimationFrame(l),r(d.c())},!1)},frameAsync(f){return new Promise((e,r)=>{this.frame(f,e,r)})},getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,r.drawImage(f,0,0,f.width,f.height),r},resolveURL:f=>(Je||(Je=document.createElement("a")),Je.href=f,Je.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ne==null&&(Ne=matchMedia("(prefers-reduced-motion: reduce)")),Ne.matches)}},Ct=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(f){this._frozenAt=f}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function mt(){return Ct.getCurrentTime()}class we{static testProp(e){if(!we.docStyle)return e[0];for(let r=0;r<e.length;r++)if(e[r]in we.docStyle)return e[r];return e[0]}static create(e,r,l){const h=window.document.createElement(e);return r!==void 0&&(h.className=r),l&&l.appendChild(h),h}static createNS(e,r){return window.document.createElementNS(e,r)}static disableDrag(){we.docStyle&&we.selectProp&&(we.userSelect=we.docStyle[we.selectProp],we.docStyle[we.selectProp]="none")}static enableDrag(){we.docStyle&&we.selectProp&&(we.docStyle[we.selectProp]=we.userSelect)}static setTransform(e,r){e.style[we.transformProp]=r}static addEventListener(e,r,l,h={}){e.addEventListener(r,l,"passive"in h?h:h.capture)}static removeEventListener(e,r,l,h={}){e.removeEventListener(r,l,"passive"in h?h:h.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",we.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",we.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",we.suppressClickInternal,!0)},0)}static getScale(e){const r=e.getBoundingClientRect();return{x:r.width/e.offsetWidth||1,y:r.height/e.offsetHeight||1,boundingClientRect:r}}static getPoint(e,r,l){const h=r.boundingClientRect;return new d.P((l.clientX-h.left)/r.x-e.clientLeft,(l.clientY-h.top)/r.y-e.clientTop)}static mousePos(e,r){const l=we.getScale(e);return we.getPoint(e,l,r)}static touchPos(e,r){const l=[],h=we.getScale(e);for(let m=0;m<r.length;m++)l.push(we.getPoint(e,h,r[m]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const r=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=r.querySelectorAll("script");for(const h of l)h.remove();return we.clean(r),r.innerHTML}static isPossiblyDangerous(e,r){const l=r.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const r=e.children;for(const l of r)we.removeAttributes(l),we.clean(l)}static removeAttributes(e){for(const{name:r,value:l}of e.attributes)we.isPossiblyDangerous(r,l)&&e.removeAttribute(r)}}we.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,we.selectProp=we.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),we.transformProp=we.testProp(["transform","WebkitTransform"]);const on={supported:!1,testSupport:function(f){!St&&Jt&&(gi?Ai(f):xi=f)}};let xi,Jt,St=!1,gi=!1;function Ai(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,Jt),f.isContextLost())return;on.supported=!0}catch{}f.deleteTexture(e),St=!0}var hi;typeof document<"u"&&(Jt=document.createElement("img"),Jt.onload=()=>{xi&&Ai(xi),xi=null,gi=!0},Jt.onerror=()=>{St=!0,xi=null},Jt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,r,l,h;f.resetRequestQueue=()=>{e=[],r=0,l=0,h={}},f.addThrottleControl=T=>{const A=l++;return h[A]=T,A},f.removeThrottleControl=T=>{delete h[T],y()},f.getImage=(T,A,C=!0)=>new Promise((I,D)=>{on.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),d.e(T,{type:"image"}),e.push({abortController:A,requestParameters:T,supportImageRefresh:C,state:"queued",onError:O=>{D(O)},onSuccess:O=>{I(O)}}),y()});const m=T=>d._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:A,supportImageRefresh:C,onError:I,onSuccess:D,abortController:O}=T,G=C===!1&&!d.i(self)&&!d.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce((Q,ne)=>Q&&ne==="accept",!0));r++;const K=G?w(A,O):d.m(A,O);try{const Q=yield K;delete T.abortController,T.state="completed",Q.data instanceof HTMLImageElement||d.b(Q.data)?D(Q):Q.data&&D({data:yield(W=Q.data,typeof createImageBitmap=="function"?d.f(W):d.h(W)),cacheControl:Q.cacheControl,expires:Q.expires})}catch(Q){delete T.abortController,I(Q)}finally{r--,y()}var W}),y=()=>{const T=(()=>{for(const A of Object.keys(h))if(h[A]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=r;A<T&&e.length>0;A++){const C=e.shift();C.abortController.signal.aborted?A--:m(C)}},w=(T,A)=>new Promise((C,I)=>{const D=new Image,O=T.url,G=T.credentials;G&&G==="include"?D.crossOrigin="use-credentials":(G&&G==="same-origin"||!d.d(O))&&(D.crossOrigin="anonymous"),A.signal.addEventListener("abort",()=>{D.src="",I(d.c())}),D.fetchPriority="high",D.onload=()=>{D.onerror=D.onload=null,C({data:D})},D.onerror=()=>{D.onerror=D.onload=null,A.signal.aborted||I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},D.src=O})}(hi||(hi={})),hi.resetRequestQueue();class Ht{constructor(e){this._transformRequestFn=e??null}transformRequest(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function ln(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const r=[];for(const{id:l,url:h}of f){const m=`${l}${h}`;r.indexOf(m)===-1&&(r.push(m),e.push({id:l,url:h}))}}return e}function _n(f,e,r){try{const l=new URL(f);return l.pathname+=`${e}${r}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${f}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function ha(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class bi extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:r,promiseResolve:l}of this.requestors)l(this._getImagesForIds(r));this.requestors=[]}}getImage(e){const r=this.images[e];if(r&&!r.data&&r.spriteData){const l=r.spriteData;r.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),r.spriteData=null}return r}addImage(e,r){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,r)&&(this.images[e]=r)}_validate(e,r){let l=!0;const h=r.data||r.spriteData;return this._validateStretch(r.stretchX,h&&h.width)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(r.stretchY,h&&h.height)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(r.content,r)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,r){if(!e)return!0;let l=0;for(const h of e){if(h[0]<l||h[1]<h[0]||r<h[1])return!1;l=h[1]}return!0}_validateContent(e,r){if(!e)return!0;if(e.length!==4)return!1;const l=r.spriteData,h=l&&l.width||r.data.width,m=l&&l.height||r.data.height;return!(e[0]<0||h<e[0]||e[1]<0||m<e[1]||e[2]<0||h<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,r,l=!0){const h=this.getImage(e);if(l&&(h.data.width!==r.data.width||h.data.height!==r.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${r.data.width}x${r.data.height}).`);r.version=h.version+1,this.images[e]=r,this.updatedImages[e]=!0}removeImage(e){const r=this.images[e];delete this.images[e],delete this.patterns[e],r.userImage&&r.userImage.onRemove&&r.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((r,l)=>{let h=!0;if(!this.isLoaded())for(const m of e)this.images[m]||(h=!1);this.isLoaded()||h?r(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:r})})}_getImagesForIds(e){const r={};for(const l of e){let h=this.getImage(l);h||(this.fire(new d.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?r[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return r}getPixelSize(){const{width:e,height:r}=this.atlasImage;return{width:e,height:r}}getPattern(e){const r=this.patterns[e],l=this.getImage(e);if(!l)return null;if(r&&r.position.version===l.version)return r.position;if(r)r.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},m=new d.I(h,l);this.patterns[e]={bin:h,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.T(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const m in this.patterns)e.push(this.patterns[m].bin);const{w:r,h:l}=d.p(e),h=this.atlasImage;h.resize({width:r||1,height:l||1});for(const m in this.patterns){const{bin:y}=this.patterns[m],w=y.x+1,T=y.y+1,A=this.getImage(m).data,C=A.width,I=A.height;d.R.copy(A,h,{x:0,y:0},{x:w,y:T},{width:C,height:I}),d.R.copy(A,h,{x:0,y:I-1},{x:w,y:T-1},{width:C,height:1}),d.R.copy(A,h,{x:0,y:0},{x:w,y:T+I},{width:C,height:1}),d.R.copy(A,h,{x:C-1,y:0},{x:w-1,y:T},{width:1,height:I}),d.R.copy(A,h,{x:0,y:0},{x:w+C,y:T},{width:1,height:I})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const r of e){if(this.callbackDispatchedThisFrame[r])continue;this.callbackDispatchedThisFrame[r]=!0;const l=this.getImage(r);l||d.w(`Image with ID: "${r}" was not found`),ha(l)&&this.updateImage(r,l)}}}const wi=1e20;function nr(f,e,r,l,h,m,y,w,T){for(let A=e;A<e+l;A++)da(f,r*m+A,m,h,y,w,T);for(let A=r;A<r+h;A++)da(f,A*m+e,1,l,y,w,T)}function da(f,e,r,l,h,m,y){m[0]=0,y[0]=-wi,y[1]=wi,h[0]=f[e];for(let w=1,T=0,A=0;w<l;w++){h[w]=f[e+w*r];const C=w*w;do{const I=m[T];A=(h[w]-h[I]+C-I*I)/(w-I)/2}while(A<=y[T]&&--T>-1);T++,m[T]=w,y[T]=A,y[T+1]=wi}for(let w=0,T=0;w<l;w++){for(;y[T+1]<w;)T++;const A=m[T],C=w-A;f[e+w*r]=h[A]+C*C}}const Vn=d.v.layout_symbol["text-font"].default.join(",");class Be{constructor(e,r,l){this.requestManager=e,this.localIdeographFontFamily=r,this.entries={},this.lang=l}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const r=[];for(const m in e)for(const y of e[m])r.push(this._getAndCacheGlyphsPromise(m,y));const l=yield Promise.all(r),h={};for(const{stack:m,id:y,glyph:w}of l)h[m]||(h[m]={}),h[m][y]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return h})}_getAndCacheGlyphsPromise(e,r){return d._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[r];return h!==void 0?{stack:e,id:r,glyph:h}:!this.url||this._charUsesLocalIdeographFontFamily(r)?(h=l.glyphs[r]=this._drawGlyph(l,e,r),{stack:e,id:r,glyph:h}):yield this._downloadAndCacheRangePromise(e,r)})}_downloadAndCacheRangePromise(e,r){return d._(this,void 0,void 0,function*(){const l=Math.floor(r/256);if(256*l>65535)throw new Error("glyphs > 65535 not supported");const h=this.entries[e];if(h.ranges[l])return{stack:e,id:r,glyph:null};if(!h.requests[l]){const m=Be.loadGlyphRange(e,l,this.url,this.requestManager);h.requests[l]=m}try{const m=yield h.requests[l];for(const y in m)h.glyphs[+y]=m[+y];return h.ranges[l]=!0,{stack:e,id:r,glyph:m[r]||null}}catch(m){const y=h.glyphs[r]=this._drawGlyph(h,e,r);return this._warnOnMissingGlyphRange(y,l,r,m),{stack:e,id:r,glyph:y}}})}_warnOnMissingGlyphRange(e,r,l,h){const m=256*r,y=m+255,w=l.toString(16).padStart(4,"0").toUpperCase();d.w(`Unable to load glyph range ${r}, ${m}-${y}. Rendering codepoint U+${w} locally instead. ${h}`)}_charUsesLocalIdeographFontFamily(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||d.u["CJK Unified Ideographs"](e)||d.u["Hangul Syllables"](e)||d.u.Hiragana(e)||d.u.Katakana(e)||d.u["CJK Symbols and Punctuation"](e)||d.u["Halfwidth and Fullwidth Forms"](e))}_drawGlyph(e,r,l){const h=r===Vn&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(l),m=h?"ideographTinySDF":"tinySDF";e[m]||(e[m]=this._createTinySDF(h?this.localIdeographFontFamily:r));const y=e[m].draw(String.fromCharCode(l));return{id:l,bitmap:new d.q({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(e){const r=e?e.split(","):[];r.push("sans-serif");const l=r.map(h=>/[-\w]+/.test(h)?h:`'${CSS.escape(h)}'`).join(",");return new Be.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:this._fontWeight(r[0]),fontStyle:this._fontStyle(r[0]),lang:this.lang})}_fontStyle(e){return/italic/i.test(e)?"italic":/oblique/i.test(e)?"oblique":"normal"}_fontWeight(e){const r={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let l;for(const[h,m]of Object.entries(r))new RegExp(`\\b${h}\\b`,"i").test(e)&&(l=`${m}`);return l}}Be.loadGlyphRange=function(f,e,r,l){return d._(this,void 0,void 0,function*(){const h=256*e,m=h+255,y=l.transformRequest(r.replace("{fontstack}",f).replace("{range}",`${h}-${m}`),"Glyphs"),w=yield d.n(y,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${h}-${m}`);const T={};for(const A of d.o(w.data))T[A.id]=A;return T})},Be.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:r=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:y="normal",lang:w=null}={}){this.buffer=e,this.cutoff=l,this.radius=r,this.lang=w;const T=this.size=f+4*e,A=this._createCanvas(T),C=this.ctx=A.getContext("2d",{willReadFrequently:!0});C.font=`${y} ${m} ${f}px ${h}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(f),y=Math.ceil(r),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),T=Math.min(this.size-this.buffer,y+Math.ceil(l)),A=w+2*this.buffer,C=T+2*this.buffer,I=Math.max(A*C,0),D=new Uint8ClampedArray(I),O={data:D,width:A,height:C,glyphWidth:w,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(w===0||T===0)return O;const{ctx:G,buffer:K,gridInner:W,gridOuter:Q}=this;this.lang&&(G.lang=this.lang),G.clearRect(K,K,w,T),G.fillText(f,K,K+y);const ne=G.getImageData(K,K,w,T);Q.fill(wi,0,I),W.fill(0,0,I);for(let se=0;se<T;se++)for(let te=0;te<w;te++){const oe=ne.data[4*(se*w+te)+3]/255;if(oe===0)continue;const de=(se+K)*A+te+K;if(oe===1)Q[de]=0,W[de]=wi;else{const ae=.5-oe;Q[de]=ae>0?ae*ae:0,W[de]=ae<0?ae*ae:0}}nr(Q,0,0,A,C,A,this.f,this.v,this.z),nr(W,K,K,w,T,A,this.f,this.v,this.z);for(let se=0;se<I;se++){const te=Math.sqrt(Q[se])-Math.sqrt(W[se]);D[se]=Math.round(255-255*(te/this.radius+this.cutoff))}return O}};class ot{constructor(){this.specification=d.t.light.position}possiblyEvaluate(e,r){return d.C(e.expression.evaluate(r))}interpolate(e,r,l){return{x:d.F.number(e.x,r.x,l),y:d.F.number(e.y,r.y,l),z:d.F.number(e.z,r.z,l)}}}let Tt;class pt extends d.E{constructor(e){super(),Tt=Tt||new d.r({anchor:new d.D(d.t.light.anchor),position:new ot,color:new d.D(d.t.light.color),intensity:new d.D(d.t.light.intensity)}),this._transitionable=new d.x(Tt,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,r={}){if(!this._validate(d.y,e,r))for(const l in e){const h=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,l){return(!l||l.validate!==!1)&&d.z(this,e.call(d.B,{value:r,style:{glyphs:!0,sprite:!0},styleSpec:d.t}))}}const li=new d.r({"sky-color":new d.D(d.t.sky["sky-color"]),"horizon-color":new d.D(d.t.sky["horizon-color"]),"fog-color":new d.D(d.t.sky["fog-color"]),"fog-ground-blend":new d.D(d.t.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.t.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.t.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.t.sky["atmosphere-blend"])});class me extends d.E{constructor(e){super(),this._transitionable=new d.x(li,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.G(0))}setSky(e,r={}){if(!this._validate(d.H,e,r)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const h=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,r,l={}){return l?.validate!==!1&&d.z(this,e.call(d.B,d.e({value:r,style:{glyphs:!0,sprite:!0},styleSpec:d.t})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ze{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,r){const l=e.join(",")+String(r);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,r)),this.dashEntry[l]}getDashRanges(e,r,l){const h=[];let m=e.length%2==1?-e[e.length-1]*l:0,y=e[0]*l,w=!0;h.push({left:m,right:y,isDash:w,zeroLength:e[0]===0});let T=e[0];for(let A=1;A<e.length;A++){w=!w;const C=e[A];m=T*l,T+=C,y=T*l,h.push({left:m,right:y,isDash:w,zeroLength:C===0})}return h}addRoundDash(e,r,l){const h=r/2;for(let m=-l;m<=l;m++){const y=this.width*(this.nextRow+l+m);let w=0,T=e[w];for(let A=0;A<this.width;A++){A/T.right>1&&(T=e[++w]);const C=Math.abs(A-T.left),I=Math.abs(A-T.right),D=Math.min(C,I);let O;const G=m/l*(h+1);if(T.isDash){const K=h-Math.abs(G);O=Math.sqrt(D*D+K*K)}else O=h-Math.sqrt(D*D+G*G);this.data[y+A]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const T=e[w],A=e[w+1];T.zeroLength?e.splice(w,1):A&&A.isDash===T.isDash&&(A.left=T.left,e.splice(w,1))}const r=e[0],l=e[e.length-1];r.isDash===l.isDash&&(r.left=l.left-this.width,l.right=r.right+this.width);const h=this.width*this.nextRow;let m=0,y=e[m];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++m]);const T=Math.abs(w-y.left),A=Math.abs(w-y.right),C=Math.min(T,A);this.data[h+w]=Math.max(0,Math.min(255,(y.isDash?C:-C)+128))}}addDash(e,r){const l=r?7:0,h=2*l+1;if(this.nextRow+h>this.height)return d.w("LineAtlas out of space"),null;let m=0;for(let w=0;w<e.length;w++)m+=e[w];if(m!==0){const w=this.width/m,T=this.getDashRanges(e,this.width,w);r?this.addRoundDash(T,w,l):this.addRegularDash(T)}const y={y:this.nextRow+l,height:2*l,width:m};return this.nextRow+=h,this.dirty=!0,y}bind(e){const r=e.gl;this.texture?(r.bindTexture(r.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,r.texSubImage2D(r.TEXTURE_2D,0,0,0,this.width,this.height,r.ALPHA,r.UNSIGNED_BYTE,this.data))):(this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.width,this.height,0,r.ALPHA,r.UNSIGNED_BYTE,this.data))}}const st="maplibre_preloaded_worker_pool";class ct{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ct.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[st]}numActive(){return Object.keys(this.active).length}}const Pt=Math.floor(et.hardwareConcurrency/2);let wt,Yt;function fi(){return wt||(wt=new ct),wt}ct.workerCount=d.J(globalThis)?Math.max(Math.min(Pt,3),1):1;class ai{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=r;const l=this.workerPool.acquire(r);for(let h=0;h<l.length;h++){const m=new d.K(l[h],r);m.name=`Worker ${h}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,r){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:e,data:r}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(r=>{r.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,r){for(const l of this.actors)l.registerMessageHandler(e,r)}}function ar(){return Yt||(Yt=new ai(fi(),d.L),Yt.registerMessageHandler("GR",(f,e,r)=>d.m(e,r))),Yt}function Mr(f,e){const r=d.M();return d.N(r,r,[1,1,0]),d.O(r,r,[.5*f.width,.5*f.height,1]),f.calculatePosMatrix?d.Q(r,r,f.calculatePosMatrix(e.toUnwrapped())):r}function ta(f,e,r,l,h,m,y){var w;const T=function(D,O,G){if(D)for(const K of D){const W=O[K];if(W&&W.source===G&&W.type==="fill-extrusion")return!0}else for(const K in O){const W=O[K];if(W.source===G&&W.type==="fill-extrusion")return!0}return!1}((w=h?.layers)!==null&&w!==void 0?w:null,e,f.id),A=m.maxPitchScaleFactor(),C=f.tilesIn(l,A,T);C.sort(Er);const I=[];for(const D of C)I.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(e,r,f.getState(),D.queryGeometry,D.cameraQueryGeometry,D.scale,h,m,A,Mr(m,D.tileID),y?(O,G)=>y(D.tileID,O,G):void 0)});return function(D,O){for(const G in D)for(const K of D[G])ki(K,O);return D}(function(D){const O={},G={};for(const K of D){const W=K.queryResults,Q=K.wrappedTileID,ne=G[Q]=G[Q]||{};for(const se in W){const te=W[se],oe=ne[se]=ne[se]||{},de=O[se]=O[se]||[];for(const ae of te)oe[ae.featureIndex]||(oe[ae.featureIndex]=!0,de.push(ae))}}return O}(I),f)}function Er(f,e){const r=f.tileID,l=e.tileID;return r.overscaledZ-l.overscaledZ||r.canonical.y-l.canonical.y||r.wrap-l.wrap||r.canonical.x-l.canonical.x}function ki(f,e){const r=f.feature,l=e.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=l}function Za(f,e,r){return d._(this,void 0,void 0,function*(){let l=f;if(f.url?l=(yield d.j(e.transformRequest(f.url,"Source"),r)).data:yield et.frameAsync(r),!l)return null;const h=d.S(d.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map(m=>m.id)),h})}class Ci{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.U?new d.U(e.lng,e.lat):d.U.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.U?new d.U(e.lng,e.lat):d.U.convert(e),this}extend(e){const r=this._sw,l=this._ne;let h,m;if(e instanceof d.U)h=e,m=e;else{if(!(e instanceof Ci))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ci.convert(e)):this.extend(d.U.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.U.convert(e)):this;if(h=e._sw,m=e._ne,!h||!m)return this}return r||l?(r.lng=Math.min(h.lng,r.lng),r.lat=Math.min(h.lat,r.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new d.U(h.lng,h.lat),this._ne=new d.U(m.lng,m.lat)),this}getCenter(){return new d.U((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.U(this.getWest(),this.getNorth())}getSouthEast(){return new d.U(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:l}=d.U.convert(e);let h=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}intersects(e){if((e=Ci.convert(e)).getNorth()<this.getSouth()||e.getSouth()>this.getNorth())return!1;const r=d.V(this.getWest(),-180,180),l=d.V(this.getEast(),-180,180),h=d.V(e.getWest(),-180,180),m=d.V(e.getEast(),-180,180),y=r>l,w=h>m;return!(!y||!w)||(y?m>=r||h<=l:w?l>=h||r<=m:!(h>l||m<r))}static convert(e){return e instanceof Ci?e:e&&new Ci(e)}static fromLngLat(e,r=0){const l=360*r/40075017,h=l/Math.cos(Math.PI/180*e.lat);return new Ci(new d.U(e.lng-h,e.lat-l),new d.U(e.lng+h,e.lat+l))}adjustAntiMeridian(){const e=new d.U(this._sw.lng,this._sw.lat),r=new d.U(this._ne.lng,this._ne.lat);return new Ci(e,e.lng>r.lng?new d.U(r.lng+360,r.lat):r)}}class xo{constructor(e,r,l){this.bounds=Ci.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const r=Math.pow(2,e.z),l=Math.floor(d.X(this.bounds.getWest())*r),h=Math.floor(d.W(this.bounds.getNorth())*r),m=Math.ceil(d.X(this.bounds.getEast())*r),y=Math.ceil(d.W(this.bounds.getSouth())*r);return e.x>=l&&e.x<m&&e.y>=h&&e.y<y}}class Vs extends d.E{constructor(e,r,l,h){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.S(r,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Za(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new xo(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new d.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(r,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((m,y)=>{e.reloadPromise={resolve:m,reject:y}})}else e.actor=this.dispatcher.getActor(),h="LT";e.abortController=new AbortController;try{const m=yield e.actor.sendAsync({type:h,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,m)}catch(m){if(delete e.abortController,e.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,r){if(r&&r.resourceTiming&&(e.resourceTiming=r.resourceTiming),r&&this.map._refreshExpiredTiles&&e.setExpiryData(r),e.loadVectorData(r,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class rr extends d.E{constructor(e,r,l,h){super(),this.id=e,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},r),d.e(this,d.S(r,["url","scheme","tileSize"]))}load(){return d._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Za(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(d.e(this,r),r.bounds&&(this.tileBounds=new xo(r.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(r){this._tileJSONRequest=null,this._loaded=!0,this.fire(new d.k(r))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield hi.getImage(this.map._requestManager.transformRequest(r,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,m=h.gl,y=l.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new d.T(h,y,m.RGBA,{useMipmap:!0}),e.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Gs extends rr{constructor(e,r,l,h){super(e,r,l,h),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox",this.redFactor=r.redFactor,this.greenFactor=r.greenFactor,this.blueFactor=r.blueFactor,this.baseShift=r.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const r=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(r,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const h=yield hi.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){const m=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const y=d.b(m)&&d.Y()?m:yield this.readImageNow(m),w={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.Z()){const r=e.width+2,l=e.height+2;try{return new d.R({width:r,height:l},yield d.$(e,-1,-1,r,l))}catch{}}return et.getImageData(e,1)})}_getNeighboringTiles(e){const r=e.canonical,l=Math.pow(2,r.z),h=(r.x-1+l)%l,m=r.x===0?e.wrap-1:e.wrap,y=(r.x+1+l)%l,w=r.x+1===l?e.wrap+1:e.wrap,T={};return T[new d.a0(e.overscaledZ,m,r.z,h,r.y).key]={backfilled:!1},T[new d.a0(e.overscaledZ,w,r.z,y,r.y).key]={backfilled:!1},r.y>0&&(T[new d.a0(e.overscaledZ,m,r.z,h,r.y-1).key]={backfilled:!1},T[new d.a0(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},T[new d.a0(e.overscaledZ,w,r.z,y,r.y-1).key]={backfilled:!1}),r.y+1<l&&(T[new d.a0(e.overscaledZ,m,r.z,h,r.y+1).key]={backfilled:!1},T[new d.a0(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},T[new d.a0(e.overscaledZ,w,r.z,y,r.y+1).key]={backfilled:!1}),T}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}function Zs(f){return f.type==="GeometryCollection"?f.geometries.map(e=>e.coordinates).flat(1/0):f.coordinates.flat(1/0)}function qs(f){const e=new Ci;let r;switch(f.type){case"FeatureCollection":r=f.features.map(l=>Zs(l.geometry)).flat(1/0);break;case"Feature":r=Zs(f.geometry);break;default:r=Zs(f)}if(r.length==0)return e;for(let l=0;l<r.length-1;l+=2)e.extend([r[l],r[l+1]]);return e}class Vr extends d.E{constructor(e,r,l,h){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:r.data},this.actor=l.getActor(),this.setEventedParent(h),this._data=r.data,this._options=d.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId,r.clusterMaxZoom!==void 0&&this.maxzoom<=r.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${r.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(r.buffer!==void 0?r.buffer:128),tolerance:this._pixelsToTileUnits(r.tolerance!==void 0?r.tolerance:.375),extent:d.a3,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(r.clusterMaxZoom),minPoints:Math.max(2,r.clusterMinPoints||2),extent:d.a3,radius:this._pixelsToTileUnits(r.clusterRadius||50),log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(d.a3/this.tileSize)}_getClusterMaxZoom(e){const r=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||d.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${r}"`),r}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=d.a4(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getBounds(){return d._(this,void 0,void 0,function*(){return qs(yield this.getData())})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,r,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:r,offset:l}})}_updateWorkerData(){return d._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void d.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:e,diff:r}=this._pendingWorkerUpdate,l=d.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(l.request=this.map._requestManager.transformRequest(et.resolveURL(e),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):r&&(l.dataDiff=r,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new d.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||h.abandoned)return void this.fire(new d.l("dataabort",{dataType:"source"}));this._data=h.data;let m=null;h.resourceTiming&&h.resourceTiming[this.id]&&(m=h.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&d.e(y,{resourceTiming:m}),this.fire(new d.l("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new d.l("data",Object.assign(Object.assign({},y),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(r)})))}catch(h){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new d.l("dataabort",{dataType:"source"}));this.fire(new d.k(h))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}})}_getShouldReloadTileOptions(e){if(!e||e.removeAll)return;const{add:r=[],update:l=[],remove:h=[]}=e||{},m=new Set([...l.map(y=>y.id),...h]);return{nextBounds:[...l.map(y=>y.newGeometry),...r.map(y=>y.geometry)].map(y=>qs(y)),prevIds:m}}shouldReloadTile(e,{nextBounds:r,prevIds:l}){const h=e.latestFeatureIndex.loadVTLayers();for(let T=0;T<e.latestFeatureIndex.featureIndexArray.length;T++){const A=e.latestFeatureIndex.featureIndexArray.get(T),C=h._geojsonTileLayer.feature(A.featureIndex);if(l.has(C.id))return!0}const{buffer:m,extent:y}=this.workerOptions.geojsonVtOptions,w=function({x:T,y:A,z:C},I=0){const D=d.a1((T-I)/Math.pow(2,C)),O=d.a2((A+1+I)/Math.pow(2,C)),G=d.a1((T+1+I)/Math.pow(2,C)),K=d.a2((A-I)/Math.pow(2,C));return new Ci([D,O],[G,K])}(e.tileID.canonical,m/y);for(const T of r)if(w.intersects(T))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return d._(this,void 0,void 0,function*(){const r=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const h=yield this.actor.sendAsync({type:r,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(h,this.map.painter,r==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class pn extends d.E{constructor(e,r,l,h){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=r}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const r=yield hi.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,r&&r.data&&(this.image=r.data,e&&(this.coordinates=e),this._finishLoading())}catch(r){this._request=null,this._loaded=!0,this.fire(new d.k(r))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const r=e.map(d.a5.fromLngLat);var l;return this.tileID=function(h){const m=d.a6.fromPoints(h),y=m.width(),w=m.height(),T=Math.max(y,w),A=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),C=Math.pow(2,A);return new d.a8(A,Math.floor((m.minX+m.maxX)/2*C),Math.floor((m.minY+m.maxY)/2*C))}(r),this.terrainTileRanges=this._getOverlappingTileRanges(r),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=r.map(h=>this.tileID.getTilePoint(h)._round()),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,r=e.gl;this.texture||(this.texture=new d.T(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:r,minY:l,maxX:h,maxY:m}=d.a6.fromPoints(e),y={};for(let w=0;w<=d.a7;w++){const T=Math.pow(2,w),A=Math.floor(r*T),C=Math.floor(l*T),I=Math.floor(h*T),D=Math.floor(m*T);y[w]={minTileX:A,minTileY:C,maxTileX:I,maxTileY:D}}return y}}class ll extends pn{constructor(e,r,l,h){super(e,r,l,h),this.roundZoom=!0,this.type="video",this.options=r}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const r of e.urls)this.urls.push(this.map._requestManager.transformRequest(r,"Source").url);try{const r=yield d.a9(this.urls);if(this._loaded=!0,!r)return;this.video=r,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(r){this.fire(new d.k(r))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new d.k(new d.aa(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,r=e.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new d.T(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class sr extends pn{constructor(e,r,l,h){super(e,r,l,h),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new d.k(new d.aa(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.k(new d.aa(`sources.${e}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new d.k(new d.aa(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new d.k(new d.aa(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.k(new d.aa(`sources.${e}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context,l=r.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.T(r,this.canvas,l.RGBA,{premultiply:!0});let h=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const cl={},Hs=f=>{switch(f){case"geojson":return Vr;case"image":return pn;case"raster":return rr;case"raster-dem":return Gs;case"vector":return Vs;case"video":return ll;case"canvas":return sr}return cl[f]},bo="RTLPluginLoaded";class ge extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=ar()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(r=>{throw this.status="error",r})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(r,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=et.resolveURL(r),!this.url)throw new Error(`requested url ${r} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.l(bo))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let V=null;function N(){return V||(V=new ge),V}var Y,ie;(function(f){f[f.Base=0]="Base",f[f.Parent=1]="Parent"})(Y||(Y={})),function(f){f[f.Departing=0]="Departing",f[f.Incoming=1]="Incoming"}(ie||(ie={}));class ce{constructor(e,r){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=d.ab(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:r,fadingParentID:l,fadeEndTime:h}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=r,this.fadingParentID=l,this.fadeEndTime=h}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=mt(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,r,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,m){const y={};if(!m)return y;for(const w of h){const T=w.layerIds.map(A=>m.getLayer(A)).filter(Boolean);if(T.length!==0){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(A=>T.filter(C=>C.id===A)[0]));for(const A of T)y[A.id]=w}}return y}(e.buckets,r?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof d.ad){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof d.ad&&m.hasRTLText){this.hasRTLText=!0,N().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(h).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new d.ac}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new d.T(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new d.T(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,l,h,m,y,w,T,A,C,I){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:m,scale:y,tileSize:this.tileSize,pixelPosMatrix:C,transform:T,params:w,queryPadding:this.queryPadding*A,getElevation:I},e,r,l):{}}querySourceFeatures(e,r){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),m=r&&r.sourceLayer?r.sourceLayer:"",y=h._geojsonTileLayer||h[m];if(!y)return;const w=d.ae(r?.filter,r?.globalState),{z:T,x:A,y:C}=this.tileID.canonical,I={z:T,x:A,y:C};for(let D=0;D<y.length;D++){const O=y.feature(D);if(w.needGeometry){const W=d.af(O,!0);if(!w.filter(new d.G(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!w.filter(new d.G(this.tileID.overscaledZ),O))continue;const G=l.getId(O,m),K=new d.ag(O,T,A,C,G);K.tile=I,e.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const l=d.ah(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(r)if(this.expirationTime<r)h=!0;else{const m=this.expirationTime-r;m?this.expirationTime=l+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!r.style.hasLayer(h))continue;const m=this.buckets[h],y=m.layers[0].sourceLayer||"_geojsonTileLayer",w=l[y],T=e[y];if(!w||!T||Object.keys(T).length===0)continue;m.update(T,w,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const A=r&&r.style&&r.style.getLayer(h);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(m)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<mt()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=mt()+e}setDependencies(e,r){const l={};for(const h of r)l[h]=!0;this.dependencies[e]=l}hasDependency(e,r){for(const l of e){const h=this.dependencies[l];if(h){for(const m of r)if(h[m])return!0}}return!1}}class pe{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,l){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const m={value:r,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},l)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const l=e.wrapped().key,h=r===void 0?0:this.data[l].indexOf(r),m=this.data[l][h];return this.data[l].splice(h,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const l in this.data)for(const h of this.data[l])e(h.value)||r.push(h);for(const l of r)this.remove(l.value.tileID,l)}}class ze{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,l){const h=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},d.e(this.stateChanges[e][h],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==h&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const m in this.state[e][h])l[m]||(this.deletedStates[e][h][m]=null)}else for(const m in l)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][m]===null&&delete this.deletedStates[e][h][m]}removeFeatureState(e,r,l){if(this.deletedStates[e]===null)return;const h=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&r!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][l]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(l in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][l]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,r){const l=String(r),h=d.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][r];if(m===null)return{};for(const y in m)delete h[y]}return h}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const y in this.stateChanges[h])this.state[h][y]||(this.state[h][y]={}),d.e(this.state[h][y],this.stateChanges[h][y]),m[y]=this.state[h][y];l[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(this.deletedStates[h]===null)for(const y in this.state[h])m[y]={},this.state[h][y]={};else for(const y in this.deletedStates[h]){if(this.deletedStates[h][y]===null)this.state[h][y]={};else for(const w of Object.keys(this.deletedStates[h][y]))delete this.state[h][y][w];m[y]=this.state[h][y]}l[h]=l[h]||{},d.e(l[h],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in e)e[h].setFeatureState(l,r)}}const ye=89.25;function De(f,e){const r=d.ai(e.lat,-d.aj,d.aj);return new d.P(d.X(e.lng)*f,d.W(r)*f)}function He(f,e){return new d.a5(e.x/f,e.y/f).toLngLat()}function je(f){return f.cameraToCenterDistance*Math.min(.85*Math.tan(d.ak(90-f.pitch)),Math.tan(d.ak(ye-f.pitch)))}function dt(f,e){const r=f.canonical,l=e/d.al(r.z),h=r.x+Math.pow(2,r.z)*f.wrap,m=d.am(new Float64Array(16));return d.N(m,m,[h*l,r.y*l,0]),d.O(m,m,[l/d.a3,l/d.a3,1]),m}function xe(f,e,r,l,h){const m=d.a5.fromLngLat(f,e),y=h*d.an(1,f.lat),w=y*Math.cos(d.ak(r)),T=Math.sqrt(y*y-w*w),A=T*Math.sin(d.ak(-l)),C=T*Math.cos(d.ak(-l));return new d.a5(m.x+A,m.y+C,m.z+w)}function Gt(f,e,r){const l=e.intersectsFrustum(f);if(!r||l===0)return l;const h=e.intersectsPlane(r);return h===0?0:l===2&&h===2?2:1}function zi(f,e,r){let l=0;const h=(r-e)/10;for(let m=0;m<10;m++)l+=h*Math.pow(Math.cos(e+(m+.5)/10*(r-e)),f);return l}function vt(f,e){return function(r,l,h,m,y){const w=2*((f-1)/d.ao(Math.cos(d.ak(ye-y))/Math.cos(d.ak(ye)))-1),T=Math.acos(h/m),A=2*zi(w-1,0,d.ak(y/2)),C=Math.min(d.ak(ye),T+d.ak(y/2)),I=zi(w-1,Math.min(C,T-d.ak(y/2)),C),D=Math.atan(l/h),O=Math.hypot(l,h);let G=r;return G+=d.ao(m/O/Math.max(.5,Math.cos(d.ak(y/2)))),G+=w*d.ao(Math.cos(D))/2,G-=d.ao(Math.max(1,I/A/e))/2,G}}const qt=vt(9.314,3);function _i(f,e){const r=(e.roundZoom?Math.round:Math.floor)(f.zoom+d.ao(f.tileSize/e.tileSize));return Math.max(0,r)}function Ni(f,e){const r=f.getCameraFrustum(),l=f.getClippingPlane(),h=f.screenPointToMercatorCoordinate(f.getCameraPoint()),m=d.a5.fromLngLat(f.center,f.elevation);h.z=m.z+Math.cos(f.pitchInRadians)*f.cameraToCenterDistance/f.worldSize;const y=f.getCoveringTilesDetailsProvider(),w=y.allowVariableZoom(f,e),T=_i(f,e),A=e.minzoom||0,C=e.maxzoom!==void 0?e.maxzoom:f.maxZoom,I=Math.min(Math.max(0,T),C),D=Math.pow(2,I),O=[D*h.x,D*h.y,0],G=[D*m.x,D*m.y,0],K=Math.hypot(m.x-h.x,m.y-h.y),W=Math.abs(m.z-h.z),Q=Math.hypot(K,W),ne=oe=>({zoom:0,x:0,y:0,wrap:oe,fullyVisible:!1}),se=[],te=[];if(f.renderWorldCopies&&y.allowWorldCopies())for(let oe=1;oe<=3;oe++)se.push(ne(-oe)),se.push(ne(oe));for(se.push(ne(0));se.length>0;){const oe=se.pop(),de=oe.x,ae=oe.y;let fe=oe.fullyVisible;const Pe={x:de,y:ae,z:oe.zoom},Se=y.getTileBoundingVolume(Pe,oe.wrap,f.elevation,e);if(!fe){const We=Gt(r,Se,l);if(We===0)continue;fe=We===2}const Ce=y.distanceToTile2d(h.x,h.y,Pe,Se);let Ie=T;w&&(Ie=(e.calculateTileZoom||qt)(f.zoom+d.ao(f.tileSize/e.tileSize),Ce,W,Q,f.fov)),Ie=(e.roundZoom?Math.round:Math.floor)(Ie),Ie=Math.max(0,Ie);const Ke=Math.min(Ie,C);if(oe.wrap=y.getWrap(m,Pe,oe.wrap),oe.zoom>=Ke){if(oe.zoom<A)continue;const We=I-oe.zoom,Fe=O[0]-.5-(de<<We),lt=O[1]-.5-(ae<<We),Lt=e.reparseOverscaled?Math.max(oe.zoom,Ie):oe.zoom;te.push({tileID:new d.a0(oe.zoom===C?Lt:oe.zoom,oe.wrap,oe.zoom,de,ae),distanceSq:d.ap([G[0]-.5-de,G[1]-.5-ae]),tileDistanceToCamera:Math.sqrt(Fe*Fe+lt*lt)})}else for(let We=0;We<4;We++)se.push({zoom:oe.zoom+1,x:(de<<1)+We%2,y:(ae<<1)+(We>>1),wrap:oe.wrap,fullyVisible:fe})}return te.sort((oe,de)=>oe.distanceSq-de.distanceSq).map(oe=>oe.tileID)}const Gn=d.a6.fromPoints([new d.P(0,0),new d.P(d.a3,d.a3)]);class Yi extends d.E{constructor(e,r,l){super(),this.id=e,this.dispatcher=l,this.on("data",h=>this._dataHandler(h)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,m,y,w)=>{const T=new(Hs(m.type))(h,m,y,w);if(T.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${T.id}`);return T})(e,r,l,this),this._tiles={},this._cache=new pe(0,h=>this._unloadTile(h)),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new ze,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,r,l){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,r,l)}catch(h){e.state="errored",h.status!==404?this._source.fire(new d.k(h,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const l=this._tiles[r];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(yn).map(e=>e.key)}getRenderableIds(e){const r=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&r.push(this._tiles[l]);return e?r.sort((l,h)=>{const m=l.tileID,y=h.tileID,w=new d.P(m.canonical.x,m.canonical.y)._rotate(-this.transform.bearingInRadians),T=new d.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians);return m.overscaledZ-y.overscaledZ||T.y-w.y||T.x-w.x}).map(l=>l.tileID.key):r.map(l=>l.tileID).sort(yn).map(l=>l.key)}hasRenderableParent(e){const r=e.overscaledZ-1;if(r>=this._source.minzoom){const l=this.getLoadedTile(e.scaledTo(r));if(l)return this._isIdRenderable(l.tileID.key)}return!1}_isIdRenderable(e,r=!1){var l;return(l=this._tiles[e])===null||l===void 0?void 0:l.isRenderable(r)}reload(e,r=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)r&&this._source.shouldReloadTile&&!this._source.shouldReloadTile(this._tiles[l],r)||(e?this._reloadTile(l,"expired"):this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading"))}}_reloadTile(e,r){return d._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=r),yield this._loadTile(l,e,r))})}_tileLoaded(e,r,l){e.timeAdded=mt(),e.selfFading&&(e.fadeEndTime=e.timeAdded+this._rasterFadeDuration),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const r=this.getRenderableIds();for(let h=0;h<r.length;h++){const m=r[h];if(e.neighboringTiles&&e.neighboringTiles[m]){const y=this.getTileByID(m);l(e,y),l(y,e)}}function l(h,m){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let y=m.tileID.canonical.x-h.tileID.canonical.x;const w=m.tileID.canonical.y-h.tileID.canonical.y,T=Math.pow(2,h.tileID.canonical.z),A=m.tileID.key;y===0&&w===0||Math.abs(w)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,y,w),h.neighboringTiles&&h.neighboringTiles[A]&&(h.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r){const l=Object.values(e),h=this._getLoadedDescendents(l),m={};for(const y of l){const w=h[y.key];if(!w?.length){m[y.key]=y;continue}const T=y.overscaledZ+Yi.maxUnderzooming,A=w.filter(D=>D.tileID.overscaledZ<=T);if(!A.length){m[y.key]=y;continue}const C=Math.min(...A.map(D=>D.tileID.overscaledZ)),I=A.filter(D=>D.tileID.overscaledZ===C).map(D=>D.tileID);for(const D of I)r[D.key]=D;this._areDescendentsComplete(I,C,y.overscaledZ)||(m[y.key]=y)}return m}_getLoadedDescendents(e){var r;const l={};for(const h in this._tiles){const m=this._tiles[h];if(m.hasData())for(const y of e)m.tileID.isChildOf(y)&&(l[r=y.key]||(l[r]=[])).push(m)}return l}_areDescendentsComplete(e,r,l){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===r:Math.pow(4,r-l)===e.length}getLoadedTile(e){const r=this._tiles[e.key];return r?.hasData()?r:null}updateCacheSize(e){const r=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,h=Math.floor(r*l*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(m)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const l={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+r),l[m.tileID.key]=m}this._tiles=l,this._resetTileReloadTimers()}}update(e,r){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=r,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new d.a0(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(l=Ni(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:r,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter(T=>this._source.hasTile(T)))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const h=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,h&&this.fire(new d.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const m=_i(e,this._source),y=this._updateRetainedTiles(l,m),w=Vi(this._source.type);w&&this._rasterFadeDuration>0&&!r&&this._updateFadingTiles(l,y),w?this._cleanUpRasterTiles(y):this._cleanUpVectorTiles(y)}_cleanUpRasterTiles(e){for(const r in this._tiles)e[r]||this._removeTile(r)}_cleanUpVectorTiles(e){for(const r in this._tiles){const l=this._tiles[r];e[r]?l.clearSymbolFadeHold():l.hasSymbolBuckets?l.holdingForSymbolFade()?l.symbolFadeFinished()&&this._removeTile(r):l.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(r)}}_addTerrainIdealTiles(e){const r=[];for(const l of e)if(l.canonical.z>this._source.minzoom){const h=l.scaledTo(l.canonical.z-1);r.push(h);const m=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));r.push(m)}return e.concat(r)}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,r){var l;const h={},m={},y=Math.max(r-Yi.maxOverzooming,this._source.minzoom);let w={};for(const T of e){const A=this._addTile(T);h[T.key]=T,A.hasData()||(w[T.key]=T)}w=this._retainLoadedChildren(w,h);for(const T in w){const A=w[T];let C=this._tiles[T],I=C?.wasRequested();for(let D=A.overscaledZ-1;D>=y;--D){const O=A.scaledTo(D);if(m[O.key])break;if(m[O.key]=!0,C=this.getTile(O),!C&&I&&(C=this._addTile(O)),C){const G=C.hasData();if((G||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||I)&&(h[O.key]=O),I=C.wasRequested(),G)break}}}return h}_updateFadingTiles(e,r){const l=mt(),h=d.aq(e);for(const m of e){const y=this._tiles[m.key];y.fadingDirection!==ie.Departing&&y.fadeOpacity!==0||y.resetFadeLogic(),this._updateFadingAncestor(y,r,l)||this._updateFadingDescendents(y,r,l)||this._updateFadingEdge(y,h,l)||y.resetFadeLogic()}}_updateFadingAncestor(e,r,l){if(!e.hasData())return!1;const{tileID:h,fadingRole:m,fadingDirection:y,fadingParentID:w}=e;if(m===Y.Base&&y===ie.Incoming&&w)return r[w.key]=w,!0;const T=Math.max(h.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let A=h.overscaledZ-1;A>=T;A--){const C=h.scaledTo(A),I=this.getLoadedTile(C);if(I)return e.setCrossFadeLogic({fadingRole:Y.Base,fadingDirection:ie.Incoming,fadingParentID:I.tileID,fadeEndTime:l+this._rasterFadeDuration}),I.setCrossFadeLogic({fadingRole:Y.Parent,fadingDirection:ie.Departing,fadeEndTime:l+this._rasterFadeDuration}),r[C.key]=C,!0}return!1}_updateFadingDescendents(e,r,l){if(!e.hasData())return!1;const h=e.tileID.children(this._source.maxzoom);let m=this._updateFadingChildren(e,h,r,l);if(m)return!0;for(const y of h){const w=y.children(this._source.maxzoom);this._updateFadingChildren(e,w,r,l)&&(m=!0)}return m}_updateFadingChildren(e,r,l,h){if(r[0].overscaledZ>=this._source.maxzoom)return!1;let m=!1;for(const y of r){const w=this.getLoadedTile(y);if(!w)continue;const{fadingRole:T,fadingDirection:A,fadingParentID:C}=w;T===Y.Base&&A===ie.Departing&&C||(w.setCrossFadeLogic({fadingRole:Y.Base,fadingDirection:ie.Departing,fadingParentID:e.tileID,fadeEndTime:h+this._rasterFadeDuration}),e.setCrossFadeLogic({fadingRole:Y.Parent,fadingDirection:ie.Incoming,fadeEndTime:h+this._rasterFadeDuration})),l[y.key]=y,m=!0}return m}_updateFadingEdge(e,r,l){const h=e.tileID;return!!e.selfFading||!e.hasData()&&!!r.has(h)&&(e.setSelfFadeLogic(l+this._rasterFadeDuration),!0)}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(r.resetFadeLogic(),this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null));const l=r;return r||(r=new ce(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,e.key,r.state)),r.uses++,this._tiles[e.key]=r,l||this._source.fire(new d.l("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,r){this._clearTileReloadTimer(e);const l=r.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_clearTileReloadTimer(e){const r=this._timers[e];r&&(clearTimeout(r),delete this._timers[e])}_resetTileReloadTimers(){for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}refreshTiles(e){for(const r in this._tiles)(this._isIdRenderable(r)||this._tiles[r].state=="errored")&&e.some(l=>l.equals(this._tiles[r].tileID.canonical))&&this._reloadTile(r,"expired")}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._clearTileReloadTimer(e),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}_dataHandler(e){e.dataType==="source"&&(e.sourceDataType!=="metadata"?e.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged,e.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,r,l){const h=[],m=this.transform;if(!m)return h;const y=m.getCoveringTilesDetailsProvider().allowWorldCopies(),w=l?m.getCameraQueryGeometry(e):e,T=O=>m.screenPointToMercatorCoordinate(O,this.terrain),A=this.transformBbox(e,T,!y),C=this.transformBbox(w,T,!y),I=this.getIds(),D=d.a6.fromPoints(C);for(let O=0;O<I.length;O++){const G=this._tiles[I[O]];if(G.holdingForSymbolFade())continue;const K=y?[G.tileID]:[G.tileID.unwrapTo(-1),G.tileID.unwrapTo(0)],W=Math.pow(2,m.zoom-G.tileID.overscaledZ),Q=r*G.queryPadding*d.a3/G.tileSize/W;for(const ne of K){const se=D.map(te=>ne.getTilePoint(new d.a5(te.x,te.y)));if(se.expandBy(Q),se.intersects(Gn)){const te=A.map(de=>ne.getTilePoint(de)),oe=C.map(de=>ne.getTilePoint(de));h.push({tile:G,tileID:y?ne:ne.unwrapTo(0),queryGeometry:te,cameraQueryGeometry:oe,scale:W})}}}return h}transformBbox(e,r,l){let h=e.map(r);if(l){const m=d.a6.fromPoints(e);m.shrinkBy(.001*Math.min(m.width(),m.height()));const y=m.map(r);d.a6.fromPoints(h).covers(y)||(h=h.map(w=>w.x>.5?new d.a5(w.x-1,w.y,w.z):w))}return h}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);return this.transform&&this.transform.populateCache(r),r}hasTransition(){if(this._source.hasTransition())return!0;if(Vi(this._source.type)&&this._rasterFadeDuration>0){const e=mt();for(const r in this._tiles)if(this._tiles[r].fadeEndTime>=e)return!0}return!1}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,r,l){this._state.updateState(e=e||"_geojsonTileLayer",r,l)}removeFeatureState(e,r,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,l)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,l){const h=this._tiles[e];h&&h.setDependencies(r,l)}reloadTilesForDependencies(e,r){for(const l in this._tiles)this._tiles[l].hasDependency(e,r)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,r))}}function yn(f,e){const r=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-r||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function Vi(f){return f==="raster"||f==="image"||f==="video"}Yi.maxOverzooming=10,Yi.maxUnderzooming=3;class vn{constructor(e,r){this.reset(e,r)}reset(e,r){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ai(e,0,1);let r=1,l=this._distances[r];const h=e*this.paddedLength+this.padding;for(;l<h&&r<this._distances.length;)l=this._distances[++r];const m=r-1,y=this._distances[m],w=l-y,T=w>0?(h-y)/w:0;return this.points[m].mult(1-T).add(this.points[r].mult(T))}}function Ve(f,e){let r=!0;return f==="always"||f!=="never"&&e!=="never"||(r=!1),r}class cn{constructor(e,r,l){const h=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(r/l);for(let y=0;y<this.xCellCount*this.yCellCount;y++)h.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,r,l,h,m){this._forEachCell(r,l,h,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(r),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m)}insertCircle(e,r,l,h){this._forEachCell(r-h,l-h,r+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(r),this.circles.push(l),this.circles.push(h)}_insertBoxCell(e,r,l,h,m,y){this.boxCells[m].push(y)}_insertCircleCell(e,r,l,h,m,y){this.circleCells[m].push(y)}_query(e,r,l,h,m,y,w){if(l<0||e>this.width||h<0||r>this.height)return[];const T=[];if(e<=0&&r<=0&&this.width<=l&&this.height<=h){if(m)return[{key:null,x1:e,y1:r,x2:l,y2:h}];for(let A=0;A<this.boxKeys.length;A++)T.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const C=this.circles[3*A],I=this.circles[3*A+1],D=this.circles[3*A+2];T.push({key:this.circleKeys[A],x1:C-D,y1:I-D,x2:C+D,y2:I+D})}}else this._forEachCell(e,r,l,h,this._queryCell,T,{hitTest:m,overlapMode:y,seenUids:{box:{},circle:{}}},w);return T}query(e,r,l,h){return this._query(e,r,l,h,!1,null)}hitTest(e,r,l,h,m,y){return this._query(e,r,l,h,!0,m,y).length>0}hitTestCircle(e,r,l,h,m){const y=e-l,w=e+l,T=r-l,A=r+l;if(w<0||y>this.width||A<0||T>this.height)return!1;const C=[];return this._forEachCell(y,T,w,A,this._queryCellCircle,C,{hitTest:!0,overlapMode:h,circle:{x:e,y:r,radius:l},seenUids:{box:{},circle:{}}},m),C.length>0}_queryCell(e,r,l,h,m,y,w,T){const{seenUids:A,hitTest:C,overlapMode:I}=w,D=this.boxCells[m];if(D!==null){const G=this.bboxes;for(const K of D)if(!A.box[K]){A.box[K]=!0;const W=4*K,Q=this.boxKeys[K];if(e<=G[W+2]&&r<=G[W+3]&&l>=G[W+0]&&h>=G[W+1]&&(!T||T(Q))&&(!C||!Ve(I,Q.overlapMode))&&(y.push({key:Q,x1:G[W],y1:G[W+1],x2:G[W+2],y2:G[W+3]}),C))return!0}}const O=this.circleCells[m];if(O!==null){const G=this.circles;for(const K of O)if(!A.circle[K]){A.circle[K]=!0;const W=3*K,Q=this.circleKeys[K];if(this._circleAndRectCollide(G[W],G[W+1],G[W+2],e,r,l,h)&&(!T||T(Q))&&(!C||!Ve(I,Q.overlapMode))){const ne=G[W],se=G[W+1],te=G[W+2];if(y.push({key:Q,x1:ne-te,y1:se-te,x2:ne+te,y2:se+te}),C)return!0}}}return!1}_queryCellCircle(e,r,l,h,m,y,w,T){const{circle:A,seenUids:C,overlapMode:I}=w,D=this.boxCells[m];if(D!==null){const G=this.bboxes;for(const K of D)if(!C.box[K]){C.box[K]=!0;const W=4*K,Q=this.boxKeys[K];if(this._circleAndRectCollide(A.x,A.y,A.radius,G[W+0],G[W+1],G[W+2],G[W+3])&&(!T||T(Q))&&!Ve(I,Q.overlapMode))return y.push(!0),!0}}const O=this.circleCells[m];if(O!==null){const G=this.circles;for(const K of O)if(!C.circle[K]){C.circle[K]=!0;const W=3*K,Q=this.circleKeys[K];if(this._circlesCollide(G[W],G[W+1],G[W+2],A.x,A.y,A.radius)&&(!T||T(Q))&&!Ve(I,Q.overlapMode))return y.push(!0),!0}}}_forEachCell(e,r,l,h,m,y,w,T){const A=this._convertToXCellCoord(e),C=this._convertToYCellCoord(r),I=this._convertToXCellCoord(l),D=this._convertToYCellCoord(h);for(let O=A;O<=I;O++)for(let G=C;G<=D;G++)if(m.call(this,e,r,l,h,this.xCellCount*G+O,y,w,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,r,l,h,m,y){const w=h-e,T=m-r,A=l+y;return A*A>w*w+T*T}_circleAndRectCollide(e,r,l,h,m,y,w){const T=(y-h)/2,A=Math.abs(e-(h+T));if(A>T+l)return!1;const C=(w-m)/2,I=Math.abs(r-(m+C));if(I>C+l)return!1;if(A<=T||I<=C)return!0;const D=A-T,O=I-C;return D*D+O*O<=l*l}}function fa(f,e,r){const l=d.M();if(!f){const{vecSouth:I,vecEast:D}=ci(e),O=Ae();O[0]=D[0],O[1]=D[1],O[2]=I[0],O[3]=I[1],h=O,(C=(y=(m=O)[0])*(A=m[3])-(T=m[2])*(w=m[1]))&&(h[0]=A*(C=1/C),h[1]=-w*C,h[2]=-T*C,h[3]=y*C),l[0]=O[0],l[1]=O[1],l[4]=O[2],l[5]=O[3]}var h,m,y,w,T,A,C;return d.O(l,l,[1/r,1/r,1]),l}function qa(f,e,r,l){if(f){const h=d.M();if(!e){const{vecSouth:m,vecEast:y}=ci(r);h[0]=y[0],h[1]=y[1],h[4]=m[0],h[5]=m[1]}return d.O(h,h,[l,l,1]),h}return r.pixelsToClipSpaceMatrix}function ci(f){const e=Math.cos(f.rollInRadians),r=Math.sin(f.rollInRadians),l=Math.cos(f.pitchInRadians),h=Math.cos(f.bearingInRadians),m=Math.sin(f.bearingInRadians),y=d.av();y[0]=-h*l*r-m*e,y[1]=-m*l*r+h*e;const w=d.aw(y);w<1e-9?d.ax(y):d.ay(y,y,1/w);const T=d.av();T[0]=h*l*e-m*r,T[1]=m*l*e+h*r;const A=d.aw(T);return A<1e-9?d.ax(T):d.ay(T,T,1/A),{vecEast:T,vecSouth:y}}function $e(f,e,r,l){let h;l?(h=[f,e,l(f,e),1],d.aA(h,h,r)):(h=[f,e,0,1],To(h,h,r));const m=h[3];return{point:new d.P(h[0]/m,h[1]/m),signedDistanceFromCamera:m,isOccluded:!1}}function It(f,e){return .5+f/e*.5}function Zt(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function Ar(f,e,r,l,h,m,y,w,T,A,C,I,D){const O=r?f.textSizeData:f.iconSizeData,G=d.ar(O,e.transform.zoom),K=[256/e.width*2+1,256/e.height*2+1],W=r?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;W.clear();const Q=f.lineVertexArray,ne=r?f.text.placedSymbolArray:f.icon.placedSymbolArray,se=e.transform.width/e.transform.height;let te=!1;for(let oe=0;oe<ne.length;oe++){const de=ne.get(oe);if(de.hidden||de.writingMode===d.as.vertical&&!te){Cr(de.numGlyphs,W);continue}te=!1;const ae=new d.P(de.anchorX,de.anchorY),fe={getElevation:D,pitchedLabelPlaneMatrix:l,lineVertexArray:Q,pitchWithMap:m,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ae,unwrappedTileID:T,width:A,height:C,translation:I},Pe=Gr(de.anchorX,de.anchorY,fe);if(!Zt(Pe.point,K)){Cr(de.numGlyphs,W);continue}const Se=It(e.transform.cameraToCenterDistance,Pe.signedDistanceFromCamera),Ce=d.at(O,G,de),Ie=m?Ce*e.transform.getPitchedTextCorrection(de.anchorX,de.anchorY,T)/Se:Ce*Se,Ke=Bt({projectionContext:fe,pitchedLabelPlaneMatrixInverse:h,symbol:de,fontSize:Ie,flip:!1,keepUpright:y,glyphOffsetArray:f.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:se,rotateToLine:w});te=Ke.useVertical,(Ke.notEnoughRoom||te||Ke.needsFlipping&&Bt({projectionContext:fe,pitchedLabelPlaneMatrixInverse:h,symbol:de,fontSize:Ie,flip:!0,keepUpright:y,glyphOffsetArray:f.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:se,rotateToLine:w}).notEnoughRoom)&&Cr(de.numGlyphs,W)}r?f.text.dynamicLayoutVertexBuffer.updateData(W):f.icon.dynamicLayoutVertexBuffer.updateData(W)}function Ul(f,e,r,l,h,m,y,w){const T=m.glyphStartIndex+m.numGlyphs,A=m.lineStartIndex,C=m.lineStartIndex+m.lineLength,I=e.getoffsetX(m.glyphStartIndex),D=e.getoffsetX(T-1),O=ia(f*I,r,l,h,m.segment,A,C,w,y);if(!O)return null;const G=ia(f*D,r,l,h,m.segment,A,C,w,y);return G?w.projectionCache.anyProjectionOccluded?null:{first:O,last:G}:null}function ls(f,e,r,l){return f===d.as.horizontal&&Math.abs(r.y-e.y)>Math.abs(r.x-e.x)*l?{useVertical:!0}:(f===d.as.vertical?e.y<r.y:e.x>r.x)?{needsFlipping:!0}:null}function Bt(f){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:r,symbol:l,fontSize:h,flip:m,keepUpright:y,glyphOffsetArray:w,dynamicLayoutVertexArray:T,aspectRatio:A,rotateToLine:C}=f,I=h/24,D=l.lineOffsetX*I,O=l.lineOffsetY*I;let G;if(l.numGlyphs>1){const K=l.glyphStartIndex+l.numGlyphs,W=l.lineStartIndex,Q=l.lineStartIndex+l.lineLength,ne=Ul(I,w,D,O,m,l,C,e);if(!ne)return{notEnoughRoom:!0};const se=lr(ne.first.point.x,ne.first.point.y,e,r),te=lr(ne.last.point.x,ne.last.point.y,e,r);if(y&&!m){const oe=ls(l.writingMode,se,te,A);if(oe)return oe}G=[ne.first];for(let oe=l.glyphStartIndex+1;oe<K-1;oe++){const de=ia(I*w.getoffsetX(oe),D,O,m,l.segment,W,Q,e,C);if(!de)return{notEnoughRoom:!0};G.push(de)}G.push(ne.last)}else{if(y&&!m){const W=wa(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,Q=l.lineStartIndex+l.segment+1,ne=new d.P(e.lineVertexArray.getx(Q),e.lineVertexArray.gety(Q)),se=wa(ne.x,ne.y,e),te=se.signedDistanceFromCamera>0?se.point:wo(e.tileAnchorPoint,ne,W,1,e),oe=lr(W.x,W.y,e,r),de=lr(te.x,te.y,e,r),ae=ls(l.writingMode,oe,de,A);if(ae)return ae}const K=ia(I*w.getoffsetX(l.glyphStartIndex),D,O,m,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,C);if(!K||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};G=[K]}for(const K of G)d.az(T,K.point,K.angle);return{}}function wo(f,e,r,l,h){const m=f.add(f.sub(e)._unit()),y=wa(m.x,m.y,h).point,w=r.sub(y);return r.add(w._mult(l/w.mag()))}function or(f,e,r){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const h=new d.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),m=wa(h.x,h.y,e);if(m.signedDistanceFromCamera>0)return l.projections[f]=m.point,l.anyProjectionOccluded=l.anyProjectionOccluded||m.isOccluded,m.point;const y=f-r.direction;return wo(r.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),h,r.previousVertex,r.absOffsetX-r.distanceFromAnchor+1,e)}function wa(f,e,r){const l=f+r.translation[0],h=e+r.translation[1];let m;return r.pitchWithMap?(m=$e(l,h,r.pitchedLabelPlaneMatrix,r.getElevation),m.isOccluded=!1):(m=r.transform.projectTileCoordinates(l,h,r.unwrappedTileID,r.getElevation),m.point.x=(.5*m.point.x+.5)*r.width,m.point.y=(.5*-m.point.y+.5)*r.height),m}function lr(f,e,r,l){if(r.pitchWithMap){const h=[f,e,0,1];return d.aA(h,h,l),r.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],r.unwrappedTileID,r.getElevation).point}return{x:f/r.width*2-1,y:1-e/r.height*2}}function Gr(f,e,r){return r.transform.projectTileCoordinates(f,e,r.unwrappedTileID,r.getElevation)}function en(f,e,r){return f._unit()._perp()._mult(e*r)}function Nl(f,e,r,l,h,m,y,w,T){if(w.projectionCache.offsets[f])return w.projectionCache.offsets[f];const A=r.add(e);if(f+T.direction<l||f+T.direction>=h)return w.projectionCache.offsets[f]=A,A;const C=or(f+T.direction,w,T),I=en(C.sub(r),y,T.direction),D=r.add(I),O=C.add(I);return w.projectionCache.offsets[f]=d.aB(m,A,D,O)||A,w.projectionCache.offsets[f]}function ia(f,e,r,l,h,m,y,w,T){const A=l?f-e:f+e;let C=A>0?1:-1,I=0;l&&(C*=-1,I=Math.PI),C<0&&(I+=Math.PI);let D,O=C>0?m+h:m+h+1;w.projectionCache.cachedAnchorPoint?D=w.projectionCache.cachedAnchorPoint:(D=wa(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=D);let G,K,W=D,Q=D,ne=0,se=0;const te=Math.abs(A),oe=[];let de;for(;ne+se<=te;){if(O+=C,O<m||O>=y)return null;ne+=se,Q=W,K=G;const Pe={absOffsetX:te,direction:C,distanceFromAnchor:ne,previousVertex:Q};if(W=or(O,w,Pe),r===0)oe.push(Q),de=W.sub(Q);else{let Se;const Ce=W.sub(Q);Se=Ce.mag()===0?en(or(O+C,w,Pe).sub(W),r,C):en(Ce,r,C),K||(K=Q.add(Se)),G=Nl(O,Se,W,m,y,K,r,w,Pe),oe.push(K),de=G.sub(K)}se=de.mag()}const ae=de._mult((te-ne)/se)._add(K||Q),fe=I+Math.atan2(W.y-Q.y,W.x-Q.x);return oe.push(ae),{point:ae,angle:T?fe:0,path:oe}}const yi=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Cr(f,e){for(let r=0;r<f;r++){const l=e.length;e.resize(l+4),e.float32.set(yi,3*l)}}function To(f,e,r){const l=e[0],h=e[1];return f[0]=r[0]*l+r[4]*h+r[12],f[1]=r[1]*l+r[5]*h+r[13],f[3]=r[3]*l+r[7]*h+r[15],f}const xn=100;class Xs{constructor(e,r=new cn(e.width+200,e.height+200,25),l=new cn(e.width+200,e.height+200,25)){this.transform=e,this.grid=r,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+xn,this.screenBottomBoundary=e.height+xn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,r,l,h,m,y,w,T,A,C,I,D){const O=this.projectAndGetPerspectiveRatio(e.anchorPointX+T[0],e.anchorPointY+T[1],m,C,D),G=l*O.perspectiveRatio;let K;if(y||w)K=this._projectCollisionBox(e,G,h,m,y,w,T,O,C,I,D);else{const de=O.x+(I?I.x*G:0),ae=O.y+(I?I.y*G:0);K={allPointsOccluded:!1,box:[de+e.x1*G,ae+e.y1*G,de+e.x2*G,ae+e.y2*G]}}const[W,Q,ne,se]=K.box,te=y?K.allPointsOccluded:O.isOccluded;let oe=te;return oe||(oe=O.perspectiveRatio<this.perspectiveRatioCutoff),oe||(oe=!this.isInsideGrid(W,Q,ne,se)),oe||r!=="always"&&this.grid.hitTest(W,Q,ne,se,r,A)?{box:[W,Q,ne,se],placeable:!1,offscreen:!1,occluded:te}:{box:[W,Q,ne,se],placeable:!0,offscreen:this.isOffscreen(W,Q,ne,se),occluded:te}}placeCollisionCircles(e,r,l,h,m,y,w,T,A,C,I,D,O,G){const K=[],W=new d.P(r.anchorX,r.anchorY),Q=this.getPerspectiveRatio(W.x,W.y,y,G),ne=(A?m*this.transform.getPitchedTextCorrection(r.anchorX,r.anchorY,y)/Q:m*Q)/d.aF,se={getElevation:G,pitchedLabelPlaneMatrix:w,lineVertexArray:l,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:W,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:O},te=Ul(ne,h,r.lineOffsetX*ne,r.lineOffsetY*ne,!1,r,!1,se);let oe=!1,de=!1,ae=!0;if(te){const fe=.5*I*Q+D,Pe=new d.P(-100,-100),Se=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Ce=new vn,Ie=te.first,Ke=te.last;let We=[];for(let Lt=Ie.path.length-1;Lt>=1;Lt--)We.push(Ie.path[Lt]);for(let Lt=1;Lt<Ke.path.length;Lt++)We.push(Ke.path[Lt]);const Fe=2.5*fe;if(A){const Lt=this.projectPathToScreenSpace(We,se);We=Lt.some(ui=>ui.signedDistanceFromCamera<=0)?[]:Lt.map(ui=>ui.point)}let lt=[];if(We.length>0){const Lt=We[0].clone(),ui=We[0].clone();for(let Vt=1;Vt<We.length;Vt++)Lt.x=Math.min(Lt.x,We[Vt].x),Lt.y=Math.min(Lt.y,We[Vt].y),ui.x=Math.max(ui.x,We[Vt].x),ui.y=Math.max(ui.y,We[Vt].y);lt=Lt.x>=Pe.x&&ui.x<=Se.x&&Lt.y>=Pe.y&&ui.y<=Se.y?[We]:ui.x<Pe.x||Lt.x>Se.x||ui.y<Pe.y||Lt.y>Se.y?[]:d.aC([We],Pe.x,Pe.y,Se.x,Se.y)}for(const Lt of lt){Ce.reset(Lt,.25*fe);let ui=0;ui=Ce.length<=.5*fe?1:Math.ceil(Ce.paddedLength/Fe)+1;for(let Vt=0;Vt<ui;Vt++){const Si=Vt/Math.max(ui-1,1),Wi=Ce.lerp(Si),Di=Wi.x+xn,Tn=Wi.y+xn;K.push(Di,Tn,fe,0);const Zi=Di-fe,In=Tn-fe,qi=Di+fe,mn=Tn+fe;if(ae=ae&&this.isOffscreen(Zi,In,qi,mn),de=de||this.isInsideGrid(Zi,In,qi,mn),e!=="always"&&this.grid.hitTestCircle(Di,Tn,fe,e,C)&&(oe=!0,!T))return{circles:[],offscreen:!1,collisionDetected:oe}}}}return{circles:!T&&oe||!de||Q<this.perspectiveRatioCutoff?[]:K,offscreen:ae,collisionDetected:oe}}projectPathToScreenSpace(e,r){const l=function(h,m){const y=d.M();return d.au(y,m.pitchedLabelPlaneMatrix),h.map(w=>{const T=$e(w.x,w.y,y,m.getElevation),A=m.transform.projectTileCoordinates(T.point.x,T.point.y,m.unwrappedTileID,m.getElevation);return A.point.x=(.5*A.point.x+.5)*m.width,A.point.y=(.5*-A.point.y+.5)*m.height,A})}(e,r);return function(h){let m=0,y=0,w=0,T=0;for(let A=0;A<h.length;A++)h[A].isOccluded?(w=A+1,T=0):(T++,T>y&&(y=T,m=w));return h.slice(m,m+y)}(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[],l=new d.a6;for(const I of e){const D=new d.P(I.x+xn,I.y+xn);l.extend(D),r.push(D)}const{minX:h,minY:m,maxX:y,maxY:w}=l,T=this.grid.query(h,m,y,w).concat(this.ignoredGrid.query(h,m,y,w)),A={},C={};for(const I of T){const D=I.key;if(A[D.bucketInstanceId]===void 0&&(A[D.bucketInstanceId]={}),A[D.bucketInstanceId][D.featureIndex])continue;const O=[new d.P(I.x1,I.y1),new d.P(I.x2,I.y1),new d.P(I.x2,I.y2),new d.P(I.x1,I.y2)];d.aD(r,O)&&(A[D.bucketInstanceId][D.featureIndex]=!0,C[D.bucketInstanceId]===void 0&&(C[D.bucketInstanceId]=[]),C[D.bucketInstanceId].push(D.featureIndex))}return C}insertCollisionBox(e,r,l,h,m,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:y,overlapMode:r},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,r,l,h,m,y){const w=l?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:m,collisionGroupID:y,overlapMode:r};for(let A=0;A<e.length;A+=4)w.insertCircle(T,e[A],e[A+1],e[A+2])}projectAndGetPerspectiveRatio(e,r,l,h,m){if(m){let y;h?(y=[e,r,h(e,r),1],d.aA(y,y,m)):(y=[e,r,0,1],To(y,y,m));const w=y[3];return{x:(y[0]/w+1)/2*this.transform.width+xn,y:(-y[1]/w+1)/2*this.transform.height+xn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{const y=this.transform.projectTileCoordinates(e,r,l,h);return{x:(y.point.x+1)/2*this.transform.width+xn,y:(1-y.point.y)/2*this.transform.height+xn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(e,r,l,h){const m=this.transform.projectTileCoordinates(e,r,l,h);return .5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5}isOffscreen(e,r,l,h){return l<xn||e>=this.screenRightBoundary||h<xn||r>this.screenBottomBoundary}isInsideGrid(e,r,l,h){return l>=0&&e<this.gridRightBoundary&&h>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const e=d.am([]);return d.N(e,e,[-100,-100,0]),e}_projectCollisionBox(e,r,l,h,m,y,w,T,A,C,I){let D=1,O=0,G=0,K=1;const W=e.anchorPointX+w[0],Q=e.anchorPointY+w[1];if(y&&!m){const We=this.projectAndGetPerspectiveRatio(W+1,Q,h,A,I),Fe=We.x-T.x,lt=Math.atan((We.y-T.y)/Fe)+(Fe<0?Math.PI:0),Lt=Math.sin(lt),ui=Math.cos(lt);D=ui,O=Lt,G=-Lt,K=ui}else if(!y&&m){const We=ci(this.transform);D=We.vecEast[0],O=We.vecEast[1],G=We.vecSouth[0],K=We.vecSouth[1]}let ne=T.x,se=T.y,te=r;m&&(ne=W,se=Q,te=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),te*=this.transform.getPitchedTextCorrection(W,Q,h),C||(te*=d.ai(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),C&&(ne+=D*C.x*te+G*C.y*te,se+=O*C.x*te+K*C.y*te);const oe=e.x1*te,de=e.x2*te,ae=(oe+de)/2,fe=e.y1*te,Pe=e.y2*te,Se=(fe+Pe)/2,Ce=[{offsetX:oe,offsetY:fe},{offsetX:ae,offsetY:fe},{offsetX:de,offsetY:fe},{offsetX:de,offsetY:Se},{offsetX:de,offsetY:Pe},{offsetX:ae,offsetY:Pe},{offsetX:oe,offsetY:Pe},{offsetX:oe,offsetY:Se}];let Ie=[];for(const{offsetX:We,offsetY:Fe}of Ce)Ie.push(new d.P(ne+D*We+G*Fe,se+O*We+K*Fe));let Ke=!1;if(m){const We=Ie.map(Fe=>this.projectAndGetPerspectiveRatio(Fe.x,Fe.y,h,A,I));Ke=We.some(Fe=>!Fe.isOccluded),Ie=We.map(Fe=>new d.P(Fe.x,Fe.y))}else Ke=!0;return{box:d.aE(Ie),allPointsOccluded:!Ke}}}class cs{constructor(e,r,l,h){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?r:-r))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class us{constructor(e,r,l,h,m){this.text=new cs(e?e.text:null,r,l,m),this.icon=new cs(e?e.icon:null,r,h,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ul{constructor(e,r,l){this.text=e,this.icon=r,this.skipFade=l}}class Zr{constructor(e,r,l,h,m){this.bucketInstanceId=e,this.featureIndex=r,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=m}}class na{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const r=++this.maxGroupID;this.collisionGroups[e]={ID:r,predicate:l=>l.collisionGroupID===r}}return this.collisionGroups[e]}}function Uc(f,e,r,l,h){const{horizontalAlign:m,verticalAlign:y}=d.aL(f);return new d.P(-(m-.5)*e+l[0]*h,-(y-.5)*r+l[1]*h)}class Vd{constructor(e,r,l,h,m){this.transform=e.clone(),this.terrain=r,this.collisionIndex=new Xs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new na(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const r=this.terrain;return r?(l,h)=>r.getElevation(e,l,h):null}getBucketParts(e,r,l,h){const m=l.getBucket(r),y=l.latestFeatureIndex;if(!m||!y||r.id!==m.layerIds[0])return;const w=l.collisionBoxArray,T=m.layers[0].layout,A=m.layers[0].paint,C=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),I=l.tileSize/d.a3,D=l.tileID.toUnwrapped(),O=T.get("text-rotation-alignment")==="map",G=d.aG(l,1,this.transform.zoom),K=d.aH(this.collisionIndex.transform,l,A.get("text-translate"),A.get("text-translate-anchor")),W=d.aH(this.collisionIndex.transform,l,A.get("icon-translate"),A.get("icon-translate-anchor")),Q=fa(O,this.transform,G);this.retainedQueryData[m.bucketInstanceId]=new Zr(m.bucketInstanceId,y,m.sourceLayerIndex,m.index,l.tileID);const ne={bucket:m,layout:T,translationText:K,translationIcon:W,unwrappedTileID:D,pitchedLabelPlaneMatrix:Q,scale:C,textPixelRatio:I,holdingForFade:l.holdingForSymbolFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:d.ar(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(h)for(const se of m.sortKeyRanges){const{sortKey:te,symbolInstanceStart:oe,symbolInstanceEnd:de}=se;e.push({sortKey:te,symbolInstanceStart:oe,symbolInstanceEnd:de,parameters:ne})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:ne})}attemptAnchorPlacement(e,r,l,h,m,y,w,T,A,C,I,D,O,G,K,W,Q,ne,se,te){const oe=d.aI[e.textAnchor],de=[e.textOffset0,e.textOffset1],ae=Uc(oe,l,h,de,m),fe=this.collisionIndex.placeCollisionBox(r,D,T,A,C,w,y,W,I.predicate,se,ae,te);if((!ne||this.collisionIndex.placeCollisionBox(ne,D,T,A,C,w,y,Q,I.predicate,se,ae,te).placeable)&&fe.placeable){let Pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(Pe=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:de,width:l,height:h,anchor:oe,textBoxScale:m,prevAnchor:Pe},this.markUsedJustification(G,oe,O,K),G.allowVerticalPlacement&&(this.markUsedOrientation(G,K,O),this.placedOrientations[O.crossTileID]=K),{shift:ae,placedGlyphBoxes:fe}}}placeLayerBucketPart(e,r,l){const{bucket:h,layout:m,translationText:y,translationIcon:w,unwrappedTileID:T,pitchedLabelPlaneMatrix:A,textPixelRatio:C,holdingForFade:I,collisionBoxArray:D,partiallyEvaluatedTextSize:O,collisionGroup:G}=e.parameters,K=m.get("text-optional"),W=m.get("icon-optional"),Q=d.aJ(m,"text-overlap","text-allow-overlap"),ne=Q==="always",se=d.aJ(m,"icon-overlap","icon-allow-overlap"),te=se==="always",oe=m.get("text-rotation-alignment")==="map",de=m.get("text-pitch-alignment")==="map",ae=m.get("icon-text-fit")!=="none",fe=m.get("symbol-z-order")==="viewport-y",Pe=ne&&(te||!h.hasIconData()||W),Se=te&&(ne||!h.hasTextData()||K);!h.collisionArrays&&D&&h.deserializeCollisionBoxes(D);const Ce=this.retainedQueryData[h.bucketInstanceId].tileID,Ie=this._getTerrainElevationFunc(Ce),Ke=this.transform.getFastPathSimpleProjectionMatrix(Ce),We=(Fe,lt,Lt)=>{var ui,Vt;if(r[Fe.crossTileID])return;if(I)return void(this.placements[Fe.crossTileID]=new ul(!1,!1,!1));let Si=!1,Wi=!1,Di=!0,Tn=null,Zi={box:null,placeable:!1,offscreen:null,occluded:!1},In={placeable:!1},qi=null,mn=null,ca=null,uo=0,ns=0,as=0;lt.textFeatureIndex?uo=lt.textFeatureIndex:Fe.useRuntimeCollisionCircles&&(uo=Fe.featureIndex),lt.verticalTextFeatureIndex&&(ns=lt.verticalTextFeatureIndex);const Is=lt.textBox;if(Is){const ya=gn=>{let Hi=d.as.horizontal;if(h.allowVerticalPlacement&&!gn&&this.prevPlacement){const Rn=this.prevPlacement.placedOrientations[Fe.crossTileID];Rn&&(this.placedOrientations[Fe.crossTileID]=Rn,Hi=Rn,this.markUsedOrientation(h,Hi,Fe))}return Hi},rs=(gn,Hi)=>{if(h.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&lt.verticalTextBox){for(const Rn of h.writingModes)if(Rn===d.as.vertical?(Zi=Hi(),In=Zi):Zi=gn(),Zi&&Zi.placeable)break}else Zi=gn()},fo=Fe.textAnchorOffsetStartIndex,_c=Fe.textAnchorOffsetEndIndex;if(_c===fo){const gn=(Hi,Rn)=>{const Mi=this.collisionIndex.placeCollisionBox(Hi,Q,C,Ce,T,de,oe,y,G.predicate,Ie,void 0,Ke);return Mi&&Mi.placeable&&(this.markUsedOrientation(h,Rn,Fe),this.placedOrientations[Fe.crossTileID]=Rn),Mi};rs(()=>gn(Is,d.as.horizontal),()=>{const Hi=lt.verticalTextBox;return h.allowVerticalPlacement&&Fe.numVerticalGlyphVertices>0&&Hi?gn(Hi,d.as.vertical):{box:null,offscreen:null}}),ya(Zi&&Zi.placeable)}else{let gn=d.aI[(Vt=(ui=this.prevPlacement)===null||ui===void 0?void 0:ui.variableOffsets[Fe.crossTileID])===null||Vt===void 0?void 0:Vt.anchor];const Hi=(Mi,vr,Rs)=>{const zl=Mi.x2-Mi.x1,dh=Mi.y2-Mi.y1,yu=Fe.textBoxScale,po=ae&&se==="never"?vr:null;let Ls=null,yc=Q==="never"?1:2,vc="never";gn&&yc++;for(let vu=0;vu<yc;vu++){for(let Pa=fo;Pa<_c;Pa++){const ks=h.textAnchorOffsets.get(Pa);if(gn&&ks.textAnchor!==gn)continue;const xc=this.attemptAnchorPlacement(ks,Mi,zl,dh,yu,oe,de,C,Ce,T,G,vc,Fe,h,Rs,y,w,po,Ie);if(xc&&(Ls=xc.placedGlyphBoxes,Ls&&Ls.placeable))return Si=!0,Tn=xc.shift,Ls}gn?gn=null:vc=Q}return l&&!Ls&&(Ls={box:this.collisionIndex.placeCollisionBox(Is,"always",C,Ce,T,de,oe,y,G.predicate,Ie,void 0,Ke).box,offscreen:!1,placeable:!1,occluded:!1}),Ls};rs(()=>Hi(Is,lt.iconBox,d.as.horizontal),()=>{const Mi=lt.verticalTextBox;return h.allowVerticalPlacement&&(!Zi||!Zi.placeable)&&Fe.numVerticalGlyphVertices>0&&Mi?Hi(Mi,lt.verticalIconBox,d.as.vertical):{box:null,occluded:!0,offscreen:null}}),Zi&&(Si=Zi.placeable,Di=Zi.offscreen);const Rn=ya(Zi&&Zi.placeable);if(!Si&&this.prevPlacement){const Mi=this.prevPlacement.variableOffsets[Fe.crossTileID];Mi&&(this.variableOffsets[Fe.crossTileID]=Mi,this.markUsedJustification(h,Mi.anchor,Fe,Rn))}}}if(qi=Zi,Si=qi&&qi.placeable,Di=qi&&qi.offscreen,Fe.useRuntimeCollisionCircles&&Fe.centerJustifiedTextSymbolIndex>=0){const ya=h.text.placedSymbolArray.get(Fe.centerJustifiedTextSymbolIndex),rs=d.at(h.textSizeData,O,ya),fo=m.get("text-padding");mn=this.collisionIndex.placeCollisionCircles(Q,ya,h.lineVertexArray,h.glyphOffsetArray,rs,T,A,l,de,G.predicate,Fe.collisionCircleDiameter,fo,y,Ie),mn.circles.length&&mn.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),Si=ne||mn.circles.length>0&&!mn.collisionDetected,Di=Di&&mn.offscreen}if(lt.iconFeatureIndex&&(as=lt.iconFeatureIndex),lt.iconBox){const ya=rs=>this.collisionIndex.placeCollisionBox(rs,se,C,Ce,T,de,oe,w,G.predicate,Ie,ae&&Tn?Tn:void 0,Ke);In&&In.placeable&&lt.verticalIconBox?(ca=ya(lt.verticalIconBox),Wi=ca.placeable):(ca=ya(lt.iconBox),Wi=ca.placeable),Di=Di&&ca.offscreen}const Wo=K||Fe.numHorizontalGlyphVertices===0&&Fe.numVerticalGlyphVertices===0,ho=W||Fe.numIconVertices===0;Wo||ho?ho?Wo||(Wi=Wi&&Si):Si=Wi&&Si:Wi=Si=Wi&&Si;const _a=Wi&&ca.placeable;if(Si&&qi.placeable&&this.collisionIndex.insertCollisionBox(qi.box,Q,m.get("text-ignore-placement"),h.bucketInstanceId,In&&In.placeable&&ns?ns:uo,G.ID),_a&&this.collisionIndex.insertCollisionBox(ca.box,se,m.get("icon-ignore-placement"),h.bucketInstanceId,as,G.ID),mn&&Si&&this.collisionIndex.insertCollisionCircles(mn.circles,Q,m.get("text-ignore-placement"),h.bucketInstanceId,uo,G.ID),l&&this.storeCollisionData(h.bucketInstanceId,Lt,lt,qi,ca,mn),Fe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Fe.crossTileID]=new ul((Si||Pe)&&!qi?.occluded,(Wi||Se)&&!ca?.occluded,Di||h.justReloaded),r[Fe.crossTileID]=!0};if(fe){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Fe=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let lt=Fe.length-1;lt>=0;--lt){const Lt=Fe[lt];We(h.symbolInstances.get(Lt),h.collisionArrays[Lt],Lt)}}else for(let Fe=e.symbolInstanceStart;Fe<e.symbolInstanceEnd;Fe++)We(h.symbolInstances.get(Fe),h.collisionArrays[Fe],Fe);h.justReloaded=!1}storeCollisionData(e,r,l,h,m,y){if(l.textBox||l.iconBox){let w,T;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(r)?T=w.get(r):(T={text:null,icon:null},w.set(r,T)),l.textBox&&(T.text=h.box),l.iconBox&&(T.icon=m.box)}if(y){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=[]);for(let T=0;T<y.circles.length;T+=4)w.push(y.circles[T+0]-xn),w.push(y.circles[T+1]-xn),w.push(y.circles[T+2]),w.push(y.collisionDetected?1:0)}}markUsedJustification(e,r,l,h){let m;m=h===d.as.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.aK(r)];const y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of y)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=m>=0&&w!==m?0:l.crossTileID)}markUsedOrientation(e,r,l){const h=r===d.as.horizontal||r===d.as.horizontalOnly?r:0,m=r===d.as.vertical?r:0,y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of y)e.text.placedSymbolArray.get(w).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let l=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const h=r?r.symbolFadeChange(e):1,m=r?r.opacities:{},y=r?r.variableOffsets:{},w=r?r.placedOrientations:{};for(const T in this.placements){const A=this.placements[T],C=m[T];C?(this.opacities[T]=new us(C,h,A.text,A.icon),l=l||A.text!==C.text.placed||A.icon!==C.icon.placed):(this.opacities[T]=new us(null,h,A.text,A.icon,A.skipFade),l=l||A.text||A.icon)}for(const T in m){const A=m[T];if(!this.opacities[T]){const C=new us(A,h,!1,!1);C.isHidden()||(this.opacities[T]=C,l=l||A.text.placed||A.icon.placed)}}for(const T in y)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=y[T]);for(const T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);if(r&&r.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:e)}updateLayerOpacities(e,r){const l={};for(const h of r){const m=h.getBucket(e);m&&h.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(e,r,l,h){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const m=e.layers[0],y=m.layout,w=new us(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),A=y.get("icon-allow-overlap"),C=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),I=y.get("text-rotation-alignment")==="map",D=y.get("text-pitch-alignment")==="map",O=y.get("icon-text-fit")!=="none",G=new us(null,0,T&&(A||!e.hasIconData()||y.get("icon-optional")),A&&(T||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&h&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(h);const K=(Q,ne,se)=>{for(let te=0;te<ne/4;te++)Q.opacityVertexArray.emplaceBack(se);Q.hasVisibleVertices=Q.hasVisibleVertices||se!==hl},W=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Q=0;Q<e.symbolInstances.length;Q++){const ne=e.symbolInstances.get(Q),{numHorizontalGlyphVertices:se,numVerticalGlyphVertices:te,crossTileID:oe}=ne;let de=this.opacities[oe];l[oe]?de=w:de||(de=G,this.opacities[oe]=de),l[oe]=!0;const ae=ne.numIconVertices>0,fe=this.placedOrientations[ne.crossTileID],Pe=fe===d.as.vertical,Se=fe===d.as.horizontal||fe===d.as.horizontalOnly;if(se>0||te>0){const Ie=hs(de.text);K(e.text,se,Pe?hl:Ie),K(e.text,te,Se?hl:Ie);const Ke=de.text.isHidden();[ne.rightJustifiedTextSymbolIndex,ne.centerJustifiedTextSymbolIndex,ne.leftJustifiedTextSymbolIndex].forEach(lt=>{lt>=0&&(e.text.placedSymbolArray.get(lt).hidden=Ke||Pe?1:0)}),ne.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ne.verticalPlacedTextSymbolIndex).hidden=Ke||Se?1:0);const We=this.variableOffsets[ne.crossTileID];We&&this.markUsedJustification(e,We.anchor,ne,fe);const Fe=this.placedOrientations[ne.crossTileID];Fe&&(this.markUsedJustification(e,"left",ne,Fe),this.markUsedOrientation(e,Fe,ne))}if(ae){const Ie=hs(de.icon),Ke=!(O&&ne.verticalPlacedIconSymbolIndex&&Pe);ne.placedIconSymbolIndex>=0&&(K(e.icon,ne.numIconVertices,Ke?Ie:hl),e.icon.placedSymbolArray.get(ne.placedIconSymbolIndex).hidden=de.icon.isHidden()),ne.verticalPlacedIconSymbolIndex>=0&&(K(e.icon,ne.numVerticalIconVertices,Ke?hl:Ie),e.icon.placedSymbolArray.get(ne.verticalPlacedIconSymbolIndex).hidden=de.icon.isHidden())}const Ce=W&&W.has(Q)?W.get(Q):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Ie=e.collisionArrays[Q];if(Ie){let Ke=new d.P(0,0);if(Ie.textBox||Ie.verticalTextBox){let We=!0;if(C){const Fe=this.variableOffsets[oe];Fe?(Ke=Uc(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textBoxScale),I&&Ke._rotate(D?-this.transform.bearingInRadians:this.transform.bearingInRadians)):We=!1}if(Ie.textBox||Ie.verticalTextBox){let Fe;Ie.textBox&&(Fe=Pe),Ie.verticalTextBox&&(Fe=Se),Nc(e.textCollisionBox.collisionVertexArray,de.text.placed,!We||Fe,Ce.text,Ke.x,Ke.y)}}if(Ie.iconBox||Ie.verticalIconBox){const We=!!(!Se&&Ie.verticalIconBox);let Fe;Ie.iconBox&&(Fe=We),Ie.verticalIconBox&&(Fe=!We),Nc(e.iconCollisionBox.collisionVertexArray,de.icon.placed,Fe,Ce.icon,O?Ke.x:0,O?Ke.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,r){const l=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function Nc(f,e,r,l,h,m){l&&l.length!==0||(l=[0,0,0,0]);const y=l[0]-xn,w=l[1]-xn,T=l[2]-xn,A=l[3]-xn;f.emplaceBack(e?1:0,r?1:0,h||0,m||0,y,w),f.emplaceBack(e?1:0,r?1:0,h||0,m||0,T,w),f.emplaceBack(e?1:0,r?1:0,h||0,m||0,T,A),f.emplaceBack(e?1:0,r?1:0,h||0,m||0,y,A)}const Nh=Math.pow(2,25),Vl=Math.pow(2,24),Vh=Math.pow(2,17),ka=Math.pow(2,16),Gl=Math.pow(2,9),Nu=Math.pow(2,8),Zl=Math.pow(2,1);function hs(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,r=Math.floor(127*f.opacity);return r*Nh+e*Vl+r*Vh+e*ka+r*Gl+e*Nu+r*Zl+e}const hl=0;class dl{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,r,l,h,m){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(r.getBucketParts(y,h,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((w,T)=>w.sortKey-T.sortKey));this._currentPartIndex<y.length;)if(r.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,m())return!0;return!1}}class ds{constructor(e,r,l,h,m,y,w,T){this.placement=new Vd(e,r,y,w,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,r,l){const h=mt(),m=()=>!this._forceFullPlacement&&mt()-h>2;for(;this._currentPlacementIndex>=0;){const y=r[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=w)&&(!y.maxzoom||y.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new dl(y)),this._inProgressLayer.continuePlacement(l[y.source],this.placement,this._showCollisionBoxes,y,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const fl=512/d.a3/2;class So{constructor(e,r,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let m=0;m<r.length;m++){const y=r.get(m),w=y.key,T=h.get(w);T?T.push(y):h.set(w,[y])}for(const[m,y]of h){const w={positions:y.map(T=>({x:Math.floor(T.anchorX*fl),y:Math.floor(T.anchorY*fl)})),crossTileIDs:y.map(T=>T.crossTileID)};if(w.positions.length>128){const T=new d.aM(w.positions.length,16,Uint16Array);for(const{x:A,y:C}of w.positions)T.add(A,C);T.finish(),delete w.positions,w.index=T}this._symbolsByKey[m]=w}}getScaledCoordinates(e,r){const{x:l,y:h,z:m}=this.tileID.canonical,{x:y,y:w,z:T}=r.canonical,A=fl/Math.pow(2,T-m),C=(w*d.a3+e.anchorY)*A,I=h*d.a3*fl;return{x:Math.floor((y*d.a3+e.anchorX)*A-l*d.a3*fl),y:Math.floor(C-I)}}findMatches(e,r,l){const h=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z);for(let m=0;m<e.length;m++){const y=e.get(m);if(y.crossTileID)continue;const w=this._symbolsByKey[y.key];if(!w)continue;const T=this.getScaledCoordinates(y,r);if(w.index){const A=w.index.range(T.x-h,T.y-h,T.x+h,T.y+h).sort();for(const C of A){const I=w.crossTileIDs[C];if(!l[I]){l[I]=!0,y.crossTileID=I;break}}}else if(w.positions)for(let A=0;A<w.positions.length;A++){const C=w.positions[A],I=w.crossTileIDs[A];if(Math.abs(C.x-T.x)<=h&&Math.abs(C.y-T.y)<=h&&!l[I]){l[I]=!0,y.crossTileID=I;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Vu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const r=Math.round((e-this.lng)/360);if(r!==0)for(const l in this.indexes){const h=this.indexes[l],m={};for(const y in h){const w=h[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+r),m[w.tileID.key]=w}this.indexes[l]=m}this.lng=e}addBucket(e,r,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<r.symbolInstances.length;m++)r.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const h=this.usedCrossTileIDs[e.overscaledZ];for(const m in this.indexes){const y=this.indexes[m];if(Number(m)>e.overscaledZ)for(const w in y){const T=y[w];T.tileID.isChildOf(e)&&T.findMatches(r.symbolInstances,e,h)}else{const w=y[e.scaledTo(Number(m)).key];w&&w.findMatches(r.symbolInstances,e,h)}}for(let m=0;m<r.symbolInstances.length;m++){const y=r.symbolInstances.get(m);y.crossTileID||(y.crossTileID=l.generate(),h[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new So(e,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(e,r){for(const l of r.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[e][h]}removeStaleBuckets(e){let r=!1;for(const l in this.indexes){const h=this.indexes[l];for(const m in h)e[h[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[m]),delete h[m],r=!0)}return r}}class fs{constructor(){this.layerIndexes={},this.crossTileIDs=new Vu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,r,l){let h=this.layerIndexes[e.id];h===void 0&&(h=this.layerIndexes[e.id]=new Gu);let m=!1;const y={};h.handleWrapJump(l);for(const w of r){const T=w.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(w.tileID,T,this.crossTileIDs)&&(m=!0),y[T.bucketInstanceId]=!0)}return h.removeStaleBuckets(y)&&(m=!0),m}pruneUnusedLayers(e){const r={};e.forEach(l=>{r[l]=!0});for(const l in this.layerIndexes)r[l]||delete this.layerIndexes[l]}}var Mo="void main() {fragColor=vec4(1.0);}";const Dt={prelude:Ft(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Ft("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Ft("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Ft(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Ft(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ft(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ft(Mo,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Ft(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Ft(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ft("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ft("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Ft(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Ft("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Ft(Mo,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Ft(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Ft(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Ft(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Ft(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ft(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ft(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ft(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ft(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Ft(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ft(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ft(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ft(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Ft(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Ft(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Ft(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ft(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ft(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ft("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ft("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ft("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Ft("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Ft(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Ft("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ft(f,e){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),h=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=m?m.concat(h):h,w={};return{fragmentSource:f=f.replace(r,(T,A,C,I,D)=>(w[D]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${D}
in ${C} ${I} ${D};
#else
uniform ${C} ${I} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${C} ${I} ${D} = u_${D};
#endif
`)),vertexSource:e=e.replace(r,(T,A,C,I,D)=>{const O=I==="float"?"vec2":"vec4",G=D.match(/color/)?"color":O;return w[D]?A==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${C} ${O} a_${D};
out ${C} ${I} ${D};
#else
uniform ${C} ${I} u_${D};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${C} ${I} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${G}(a_${D}, u_${D}_t);
#else
    ${C} ${I} ${D} = u_${D};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
in ${C} ${O} a_${D};
#else
uniform ${C} ${I} u_${D};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${C} ${I} ${D} = a_${D};
#else
    ${C} ${I} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${C} ${I} ${D} = unpack_mix_${G}(a_${D}, u_${D}_t);
#else
    ${C} ${I} ${D} = u_${D};
#endif
`}),staticAttributes:l,staticUniforms:y}}class Ys{constructor(e,r,l){this.vertexBuffer=e,this.indexBuffer=r,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var cr=d.aN([{name:"a_pos",type:"Int16",components:2}]);const jn="#define PROJECTION_MERCATOR",bn="mercator";class Zn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return bn}get shaderDefine(){return jn}get shaderPreludeCode(){return Dt.projectionMercator}get vertexShaderPreludeCode(){return Dt.projectionMercator.vertexSource}get subdivisionGranularity(){return d.aO.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,r,l,h,m){if(this._cachedMesh)return this._cachedMesh;const y=new d.aP;y.emplaceBack(0,0),y.emplaceBack(d.a3,0),y.emplaceBack(0,d.a3),y.emplaceBack(d.a3,d.a3);const w=e.createVertexBuffer(y,cr.members),T=d.aQ.simpleSegment(0,0,4,2),A=new d.aR;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3);const C=e.createIndexBuffer(A);return this._cachedMesh=new Ys(w,C,T),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class un{constructor(e=0,r=0,l=0,h=0){if(isNaN(e)||e<0||isNaN(r)||r<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=r,this.left=l,this.right=h}interpolate(e,r,l){return r.top!=null&&e.top!=null&&(this.top=d.F.number(e.top,r.top,l)),r.bottom!=null&&e.bottom!=null&&(this.bottom=d.F.number(e.bottom,r.bottom,l)),r.left!=null&&e.left!=null&&(this.left=d.F.number(e.left,r.left,l)),r.right!=null&&e.right!=null&&(this.right=d.F.number(e.right,r.right,l)),this}getCenter(e,r){const l=d.ai((this.left+e-this.right)/2,0,e),h=d.ai((this.top+r-this.bottom)/2,0,r);return new d.P(l,h)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new un(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Bi(f,e){if(!f.renderWorldCopies||f.lngRange)return;const r=e.lng-f.center.lng;e.lng+=r>180?-360:r<-180?360:0}function pl(f){return Math.max(0,Math.floor(f))}class tn{constructor(e,r){var l;this._callbacks=e,this._tileSize=512,this._renderWorldCopies=r?.renderWorldCopies===void 0||!!r?.renderWorldCopies,this._minZoom=r?.minZoom||0,this._maxZoom=r?.maxZoom||22,this._minPitch=r?.minPitch==null?0:r?.minPitch,this._maxPitch=r?.maxPitch==null?60:r?.maxPitch,this._constrain=(l=r?.constrain)!==null&&l!==void 0?l:this._callbacks.constrain,this.setMaxBounds(),this._width=0,this._height=0,this._center=new d.U(0,0),this._elevation=0,this._zoom=0,this._tileZoom=pl(this._zoom),this._scale=d.al(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new un,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,r,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=pl(this._zoom),this._scale=d.al(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new un(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,r&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.constrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.constrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get constrain(){return this._constrain}setConstrain(e){e||(e=this._callbacks.constrain),this._constrain=e,this.constrainInternal(),this._calcMatrices()}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const r=d.V(e,-180,180)*Math.PI/180;var l,h,m,y,w,T,A,C,I;this._bearingInRadians!==r&&(this._unmodified=!1,this._bearingInRadians=r,this._calcMatrices(),this._rotationMatrix=Ae(),l=this._rotationMatrix,m=-this._bearingInRadians,y=(h=this._rotationMatrix)[0],w=h[1],T=h[2],A=h[3],C=Math.sin(m),I=Math.cos(m),l[0]=y*I+T*C,l[1]=w*I+A*C,l[2]=y*-C+T*I,l[3]=w*-C+A*I)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const r=d.ai(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==r&&(this._unmodified=!1,this._pitchInRadians=r,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const r=e/180*Math.PI;this._rollInRadians!==r&&(this._unmodified=!1,this._rollInRadians=r,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return d.aS(this._fovInRadians)}setFov(e){e=d.ai(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=d.ak(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const r=this.constrain(this._center,e).zoom;this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this._tileZoom=Math.max(0,Math.floor(r)),this._scale=d.al(r),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,r){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=r,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,r,l){this._unmodified=!1,this._edgeInsets.interpolate(e,r,l),this.constrainInternal(),this._calcMatrices()}resize(e,r,l=!0){this._width=e,this._height=r,l&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Ci([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-d.aj,d.aj])}getCameraQueryGeometry(e,r){if(r.length===1)return[r[0],e];{const{minX:l,minY:h,maxX:m,maxY:y}=d.a6.fromPoints(r).extend(e);return[new d.P(l,h),new d.P(m,h),new d.P(m,y),new d.P(l,y),new d.P(l,h)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:r,zoom:l}=this.constrain(this.center,this.zoom);this.setCenter(r),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=d.am(new Float64Array(16));d.O(e,e,[this._width/2,-this._height/2,1]),d.N(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=d.am(new Float64Array(16)),d.O(e,e,[1,-1,1]),d.N(e,e,[-1,-1,0]),d.O(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,r,l,h){const m=l!==void 0?l:this.bearing,y=h=h!==void 0?h:this.pitch,w=d.a5.fromLngLat(e,r),T=-Math.cos(d.ak(y)),A=Math.sin(d.ak(y)),C=A*Math.sin(d.ak(m)),I=-A*Math.cos(d.ak(m));let D=this.elevation;const O=r-D;let G;T*O>=0||Math.abs(T)<.1?(G=1e4,D=r+G*T):G=-O/T;let K,W,Q=d.aT(1,w.y),ne=0;do{if(ne+=1,ne>10)break;W=G/Q,K=new d.a5(w.x+C*W,w.y+I*W),Q=1/K.meterInMercatorCoordinateUnits()}while(Math.abs(G-W*Q)>1e-12);return{center:K.toLngLat(),elevation:D,zoom:d.ao(this.height/2/Math.tan(this.fovInRadians/2)/W/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const r=d.an(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/r,h=d.a5.fromLngLat(this.center,this.elevation),m=xe(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const y=this.calculateCenterFromCameraLngLatAlt(m.toLngLat(),d.aT(m.z,h.y),this.bearing,this.pitch);this._elevation=y.elevation,this._center=y.center,this.setZoom(y.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=d.an(1,this.center.lat)*this.worldSize;return xe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const r=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/r,e.canonical.y/r,1/r/d.a3,1/r/d.a3]}}class aa{constructor(e,r){this.min=e,this.max=r,this.center=d.aU([],d.aV([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],l=d.aW(this.min),h=d.aW(this.max);for(let m=0;m<r.length;m++)l[m]=r[m]?this.min[m]:this.center[m],h[m]=r[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new aa(l,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let r=!0;for(let l=0;l<e.planes.length;l++){const h=this.intersectsPlane(e.planes[l]);if(h===0)return 0;h===1&&(r=!1)}return r?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let r=e[3],l=e[3];for(let h=0;h<3;h++)e[h]>0?(r+=e[h]*this.min[h],l+=e[h]*this.max[h]):(l+=e[h]*this.min[h],r+=e[h]*this.max[h]);return r>=0?2:l<0?0:1}}class ra{distanceToTile2d(e,r,l,h){const m=h.distanceX([e,r]),y=h.distanceY([e,r]);return Math.hypot(m,y)}getWrap(e,r,l){return l}getTileBoundingVolume(e,r,l,h){var m,y;let w=0,T=0;if(h?.terrain){const C=new d.a0(e.z,r,e.z,e.x,e.y),I=h.terrain.getMinMaxElevation(C);w=(m=I.minElevation)!==null&&m!==void 0?m:Math.min(0,l),T=(y=I.maxElevation)!==null&&y!==void 0?y:Math.max(0,l)}const A=1<<e.z;return new aa([r+e.x/A,e.y/A,w],[r+(e.x+1)/A,(e.y+1)/A,T])}allowVariableZoom(e,r){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,h=d.ai(78.5-l/2,0,60);return!!r.terrain||e.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class ur{constructor(e,r,l){this.points=e,this.planes=r,this.aabb=l}static fromInvProjectionMatrix(e,r=1,l=0,h,m){const y=m?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],w=Math.pow(2,l),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>function(O,G,K,W){const Q=d.aA([],O,G),ne=1/Q[3]/K*W;return d.a$(Q,Q,[ne,ne,1/Q[3],ne])}(D,e,r,w));h&&function(D,O,G,K){const W=K?4:0,Q=K?0:4;let ne=0;const se=[],te=[];for(let ae=0;ae<4;ae++){const fe=d.aX([],D[ae+Q],D[ae+W]),Pe=d.b0(fe);d.aU(fe,fe,1/Pe),se.push(Pe),te.push(fe)}for(let ae=0;ae<4;ae++){const fe=d.b1(D[ae+W],te[ae],G);ne=fe!==null&&fe>=0?Math.max(ne,fe):Math.max(ne,se[ae])}const oe=function(ae,fe){const Pe=d.aX([],ae[fe[0]],ae[fe[1]]),Se=d.aX([],ae[fe[2]],ae[fe[1]]),Ce=[0,0,0,0];return d.aY(Ce,d.aZ([],Pe,Se)),Ce[3]=-d.a_(Ce,ae[fe[0]]),Ce}(D,O),de=function(ae,fe){const Pe=d.b2(ae),Se=d.b3([],ae,1/Pe),Ce=d.aX([],fe,d.aU([],Se,d.a_(fe,Se))),Ie=d.b2(Ce);if(Ie>0){const Ke=Math.sqrt(1-Se[3]*Se[3]),We=d.aU([],Se,-Se[3]),Fe=d.aV([],We,d.aU([],Ce,Ke/Ie));return d.b4(fe,Fe)}return null}(G,oe);if(de!==null){const ae=de/d.a_(te[0],oe);ne=Math.min(ne,ae)}for(let ae=0;ae<4;ae++){const fe=Math.min(ne,se[ae]);D[ae+Q]=[D[ae+W][0]+te[ae][0]*fe,D[ae+W][1]+te[ae][1]*fe,D[ae+W][2]+te[ae][2]*fe,1]}}(T,y[0],h,m);const A=y.map(D=>{const O=d.aX([],T[D[0]],T[D[1]]),G=d.aX([],T[D[2]],T[D[1]]),K=d.aY([],d.aZ([],O,G)),W=-d.a_(K,T[D[1]]);return K.concat(W)}),C=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],I=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const D of T)for(let O=0;O<3;O++)C[O]=Math.min(C[O],D[O]),I[O]=Math.max(I[O],D[O]);return new ur(T,A,new aa(C,I))}}class hr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,l=!0){this._helper.resize(e,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrain(e){this._helper.setConstrain(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,r){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(r,l)=>{l=d.ai(+l,this.minZoom,this.maxZoom);const h={center:new d.U(r.lng,r.lat),zoom:l};let m=this._helper._lngRange;if(!this._helper._renderWorldCopies&&m===null){const te=179.9999999999;m=[-te,te]}const y=this.tileSize*d.al(h.zoom);let w=0,T=y,A=0,C=y,I=0,D=0;const{x:O,y:G}=this.size;if(this._helper._latRange){const te=this._helper._latRange;w=d.W(te[1])*y,T=d.W(te[0])*y,T-w<G&&(I=G/(T-w))}m&&(A=d.V(d.X(m[0])*y,0,y),C=d.V(d.X(m[1])*y,0,y),C<A&&(C+=y),C-A<O&&(D=O/(C-A)));const{x:K,y:W}=De(y,r);let Q,ne;const se=Math.max(D||0,I||0);if(se){const te=new d.P(D?(C+A)/2:K,I?(T+w)/2:W);return h.center=He(y,te).wrap(),h.zoom+=d.ao(se),h}if(this._helper._latRange){const te=G/2;W-te<w&&(ne=w+te),W+te>T&&(ne=T-te)}if(m){const te=(A+C)/2;let oe=K;this._helper._renderWorldCopies&&(oe=d.V(K,te-y/2,te+y/2));const de=O/2;oe-de<A&&(Q=A+de),oe+de>C&&(Q=C-de)}if(Q!==void 0||ne!==void 0){const te=new d.P(Q??K,ne??W);h.center=He(y,te).wrap()}return h},this._helper=new tn({calcMatrices:()=>{this._calcMatrices()},constrain:(r,l)=>this.defaultConstrain(r,l)},e),this._coveringTilesDetailsProvider=new ra}clone(){const e=new hr;return e.apply(this),e}apply(e,r,l){this._helper.apply(e,r,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const r=[new d.b5(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new d.P(0,0)),h=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,0)),m=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new d.P(0,this._helper._height)),w=Math.floor(Math.min(l.x,h.x,m.x,y.x)),T=Math.floor(Math.max(l.x,h.x,m.x,y.x)),A=1;for(let C=w-A;C<=T+A;C++)C!==0&&r.push(new d.b5(C,e))}return r}getCameraFrustum(){return ur.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const r=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(r,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,r){const l=d.an(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(r,l),m=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),y=d.a5.fromLngLat(e),w=new d.a5(y.x-(h.x-m.x),y.y-(h.y-m.y));this.setCenter(w?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,r){return r?this.coordinatePoint(d.a5.fromLngLat(e),r.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(d.a5.fromLngLat(e))}screenPointToLocation(e,r){var l;return(l=this.screenPointToMercatorCoordinate(e,r))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,r){if(r){const l=r.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,r){const l=r||0,h=[e.x,e.y,0,1],m=[e.x,e.y,1,1];d.aA(h,h,this._pixelMatrixInverse),d.aA(m,m,this._pixelMatrixInverse);const y=h[3],w=m[3],T=h[1]/y,A=m[1]/w,C=h[2]/y,I=m[2]/w,D=C===I?0:(l-C)/(I-C);return new d.a5(d.F.number(h[0]/y,m[0]/w,D)/this.worldSize,d.F.number(T,A,D)/this.worldSize,l)}coordinatePoint(e,r=0,l=this._pixelMatrix){const h=[e.x*this.worldSize,e.y*this.worldSize,r,1];return d.aA(h,h,l),new d.P(h[0]/h[3],h[1]/h[3])}getBounds(){const e=Math.max(0,this._helper._height/2-je(this));return new Ci().extend(this.screenPointToLocation(new d.P(0,e))).extend(this.screenPointToLocation(new d.P(this._helper._width,e))).extend(this.screenPointToLocation(new d.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new d.P(0,this._helper._height)))}isPointOnMapSurface(e,r){return r?r.pointCoordinate(e)!=null:e.y>this.height/2-je(this)}calculatePosMatrix(e,r=!1,l){var h;const m=(h=e.key)!==null&&h!==void 0?h:d.b6(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),y=r?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(m)){const A=y.get(m);return l?A.f32:A.f64}const w=dt(e,this.worldSize);d.Q(w,r?this._alignedProjMatrix:this._viewProjMatrix,w);const T={f64:w,f32:new Float32Array(w)};return y.set(m,T),l?T.f32:T.f64}calculateFogMatrix(e){const r=e.key,l=this._fogMatrixCacheF32;if(l.has(r))return l.get(r);const h=dt(e,this.worldSize);return d.Q(h,this._fogMatrix,h),l.set(r,new Float32Array(h)),l.get(r)}calculateCenterFromCameraLngLatAlt(e,r,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,h)}_calculateNearFarZIfNeeded(e,r,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),m=e-h*this._helper._pixelPerMeter/Math.cos(r),y=h<0?m:e,w=Math.PI/2+this.pitchInRadians,T=d.ak(this.fov)*(Math.abs(Math.cos(d.ak(this.roll)))*this.height+Math.abs(Math.sin(d.ak(this.roll)))*this.width)/this.height*(.5+l.y/this.height),A=Math.sin(T)*y/Math.sin(d.ai(Math.PI-w-T,.01,Math.PI-.01)),C=je(this),I=Math.atan(C/this._helper.cameraToCenterDistance),D=d.ak(.75),O=I>D?2*I*(.5+l.y/(2*C)):D,G=Math.sin(O)*y/Math.sin(d.ai(Math.PI-w-O,.01,Math.PI-.01)),K=Math.min(A,G);this._helper._farZ=1.01*(Math.cos(Math.PI/2-r)*K+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,r=De(this.worldSize,this.center),l=r.x,h=r.y;this._helper._pixelPerMeter=d.an(1,this.center.lat)*this.worldSize;const m=d.ak(Math.min(this.pitch,ye)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(m));let w;this._calculateNearFarZIfNeeded(y,m,e),w=new Float64Array(16),d.b7(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),d.au(this._invProjMatrix,w),w[8]=2*-e.x/this._helper._width,w[9]=2*e.y/this._helper._height,this._projectionMatrix=d.b8(w),d.O(w,w,[1,-1,1]),d.N(w,w,[0,0,-this._helper.cameraToCenterDistance]),d.b9(w,w,-this.rollInRadians),d.ba(w,w,this.pitchInRadians),d.b9(w,w,-this.bearingInRadians),d.N(w,w,[-l,-h,0]),this._mercatorMatrix=d.O([],w,[this.worldSize,this.worldSize,this.worldSize]),d.O(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=d.Q(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),d.N(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=d.au([],w);const T=[0,0,-1,1];d.aA(T,T,this._invViewProjMatrix),this._cameraPosition=[T[0]/T[3],T[1]/T[3],T[2]/T[3]],this._fogMatrix=new Float64Array(16),d.b7(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,d.O(this._fogMatrix,this._fogMatrix,[1,-1,1]),d.N(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b9(this._fogMatrix,this._fogMatrix,-this.rollInRadians),d.ba(this._fogMatrix,this._fogMatrix,this.pitchInRadians),d.b9(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),d.N(this._fogMatrix,this._fogMatrix,[-l,-h,0]),d.O(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),d.N(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=d.Q(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);const A=this._helper._width%2/2,C=this._helper._height%2/2,I=Math.cos(this.bearingInRadians),D=Math.sin(-this.bearingInRadians),O=l-Math.round(l)+I*A+D*C,G=h-Math.round(h)+I*C+D*A,K=new Float64Array(w);if(d.N(K,K,[O>.5?O-1:O,G>.5?G-1:G,0]),this._alignedProjMatrix=K,w=d.au(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new d.P(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.aA(r,r,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=d.an(1,this.center.lat)*this.worldSize;return xe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,r){const l=d.a5.fromLngLat(e),h=[l.x*this.worldSize,l.y*this.worldSize,r,1];return d.aA(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(e){const{overscaledTileID:r,aligned:l,applyTerrainMatrix:h}=e,m=this._helper.getMercatorTileCoordinates(r),y=r?this.calculatePosMatrix(r,l,!0):null;let w;return w=r&&r.terrainRttPosMatrix32f&&h?r.terrainRttPosMatrix32f:y||d.bb(),{mainMatrix:w,tileMercatorCoords:m,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,r,l){return 1}transformLightDirection(e){return d.aW(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,r,l,h){const m=this.calculatePosMatrix(l);let y;h?(y=[e,r,h(e,r),1],d.aA(y,y,m)):(y=[e,r,0,1],To(y,y,m));const w=y[3];return{point:new d.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(e){for(const r of e)this.calculatePosMatrix(r)}getMatrixForModel(e,r){const l=d.a5.fromLngLat(e,r),h=l.meterInMercatorCoordinateUnits(),m=d.bc();return d.N(m,m,[l.x,l.y,l.z]),d.b9(m,m,Math.PI),d.ba(m,m,Math.PI/2),d.O(m,m,[-h,h,h]),m}getProjectionDataForCustomLayer(e=!0){const r=new d.a0(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:r,applyGlobeMatrix:e}),h=dt(r,this.worldSize);d.Q(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const m=[d.a3,d.a3,this.worldSize/this._helper.pixelsPerMeter],y=d.bd();return d.O(y,h,m),l.fallbackMatrix=y,l.mainMatrix=y,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function $i(){d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Eo(f){if(f.useSlerp)if(f.k<1){const e=d.be(f.startEulerAngles.roll,f.startEulerAngles.pitch,f.startEulerAngles.bearing),r=d.be(f.endEulerAngles.roll,f.endEulerAngles.pitch,f.endEulerAngles.bearing),l=new Float64Array(4);d.bf(l,e,r,f.k);const h=d.bg(l);f.tr.setRoll(h.roll),f.tr.setPitch(h.pitch),f.tr.setBearing(h.bearing)}else f.tr.setRoll(f.endEulerAngles.roll),f.tr.setPitch(f.endEulerAngles.pitch),f.tr.setBearing(f.endEulerAngles.bearing);else f.tr.setRoll(d.F.number(f.startEulerAngles.roll,f.endEulerAngles.roll,f.k)),f.tr.setPitch(d.F.number(f.startEulerAngles.pitch,f.endEulerAngles.pitch,f.k)),f.tr.setBearing(d.F.number(f.startEulerAngles.bearing,f.endEulerAngles.bearing,f.k))}function zr(f,e,r,l,h){const m=h.padding,y=De(h.worldSize,r.getNorthWest()),w=De(h.worldSize,r.getNorthEast()),T=De(h.worldSize,r.getSouthEast()),A=De(h.worldSize,r.getSouthWest()),C=d.ak(-l),I=y.rotate(C),D=w.rotate(C),O=T.rotate(C),G=A.rotate(C),K=new d.P(Math.max(I.x,D.x,G.x,O.x),Math.max(I.y,D.y,G.y,O.y)),W=new d.P(Math.min(I.x,D.x,G.x,O.x),Math.min(I.y,D.y,G.y,O.y)),Q=K.sub(W),ne=(h.width-(m.left+m.right+e.left+e.right))/Q.x,se=(h.height-(m.top+m.bottom+e.top+e.bottom))/Q.y;if(se<0||ne<0)return void $i();const te=Math.min(d.ao(h.scale*Math.min(ne,se)),f.maxZoom),oe=d.P.convert(f.offset),de=new d.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(d.ak(l)),ae=oe.add(de).mult(h.scale/d.al(te));return{center:He(h.worldSize,y.add(T).div(2).sub(ae)),zoom:te,bearing:l}}class qr{get useGlobeControls(){return!1}handlePanInertia(e,r){const l=e.mag(),h=Math.abs(je(r));return{easingOffset:e.mult(Math.min(.75*h/l,1)),easingCenter:r.center}}handleMapControlsRollPitchBearingZoom(e,r){e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta),e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta)}handleMapControlsPan(e,r,l){e.around.distSqr(r.centerPoint)<.01||r.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,r,l,h,m){return zr(e,r,l,h,m)}handleJumpToCenterZoom(e,r){e.zoom!==(r.zoom!==void 0?+r.zoom:e.zoom)&&e.setZoom(+r.zoom),r.center!==void 0&&e.setCenter(d.U.convert(r.center))}handleEaseTo(e,r){const l=e.zoom,h=e.padding,m={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},w=r.zoom!==void 0,T=!e.isPaddingEqual(r.padding);let A=!1;const C=w?+r.zoom:e.zoom;let I=e.centerPoint.add(r.offsetAsPoint);const D=e.screenPointToLocation(I),{center:O,zoom:G}=e.constrain(d.U.convert(r.center||D),C??l);Bi(e,O);const K=De(e.worldSize,D),W=De(e.worldSize,O).sub(K),Q=d.al(G-l);return A=G!==l,{easeFunc:ne=>{if(A&&e.setZoom(d.F.number(l,G,ne)),d.bh(m,y)||Eo({startEulerAngles:m,endEulerAngles:y,tr:e,k:ne,useSlerp:m.roll!=y.roll}),T&&(e.interpolatePadding(h,r.padding,ne),I=e.centerPoint.add(r.offsetAsPoint)),r.around)e.setLocationAtPoint(r.around,r.aroundPoint);else{const se=d.al(e.zoom-l),te=G>l?Math.min(2,Q):Math.max(.5,Q),oe=Math.pow(te,1-ne),de=He(e.worldSize,K.add(W.mult(ne*oe)).mult(se));e.setLocationAtPoint(e.renderWorldCopies?de.wrap():de,I)}},isZooming:A,elevationCenter:O}}handleFlyTo(e,r){const l=r.zoom!==void 0,h=e.zoom,m=e.constrain(d.U.convert(r.center||r.locationAtOffset),l?+r.zoom:h),y=m.center,w=m.zoom;Bi(e,y);const T=De(e.worldSize,r.locationAtOffset),A=De(e.worldSize,y).sub(T),C=A.mag(),I=d.al(w-h);let D;if(r.minZoom!==void 0){const O=Math.min(+r.minZoom,h,w),G=e.constrain(y,O).zoom;D=d.al(G-h)}return{easeFunc:(O,G,K,W)=>{e.setZoom(O===1?w:h+d.ao(G));const Q=O===1?y:He(e.worldSize,T.add(A.mult(K)).mult(G));e.setLocationAtPoint(e.renderWorldCopies?Q.wrap():Q,W)},scaleOfZoom:I,targetCenter:y,scaleOfMinZoom:D,pixelPathLength:C}}}class ii{constructor(e,r,l){this.blendFunction=e,this.blendColor=r,this.mask=l}}ii.Replace=[1,0],ii.disabled=new ii(ii.Replace,d.bi.transparent,[!1,!1,!1,!1]),ii.unblended=new ii(ii.Replace,d.bi.transparent,[!0,!0,!0,!0]),ii.alphaBlended=new ii([1,771],d.bi.transparent,[!0,!0,!0,!0]);const sa=2305;class Ot{constructor(e,r,l){this.enable=e,this.mode=r,this.frontFace=l}}Ot.disabled=new Ot(!1,1029,sa),Ot.backCCW=new Ot(!0,1029,sa),Ot.frontCCW=new Ot(!0,1028,sa);class Ut{constructor(e,r,l){this.func=e,this.mask=r,this.range=l}}Ut.ReadOnly=!1,Ut.ReadWrite=!0,Ut.disabled=new Ut(519,Ut.ReadOnly,[0,1]);const $s=7680;class ei{constructor(e,r,l,h,m,y){this.test=e,this.ref=r,this.mask=l,this.fail=h,this.depthFail=m,this.pass=y}}ei.disabled=new ei({func:519,mask:0},0,0,$s,$s,$s);const Ks=new WeakMap;function Ba(f){var e;if(Ks.has(f))return Ks.get(f);{const r=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Ks.set(f,r),r}}class ps{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const r=e.context,l=r.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new d.aP;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const m=new d.aR;m.emplaceBack(0,1,2),this._fullscreenTriangle=new Ys(r.createVertexBuffer(h,cr.members),r.createIndexBuffer(m),d.aQ.simpleSegment(0,0,h.length,m.length)),this._resultBuffer=new Uint8Array(4),r.activeTexture.set(l.TEXTURE1);const y=l.createTexture();l.bindTexture(l.TEXTURE_2D,y),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=r.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),Ba(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,r){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,r),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,r=e.gl;e.activeTexture.set(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,r){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:d.bi.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,Ut.disabled,ei.disabled,ii.unblended,Ot.disabled,((m,y)=>({u_input:m,u_output_expected:y}))(e,r),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Ba(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const m=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:m}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Ba(e)){const r=e.clientWaitSync(this._readbackQueue.sync,0,0);if(r===e.WAIT_FAILED)return d.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(r===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=ps._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let r=0;return r+=e[0]/256,r+=e[1]/65536,r+=e[2]/16777216,e[3]<127&&(r=-r),r/128}}const ms=d.a3/128;function ml(f,e){const r=f.granularity!==void 0?Math.max(f.granularity,1):1,l=r+(f.generateBorders?2:0),h=r+(f.extendToNorthPole||f.generateBorders?1:0)+(f.extendToSouthPole||f.generateBorders?1:0),m=l+1,y=h+1,w=f.generateBorders?-1:0,T=f.generateBorders||f.extendToNorthPole?-1:0,A=r+(f.generateBorders?1:0),C=r+(f.generateBorders||f.extendToSouthPole?1:0),I=m*y,D=l*h*6,O=m*y>65536;if(O&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const G=O||e==="32bit",K=new Int16Array(2*I);let W=0;for(let se=T;se<=C;se++)for(let te=w;te<=A;te++){let oe=te/r*d.a3;te===-1&&(oe=-ms),te===r+1&&(oe=d.a3+ms);let de=se/r*d.a3;se===-1&&(de=f.extendToNorthPole?d.bk:-ms),se===r+1&&(de=f.extendToSouthPole?d.bl:d.a3+ms),K[W++]=oe,K[W++]=de}const Q=G?new Uint32Array(D):new Uint16Array(D);let ne=0;for(let se=0;se<h;se++)for(let te=0;te<l;te++){const oe=te+1+se*m,de=te+(se+1)*m,ae=te+1+(se+1)*m;Q[ne++]=te+se*m,Q[ne++]=de,Q[ne++]=oe,Q[ne++]=oe,Q[ne++]=de,Q[ne++]=ae}return{vertices:K.buffer.slice(0),indices:Q.buffer.slice(0),uses32bitIndices:G}}const ql=new d.aO({fill:new d.bm(128,2),line:new d.bm(512,0),tile:new d.bm(128,32),stencil:new d.bm(128,1),circle:3});class Vc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Dt.projectionGlobe}get vertexShaderPreludeCode(){return Dt.projectionMercator.vertexSource}get subdivisionGranularity(){return ql}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new ps(e));const r=d.W(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-r*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(r,l),m=mt();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=m);const y=Math.min(Math.max((m-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=d.bn(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,d.bo(y))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,r,l,h,m){const y=(m==="stencil"?ql.stencil:ql.tile).getGranularityForZoomLevel(r.z);return this._getMesh(e,{granularity:y,generateBorders:l,extendToNorthPole:r.y===0&&h,extendToSouthPole:r.y===(1<<r.z)-1&&h})}_getMesh(e,r){const l=this._getMeshKey(r);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=function(m,y){const w=ml(y,"16bit"),T=d.aP.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),A=d.aR.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new Ys(m.createVertexBuffer(T,cr.members),m.createIndexBuffer(A),d.aQ.simpleSegment(0,0,T.length,A.length))}(e,r);return this._tileMeshCache[l]=h,h}recalculate(e){}hasTransition(){const e=mt();let r=!1;return r=r||(e-this._errorMeasurementLastChangeTime)/1e3<.7,r=r||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,r}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Gc=new d.r({type:new d.D(d.t.projection.type)});class Ao extends d.E{constructor(e){super(),this._transitionable=new d.x(Gc,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.G(0)),this._mercatorProjection=new Zn,this._verticalPerspectiveProjection=new Vc}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof d.bp){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,r,l,h,m){return this.currentProjection.getMeshFromTileID(e,r,l,h,m)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function gl(f){const e=Hl(f.worldSize,f.center.lat);return 2*Math.PI*e}function Ws(f,e,r,l,h){const m=1/(1<<h),y=e/d.a3*m+l*m,w=d.br((f/d.a3*m+r*m)*Math.PI*2+Math.PI,2*Math.PI),T=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,A=Math.cos(T),C=new Float64Array(3);return C[0]=Math.sin(w)*A,C[1]=Math.sin(T),C[2]=Math.cos(w)*A,C}function qn(f){return function(e,r){const l=Math.cos(r),h=new Float64Array(3);return h[0]=Math.sin(e)*l,h[1]=Math.sin(r),h[2]=Math.cos(e)*l,h}(f.lng*Math.PI/180,f.lat*Math.PI/180)}function Hl(f,e){return f/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Gh(f){const e=Math.asin(f[1])/Math.PI*180,r=Math.sqrt(f[0]*f[0]+f[2]*f[2]);if(r>1e-6){const l=f[0]/r,h=Math.acos(f[2]/r),m=(l>0?h:-h)/Math.PI*180;return new d.U(d.V(m,-180,180),e)}return new d.U(0,e)}function Xl(f){return Math.cos(f*Math.PI/180)}function pi(f,e){const r=Xl(f),l=Xl(e);return d.ao(l/r)}function Zc(f,e){const r=f.rotate(e.bearingInRadians),l=e.zoom+pi(e.center.lat,0),h=d.bn(1/Xl(e.center.lat),1/Xl(Math.min(Math.abs(e.center.lat),60)),d.bq(l,7,3,0,1)),m=360/gl({worldSize:e.worldSize,center:{lat:e.center.lat}});return new d.U(e.center.lng-r.x*m*h,d.ai(e.center.lat+r.y*m,-d.aj,d.aj))}function dr(f){const e=.5*f,r=Math.sin(e),l=Math.cos(e);return Math.log(r+l)-Math.log(l-r)}function Yl(f,e,r,l){const h=f.lat+r*l;if(Math.abs(r)>1){const m=(Math.sign(f.lat+r)!==Math.sign(f.lat)?-Math.abs(f.lat):Math.abs(f.lat))*Math.PI/180,y=Math.abs(f.lat+r)*Math.PI/180,w=dr(m+l*(y-m)),T=dr(m),A=dr(y);return new d.U(f.lng+e*((w-T)/(A-T)),h)}return new d.U(f.lng+e*l,h)}class qc{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,r,l,h){const m=`${e.z}_${e.x}_${e.y}_${h?.terrain?"t":""}`,y=this._cache.get(m);if(y)return y;const w=this._cachePrevious.get(m);if(w)return this._cache.set(m,w),w;const T=this._boundingVolumeFactory(e,r,l,h);return this._cache.set(m,T),this._hadAnyChanges=!0,T}}class Co{constructor(e,r,l,h){this.min=l,this.max=h,this.points=e,this.planes=r}static fromAabb(e,r){const l=[];for(let h=0;h<8;h++)l.push([1&~h?e[0]:r[0],(h>>1&1)==1?r[1]:e[1],(h>>2&1)==1?r[2]:e[2]]);return new Co(l,[[-1,0,0,r[0]],[1,0,0,-e[0]],[0,-1,0,r[1]],[0,1,0,-e[1]],[0,0,-1,r[2]],[0,0,1,-e[2]]],e,r)}static fromCenterSizeAngles(e,r,l){const h=d.bu([],l[0],l[1],l[2]),m=d.bv([],[r[0],0,0],h),y=d.bv([],[0,r[1],0],h),w=d.bv([],[0,0,r[2]],h),T=[...e],A=[...e];for(let I=0;I<8;I++)for(let D=0;D<3;D++){const O=e[D]+m[D]*(1&~I?-1:1)+y[D]*((I>>1&1)==1?1:-1)+w[D]*((I>>2&1)==1?1:-1);T[D]=Math.min(T[D],O),A[D]=Math.max(A[D],O)}const C=[];for(let I=0;I<8;I++){const D=[...e];d.aV(D,D,d.aU([],m,1&~I?-1:1)),d.aV(D,D,d.aU([],y,(I>>1&1)==1?1:-1)),d.aV(D,D,d.aU([],w,(I>>2&1)==1?1:-1)),C.push(D)}return new Co(C,[[...m,-d.a_(m,C[0])],[...y,-d.a_(y,C[0])],[...w,-d.a_(w,C[0])],[-m[0],-m[1],-m[2],-d.a_(m,C[7])],[-y[0],-y[1],-y[2],-d.a_(y,C[7])],[-w[0],-w[1],-w[2],-d.a_(w,C[7])]],T,A)}intersectsFrustum(e){let r=!0;const l=this.points.length,h=this.planes.length,m=e.planes.length,y=e.points.length;for(let w=0;w<m;w++){const T=e.planes[w];let A=0;for(let C=0;C<l;C++){const I=this.points[C];T[0]*I[0]+T[1]*I[1]+T[2]*I[2]+T[3]>=0&&A++}if(A===0)return 0;A<l&&(r=!1)}if(r)return 2;for(let w=0;w<h;w++){const T=this.planes[w];let A=0;for(let C=0;C<y;C++){const I=e.points[C];T[0]*I[0]+T[1]*I[1]+T[2]*I[2]+T[3]>=0&&A++}if(A===0)return 0}return 1}intersectsPlane(e){const r=this.points.length;let l=0;for(let h=0;h<r;h++){const m=this.points[h];e[0]*m[0]+e[1]*m[1]+e[2]*m[2]+e[3]>=0&&l++}return l===r?2:l===0?0:1}}function gs(f,e,r){const l=f-e;return l<0?-l:Math.max(0,l-r)}function Zu(f,e,r,l,h){const m=f-r;let y;return y=m<0?Math.min(-m,1+m-h):m>1?Math.min(Math.max(m-h,0),1-m):0,Math.max(y,gs(e,l,h))}class Zh{constructor(){this._boundingVolumeCache=new qc(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,r,l,h){const m=1<<l.z,y=1/m,w=l.x/m,T=l.y/m;let A=2;return A=Math.min(A,Zu(e,r,w,T,y)),A=Math.min(A,Zu(e,r,w+.5,-T-y,y)),A=Math.min(A,Zu(e,r,w+.5,2-T-y,y)),A}getWrap(e,r,l){const h=1<<r.z,m=1/h,y=r.x/h,w=gs(e.x,y,m),T=gs(e.x,y-1,m),A=gs(e.x,y+1,m),C=Math.min(w,T,A);return C===A?1:C===T?-1:0}allowVariableZoom(e,r){return _i(e,r)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,r,l,h){return this._boundingVolumeCache.getTileBoundingVolume(e,r,l,h)}_computeTileBoundingVolume(e,r,l,h){var m,y;let w=0,T=0;if(h?.terrain){const A=new d.a0(e.z,r,e.z,e.x,e.y),C=h.terrain.getMinMaxElevation(A);w=(m=C.minElevation)!==null&&m!==void 0?m:Math.min(0,l),T=(y=C.maxElevation)!==null&&y!==void 0?y:Math.max(0,l)}if(w/=d.bx,T/=d.bx,w+=1,T+=1,e.z<=0)return Co.fromAabb([-T,-T,-T],[T,T,T]);if(e.z===1)return Co.fromAabb([e.x===0?-T:0,e.y===0?0:-T,-T],[e.x===0?0:T,e.y===0?T:0,T]);{const A=[Ws(0,0,e.x,e.y,e.z),Ws(d.a3,0,e.x,e.y,e.z),Ws(d.a3,d.a3,e.x,e.y,e.z),Ws(0,d.a3,e.x,e.y,e.z)],C=[];for(const Ce of A)C.push(d.aU([],Ce,T));if(T!==w)for(const Ce of A)C.push(d.aU([],Ce,w));e.y===0&&C.push([0,1,0]),e.y===(1<<e.z)-1&&C.push([0,-1,0]);const I=[1,1,1],D=[-1,-1,-1];for(const Ce of C)for(let Ie=0;Ie<3;Ie++)I[Ie]=Math.min(I[Ie],Ce[Ie]),D[Ie]=Math.max(D[Ie],Ce[Ie]);const O=Ws(d.a3/2,d.a3/2,e.x,e.y,e.z),G=d.aZ([],[0,1,0],O);d.aY(G,G);const K=d.aZ([],O,G);d.aY(K,K);const W=d.aZ([],A[2],A[1]);d.aY(W,W);const Q=d.aZ([],A[0],A[3]);d.aY(Q,Q),C.push(d.aU([],O,T)),e.y>=(1<<e.z)/2&&C.push(d.aU([],Ws(d.a3/2,0,e.x,e.y,e.z),T)),e.y<(1<<e.z)/2&&C.push(d.aU([],Ws(d.a3/2,d.a3,e.x,e.y,e.z),T));const ne=qh(O,C),se=qh(K,C),te=[-O[0],-O[1],-O[2],ne.max],oe=[O[0],O[1],O[2],-ne.min],de=[-K[0],-K[1],-K[2],se.max],ae=[K[0],K[1],K[2],-se.min],fe=[...W,0],Pe=[...Q,0],Se=[];return e.y===0?Se.push(d.bw(Pe,fe,te),d.bw(Pe,fe,oe)):Se.push(d.bw(de,fe,te),d.bw(de,fe,oe),d.bw(de,Pe,te),d.bw(de,Pe,oe)),e.y===(1<<e.z)-1?Se.push(d.bw(Pe,fe,te),d.bw(Pe,fe,oe)):Se.push(d.bw(ae,fe,te),d.bw(ae,fe,oe),d.bw(ae,Pe,te),d.bw(ae,Pe,oe)),new Co(Se,[te,oe,de,ae,fe,Pe],I,D)}}}function qh(f,e){let r=1/0,l=-1/0;for(const h of e){const m=d.a_(f,h);r=Math.min(r,m),l=Math.max(l,m)}return{min:r,max:l}}class Hc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r){this._helper.resize(e,r)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrain(e){this._helper.setConstrain(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=d.by(),this._projectionMatrix=d.bc(),this._globeViewProjMatrix32f=d.bb(),this._globeViewProjMatrixNoCorrection=d.bc(),this._globeViewProjMatrixNoCorrectionInverted=d.bc(),this._globeProjMatrixInverted=d.bc(),this._cameraPosition=d.bs(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(r,l)=>{const h=d.ai(r.lat,-d.aj,d.aj),m=d.ai(+l,this.minZoom+pi(0,h),this.maxZoom);return{center:new d.U(r.lng,h),zoom:m}},this._helper=new tn({calcMatrices:()=>{this._calcMatrices()},constrain:(r,l)=>this.defaultConstrain(r,l)},e),this._coveringTilesDetailsProvider=new Zh}clone(){const e=new Hc;return e.apply(this),e}apply(e,r){this._globeLatitudeErrorCorrectionRadians=r||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=d.bs();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:r,applyGlobeMatrix:l}=e,h=this._helper.getMercatorTileCoordinates(r);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const r=this.pitchInRadians,l=this.cameraToCenterDistance/e,h=Math.sin(r)*l,m=Math.cos(r)*l+1,y=1/Math.sqrt(h*h+m*m)*1;let w=-h,T=m;const A=Math.sqrt(w*w+T*T);w/=A,T/=A;const C=[0,w,T];d.bz(C,C,[0,0,0],-this.bearingInRadians),d.bA(C,C,[0,0,0],-1*this.center.lat*Math.PI/180),d.bB(C,C,[0,0,0],this.center.lng*Math.PI/180);const I=1/d.b0(C);return d.aU(C,C,I),[...C,-y*I]}isLocationOccluded(e){return!this.isSurfacePointVisible(qn(e))}transformLightDirection(e){const r=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),m=[Math.sin(r)*h,Math.sin(l),Math.cos(r)*h],y=[m[2],0,-m[0]],w=[0,0,0];d.aZ(w,y,m),d.aY(y,y),d.aY(w,w);const T=[0,0,0];return d.aY(T,[y[0]*e[0]+w[0]*e[1]+m[0]*e[2],y[1]*e[0]+w[1]*e[1]+m[1]*e[2],y[2]*e[0]+w[2]*e[1]+m[2]*e[2]]),T}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,r,l){const h=function(w,T,A){const C=1/(1<<A.z);return new d.a5(w/d.a3*C+A.x*C,T/d.a3*C+A.y*C)}(e,r,l.canonical),m=(y=h.y,[d.br(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(m[1])}projectTileCoordinates(e,r,l,h){const m=l.canonical,y=Ws(e,r,m.x,m.y,m.z),w=1+(h?h(e,r):0)/d.bx,T=[y[0]*w,y[1]*w,y[2]*w,1];d.aA(T,T,this._globeViewProjMatrixNoCorrection);const A=this._cachedClippingPlane,C=A[0]*y[0]+A[1]*y[1]+A[2]*y[2]+A[3]<0;return{point:new d.P(T[0]/T[3],T[1]/T[3]),signedDistanceFromCamera:T[3],isOccluded:C}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=Hl(this.worldSize,this.center.lat),r=d.bd(),l=d.bd();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),d.b7(r,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;r[8]=2*-h.x/this._helper._width,r[9]=2*h.y/this._helper._height,this._projectionMatrix=d.b8(r),this._globeProjMatrixInverted=d.bd(),d.au(this._globeProjMatrixInverted,r),d.N(r,r,[0,0,-this.cameraToCenterDistance]),d.b9(r,r,this.rollInRadians),d.ba(r,r,-this.pitchInRadians),d.b9(r,r,this.bearingInRadians),d.N(r,r,[0,0,-e]);const m=d.bs();m[0]=e,m[1]=e,m[2]=e,d.ba(l,r,this.center.lat*Math.PI/180),d.bC(l,l,-this.center.lng*Math.PI/180),d.O(l,l,m),this._globeViewProjMatrixNoCorrection=l,d.ba(r,r,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),d.bC(r,r,-this.center.lng*Math.PI/180),d.O(r,r,m),this._globeViewProjMatrix32f=new Float32Array(r),this._globeViewProjMatrixNoCorrectionInverted=d.bd(),d.au(this._globeViewProjMatrixNoCorrectionInverted,l);const y=d.bs();this._cameraPosition=d.bs(),this._cameraPosition[2]=this.cameraToCenterDistance/e,d.bz(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),d.bA(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),d.bz(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),d.aV(this._cameraPosition,this._cameraPosition,[0,0,1]),d.bA(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),d.bB(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const w=d.b8(this._globeViewProjMatrixNoCorrectionInverted);d.O(w,w,[1,1,-1]),this._cachedFrustum=ur.fromInvProjectionMatrix(w,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){d.w("calculateFogMatrix is not supported on globe projection.");const r=d.bd();return d.am(r),r}getVisibleUnwrappedCoordinates(e){return[new d.b5(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&d.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=qn(e);d.aU(l,l,1+r/d.bx);const h=d.by();return d.aA(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(e){}getBounds(){const e=.5*this.width,r=.5*this.height,l=[new d.P(0,0),new d.P(e,0),new d.P(this.width,0),new d.P(this.width,r),new d.P(this.width,this.height),new d.P(e,this.height),new d.P(0,this.height),new d.P(0,r)],h=[];for(const I of l)h.push(this.unprojectScreenPoint(I));let m=0,y=0,w=0,T=0;const A=this.center;for(const I of h){const D=d.bD(A.lng,I.lng),O=d.bD(A.lat,I.lat);D<y&&(y=D),D>m&&(m=D),O<T&&(T=O),O>w&&(w=O)}const C=[A.lng+y,A.lat+T,A.lng+m,A.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(C[3]=90,C[0]=-180,C[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(C[1]=-90,C[0]=-180,C[2]=180),new Ci(C)}calculateCenterFromCameraLngLatAlt(e,r,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,h)}setLocationAtPoint(e,r){const l=qn(this.unprojectScreenPoint(r)),h=qn(e),m=d.bs();d.bE(m);const y=d.bs();d.bB(y,l,m,-this.center.lng*Math.PI/180),d.bA(y,y,m,this.center.lat*Math.PI/180);const w=h[0]*h[0]+h[2]*h[2],T=y[0]*y[0];if(w<T)return;const A=Math.sqrt(w-T),C=-A,I=d.bF(h[0],h[2],y[0],A),D=d.bF(h[0],h[2],y[0],C),O=d.bs();d.bB(O,h,m,-I);const G=d.bF(O[1],O[2],y[1],y[2]),K=d.bs();d.bB(K,h,m,-D);const W=d.bF(K[1],K[2],y[1],y[2]),Q=.5*Math.PI,ne=G>=-Q&&G<=Q,se=W>=-Q&&W<=Q;let te,oe;if(ne&&se){const Pe=this.center.lng*Math.PI/180,Se=this.center.lat*Math.PI/180;d.bG(I,Pe)+d.bG(G,Se)<d.bG(D,Pe)+d.bG(W,Se)?(te=I,oe=G):(te=D,oe=W)}else if(ne)te=I,oe=G;else{if(!se)return;te=D,oe=W}const de=te/Math.PI*180,ae=oe/Math.PI*180,fe=this.center.lat;this.setCenter(new d.U(de,d.ai(ae,-90,90))),this.setZoom(this.zoom+pi(fe,this.center.lat))}locationToScreenPoint(e,r){const l=qn(e);if(r){const h=r.getElevationForLngLatZoom(e,this._helper._tileZoom);d.aU(l,l,1+h/d.bx)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const r=d.by();return d.aA(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],new d.P((.5*r[0]+.5)*this.width,(.5*-r[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,r){if(r){const l=r.pointCoordinate(e);if(l)return l}return d.a5.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,r){var l;return(l=this.screenPointToMercatorCoordinate(e,r))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,r){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(e){const r=d.by();r[0]=e.x/this.width*2-1,r[1]=-1*(e.y/this.height*2-1),r[2]=1,r[3]=1,d.aA(r,r,this._globeViewProjMatrixNoCorrectionInverted),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3];const l=d.bs();l[0]=r[0]-this._cameraPosition[0],l[1]=r[1]-this._cameraPosition[1],l[2]=r[2]-this._cameraPosition[2];const h=d.bs();return d.aY(h,l),h}isSurfacePointVisible(e){const r=this._cachedClippingPlane;return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const r=d.by();return d.aA(r,[...e,1],this._globeViewProjMatrixNoCorrection),r[0]/=r[3],r[1]/=r[3],r[2]/=r[3],r[0]>-1&&r[0]<1&&r[1]>-1&&r[1]<1&&r[2]>-1&&r[2]<1}rayPlanetIntersection(e,r){const l=d.a_(e,r),h=d.bs(),m=d.bs();d.aU(m,r,l),d.aX(h,e,m);const y=1-d.a_(h,h);if(y<0)return null;const w=d.a_(e,e)-1,T=-l+(l<0?1:-1)*Math.sqrt(y),A=w/T,C=T;return{tMin:Math.min(A,C),tMax:Math.max(A,C)}}unprojectScreenPoint(e){const r=this._cameraPosition,l=this.getRayDirectionFromPixel(e),h=this.rayPlanetIntersection(r,l);if(h){const C=d.bs();d.aV(C,r,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const I=d.bs();return d.aY(I,C),Gh(I)}const m=this._cachedClippingPlane,y=m[0]*l[0]+m[1]*l[1]+m[2]*l[2],w=-d.b4(m,r)/y,T=d.bs();if(w>0)d.aV(T,r,[l[0]*w,l[1]*w,l[2]*w]);else{const C=d.bs();d.aV(C,r,[2*l[0],2*l[1],2*l[2]]);const I=d.b4(this._cachedClippingPlane,C);d.aX(T,C,[this._cachedClippingPlane[0]*I,this._cachedClippingPlane[1]*I,this._cachedClippingPlane[2]*I])}const A=function(C){const I=d.bs();return I[0]=C[0]*-C[3],I[1]=C[1]*-C[3],I[2]=C[2]*-C[3],{center:I,radius:Math.sqrt(1-C[3]*C[3])}}(m);return Gh(function(C,I,D){const O=d.bs();d.aX(O,D,C);const G=d.bs();return d.bt(G,C,O,I/d.b2(O)),G}(A.center,A.radius,T))}getMatrixForModel(e,r){const l=d.U.convert(e),h=1/d.bx,m=d.bc();return d.bC(m,m,l.lng/180*Math.PI),d.ba(m,m,-l.lat/180*Math.PI),d.N(m,m,[0,0,1+r/d.bx]),d.ba(m,m,.5*Math.PI),d.O(m,m,[h,h,h]),m}getProjectionDataForCustomLayer(e=!0){const r=this.getProjectionData({overscaledTileID:new d.a0(0,0,0,0,0),applyGlobeMatrix:e});return r.tileMercatorCoords=[0,0,1,1],r}getFastPathSimpleProjectionMatrix(e){}}class Xc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,r,l){return this._helper.interpolatePadding(e,r,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,r,l=!0){this._helper.resize(e,r,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrain(e){this._helper.setConstrain(e)}overrideNearFarZ(e,r){this._helper.overrideNearFarZ(e,r)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,r){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=r,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(r,l)=>this.currentTransform.defaultConstrain(r,l),this._helper=new tn({calcMatrices:()=>{this._calcMatrices()},constrain:(r,l)=>this.defaultConstrain(r,l)},e),this._globeness=1,this._mercatorTransform=new hr,this._verticalPerspectiveTransform=new Hc}clone(){const e=new Xc;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const r=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:r.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:r.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return d.bn(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return d.bn(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,r,l){const h=this._mercatorTransform.getPitchedTextCorrection(e,r,l),m=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,r,l);return d.bn(h,m,this._globeness)}projectTileCoordinates(e,r,l,h){return this.currentTransform.projectTileCoordinates(e,r,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,r){return this.currentTransform.lngLatToCameraDepth(e,r)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,r,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,r,l,h)}setLocationAtPoint(e,r){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,r),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,r),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,r){return this.currentTransform.locationToScreenPoint(e,r)}screenPointToMercatorCoordinate(e,r){return this.currentTransform.screenPointToMercatorCoordinate(e,r)}screenPointToLocation(e,r){return this.currentTransform.screenPointToLocation(e,r)}isPointOnMapSurface(e,r){return this.currentTransform.isPointOnMapSurface(e,r)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,r){return this.currentTransform.getMatrixForModel(e,r)}getProjectionDataForCustomLayer(e=!0){const r=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return r;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=r.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Pr{get useGlobeControls(){return!0}handlePanInertia(e,r){const l=Zc(e,r);return Math.abs(l.lng-r.center.lng)>180&&(l.lng=r.center.lng+179.5*Math.sign(l.lng-r.center.lng)),{easingCenter:l,easingOffset:new d.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,r){const l=e.around,h=r.screenPointToLocation(l);e.bearingDelta&&r.setBearing(r.bearing+e.bearingDelta),e.pitchDelta&&r.setPitch(r.pitch+e.pitchDelta),e.rollDelta&&r.setRoll(r.roll+e.rollDelta);const m=r.zoom;e.zoomDelta&&r.setZoom(r.zoom+e.zoomDelta);const y=r.zoom-m;if(y===0)return;const w=d.bD(r.center.lng,h.lng),T=w/(Math.abs(w/180)+1),A=d.bD(r.center.lat,h.lat),C=r.getRayDirectionFromPixel(l),I=r.cameraPosition,D=-1*d.a_(I,C),O=d.bs();d.aV(O,I,[C[0]*D,C[1]*D,C[2]*D]);const G=d.b0(O)-1,K=Math.exp(.5*-Math.max(G-.3,0)),W=Hl(r.worldSize,r.center.lat)/Math.min(r.width,r.height),Q=d.bq(W,.9,.5,1,.25),ne=(1-d.al(-y))*Math.min(K,Q),se=r.center.lat,te=r.zoom,oe=new d.U(r.center.lng+T*ne,d.ai(r.center.lat+A*ne,-d.aj,d.aj));r.setLocationAtPoint(h,l);const de=r.center,ae=d.bq(Math.abs(w),45,85,0,1),fe=d.bq(W,.75,.35,0,1),Pe=Math.pow(Math.max(ae,fe),.25),Se=d.bD(de.lng,oe.lng),Ce=d.bD(de.lat,oe.lat);r.setCenter(new d.U(de.lng+Se*Pe,de.lat+Ce*Pe).wrap()),r.setZoom(te+pi(se,r.center.lat))}handleMapControlsPan(e,r,l){if(!e.panDelta)return;const h=r.center.lat,m=r.zoom;r.setCenter(Zc(e.panDelta,r).wrap()),r.setZoom(m+pi(h,r.center.lat))}cameraForBoxAndBearing(e,r,l,h,m){const y=zr(e,r,l,h,m),w=r.left/m.width*2-1,T=(m.width-r.right)/m.width*2-1,A=r.top/m.height*-2+1,C=(m.height-r.bottom)/m.height*-2+1,I=d.bD(l.getWest(),l.getEast())<0,D=I?l.getEast():l.getWest(),O=I?l.getWest():l.getEast(),G=Math.max(l.getNorth(),l.getSouth()),K=Math.min(l.getNorth(),l.getSouth()),W=D+.5*d.bD(D,O),Q=G+.5*d.bD(G,K),ne=m.clone();ne.setCenter(y.center),ne.setBearing(y.bearing),ne.setPitch(0),ne.setRoll(0),ne.setZoom(y.zoom);const se=ne.modelViewProjectionMatrix,te=[qn(l.getNorthWest()),qn(l.getNorthEast()),qn(l.getSouthWest()),qn(l.getSouthEast()),qn(new d.U(O,Q)),qn(new d.U(D,Q)),qn(new d.U(W,G)),qn(new d.U(W,K))],oe=qn(y.center);let de=Number.POSITIVE_INFINITY;for(const ae of te)w<0&&(de=Pr.getLesserNonNegativeNonNull(de,Pr.solveVectorScale(ae,oe,se,"x",w))),T>0&&(de=Pr.getLesserNonNegativeNonNull(de,Pr.solveVectorScale(ae,oe,se,"x",T))),A>0&&(de=Pr.getLesserNonNegativeNonNull(de,Pr.solveVectorScale(ae,oe,se,"y",A))),C<0&&(de=Pr.getLesserNonNegativeNonNull(de,Pr.solveVectorScale(ae,oe,se,"y",C)));if(Number.isFinite(de)&&de!==0)return y.zoom=ne.zoom+d.ao(de),y;$i()}handleJumpToCenterZoom(e,r){const l=e.center.lat,h=e.constrain(r.center?d.U.convert(r.center):e.center,e.zoom).center;e.setCenter(h.wrap());const m=r.zoom!==void 0?+r.zoom:e.zoom+pi(l,h.lat);e.zoom!==m&&e.setZoom(m)}handleEaseTo(e,r){const l=e.zoom,h=e.center,m=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:r.roll===void 0?e.roll:r.roll,pitch:r.pitch===void 0?e.pitch:r.pitch,bearing:r.bearing===void 0?e.bearing:r.bearing},T=r.zoom!==void 0,A=!e.isPaddingEqual(r.padding);let C=!1;const I=r.center?d.U.convert(r.center):h,D=e.constrain(I,l).center;Bi(e,D);const O=e.clone();O.setCenter(D),O.setZoom(T?+r.zoom:l+pi(h.lat,I.lat)),O.setBearing(r.bearing);const G=new d.P(d.ai(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),d.ai(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));O.setLocationAtPoint(D,G);const K=(r.offset&&r.offsetAsPoint.mag())>0?O.center:D,W=T?+r.zoom:l+pi(h.lat,K.lat),Q=l+pi(h.lat,0),ne=W+pi(K.lat,0),se=d.bD(h.lng,K.lng),te=d.bD(h.lat,K.lat),oe=d.al(ne-Q);return C=W!==l,{easeFunc:de=>{if(d.bh(y,w)||Eo({startEulerAngles:y,endEulerAngles:w,tr:e,k:de,useSlerp:y.roll!=w.roll}),A&&e.interpolatePadding(m,r.padding,de),r.around)d.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(r.around,r.aroundPoint);else{const ae=ne>Q?Math.min(2,oe):Math.max(.5,oe),fe=Math.pow(ae,1-de),Pe=Yl(h,se,te,de*fe);e.setCenter(Pe.wrap())}if(C){const ae=d.F.number(Q,ne,de)+pi(0,e.center.lat);e.setZoom(ae)}},isZooming:C,elevationCenter:K}}handleFlyTo(e,r){const l=r.zoom!==void 0,h=e.center,m=e.zoom,y=e.padding,w=!e.isPaddingEqual(r.padding),T=e.constrain(d.U.convert(r.center||r.locationAtOffset),m).center,A=l?+r.zoom:e.zoom+pi(e.center.lat,T.lat),C=e.clone();C.setCenter(T),C.setZoom(A),C.setBearing(r.bearing);const I=new d.P(d.ai(e.centerPoint.x+r.offsetAsPoint.x,0,e.width),d.ai(e.centerPoint.y+r.offsetAsPoint.y,0,e.height));C.setLocationAtPoint(T,I);const D=C.center;Bi(e,D);const O=function(te,oe,de){const ae=qn(oe),fe=qn(de),Pe=d.a_(ae,fe),Se=Math.acos(Pe),Ce=gl(te);return Se/(2*Math.PI)*Ce}(e,h,D),G=m+pi(h.lat,0),K=A+pi(D.lat,0),W=d.al(K-G);let Q;if(typeof r.minZoom=="number"){const te=+r.minZoom+pi(D.lat,0),oe=Math.min(te,G,K)+pi(0,D.lat),de=e.constrain(D,oe).zoom+pi(D.lat,0);Q=d.al(de-G)}const ne=d.bD(h.lng,D.lng),se=d.bD(h.lat,D.lat);return{easeFunc:(te,oe,de,ae)=>{const fe=Yl(h,ne,se,de);w&&e.interpolatePadding(y,r.padding,te);const Pe=te===1?D:fe;e.setCenter(Pe.wrap());const Se=G+d.ao(oe);e.setZoom(te===1?A:Se+pi(0,Pe.lat))},scaleOfZoom:W,targetCenter:D,scaleOfMinZoom:Q,pixelPathLength:O}}static solveVectorScale(e,r,l,h,m){const y=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],w=[l[3],l[7],l[11],l[15]],T=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],A=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],C=r[0]*y[0]+r[1]*y[1]+r[2]*y[2],I=r[0]*w[0]+r[1]*w[1]+r[2]*w[2];return C+m*A===T+m*I||w[3]*(T-C)+y[3]*(I-A)+T*I==C*A?null:(C+y[3]-m*I-m*w[3])/(C-T-m*I+m*A)}static getLesserNonNegativeNonNull(e,r){return r!==null&&r>=0&&r<e?r:e}}class $l{constructor(e){this._globe=e,this._mercatorCameraHelper=new qr,this._verticalPerspectiveCameraHelper=new Pr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,r){return this.currentHelper.handlePanInertia(e,r)}handleMapControlsRollPitchBearingZoom(e,r){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,r)}handleMapControlsPan(e,r,l){this.currentHelper.handleMapControlsPan(e,r,l)}cameraForBoxAndBearing(e,r,l,h,m){return this.currentHelper.cameraForBoxAndBearing(e,r,l,h,m)}handleJumpToCenterZoom(e,r){this.currentHelper.handleJumpToCenterZoom(e,r)}handleEaseTo(e,r){return this.currentHelper.handleEaseTo(e,r)}handleFlyTo(e,r){return this.currentHelper.handleFlyTo(e,r)}}const _l=(f,e)=>d.z(f,e&&e.filter(r=>r.identifier!=="source.canvas")),Yc=d.bH();class Kl extends d.E{constructor(e,r={}){var l,h;super(),this._rtlPluginLoaded=()=>{for(const y in this.tileManagers){const w=this.tileManagers[y].getSource().type;w!=="vector"&&w!=="geojson"||this.tileManagers[y].reload()}},this.map=e,this.dispatcher=new ai(fi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,w)=>this.getGlyphs(y,w)),this.dispatcher.registerMessageHandler("GI",(y,w)=>this.getImages(y,w)),this.dispatcher.registerMessageHandler("GDA",(y,w)=>this.getDashes(y,w)),this.imageManager=new bi,this.imageManager.setEventedParent(this);const m=((l=e._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((h=document.documentElement)===null||h===void 0?void 0:h.lang)||void 0;this.glyphManager=new Be(e._requestManager,r.localIdeographFontFamily,m),this.lineAtlas=new Ze(256,512),this.crossTileSymbolIndex=new fs,this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new d.bI,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",d.bJ()),N().on(bo,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const w=this.tileManagers[y.sourceId];if(!w)return;const T=w.getSource();if(T&&T.vectorLayerIds)for(const A in this._layers){const C=this._layers[A];C.source===T.id&&this._validateLayer(C)}})}setGlobalStateProperty(e,r){var l,h,m;this._checkLoaded();const y=r===null?(m=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[e])===null||h===void 0?void 0:h.default)!==null&&m!==void 0?m:null:r;if(d.bK(y,this._globalState[e]))return this;this._globalState[e]=y,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const r=[];for(const l in e)!d.bK(this._globalState[l],e[l].default)&&(r.push(l),this._globalState[l]=e[l].default);this._applyGlobalStateChanges(r)}_applyGlobalStateChanges(e){if(e.length===0)return;const r=new Set,l={};for(const h of e){l[h]=this._globalState[h];for(const m in this._layers){const y=this._layers[m],w=y.getLayoutAffectingGlobalStateRefs(),T=y.getPaintAffectingGlobalStateRefs();if(w.has(h)&&r.add(y.source),T.has(h))for(const{name:A,value:C}of T.get(h))this._updatePaintProperty(y,A,C)}}this.dispatcher.broadcast("UGS",l);for(const h in this.tileManagers)r.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(e,r={},l){this.fire(new d.l("dataloading",{dataType:"style"})),r.validate=typeof r.validate!="boolean"||r.validate;const h=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const m=this._loadStyleRequest;d.j(h,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,r,l)}).catch(y=>{this._loadStyleRequest=null,y&&!m.signal.aborted&&this.fire(new d.k(y))})}loadJSON(e,r={},l){this.fire(new d.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,et.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,r.validate=r.validate!==!1,this._load(e,r,l)}).catch(()=>{})}loadEmpty(){this.fire(new d.l("dataloading",{dataType:"style"})),this._load(Yc,{validate:!1})}_load(e,r,l){var h,m;let y=r.transformStyle?r.transformStyle(l,e):e;if(!r.validate||!_l(this,d.B(y))){y=Object.assign({},y),this._loaded=!0,this.stylesheet=y;for(const w in y.sources)this.addSource(w,y.sources[w],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new pt(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new me(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new d.l("data",{dataType:"style"})),this.fire(new d.l("style.load"))}}_createLayers(){var e,r,l;const h=d.bL(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",h),this._order=h.map(m=>m.id),this._layers={},this._serializedLayers=null;for(const m of h){const y=d.bM(m,this._globalState);if(y.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=y,d.bN(y)&&this.tileManagers[y.source]){const w=(l=(r=m.paint)===null||r===void 0?void 0:r["raster-fade-duration"])!==null&&l!==void 0?l:y.paint.get("raster-fade-duration");this.tileManagers[y.source].setRasterFadeDuration(w)}}}_loadSprite(e,r=!1,l=void 0){let h;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,y,w,T){return d._(this,void 0,void 0,function*(){const A=ln(m),C=w>1?"@2x":"",I={},D={};for(const{id:O,url:G}of A){const K=y.transformRequest(_n(G,C,".json"),"SpriteJSON");I[O]=d.j(K,T);const W=y.transformRequest(_n(G,C,".png"),"SpriteImage");D[O]=hi.getImage(W,T)}return yield Promise.all([...Object.values(I),...Object.values(D)]),function(O,G){return d._(this,void 0,void 0,function*(){const K={};for(const W in O){K[W]={};const Q=et.getImageCanvasContext((yield G[W]).data),ne=(yield O[W]).data;for(const se in ne){const{width:te,height:oe,x:de,y:ae,sdf:fe,pixelRatio:Pe,stretchX:Se,stretchY:Ce,content:Ie,textFitWidth:Ke,textFitHeight:We}=ne[se];K[W][se]={data:null,pixelRatio:Pe,sdf:fe,stretchX:Se,stretchY:Ce,content:Ie,textFitWidth:Ke,textFitHeight:We,spriteData:{width:te,height:oe,x:de,y:ae,context:Q}}}}return K})}(I,D)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(const y in m){this._spritesImagesIds[y]=[];const w=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(T=>!(T in m)):[];for(const T of w)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in m[y]){const A=y==="default"?T:`${y}:${T}`;this._spritesImagesIds[y].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,m[y][T],!1):this.imageManager.addImage(A,m[y][T]),r&&(this._changedImages[A]=!0)}}}).catch(m=>{this._spriteRequest=null,h=m,this.fire(new d.k(h))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),r&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"})),l&&l(h)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}_validateLayer(e){const r=this.tileManagers[e.source];if(!r)return;const l=e.sourceLayer;if(!l)return;const h=r.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.tileManagers)if(!this.tileManagers[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,r=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(r?d.bO(l):l);const h=[];for(const m of e)if(l[m]){const y=r?d.bO(l[m]):l[m];h.push(y)}return h}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const r=Object.keys(this._layers);for(const l of r){const h=this._layers[l];h.type!=="custom"&&(e[l]=h.serialize())}return e}hasTransitions(){var e,r,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((r=this.sky)===null||r===void 0)&&r.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.tileManagers)if(this.tileManagers[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const r=this._changed;if(r){const h=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(h.length||m.length)&&this._updateWorkerLayers(h,m);for(const y in this._updatedSources){const w=this._updatedSources[y];if(w==="reload")this._reloadSource(y);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const h in this.tileManagers){const m=this.tileManagers[h];l[h]=m.used,m.used=!1}for(const h of this._order){const m=this._layers[h];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.tileManagers[m.source].used=!0)}for(const h in l){const m=this.tileManagers[h];!!l[h]!=!!m.used&&m.fire(new d.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,r&&this.fire(new d.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const r in this.tileManagers)this.tileManagers[r].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.tileManagers)this.tileManagers[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,r){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:r})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,r={}){var l;this._checkLoaded();const h=this.serialize();if(e=r.transformStyle?r.transformStyle(h,e):e,((l=r.validate)===null||l===void 0||l)&&_l(this,d.B(e)))return!1;(e=d.bO(e)).layers=d.bL(e.layers);const m=d.bP(h,e),y=this._getOperationsToPerform(m);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const w of y.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const r=[],l=[];for(const h of e)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":r.push(()=>this.addLayer.apply(this,h.args));break;case"removeLayer":r.push(()=>this.removeLayer.apply(this,h.args));break;case"setPaintProperty":r.push(()=>this.setPaintProperty.apply(this,h.args));break;case"setLayoutProperty":r.push(()=>this.setLayoutProperty.apply(this,h.args));break;case"setFilter":r.push(()=>this.setFilter.apply(this,h.args));break;case"addSource":r.push(()=>this.addSource.apply(this,h.args));break;case"removeSource":r.push(()=>this.removeSource.apply(this,h.args));break;case"setLayerZoomRange":r.push(()=>this.setLayerZoomRange.apply(this,h.args));break;case"setLight":r.push(()=>this.setLight.apply(this,h.args));break;case"setGeoJSONSourceData":r.push(()=>this.setGeoJSONSourceData.apply(this,h.args));break;case"setGlyphs":r.push(()=>this.setGlyphs.apply(this,h.args));break;case"setSprite":r.push(()=>this.setSprite.apply(this,h.args));break;case"setTerrain":r.push(()=>this.map.setTerrain.apply(this,h.args));break;case"setSky":r.push(()=>this.setSky.apply(this,h.args));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":r.push(()=>this.setGlobalState.apply(this,h.args));break;case"setTransition":r.push(()=>{});break;default:l.push(h.command)}return{operations:r,unimplemented:l}}addImage(e,r){if(this.getImage(e))return this.fire(new d.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,r),this._afterImageUpdated(e)}updateImage(e,r){this.imageManager.updateImage(e,r)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,r,l={}){if(this._checkLoaded(),this.tileManagers[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(d.B.source,`sources.${e}`,r,null,l))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const h=this.tileManagers[e]=new Yi(e,r,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:e})),h.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new d.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const r=this.tileManagers[e];delete this.tileManagers[e],delete this._updatedSources[e],r.fire(new d.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,r){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.tileManagers[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(r),this._changed=!0}getSource(e){return this.tileManagers[e]&&this.tileManagers[e].getSource()}addLayer(e,r,l={}){this._checkLoaded();const h=e.id;if(this.getLayer(h))return void this.fire(new d.k(new Error(`Layer "${h}" already exists on this map.`)));let m;if(e.type==="custom"){if(_l(this,d.bQ(e)))return;m=d.bM(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(h,e.source),e=d.bO(e),e=d.e(e,{source:h})),this._validate(d.B.layer,`layers.${h}`,e,{arrayIndex:-1},l))return;m=d.bM(e,this._globalState),this._validateLayer(m),m.setEventedParent(this,{layer:{id:h}})}const y=r?this._order.indexOf(r):this._order.length;if(r&&y===-1)this.fire(new d.k(new Error(`Cannot add layer "${h}" before non-existing layer "${r}".`)));else{if(this._order.splice(y,0,h),this._layerOrderChanged=!0,this._layers[h]=m,this._removedLayers[h]&&m.source&&m.type!=="custom"){const w=this._removedLayers[h];delete this._removedLayers[h],w.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.tileManagers[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,r){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===r)return;const l=this._order.indexOf(e);this._order.splice(l,1);const h=r?this._order.indexOf(r):this._order.length;r&&h===-1?this.fire(new d.k(new Error(`Cannot move layer "${e}" before non-existing layer "${r}".`))):(this._order.splice(h,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const r=this._layers[e];if(!r)return void this.fire(new d.k(new Error(`Cannot remove non-existing layer "${e}".`)));r.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,r,l){this._checkLoaded();const h=this.getLayer(e);h?h.minzoom===r&&h.maxzoom===l||(r!=null&&(h.minzoom=r),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new d.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,r,l={}){this._checkLoaded();const h=this.getLayer(e);if(h){if(!d.bK(h.filter,r))return r==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(d.B.filter,`layers.${h.id}.filter`,r,null,l)||(h.setFilter(d.bO(r)),this._updateLayer(h)))}else this.fire(new d.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.bO(this.getLayer(e).filter)}setLayoutProperty(e,r,l,h={}){this._checkLoaded();const m=this.getLayer(e);m?d.bK(m.getLayoutProperty(r),l)||(m.setLayoutProperty(r,l,h),this._updateLayer(m)):this.fire(new d.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,r){const l=this.getLayer(e);if(l)return l.getLayoutProperty(r);this.fire(new d.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,r,l,h={}){this._checkLoaded();const m=this.getLayer(e);m?d.bK(m.getPaintProperty(r),l)||this._updatePaintProperty(m,r,l,h):this.fire(new d.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,r,l,h={}){e.setPaintProperty(r,l,h)&&this._updateLayer(e),d.bN(e)&&r==="raster-fade-duration"&&this.tileManagers[e.source].setRasterFadeDuration(l),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,r){return this.getLayer(e).getPaintProperty(r)}setFeatureState(e,r){this._checkLoaded();const l=e.source,h=e.sourceLayer,m=this.tileManagers[l];if(m===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const y=m.getSource().type;y==="geojson"&&h?this.fire(new d.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||h?(e.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),m.setFeatureState(h,e.id,r)):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,r){this._checkLoaded();const l=e.source,h=this.tileManagers[l];if(h===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const m=h.getSource().type,y=m==="vector"?e.sourceLayer:void 0;m!=="vector"||y?r&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(y,e.id,r):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const r=e.source,l=e.sourceLayer,h=this.tileManagers[r];if(h!==void 0)return h.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,e.id)):void this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.k(new Error(`The source '${r}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.bR(this.tileManagers,m=>m.serialize()),r=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return d.bS({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:e,layers:r,terrain:l},m=>m!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.tileManagers[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.tileManagers[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const r=y=>this._layers[y].type==="fill-extrusion",l={},h=[];for(let y=this._order.length-1;y>=0;y--){const w=this._order[y];if(r(w)){l[w]=y;for(const T of e){const A=T[w];if(A)for(const C of A)h.push(C)}}}h.sort((y,w)=>w.intersectionZ-y.intersectionZ);const m=[];for(let y=this._order.length-1;y>=0;y--){const w=this._order[y];if(r(w))for(let T=h.length-1;T>=0;T--){const A=h[T].feature;if(l[A.layer.id]<y)break;m.push(A),h.pop()}else for(const T of e){const A=T[w];if(A)for(const C of A)m.push(C.feature)}}return m}queryRenderedFeatures(e,r,l){r&&r.filter&&this._validate(d.B.filter,"queryRenderedFeatures.filter",r.filter,null,r);const h={};if(r&&r.layers){if(!(Array.isArray(r.layers)||r.layers instanceof Set))return this.fire(new d.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const A of r.layers){const C=this._layers[A];if(!C)return this.fire(new d.k(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];h[C.source]=!0}}const m=[];r.availableImages=this._availableImages;const y=this._serializedAllLayers(),w=r.layers instanceof Set?r.layers:Array.isArray(r.layers)?new Set(r.layers):null,T=Object.assign(Object.assign({},r),{layers:w,globalState:this._globalState});for(const A in this.tileManagers)r.layers&&!h[A]||m.push(ta(this.tileManagers[A],this._layers,y,e,T,l,this.map.terrain?(C,I,D)=>this.map.terrain.getElevation(C,I,D):void 0));return this.placement&&m.push(function(A,C,I,D,O,G,K){const W={},Q=G.queryRenderedSymbols(D),ne=[];for(const se of Object.keys(Q).map(Number))ne.push(K[se]);ne.sort(Er);for(const se of ne){const te=se.featureIndex.lookupSymbolFeatures(Q[se.bucketInstanceId],C,se.bucketIndex,se.sourceLayerIndex,{filterSpec:O.filter,globalState:O.globalState},O.layers,O.availableImages,A);for(const oe in te){const de=W[oe]=W[oe]||[],ae=te[oe];ae.sort((fe,Pe)=>{const Se=se.featureSortOrder;if(Se){const Ce=Se.indexOf(fe.featureIndex);return Se.indexOf(Pe.featureIndex)-Ce}return Pe.featureIndex-fe.featureIndex});for(const fe of ae)de.push(fe)}}return function(se,te,oe){for(const de in se)for(const ae of se[de])ki(ae,oe[te[de].source]);return se}(W,A,I)}(this._layers,y,this.tileManagers,e,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,r){r?.filter&&this._validate(d.B.filter,"querySourceFeatures.filter",r.filter,null,r);const l=this.tileManagers[e];return l?function(h,m){const y=h.getRenderableIds().map(A=>h.getTileByID(A)),w=[],T={};for(let A=0;A<y.length;A++){const C=y[A],I=C.tileID.canonical.key;T[I]||(T[I]=!0,C.querySourceFeatures(w,m))}return w}(l,r?Object.assign(Object.assign({},r),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,r={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const y in e)if(!d.bK(e[y],l[y])){h=!0;break}if(!h)return;const m={now:mt(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(m)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,r={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!e&&!l)return;if(e&&!l)h=!0;else if(!e&&l)h=!0;else for(const y in e)if(!d.bK(e[y],l[y])){h=!0;break}if(!h)return;const m={now:mt(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,r),this.sky.updateTransitions(m)}_setProjectionInternal(e){const r=function(l,h){const m={constrain:h};if(Array.isArray(l)){const y=new Ao({type:l});return{projection:y,transform:new Xc(m),cameraHelper:new $l(y)}}switch(l){case"mercator":return{projection:new Zn,transform:new hr(m),cameraHelper:new qr};case"globe":{const y=new Ao({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:y,transform:new Xc(m),cameraHelper:new $l(y)}}case"vertical-perspective":return{projection:new Vc,transform:new Hc(m),cameraHelper:new Pr};default:return d.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Zn,transform:new hr(m),cameraHelper:new qr}}}(e,this.map.transformConstrain);this.projection=r.projection,this.map.migrateProjection(r.transform,r.cameraHelper);for(const l in this.tileManagers)this.tileManagers[l].reload()}_validate(e,r,l,h,m={}){return(!m||m.validate!==!1)&&_l(this,e.call(d.B,d.e({key:r,style:this.serialize(),value:l,styleSpec:d.t},h)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),N().off(bo,this._rtlPluginLoaded);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this.tileManagers){const l=this.tileManagers[r];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.tileManagers[e].clearTiles()}_reloadSource(e){this.tileManagers[e].resume(),this.tileManagers[e].reload()}_updateSources(e){for(const r in this.tileManagers)this.tileManagers[r].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.tileManagers)this._reloadSource(e)}_updatePlacement(e,r,l,h,m=!1){let y=!1,w=!1;const T={};for(const A of this._order){const C=this._layers[A];if(C.type!=="symbol")continue;if(!T[C.source]){const D=this.tileManagers[C.source];T[C.source]=D.getRenderableIds(!0).map(O=>D.getTileByID(O)).sort((O,G)=>G.tileID.overscaledZ-O.tileID.overscaledZ||(O.tileID.isLessThan(G.tileID)?-1:1))}const I=this.crossTileSymbolIndex.addLayer(C,T[C.source],e.center.lng);y=y||I}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(mt(),e.zoom))&&(this.pauseablePlacement=new ds(e,this.map.terrain,this._order,m,r,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(mt()),w=!0),y&&this.pauseablePlacement.placement.setStale()),w||y)for(const A of this._order){const C=this._layers[A];C.type==="symbol"&&this.placement.updateLayerOpacities(C,T[C.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(mt())}_releaseSymbolFadeTiles(){for(const e in this.tileManagers)this.tileManagers[e].releaseSymbolFadeTiles()}getImages(e,r){return d._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(r.icons);this._updateTilesForChangedImages();const h=this.tileManagers[r.source];return h&&h.setDependencies(r.tileID.key,r.type,r.icons),l})}getGlyphs(e,r){return d._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(r.stacks),h=this.tileManagers[r.source];return h&&h.setDependencies(r.tileID.key,r.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,r={}){this._checkLoaded(),e&&this._validate(d.B.glyphs,"glyphs",e,null,r)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,r){return d._(this,void 0,void 0,function*(){const l={};for(const[h,m]of Object.entries(r.dashes))l[h]=this.lineAtlas.getDash(m.dasharray,m.round);return l})}addSprite(e,r,l={},h){this._checkLoaded();const m=[{id:e,url:r}],y=[...ln(this.stylesheet.sprite),...m];this._validate(d.B.sprite,"sprite",y,null,l)||(this.stylesheet.sprite=y,this._loadSprite(m,!0,h))}removeSprite(e){this._checkLoaded();const r=ln(this.stylesheet.sprite);if(r.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;r.splice(r.findIndex(l=>l.id===e),1),this.stylesheet.sprite=r.length>0?r:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}else this.fire(new d.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return ln(this.stylesheet.sprite)}setSprite(e,r={},l){this._checkLoaded(),e&&this._validate(d.B.sprite,"sprite",e,null,r)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var qu=d.aN([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class fr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,r,l,h,m,y,w,T,A){this.context=e;let C=this.boundPaintVertexBuffers.length!==h.length;for(let I=0;!C&&I<h.length;I++)this.boundPaintVertexBuffers[I]!==h[I]&&(C=!0);!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==l||C||this.boundIndexBuffer!==m||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==A?this.freshBind(r,l,h,m,y,w,T,A):(e.bindVertexArray.set(this.vao),w&&w.bind(),m&&m.dynamicDraw&&m.bind(),T&&T.bind(),A&&A.bind())}freshBind(e,r,l,h,m,y,w,T){const A=e.numAttributes,C=this.context,I=C.gl;this.vao&&this.destroy(),this.vao=C.createVertexArray(),C.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T,r.enableAttributes(I,e);for(const D of l)D.enableAttributes(I,e);y&&y.enableAttributes(I,e),w&&w.enableAttributes(I,e),T&&T.enableAttributes(I,e),r.bind(),r.setVertexAttribPointers(I,e,m);for(const D of l)D.bind(),D.setVertexAttribPointers(I,e,m);y&&(y.bind(),y.setVertexAttribPointers(I,e,m)),h&&h.bind(),w&&(w.bind(),w.setVertexAttribPointers(I,e,m)),T&&(T.bind(),T.setVertexAttribPointers(I,e,m)),C.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Wl=(f,e,r,l,h)=>({u_texture:0,u_ele_delta:f,u_fog_matrix:e,u_fog_color:r?r.properties.get("fog-color"):d.bi.white,u_fog_ground_blend:r?r.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:r?r.calculateFogBlendOpacity(l):0,u_horizon_color:r?r.properties.get("horizon-color"):d.bi.white,u_horizon_fog_blend:r?r.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Hu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function _s(f){const e=[];for(let r=0;r<f.length;r++){if(f[r]===null)continue;const l=f[r].split(" ");e.push(l.pop())}return e}class yl{constructor(e,r,l,h,m,y,w,T,A=[]){const C=e.gl;this.program=C.createProgram();const I=_s(r.staticAttributes),D=l?l.getBinderAttributes():[],O=I.concat(D),G=Dt.prelude.staticUniforms?_s(Dt.prelude.staticUniforms):[],K=w.staticUniforms?_s(w.staticUniforms):[],W=r.staticUniforms?_s(r.staticUniforms):[],Q=l?l.getBinderUniforms():[],ne=G.concat(K).concat(W).concat(Q),se=[];for(const Se of ne)se.indexOf(Se)<0&&se.push(Se);const te=l?l.defines():[];Ba(C)&&te.unshift("#version 300 es"),m&&te.push("#define OVERDRAW_INSPECTOR;"),y&&te.push("#define TERRAIN3D;"),T&&te.push(T),A&&te.push(...A);let oe=te.concat(Dt.prelude.fragmentSource,w.fragmentSource,r.fragmentSource).join(`
`),de=te.concat(Dt.prelude.vertexSource,w.vertexSource,r.vertexSource).join(`
`);Ba(C)||(oe=function(Se){return Se.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(oe),de=function(Se){return Se.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(de));const ae=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(ae,oe),C.compileShader(ae),!C.getShaderParameter(ae,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(ae)}`);C.attachShader(this.program,ae);const fe=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(fe,de),C.compileShader(fe),!C.getShaderParameter(fe,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(fe)}`);C.attachShader(this.program,fe),this.attributes={};const Pe={};this.numAttributes=O.length;for(let Se=0;Se<this.numAttributes;Se++)O[Se]&&(C.bindAttribLocation(this.program,Se,O[Se]),this.attributes[O[Se]]=Se);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(fe),C.deleteShader(ae);for(let Se=0;Se<se.length;Se++){const Ce=se[Se];if(Ce&&!Pe[Ce]){const Ie=C.getUniformLocation(this.program,Ce);Ie&&(Pe[Ce]=Ie)}}this.fixedUniforms=h(e,Pe),this.terrainUniforms=((Se,Ce)=>({u_depth:new d.bT(Se,Ce.u_depth),u_terrain:new d.bT(Se,Ce.u_terrain),u_terrain_dim:new d.bj(Se,Ce.u_terrain_dim),u_terrain_matrix:new d.bV(Se,Ce.u_terrain_matrix),u_terrain_unpack:new d.bW(Se,Ce.u_terrain_unpack),u_terrain_exaggeration:new d.bj(Se,Ce.u_terrain_exaggeration)}))(e,Pe),this.projectionUniforms=((Se,Ce)=>({u_projection_matrix:new d.bV(Se,Ce.u_projection_matrix),u_projection_tile_mercator_coords:new d.bW(Se,Ce.u_projection_tile_mercator_coords),u_projection_clipping_plane:new d.bW(Se,Ce.u_projection_clipping_plane),u_projection_transition:new d.bj(Se,Ce.u_projection_transition),u_projection_fallback_matrix:new d.bV(Se,Ce.u_projection_fallback_matrix)}))(e,Pe),this.binderUniforms=l?l.getUniforms(e,Pe):[]}draw(e,r,l,h,m,y,w,T,A,C,I,D,O,G,K,W,Q,ne,se){const te=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(h),e.setColorMode(m),e.setCullFace(y),T){e.activeTexture.set(te.TEXTURE2),te.bindTexture(te.TEXTURE_2D,T.depthTexture),e.activeTexture.set(te.TEXTURE3),te.bindTexture(te.TEXTURE_2D,T.texture);for(const de in this.terrainUniforms)this.terrainUniforms[de].set(T[de])}if(A)for(const de in A)this.projectionUniforms[Hu[de]].set(A[de]);if(w)for(const de in this.fixedUniforms)this.fixedUniforms[de].set(w[de]);W&&W.setUniforms(e,this.binderUniforms,G,{zoom:K});let oe=0;switch(r){case te.LINES:oe=2;break;case te.TRIANGLES:oe=3;break;case te.LINE_STRIP:oe=1}for(const de of O.get()){const ae=de.vaos||(de.vaos={});(ae[C]||(ae[C]=new fr)).bind(e,this,I,W?W.getPaintVertexBuffers():[],D,de.vertexOffset,Q,ne,se),te.drawElements(r,de.primitiveLength*oe,te.UNSIGNED_SHORT,de.primitiveOffset*oe*2)}}}function Xu(f,e,r){const l=1/d.aG(r,1,e.transform.tileZoom),h=Math.pow(2,r.tileID.overscaledZ),m=r.tileSize*Math.pow(2,e.transform.tileZoom)/h,y=m*(r.tileID.canonical.x+r.tileID.wrap*h),w=m*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[y>>16,w>>16],u_pixel_coord_lower:[65535&y,65535&w]}}const vl=(f,e,r,l)=>{const h=f.style.light,m=h.properties.get("position"),y=[m.x,m.y,m.z],w=d.bZ();h.properties.get("anchor")==="viewport"&&d.b_(w,f.transform.bearingInRadians),d.b$(y,y,w);const T=f.transform.transformLightDirection(y),A=h.properties.get("color");return{u_lightpos:y,u_lightpos_globe:T,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+e,u_opacity:r,u_fill_translate:l}},Hh=(f,e,r,l,h,m,y)=>d.e(vl(f,e,r,l),Xu(m,f,y),{u_height_factor:-Math.pow(2,h.overscaledZ)/y.tileSize/8}),pr=(f,e,r,l)=>d.e(Xu(e,f,r),{u_fill_translate:l}),Gd=(f,e)=>({u_world:f,u_fill_translate:e}),Xh=(f,e,r,l,h)=>d.e(pr(f,e,r,h),{u_world:l}),Zd=(f,e,r,l,h)=>{const m=f.transform;let y,w,T=0;if(r.paint.get("circle-pitch-alignment")==="map"){const A=d.aG(e,1,m.zoom);y=!0,w=[A,A],T=A/(d.a3*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*h}else y=!1,w=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(r.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:T,u_translate:l}},Yu=f=>({u_pixel_extrude_scale:[1/f.width,1/f.height]}),$c=f=>({u_viewport_size:[f.width,f.height]}),zo=(f,e=1)=>({u_color:f,u_overlay:0,u_overlay_scale:e}),Po=(f,e,r,l)=>{const h=d.aG(f,1,e)/(d.a3*Math.pow(2,f.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:d.aG(f,1,e),u_intensity:r,u_globe_extrude_scale:h}},$u=(f,e,r,l)=>{const h=d.M();d.c0(h,0,f.width,f.height,0,0,1);const m=f.context.gl;return{u_matrix:h,u_world:[m.drawingBufferWidth,m.drawingBufferHeight],u_image:r,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},Ql=(f,e,r)=>{const l=r.paint.get("hillshade-accent-color");let h;switch(r.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const m=r.getIlluminationProperties();for(let y=0;y<m.directionRadians.length;y++)r.paint.get("hillshade-illumination-anchor")==="viewport"&&(m.directionRadians[y]+=f.transform.bearingInRadians);return{u_image:0,u_latrange:Ku(0,e.tileID),u_exaggeration:r.paint.get("hillshade-exaggeration"),u_altitudes:m.altitudeRadians,u_azimuths:m.directionRadians,u_accent:l,u_method:h,u_highlights:m.highlightColor,u_shadows:m.shadowColor}},Qs=(f,e)=>{const r=e.stride,l=d.M();return d.c0(l,0,d.a3,-d.a3,0,0,1),d.N(l,l,[0,-d.a3,0]),{u_matrix:l,u_image:1,u_dimension:[r,r],u_zoom:f.overscaledZ,u_unpack:e.getUnpackVector()}};function Ku(f,e){const r=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new d.a5(0,l/r).toLngLat().lat,new d.a5(0,(l+1)/r).toLngLat().lat]}const Kc=(f,e,r=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:r,u_opacity:f.paint.get("color-relief-opacity")}),Hr=(f,e,r,l)=>{const h=f.transform;return{u_translation:Wu(f,e,r),u_ratio:l/d.aG(e,1,h.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Yh=(f,e,r,l,h)=>d.e(Hr(f,e,r,l),{u_image:0,u_image_height:h}),Jl=(f,e,r,l,h)=>{const m=f.transform,y=Wc(e,m);return{u_translation:Wu(f,e,r),u_texsize:e.imageAtlasTexture.size,u_ratio:l/d.aG(e,1,m.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[y,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},$h=(f,e,r,l,h)=>{const m=Wc(e,f.transform);return d.e(Hr(f,e,r,l),{u_tileratio:m,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image:0,u_mix:h.t,u_lineatlas_width:f.lineAtlas.width,u_lineatlas_height:f.lineAtlas.height})},qd=(f,e,r,l,h,m)=>{const y=Wc(e,f.transform);return d.e(Hr(f,e,r,l),{u_image:0,u_image_height:m,u_tileratio:y,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image_dash:1,u_mix:h.t,u_lineatlas_width:f.lineAtlas.width,u_lineatlas_height:f.lineAtlas.height})};function Wc(f,e){return 1/d.aG(f,1,e.tileZoom)}function Wu(f,e,r){return d.aH(f.transform,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Kh=(f,e,r,l,h)=>{return{u_tl_parent:f,u_scale_parent:e,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(m=l.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:Qu(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var m,y};function Qu(f){f*=Math.PI/180;const e=Math.sin(f),r=Math.cos(f);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}const Ta=(f,e,r,l,h,m,y,w,T,A,C,I,D)=>{const O=y.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:O.width/O.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:T,u_is_text:+C,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:m,u_texsize:I,u_texture:0,u_translation:A,u_pitched_scale:D}},ys=(f,e,r,l,h,m,y,w,T,A,C,I,D,O)=>{const G=y.transform;return d.e(Ta(f,e,r,l,h,m,y,w,T,A,C,I,O),{u_gamma_scale:l?Math.cos(G.pitch*Math.PI/180)*G.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},Xr=(f,e,r,l,h,m,y,w,T,A,C,I,D)=>d.e(ys(f,e,r,l,h,m,y,w,T,A,!0,C,0,D),{u_texsize_icon:I,u_texture_icon:1}),Qc=(f,e)=>({u_opacity:f,u_color:e}),Jc=(f,e,r,l,h)=>d.e(function(m,y,w,T){const A=w.imageManager.getPattern(m.from.toString()),C=w.imageManager.getPattern(m.to.toString()),{width:I,height:D}=w.imageManager.getPixelSize(),O=Math.pow(2,T.tileID.overscaledZ),G=T.tileSize*Math.pow(2,w.transform.tileZoom)/O,K=G*(T.tileID.canonical.x+T.tileID.wrap*O),W=G*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:C.tl,u_pattern_br_b:C.br,u_texsize:[I,D],u_mix:y.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:C.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/d.aG(T,1,w.transform.tileZoom),u_pixel_coord_upper:[K>>16,W>>16],u_pixel_coord_lower:[65535&K,65535&W]}}(r,h,e,l),{u_opacity:f}),ec=(f,e)=>{},eu={fillExtrusion:(f,e)=>({u_lightpos:new d.bX(f,e.u_lightpos),u_lightpos_globe:new d.bX(f,e.u_lightpos_globe),u_lightintensity:new d.bj(f,e.u_lightintensity),u_lightcolor:new d.bX(f,e.u_lightcolor),u_vertical_gradient:new d.bj(f,e.u_vertical_gradient),u_opacity:new d.bj(f,e.u_opacity),u_fill_translate:new d.bY(f,e.u_fill_translate)}),fillExtrusionPattern:(f,e)=>({u_lightpos:new d.bX(f,e.u_lightpos),u_lightpos_globe:new d.bX(f,e.u_lightpos_globe),u_lightintensity:new d.bj(f,e.u_lightintensity),u_lightcolor:new d.bX(f,e.u_lightcolor),u_vertical_gradient:new d.bj(f,e.u_vertical_gradient),u_height_factor:new d.bj(f,e.u_height_factor),u_opacity:new d.bj(f,e.u_opacity),u_fill_translate:new d.bY(f,e.u_fill_translate),u_image:new d.bT(f,e.u_image),u_texsize:new d.bY(f,e.u_texsize),u_pixel_coord_upper:new d.bY(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bY(f,e.u_pixel_coord_lower),u_scale:new d.bX(f,e.u_scale),u_fade:new d.bj(f,e.u_fade)}),fill:(f,e)=>({u_fill_translate:new d.bY(f,e.u_fill_translate)}),fillPattern:(f,e)=>({u_image:new d.bT(f,e.u_image),u_texsize:new d.bY(f,e.u_texsize),u_pixel_coord_upper:new d.bY(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bY(f,e.u_pixel_coord_lower),u_scale:new d.bX(f,e.u_scale),u_fade:new d.bj(f,e.u_fade),u_fill_translate:new d.bY(f,e.u_fill_translate)}),fillOutline:(f,e)=>({u_world:new d.bY(f,e.u_world),u_fill_translate:new d.bY(f,e.u_fill_translate)}),fillOutlinePattern:(f,e)=>({u_world:new d.bY(f,e.u_world),u_image:new d.bT(f,e.u_image),u_texsize:new d.bY(f,e.u_texsize),u_pixel_coord_upper:new d.bY(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bY(f,e.u_pixel_coord_lower),u_scale:new d.bX(f,e.u_scale),u_fade:new d.bj(f,e.u_fade),u_fill_translate:new d.bY(f,e.u_fill_translate)}),circle:(f,e)=>({u_camera_to_center_distance:new d.bj(f,e.u_camera_to_center_distance),u_scale_with_map:new d.bT(f,e.u_scale_with_map),u_pitch_with_map:new d.bT(f,e.u_pitch_with_map),u_extrude_scale:new d.bY(f,e.u_extrude_scale),u_device_pixel_ratio:new d.bj(f,e.u_device_pixel_ratio),u_globe_extrude_scale:new d.bj(f,e.u_globe_extrude_scale),u_translate:new d.bY(f,e.u_translate)}),collisionBox:(f,e)=>({u_pixel_extrude_scale:new d.bY(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_viewport_size:new d.bY(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new d.bU(f,e.u_color),u_overlay:new d.bT(f,e.u_overlay),u_overlay_scale:new d.bj(f,e.u_overlay_scale)}),depth:ec,clippingMask:ec,heatmap:(f,e)=>({u_extrude_scale:new d.bj(f,e.u_extrude_scale),u_intensity:new d.bj(f,e.u_intensity),u_globe_extrude_scale:new d.bj(f,e.u_globe_extrude_scale)}),heatmapTexture:(f,e)=>({u_matrix:new d.bV(f,e.u_matrix),u_world:new d.bY(f,e.u_world),u_image:new d.bT(f,e.u_image),u_color_ramp:new d.bT(f,e.u_color_ramp),u_opacity:new d.bj(f,e.u_opacity)}),hillshade:(f,e)=>({u_image:new d.bT(f,e.u_image),u_latrange:new d.bY(f,e.u_latrange),u_exaggeration:new d.bj(f,e.u_exaggeration),u_altitudes:new d.c2(f,e.u_altitudes),u_azimuths:new d.c2(f,e.u_azimuths),u_accent:new d.bU(f,e.u_accent),u_method:new d.bT(f,e.u_method),u_shadows:new d.c1(f,e.u_shadows),u_highlights:new d.c1(f,e.u_highlights)}),hillshadePrepare:(f,e)=>({u_matrix:new d.bV(f,e.u_matrix),u_image:new d.bT(f,e.u_image),u_dimension:new d.bY(f,e.u_dimension),u_zoom:new d.bj(f,e.u_zoom),u_unpack:new d.bW(f,e.u_unpack)}),colorRelief:(f,e)=>({u_image:new d.bT(f,e.u_image),u_unpack:new d.bW(f,e.u_unpack),u_dimension:new d.bY(f,e.u_dimension),u_elevation_stops:new d.bT(f,e.u_elevation_stops),u_color_stops:new d.bT(f,e.u_color_stops),u_color_ramp_size:new d.bT(f,e.u_color_ramp_size),u_opacity:new d.bj(f,e.u_opacity)}),line:(f,e)=>({u_translation:new d.bY(f,e.u_translation),u_ratio:new d.bj(f,e.u_ratio),u_device_pixel_ratio:new d.bj(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.bY(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_translation:new d.bY(f,e.u_translation),u_ratio:new d.bj(f,e.u_ratio),u_device_pixel_ratio:new d.bj(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.bY(f,e.u_units_to_pixels),u_image:new d.bT(f,e.u_image),u_image_height:new d.bj(f,e.u_image_height)}),linePattern:(f,e)=>({u_translation:new d.bY(f,e.u_translation),u_texsize:new d.bY(f,e.u_texsize),u_ratio:new d.bj(f,e.u_ratio),u_device_pixel_ratio:new d.bj(f,e.u_device_pixel_ratio),u_image:new d.bT(f,e.u_image),u_units_to_pixels:new d.bY(f,e.u_units_to_pixels),u_scale:new d.bX(f,e.u_scale),u_fade:new d.bj(f,e.u_fade)}),lineSDF:(f,e)=>({u_translation:new d.bY(f,e.u_translation),u_ratio:new d.bj(f,e.u_ratio),u_device_pixel_ratio:new d.bj(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.bY(f,e.u_units_to_pixels),u_image:new d.bT(f,e.u_image),u_mix:new d.bj(f,e.u_mix),u_tileratio:new d.bj(f,e.u_tileratio),u_crossfade_from:new d.bj(f,e.u_crossfade_from),u_crossfade_to:new d.bj(f,e.u_crossfade_to),u_lineatlas_width:new d.bj(f,e.u_lineatlas_width),u_lineatlas_height:new d.bj(f,e.u_lineatlas_height)}),lineGradientSDF:(f,e)=>({u_translation:new d.bY(f,e.u_translation),u_ratio:new d.bj(f,e.u_ratio),u_device_pixel_ratio:new d.bj(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.bY(f,e.u_units_to_pixels),u_image:new d.bT(f,e.u_image),u_image_height:new d.bj(f,e.u_image_height),u_tileratio:new d.bj(f,e.u_tileratio),u_crossfade_from:new d.bj(f,e.u_crossfade_from),u_crossfade_to:new d.bj(f,e.u_crossfade_to),u_image_dash:new d.bT(f,e.u_image_dash),u_mix:new d.bj(f,e.u_mix),u_lineatlas_width:new d.bj(f,e.u_lineatlas_width),u_lineatlas_height:new d.bj(f,e.u_lineatlas_height)}),raster:(f,e)=>({u_tl_parent:new d.bY(f,e.u_tl_parent),u_scale_parent:new d.bj(f,e.u_scale_parent),u_buffer_scale:new d.bj(f,e.u_buffer_scale),u_fade_t:new d.bj(f,e.u_fade_t),u_opacity:new d.bj(f,e.u_opacity),u_image0:new d.bT(f,e.u_image0),u_image1:new d.bT(f,e.u_image1),u_brightness_low:new d.bj(f,e.u_brightness_low),u_brightness_high:new d.bj(f,e.u_brightness_high),u_saturation_factor:new d.bj(f,e.u_saturation_factor),u_contrast_factor:new d.bj(f,e.u_contrast_factor),u_spin_weights:new d.bX(f,e.u_spin_weights),u_coords_top:new d.bW(f,e.u_coords_top),u_coords_bottom:new d.bW(f,e.u_coords_bottom)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new d.bT(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bT(f,e.u_is_size_feature_constant),u_size_t:new d.bj(f,e.u_size_t),u_size:new d.bj(f,e.u_size),u_camera_to_center_distance:new d.bj(f,e.u_camera_to_center_distance),u_pitch:new d.bj(f,e.u_pitch),u_rotate_symbol:new d.bT(f,e.u_rotate_symbol),u_aspect_ratio:new d.bj(f,e.u_aspect_ratio),u_fade_change:new d.bj(f,e.u_fade_change),u_label_plane_matrix:new d.bV(f,e.u_label_plane_matrix),u_coord_matrix:new d.bV(f,e.u_coord_matrix),u_is_text:new d.bT(f,e.u_is_text),u_pitch_with_map:new d.bT(f,e.u_pitch_with_map),u_is_along_line:new d.bT(f,e.u_is_along_line),u_is_variable_anchor:new d.bT(f,e.u_is_variable_anchor),u_texsize:new d.bY(f,e.u_texsize),u_texture:new d.bT(f,e.u_texture),u_translation:new d.bY(f,e.u_translation),u_pitched_scale:new d.bj(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new d.bT(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bT(f,e.u_is_size_feature_constant),u_size_t:new d.bj(f,e.u_size_t),u_size:new d.bj(f,e.u_size),u_camera_to_center_distance:new d.bj(f,e.u_camera_to_center_distance),u_pitch:new d.bj(f,e.u_pitch),u_rotate_symbol:new d.bT(f,e.u_rotate_symbol),u_aspect_ratio:new d.bj(f,e.u_aspect_ratio),u_fade_change:new d.bj(f,e.u_fade_change),u_label_plane_matrix:new d.bV(f,e.u_label_plane_matrix),u_coord_matrix:new d.bV(f,e.u_coord_matrix),u_is_text:new d.bT(f,e.u_is_text),u_pitch_with_map:new d.bT(f,e.u_pitch_with_map),u_is_along_line:new d.bT(f,e.u_is_along_line),u_is_variable_anchor:new d.bT(f,e.u_is_variable_anchor),u_texsize:new d.bY(f,e.u_texsize),u_texture:new d.bT(f,e.u_texture),u_gamma_scale:new d.bj(f,e.u_gamma_scale),u_device_pixel_ratio:new d.bj(f,e.u_device_pixel_ratio),u_is_halo:new d.bT(f,e.u_is_halo),u_translation:new d.bY(f,e.u_translation),u_pitched_scale:new d.bj(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new d.bT(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bT(f,e.u_is_size_feature_constant),u_size_t:new d.bj(f,e.u_size_t),u_size:new d.bj(f,e.u_size),u_camera_to_center_distance:new d.bj(f,e.u_camera_to_center_distance),u_pitch:new d.bj(f,e.u_pitch),u_rotate_symbol:new d.bT(f,e.u_rotate_symbol),u_aspect_ratio:new d.bj(f,e.u_aspect_ratio),u_fade_change:new d.bj(f,e.u_fade_change),u_label_plane_matrix:new d.bV(f,e.u_label_plane_matrix),u_coord_matrix:new d.bV(f,e.u_coord_matrix),u_is_text:new d.bT(f,e.u_is_text),u_pitch_with_map:new d.bT(f,e.u_pitch_with_map),u_is_along_line:new d.bT(f,e.u_is_along_line),u_is_variable_anchor:new d.bT(f,e.u_is_variable_anchor),u_texsize:new d.bY(f,e.u_texsize),u_texsize_icon:new d.bY(f,e.u_texsize_icon),u_texture:new d.bT(f,e.u_texture),u_texture_icon:new d.bT(f,e.u_texture_icon),u_gamma_scale:new d.bj(f,e.u_gamma_scale),u_device_pixel_ratio:new d.bj(f,e.u_device_pixel_ratio),u_is_halo:new d.bT(f,e.u_is_halo),u_translation:new d.bY(f,e.u_translation),u_pitched_scale:new d.bj(f,e.u_pitched_scale)}),background:(f,e)=>({u_opacity:new d.bj(f,e.u_opacity),u_color:new d.bU(f,e.u_color)}),backgroundPattern:(f,e)=>({u_opacity:new d.bj(f,e.u_opacity),u_image:new d.bT(f,e.u_image),u_pattern_tl_a:new d.bY(f,e.u_pattern_tl_a),u_pattern_br_a:new d.bY(f,e.u_pattern_br_a),u_pattern_tl_b:new d.bY(f,e.u_pattern_tl_b),u_pattern_br_b:new d.bY(f,e.u_pattern_br_b),u_texsize:new d.bY(f,e.u_texsize),u_mix:new d.bj(f,e.u_mix),u_pattern_size_a:new d.bY(f,e.u_pattern_size_a),u_pattern_size_b:new d.bY(f,e.u_pattern_size_b),u_scale_a:new d.bj(f,e.u_scale_a),u_scale_b:new d.bj(f,e.u_scale_b),u_pixel_coord_upper:new d.bY(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bY(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.bj(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_texture:new d.bT(f,e.u_texture),u_ele_delta:new d.bj(f,e.u_ele_delta),u_fog_matrix:new d.bV(f,e.u_fog_matrix),u_fog_color:new d.bU(f,e.u_fog_color),u_fog_ground_blend:new d.bj(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.bj(f,e.u_fog_ground_blend_opacity),u_horizon_color:new d.bU(f,e.u_horizon_color),u_horizon_fog_blend:new d.bj(f,e.u_horizon_fog_blend),u_is_globe_mode:new d.bj(f,e.u_is_globe_mode)}),terrainDepth:(f,e)=>({u_ele_delta:new d.bj(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_texture:new d.bT(f,e.u_texture),u_terrain_coords_id:new d.bj(f,e.u_terrain_coords_id),u_ele_delta:new d.bj(f,e.u_ele_delta)}),projectionErrorMeasurement:(f,e)=>({u_input:new d.bj(f,e.u_input),u_output_expected:new d.bj(f,e.u_output_expected)}),atmosphere:(f,e)=>({u_sun_pos:new d.bX(f,e.u_sun_pos),u_atmosphere_blend:new d.bj(f,e.u_atmosphere_blend),u_globe_position:new d.bX(f,e.u_globe_position),u_globe_radius:new d.bj(f,e.u_globe_radius),u_inv_proj_matrix:new d.bV(f,e.u_inv_proj_matrix)}),sky:(f,e)=>({u_sky_color:new d.bU(f,e.u_sky_color),u_horizon_color:new d.bU(f,e.u_horizon_color),u_horizon:new d.bY(f,e.u_horizon),u_horizon_normal:new d.bY(f,e.u_horizon_normal),u_sky_horizon_blend:new d.bj(f,e.u_sky_horizon_blend),u_sky_blend:new d.bj(f,e.u_sky_blend)})};class Ju{constructor(e,r,l){this.context=e;const h=e.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const r=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const mr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class tc{constructor(e,r,l,h){this.length=r.length,this.attributes=l,this.itemSize=r.bytesPerElement,this.dynamicDraw=h,this.context=e;const m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete r.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,r){for(let l=0;l<this.attributes.length;l++){const h=r.attributes[this.attributes[l].name];h!==void 0&&e.enableVertexAttribArray(h)}}setVertexAttribPointers(e,r,l){for(let h=0;h<this.attributes.length;h++){const m=this.attributes[h],y=r.attributes[m.name];y!==void 0&&e.vertexAttribPointer(y,m.components,e[mr[m.type]],!1,this.itemSize,m.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ni{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class eh extends ni{getDefault(){return d.bi.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Wh extends ni{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Do extends ni{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Io extends ni{getDefault(){return[!0,!0,!0,!0]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class th extends ni{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class ih extends ni{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Yr extends ni{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const r=this.current;(e.func!==r.func||e.ref!==r.ref||e.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class ic extends ni{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class nc extends ni{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=e,this.dirty=!1}}class tu extends ni{getDefault(){return[0,1]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ro extends ni{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=e,this.dirty=!1}}class ac extends ni{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class xl extends ni{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.BLEND):r.disable(r.BLEND),this.current=e,this.dirty=!1}}class Ha extends ni{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class nh extends ni{getDefault(){return d.bi.transparent}set(e){const r=this.current;(e.r!==r.r||e.g!==r.g||e.b!==r.b||e.a!==r.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class iu extends ni{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Xa extends ni{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;e?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=e,this.dirty=!1}}class $r extends ni{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Sa extends ni{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class vs extends ni{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Lo extends ni{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ko extends ni{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const r=this.current;(e[0]!==r[0]||e[1]!==r[1]||e[2]!==r[2]||e[3]!==r[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class rc extends ni{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Js extends ni{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class gr extends ni{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ah extends ni{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class bl extends ni{getDefault(){return null}set(e){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Nt extends ni{getDefault(){return null}set(e){var r;if(e===this.current&&!this.dirty)return;const l=this.gl;Ba(l)?l.bindVertexArray(e):(r=l.getExtension("OES_vertex_array_object"))===null||r===void 0||r.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class nu extends ni{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Ya extends ni{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class au extends ni{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ma extends ni{constructor(e,r){super(e),this.context=e,this.parent=r}getDefault(){return null}}class Qh extends Ma{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ru extends Ma{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class eo extends Ma{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const su="Framebuffer is not complete";class ou{constructor(e,r,l,h,m){this.context=e,this.width=r,this.height=l;const y=e.gl,w=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new Qh(e,w),h)this.depthAttachment=m?new eo(e,w):new ru(e,w);else if(m)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(su)}destroy(){const e=this.context.gl,r=this.colorAttachment.get();if(r&&e.deleteTexture(r),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class wl{constructor(e){var r,l;if(this.gl=e,this.clearColor=new eh(this),this.clearDepth=new Wh(this),this.clearStencil=new Do(this),this.colorMask=new Io(this),this.depthMask=new th(this),this.stencilMask=new ih(this),this.stencilFunc=new Yr(this),this.stencilOp=new ic(this),this.stencilTest=new nc(this),this.depthRange=new tu(this),this.depthTest=new Ro(this),this.depthFunc=new ac(this),this.blend=new xl(this),this.blendFunc=new Ha(this),this.blendColor=new nh(this),this.blendEquation=new iu(this),this.cullFace=new Xa(this),this.cullFaceSide=new $r(this),this.frontFace=new Sa(this),this.program=new vs(this),this.activeTexture=new Lo(this),this.viewport=new ko(this),this.bindFramebuffer=new rc(this),this.bindRenderbuffer=new Js(this),this.bindTexture=new gr(this),this.bindVertexBuffer=new ah(this),this.bindElementBuffer=new bl(this),this.bindVertexArray=new Nt(this),this.pixelStoreUnpack=new nu(this),this.pixelStoreUnpackPremultiplyAlpha=new Ya(this),this.pixelStoreUnpackFlipY=new au(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Ba(e)){this.HALF_FLOAT=e.HALF_FLOAT;const h=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(r=e.RGBA16F)!==null&&r!==void 0?r:h?.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:h?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const h=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,r){return new Ju(this,e,r)}createVertexBuffer(e,r,l){return new tc(this,e,r,l)}createRenderbuffer(e,r,l){const h=this.gl,m=h.createRenderbuffer();return this.bindRenderbuffer.set(m),h.renderbufferStorage(h.RENDERBUFFER,e,r,l),this.bindRenderbuffer.set(null),m}createFramebuffer(e,r,l,h){return new ou(this,e,r,l,h)}clear({color:e,depth:r,stencil:l}){const h=this.gl;let m=0;e&&(m|=h.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),r!==void 0&&(m|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),l!==void 0&&(m|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.bK(e.blendFunction,ii.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Ba(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var r;return Ba(this.gl)?this.gl.deleteVertexArray(e):(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let to;function pa(f,e,r,l,h){const m=f.context,y=f.transform,w=m.gl,T=f.useProgram("collisionBox"),A=[];let C=0,I=0;for(let Q=0;Q<l.length;Q++){const ne=l[Q],se=e.getTile(ne).getBucket(r);if(!se)continue;const te=h?se.textCollisionBox:se.iconCollisionBox,oe=se.collisionCircleArray;oe.length>0&&(A.push({circleArray:oe,circleOffset:I,coord:ne}),C+=oe.length/4,I=C),te&&T.draw(m,w.LINES,Ut.disabled,ei.disabled,f.colorModeForRenderPass(),Ot.disabled,Yu(f.transform),f.style.map.terrain&&f.style.map.terrain.getTerrainData(ne),y.getProjectionData({overscaledTileID:ne,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),r.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,null,f.transform.zoom,null,null,te.collisionVertexBuffer)}if(!h||!A.length)return;const D=f.useProgram("collisionCircle"),O=new d.c3;O.resize(4*C),O._trim();let G=0;for(const Q of A)for(let ne=0;ne<Q.circleArray.length/4;ne++){const se=4*ne,te=Q.circleArray[se+0],oe=Q.circleArray[se+1],de=Q.circleArray[se+2],ae=Q.circleArray[se+3];O.emplace(G++,te,oe,de,ae,0),O.emplace(G++,te,oe,de,ae,1),O.emplace(G++,te,oe,de,ae,2),O.emplace(G++,te,oe,de,ae,3)}(!to||to.length<2*C)&&(to=function(Q){const ne=2*Q,se=new d.c5;se.resize(ne),se._trim();for(let te=0;te<ne;te++){const oe=6*te;se.uint16[oe+0]=4*te+0,se.uint16[oe+1]=4*te+1,se.uint16[oe+2]=4*te+2,se.uint16[oe+3]=4*te+2,se.uint16[oe+4]=4*te+3,se.uint16[oe+5]=4*te+0}return se}(C));const K=m.createIndexBuffer(to,!0),W=m.createVertexBuffer(O,d.c4.members,!0);for(const Q of A){const ne=$c(f.transform);D.draw(m,w.TRIANGLES,Ut.disabled,ei.disabled,f.colorModeForRenderPass(),Ot.disabled,ne,f.style.map.terrain&&f.style.map.terrain.getTerrainData(Q.coord),null,r.id,W,K,d.aQ.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,f.transform.zoom,null,null,null)}W.destroy(),K.destroy()}const io=d.am(new Float32Array(16));function Bo(f,e,r,l,h,m){const{horizontalAlign:y,verticalAlign:w}=d.aL(f);return new d.P((-(y-.5)*e/h+l[0])*m,(-(w-.5)*r/h+l[1])*m)}function Oo(f,e,r,l,h,m){const y=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(m);r||(w=w.rotate(-h));const T=y.add(w);return $e(T.x,T.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(r){const w=wa(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),T=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return f.add(l.rotate(T))}return f.add(l)}function no(f,e,r,l,h,m,y,w,T,A,C,I){const D=f.text.placedSymbolArray,O=f.text.dynamicLayoutVertexArray,G=f.icon.dynamicLayoutVertexArray,K={};O.clear();for(let W=0;W<D.length;W++){const Q=D.get(W),ne=Q.hidden||!Q.crossTileID||f.allowVerticalPlacement&&!Q.placedOrientation?null:l[Q.crossTileID];if(ne){const se=new d.P(Q.anchorX,Q.anchorY),te={getElevation:I,width:h.width,height:h.height,pitchedLabelPlaneMatrix:m,pitchWithMap:r,transform:h,tileAnchorPoint:se,translation:A,unwrappedTileID:C},oe=r?Gr(se.x,se.y,te):wa(se.x,se.y,te),de=It(h.cameraToCenterDistance,oe.signedDistanceFromCamera);let ae=d.at(f.textSizeData,w,Q)*de/d.aF;r&&(ae*=f.tilePixelRatio/y);const{width:fe,height:Pe,anchor:Se,textOffset:Ce,textBoxScale:Ie}=ne,Ke=Bo(Se,fe,Pe,Ce,Ie,ae),We=h.getPitchedTextCorrection(se.x+A[0],se.y+A[1],C),Fe=Oo(oe.point,te,e,Ke,-h.bearingInRadians,We),lt=f.allowVerticalPlacement&&Q.placedOrientation===d.as.vertical?Math.PI/2:0;for(let Lt=0;Lt<Q.numGlyphs;Lt++)d.az(O,Fe,lt);T&&Q.associatedIconIndex>=0&&(K[Q.associatedIconIndex]={shiftedAnchor:Fe,angle:lt})}else Cr(Q.numGlyphs,O)}if(T){G.clear();const W=f.icon.placedSymbolArray;for(let Q=0;Q<W.length;Q++){const ne=W.get(Q);if(ne.hidden)Cr(ne.numGlyphs,G);else{const se=K[Q];if(se)for(let te=0;te<ne.numGlyphs;te++)d.az(G,se.shiftedAnchor,se.angle);else Cr(ne.numGlyphs,G)}}f.icon.dynamicLayoutVertexBuffer.updateData(G)}f.text.dynamicLayoutVertexBuffer.updateData(O)}function Ea(f,e,r){return r.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Hn(f,e,r,l,h,m,y,w,T,A,C,I,D){const O=f.context,G=O.gl,K=f.transform,W=w==="map",Q=T==="map",ne=w!=="viewport"&&r.layout.get("symbol-placement")!=="point",se=W&&!Q&&!ne,te=!r.layout.get("symbol-sort-key").isConstant();let oe=!1;const de=f.getDepthModeForSublayer(0,Ut.ReadOnly),ae=r._unevaluatedLayout.hasValue("text-variable-anchor")||r._unevaluatedLayout.hasValue("text-variable-anchor-offset"),fe=[],Pe=K.getCircleRadiusCorrection();for(const Se of l){const Ce=e.getTile(Se),Ie=Ce.getBucket(r);if(!Ie)continue;const Ke=h?Ie.text:Ie.icon;if(!Ke||!Ke.segments.get().length||!Ke.hasVisibleVertices)continue;const We=Ke.programConfigurations.get(r.id),Fe=h||Ie.sdfIcons,lt=h?Ie.textSizeData:Ie.iconSizeData,Lt=Q||K.pitch!==0,ui=f.useProgram(Ea(Fe,h,Ie),We),Vt=d.ar(lt,K.zoom),Si=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Se);let Wi,Di,Tn,Zi,In=[0,0],qi=null;if(h)Di=Ce.glyphAtlasTexture,Tn=G.LINEAR,Wi=Ce.glyphAtlasTexture.size,Ie.iconsInText&&(In=Ce.imageAtlasTexture.size,qi=Ce.imageAtlasTexture,Zi=Lt||f.options.rotating||f.options.zooming||lt.kind==="composite"||lt.kind==="camera"?G.LINEAR:G.NEAREST);else{const gn=r.layout.get("icon-size").constantOr(0)!==1||Ie.iconsNeedLinear;Di=Ce.imageAtlasTexture,Tn=Fe||f.options.rotating||f.options.zooming||gn||Lt?G.LINEAR:G.NEAREST,Wi=Ce.imageAtlasTexture.size}const mn=d.aG(Ce,1,f.transform.zoom),ca=fa(W,f.transform,mn),uo=d.M();d.au(uo,ca);const ns=qa(Q,W,f.transform,mn),as=d.aH(K,Ce,m,y),Is=K.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),Wo=ae&&Ie.hasTextData(),ho=r.layout.get("icon-text-fit")!=="none"&&Wo&&Ie.hasIconData();if(ne){const gn=f.style.map.terrain?(Rn,Mi)=>f.style.map.terrain.getElevation(Se,Rn,Mi):null,Hi=r.layout.get("text-rotation-alignment")==="map";Ar(Ie,f,h,ca,uo,Q,A,Hi,Se.toUnwrapped(),K.width,K.height,as,gn)}const _a=h&&ae||ho,ya=ne||_a?io:Q?ca:f.transform.clipSpaceToPixelsMatrix,rs=Fe&&r.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let fo;fo=Fe?Ie.iconsInText?Xr(lt.kind,Vt,se,Q,ne,_a,f,ya,ns,as,Wi,In,Pe):ys(lt.kind,Vt,se,Q,ne,_a,f,ya,ns,as,h,Wi,0,Pe):Ta(lt.kind,Vt,se,Q,ne,_a,f,ya,ns,as,h,Wi,Pe);const _c={program:ui,buffers:Ke,uniformValues:fo,projectionData:Is,atlasTexture:Di,atlasTextureIcon:qi,atlasInterpolation:Tn,atlasInterpolationIcon:Zi,isSDF:Fe,hasHalo:rs};if(te&&Ie.canOverlap){oe=!0;const gn=Ke.segments.get();for(const Hi of gn)fe.push({segments:new d.aQ([Hi]),sortKey:Hi.sortKey,state:_c,terrainData:Si})}else fe.push({segments:Ke.segments,sortKey:0,state:_c,terrainData:Si})}oe&&fe.sort((Se,Ce)=>Se.sortKey-Ce.sortKey);for(const Se of fe){const Ce=Se.state;if(O.activeTexture.set(G.TEXTURE0),Ce.atlasTexture.bind(Ce.atlasInterpolation,G.CLAMP_TO_EDGE),Ce.atlasTextureIcon&&(O.activeTexture.set(G.TEXTURE1),Ce.atlasTextureIcon&&Ce.atlasTextureIcon.bind(Ce.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),Ce.isSDF){const Ie=Ce.uniformValues;Ce.hasHalo&&(Ie.u_is_halo=1,Dr(Ce.buffers,Se.segments,r,f,Ce.program,de,C,I,Ie,Ce.projectionData,Se.terrainData)),Ie.u_is_halo=0}Dr(Ce.buffers,Se.segments,r,f,Ce.program,de,C,I,Ce.uniformValues,Ce.projectionData,Se.terrainData)}}function Dr(f,e,r,l,h,m,y,w,T,A,C){const I=l.context;h.draw(I,I.gl.TRIANGLES,m,y,w,Ot.backCCW,T,C,A,r.id,f.layoutVertexBuffer,f.indexBuffer,e,r.paint,l.transform.zoom,f.programConfigurations.get(r.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Kr(f,e,r,l,h){const m=f.context,y=m.gl,w=ei.disabled,T=new ii([y.ONE,y.ONE],d.bi.transparent,[!0,!0,!0,!0]),A=e.getBucket(r);if(!A)return;const C=l.key;let I=r.heatmapFbos.get(C);I||(I=Wr(m,e.tileSize,e.tileSize),r.heatmapFbos.set(C,I)),m.bindFramebuffer.set(I.framebuffer),m.viewport.set([0,0,e.tileSize,e.tileSize]),m.clear({color:d.bi.transparent});const D=A.programConfigurations.get(r.id),O=f.useProgram("heatmap",D,!h),G=f.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),K=f.style.map.terrain.getTerrainData(l);O.draw(m,y.TRIANGLES,Ut.disabled,w,T,Ot.disabled,Po(e,f.transform.zoom,r.paint.get("heatmap-intensity"),1),K,G,r.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,r.paint,f.transform.zoom,D)}function Oa(f,e,r,l,h){const m=f.context,y=m.gl,w=f.transform;m.setColorMode(f.colorModeForRenderPass());const T=lu(m,e),A=r.key,C=e.heatmapFbos.get(A);if(!C)return;m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,C.colorAttachment.get()),m.activeTexture.set(y.TEXTURE1),T.bind(y.LINEAR,y.CLAMP_TO_EDGE);const I=w.getProjectionData({overscaledTileID:r,applyTerrainMatrix:h,applyGlobeMatrix:!l});f.useProgram("heatmapTexture").draw(m,y.TRIANGLES,Ut.disabled,ei.disabled,f.colorModeForRenderPass(),Ot.disabled,$u(f,e,0,1),null,I,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,w.zoom),C.destroy(),e.heatmapFbos.delete(A)}function Wr(f,e,r){var l,h;const m=f.gl,y=m.createTexture();m.bindTexture(m.TEXTURE_2D,y),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR);const w=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:m.UNSIGNED_BYTE,T=(h=f.RGBA16F)!==null&&h!==void 0?h:m.RGBA;m.texImage2D(m.TEXTURE_2D,0,T,e,r,0,m.RGBA,w,null);const A=f.createFramebuffer(e,r,!1,!1);return A.colorAttachment.set(y),A}function lu(f,e){return e.colorRampTexture||(e.colorRampTexture=new d.T(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function jo(f,e,r,l,h,m,y,w){let T=256;if(h.stepInterpolant){const A=e.getSource().maxzoom,C=y.canonical.z===A?Math.ceil(1<<f.transform.maxZoom-y.canonical.z):1;T=d.ai(d.c7(m.maxLineLength/d.a3*1024*C),256,r.maxTextureSize)}return w.gradient=d.c8({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:T,image:w.gradient||void 0,clips:m.lineClipsArray}),w.texture?w.texture.update(w.gradient):w.texture=new d.T(r,w.gradient,l.RGBA),w.version=h.gradientVersion,w.texture}function sc(f,e,r,l,h){f.activeTexture.set(e.TEXTURE0),r.imageAtlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE),l.updatePaintBuffers(h)}function rh(f,e,r,l,h,m){(h||f.lineAtlas.dirty)&&(e.activeTexture.set(r.TEXTURE0),f.lineAtlas.bind(e)),l.updatePaintBuffers(m)}function Xn(f,e,r,l,h,m,y){const w=m.gradients[h.id];let T=w.texture;h.gradientVersion!==w.version&&(T=jo(f,e,r,l,h,m,y,w)),r.activeTexture.set(l.TEXTURE0),T.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE)}function Pi(f,e,r,l,h,m,y,w,T){const A=m.gradients[h.id];let C=A.texture;h.gradientVersion!==A.version&&(C=jo(f,e,r,l,h,m,y,A)),r.activeTexture.set(l.TEXTURE0),C.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE),r.activeTexture.set(l.TEXTURE1),f.lineAtlas.bind(r),w.updatePaintBuffers(T)}function Qt(f,e,r,l,h){if(!r||!l||!l.imageAtlas)return;const m=l.imageAtlas.patternPositions;let y=m[r.to.toString()],w=m[r.from.toString()];if(!y&&w&&(y=w),!w&&y&&(w=y),!y||!w){const T=h.getPaintProperty(e);y=m[T],w=m[T]}y&&w&&f.setConstantPatternPositions(y,w)}function xs(f,e,r,l,h,m,y,w){const T=f.context.gl,A="fill-pattern",C=r.paint.get(A),I=C&&C.constantOr(1),D=r.getCrossfadeParameters();let O,G,K,W,Q;const ne=f.transform,se=r.paint.get("fill-translate"),te=r.paint.get("fill-translate-anchor");y?(G=I&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=T.LINES):(G=I?"fillPattern":"fill",O=T.TRIANGLES);const oe=C.constantOr(null);for(const de of l){const ae=e.getTile(de);if(I&&!ae.patternsLoaded())continue;const fe=ae.getBucket(r);if(!fe)continue;const Pe=fe.programConfigurations.get(r.id),Se=f.useProgram(G,Pe),Ce=f.style.map.terrain&&f.style.map.terrain.getTerrainData(de);I&&(f.context.activeTexture.set(T.TEXTURE0),ae.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Pe.updatePaintBuffers(D)),Qt(Pe,A,oe,ae,r);const Ie=ne.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),Ke=d.aH(ne,ae,se,te);if(y){W=fe.indexBuffer2,Q=fe.segments2;const Fe=[T.drawingBufferWidth,T.drawingBufferHeight];K=G==="fillOutlinePattern"&&I?Xh(f,D,ae,Fe,Ke):Gd(Fe,Ke)}else W=fe.indexBuffer,Q=fe.segments,K=I?pr(f,D,ae,Ke):{u_fill_translate:Ke};const We=f.stencilModeForClipping(de);Se.draw(f.context,O,h,We,m,Ot.backCCW,K,Ce,Ie,r.id,fe.layoutVertexBuffer,W,Q,r.paint,f.transform.zoom,Pe)}}function Aa(f,e,r,l,h,m,y,w){const T=f.context,A=T.gl,C="fill-extrusion-pattern",I=r.paint.get(C),D=I.constantOr(1),O=r.getCrossfadeParameters(),G=r.paint.get("fill-extrusion-opacity"),K=I.constantOr(null),W=f.transform;for(const Q of l){const ne=e.getTile(Q),se=ne.getBucket(r);if(!se)continue;const te=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Q),oe=se.programConfigurations.get(r.id),de=f.useProgram(D?"fillExtrusionPattern":"fillExtrusion",oe);D&&(f.context.activeTexture.set(A.TEXTURE0),ne.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),oe.updatePaintBuffers(O));const ae=W.getProjectionData({overscaledTileID:Q,applyGlobeMatrix:!w,applyTerrainMatrix:!0});Qt(oe,C,K,ne,r);const fe=d.aH(W,ne,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Pe=r.paint.get("fill-extrusion-vertical-gradient"),Se=D?Hh(f,Pe,G,fe,Q,O,ne):vl(f,Pe,G,fe);de.draw(T,T.gl.TRIANGLES,h,m,y,Ot.backCCW,Se,te,ae,r.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,r.paint,f.transform.zoom,oe,f.style.map.terrain&&se.centroidVertexBuffer)}}function Gi(f,e,r,l,h,m,y,w,T){var A;const C=f.style.projection,I=f.context,D=f.transform,O=I.gl,G=[`#define NUM_ILLUMINATION_SOURCES ${r.paint.get("hillshade-highlight-color").values.length}`],K=f.useProgram("hillshade",null,!1,G),W=!f.options.moving;for(const Q of l){const ne=e.getTile(Q),se=ne.fbo;if(!se)continue;const te=C.getMeshFromTileID(I,Q.canonical,w,!0,"raster"),oe=(A=f.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(Q);I.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,se.colorAttachment.get());const de=D.getProjectionData({overscaledTileID:Q,aligned:W,applyGlobeMatrix:!T,applyTerrainMatrix:!0});K.draw(I,O.TRIANGLES,m,h[Q.overscaledZ],y,Ot.backCCW,Ql(f,ne,r),oe,de,r.id,te.vertexBuffer,te.indexBuffer,te.segments)}}function ma(f,e,r,l,h,m,y,w,T){var A;const C=f.style.projection,I=f.context,D=f.transform,O=I.gl,G=f.useProgram("colorRelief"),K=!f.options.moving;let W=!0,Q=0;for(const ne of l){const se=e.getTile(ne),te=se.dem;if(W){const Se=O.getParameter(O.MAX_TEXTURE_SIZE),{elevationTexture:Ce,colorTexture:Ie}=r.getColorRampTextures(I,Se,te.getUnpackVector());I.activeTexture.set(O.TEXTURE1),Ce.bind(O.NEAREST,O.CLAMP_TO_EDGE),I.activeTexture.set(O.TEXTURE4),Ie.bind(O.LINEAR,O.CLAMP_TO_EDGE),W=!1,Q=Ce.size[0]}if(!te||!te.data)continue;const oe=te.stride,de=te.getPixels();if(I.activeTexture.set(O.TEXTURE0),I.pixelStoreUnpackPremultiplyAlpha.set(!1),se.demTexture=se.demTexture||f.getTileTexture(oe),se.demTexture){const Se=se.demTexture;Se.update(de,{premultiply:!1}),Se.bind(O.LINEAR,O.CLAMP_TO_EDGE)}else se.demTexture=new d.T(I,de,O.RGBA,{premultiply:!1}),se.demTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const ae=C.getMeshFromTileID(I,ne.canonical,w,!0,"raster"),fe=(A=f.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(ne),Pe=D.getProjectionData({overscaledTileID:ne,aligned:K,applyGlobeMatrix:!T,applyTerrainMatrix:!0});G.draw(I,O.TRIANGLES,m,h[ne.overscaledZ],y,Ot.backCCW,Kc(r,se.dem,Q),fe,Pe,r.id,ae.vertexBuffer,ae.indexBuffer,ae.segments)}}const Ca=[new d.P(0,0),new d.P(d.a3,0),new d.P(d.a3,d.a3),new d.P(0,d.a3)];function Fo(f,e,r,l,h,m,y,w,T=!1,A=!1){const C=l[l.length-1].overscaledZ,I=f.context,D=I.gl,O=f.useProgram("raster"),G=f.transform,K=f.style.projection,W=f.colorModeForRenderPass(),Q=!f.options.moving,ne=r.paint.get("raster-opacity"),se=r.paint.get("raster-resampling"),te=r.paint.get("raster-fade-duration"),oe=!!f.style.map.terrain;for(const de of l){const ae=f.getDepthModeForSublayer(de.overscaledZ-C,ne===1?Ut.ReadWrite:Ut.ReadOnly,D.LESS),fe=e.getTile(de),Pe=se==="nearest"?D.NEAREST:D.LINEAR;I.activeTexture.set(D.TEXTURE0),fe.texture.bind(Pe,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),I.activeTexture.set(D.TEXTURE1);const{parentTile:Se,parentScaleBy:Ce,parentTopLeft:Ie,fadeValues:Ke}=bs(fe,e,te,oe);fe.fadeOpacity=Ke.tileOpacity,Se?(Se.fadeOpacity=Ke.parentTileOpacity,Se.texture.bind(Pe,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST)):fe.texture.bind(Pe,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),fe.texture.useMipmap&&I.extTextureFilterAnisotropic&&f.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const We=f.style.map.terrain&&f.style.map.terrain.getTerrainData(de),Fe=G.getProjectionData({overscaledTileID:de,aligned:Q,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),lt=Kh(Ie,Ce,Ke.fadeMix,r,w),Lt=K.getMeshFromTileID(I,de.canonical,m,y,"raster");O.draw(I,D.TRIANGLES,ae,h?h[de.overscaledZ]:ei.disabled,W,T?Ot.frontCCW:Ot.backCCW,lt,We,Fe,r.id,Lt.vertexBuffer,Lt.indexBuffer,Lt.segments)}}function bs(f,e,r,l){const h={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(r===0||l)return h;if(f.fadingParentID){const m=e.getLoadedTile(f.fadingParentID);if(!m)return h;const y=Math.pow(2,m.tileID.overscaledZ-f.tileID.overscaledZ),w=[f.tileID.canonical.x*y%1,f.tileID.canonical.y*y%1],T=function(A,C,I){const D=mt(),O=(D-C.timeAdded)/I,G=A.fadingDirection===ie.Incoming,K=d.ai((D-A.timeAdded)/I,0,1),W=d.ai(1-O,0,1),Q=G?K:W;return{tileOpacity:Q,parentTileOpacity:G?W:K,fadeMix:{opacity:1,mix:1-Q}}}(f,m,r);return{parentTile:m,parentScaleBy:y,parentTopLeft:w,fadeValues:T}}if(f.selfFading){const m=function(y,w){const T=(mt()-y.timeAdded)/w,A=d.ai(T,0,1);return{tileOpacity:A,fadeMix:{opacity:A,mix:0}}}(f,r);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:m}}return h}const ao=new d.bi(1,0,0,1),ro=new d.bi(0,1,0,1),Uo=new d.bi(0,0,1,1),No=new d.bi(1,0,1,1),ws=new d.bi(0,1,1,1);function Ir(f,e,r,l){$a(f,0,e+r/2,f.transform.width,r,l)}function Qr(f,e,r,l){$a(f,e-r/2,0,r,f.transform.height,l)}function $a(f,e,r,l,h,m){const y=f.context,w=y.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*f.pixelRatio,r*f.pixelRatio,l*f.pixelRatio,h*f.pixelRatio),y.clear({color:m}),w.disable(w.SCISSOR_TEST)}function cu(f,e,r){const l=f.context,h=l.gl,m=f.useProgram("debug"),y=Ut.disabled,w=ei.disabled,T=f.colorModeForRenderPass(),A="$debug",C=f.style.map.terrain&&f.style.map.terrain.getTerrainData(r);l.activeTexture.set(h.TEXTURE0);const I=e.getTileByID(r.key).latestRawTileData,D=Math.floor((I&&I.byteLength||0)/1024),O=e.getTile(r).tileSize,G=512/Math.min(O,512)*(r.overscaledZ/f.transform.zoom)*.5;let K=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(K+=` => ${r.overscaledZ}`),function(Q,ne){Q.initDebugOverlayCanvas();const se=Q.debugOverlayCanvas,te=Q.context.gl,oe=Q.debugOverlayCanvas.getContext("2d");oe.clearRect(0,0,se.width,se.height),oe.shadowColor="white",oe.shadowBlur=2,oe.lineWidth=1.5,oe.strokeStyle="white",oe.textBaseline="top",oe.font="bold 36px Open Sans, sans-serif",oe.fillText(ne,5,5),oe.strokeText(ne,5,5),Q.debugOverlayTexture.update(se),Q.debugOverlayTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE)}(f,`${K} ${D}kB`);const W=f.transform.getProjectionData({overscaledTileID:r,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(l,h.TRIANGLES,y,w,ii.alphaBlended,Ot.disabled,zo(d.bi.transparent,G),null,W,A,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),m.draw(l,h.LINE_STRIP,y,w,T,Ot.disabled,zo(d.bi.red),C,W,A,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function oc(f,e,r,l){const{isRenderingGlobe:h}=l,m=f.context,y=m.gl,w=f.transform,T=f.colorModeForRenderPass(),A=f.getDepthModeFor3D(),C=f.useProgram("terrain");m.bindFramebuffer.set(null),m.viewport.set([0,0,f.width,f.height]);for(const I of r){const D=e.getTerrainMesh(I.tileID),O=f.renderToTexture.getTexture(I),G=e.getTerrainData(I.tileID);m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,O.texture);const K=e.getMeshFrameDelta(w.zoom),W=w.calculateFogMatrix(I.tileID.toUnwrapped()),Q=Wl(K,W,f.style.sky,w.pitch,h),ne=w.getProjectionData({overscaledTileID:I.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});C.draw(m,y.TRIANGLES,A,ei.disabled,T,Ot.backCCW,Q,G,ne,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}}function Ka(f,e){if(!e.mesh){const r=new d.aP;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1);const l=new d.aR;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new Ys(f.createVertexBuffer(r,cr.members),f.createIndexBuffer(l),d.aQ.simpleSegment(0,0,r.length,l.length))}return e.mesh}class lc{constructor(e,r){this.context=new wl(e),this.transform=r,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.am(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Yi.maxUnderzooming+Yi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new fs}resize(e,r,l){if(this.width=Math.floor(e*l),this.height=Math.floor(r*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const e=this.context,r=new d.aP;r.emplaceBack(0,0),r.emplaceBack(d.a3,0),r.emplaceBack(0,d.a3),r.emplaceBack(d.a3,d.a3),this.tileExtentBuffer=e.createVertexBuffer(r,cr.members),this.tileExtentSegments=d.aQ.simpleSegment(0,0,4,2);const l=new d.aP;l.emplaceBack(0,0),l.emplaceBack(d.a3,0),l.emplaceBack(0,d.a3),l.emplaceBack(d.a3,d.a3),this.debugBuffer=e.createVertexBuffer(l,cr.members),this.debugSegments=d.aQ.simpleSegment(0,0,4,5);const h=new d.ca;h.emplaceBack(0,0,0,0),h.emplaceBack(d.a3,0,d.a3,0),h.emplaceBack(0,d.a3,0,d.a3),h.emplaceBack(d.a3,d.a3,d.a3,d.a3),this.rasterBoundsBuffer=e.createVertexBuffer(h,qu.members),this.rasterBoundsSegments=d.aQ.simpleSegment(0,0,4,2);const m=new d.aP;m.emplaceBack(0,0),m.emplaceBack(d.a3,0),m.emplaceBack(0,d.a3),m.emplaceBack(d.a3,d.a3),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(m,cr.members),this.rasterBoundsSegmentsPosOnly=d.aQ.simpleSegment(0,0,4,5);const y=new d.aP;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,cr.members),this.viewportSegments=d.aQ.simpleSegment(0,0,4,2);const w=new d.cb;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);const T=new d.aR;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);const A=this.context.gl;this.stencilClearMode=new ei({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.tileExtentMesh=new Ys(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.M();d.c0(l,0,this.width,this.height,0,0,1),d.O(l,l,[r.drawingBufferWidth,r.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,r.TRIANGLES,Ut.disabled,this.stencilClearMode,ii.disabled,Ot.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,r,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!r||!r.length)return;this.currentStencilSource=e.source,this.nextStencilID+r.length>256&&this.clearStencil();const h=this.context;h.setColorMode(ii.disabled),h.setDepthMode(Ut.disabled);const m={};for(const y of r)m[y.key]=this.nextStencilID++;this._renderTileMasks(m,r,l,!0),this._renderTileMasks(m,r,l,!1),this._tileClippingMaskIDs=m}_renderTileMasks(e,r,l,h){const m=this.context,y=m.gl,w=this.style.projection,T=this.transform,A=this.useProgram("clippingMask");for(const C of r){const I=e[C.key],D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C),O=w.getMeshFromTileID(this.context,C.canonical,h,!0,"stencil"),G=T.getProjectionData({overscaledTileID:C,applyGlobeMatrix:!l,applyTerrainMatrix:!0});A.draw(m,y.TRIANGLES,Ut.disabled,new ei({func:y.ALWAYS,mask:0},I,255,y.KEEP,y.KEEP,y.REPLACE),ii.disabled,l?Ot.disabled:Ot.backCCW,null,D,G,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}_renderTilesDepthBuffer(){const e=this.context,r=e.gl,l=this.style.projection,h=this.transform,m=this.useProgram("depth"),y=this.getDepthModeFor3D(),w=Ni(h,{tileSize:h.tileSize});for(const T of w){const A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),C=l.getMeshFromTileID(this.context,T.canonical,!0,!0,"raster"),I=h.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(e,r.TRIANGLES,y,ei.disabled,ii.disabled,Ot.backCCW,null,A,I,"$clipping",C.vertexBuffer,C.indexBuffer,C.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,r=this.context.gl;return new ei({func:r.NOTEQUAL,mask:255},e,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(e){const r=this.context.gl;return new ei({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const r=this.context.gl,l=e.sort((y,w)=>w.overscaledZ-y.overscaledZ),h=l[l.length-1].overscaledZ,m=l[0].overscaledZ-h+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const y={};for(let w=0;w<m;w++)y[w+h]=new ei({func:r.GEQUAL,mask:255},w+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=m,[y,l]}return[{[h]:ei.disabled},l]}stencilConfigForOverlapTwoPass(e){const r=this.context.gl,l=e.sort((y,w)=>w.overscaledZ-y.overscaledZ),h=l[l.length-1].overscaledZ,m=l[0].overscaledZ-h+1;if(this.clearStencil(),m>1){const y={},w={};for(let T=0;T<m;T++)y[T+h]=new ei({func:r.GREATER,mask:255},m+1+T,255,r.KEEP,r.KEEP,r.REPLACE),w[T+h]=new ei({func:r.GREATER,mask:255},1+T,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID=2*m+1,[y,w,l]}return this.nextStencilID=3,[{[h]:new ei({func:r.GREATER,mask:255},2,255,r.KEEP,r.KEEP,r.REPLACE)},{[h]:new ei({func:r.GREATER,mask:255},1,255,r.KEEP,r.KEEP,r.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new ii([e.CONSTANT_COLOR,e.ONE],new d.bi(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ii.unblended:ii.alphaBlended}getDepthModeForSublayer(e,r,l){if(!this.opaquePassEnabledForLayer())return Ut.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Ut(l||this.context.gl.LEQUAL,r,[h,h])}getDepthModeFor3D(){return new Ut(this.context.gl.LEQUAL,Ut.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,r){var l,h;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(mt()),this.imageManager.beginFrame();const m=this.style._order,y=this.style.tileManagers,w={},T={},A={},C={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const D in y){const O=y[D];O.used&&O.prepare(this.context),w[D]=O.getVisibleCoordinates(!1),T[D]=w[D].slice().reverse(),A[D]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<m.length;D++)if(this.style._layers[m[D]].is3D()){this.opaquePassCutoff=D;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const D of m){const O=this.style._layers[D];if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const G=T[O.source];(O.type==="custom"||G.length)&&this.renderLayer(this,y[O.source],O,G,C)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:D=>this.useProgram(D)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?d.bi.black:d.bi.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(D,O){const G=D.context,K=G.gl,W=((de,ae,fe)=>{const Pe=Math.cos(ae.rollInRadians),Se=Math.sin(ae.rollInRadians),Ce=je(ae),Ie=ae.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:de.properties.get("sky-color"),u_horizon_color:de.properties.get("horizon-color"),u_horizon:[(ae.width/2-Ce*Se)*fe,(ae.height/2+Ce*Pe)*fe],u_horizon_normal:[-Se,Pe],u_sky_horizon_blend:de.properties.get("sky-horizon-blend")*ae.height/2*fe,u_sky_blend:Ie}})(O,D.style.map.transform,D.pixelRatio),Q=new Ut(K.LEQUAL,Ut.ReadWrite,[0,1]),ne=ei.disabled,se=D.colorModeForRenderPass(),te=D.useProgram("sky"),oe=Ka(G,O);te.draw(G,K.TRIANGLES,Q,ne,se,Ot.disabled,W,null,void 0,"sky",oe.vertexBuffer,oe.indexBuffer,oe.segments)}(this,this.style.sky),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[m[this.currentLayer]],O=y[D.source],G=w[D.source];this._renderTileClippingMasks(D,G,!1),this.renderLayer(this,O,D,G,C)}this.renderPass="translucent";let I=!1;for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const D=this.style._layers[m[this.currentLayer]],O=y[D.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(D,C))continue;this.opaquePassEnabledForLayer()||I||(I=!0,C.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const G=(D.type==="symbol"?A:T)[D.source];this._renderTileClippingMasks(D,w[D.source],!!this.renderToTexture),this.renderLayer(this,O,D,G,C)}if(C.isRenderingGlobe&&function(D,O,G){const K=D.context,W=K.gl,Q=D.useProgram("atmosphere"),ne=new Ut(W.LEQUAL,Ut.ReadOnly,[0,1]),se=D.transform,te=function(Ie,Ke){const We=Ie.properties.get("position"),Fe=[-We.x,-We.y,-We.z],lt=d.am(new Float64Array(16));return Ie.properties.get("anchor")==="map"&&(d.b9(lt,lt,Ke.rollInRadians),d.ba(lt,lt,-Ke.pitchInRadians),d.b9(lt,lt,Ke.bearingInRadians),d.ba(lt,lt,Ke.center.lat*Math.PI/180),d.bC(lt,lt,-Ke.center.lng*Math.PI/180)),d.c9(Fe,Fe,lt),Fe}(G,D.transform),oe=se.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),de=O.properties.get("atmosphere-blend")*oe.projectionTransition;if(de===0)return;const ae=Hl(se.worldSize,se.center.lat),fe=se.inverseProjectionMatrix,Pe=new Float64Array(4);Pe[3]=1,d.aA(Pe,Pe,se.modelViewProjectionMatrix),Pe[0]/=Pe[3],Pe[1]/=Pe[3],Pe[2]/=Pe[3],Pe[3]=1,d.aA(Pe,Pe,fe),Pe[0]/=Pe[3],Pe[1]/=Pe[3],Pe[2]/=Pe[3],Pe[3]=1;const Se=((Ie,Ke,We,Fe,lt)=>({u_sun_pos:Ie,u_atmosphere_blend:Ke,u_globe_position:We,u_globe_radius:Fe,u_inv_proj_matrix:lt}))(te,de,[Pe[0],Pe[1],Pe[2]],ae,fe),Ce=Ka(K,O);Q.draw(K,W.TRIANGLES,ne,ei.disabled,ii.alphaBlended,Ot.disabled,Se,null,null,"atmosphere",Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const D=function(O,G){let K=null;const W=Object.values(O._layers).flatMap(te=>te.source&&!te.isHidden(G)?[O.tileManagers[te.source]]:[]),Q=W.filter(te=>te.getSource().type==="vector"),ne=W.filter(te=>te.getSource().type!=="vector"),se=te=>{(!K||K.getSource().maxzoom<te.getSource().maxzoom)&&(K=te)};return Q.forEach(te=>se(te)),K||ne.forEach(te=>se(te)),K}(this.style,this.transform.zoom);D&&function(O,G,K){for(let W=0;W<K.length;W++)cu(O,G,K[W])}(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const O=D.transform.padding;Ir(D,D.transform.height-(O.top||0),3,ao),Ir(D,O.bottom||0,3,ro),Qr(D,O.left||0,3,Uo),Qr(D,D.transform.width-(O.right||0),3,No);const G=D.transform.centerPoint;(function(K,W,Q,ne){$a(K,W-1,Q-10,2,20,ne),$a(K,W-10,Q-1,20,2,ne)})(D,G.x,D.transform.height-G.y,ws)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const r=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=e?!d.cc(r,l):!d.cd(r,l)),h||(h=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(d.ce(r,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,y){const w=m.context,T=w.gl,A=m.transform,C=ii.unblended,I=new Ut(T.LEQUAL,Ut.ReadWrite,[0,1]),D=y.tileManager.getRenderableTiles(),O=m.useProgram("terrainDepth");w.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),w.clear({color:d.bi.transparent,depth:1});for(const G of D){const K=y.getTerrainMesh(G.tileID),W=y.getTerrainData(G.tileID),Q=A.getProjectionData({overscaledTileID:G.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ne={u_ele_delta:y.getMeshFrameDelta(A.zoom)};O.draw(w,T.TRIANGLES,I,ei.disabled,C,Ot.backCCW,ne,W,Q,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,y){const w=m.context,T=w.gl,A=m.transform,C=ii.unblended,I=new Ut(T.LEQUAL,Ut.ReadWrite,[0,1]),D=y.getCoordsTexture(),O=y.tileManager.getRenderableTiles(),G=m.useProgram("terrainCoords");w.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),w.clear({color:d.bi.transparent,depth:1}),y.coordsIndex=[];for(const K of O){const W=y.getTerrainMesh(K.tileID),Q=y.getTerrainData(K.tileID);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,D.texture);const ne={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(A.zoom)},se=A.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});G.draw(w,T.TRIANGLES,I,ei.disabled,C,Ot.backCCW,ne,Q,se,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),y.coordsIndex.push(K.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(e,r,l,h,m){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,d.cf(l)?function(y,w,T,A,C,I){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:D}=I,O=ei.disabled,G=y.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(K,W,Q,ne,se,te,oe,de,ae){const fe=W.transform,Pe=W.style.map.terrain,Se=se==="map",Ce=te==="map";for(const Ie of K){const Ke=ne.getTile(Ie),We=Ke.getBucket(Q);if(!We||!We.text||!We.text.segments.get().length)continue;const Fe=d.ar(We.textSizeData,fe.zoom),lt=d.aG(Ke,1,W.transform.zoom),Lt=fa(Se,W.transform,lt),ui=Q.layout.get("icon-text-fit")!=="none"&&We.hasIconData();if(Fe){const Vt=Math.pow(2,fe.zoom-Ke.tileID.overscaledZ),Si=Pe?(Wi,Di)=>Pe.getElevation(Ie,Wi,Di):null;no(We,Se,Ce,ae,fe,Lt,Vt,Fe,ui,d.aH(fe,Ke,oe,de),Ie.toUnwrapped(),Si)}}}(A,y,T,w,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),C),T.paint.get("icon-opacity").constantOr(1)!==0&&Hn(y,w,T,A,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),O,G,D),T.paint.get("text-opacity").constantOr(1)!==0&&Hn(y,w,T,A,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),O,G,D),w.map.showCollisionBoxes&&(pa(y,w,T,A,!0),pa(y,w,T,A,!1))}(e,r,l,h,this.style.placement.variableOffsets,m):d.cg(l)?function(y,w,T,A,C){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:I}=C,D=T.paint.get("circle-opacity"),O=T.paint.get("circle-stroke-width"),G=T.paint.get("circle-stroke-opacity"),K=!T.layout.get("circle-sort-key").isConstant();if(D.constantOr(1)===0&&(O.constantOr(1)===0||G.constantOr(1)===0))return;const W=y.context,Q=W.gl,ne=y.transform,se=y.getDepthModeForSublayer(0,Ut.ReadOnly),te=ei.disabled,oe=y.colorModeForRenderPass(),de=[],ae=ne.getCircleRadiusCorrection();for(let fe=0;fe<A.length;fe++){const Pe=A[fe],Se=w.getTile(Pe),Ce=Se.getBucket(T);if(!Ce)continue;const Ie=T.paint.get("circle-translate"),Ke=T.paint.get("circle-translate-anchor"),We=d.aH(ne,Se,Ie,Ke),Fe=Ce.programConfigurations.get(T.id),lt=y.useProgram("circle",Fe),Lt=Ce.layoutVertexBuffer,ui=Ce.indexBuffer,Vt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Pe),Si={programConfiguration:Fe,program:lt,layoutVertexBuffer:Lt,indexBuffer:ui,uniformValues:Zd(y,Se,T,We,ae),terrainData:Vt,projectionData:ne.getProjectionData({overscaledTileID:Pe,applyGlobeMatrix:!I,applyTerrainMatrix:!0})};if(K){const Wi=Ce.segments.get();for(const Di of Wi)de.push({segments:new d.aQ([Di]),sortKey:Di.sortKey,state:Si})}else de.push({segments:Ce.segments,sortKey:0,state:Si})}K&&de.sort((fe,Pe)=>fe.sortKey-Pe.sortKey);for(const fe of de){const{programConfiguration:Pe,program:Se,layoutVertexBuffer:Ce,indexBuffer:Ie,uniformValues:Ke,terrainData:We,projectionData:Fe}=fe.state;Se.draw(W,Q.TRIANGLES,se,te,oe,Ot.backCCW,Ke,We,Fe,T.id,Ce,Ie,fe.segments,T.paint,y.transform.zoom,Pe)}}(e,r,l,h,m):d.ch(l)?function(y,w,T,A,C){if(T.paint.get("heatmap-opacity")===0)return;const I=y.context,{isRenderingToTexture:D,isRenderingGlobe:O}=C;if(y.style.map.terrain){for(const G of A){const K=w.getTile(G);w.hasRenderableParent(G)||(y.renderPass==="offscreen"?Kr(y,K,T,G,O):y.renderPass==="translucent"&&Oa(y,T,G,D,O))}I.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function(G,K,W,Q){const ne=G.context,se=ne.gl,te=G.transform,oe=ei.disabled,de=new ii([se.ONE,se.ONE],d.bi.transparent,[!0,!0,!0,!0]);(function(ae,fe,Pe){const Se=ae.gl;ae.activeTexture.set(Se.TEXTURE1),ae.viewport.set([0,0,fe.width/4,fe.height/4]);let Ce=Pe.heatmapFbos.get(d.c6);Ce?(Se.bindTexture(Se.TEXTURE_2D,Ce.colorAttachment.get()),ae.bindFramebuffer.set(Ce.framebuffer)):(Ce=Wr(ae,fe.width/4,fe.height/4),Pe.heatmapFbos.set(d.c6,Ce))})(ne,G,W),ne.clear({color:d.bi.transparent});for(let ae=0;ae<Q.length;ae++){const fe=Q[ae];if(K.hasRenderableParent(fe))continue;const Pe=K.getTile(fe),Se=Pe.getBucket(W);if(!Se)continue;const Ce=Se.programConfigurations.get(W.id),Ie=G.useProgram("heatmap",Ce),Ke=te.getProjectionData({overscaledTileID:fe,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),We=te.getCircleRadiusCorrection();Ie.draw(ne,se.TRIANGLES,Ut.disabled,oe,de,Ot.backCCW,Po(Pe,te.zoom,W.paint.get("heatmap-intensity"),We),null,Ke,W.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,W.paint,te.zoom,Ce)}ne.viewport.set([0,0,G.width,G.height])}(y,w,T,A):y.renderPass==="translucent"&&function(G,K){const W=G.context,Q=W.gl;W.setColorMode(G.colorModeForRenderPass());const ne=K.heatmapFbos.get(d.c6);ne&&(W.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,ne.colorAttachment.get()),W.activeTexture.set(Q.TEXTURE1),lu(W,K).bind(Q.LINEAR,Q.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw(W,Q.TRIANGLES,Ut.disabled,ei.disabled,G.colorModeForRenderPass(),Ot.disabled,$u(G,K,0,1),null,null,K.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,K.paint,G.transform.zoom))}(y,T)}(e,r,l,h,m):d.ci(l)?function(y,w,T,A,C){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:I}=C,D=T.paint.get("line-opacity"),O=T.paint.get("line-width");if(D.constantOr(1)===0||O.constantOr(1)===0)return;const G=y.getDepthModeForSublayer(0,Ut.ReadOnly),K=y.colorModeForRenderPass(),W=T.paint.get("line-dasharray"),Q=W.constantOr(1),ne=T.paint.get("line-pattern"),se=ne.constantOr(1),te=T.paint.get("line-gradient"),oe=T.getCrossfadeParameters();let de;de=se?"linePattern":Q&&te?"lineGradientSDF":Q?"lineSDF":te?"lineGradient":"line";const ae=y.context,fe=ae.gl,Pe=y.transform;let Se=!0;for(const Ce of A){const Ie=w.getTile(Ce);if(se&&!Ie.patternsLoaded())continue;const Ke=Ie.getBucket(T);if(!Ke)continue;const We=Ke.programConfigurations.get(T.id),Fe=y.context.program.get(),lt=y.useProgram(de,We),Lt=Se||lt.program!==Fe,ui=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ce),Vt=ne.constantOr(null),Si=W&&W.constantOr(null);if(Vt&&Ie.imageAtlas){const In=Ie.imageAtlas,qi=In.patternPositions[Vt.to.toString()],mn=In.patternPositions[Vt.from.toString()];qi&&mn&&We.setConstantPatternPositions(qi,mn)}else if(Si){const In=T.layout.get("line-cap")==="round",qi=y.lineAtlas.getDash(Si.to,In),mn=y.lineAtlas.getDash(Si.from,In);We.setConstantDashPositions(qi,mn)}const Wi=Pe.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),Di=Pe.getPixelScale();let Tn;se?(Tn=Jl(y,Ie,T,Di,oe),sc(ae,fe,Ie,We,oe)):Q&&te?(Tn=qd(y,Ie,T,Di,oe,Ke.lineClipsArray.length),Pi(y,w,ae,fe,T,Ke,Ce,We,oe)):Q?(Tn=$h(y,Ie,T,Di,oe),rh(y,ae,fe,We,Lt,oe)):te?(Tn=Yh(y,Ie,T,Di,Ke.lineClipsArray.length),Xn(y,w,ae,fe,T,Ke,Ce)):Tn=Hr(y,Ie,T,Di);const Zi=y.stencilModeForClipping(Ce);lt.draw(ae,fe.TRIANGLES,G,Zi,K,Ot.disabled,Tn,ui,Wi,T.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,T.paint,y.transform.zoom,We,Ke.layoutVertexBuffer2),Se=!1}}(e,r,l,h,m):d.cj(l)?function(y,w,T,A,C){const I=T.paint.get("fill-color"),D=T.paint.get("fill-opacity");if(D.constantOr(1)===0)return;const{isRenderingToTexture:O}=C,G=y.colorModeForRenderPass(),K=T.paint.get("fill-pattern"),W=y.opaquePassEnabledForLayer()&&!K.constantOr(1)&&I.constantOr(d.bi.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===W){const Q=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?Ut.ReadWrite:Ut.ReadOnly);xs(y,w,T,A,Q,G,!1,O)}if(y.renderPass==="translucent"&&T.paint.get("fill-antialias")){const Q=y.getDepthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,Ut.ReadOnly);xs(y,w,T,A,Q,G,!0,O)}}(e,r,l,h,m):d.ck(l)?function(y,w,T,A,C){const I=T.paint.get("fill-extrusion-opacity");if(I===0)return;const{isRenderingToTexture:D}=C;if(y.renderPass==="translucent"){const O=new Ut(y.context.gl.LEQUAL,Ut.ReadWrite,y.depthRangeFor3D);if(I!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))Aa(y,w,T,A,O,ei.disabled,ii.disabled,D),Aa(y,w,T,A,O,y.stencilModeFor3D(),y.colorModeForRenderPass(),D);else{const G=y.colorModeForRenderPass();Aa(y,w,T,A,O,ei.disabled,G,D)}}}(e,r,l,h,m):d.cl(l)?function(y,w,T,A,C){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const{isRenderingToTexture:I}=C,D=y.context,O=y.style.projection.useSubdivision,G=y.getDepthModeForSublayer(0,Ut.ReadOnly),K=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function(W,Q,ne,se,te,oe,de){const ae=W.context,fe=ae.gl;for(const Pe of ne){const Se=Q.getTile(Pe),Ce=Se.dem;if(!Ce||!Ce.data||!Se.needsHillshadePrepare)continue;const Ie=Ce.dim,Ke=Ce.stride,We=Ce.getPixels();if(ae.activeTexture.set(fe.TEXTURE1),ae.pixelStoreUnpackPremultiplyAlpha.set(!1),Se.demTexture=Se.demTexture||W.getTileTexture(Ke),Se.demTexture){const lt=Se.demTexture;lt.update(We,{premultiply:!1}),lt.bind(fe.NEAREST,fe.CLAMP_TO_EDGE)}else Se.demTexture=new d.T(ae,We,fe.RGBA,{premultiply:!1}),Se.demTexture.bind(fe.NEAREST,fe.CLAMP_TO_EDGE);ae.activeTexture.set(fe.TEXTURE0);let Fe=Se.fbo;if(!Fe){const lt=new d.T(ae,{width:Ie,height:Ie,data:null},fe.RGBA);lt.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),Fe=Se.fbo=ae.createFramebuffer(Ie,Ie,!0,!1),Fe.colorAttachment.set(lt.texture)}ae.bindFramebuffer.set(Fe.framebuffer),ae.viewport.set([0,0,Ie,Ie]),W.useProgram("hillshadePrepare").draw(ae,fe.TRIANGLES,te,oe,de,Ot.disabled,Qs(Se.tileID,Ce),null,null,se.id,W.rasterBoundsBuffer,W.quadTriangleIndexBuffer,W.rasterBoundsSegments),Se.needsHillshadePrepare=!1}})(y,w,A,T,G,ei.disabled,K),D.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(O){const[W,Q,ne]=y.stencilConfigForOverlapTwoPass(A);Gi(y,w,T,ne,W,G,K,!1,I),Gi(y,w,T,ne,Q,G,K,!0,I)}else{const[W,Q]=y.getStencilConfigForOverlapAndUpdateStencilID(A);Gi(y,w,T,Q,W,G,K,!1,I)}}(e,r,l,h,m):d.cm(l)?function(y,w,T,A,C){if(y.renderPass!=="translucent"||!A.length)return;const{isRenderingToTexture:I}=C,D=y.style.projection.useSubdivision,O=y.getDepthModeForSublayer(0,Ut.ReadOnly),G=y.colorModeForRenderPass();if(D){const[K,W,Q]=y.stencilConfigForOverlapTwoPass(A);ma(y,w,T,Q,K,O,G,!1,I),ma(y,w,T,Q,W,O,G,!0,I)}else{const[K,W]=y.getStencilConfigForOverlapAndUpdateStencilID(A);ma(y,w,T,W,K,O,G,!1,I)}}(e,r,l,h,m):d.bN(l)?function(y,w,T,A,C){if(y.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!A.length)return;const{isRenderingToTexture:I}=C,D=w.getSource(),O=y.style.projection.useSubdivision;if(D instanceof pn)Fo(y,w,T,A,null,!1,!1,D.tileCoords,D.flippedWindingOrder,I);else if(O){const[G,K,W]=y.stencilConfigForOverlapTwoPass(A);Fo(y,w,T,W,G,!1,!0,Ca,!1,I),Fo(y,w,T,W,K,!0,!0,Ca,!1,I)}else{const[G,K]=y.getStencilConfigForOverlapAndUpdateStencilID(A);Fo(y,w,T,K,G,!1,!0,Ca,!1,I)}}(e,r,l,h,m):d.cn(l)?function(y,w,T,A,C){const I=T.paint.get("background-color"),D=T.paint.get("background-opacity");if(D===0)return;const{isRenderingToTexture:O}=C,G=y.context,K=G.gl,W=y.style.projection,Q=y.transform,ne=Q.tileSize,se=T.paint.get("background-pattern");if(y.isPatternMissing(se))return;const te=!se&&I.a===1&&D===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==te)return;const oe=ei.disabled,de=y.getDepthModeForSublayer(0,te==="opaque"?Ut.ReadWrite:Ut.ReadOnly),ae=y.colorModeForRenderPass(),fe=y.useProgram(se?"backgroundPattern":"background"),Pe=A||Ni(Q,{tileSize:ne,terrain:y.style.map.terrain});se&&(G.activeTexture.set(K.TEXTURE0),y.imageManager.bind(y.context));const Se=T.getCrossfadeParameters();for(const Ce of Pe){const Ie=Q.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Ke=se?Jc(D,y,se,{tileID:Ce,tileSize:ne},Se):Qc(D,I),We=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ce),Fe=W.getMeshFromTileID(G,Ce.canonical,!1,!0,"raster");fe.draw(G,K.TRIANGLES,de,oe,ae,Ot.backCCW,Ke,We,Ie,T.id,Fe.vertexBuffer,Fe.indexBuffer,Fe.segments)}}(e,0,l,h,m):d.co(l)&&function(y,w,T,A){const{isRenderingGlobe:C}=A,I=y.context,D=T.implementation,O=y.style.projection,G=y.transform,K=G.getProjectionDataForCustomLayer(C),W={farZ:G.farZ,nearZ:G.nearZ,fov:G.fov*Math.PI/180,modelViewProjectionMatrix:G.modelViewProjectionMatrix,projectionMatrix:G.projectionMatrix,shaderData:{variantName:O.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${O.shaderPreludeCode.vertexSource}`,define:O.shaderDefine},defaultProjectionData:K},Q=D.renderingMode?D.renderingMode:"2d";if(y.renderPass==="offscreen"){const ne=D.prerender;ne&&(y.setCustomLayerDefaults(),I.setColorMode(y.colorModeForRenderPass()),ne.call(D,I.gl,W),I.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),I.setColorMode(y.colorModeForRenderPass()),I.setStencilMode(ei.disabled);const ne=Q==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,Ut.ReadOnly);I.setDepthMode(ne),D.render(I.gl,W),I.setDirty(),y.setBaseState(),I.bindFramebuffer.set(null)}}(e,0,l,m))}saveTileTexture(e){const r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const r=this._tileTextures[e];return r&&r.length>0?r.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const r=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!r||!l}useProgram(e,r,l=!1,h=[]){this.cache=this.cache||{};const m=!!this.style.map.terrain,y=this.style.projection,w=l?Dt.projectionMercator:y.shaderPreludeCode,T=l?jn:y.shaderDefine,A=e+(r?r.cacheKey:"")+`/${l?bn:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(m?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[A]||(this.cache[A]=new yl(this.context,Dt[e],r,eu[e],this._showOverdrawInspector,m,w,T,h)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:r}=this.context.gl;return this.width!==e||this.height!==r}}function Ts(f,e){let r,l=!1,h=null,m=null;const y=()=>{h=null,l&&(f.apply(m,r),h=setTimeout(y,e),l=!1)};return(...w)=>(l=!0,m=this,r=w,h||y(),h)}class Fn{constructor(e){this._getCurrentHash=()=>{const r=window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(l=h)}),(l&&l[1]||"").split("/")}return r.split("/")},this._onHashChange=()=>{const r=this._getCurrentHash();if(!this._isValidHash(r))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:l,pitch:+(r[4]||0)}),!0},this._updateHashUnthrottled=()=>{const r=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,r)},this._removeHash=()=>{const r=this._getCurrentHash();if(r.length===0)return;const l=r.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let m=window.location.hash.replace(h,"");m.startsWith("#&")?m=m.slice(0,1)+m.slice(2):m==="#"&&(m="");let y=window.location.href.replace(/(#.+)?$/,m);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=Ts(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const r=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,h),y=Math.round(r.lng*m)/m,w=Math.round(r.lat*m)/m,T=this._map.getBearing(),A=this._map.getPitch();let C="";if(C+=e?`/${y}/${w}/${l}`:`${l}/${w}/${y}`,(T||A)&&(C+="/"+Math.round(10*T)/10),A&&(C+=`/${Math.round(A)}`),this._hashName){const I=this._hashName;let D=!1;const O=window.location.hash.slice(1).split("&").map(G=>{const K=G.split("=")[0];return K===I?(D=!0,`${K}=${C}`):G}).filter(G=>G);return D||O.push(`${I}=${C}`),`#${O.join("&")}`}return`#${C}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new d.U(+e[2],+e[1])}catch{return!1}const r=+e[0],l=+(e[3]||0),h=+(e[4]||0);return r>=this._map.getMinZoom()&&r<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const Ss={linearity:.3,easing:d.cp(0,0,.3,1)},sh=d.e({deceleration:2500,maxSpeed:1400},Ss),Jh=d.e({deceleration:20,maxSpeed:1400},Ss),ed=d.e({deceleration:1e3,maxSpeed:360},Ss),td=d.e({deceleration:1e3,maxSpeed:90},Ss),hn=d.e({deceleration:1e3,maxSpeed:360},Ss);class uu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:mt(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,r=mt();for(;e.length>0&&r-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,roll:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)r.zoom+=m.zoomDelta||0,r.bearing+=m.bearingDelta||0,r.pitch+=m.pitchDelta||0,r.roll+=m.rollDelta||0,m.panDelta&&r.pan._add(m.panDelta),m.around&&(r.around=m.around),m.pinchAround&&(r.pinchAround=m.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(r.pan.mag()){const m=Un(r.pan.mag(),l,d.e({},sh,e||{})),y=r.pan.mult(m.amount/r.pan.mag()),w=this._map.cameraHelper.handlePanInertia(y,this._map.transform);h.center=w.easingCenter,h.offset=w.easingOffset,Pn(h,m)}if(r.zoom){const m=Un(r.zoom,l,Jh);h.zoom=this._map.transform.zoom+m.amount,Pn(h,m)}if(r.bearing){const m=Un(r.bearing,l,ed);h.bearing=this._map.transform.bearing+d.ai(m.amount,-179,179),Pn(h,m)}if(r.pitch){const m=Un(r.pitch,l,td);h.pitch=this._map.transform.pitch+m.amount,Pn(h,m)}if(r.roll){const m=Un(r.roll,l,hn);h.roll=this._map.transform.roll+d.ai(m.amount,-179,179),Pn(h,m)}if(h.zoom||h.bearing){const m=r.pinchAround===void 0?r.around:r.pinchAround;h.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),d.e(h,{noMoveStart:!0})}}function Pn(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function Un(f,e,r){const{maxSpeed:l,linearity:h,deceleration:m}=r,y=d.ai(f*h/(e/1e3),-l,l),w=Math.abs(y)/(m*h);return{easing:r.easing,duration:1e3*w,amount:y*(w/2)}}class ga extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(e,l);const m=we.mousePos(r.getCanvas(),l),y=r.unproject(m);super(e,d.e({point:m,lngLat:y,originalEvent:l},h)),this._defaultPrevented=!1,this.target=r}}class Dn extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l){const h=e==="touchend"?l.changedTouches:l.touches,m=we.touchPos(r.getCanvasContainer(),h),y=m.map(T=>r.unproject(T)),w=m.reduce((T,A,C,I)=>T.add(A.div(I.length)),new d.P(0,0));super(e,{points:m,point:w,lngLats:y,lngLat:r.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Vo extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,r,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Tl{constructor(e,r){this._map=e,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Vo(e.type,this._map,e))}mousedown(e,r){return this._mousedownPos=r,this._firePreventable(new ga(e.type,this._map,e))}mouseup(e){this._map.fire(new ga(e.type,this._map,e))}click(e,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new ga(e.type,this._map,e))}dblclick(e){return this._firePreventable(new ga(e.type,this._map,e))}mouseover(e){this._map.fire(new ga(e.type,this._map,e))}mouseout(e){this._map.fire(new ga(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Dn(e.type,this._map,e))}touchmove(e){this._map.fire(new Dn(e.type,this._map,e))}touchend(e){this._map.fire(new Dn(e.type,this._map,e))}touchcancel(e){this._map.fire(new Dn(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class id{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new ga(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ga("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new ga(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cc{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(d.P.convert(e),this._map.terrain)}}class oh{constructor(e,r){this._map=e,this._tr=new cc(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,r){this.isEnabled()&&e.shiftKey&&e.button===0&&(we.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(e,r){if(!this._active)return;const l=r;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=we.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const m=Math.min(h.x,l.x),y=Math.max(h.x,l.x),w=Math.min(h.y,l.y),T=Math.max(h.y,l.y);we.setTransform(this._box,`translate(${m}px,${w}px)`),this._box.style.width=y-m+"px",this._box.style.height=T-w+"px"}mouseupWindow(e,r){if(!this._active||e.button!==0)return;const l=this._startPos,h=r;if(this.reset(),we.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new d.l("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(we.remove(this._box),this._box=null),we.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,r){return this._map.fire(new d.l(e,{originalEvent:r}))}}function Ms(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const r={};for(let l=0;l<f.length;l++)r[f[l].identifier]=e[l];return r}class hu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,r,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){const m=new d.P(0,0);for(const y of h)m._add(y);return m.div(h.length)}(r),this.touches=Ms(l,r)))}touchmove(e,r,l){if(this.aborted||!this.centroid)return;const h=Ms(l,r);for(const m in this.touches){const y=h[m];(!y||y.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,r,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class Jr{constructor(e){this.singleTap=new hu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,r,l){this.singleTap.touchstart(e,r,l)}touchmove(e,r,l){this.singleTap.touchmove(e,r,l)}touchend(e,r,l){const h=this.singleTap.touchend(e,r,l);if(h){const m=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(h)<30;if(m&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class es{constructor(e){this._tr=new cc(e),this._zoomIn=new Jr({numTouches:1,numTaps:2}),this._zoomOut=new Jr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,r,l){this._zoomIn.touchstart(e,r,l),this._zoomOut.touchstart(e,r,l)}touchmove(e,r,l){this._zoomIn.touchmove(e,r,l),this._zoomOut.touchmove(e,r,l)}touchend(e,r,l){const h=this._zoomIn.touchend(e,r,l),m=this._zoomOut.touchend(e,r,l),y=this._tr;return h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(h)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rt{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const r=this._moveFunction(...e);if(r.bearingDelta||r.pitchDelta||r.rollDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(e,r){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(r)?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,r){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const h=Array.isArray(r)?r[0]:r;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&we.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const du=0,Sl=2,uc={[du]:1,[Sl]:2};class ts{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const r=we.mouseButton(e);this._eventButton=r}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(r,l){const h=uc[l];return r.buttons===void 0||(r.buttons&h)!==h}(e,this._eventButton)}isValidEndEvent(e){return we.mouseButton(e)===this._eventButton}}class Ml{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Es{constructor(e=new ts({checkCorrectEvent:()=>!0}),r=new Ml){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=r}_executeRelevantHandler(e,r,l){return e instanceof MouseEvent?r(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.startMove(r),r=>this.oneFingerTouchMoveStateManager.startMove(r))}endMove(e){this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.endMove(r),r=>this.oneFingerTouchMoveStateManager.endMove(r))}isValidStartEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidStartEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidStartEvent(r))}isValidMoveEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidMoveEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(r))}isValidEndEvent(e){return this._executeRelevantHandler(e,r=>this.mouseMoveStateManager.isValidEndEvent(r),r=>this.oneFingerTouchMoveStateManager.isValidEndEvent(r))}}const jt=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}};class fu{constructor(e,r){this._clickTolerance=e.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,r,l){return this._calculateTransform(e,r,l)}touchmove(e,r,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,r,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,r,l){this._calculateTransform(e,r,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,r,l){l.length>0&&(this._active=!0);const h=Ms(l,r),m=new d.P(0,0),y=new d.P(0,0);let w=0;for(const A in h){const C=h[A],I=this._touches[A];I&&(m._add(C),y._add(C.sub(I)),w++,h[A]=C)}if(this._touches=h,this._shouldBePrevented(w)||!y.mag())return;const T=y.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(w),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,r,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([r[0],r[1]]))}touchmove(e,r,l){if(!this._firstTwoTouches)return;e.preventDefault();const[h,m]=this._firstTwoTouches,y=Rr(l,r,h),w=Rr(l,r,m);if(!y||!w)return;const T=this._aroundCenter?null:y.add(w).div(2);return this._move([y,w],T,e)}touchend(e,r,l){if(!this._firstTwoTouches)return;const[h,m]=this._firstTwoTouches,y=Rr(l,r,h),w=Rr(l,r,m);y&&w||(this._active&&we.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Rr(f,e,r){for(let l=0;l<f.length;l++)if(f[l].identifier===r)return e[l]}function El(f,e){return Math.log(f/e)/Math.LN2}class hc extends pu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,r){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(El(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:El(this._distance,l),pinchAround:r}}}function Go(f,e){return 180*f.angleWith(e)/Math.PI}class Zo extends pu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,r,l){const h=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Go(this._vector,h),pinchAround:r}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const r=25/(Math.PI*this._minDiameter)*360,l=Go(e,this._startVector);return Math.abs(l)<r}}function dc(f){return Math.abs(f.y)>Math.abs(f.x)}class so extends pu{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,r,l){super.touchstart(e,r,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,dc(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,r,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,m,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(h.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,r,l){if(this._valid!==void 0)return this._valid;const h=e.mag()>=2,m=r.mag()>=2;if(!h&&!m)return;if(!h||!m)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const y=e.y>0==r.y>0;return dc(e)&&dc(r)&&y}}const lh={panStep:100,bearingStep:15,pitchStep:10};class As{constructor(e){this._tr=new cc(e);const r=lh;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let r=0,l=0,h=0,m=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?h=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?h=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:w=>{const T=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:ch,zoom:r?Math.round(T.zoom)+r*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+h*this._pitchStep,offset:[-m*this._panStep,-y*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ch(f){return f*(2-f)}const Lr=4.000244140625,ri=1/450;class Cs{constructor(e,r){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new cc(e),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ri}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let r=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=mt(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,r!==0&&r%Lr==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(h*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=we.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(d.U.convert(l.center)):r,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const w=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>Lr?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&T!==0&&(T=1/T);const A=typeof this._targetZoom!="number"?e.scale:d.al(this._targetZoom);this._targetZoom=e.constrain(e.getCameraLngLat(),d.ao(A*T)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let m,y=!1;if(this._type==="wheel"&&l&&h){const w=mt()-this._lastWheelEventTime,T=Math.min((w+5)/200,1),A=h(T);m=d.F.number(l,r,A),T<1?this._frameId||(this._frameId=!0):y=!0}else m=r,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=m,{noInertia:!0,needsRenderFrame:!y,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let r=d.cr;if(this._prevEase){const l=this._prevEase,h=(mt()-l.start)/l.duration,m=l.easing(h+.01)-l.easing(h),y=.27/Math.sqrt(m*m+1e-4)*.01,w=Math.sqrt(.0729-y*y);r=d.cp(y,w,.25,1)}return this._prevEase={start:mt(),duration:e,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class zs{constructor(e,r){this._clickZoom=e,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fc{constructor(e){this._tr=new cc(e),this.reset()}reset(){this._active=!1}dblclick(e,r){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mu{constructor(){this._tap=new Jr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,r,l){if(!this._swipePoint)if(this._tapTime){const h=r[0],m=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(h)<30;m&&y?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,r,l)}touchmove(e,r,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=r[0],m=h.y-this._swipePoint.y;return this._swipePoint=h,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,r,l)}touchend(e,r,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(e,r,l);h&&(this._tapTime=e.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qo{constructor(e,r,l){this._el=e,this._mousePan=r,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ho{constructor(e,r,l,h){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=r,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class uh{constructor(e,r,l,h){this._el=e,this._touchZoom=r,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class _r{constructor(e,r){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=we.create("div","maplibregl-cooperative-gesture-screen",e);let r=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(r=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=r,this._container.appendChild(h);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=l,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(we.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,r){this._enabled&&(this._map.fire(new d.l("cooperativegestureprevented",{gestureType:e,originalEvent:r})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const yr=f=>f.zoom||f.drag||f.roll||f.pitch||f.rotate;class ht extends d.l{}function xt(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta||f.rollDelta}class Xo{constructor(e,r){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,m)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=h.type==="renderFrame"?void 0:h,w={needsRenderFrame:!1},T={},A={};for(const{handlerName:D,handler:O,allowed:G}of this._handlers){if(!O.isEnabled())continue;let K;if(this._blockedByActive(A,G,D))O.reset();else if(O[m||h.type]){if(d.cs(h,m||h.type)){const W=we.mousePos(this._map.getCanvas(),h);K=O[m||h.type](h,W)}else if(d.ct(h,m||h.type)){const W=this._getMapTouches(h.touches),Q=we.touchPos(this._map.getCanvas(),W);K=O[m||h.type](h,Q,W)}else d.cu(m||h.type)||(K=O[m||h.type](h));this.mergeHandlerResult(w,T,K,D,y),K&&K.needsRenderFrame&&this._triggerRenderFrame()}(K||O.isActive())&&(A[D]=O)}const C={};for(const D in this._previousActiveHandlers)A[D]||(C[D]=y);this._previousActiveHandlers=A,(Object.keys(C).length||xt(w))&&(this._changes.push([w,T,C]),this._triggerRenderFrame()),(Object.keys(A).length||xt(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:I}=w;I&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],I(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new uu(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,m,y]of this._listeners)we.addEventListener(h,m,h===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,r,l]of this._listeners)we.removeEventListener(e,r,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const r=this._map,l=r.getCanvasContainer();this._add("mapEvent",new Tl(r,e));const h=r.boxZoom=new oh(r,e);this._add("boxZoom",h),e.interactive&&e.boxZoom&&h.enable();const m=r.cooperativeGestures=new _r(r,e.cooperativeGestures);this._add("cooperativeGestures",m),e.cooperativeGestures&&m.enable();const y=new es(r),w=new fc(r);r.doubleClickZoom=new zs(w,y),this._add("tapZoom",y),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&r.doubleClickZoom.enable();const T=new mu;this._add("tapDragZoom",T);const A=r.touchPitch=new so(r);this._add("touchPitch",A),e.interactive&&e.touchPitch&&r.touchPitch.enable(e.touchPitch);const C=()=>r.project(r.getCenter()),I=function({enable:te,clickTolerance:oe,aroundCenter:de=!0,minPixelCenterThreshold:ae=100,rotateDegreesPerPixelMoved:fe=.8},Pe){const Se=new ts({checkCorrectEvent:Ce=>we.mouseButton(Ce)===0&&Ce.ctrlKey||we.mouseButton(Ce)===2&&!Ce.ctrlKey});return new rt({clickTolerance:oe,move:(Ce,Ie)=>{const Ke=Pe();if(de&&Math.abs(Ke.y-Ce.y)>ae)return{bearingDelta:d.cq(new d.P(Ce.x,Ie.y),Ie,Ke)};let We=(Ie.x-Ce.x)*fe;return de&&Ie.y<Ke.y&&(We=-We),{bearingDelta:We}},moveStateManager:Se,enable:te,assignEvents:jt})}(e,C),D=function({enable:te,clickTolerance:oe,pitchDegreesPerPixelMoved:de=-.5}){const ae=new ts({checkCorrectEvent:fe=>we.mouseButton(fe)===0&&fe.ctrlKey||we.mouseButton(fe)===2});return new rt({clickTolerance:oe,move:(fe,Pe)=>({pitchDelta:(Pe.y-fe.y)*de}),moveStateManager:ae,enable:te,assignEvents:jt})}(e),O=function({enable:te,clickTolerance:oe,rollDegreesPerPixelMoved:de=.3},ae){const fe=new ts({checkCorrectEvent:Pe=>we.mouseButton(Pe)===2&&Pe.ctrlKey});return new rt({clickTolerance:oe,move:(Pe,Se)=>{const Ce=ae();let Ie=(Se.x-Pe.x)*de;return Se.y<Ce.y&&(Ie=-Ie),{rollDelta:Ie}},moveStateManager:fe,enable:te,assignEvents:jt})}(e,C);r.dragRotate=new Ho(e,I,D,O),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",D,["mouseRotate","mouseRoll"]),this._add("mouseRoll",O,["mousePitch"]),e.interactive&&e.dragRotate&&r.dragRotate.enable();const G=function({enable:te,clickTolerance:oe}){const de=new ts({checkCorrectEvent:ae=>we.mouseButton(ae)===0&&!ae.ctrlKey});return new rt({clickTolerance:oe,move:(ae,fe)=>({around:fe,panDelta:fe.sub(ae)}),activateOnStart:!0,moveStateManager:de,enable:te,assignEvents:jt})}(e),K=new fu(e,r);r.dragPan=new qo(l,G,K),this._add("mousePan",G),this._add("touchPan",K,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&r.dragPan.enable(e.dragPan);const W=new Zo,Q=new hc;r.touchZoomRotate=new uh(l,Q,W,T),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&r.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new id(r));const ne=r.scrollZoom=new Cs(r,()=>this._triggerRenderFrame());this._add("scrollZoom",ne,["mousePan"]),e.interactive&&e.scrollZoom&&r.scrollZoom.enable(e.scrollZoom);const se=r.keyboard=new As(r);this._add("keyboard",se),e.interactive&&e.keyboard&&r.keyboard.enable()}_add(e,r,l){this._handlers.push({handlerName:e,handler:r,allowed:l}),this._handlersById[e]=r}stop(e){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yr(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,r,l){for(const h in e)if(h!==l&&(!r||r.indexOf(h)<0))return!0;return!1}_getMapTouches(e){const r=[];for(const l of e)this._el.contains(l.target)&&r.push(l);return r}mergeHandlerResult(e,r,l,h,m){if(!l)return;d.e(e,l);const y={handlerName:h,originalEvent:l.originalEvent||m};l.zoomDelta!==void 0&&(r.zoom=y),l.panDelta!==void 0&&(r.drag=y),l.rollDelta!==void 0&&(r.roll=y),l.pitchDelta!==void 0&&(r.pitch=y),l.bearingDelta!==void 0&&(r.rotate=y)}_applyChanges(){const e={},r={},l={};for(const[h,m,y]of this._changes)h.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(h.panDelta)),h.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(e.rollDelta=(e.rollDelta||0)+h.rollDelta),h.around!==void 0&&(e.around=h.around),h.pinchAround!==void 0&&(e.pinchAround=h.pinchAround),h.noInertia&&(e.noInertia=h.noInertia),d.e(r,m),d.e(l,y);this._updateMapTransform(e,r,l),this._changes=[]}_updateMapTransform(e,r,l){const h=this._map,m=h._getTransformForUpdate(),y=h.terrain;if(!(xt(e)||y&&this._terrainMovement))return this._fireEvents(r,l,!0);h._stop(!0);let{panDelta:w,zoomDelta:T,bearingDelta:A,pitchDelta:C,rollDelta:I,around:D,pinchAround:O}=e;O!==void 0&&(D=O),D=D||h.transform.centerPoint,y&&!m.isPointOnMapSurface(D)&&(D=m.centerPoint);const G={panDelta:w,zoomDelta:T,rollDelta:I,pitchDelta:C,bearingDelta:A,around:D};this._map.cameraHelper.useGlobeControls&&!m.isPointOnMapSurface(D)&&(D=m.centerPoint);const K=D.distSqr(m.centerPoint)<.01?m.center:m.screenPointToLocation(w?D.sub(w):D);this._handleMapControls({terrain:y,tr:m,deltasForHelper:G,preZoomAroundLoc:K,combinedEventsInProgress:r,panDelta:w}),h._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,l,!0)}_handleMapControls({terrain:e,tr:r,deltasForHelper:l,preZoomAroundLoc:h,combinedEventsInProgress:m,panDelta:y}){const w=this._map.cameraHelper;if(w.handleMapControlsRollPitchBearingZoom(l,r),e)return w.useGlobeControls?(this._terrainMovement||!m.drag&&!m.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void w.handleMapControlsPan(l,r,h)):this._terrainMovement||!m.drag&&!m.zoom?void(m.drag&&this._terrainMovement&&y?r.setCenter(r.screenPointToLocation(r.centerPoint.sub(y))):w.handleMapControlsPan(l,r,h)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void w.handleMapControlsPan(l,r,h));w.handleMapControlsPan(l,r,h)}_fireEvents(e,r,l){const h=yr(this._eventsInProgress),m=yr(e),y={};for(const I in e){const{originalEvent:D}=e[I];this._eventsInProgress[I]||(y[`${I}start`]=D),this._eventsInProgress[I]=e[I]}!h&&m&&this._fireEvent("movestart",m.originalEvent);for(const I in y)this._fireEvent(I,y[I]);m&&this._fireEvent("move",m.originalEvent);for(const I in e){const{originalEvent:D}=e[I];this._fireEvent(I,D)}const w={};let T;for(const I in this._eventsInProgress){const{handlerName:D,originalEvent:O}=this._eventsInProgress[I];this._handlersById[D].isActive()||(delete this._eventsInProgress[I],T=r[D]||O,w[`${I}end`]=T)}for(const I in w)this._fireEvent(I,w[I]);const A=yr(this._eventsInProgress),C=(h||m)&&!A;if(C&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const I=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&I.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(I)}if(l&&C){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!I||!I.essential&&et.prefersReducedMotion?(this._map.fire(new d.l("moveend",{originalEvent:T})),D(this._map.getBearing())&&this._map.resetNorth()):(D(I.bearing||this._map.getBearing())&&(I.bearing=0),I.freezeElevation=!0,this._map.easeTo(I,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,r){this._map.fire(new d.l(e,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new ht("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class gu extends d.E{constructor(e,r,l){super(),this._renderFrameCallback=()=>{const h=Math.min((mt()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=r,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,r){e.apply(this.transform),this.transform=e,this.cameraHelper=r}getCenter(){return new d.U(this.transform.center.lng,this.transform.center.lat)}setCenter(e,r){return this.jumpTo({center:e},r)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,r){return this.jumpTo({elevation:e},r),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,r,l){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},r),l)}panTo(e,r,l){return this.easeTo(d.e({center:e},r),l)}getZoom(){return this.transform.zoom}setZoom(e,r){return this.jumpTo({zoom:e},r),this}zoomTo(e,r,l){return this.easeTo(d.e({zoom:e},r),l)}zoomIn(e,r){return this.zoomTo(this.getZoom()+1,e,r),this}zoomOut(e,r){return this.zoomTo(this.getZoom()-1,e,r),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,r){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new d.l("movestart",r)).fire(new d.l("move",r)).fire(new d.l("moveend",r))),this}getBearing(){return this.transform.bearing}setBearing(e,r){return this.jumpTo({bearing:e},r),this}getPadding(){return this.transform.padding}setPadding(e,r){return this.jumpTo({padding:e},r),this}rotateTo(e,r,l){return this.easeTo(d.e({bearing:e},r),l)}resetNorth(e,r){return this.rotateTo(0,d.e({duration:1e3},e),r),this}resetNorthPitch(e,r){return this.easeTo(d.e({bearing:0,pitch:0,roll:0,duration:1e3},e),r),this}snapToNorth(e,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,r):this}getPitch(){return this.transform.pitch}setPitch(e,r){return this.jumpTo({pitch:e},r),this}getRoll(){return this.transform.roll}setRoll(e,r){return this.jumpTo({roll:e},r),this}cameraForBounds(e,r){e=Ci.convert(e).adjustAntiMeridian();const l=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,r)}_cameraForBoxAndBearing(e,r,l,h){const m={top:0,bottom:0,right:0,left:0};if(typeof(h=d.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const A=h.padding;h.padding={top:A,bottom:A,right:A,left:A}}const y=d.e(m,h.padding);h.padding=y;const w=this.transform,T=new Ci(e,r);return this.cameraHelper.cameraForBoxAndBearing(h,y,T,l,w)}fitBounds(e,r,l){return this._fitInternal(this.cameraForBounds(e,r),r,l)}fitScreenCoordinates(e,r,l,h,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(d.P.convert(e)),this.transform.screenPointToLocation(d.P.convert(r)),l,h),h,m)}_fitInternal(e,r,l){return e?(delete(r=d.e(e,r)).padding,r.linear?this.easeTo(r,l):this.flyTo(r,l)):this}jumpTo(e,r){this.stop();const l=this._getTransformForUpdate();let h=!1,m=!1,y=!1;const w=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const T=l.zoom!==w;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(h=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(m=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(y=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new d.l("movestart",r)).fire(new d.l("move",r)),T&&this.fire(new d.l("zoomstart",r)).fire(new d.l("zoom",r)).fire(new d.l("zoomend",r)),h&&this.fire(new d.l("rotatestart",r)).fire(new d.l("rotate",r)).fire(new d.l("rotateend",r)),m&&this.fire(new d.l("pitchstart",r)).fire(new d.l("pitch",r)).fire(new d.l("pitchend",r)),y&&this.fire(new d.l("rollstart",r)).fire(new d.l("roll",r)).fire(new d.l("rollend",r)),this.fire(new d.l("moveend",r))}calculateCameraOptionsFromTo(e,r,l,h=0){const m=d.a5.fromLngLat(e,r),y=d.a5.fromLngLat(l,h),w=y.x-m.x,T=y.y-m.y,A=y.z-m.z,C=Math.hypot(w,T,A);if(C===0)throw new Error("Can't calculate camera options with same From and To");const I=Math.hypot(w,T),D=d.ao(this.transform.cameraToCenterDistance/C/this.transform.tileSize),O=180*Math.atan2(w,-T)/Math.PI;let G=180*Math.acos(I/C)/Math.PI;return G=A<0?90-G:90+G,{center:y.toLngLat(),elevation:h,zoom:D,pitch:G,bearing:O}}calculateCameraOptionsFromCameraLngLatAltRotation(e,r,l,h,m){const y=this.transform.calculateCenterFromCameraLngLatAlt(e,r,l,h);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:l,pitch:h,roll:m}}easeTo(e,r){this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.cr},e)).animate===!1||!e.essential&&et.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),m=l.pitch,y=l.roll,w="bearing"in e?this._normalizeBearing(e.bearing,h):h,T="pitch"in e?+e.pitch:m,A="roll"in e?this._normalizeBearing(e.roll,y):y,C="padding"in e?e.padding:l.padding,I=d.P.convert(e.offset);let D,O;e.around&&(D=d.U.convert(e.around),O=l.locationToScreenPoint(D));const G={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},K=this.cameraHelper.handleEaseTo(l,{bearing:w,pitch:T,roll:A,padding:C,around:D,aroundPoint:O,offsetAsPoint:I,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||h!==w,this._pitching=this._pitching||T!==m,this._rolling=this._rolling||A!==y,this._padding=!l.isPaddingEqual(C),this._zooming=this._zooming||K.isZooming,this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,G),this.terrain&&this._prepareElevation(K.elevationCenter),this._ease(W=>{K.easeFunc(W),this.terrain&&!e.freezeElevation&&this._updateElevation(W),this._applyUpdatedTransform(l),this._fireMoveEvents(r)},W=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r,W)},e),this}_prepareEase(e,r,l={}){this._moving=!0,r||l.moving||this.fire(new d.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new d.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new d.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new d.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new d.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const r=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&r!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(r-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=r}this.transform.setElevation(d.F.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const r=e.getCameraLngLat(),l=e.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(r,e.zoom):0;if(l<h){const m=this.calculateCameraOptionsFromTo(r,h,e.center,e.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(e){const r=[];if(r.push(h=>this._elevateCameraIfInsideTerrain(h)),this.transformCameraUpdate&&r.push(h=>this.transformCameraUpdate(h)),!r.length)return;const l=e.clone();for(const h of r){const m=l.clone(),{center:y,zoom:w,roll:T,pitch:A,bearing:C,elevation:I}=h(m);y&&m.setCenter(y),I!==void 0&&m.setElevation(I),w!==void 0&&m.setZoom(w),T!==void 0&&m.setRoll(T),A!==void 0&&m.setPitch(A),C!==void 0&&m.setBearing(C),l.apply(m)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new d.l("move",e)),this._zooming&&this.fire(new d.l("zoom",e)),this._rotating&&this.fire(new d.l("rotate",e)),this._pitching&&this.fire(new d.l("pitch",e)),this._rolling&&this.fire(new d.l("roll",e))}_afterEase(e,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const l=this._zooming,h=this._rotating,m=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new d.l("zoomend",e)),h&&this.fire(new d.l("rotateend",e)),m&&this.fire(new d.l("pitchend",e)),y&&this.fire(new d.l("rollend",e)),this.fire(new d.l("moveend",e))}flyTo(e,r){if(!e.essential&&et.prefersReducedMotion){const Ie=d.S(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ie,r)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.cr},e);const l=this._getTransformForUpdate(),h=l.bearing,m=l.pitch,y=l.roll,w=l.padding,T="bearing"in e?this._normalizeBearing(e.bearing,h):h,A="pitch"in e?+e.pitch:m,C="roll"in e?this._normalizeBearing(e.roll,y):y,I="padding"in e?e.padding:l.padding,D=d.P.convert(e.offset);let O=l.centerPoint.add(D);const G=l.screenPointToLocation(O),K=this.cameraHelper.handleFlyTo(l,{bearing:T,pitch:A,roll:C,padding:I,locationAtOffset:G,offsetAsPoint:D,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let W=e.curve;const Q=Math.max(l.width,l.height),ne=Q/K.scaleOfZoom,se=K.pixelPathLength;typeof K.scaleOfMinZoom=="number"&&(W=Math.sqrt(Q/K.scaleOfMinZoom/se*2));const te=W*W;function oe(Ie){const Ke=(ne*ne-Q*Q+(Ie?-1:1)*te*te*se*se)/(2*(Ie?ne:Q)*te*se);return Math.log(Math.sqrt(Ke*Ke+1)-Ke)}function de(Ie){return(Math.exp(Ie)-Math.exp(-Ie))/2}function ae(Ie){return(Math.exp(Ie)+Math.exp(-Ie))/2}const fe=oe(!1);let Pe=function(Ie){return ae(fe)/ae(fe+W*Ie)},Se=function(Ie){return Q*((ae(fe)*(de(Ke=fe+W*Ie)/ae(Ke))-de(fe))/te)/se;var Ke},Ce=(oe(!0)-fe)/W;if(Math.abs(se)<2e-6||!isFinite(Ce)){if(Math.abs(Q-ne)<1e-6)return this.easeTo(e,r);const Ie=ne<Q?-1:1;Ce=Math.abs(Math.log(ne/Q))/W,Se=()=>0,Pe=Ke=>Math.exp(Ie*W*Ke)}return e.duration="duration"in e?+e.duration:1e3*Ce/("screenSpeed"in e?+e.screenSpeed/W:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=h!==T,this._pitching=A!==m,this._rolling=C!==y,this._padding=!l.isPaddingEqual(I),this._prepareEase(r,!1),this.terrain&&this._prepareElevation(K.targetCenter),this._ease(Ie=>{const Ke=Ie*Ce,We=1/Pe(Ke),Fe=Se(Ke);this._rotating&&l.setBearing(d.F.number(h,T,Ie)),this._pitching&&l.setPitch(d.F.number(m,A,Ie)),this._rolling&&l.setRoll(d.F.number(y,C,Ie)),this._padding&&(l.interpolatePadding(w,I,Ie),O=l.centerPoint.add(D)),K.easeFunc(Ie,We,Fe,O),this.terrain&&!e.freezeElevation&&this._updateElevation(Ie),this._applyUpdatedTransform(l),this._fireMoveEvents(r)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(r)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,r){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,r)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,r,l){l.animate===!1||l.duration===0?(e(1),r()):(this._easeStart=mt(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,r){e=d.V(e,-180,180);const l=Math.abs(e-r);return Math.abs(e-360-r)<l&&(e-=360),Math.abs(e+360-r)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.U.convert(e),this.transform.tileZoom):null}}const oa={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Oi{constructor(e=oa){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=r=>{!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"&&r.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=we.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=we.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=we.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){we.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,r){const l=this._map._getUIString(`AttributionControl.${r}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const r=this._map.style.tileManagers;for(const h in r){const m=r[h];if(m.used||m.usedForTerrain){const y=m.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(h=>String(h).trim()),e.sort((h,m)=>h.length-m.length),e=e.filter((h,m)=>{for(let y=m+1;y<e.length;y++)if(e[y].indexOf(h)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=we.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class is{constructor(e={}){this._updateCompact=()=>{const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=we.create("div","maplibregl-ctrl");const r=we.create("a","maplibregl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://maplibre.org/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){we.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Wa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const r=++this._id;return this._queue.push({callback:e,id:r,cancelled:!1}),r}remove(e){const r=this._currentlyRunning,l=r?this._queue.concat(r):this._queue;for(const h of l)if(h.id===e)return void(h.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const l of r)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var hh=d.aN([{name:"a_pos3d",type:"Int16",components:3}]);class oo extends d.E{constructor(e){super(),this._lastTilesetChange=mt(),this.tileManager=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(e,r){this.tileManager.update(e,r),this._renderableTilesKeys=[];const l={};for(const h of Ni(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:r,calculateTileZoom:this.tileManager._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),d.c0(h.terrainRttPosMatrix32f,0,d.a3,d.a3,0,0,1),this._tiles[h.key]=new ce(h,this.tileSize),this._lastTilesetChange=mt());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(e){for(const r in this._tiles){const l=this._tiles[r];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,r){return r?this._getTerrainCoordsForTileRanges(e,r):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const r={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,m=e.clone(),y=d.bd();if(h.canonical.equals(e.canonical))d.c0(y,0,d.a3,d.a3,0,0,1);else if(h.canonical.isChildOf(e.canonical)){const w=h.canonical.z-e.canonical.z,T=h.canonical.x-(h.canonical.x>>w<<w),A=h.canonical.y-(h.canonical.y>>w<<w),C=d.a3>>w;d.c0(y,0,C,C,0,0,1),d.N(y,y,[-T*C,-A*C,0])}else{if(!e.canonical.isChildOf(h.canonical))continue;{const w=e.canonical.z-h.canonical.z,T=e.canonical.x-(e.canonical.x>>w<<w),A=e.canonical.y-(e.canonical.y>>w<<w),C=d.a3>>w;d.c0(y,0,d.a3,d.a3,0,0,1),d.N(y,y,[T*C,A*C,0]),d.O(y,y,[1/2**w,1/2**w,0])}}m.terrainRttPosMatrix32f=new Float32Array(y),r[l]=m}return r}_getTerrainCoordsForTileRanges(e,r){const l={};for(const h of this._renderableTilesKeys){const m=this._tiles[h].tileID;if(!this._isWithinTileRanges(m,r))continue;const y=e.clone(),w=d.bd();if(m.canonical.z===e.canonical.z){const T=e.canonical.x-m.canonical.x,A=e.canonical.y-m.canonical.y;d.c0(w,0,d.a3,d.a3,0,0,1),d.N(w,w,[T*d.a3,A*d.a3,0])}else if(m.canonical.z>e.canonical.z){const T=m.canonical.z-e.canonical.z,A=m.canonical.x-(m.canonical.x>>T<<T),C=m.canonical.y-(m.canonical.y>>T<<T),I=e.canonical.x-(m.canonical.x>>T),D=e.canonical.y-(m.canonical.y>>T),O=d.a3>>T;d.c0(w,0,O,O,0,0,1),d.N(w,w,[-A*O+I*d.a3,-C*O+D*d.a3,0])}else{const T=e.canonical.z-m.canonical.z,A=e.canonical.x-(e.canonical.x>>T<<T),C=e.canonical.y-(e.canonical.y>>T<<T),I=(e.canonical.x>>T)-m.canonical.x,D=(e.canonical.y>>T)-m.canonical.y,O=d.a3<<T;d.c0(w,0,O,O,0,0,1),d.N(w,w,[A*d.a3+I*O,C*d.a3+D*O,0])}y.terrainRttPosMatrix32f=new Float32Array(w),l[h]=y}return l}getSourceTile(e,r){const l=this.tileManager._source;let h=e.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(h).key);let m=this.tileManager.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&r)for(;h>=l.minzoom&&(!m||!m.dem);)m=this.tileManager.getTileByID(e.scaledTo(h--).key);return m}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,r){return r[e.canonical.z]&&e.canonical.x>=r[e.canonical.z].minTileX&&e.canonical.x<=r[e.canonical.z].maxTileX&&e.canonical.y>=r[e.canonical.z].minTileY&&e.canonical.y<=r[e.canonical.z].maxTileY}}class Qa{constructor(e,r,l){this._meshCache={},this.painter=e,this.tileManager=new oo(r),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,r,l,h=d.a3){var m;if(!(r>=0&&r<h&&l>=0&&l<h))return 0;const y=this.getTerrainData(e),w=(m=y.tile)===null||m===void 0?void 0:m.dem;if(!w)return 0;const T=d.cv([],[r/h*d.a3,l/h*d.a3],y.u_terrain_matrix),A=[T[0]*w.dim,T[1]*w.dim],C=Math.floor(A[0]),I=Math.floor(A[1]),D=A[0]-C,O=A[1]-I;return w.get(C,I)*(1-D)*(1-O)+w.get(C+1,I)*D*(1-O)+w.get(C,I+1)*(1-D)*O+w.get(C+1,I+1)*D*O}getElevationForLngLatZoom(e,r){if(!d.cw(r,e.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(e,r);return this.getElevation(l,h%d.a3,m%d.a3,d.a3)}getElevation(e,r,l,h=d.a3){return this.getDEMElevation(e,r,l,h)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const h=this.painter.context,m=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new d.T(h,m,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new d.T(h,new d.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.am([])}const r=this.tileManager.getSourceTile(e,!0);if(r&&r.dem&&(!r.demTexture||r.needsTerrainPrepare)){const h=this.painter.context;r.demTexture=this.painter.getTileTexture(r.dem.stride),r.demTexture?r.demTexture.update(r.dem.getPixels(),{premultiply:!1}):r.demTexture=new d.T(h,r.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),r.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),r.needsTerrainPrepare=!1}const l=r&&r+r.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const h=this.tileManager.getSource().maxzoom;let m=e.canonical.z-r.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=h?m=e.canonical.z-h:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>m<<m),w=e.canonical.y-(e.canonical.y>>m<<m),T=d.cx(new Float64Array(16),[1/(d.a3<<m),1/(d.a3<<m),0]);d.N(T,T,[y*d.a3,w*d.a3,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:r&&r.dem&&r.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:r&&r.dem&&r.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(r&&r.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:r}}getFramebuffer(e){const r=this.painter,l=r.width/devicePixelRatio,h=r.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new d.T(r.context,{width:l,height:h,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new d.T(r.context,{width:l,height:h,data:null},r.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(r.context.gl.NEAREST,r.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=r.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(r.context.createRenderbuffer(r.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const r=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,y=0;m<this._coordsTextureSize;m++)for(let w=0;w<this._coordsTextureSize;w++,y+=4)r[y+0]=255&w,r[y+1]=255&m,r[y+2]=w>>8<<4|m>>8,r[y+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(r.buffer)),h=new d.T(e,l,e.gl.RGBA,{premultiply:!1});return h.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const r=new Uint8Array(4),l=this.painter.context,h=l.gl,m=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(m,w-y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null);const T=r[0]+(r[2]>>4<<8),A=r[1]+((15&r[2])<<8),C=this.coordsIndex[255-r[3]],I=C&&this.tileManager.getTileByID(C);if(!I)return null;const D=this._coordsTextureSize,O=(1<<I.tileID.canonical.z)*D;return new d.a5((I.tileID.canonical.x*D+T)/O+I.tileID.wrap,(I.tileID.canonical.y*D+A)/O,this.getElevation(I.tileID,T,A,D))}depthAtPoint(e){const r=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,r),l.bindFramebuffer.set(null),(r[0]/16777216+r[1]/65536+r[2]/256+r[3])/256}getTerrainMesh(e){var r;const l=((r=this.painter.style.projection)===null||r===void 0?void 0:r.transitionState)>0,h=l&&e.canonical.y===0,m=l&&e.canonical.y===(1<<e.canonical.z)-1,y=`m_${h?"n":""}_${m?"s":""}`;if(this._meshCache[y])return this._meshCache[y];const w=this.painter.context,T=new d.cy,A=new d.aR,C=this.meshSize,I=d.a3/C,D=C*C;for(let ae=0;ae<=C;ae++)for(let fe=0;fe<=C;fe++)T.emplaceBack(fe*I,ae*I,0);for(let ae=0;ae<D;ae+=C+1)for(let fe=0;fe<C;fe++)A.emplaceBack(fe+ae,C+fe+ae+1,C+fe+ae+2),A.emplaceBack(fe+ae,C+fe+ae+2,fe+ae+1);const O=T.length,G=O+(C+1),K=(C+1)*C,W=h?d.bk:0,Q=h?0:1,ne=m?d.bl:d.a3,se=m?0:1;for(let ae=0;ae<=C;ae++)T.emplaceBack(ae*I,W,Q);for(let ae=0;ae<=C;ae++)T.emplaceBack(ae*I,ne,se);for(let ae=0;ae<C;ae++)A.emplaceBack(K+ae,G+ae,G+ae+1),A.emplaceBack(K+ae,G+ae+1,K+ae+1),A.emplaceBack(0+ae,O+ae+1,O+ae),A.emplaceBack(0+ae,0+ae+1,O+ae+1);const te=T.length,oe=te+2*(C+1);for(const ae of[0,1])for(let fe=0;fe<=C;fe++)for(const Pe of[0,1])T.emplaceBack(ae*d.a3,fe*I,Pe);for(let ae=0;ae<2*C;ae+=2)A.emplaceBack(te+ae,te+ae+1,te+ae+3),A.emplaceBack(te+ae,te+ae+3,te+ae+2),A.emplaceBack(oe+ae,oe+ae+3,oe+ae+1),A.emplaceBack(oe+ae,oe+ae+2,oe+ae+3);const de=new Ys(w.createVertexBuffer(T,hh.members),w.createIndexBuffer(A),d.aQ.simpleSegment(0,0,T.length,A.length));return this._meshCache[y]=de,de}getMeshFrameDelta(e){return 2*Math.PI*d.bx/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,r){var l;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(e,r);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const r=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return r&&r.dem&&(l.minElevation=r.dem.min*this.exaggeration,l.maxElevation=r.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,r){const l=d.a5.fromLngLat(e.wrap()),h=(1<<r)*d.a3,m=l.x*h,y=l.y*h,w=Math.floor(m/d.a3),T=Math.floor(y/d.a3);return{tileID:new d.a0(r,0,r,w,T),mercatorX:m,mercatorY:y}}}class wn{constructor(e,r,l){this._context=e,this._size=r,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const r=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new d.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),r.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),r.colorAttachment.set(l.texture),{id:e,fbo:r,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(r=>e.id!==r),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const r of this._recentlyUsed)if(!this._objects[r].inUse)return this._objects[r];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const Ja={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class di{constructor(e,r){this.painter=e,this.terrain=r,this.pool=new wn(e.context,30,r.tileManager.tileSize*r.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,r){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(r)),this._coordsAscending={};for(const l in e.tileManagers){this._coordsAscending[l]={};const h=e.tileManagers[l].getVisibleCoordinates(),m=e.tileManagers[l].getSource(),y=m instanceof pn?m.terrainTileRanges:null;for(const w of h){const T=this.terrain.tileManager.getTerrainCoords(w,y);for(const A in T)this._coordsAscending[l][A]||(this._coordsAscending[l][A]=[]),this._coordsAscending[l][A].push(T[A])}}this._coordsAscendingStr={};for(const l of e._order){const h=e._layers[l],m=h.source;if(Ja[h.type]&&!this._coordsAscendingStr[m]){this._coordsAscendingStr[m]={};for(const y in this._coordsAscending[m])this._coordsAscendingStr[m][y]=this._coordsAscending[m][y].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const m=this._coordsAscendingStr[h][l.tileID.key];m&&m!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(e,r){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},r),{isRenderingToTexture:!0}),h=e.type,m=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ja[h]&&(this._prevType&&Ja[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(e.id),!y))return!0;if(Ja[this._prevType]||Ja[h]&&y){this._prevType=h;const w=this._stacks.length-1,T=this._stacks[w]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(oc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[w]){const I=this.pool.getObjectForId(A.rtt[w].id);if(I.stamp===A.rtt[w].stamp){this.pool.useObject(I);continue}}const C=this.pool.getOrCreateFreeObject();this.pool.useObject(C),this.pool.stampObject(C),A.rtt[w]={id:C.id,stamp:C.stamp},m.context.bindFramebuffer.set(C.fbo.framebuffer),m.context.clear({color:d.bi.transparent,stencil:0}),m.currentStencilSource=void 0;for(let I=0;I<T.length;I++){const D=m.style._layers[T[I]],O=D.source?this._coordsAscending[D.source][A.tileID.key]:[A.tileID];m.context.viewport.set([0,0,C.fbo.width,C.fbo.height]),m._renderTileClippingMasks(D,O,!0),m.renderLayer(m,m.style.tileManagers[D.source],D,O,l),D.source&&(A.rttCoords[D.source]=this._coordsAscendingStr[D.source][A.tileID.key])}}return oc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),Ja[h]}return!1}}const gt={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ti=be,Ki={hash:!1,interactive:!0,bearingSnap:7,attributionControl:oa,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Yo={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class lo{constructor(e,r,l=!1){this.mousedown=m=>{this.startMove(m,we.mousePos(this.element,m)),we.addEventListener(window,"mousemove",this.mousemove),we.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.move(m,we.mousePos(this.element,m))},this.mouseup=m=>{this._rotatePitchHandler.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=we.touchPos(this.element,m.targetTouches)[0],this.startMove(m,this._startPos),we.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),we.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=we.touchPos(this.element,m.targetTouches)[0],this.move(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=r;const h=new Es;this._rotatePitchHandler=new rt({clickTolerance:3,move:(m,y)=>{const w=r.getBoundingClientRect(),T=new d.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:d.cq(new d.P(m.x,y.y),y,T),pitchDelta:l?-.5*(y.y-m.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=e,we.addEventListener(r,"mousedown",this.mousedown),we.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),we.addEventListener(r,"touchcancel",this.reset)}startMove(e,r){this._rotatePitchHandler.dragStart(e,r),we.disableDrag()}move(e,r){const l=this.map,{bearingDelta:h,pitchDelta:m}=this._rotatePitchHandler.dragMove(e,r)||{};h&&l.setBearing(l.getBearing()+h),m&&l.setPitch(l.getPitch()+m)}off(){const e=this.element;we.removeEventListener(e,"mousedown",this.mousedown),we.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),we.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),we.removeEventListener(window,"touchend",this.touchend),we.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){we.enableDrag(),we.removeEventListener(window,"mousemove",this.mousemove),we.removeEventListener(window,"mouseup",this.mouseup),we.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),we.removeEventListener(window,"touchend",this.touchend)}}let za;function $o(f,e,r,l=!1){if(l||!r.getCoveringTilesDetailsProvider().allowWorldCopies())return f?.wrap();const h=new d.U(f.lng,f.lat);if(f=new d.U(f.lng,f.lat),e){const m=new d.U(f.lng-360,f.lat),y=new d.U(f.lng+360,f.lat),w=r.locationToScreenPoint(f).distSqr(e);r.locationToScreenPoint(m).distSqr(e)<w?f=m:r.locationToScreenPoint(y).distSqr(e)<w&&(f=y)}for(;Math.abs(f.lng-r.center.lng)>180;){const m=r.locationToScreenPoint(f);if(m.x>=0&&m.y>=0&&m.x<=r.width&&m.y<=r.height)break;f.lng>r.center.lng?f.lng-=360:f.lng+=360}return f.lng!==h.lng&&r.isPointOnMapSurface(r.locationToScreenPoint(f))?f:h}const kr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ps(f,e,r){const l=f.classList;for(const h in kr)l.remove(`maplibregl-${r}-anchor-${h}`);l.add(`maplibregl-${r}-anchor-${e}`)}class pc extends d.E{constructor(e){if(super(),this._onKeyPress=r=>{const l=r.code,h=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=r=>{const l=r.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=r=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(r?.type==="terrain"||r?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=$o(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||r&&r.type!=="moveend"||(this._pos=this._pos.round()),we.setTransform(this._element,`${kr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${h}`),et.frameAsync(new AbortController).then(()=>{this._updateOpacity(r&&r.type==="moveend")}).catch(()=>{})},this._onMove=r=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.l("dragstart"))),this.fire(new d.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.l("dragend")),this._state="inactive"},this._addDragHandler=r=>{this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._offset),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=we.create("div");const r=we.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;r.setAttributeNS(null,"display","block"),r.setAttributeNS(null,"height",`${l}px`),r.setAttributeNS(null,"width",`${h}px`),r.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const m=we.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const y=we.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const w=we.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Q of T){const ne=we.createNS("http://www.w3.org/2000/svg","ellipse");ne.setAttributeNS(null,"opacity","0.04"),ne.setAttributeNS(null,"cx","10.5"),ne.setAttributeNS(null,"cy","5.80029008"),ne.setAttributeNS(null,"rx",Q.rx),ne.setAttributeNS(null,"ry",Q.ry),w.appendChild(ne)}const A=we.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const C=we.createNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(C);const I=we.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"opacity","0.25"),I.setAttributeNS(null,"fill","#000000");const D=we.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),I.appendChild(D);const O=we.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(6.0, 7.0)"),O.setAttributeNS(null,"fill","#FFFFFF");const G=we.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=we.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const W=we.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),G.appendChild(K),G.appendChild(W),y.appendChild(w),y.appendChild(A),y.appendChild(I),y.appendChild(O),y.appendChild(G),r.appendChild(y),r.setAttributeNS(null,"height",l*this._scale+"px"),r.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(r),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",r=>{r.preventDefault()}),this._element.addEventListener("mousedown",r=>{r.preventDefault()}),Ps(this._element,this._anchor,"marker"),e&&e.className)for(const r of e.className.split(" "))this._element.classList.add(r);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),we.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.U.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const h=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var r,l;const h=(r=this._map)===null||r===void 0?void 0:r.terrain,m=this._map.transform.isLocationOccluded(this._lngLat);if(!h||m){const O=m?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==O&&(this._element.style.opacity=O))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,w=y.terrain.depthAtPoint(this._pos),T=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,T)-w<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/y.transform.pixelsPerMeter,C=Math.sin(y.getPitch()*Math.PI/180)*A,I=y.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),D=y.transform.lngLatToCameraDepth(this._lngLat,T+C)-I>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&D&&this._popup.remove(),this._element.style.opacity=D?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,r){return(this._opacity===void 0||e===void 0&&r===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),r!==void 0&&(this._opacityWhenCovered=r),this._map&&this._updateOpacity(!0),this}}const nn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let co=0,Ds=!1;const _u={maxWidth:100,unit:"metric"};function mc(f,e,r){const l=r&&r.maxWidth||100,h=f._container.clientHeight/2,m=f._container.clientWidth/2,y=f.unproject([m-l/2,h]),w=f.unproject([m+l/2,h]),T=Math.round(f.project(w).x-f.project(y).x),A=Math.min(l,T,f._container.clientWidth),C=y.distanceTo(w);if(r&&r.unit==="imperial"){const I=3.2808*C;I>5280?Ko(e,A,I/5280,f._getUIString("ScaleControl.Miles")):Ko(e,A,I,f._getUIString("ScaleControl.Feet"))}else r&&r.unit==="nautical"?Ko(e,A,C/1852,f._getUIString("ScaleControl.NauticalMiles")):C>=1e3?Ko(e,A,C/1e3,f._getUIString("ScaleControl.Kilometers")):Ko(e,A,C,f._getUIString("ScaleControl.Meters"))}function Ko(f,e,r,l){const h=function(m){const y=Math.pow(10,`${Math.floor(m)}`.length-1);let w=m/y;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(T){const A=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*A)/A}(w),y*w}(r);f.style.width=e*(h/r)+"px",f.innerHTML=`${h}&nbsp;${l}`}const gc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Al=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Cl(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,f),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-f),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(f,0),right:new d.P(-f,0)}}if(f instanceof d.P||Array.isArray(f)){const e=d.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(f.center||[0,0]),top:d.P.convert(f.top||[0,0]),"top-left":d.P.convert(f["top-left"]||[0,0]),"top-right":d.P.convert(f["top-right"]||[0,0]),bottom:d.P.convert(f.bottom||[0,0]),"bottom-left":d.P.convert(f["bottom-left"]||[0,0]),"bottom-right":d.P.convert(f["bottom-right"]||[0,0]),left:d.P.convert(f.left||[0,0]),right:d.P.convert(f.right||[0,0])}}return Cl(new d.P(0,0))}const la=be;P.AJAXError=d.cC,P.Event=d.l,P.Evented=d.E,P.LngLat=d.U,P.MercatorCoordinate=d.a5,P.Point=d.P,P.addProtocol=d.cD,P.config=d.a,P.removeProtocol=d.cE,P.AttributionControl=Oi,P.BoxZoomHandler=oh,P.CanvasSource=sr,P.CooperativeGesturesHandler=_r,P.DoubleClickZoomHandler=zs,P.DragPanHandler=qo,P.DragRotateHandler=Ho,P.EdgeInsets=un,P.FullscreenControl=class extends d.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let r=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=r?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)r=r.shadowRoot.fullscreenElement;r===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=we.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){we.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=we.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);we.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},P.GeoJSONSource=Vr,P.GeolocateControl=class extends d.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const r=new d.U(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,h=this._map.getBearing(),m=d.e({bearing:h},this.options.fitBoundsOptions),y=Ci.fromLngLat(r,l);this._map.fitBounds(y,m,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const r=new d.U(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ds)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=we.create("button","maplibregl-ctrl-geolocate",this._container),we.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=we.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new pc({element:this._dotElement}),this._circleElement=we.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{const l=r?.[0]instanceof ResizeObserverEntry;r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.l("trackuserlocationend")),this.fire(new d.l("userlocationlostfocus")))})}},this.options=d.e({},nn,f)}onAdd(f){return this._map=f,this._container=we.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(za!==void 0&&!e)return za;if(window.navigator.permissions===void 0)return za=!!window.navigator.geolocation,za;try{za=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{za=!!window.navigator.geolocation}return za})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),we.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,co=0,Ds=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),r=f.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const f=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&f))return;const e=this._map.project(f),r=this._map.unproject([e.x+100,e.y]),l=f.distanceTo(r)/100,h=2*this._accuracy/l;this._circleElement.style.width=`${h.toFixed(2)}px`,this._circleElement.style.height=`${h.toFixed(2)}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":co--,Ds=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.l("trackuserlocationstart")),this.fire(new d.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),co++,co>1?(f={maximumAge:6e5,timeout:0},Ds=!0):(f=this.options.positionOptions,Ds=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},P.GlobeControl=class{constructor(){this._toggleProjection=()=>{var f;const e=(f=this._map.getProjection())===null||f===void 0?void 0:f.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var f;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((f=this._map.getProjection())===null||f===void 0?void 0:f.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(f){return this._map=f,this._container=we.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=we.create("button","maplibregl-ctrl-globe",this._container),we.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){we.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},P.Hash=Fn,P.ImageSource=pn,P.KeyboardHandler=As,P.LngLatBounds=Ci,P.LogoControl=is,P.Map=class extends gu{constructor(f){var e,r;d.cz.mark(d.cA.create);const l=Object.assign(Object.assign(Object.assign({},Ki),f),{canvasContextAttributes:Object.assign(Object.assign({},Ki.canvasContextAttributes),f.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new hr,m=new qr;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),l.transformConstrain!==null&&h.setConstrain(l.transformConstrain),super(h,m,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Wa,this._controls=[],this._mapId=d.ab(),this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},gt),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.transformConstrain=l.transformConstrain,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=hi.addThrottleControl(()=>this.isMoving()),this._requestManager=new Ht(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1;const T=Ts(A=>{this._trackResize&&!this._removed&&(this.resize(A),this.redraw())},50);this._resizeObserver=new ResizeObserver(A=>{w?T(A):w=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Xo(this,l),this._hash=l.hash&&new Fn(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,d.e({},l.fitBoundsOptions,{duration:0}))));const y=typeof l.style=="string"||((r=(e=l.style)===null||e===void 0?void 0:e.projection)===null||r===void 0?void 0:r.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new Oi(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new is,l.logoPosition),this.on("style.load",()=>{if(y||this._resizeTransform(),this.transform.unmodified){const w=d.S(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}}),this.on("data",w=>{this._update(w.dataType==="style"),this.fire(new d.l(`${w.dataType}data`,w))}),this.on("dataloading",w=>{this.fire(new d.l(`${w.dataType}dataloading`,w))}),this.on("dataabort",w=>{this.fire(new d.l("sourcedataabort",w))})}_getMapId(){return this._mapId}setGlobalStateProperty(f,e){return this.style.setGlobalStateProperty(f,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(r,l.firstChild):l.appendChild(r),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}coveringTiles(f){return Ni(this.transform,f)}calculateCameraOptionsFromTo(f,e,r,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,r,l)}resize(f,e=!0){const[r,l]=this._containerDimensions(),h=this._getClampedPixelRatio(r,l);if(this._resizeCanvas(r,l,h),this.painter.resize(r,l,h),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const w=this._getClampedPixelRatio(r,l);this._resizeCanvas(r,l,w),this.painter.resize(r,l,w)}this._resizeTransform(e);const m=!this._moving;return m&&(this.stop(),this.fire(new d.l("movestart",f)).fire(new d.l("move",f))),this.fire(new d.l("resize",f)),m&&this.fire(new d.l("moveend",f)),this}_resizeTransform(f=!0){var e;const[r,l]=this._containerDimensions();this.transform.resize(r,l,f),(e=this._requestedCameraState)===null||e===void 0||e.resize(r,l,f)}_getClampedPixelRatio(f,e){const{0:r,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),m=f*h,y=e*h;return Math.min(m>r?r/m:1,y>l?l/y:1)*h}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(Ci.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.setMinZoom(f),this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.setMaxZoom(f),this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.setMinPitch(f),this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(f>=this.transform.minPitch)return this.transform.setMaxPitch(f),this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.setRenderWorldCopies(f),this._update()}setTransformConstrain(f){return this.transform.setConstrain(f),this._update()}project(f){return this.transform.locationToScreenPoint(d.U.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.screenPointToLocation(d.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,r){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:r,delegates:{mousemove:m=>{const y=e.filter(T=>this.getLayer(T)),w=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];w.length?l||(l=!0,r.call(this,new ga(f,this,m.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:r,delegates:{mousemove:y=>{const w=e.filter(T=>this.getLayer(T));(w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[]).length?l=!0:l&&(l=!1,r.call(this,new ga(f,this,y.originalEvent)))},mouseout:y=>{l&&(l=!1,r.call(this,new ga(f,this,y.originalEvent)))}}}}{const l=h=>{const m=e.filter(w=>this.getLayer(w)),y=m.length!==0?this.queryRenderedFeatures(h.point,{layers:m}):[];y.length&&(h.features=y,r.call(this,h),delete h.features)};return{layers:e,listener:r,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,r){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let h=0;h<l.length;h++){const m=l[h];if(m.listener===r&&m.layers.length===e.length&&m.layers.every(y=>e.includes(y))){for(const y in m.delegates)this.off(y,m.delegates[y]);return void l.splice(h,1)}}}on(f,e,r){if(r===void 0)return super.on(f,e);const l=typeof e=="string"?[e]:e,h=this._createDelegatedListener(f,l,r);this._saveDelegatedListener(f,h);for(const m in h.delegates)this.on(m,h.delegates[m]);return{unsubscribe:()=>{this._removeDelegatedListener(f,l,r)}}}once(f,e,r){if(r===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,h=this._createDelegatedListener(f,l,r);for(const m in h.delegates){const y=h.delegates[m];h.delegates[m]=(...w)=>{this._removeDelegatedListener(f,l,r),y(...w)}}this._saveDelegatedListener(f,h);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(f,e,r){return r===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,r),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let r;const l=f instanceof d.P||Array.isArray(f),h=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},h instanceof d.P||typeof h[0]=="number")r=[d.P.convert(h)];else{const m=d.P.convert(h[0]),y=d.P.convert(h[1]);r=[m,new d.P(y.x,m.y),y,new d.P(m.x,y.y),m]}return this.style.queryRenderedFeatures(r,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){var r,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));const h=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new Kl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,h):this.style.loadJSON(f,e,h),this):((l=(r=this.style)===null||r===void 0?void 0:r.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Kl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const r=this._requestManager.transformRequest(f,"Style");d.j(r,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new d.k(l))})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(r){d.w(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.tileManagers[f];if(e!==void 0)return e.loaded();this.fire(new d.k(new Error(`There is no tile manager with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.tileManagers[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const r in this.style._layers){const l=this.style._layers[r];l.type==="hillshade"&&l.source===f.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===f.source&&d.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Qa(this.painter,e,f),this.painter.renderToTexture=new di(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=r=>{var l;r.dataType==="style"?this.terrain.tileManager.freeRtt():r.dataType==="source"&&r.tile&&(r.sourceId!==f.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=r.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(r.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new d.l("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.tileManagers;for(const e in f){const r=f[e]._tiles;for(const l in r){const h=r[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}setSourceTileLodParams(f,e,r){if(r){const l=this.getSource(r);if(!l)throw new Error(`There is no source with ID "${r}", cannot set LOD parameters`);l.calculateTileZoom=vt(Math.max(1,f),Math.max(1,e))}else for(const l in this.style.tileManagers)this.style.tileManagers[l].getSource().calculateTileZoom=vt(Math.max(1,f),Math.max(1,e));return this._update(!0),this}refreshTiles(f,e){const r=this.style.tileManagers[f];if(!r)throw new Error(`There is no tile manager with ID "${f}", cannot refresh tile`);e===void 0?r.reload(!0):r.refreshTiles(e.map(l=>new d.a8(l.z,l.x,l.y)))}addImage(f,e,r={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:m,stretchY:y,content:w,textFitWidth:T,textFitHeight:A}=r;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:I,data:D}=e,O=e;return this.style.addImage(f,{data:new d.R({width:C,height:I},new Uint8Array(D)),pixelRatio:l,stretchX:m,stretchY:y,content:w,textFitWidth:T,textFitHeight:A,sdf:h,version:0,userImage:O}),O.onAdd&&O.onAdd(this,f),this}}{const{width:C,height:I,data:D}=et.getImageData(e);this.style.addImage(f,{data:new d.R({width:C,height:I},D),pixelRatio:l,stretchX:m,stretchY:y,content:w,textFitWidth:T,textFitHeight:A,sdf:h,version:0})}}updateImage(f,e){const r=this.style.getImage(f);if(!r)return this.fire(new d.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||d.b(e)?et.getImageData(e):e,{width:h,height:m,data:y}=l;if(h===void 0||m===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==r.data.width||m!==r.data.height)return this.fire(new d.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||d.b(e));return r.data.replace(y,w),this.style.updateImage(f,r),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.k(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return hi.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,r){return this.style.setLayerZoomRange(f,e,r),this._update(!0)}setFilter(f,e,r={}){return this.style.setFilter(f,e,r),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,r,l={}){return this.style.setPaintProperty(f,e,r,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,r,l={}){return this.style.setLayoutProperty(f,e,r,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,r={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,r,l=>{l||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,r=>{r||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(f,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=we.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=we.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const r=this._containerDimensions(),l=this._getClampedPixelRatio(r[0],r[1]);this._resizeCanvas(r[0],r[1],l);const h=this._controlContainer=we.create("div","maplibregl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=we.create("div",`maplibregl-ctrl-${y} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,r){this._canvas.width=Math.floor(r*f),this._canvas.height=Math.floor(r*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});let r=null;if(r=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,f):this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f),!r){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new lc(r,this.transform),on.testSupport(r)}migrateProjection(f,e){super.migrateProjection(f,e),this.painter.transform=f,this.fire(new d.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){var e,r,l,h,m;const y=this._idleTriggered?this._fadeDuration:0,w=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let T=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,D=mt();this.style.zoomHistory.update(I,D);const O=new d.G(I,{now:D,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),G=O.crossFadingFactor();G===1&&G===this._crossFadingFactor||(T=!0,this._crossFadingFactor=G),this.style.update(O)}const A=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0!==w;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(m=this.style.projection)===null||m===void 0?void 0:m.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||A)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,A),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new d.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.cz.mark(d.cA.load),this.fire(new d.l("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const C=this._sourcesDirty||this._styleDirty||this._placementDirty;return C||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.l("idle")),!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,d.cz.mark(d.cA.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),hi.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),we.remove(this._canvasContainer),we.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),d.cz.clearMetrics(),this._removed=!0,this.fire(new d.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,et.frame(this._frameRequest,f=>{d.cz.frame(f),this._frameRequest=null;try{this._render(f)}catch(e){if(!d.cB(e)&&!function(r){return r.message===su}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return Ti}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(f){return this._lazyInitEmptyStyle(),this.style.setProjection(f),this._update(!0)}},P.MapMouseEvent=ga,P.MapTouchEvent=Dn,P.MapWheelEvent=Vo,P.Marker=pc,P.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),r=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,r)=>{const l=this._map._getUIString(`NavigationControl.${r}`);e.title=l,e.setAttribute("aria-label",l)},this.options=d.e({},Yo,f),this._container=we.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),we.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),we.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=we.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new lo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){we.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const r=we.create("button",f,this._container);return r.type="button",r.addEventListener("click",e),r}},P.Popup=class extends d.E{constructor(f){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&we.remove(this._content),this._container&&(we.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=we.create("div","maplibregl-popup",this._map.getContainer()),this._tip=we.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=$o(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const r=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=Cl(this.options.offset);if(!l){const y=this._container.offsetWidth,w=this._container.offsetHeight;let T;T=r.y+h.bottom.y<w?["top"]:r.y>this._map.transform.height-w?["bottom"]:[],r.x<y/2?T.push("left"):r.x>this._map.transform.width-y/2&&T.push("right"),l=T.length===0?"bottom":T.join("-")}let m=r.add(h[l]);this.options.subpixelPositioning||(m=m.round()),we.setTransform(this._container,`${kr[l]} translate(${m.x}px,${m.y}px)`),Ps(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(gc),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.U.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),r=document.createElement("body");let l;for(r.innerHTML=f;l=r.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=we.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=we.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Al);f&&f.focus()}},P.RasterDEMTileSource=Gs,P.RasterTileSource=rr,P.ScaleControl=class{constructor(f){this._onMove=()=>{mc(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,mc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},_u),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=we.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){we.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},P.ScrollZoomHandler=Cs,P.Style=Kl,P.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=we.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=we.create("button","maplibregl-ctrl-terrain",this._container),we.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){we.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},P.TwoFingersTouchPitchHandler=so,P.TwoFingersTouchRotateHandler=Zo,P.TwoFingersTouchZoomHandler=hc,P.TwoFingersTouchZoomRotateHandler=uh,P.VectorTileSource=Vs,P.VideoSource=ll,P.addSourceType=(f,e)=>d._(void 0,void 0,void 0,function*(){if(Hs(f))throw new Error(`A source type called "${f}" already exists.`);((r,l)=>{cl[r]=l})(f,e)}),P.clearPrewarmedResources=function(){const f=wt;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(st),wt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},P.createTileMesh=ml,P.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},P.getRTLTextPluginStatus=function(){return N().getRTLTextPluginStatus()},P.getVersion=function(){return la},P.getWorkerCount=function(){return ct.workerCount},P.getWorkerUrl=function(){return d.a.WORKER_URL},P.importScriptInWorkers=function(f){return ar().broadcast("IS",f)},P.isTimeFrozen=function(){return Ct.isFrozen()},P.now=mt,P.prewarm=function(){fi().acquire(st)},P.restoreNow=function(){Ct.restoreNow()},P.setMaxParallelImageRequests=function(f){d.a.MAX_PARALLEL_IMAGE_REQUESTS=f},P.setNow=function(f){Ct.setNow(f)},P.setRTLTextPlugin=function(f,e){return N().setRTLTextPlugin(f,e)},P.setWorkerCount=function(f){ct.workerCount=f},P.setWorkerUrl=function(f){d.a.WORKER_URL=f}});var le=q;return le})}(jp)),jp.exports}var Gm=Xg();const Zm=cm(Gm),Yg=cg({__proto__:null,default:Zm},[Gm]);var Ns=Uint8Array,Ud=Uint16Array,$g=Int32Array,qm=new Ns([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Hm=new Ns([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Kg=new Ns([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xm=function(F,H){for(var q=new Ud(31),U=0;U<31;++U)q[U]=H+=1<<F[U-1];for(var J=new $g(q[30]),U=1;U<30;++U)for(var le=q[U];le<q[U+1];++le)J[le]=le-q[U]<<5|U;return{b:q,r:J}},Ym=Xm(qm,2),$m=Ym.b,Wg=Ym.r;$m[28]=258,Wg[258]=28;var Qg=Xm(Hm,0),Jg=Qg.b,om=new Ud(32768);for(var zn=0;zn<32768;++zn){var Uu=(zn&43690)>>1|(zn&21845)<<1;Uu=(Uu&52428)>>2|(Uu&13107)<<2,Uu=(Uu&61680)>>4|(Uu&3855)<<4,om[zn]=((Uu&65280)>>8|(Uu&255)<<8)>>1}var Qf=function(F,H,q){for(var U=F.length,J=0,le=new Ud(H);J<U;++J)F[J]&&++le[F[J]-1];var P=new Ud(H);for(J=1;J<H;++J)P[J]=P[J-1]+le[J-1]<<1;var d;if(q){d=new Ud(1<<H);var be=15-H;for(J=0;J<U;++J)if(F[J])for(var Ae=J<<4|F[J],Je=H-F[J],Ne=P[F[J]-1]++<<Je,et=Ne|(1<<Je)-1;Ne<=et;++Ne)d[om[Ne]>>be]=Ae}else for(d=new Ud(U),J=0;J<U;++J)F[J]&&(d[J]=om[P[F[J]-1]++]>>15-F[J]);return d},ep=new Ns(288);for(var zn=0;zn<144;++zn)ep[zn]=8;for(var zn=144;zn<256;++zn)ep[zn]=9;for(var zn=256;zn<280;++zn)ep[zn]=7;for(var zn=280;zn<288;++zn)ep[zn]=8;var Km=new Ns(32);for(var zn=0;zn<32;++zn)Km[zn]=5;var e_=Qf(ep,9,1),t_=Qf(Km,5,1),rm=function(F){for(var H=F[0],q=1;q<F.length;++q)F[q]>H&&(H=F[q]);return H},sl=function(F,H,q){var U=H/8|0;return(F[U]|F[U+1]<<8)>>(H&7)&q},sm=function(F,H){var q=H/8|0;return(F[q]|F[q+1]<<8|F[q+2]<<16)>>(H&7)},i_=function(F){return(F+7)/8|0},n_=function(F,H,q){return(q==null||q>F.length)&&(q=F.length),new Ns(F.subarray(H,q))},a_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Us=function(F,H,q){var U=new Error(H||a_[F]);if(U.code=F,Error.captureStackTrace&&Error.captureStackTrace(U,Us),!q)throw U;return U},hm=function(F,H,q,U){var J=F.length,le=0;if(!J||H.f&&!H.l)return q||new Ns(0);var P=!q,d=P||H.i!=2,be=H.i;P&&(q=new Ns(J*3));var Ae=function(Mr){var ta=q.length;if(Mr>ta){var Er=new Ns(Math.max(ta*2,Mr));Er.set(q),q=Er}},Je=H.f||0,Ne=H.p||0,et=H.b||0,Ct=H.l,mt=H.d,we=H.m,on=H.n,xi=J*8;do{if(!Ct){Je=sl(F,Ne,1);var Jt=sl(F,Ne+1,3);if(Ne+=3,Jt)if(Jt==1)Ct=e_,mt=t_,we=9,on=5;else if(Jt==2){var hi=sl(F,Ne,31)+257,Ht=sl(F,Ne+10,15)+4,ln=hi+sl(F,Ne+5,31)+1;Ne+=14;for(var _n=new Ns(ln),ha=new Ns(19),bi=0;bi<Ht;++bi)ha[Kg[bi]]=sl(F,Ne+bi*3,7);Ne+=Ht*3;for(var wi=rm(ha),nr=(1<<wi)-1,da=Qf(ha,wi,1),bi=0;bi<ln;){var Vn=da[sl(F,Ne,nr)];Ne+=Vn&15;var St=Vn>>4;if(St<16)_n[bi++]=St;else{var Be=0,ot=0;for(St==16?(ot=3+sl(F,Ne,3),Ne+=2,Be=_n[bi-1]):St==17?(ot=3+sl(F,Ne,7),Ne+=3):St==18&&(ot=11+sl(F,Ne,127),Ne+=7);ot--;)_n[bi++]=Be}}var Tt=_n.subarray(0,hi),pt=_n.subarray(hi);we=rm(Tt),on=rm(pt),Ct=Qf(Tt,we,1),mt=Qf(pt,on,1)}else Us(1);else{var St=i_(Ne)+4,gi=F[St-4]|F[St-3]<<8,Ai=St+gi;if(Ai>J){be&&Us(0);break}d&&Ae(et+gi),q.set(F.subarray(St,Ai),et),H.b=et+=gi,H.p=Ne=Ai*8,H.f=Je;continue}if(Ne>xi){be&&Us(0);break}}d&&Ae(et+131072);for(var li=(1<<we)-1,me=(1<<on)-1,Ze=Ne;;Ze=Ne){var Be=Ct[sm(F,Ne)&li],st=Be>>4;if(Ne+=Be&15,Ne>xi){be&&Us(0);break}if(Be||Us(2),st<256)q[et++]=st;else if(st==256){Ze=Ne,Ct=null;break}else{var ct=st-254;if(st>264){var bi=st-257,Pt=qm[bi];ct=sl(F,Ne,(1<<Pt)-1)+$m[bi],Ne+=Pt}var wt=mt[sm(F,Ne)&me],Yt=wt>>4;wt||Us(3),Ne+=wt&15;var pt=Jg[Yt];if(Yt>3){var Pt=Hm[Yt];pt+=sm(F,Ne)&(1<<Pt)-1,Ne+=Pt}if(Ne>xi){be&&Us(0);break}d&&Ae(et+131072);var fi=et+ct;if(et<pt){var ai=le-pt,ar=Math.min(pt,fi);for(ai+et<0&&Us(3);et<ar;++et)q[et]=U[ai+et]}for(;et<fi;++et)q[et]=q[et-pt]}}H.l=Ct,H.p=Ze,H.b=et,H.f=Je,Ct&&(Je=1,H.m=we,H.d=mt,H.n=on)}while(!Je);return et!=q.length&&P?n_(q,0,et):q.subarray(0,et)},r_=new Ns(0),s_=function(F){(F[0]!=31||F[1]!=139||F[2]!=8)&&Us(6,"invalid gzip data");var H=F[3],q=10;H&4&&(q+=(F[10]|F[11]<<8)+2);for(var U=(H>>3&1)+(H>>4&1);U>0;U-=!F[q++]);return q+(H&2)},o_=function(F){var H=F.length;return(F[H-4]|F[H-3]<<8|F[H-2]<<16|F[H-1]<<24)>>>0},l_=function(F,H){return((F[0]&15)!=8||F[0]>>4>7||(F[0]<<8|F[1])%31)&&Us(6,"invalid zlib data"),(F[1]>>5&1)==1&&Us(6,"invalid zlib data: "+(F[1]&32?"need":"unexpected")+" dictionary"),(F[1]>>3&4)+2};function c_(F,H){return hm(F,{i:2},H,H)}function u_(F,H){var q=s_(F);return q+8>F.length&&Us(6,"invalid gzip data"),hm(F.subarray(q,-8),{i:2},new Ns(o_(F)),H)}function h_(F,H){return hm(F.subarray(l_(F),-4),{i:2},H,H)}function d_(F,H){return F[0]==31&&F[1]==139&&F[2]==8?u_(F,H):(F[0]&15)!=8||F[0]>>4>7||(F[0]<<8|F[1])%31?c_(F,H):h_(F,H)}var f_=typeof TextDecoder<"u"&&new TextDecoder,p_=0;try{f_.decode(r_,{stream:!0}),p_=1}catch{}var m_=Object.defineProperty,Jf=Math.pow,sn=(F,H)=>m_(F,"name",{value:H,configurable:!0}),Ga=(F,H,q)=>new Promise((U,J)=>{var le=be=>{try{d(q.next(be))}catch(Ae){J(Ae)}},P=be=>{try{d(q.throw(be))}catch(Ae){J(Ae)}},d=be=>be.done?U(be.value):Promise.resolve(be.value).then(le,P);d((q=q.apply(F,H)).next())});sn((F,H)=>{let q=!1,U="",J=L.GridLayer.extend({createTile:sn((le,P)=>{let d=document.createElement("img"),be=new AbortController,Ae=be.signal;return d.cancel=()=>{be.abort()},q||(F.getHeader().then(Je=>{Je.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):Je.tileType===2?U="image/png":Je.tileType===3?U="image/jpeg":Je.tileType===4?U="image/webp":Je.tileType===5&&(U="image/avif")}),q=!0),F.getZxy(le.z,le.x,le.y,Ae).then(Je=>{if(Je){let Ne=new Blob([Je.data],{type:U}),et=window.URL.createObjectURL(Ne);d.src=et,d.cancel=void 0,P(void 0,d)}}).catch(Je=>{if(Je.name!=="AbortError")throw Je}),d},"createTile"),_removeTile:sn(function(le){let P=this._tiles[le];P&&(P.el.cancel&&P.el.cancel(),P.el.width=0,P.el.height=0,P.el.deleted=!0,L.DomUtil.remove(P.el),delete this._tiles[le],this.fire("tileunload",{tile:P.el,coords:this._keyToTileCoords(le)}))},"_removeTile")});return new J(H)},"leafletRasterLayer");var g_=sn(F=>(H,q)=>{if(q instanceof AbortController)return F(H,q);let U=new AbortController;return F(H,U).then(J=>q(void 0,J.data,J.cacheControl||"",J.expires||""),J=>q(J)).catch(J=>q(J)),{cancel:sn(()=>U.abort(),"cancel")}},"v3compat"),Wm=class{constructor(H){this.tilev4=sn((q,U)=>Ga(this,null,function*(){if(q.type==="json"){let Ct=q.url.substr(10),mt=this.tiles.get(Ct);if(mt||(mt=new Bm(Ct),this.tiles.set(Ct,mt)),this.metadata)return{data:yield mt.getTileJson(q.url)};let we=yield mt.getHeader();return(we.minLon>=we.maxLon||we.minLat>=we.maxLat)&&console.error(`Bounds of PMTiles archive ${we.minLon},${we.minLat},${we.maxLon},${we.maxLat} are not valid.`),{data:{tiles:[`${q.url}/{z}/{x}/{y}`],minzoom:we.minZoom,maxzoom:we.maxZoom,bounds:[we.minLon,we.minLat,we.maxLon,we.maxLat]}}}let J=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),le=q.url.match(J);if(!le)throw new Error("Invalid PMTiles protocol URL");let P=le[1],d=this.tiles.get(P);d||(d=new Bm(P),this.tiles.set(P,d));let be=le[2],Ae=le[3],Je=le[4],Ne=yield d.getHeader(),et=yield d?.getZxy(+be,+Ae,+Je,U.signal);if(et)return{data:new Uint8Array(et.data),cacheControl:et.cacheControl,expires:et.expires};if(Ne.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=g_(this.tilev4),this.tiles=new Map,this.metadata=H?.metadata||!1,this.errorOnMissingTile=H?.errorOnMissingTile||!1}add(H){this.tiles.set(H.source.getKey(),H)}get(H){return this.tiles.get(H)}};sn(Wm,"Protocol");var __=Wm;function Qm(F,H){return(H>>>0)*4294967296+(F>>>0)}sn(Qm,"toNum");function Jm(F,H){let q=H.buf,U=q[H.pos++],J=(U&112)>>4;if(U<128||(U=q[H.pos++],J|=(U&127)<<3,U<128)||(U=q[H.pos++],J|=(U&127)<<10,U<128)||(U=q[H.pos++],J|=(U&127)<<17,U<128)||(U=q[H.pos++],J|=(U&127)<<24,U<128)||(U=q[H.pos++],J|=(U&1)<<31,U<128))return Qm(F,J);throw new Error("Expected varint not more than 10 bytes")}sn(Jm,"readVarintRemainder");function Fd(F){let H=F.buf,q=H[F.pos++],U=q&127;return q<128||(q=H[F.pos++],U|=(q&127)<<7,q<128)||(q=H[F.pos++],U|=(q&127)<<14,q<128)||(q=H[F.pos++],U|=(q&127)<<21,q<128)?U:(q=H[F.pos],U|=(q&15)<<28,Jm(U,F))}sn(Fd,"readVarint");function dm(F,H,q,U){if(U===0){q===1&&(H[0]=F-1-H[0],H[1]=F-1-H[1]);let J=H[0];H[0]=H[1],H[1]=J}}sn(dm,"rotate");function eg(F,H){let q=Jf(2,F),U=H,J=H,le=H,P=[0,0],d=1;for(;d<q;)U=1&le/2,J=1&(le^U),dm(d,P,U,J),P[0]+=d*U,P[1]+=d*J,le=le/4,d*=2;return[F,P[0],P[1]]}sn(eg,"idOnLevel");var y_=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function tg(F,H,q){if(F>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(H>Jf(2,F)-1||q>Jf(2,F)-1)throw new Error("tile x/y outside zoom level bounds");let U=y_[F],J=Jf(2,F),le=0,P=0,d=0,be=[H,q],Ae=J/2;for(;Ae>0;)le=(be[0]&Ae)>0?1:0,P=(be[1]&Ae)>0?1:0,d+=Ae*Ae*(3*le^P),dm(Ae,be,le,P),Ae=Ae/2;return U+d}sn(tg,"zxyToTileId");function v_(F){let H=0;for(let q=0;q<27;q++){let U=(1<<q)*(1<<q);if(H+U>F)return eg(q,F-H);H+=U}throw new Error("Tile zoom level exceeds max safe number limit (26)")}sn(v_,"tileIdToZxy");var x_=(F=>(F[F.Unknown=0]="Unknown",F[F.None=1]="None",F[F.Gzip=2]="Gzip",F[F.Brotli=3]="Brotli",F[F.Zstd=4]="Zstd",F))(x_||{});function Up(F,H){return Ga(this,null,function*(){if(H===1||H===0)return F;if(H===2){if(typeof globalThis.DecompressionStream>"u")return d_(new Uint8Array(F));let q=new Response(F).body;if(!q)throw new Error("Failed to read response stream");let U=q.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(U).arrayBuffer()}throw new Error("Compression method not supported")})}sn(Up,"defaultDecompress");var b_=(F=>(F[F.Unknown=0]="Unknown",F[F.Mvt=1]="Mvt",F[F.Png=2]="Png",F[F.Jpeg=3]="Jpeg",F[F.Webp=4]="Webp",F[F.Avif=5]="Avif",F))(b_||{});function ig(F){return F===1?".mvt":F===2?".png":F===3?".jpg":F===4?".webp":F===5?".avif":""}sn(ig,"tileTypeExt");var w_=127;function ng(F,H){let q=0,U=F.length-1;for(;q<=U;){let J=U+q>>1,le=H-F[J].tileId;if(le>0)q=J+1;else if(le<0)U=J-1;else return F[J]}return U>=0&&(F[U].runLength===0||H-F[U].tileId<F[U].runLength)?F[U]:null}sn(ng,"findTile");var T_=class{constructor(H){this.file=H}getKey(){return this.file.name}getBytes(H,q){return Ga(this,null,function*(){return{data:yield this.file.slice(H,H+q).arrayBuffer()}})}};sn(T_,"FileSource");var ag=class{constructor(H,q=new Headers){this.url=H,this.customHeaders=q,this.mustReload=!1;let U="";"navigator"in globalThis&&(U=globalThis.navigator.userAgent||"");let J=U.indexOf("Windows")>-1,le=/Chrome|Chromium|Edg|OPR|Brave/.test(U);this.chromeWindowsNoCache=!1,J&&le&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(H){this.customHeaders=H}getBytes(H,q,U,J){return Ga(this,null,function*(){let le,P;U?P=U:(le=new AbortController,P=le.signal);let d=new Headers(this.customHeaders);d.set("range",`bytes=${H}-${H+q-1}`);let be;this.mustReload?be="reload":this.chromeWindowsNoCache&&(be="no-store");let Ae=yield fetch(this.url,{signal:P,cache:be,headers:d});if(H===0&&Ae.status===416){let et=Ae.headers.get("Content-Range");if(!et||!et.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let Ct=+et.substr(8);Ae=yield fetch(this.url,{signal:P,cache:"reload",headers:{range:`bytes=0-${Ct-1}`}})}let Je=Ae.headers.get("Etag");if(Je!=null&&Je.startsWith("W/")&&(Je=null),Ae.status===416||J&&Je&&Je!==J)throw this.mustReload=!0,new lm(`Server returned non-matching ETag ${J} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(Ae.status>=300)throw new Error(`Bad response code: ${Ae.status}`);let Ne=Ae.headers.get("Content-Length");if(Ae.status===200&&(!Ne||+Ne>q))throw le&&le.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield Ae.arrayBuffer(),etag:Je||void 0,cacheControl:Ae.headers.get("Cache-Control")||void 0,expires:Ae.headers.get("Expires")||void 0}})}};sn(ag,"FetchSource");var S_=ag;function vo(F,H){let q=F.getUint32(H+4,!0),U=F.getUint32(H+0,!0);return q*Jf(2,32)+U}sn(vo,"getUint64");function rg(F,H){let q=new DataView(F),U=q.getUint8(7);if(U>3)throw new Error(`Archive is spec version ${U} but this library supports up to spec version 3`);return{specVersion:U,rootDirectoryOffset:vo(q,8),rootDirectoryLength:vo(q,16),jsonMetadataOffset:vo(q,24),jsonMetadataLength:vo(q,32),leafDirectoryOffset:vo(q,40),leafDirectoryLength:vo(q,48),tileDataOffset:vo(q,56),tileDataLength:vo(q,64),numAddressedTiles:vo(q,72),numTileEntries:vo(q,80),numTileContents:vo(q,88),clustered:q.getUint8(96)===1,internalCompression:q.getUint8(97),tileCompression:q.getUint8(98),tileType:q.getUint8(99),minZoom:q.getUint8(100),maxZoom:q.getUint8(101),minLon:q.getInt32(102,!0)/1e7,minLat:q.getInt32(106,!0)/1e7,maxLon:q.getInt32(110,!0)/1e7,maxLat:q.getInt32(114,!0)/1e7,centerZoom:q.getUint8(118),centerLon:q.getInt32(119,!0)/1e7,centerLat:q.getInt32(123,!0)/1e7,etag:H}}sn(rg,"bytesToHeader");function fm(F){let H={buf:new Uint8Array(F),pos:0},q=Fd(H),U=[],J=0;for(let le=0;le<q;le++){let P=Fd(H);U.push({tileId:J+P,offset:0,length:0,runLength:1}),J+=P}for(let le=0;le<q;le++)U[le].runLength=Fd(H);for(let le=0;le<q;le++)U[le].length=Fd(H);for(let le=0;le<q;le++){let P=Fd(H);P===0&&le>0?U[le].offset=U[le-1].offset+U[le-1].length:U[le].offset=P-1}return U}sn(fm,"deserializeIndex");var sg=class extends Error{};sn(sg,"EtagMismatch");var lm=sg;function pm(F,H){return Ga(this,null,function*(){let q=yield F.getBytes(0,16384);if(new DataView(q.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let U=q.data.slice(0,w_),J=rg(U,q.etag),le=q.data.slice(J.rootDirectoryOffset,J.rootDirectoryOffset+J.rootDirectoryLength),P=`${F.getKey()}|${J.etag||""}|${J.rootDirectoryOffset}|${J.rootDirectoryLength}`,d=fm(yield H(le,J.internalCompression));return[J,[P,d.length,d]]})}sn(pm,"getHeaderAndRoot");function mm(F,H,q,U,J){return Ga(this,null,function*(){let le=yield F.getBytes(q,U,void 0,J.etag),P=yield H(le.data,J.internalCompression),d=fm(P);if(d.length===0)throw new Error("Empty directory is invalid");return d})}sn(mm,"getDirectory");var M_=class{constructor(H=100,q=!0,U=Up){this.cache=new Map,this.maxCacheEntries=H,this.counter=1,this.decompress=U}getHeader(H){return Ga(this,null,function*(){let q=H.getKey(),U=this.cache.get(q);if(U)return U.lastUsed=this.counter++,U.data;let J=yield pm(H,this.decompress);return J[1]&&this.cache.set(J[1][0],{lastUsed:this.counter++,data:J[1][2]}),this.cache.set(q,{lastUsed:this.counter++,data:J[0]}),this.prune(),J[0]})}getDirectory(H,q,U,J){return Ga(this,null,function*(){let le=`${H.getKey()}|${J.etag||""}|${q}|${U}`,P=this.cache.get(le);if(P)return P.lastUsed=this.counter++,P.data;let d=yield mm(H,this.decompress,q,U,J);return this.cache.set(le,{lastUsed:this.counter++,data:d}),this.prune(),d})}prune(){if(this.cache.size>this.maxCacheEntries){let H=1/0,q;this.cache.forEach((U,J)=>{U.lastUsed<H&&(H=U.lastUsed,q=J)}),q&&this.cache.delete(q)}}invalidate(H){return Ga(this,null,function*(){this.cache.delete(H.getKey())})}};sn(M_,"ResolvedValueCache");var og=class{constructor(H=100,q=!0,U=Up){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=H,this.counter=1,this.decompress=U}getHeader(H){return Ga(this,null,function*(){let q=H.getKey(),U=this.cache.get(q);if(U)return U.lastUsed=this.counter++,yield U.data;let J=new Promise((le,P)=>{pm(H,this.decompress).then(d=>{d[1]&&this.cache.set(d[1][0],{lastUsed:this.counter++,data:Promise.resolve(d[1][2])}),le(d[0]),this.prune()}).catch(d=>{P(d)})});return this.cache.set(q,{lastUsed:this.counter++,data:J}),J})}getDirectory(H,q,U,J){return Ga(this,null,function*(){let le=`${H.getKey()}|${J.etag||""}|${q}|${U}`,P=this.cache.get(le);if(P)return P.lastUsed=this.counter++,yield P.data;let d=new Promise((be,Ae)=>{mm(H,this.decompress,q,U,J).then(Je=>{be(Je),this.prune()}).catch(Je=>{Ae(Je)})});return this.cache.set(le,{lastUsed:this.counter++,data:d}),d})}prune(){if(this.cache.size>=this.maxCacheEntries){let H=1/0,q;this.cache.forEach((U,J)=>{U.lastUsed<H&&(H=U.lastUsed,q=J)}),q&&this.cache.delete(q)}}invalidate(H){return Ga(this,null,function*(){let q=H.getKey();if(this.invalidations.get(q))return yield this.invalidations.get(q);this.cache.delete(H.getKey());let U=new Promise((J,le)=>{this.getHeader(H).then(P=>{J(),this.invalidations.delete(q)}).catch(P=>{le(P)})});this.invalidations.set(q,U)})}};sn(og,"SharedPromiseCache");var E_=og,lg=class{constructor(H,q,U){typeof H=="string"?this.source=new S_(H):this.source=H,U?this.decompress=U:this.decompress=Up,q?this.cache=q:this.cache=new E_}getHeader(){return Ga(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(H,q,U,J){return Ga(this,null,function*(){let le=tg(H,q,U),P=yield this.cache.getHeader(this.source);if(H<P.minZoom||H>P.maxZoom)return;let d=P.rootDirectoryOffset,be=P.rootDirectoryLength;for(let Ae=0;Ae<=3;Ae++){let Je=yield this.cache.getDirectory(this.source,d,be,P),Ne=ng(Je,le);if(Ne){if(Ne.runLength>0){let et=yield this.source.getBytes(P.tileDataOffset+Ne.offset,Ne.length,J,P.etag);return{data:yield this.decompress(et.data,P.tileCompression),cacheControl:et.cacheControl,expires:et.expires}}d=P.leafDirectoryOffset+Ne.offset,be=Ne.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(H,q,U,J){return Ga(this,null,function*(){try{return yield this.getZxyAttempt(H,q,U,J)}catch(le){if(le instanceof lm)return this.cache.invalidate(this.source),yield this.getZxyAttempt(H,q,U,J);throw le}})}getMetadataAttempt(){return Ga(this,null,function*(){let H=yield this.cache.getHeader(this.source),q=yield this.source.getBytes(H.jsonMetadataOffset,H.jsonMetadataLength,void 0,H.etag),U=yield this.decompress(q.data,H.internalCompression),J=new TextDecoder("utf-8");return JSON.parse(J.decode(U))})}getMetadata(){return Ga(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(H){if(H instanceof lm)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw H}})}getTileJson(H){return Ga(this,null,function*(){let q=yield this.getHeader(),U=yield this.getMetadata(),J=ig(q.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${H}/{z}/{x}/{y}${J}`],vector_layers:U.vector_layers,attribution:U.attribution,description:U.description,name:U.name,version:U.version,bounds:[q.minLon,q.minLat,q.maxLon,q.maxLat],center:[q.centerLon,q.centerLat,q.centerZoom],minzoom:q.minZoom,maxzoom:q.maxZoom}})}};sn(lg,"PMTiles");var Bm=lg;const Om={osm_vector:"./styles/osm_vector.json",osm_raster:"./styles/osm_raster.json",osm_pmtiles:"./styles/osm_pmtiles.json"};let jm=!1;const A_=()=>{if(!jm){const F=new __;Zm.addProtocol("pmtiles",F.tile),jm=!0}};function C_(){const F=Et.useMemo(()=>{const le=new URLSearchParams(window.location.search).get("style"),P=Object.keys(Om);return le&&P.includes(le)?le:"osm_vector"},[]),[H,q]=Et.useState(F);Et.useEffect(()=>{A_()},[]);const U=Et.useCallback(J=>{q(J);const le=new URLSearchParams(window.location.search);le.set("style",J);let P=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+le.toString();window.location.hash&&(P+=window.location.hash),window.history.replaceState({path:P},"",P)},[]);return ol.jsx("div",{style:{width:"100vw",height:"100vh"},children:ol.jsxs(kg,{initialViewState:{longitude:0,latitude:0,zoom:4},hash:!0,style:{width:"100%",height:"100%"},mapStyle:Om[H],children:[ol.jsx("div",{children:ol.jsxs("select",{value:H,onChange:J=>U(J.target.value),style:{position:"absolute",top:10,left:10,zIndex:1},children:[ol.jsx("option",{value:"osm_vector",children:"OSM Vector"}),ol.jsx("option",{value:"osm_raster",children:"OSM Raster"}),ol.jsx("option",{value:"osm_pmtiles",children:"OSM PMTiles"})]})}),ol.jsx(Ug,{position:"top-right"}),ol.jsx(Vg,{position:"top-right",visualizePitch:!0,showZoom:!0,showCompass:!0})]})})}xg.createRoot(document.getElementById("root")).render(ol.jsx(fg.StrictMode,{children:ol.jsx(C_,{})}));
