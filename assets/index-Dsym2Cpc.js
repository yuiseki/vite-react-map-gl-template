function Z_(V,$){for(var H=0;H<$.length;H++){const Z=$[H];if(typeof Z!="string"&&!Array.isArray(Z)){for(const nt in Z)if(nt!=="default"&&!(nt in V)){const ft=Object.getOwnPropertyDescriptor(Z,nt);ft&&Object.defineProperty(V,nt,ft.get?ft:{enumerable:!0,get:()=>Z[nt]})}}}return Object.freeze(Object.defineProperty(V,Symbol.toStringTag,{value:"Module"}))}(function(){const $=document.createElement("link").relList;if($&&$.supports&&$.supports("modulepreload"))return;for(const nt of document.querySelectorAll('link[rel="modulepreload"]'))Z(nt);new MutationObserver(nt=>{for(const ft of nt)if(ft.type==="childList")for(const P of ft.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&Z(P)}).observe(document,{childList:!0,subtree:!0});function H(nt){const ft={};return nt.integrity&&(ft.integrity=nt.integrity),nt.referrerPolicy&&(ft.referrerPolicy=nt.referrerPolicy),nt.crossOrigin==="use-credentials"?ft.credentials="include":nt.crossOrigin==="anonymous"?ft.credentials="omit":ft.credentials="same-origin",ft}function Z(nt){if(nt.ep)return;nt.ep=!0;const ft=H(nt);fetch(nt.href,ft)}})();function Mg(V){return V&&V.__esModule&&Object.prototype.hasOwnProperty.call(V,"default")?V.default:V}var mg={exports:{}},Hp={};var Ng;function q_(){if(Ng)return Hp;Ng=1;var V=Symbol.for("react.transitional.element"),$=Symbol.for("react.fragment");function H(Z,nt,ft){var P=null;if(ft!==void 0&&(P=""+ft),nt.key!==void 0&&(P=""+nt.key),"key"in nt){ft={};for(var d in nt)d!=="key"&&(ft[d]=nt[d])}else ft=nt;return nt=ft.ref,{$$typeof:V,type:Z,key:P,ref:nt!==void 0?nt:null,props:ft}}return Hp.Fragment=$,Hp.jsx=H,Hp.jsxs=H,Hp}var Ug;function H_(){return Ug||(Ug=1,mg.exports=q_()),mg.exports}var El=H_(),gg={exports:{}},$e={};var jg;function X_(){if(jg)return $e;jg=1;var V=Symbol.for("react.transitional.element"),$=Symbol.for("react.portal"),H=Symbol.for("react.fragment"),Z=Symbol.for("react.strict_mode"),nt=Symbol.for("react.profiler"),ft=Symbol.for("react.consumer"),P=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),wt=Symbol.for("react.suspense"),At=Symbol.for("react.memo"),ie=Symbol.for("react.lazy"),jt=Symbol.for("react.activity"),re=Symbol.iterator;function ve(vt){return vt===null||typeof vt!="object"?null:(vt=re&&vt[re]||vt["@@iterator"],typeof vt=="function"?vt:null)}var Ke={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},he=Object.assign,Ct={};function Ai(vt,qt,ae){this.props=vt,this.context=qt,this.refs=Ct,this.updater=ae||Ke}Ai.prototype.isReactComponent={},Ai.prototype.setState=function(vt,qt){if(typeof vt!="object"&&typeof vt!="function"&&vt!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,vt,qt,"setState")},Ai.prototype.forceUpdate=function(vt){this.updater.enqueueForceUpdate(this,vt,"forceUpdate")};function ti(){}ti.prototype=Ai.prototype;function Ee(vt,qt,ae){this.props=vt,this.context=qt,this.refs=Ct,this.updater=ae||Ke}var di=Ee.prototype=new ti;di.constructor=Ee,he(di,Ai.prototype),di.isPureReactComponent=!0;var Ci=Array.isArray;function un(){}var Re={H:null,A:null,T:null,S:null},En=Object.prototype.hasOwnProperty;function $i(vt,qt,ae){var fe=ae.ref;return{$$typeof:V,type:vt,key:qt,ref:fe!==void 0?fe:null,props:ae}}function Yn(vt,qt){return $i(vt.type,qt,vt.props)}function bi(vt){return typeof vt=="object"&&vt!==null&&vt.$$typeof===V}function Yi(vt){var qt={"=":"=0",":":"=2"};return"$"+vt.replace(/[=:]/g,function(ae){return qt[ae]})}var xr=/\/+/g;function br(vt,qt){return typeof vt=="object"&&vt!==null&&vt.key!=null?Yi(""+vt.key):qt.toString(36)}function Vn(vt){switch(vt.status){case"fulfilled":return vt.value;case"rejected":throw vt.reason;default:switch(typeof vt.status=="string"?vt.then(un,un):(vt.status="pending",vt.then(function(qt){vt.status==="pending"&&(vt.status="fulfilled",vt.value=qt)},function(qt){vt.status==="pending"&&(vt.status="rejected",vt.reason=qt)})),vt.status){case"fulfilled":return vt.value;case"rejected":throw vt.reason}}throw vt}function Nt(vt,qt,ae,fe,Ce){var ze=typeof vt;(ze==="undefined"||ze==="boolean")&&(vt=null);var Ue=!1;if(vt===null)Ue=!0;else switch(ze){case"bigint":case"string":case"number":Ue=!0;break;case"object":switch(vt.$$typeof){case V:case $:Ue=!0;break;case ie:return Ue=vt._init,Nt(Ue(vt._payload),qt,ae,fe,Ce)}}if(Ue)return Ce=Ce(vt),Ue=fe===""?"."+br(vt,0):fe,Ci(Ce)?(ae="",Ue!=null&&(ae=Ue.replace(xr,"$&/")+"/"),Nt(Ce,qt,ae,"",function(Lr){return Lr})):Ce!=null&&(bi(Ce)&&(Ce=Yn(Ce,ae+(Ce.key==null||vt&&vt.key===Ce.key?"":(""+Ce.key).replace(xr,"$&/")+"/")+Ue)),qt.push(Ce)),1;Ue=0;var fi=fe===""?".":fe+":";if(Ci(vt))for(var wi=0;wi<vt.length;wi++)fe=vt[wi],ze=fi+br(fe,wi),Ue+=Nt(fe,qt,ae,ze,Ce);else if(wi=ve(vt),typeof wi=="function")for(vt=wi.call(vt),wi=0;!(fe=vt.next()).done;)fe=fe.value,ze=fi+br(fe,wi++),Ue+=Nt(fe,qt,ae,ze,Ce);else if(ze==="object"){if(typeof vt.then=="function")return Nt(Vn(vt),qt,ae,fe,Ce);throw qt=String(vt),Error("Objects are not valid as a React child (found: "+(qt==="[object Object]"?"object with keys {"+Object.keys(vt).join(", ")+"}":qt)+"). If you meant to render a collection of children, use an array instead.")}return Ue}function ne(vt,qt,ae){if(vt==null)return vt;var fe=[],Ce=0;return Nt(vt,fe,"","",function(ze){return qt.call(ae,ze,Ce++)}),fe}function Pe(vt){if(vt._status===-1){var qt=vt._result;qt=qt(),qt.then(function(ae){(vt._status===0||vt._status===-1)&&(vt._status=1,vt._result=ae)},function(ae){(vt._status===0||vt._status===-1)&&(vt._status=2,vt._result=ae)}),vt._status===-1&&(vt._status=0,vt._result=qt)}if(vt._status===1)return vt._result.default;throw vt._result}var ge=typeof reportError=="function"?reportError:function(vt){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var qt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof vt=="object"&&vt!==null&&typeof vt.message=="string"?String(vt.message):String(vt),error:vt});if(!window.dispatchEvent(qt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",vt);return}console.error(vt)},oi={map:ne,forEach:function(vt,qt,ae){ne(vt,function(){qt.apply(this,arguments)},ae)},count:function(vt){var qt=0;return ne(vt,function(){qt++}),qt},toArray:function(vt){return ne(vt,function(qt){return qt})||[]},only:function(vt){if(!bi(vt))throw Error("React.Children.only expected to receive a single React element child.");return vt}};return $e.Activity=jt,$e.Children=oi,$e.Component=Ai,$e.Fragment=H,$e.Profiler=nt,$e.PureComponent=Ee,$e.StrictMode=Z,$e.Suspense=wt,$e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Re,$e.__COMPILER_RUNTIME={__proto__:null,c:function(vt){return Re.H.useMemoCache(vt)}},$e.cache=function(vt){return function(){return vt.apply(null,arguments)}},$e.cacheSignal=function(){return null},$e.cloneElement=function(vt,qt,ae){if(vt==null)throw Error("The argument must be a React element, but you passed "+vt+".");var fe=he({},vt.props),Ce=vt.key;if(qt!=null)for(ze in qt.key!==void 0&&(Ce=""+qt.key),qt)!En.call(qt,ze)||ze==="key"||ze==="__self"||ze==="__source"||ze==="ref"&&qt.ref===void 0||(fe[ze]=qt[ze]);var ze=arguments.length-2;if(ze===1)fe.children=ae;else if(1<ze){for(var Ue=Array(ze),fi=0;fi<ze;fi++)Ue[fi]=arguments[fi+2];fe.children=Ue}return $i(vt.type,Ce,fe)},$e.createContext=function(vt){return vt={$$typeof:P,_currentValue:vt,_currentValue2:vt,_threadCount:0,Provider:null,Consumer:null},vt.Provider=vt,vt.Consumer={$$typeof:ft,_context:vt},vt},$e.createElement=function(vt,qt,ae){var fe,Ce={},ze=null;if(qt!=null)for(fe in qt.key!==void 0&&(ze=""+qt.key),qt)En.call(qt,fe)&&fe!=="key"&&fe!=="__self"&&fe!=="__source"&&(Ce[fe]=qt[fe]);var Ue=arguments.length-2;if(Ue===1)Ce.children=ae;else if(1<Ue){for(var fi=Array(Ue),wi=0;wi<Ue;wi++)fi[wi]=arguments[wi+2];Ce.children=fi}if(vt&&vt.defaultProps)for(fe in Ue=vt.defaultProps,Ue)Ce[fe]===void 0&&(Ce[fe]=Ue[fe]);return $i(vt,ze,Ce)},$e.createRef=function(){return{current:null}},$e.forwardRef=function(vt){return{$$typeof:d,render:vt}},$e.isValidElement=bi,$e.lazy=function(vt){return{$$typeof:ie,_payload:{_status:-1,_result:vt},_init:Pe}},$e.memo=function(vt,qt){return{$$typeof:At,type:vt,compare:qt===void 0?null:qt}},$e.startTransition=function(vt){var qt=Re.T,ae={};Re.T=ae;try{var fe=vt(),Ce=Re.S;Ce!==null&&Ce(ae,fe),typeof fe=="object"&&fe!==null&&typeof fe.then=="function"&&fe.then(un,ge)}catch(ze){ge(ze)}finally{qt!==null&&ae.types!==null&&(qt.types=ae.types),Re.T=qt}},$e.unstable_useCacheRefresh=function(){return Re.H.useCacheRefresh()},$e.use=function(vt){return Re.H.use(vt)},$e.useActionState=function(vt,qt,ae){return Re.H.useActionState(vt,qt,ae)},$e.useCallback=function(vt,qt){return Re.H.useCallback(vt,qt)},$e.useContext=function(vt){return Re.H.useContext(vt)},$e.useDebugValue=function(){},$e.useDeferredValue=function(vt,qt){return Re.H.useDeferredValue(vt,qt)},$e.useEffect=function(vt,qt){return Re.H.useEffect(vt,qt)},$e.useEffectEvent=function(vt){return Re.H.useEffectEvent(vt)},$e.useId=function(){return Re.H.useId()},$e.useImperativeHandle=function(vt,qt,ae){return Re.H.useImperativeHandle(vt,qt,ae)},$e.useInsertionEffect=function(vt,qt){return Re.H.useInsertionEffect(vt,qt)},$e.useLayoutEffect=function(vt,qt){return Re.H.useLayoutEffect(vt,qt)},$e.useMemo=function(vt,qt){return Re.H.useMemo(vt,qt)},$e.useOptimistic=function(vt,qt){return Re.H.useOptimistic(vt,qt)},$e.useReducer=function(vt,qt,ae){return Re.H.useReducer(vt,qt,ae)},$e.useRef=function(vt){return Re.H.useRef(vt)},$e.useState=function(vt){return Re.H.useState(vt)},$e.useSyncExternalStore=function(vt,qt,ae){return Re.H.useSyncExternalStore(vt,qt,ae)},$e.useTransition=function(){return Re.H.useTransition()},$e.version="19.2.0",$e}var Vg;function Eg(){return Vg||(Vg=1,gg.exports=X_()),gg.exports}var De=Eg();const $_=Mg(De);var _g={exports:{}},Xp={},yg={exports:{}},vg={};var Gg;function Y_(){return Gg||(Gg=1,function(V){function $(Nt,ne){var Pe=Nt.length;Nt.push(ne);t:for(;0<Pe;){var ge=Pe-1>>>1,oi=Nt[ge];if(0<nt(oi,ne))Nt[ge]=ne,Nt[Pe]=oi,Pe=ge;else break t}}function H(Nt){return Nt.length===0?null:Nt[0]}function Z(Nt){if(Nt.length===0)return null;var ne=Nt[0],Pe=Nt.pop();if(Pe!==ne){Nt[0]=Pe;t:for(var ge=0,oi=Nt.length,vt=oi>>>1;ge<vt;){var qt=2*(ge+1)-1,ae=Nt[qt],fe=qt+1,Ce=Nt[fe];if(0>nt(ae,Pe))fe<oi&&0>nt(Ce,ae)?(Nt[ge]=Ce,Nt[fe]=Pe,ge=fe):(Nt[ge]=ae,Nt[qt]=Pe,ge=qt);else if(fe<oi&&0>nt(Ce,Pe))Nt[ge]=Ce,Nt[fe]=Pe,ge=fe;else break t}}return ne}function nt(Nt,ne){var Pe=Nt.sortIndex-ne.sortIndex;return Pe!==0?Pe:Nt.id-ne.id}if(V.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var ft=performance;V.unstable_now=function(){return ft.now()}}else{var P=Date,d=P.now();V.unstable_now=function(){return P.now()-d}}var wt=[],At=[],ie=1,jt=null,re=3,ve=!1,Ke=!1,he=!1,Ct=!1,Ai=typeof setTimeout=="function"?setTimeout:null,ti=typeof clearTimeout=="function"?clearTimeout:null,Ee=typeof setImmediate<"u"?setImmediate:null;function di(Nt){for(var ne=H(At);ne!==null;){if(ne.callback===null)Z(At);else if(ne.startTime<=Nt)Z(At),ne.sortIndex=ne.expirationTime,$(wt,ne);else break;ne=H(At)}}function Ci(Nt){if(he=!1,di(Nt),!Ke)if(H(wt)!==null)Ke=!0,un||(un=!0,Yi());else{var ne=H(At);ne!==null&&Vn(Ci,ne.startTime-Nt)}}var un=!1,Re=-1,En=5,$i=-1;function Yn(){return Ct?!0:!(V.unstable_now()-$i<En)}function bi(){if(Ct=!1,un){var Nt=V.unstable_now();$i=Nt;var ne=!0;try{t:{Ke=!1,he&&(he=!1,ti(Re),Re=-1),ve=!0;var Pe=re;try{e:{for(di(Nt),jt=H(wt);jt!==null&&!(jt.expirationTime>Nt&&Yn());){var ge=jt.callback;if(typeof ge=="function"){jt.callback=null,re=jt.priorityLevel;var oi=ge(jt.expirationTime<=Nt);if(Nt=V.unstable_now(),typeof oi=="function"){jt.callback=oi,di(Nt),ne=!0;break e}jt===H(wt)&&Z(wt),di(Nt)}else Z(wt);jt=H(wt)}if(jt!==null)ne=!0;else{var vt=H(At);vt!==null&&Vn(Ci,vt.startTime-Nt),ne=!1}}break t}finally{jt=null,re=Pe,ve=!1}ne=void 0}}finally{ne?Yi():un=!1}}}var Yi;if(typeof Ee=="function")Yi=function(){Ee(bi)};else if(typeof MessageChannel<"u"){var xr=new MessageChannel,br=xr.port2;xr.port1.onmessage=bi,Yi=function(){br.postMessage(null)}}else Yi=function(){Ai(bi,0)};function Vn(Nt,ne){Re=Ai(function(){Nt(V.unstable_now())},ne)}V.unstable_IdlePriority=5,V.unstable_ImmediatePriority=1,V.unstable_LowPriority=4,V.unstable_NormalPriority=3,V.unstable_Profiling=null,V.unstable_UserBlockingPriority=2,V.unstable_cancelCallback=function(Nt){Nt.callback=null},V.unstable_forceFrameRate=function(Nt){0>Nt||125<Nt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):En=0<Nt?Math.floor(1e3/Nt):5},V.unstable_getCurrentPriorityLevel=function(){return re},V.unstable_next=function(Nt){switch(re){case 1:case 2:case 3:var ne=3;break;default:ne=re}var Pe=re;re=ne;try{return Nt()}finally{re=Pe}},V.unstable_requestPaint=function(){Ct=!0},V.unstable_runWithPriority=function(Nt,ne){switch(Nt){case 1:case 2:case 3:case 4:case 5:break;default:Nt=3}var Pe=re;re=Nt;try{return ne()}finally{re=Pe}},V.unstable_scheduleCallback=function(Nt,ne,Pe){var ge=V.unstable_now();switch(typeof Pe=="object"&&Pe!==null?(Pe=Pe.delay,Pe=typeof Pe=="number"&&0<Pe?ge+Pe:ge):Pe=ge,Nt){case 1:var oi=-1;break;case 2:oi=250;break;case 5:oi=1073741823;break;case 4:oi=1e4;break;default:oi=5e3}return oi=Pe+oi,Nt={id:ie++,callback:ne,priorityLevel:Nt,startTime:Pe,expirationTime:oi,sortIndex:-1},Pe>ge?(Nt.sortIndex=Pe,$(At,Nt),H(wt)===null&&Nt===H(At)&&(he?(ti(Re),Re=-1):he=!0,Vn(Ci,Pe-ge))):(Nt.sortIndex=oi,$(wt,Nt),Ke||ve||(Ke=!0,un||(un=!0,Yi()))),Nt},V.unstable_shouldYield=Yn,V.unstable_wrapCallback=function(Nt){var ne=re;return function(){var Pe=re;re=ne;try{return Nt.apply(this,arguments)}finally{re=Pe}}}}(vg)),vg}var Zg;function W_(){return Zg||(Zg=1,yg.exports=Y_()),yg.exports}var xg={exports:{}},_a={};var qg;function K_(){if(qg)return _a;qg=1;var V=Eg();function $(wt){var At="https://react.dev/errors/"+wt;if(1<arguments.length){At+="?args[]="+encodeURIComponent(arguments[1]);for(var ie=2;ie<arguments.length;ie++)At+="&args[]="+encodeURIComponent(arguments[ie])}return"Minified React error #"+wt+"; visit "+At+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function H(){}var Z={d:{f:H,r:function(){throw Error($(522))},D:H,C:H,L:H,m:H,X:H,S:H,M:H},p:0,findDOMNode:null},nt=Symbol.for("react.portal");function ft(wt,At,ie){var jt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:nt,key:jt==null?null:""+jt,children:wt,containerInfo:At,implementation:ie}}var P=V.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(wt,At){if(wt==="font")return"";if(typeof At=="string")return At==="use-credentials"?At:""}return _a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Z,_a.createPortal=function(wt,At){var ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!At||At.nodeType!==1&&At.nodeType!==9&&At.nodeType!==11)throw Error($(299));return ft(wt,At,null,ie)},_a.flushSync=function(wt){var At=P.T,ie=Z.p;try{if(P.T=null,Z.p=2,wt)return wt()}finally{P.T=At,Z.p=ie,Z.d.f()}},_a.preconnect=function(wt,At){typeof wt=="string"&&(At?(At=At.crossOrigin,At=typeof At=="string"?At==="use-credentials"?At:"":void 0):At=null,Z.d.C(wt,At))},_a.prefetchDNS=function(wt){typeof wt=="string"&&Z.d.D(wt)},_a.preinit=function(wt,At){if(typeof wt=="string"&&At&&typeof At.as=="string"){var ie=At.as,jt=d(ie,At.crossOrigin),re=typeof At.integrity=="string"?At.integrity:void 0,ve=typeof At.fetchPriority=="string"?At.fetchPriority:void 0;ie==="style"?Z.d.S(wt,typeof At.precedence=="string"?At.precedence:void 0,{crossOrigin:jt,integrity:re,fetchPriority:ve}):ie==="script"&&Z.d.X(wt,{crossOrigin:jt,integrity:re,fetchPriority:ve,nonce:typeof At.nonce=="string"?At.nonce:void 0})}},_a.preinitModule=function(wt,At){if(typeof wt=="string")if(typeof At=="object"&&At!==null){if(At.as==null||At.as==="script"){var ie=d(At.as,At.crossOrigin);Z.d.M(wt,{crossOrigin:ie,integrity:typeof At.integrity=="string"?At.integrity:void 0,nonce:typeof At.nonce=="string"?At.nonce:void 0})}}else At==null&&Z.d.M(wt)},_a.preload=function(wt,At){if(typeof wt=="string"&&typeof At=="object"&&At!==null&&typeof At.as=="string"){var ie=At.as,jt=d(ie,At.crossOrigin);Z.d.L(wt,ie,{crossOrigin:jt,integrity:typeof At.integrity=="string"?At.integrity:void 0,nonce:typeof At.nonce=="string"?At.nonce:void 0,type:typeof At.type=="string"?At.type:void 0,fetchPriority:typeof At.fetchPriority=="string"?At.fetchPriority:void 0,referrerPolicy:typeof At.referrerPolicy=="string"?At.referrerPolicy:void 0,imageSrcSet:typeof At.imageSrcSet=="string"?At.imageSrcSet:void 0,imageSizes:typeof At.imageSizes=="string"?At.imageSizes:void 0,media:typeof At.media=="string"?At.media:void 0})}},_a.preloadModule=function(wt,At){if(typeof wt=="string")if(At){var ie=d(At.as,At.crossOrigin);Z.d.m(wt,{as:typeof At.as=="string"&&At.as!=="script"?At.as:void 0,crossOrigin:ie,integrity:typeof At.integrity=="string"?At.integrity:void 0})}else Z.d.m(wt)},_a.requestFormReset=function(wt){Z.d.r(wt)},_a.unstable_batchedUpdates=function(wt,At){return wt(At)},_a.useFormState=function(wt,At,ie){return P.H.useFormState(wt,At,ie)},_a.useFormStatus=function(){return P.H.useHostTransitionStatus()},_a.version="19.2.0",_a}var Hg;function l_(){if(Hg)return xg.exports;Hg=1;function V(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(V)}catch($){console.error($)}}return V(),xg.exports=K_(),xg.exports}var Xg;function Q_(){if(Xg)return Xp;Xg=1;var V=W_(),$=Eg(),H=l_();function Z(n){var s="https://react.dev/errors/"+n;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function nt(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function ft(n){var s=n,c=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,(s.flags&4098)!==0&&(c=s.return),n=s.return;while(n)}return s.tag===3?c:null}function P(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function d(n){if(n.tag===31){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function wt(n){if(ft(n)!==n)throw Error(Z(188))}function At(n){var s=n.alternate;if(!s){if(s=ft(n),s===null)throw Error(Z(188));return s!==n?null:n}for(var c=n,g=s;;){var b=c.return;if(b===null)break;var E=b.alternate;if(E===null){if(g=b.return,g!==null){c=g;continue}break}if(b.child===E.child){for(E=b.child;E;){if(E===c)return wt(b),n;if(E===g)return wt(b),s;E=E.sibling}throw Error(Z(188))}if(c.return!==g.return)c=b,g=E;else{for(var O=!1,W=b.child;W;){if(W===c){O=!0,c=b,g=E;break}if(W===g){O=!0,g=b,c=E;break}W=W.sibling}if(!O){for(W=E.child;W;){if(W===c){O=!0,c=E,g=b;break}if(W===g){O=!0,g=E,c=b;break}W=W.sibling}if(!O)throw Error(Z(189))}}if(c.alternate!==g)throw Error(Z(190))}if(c.tag!==3)throw Error(Z(188));return c.stateNode.current===c?n:s}function ie(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n;for(n=n.child;n!==null;){if(s=ie(n),s!==null)return s;n=n.sibling}return null}var jt=Object.assign,re=Symbol.for("react.element"),ve=Symbol.for("react.transitional.element"),Ke=Symbol.for("react.portal"),he=Symbol.for("react.fragment"),Ct=Symbol.for("react.strict_mode"),Ai=Symbol.for("react.profiler"),ti=Symbol.for("react.consumer"),Ee=Symbol.for("react.context"),di=Symbol.for("react.forward_ref"),Ci=Symbol.for("react.suspense"),un=Symbol.for("react.suspense_list"),Re=Symbol.for("react.memo"),En=Symbol.for("react.lazy"),$i=Symbol.for("react.activity"),Yn=Symbol.for("react.memo_cache_sentinel"),bi=Symbol.iterator;function Yi(n){return n===null||typeof n!="object"?null:(n=bi&&n[bi]||n["@@iterator"],typeof n=="function"?n:null)}var xr=Symbol.for("react.client.reference");function br(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===xr?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case he:return"Fragment";case Ai:return"Profiler";case Ct:return"StrictMode";case Ci:return"Suspense";case un:return"SuspenseList";case $i:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case Ke:return"Portal";case Ee:return n.displayName||"Context";case ti:return(n._context.displayName||"Context")+".Consumer";case di:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Re:return s=n.displayName||null,s!==null?s:br(n.type)||"Memo";case En:s=n._payload,n=n._init;try{return br(n(s))}catch{}}return null}var Vn=Array.isArray,Nt=$.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne=H.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Pe={pending:!1,data:null,method:null,action:null},ge=[],oi=-1;function vt(n){return{current:n}}function qt(n){0>oi||(n.current=ge[oi],ge[oi]=null,oi--)}function ae(n,s){oi++,ge[oi]=n.current,n.current=s}var fe=vt(null),Ce=vt(null),ze=vt(null),Ue=vt(null);function fi(n,s){switch(ae(ze,s),ae(Ce,n),ae(fe,null),s.nodeType){case 9:case 11:n=(n=s.documentElement)&&(n=n.namespaceURI)?kd(n):0;break;default:if(n=s.tagName,s=s.namespaceURI)s=kd(s),n=Lp(s,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}qt(fe),ae(fe,n)}function wi(){qt(fe),qt(Ce),qt(ze)}function Lr(n){n.memoizedState!==null&&ae(Ue,n);var s=fe.current,c=Lp(s,n.type);s!==c&&(ae(Ce,n),ae(fe,c))}function Wr(n){Ce.current===n&&(qt(fe),qt(Ce)),Ue.current===n&&(qt(Ue),bf._currentValue=Pe)}var Wn,ps;function gi(n){if(Wn===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);Wn=s&&s[1]||"",ps=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Wn+n+ps}var Kr=!1;function oa(n,s){if(!n||Kr)return"";Kr=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(s){var Yt=function(){throw Error()};if(Object.defineProperty(Yt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Yt,[])}catch(Ft){var Bt=Ft}Reflect.construct(n,[],Yt)}else{try{Yt.call()}catch(Ft){Bt=Ft}n.call(Yt.prototype)}}else{try{throw Error()}catch(Ft){Bt=Ft}(Yt=n())&&typeof Yt.catch=="function"&&Yt.catch(function(){})}}catch(Ft){if(Ft&&Bt&&typeof Ft.stack=="string")return[Ft.stack,Bt.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=g.DetermineComponentFrameRoot(),O=E[0],W=E[1];if(O&&W){var gt=O.split(`
`),Lt=W.split(`
`);for(b=g=0;g<gt.length&&!gt[g].includes("DetermineComponentFrameRoot");)g++;for(;b<Lt.length&&!Lt[b].includes("DetermineComponentFrameRoot");)b++;if(g===gt.length||b===Lt.length)for(g=gt.length-1,b=Lt.length-1;1<=g&&0<=b&&gt[g]!==Lt[b];)b--;for(;1<=g&&0<=b;g--,b--)if(gt[g]!==Lt[b]){if(g!==1||b!==1)do if(g--,b--,0>b||gt[g]!==Lt[b]){var Vt=`
`+gt[g].replace(" at new "," at ");return n.displayName&&Vt.includes("<anonymous>")&&(Vt=Vt.replace("<anonymous>",n.displayName)),Vt}while(1<=g&&0<=b);break}}}finally{Kr=!1,Error.prepareStackTrace=c}return(c=n?n.displayName||n.name:"")?gi(c):""}function Wi(n,s){switch(n.tag){case 26:case 27:case 5:return gi(n.type);case 16:return gi("Lazy");case 13:return n.child!==s&&s!==null?gi("Suspense Fallback"):gi("Suspense");case 19:return gi("SuspenseList");case 0:case 15:return oa(n.type,!1);case 11:return oa(n.type.render,!1);case 1:return oa(n.type,!0);case 31:return gi("Activity");default:return""}}function ya(n){try{var s="",c=null;do s+=Wi(n,c),c=n,n=n.return;while(n);return s}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var la=Object.prototype.hasOwnProperty,Js=V.unstable_scheduleCallback,Ua=V.unstable_cancelCallback,ja=V.unstable_shouldYield,to=V.unstable_requestPaint,Ln=V.unstable_now,kr=V.unstable_getCurrentPriorityLevel,Al=V.unstable_ImmediatePriority,Cl=V.unstable_UserBlockingPriority,Va=V.unstable_NormalPriority,zl=V.unstable_LowPriority,ms=V.unstable_IdlePriority,Dl=V.log,ko=V.unstable_setDisableYieldValue,wr=null,Zi=null;function mt(n){if(typeof Dl=="function"&&ko(n),Zi&&typeof Zi.setStrictMode=="function")try{Zi.setStrictMode(wr,n)}catch{}}var j=Math.clz32?Math.clz32:ot,G=Math.log,Y=Math.LN2;function ot(n){return n>>>=0,n===0?32:31-(G(n)/Y|0)|0}var ut=256,Tt=262144,tt=4194304;function yt(n){var s=n&42;if(s!==0)return s;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function It(n,s,c){var g=n.pendingLanes;if(g===0)return 0;var b=0,E=n.suspendedLanes,O=n.pingedLanes;n=n.warmLanes;var W=g&134217727;return W!==0?(g=W&~E,g!==0?b=yt(g):(O&=W,O!==0?b=yt(O):c||(c=W&~n,c!==0&&(b=yt(c))))):(W=g&~E,W!==0?b=yt(W):O!==0?b=yt(O):c||(c=g&~n,c!==0&&(b=yt(c)))),b===0?0:s!==0&&s!==b&&(s&E)===0&&(E=b&-b,c=s&-s,E>=c||E===32&&(c&4194048)!==0)?s:b}function kt(n,s){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&s)===0}function Ot(n,s){switch(n){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ue(){var n=tt;return tt<<=1,(tt&62914560)===0&&(tt=4194304),n}function xe(n){for(var s=[],c=0;31>c;c++)s.push(n);return s}function Le(n,s){n.pendingLanes|=s,s!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function en(n,s,c,g,b,E){var O=n.pendingLanes;n.pendingLanes=c,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=c,n.entangledLanes&=c,n.errorRecoveryDisabledLanes&=c,n.shellSuspendCounter=0;var W=n.entanglements,gt=n.expirationTimes,Lt=n.hiddenUpdates;for(c=O&~c;0<c;){var Vt=31-j(c),Yt=1<<Vt;W[Vt]=0,gt[Vt]=-1;var Bt=Lt[Vt];if(Bt!==null)for(Lt[Vt]=null,Vt=0;Vt<Bt.length;Vt++){var Ft=Bt[Vt];Ft!==null&&(Ft.lane&=-536870913)}c&=~Yt}g!==0&&Ge(n,g,0),E!==0&&b===0&&n.tag!==0&&(n.suspendedLanes|=E&~(O&~s))}function Ge(n,s,c){n.pendingLanes|=s,n.suspendedLanes&=~s;var g=31-j(s);n.entangledLanes|=s,n.entanglements[g]=n.entanglements[g]|1073741824|c&261930}function li(n,s){var c=n.entangledLanes|=s;for(n=n.entanglements;c;){var g=31-j(c),b=1<<g;b&s|n[g]&s&&(n[g]|=s),c&=~b}}function zi(n,s){var c=s&-s;return c=(c&42)!==0?1:Qt(c),(c&(n.suspendedLanes|s))!==0?0:c}function Qt(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function Di(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function Pi(){var n=ne.p;return n!==0?n:(n=window.event,n===void 0?32:Vm(n.type))}function mn(n,s){var c=ne.p;try{return ne.p=n,s()}finally{ne.p=c}}var ui=Math.random().toString(36).slice(2),Ht="__reactFiber$"+ui,se="__reactProps$"+ui,be="__reactContainer$"+ui,cr="__reactEvents$"+ui,Bo="__reactListeners$"+ui,Gn="__reactHandles$"+ui,Ie="__reactResources$"+ui,Qr="__reactMarker$"+ui;function eo(n){delete n[Ht],delete n[se],delete n[cr],delete n[Bo],delete n[Gn]}function va(n){var s=n[Ht];if(s)return s;for(var c=n.parentNode;c;){if(s=c[be]||c[Ht]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(n=Lm(n);n!==null;){if(c=n[Ht])return c;n=Lm(n)}return s}n=c,c=n.parentNode}return null}function hr(n){if(n=n[Ht]||n[be]){var s=n.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return n}return null}function xa(n){var s=n.tag;if(s===5||s===26||s===27||s===6)return n.stateNode;throw Error(Z(33))}function ba(n){var s=n[Ie];return s||(s=n[Ie]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function nn(n){n[Qr]=!0}var Br=new Set,Ii={};function Oo(n,s){Tr(n,s),Tr(n+"Capture",s)}function Tr(n,s){for(Ii[n]=s,n=0;n<s.length;n++)Br.add(s[n])}var fu=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),qi={},gs={};function mh(n){return la.call(gs,n)?!0:la.call(qi,n)?!1:fu.test(n)?gs[n]=!0:(qi[n]=!0,!1)}function _s(n,s,c){if(mh(s))if(c===null)n.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":n.removeAttribute(s);return;case"boolean":var g=s.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){n.removeAttribute(s);return}}n.setAttribute(s,""+c)}}function Pl(n,s,c){if(c===null)n.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(s);return}n.setAttribute(s,""+c)}}function Or(n,s,c,g){if(g===null)n.removeAttribute(c);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(c);return}n.setAttributeNS(s,c,""+g)}}function Jr(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function gh(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function ip(n,s,c){var g=Object.getOwnPropertyDescriptor(n.constructor.prototype,s);if(!n.hasOwnProperty(s)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var b=g.get,E=g.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return b.call(this)},set:function(O){c=""+O,E.call(this,O)}}),Object.defineProperty(n,s,{enumerable:g.enumerable}),{getValue:function(){return c},setValue:function(O){c=""+O},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function gc(n){if(!n._valueTracker){var s=gh(n)?"checked":"value";n._valueTracker=ip(n,s,""+n[s])}}function _h(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var c=s.getValue(),g="";return n&&(g=gh(n)?n.checked?"true":"false":n.value),n=g,n!==c?(s.setValue(n),!0):!1}function du(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var yh=/[\n"\\]/g;function Fr(n){return n.replace(yh,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function _c(n,s,c,g,b,E,O,W){n.name="",O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"?n.type=O:n.removeAttribute("type"),s!=null?O==="number"?(s===0&&n.value===""||n.value!=s)&&(n.value=""+Jr(s)):n.value!==""+Jr(s)&&(n.value=""+Jr(s)):O!=="submit"&&O!=="reset"||n.removeAttribute("value"),s!=null?pu(n,O,Jr(s)):c!=null?pu(n,O,Jr(c)):g!=null&&n.removeAttribute("value"),b==null&&E!=null&&(n.defaultChecked=!!E),b!=null&&(n.checked=b&&typeof b!="function"&&typeof b!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?n.name=""+Jr(W):n.removeAttribute("name")}function yc(n,s,c,g,b,E,O,W){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(n.type=E),s!=null||c!=null){if(!(E!=="submit"&&E!=="reset"||s!=null)){gc(n);return}c=c!=null?""+Jr(c):"",s=s!=null?""+Jr(s):c,W||s===n.value||(n.value=s),n.defaultValue=s}g=g??b,g=typeof g!="function"&&typeof g!="symbol"&&!!g,n.checked=W?n.checked:!!g,n.defaultChecked=!!g,O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"&&(n.name=O),gc(n)}function pu(n,s,c){s==="number"&&du(n.ownerDocument)===n||n.defaultValue===""+c||(n.defaultValue=""+c)}function Fo(n,s,c,g){if(n=n.options,s){s={};for(var b=0;b<c.length;b++)s["$"+c[b]]=!0;for(c=0;c<n.length;c++)b=s.hasOwnProperty("$"+n[c].value),n[c].selected!==b&&(n[c].selected=b),b&&g&&(n[c].defaultSelected=!0)}else{for(c=""+Jr(c),s=null,b=0;b<n.length;b++){if(n[b].value===c){n[b].selected=!0,g&&(n[b].defaultSelected=!0);return}s!==null||n[b].disabled||(s=n[b])}s!==null&&(s.selected=!0)}}function Ga(n,s,c){if(s!=null&&(s=""+Jr(s),s!==n.value&&(n.value=s),c==null)){n.defaultValue!==s&&(n.defaultValue=s);return}n.defaultValue=c!=null?""+Jr(c):""}function mu(n,s,c,g){if(s==null){if(g!=null){if(c!=null)throw Error(Z(92));if(Vn(g)){if(1<g.length)throw Error(Z(93));g=g[0]}c=g}c==null&&(c=""),s=c}c=Jr(s),n.defaultValue=c,g=n.textContent,g===c&&g!==""&&g!==null&&(n.value=g),gc(n)}function No(n,s){if(s){var c=n.firstChild;if(c&&c===n.lastChild&&c.nodeType===3){c.nodeValue=s;return}}n.textContent=s}var Za=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function vh(n,s,c){var g=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?g?n.setProperty(s,""):s==="float"?n.cssFloat="":n[s]="":g?n.setProperty(s,c):typeof c!="number"||c===0||Za.has(s)?s==="float"?n.cssFloat=c:n[s]=(""+c).trim():n[s]=c+"px"}function If(n,s,c){if(s!=null&&typeof s!="object")throw Error(Z(62));if(n=n.style,c!=null){for(var g in c)!c.hasOwnProperty(g)||s!=null&&s.hasOwnProperty(g)||(g.indexOf("--")===0?n.setProperty(g,""):g==="float"?n.cssFloat="":n[g]="");for(var b in s)g=s[b],s.hasOwnProperty(b)&&c[b]!==g&&vh(n,b,g)}else for(var E in s)s.hasOwnProperty(E)&&vh(n,E,s[E])}function qa(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Uo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Xe=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Sr(n){return Xe.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function Ne(){}var Ha=null;function cn(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var gn=null,_n=null;function An(n){var s=hr(n);if(s&&(n=s.stateNode)){var c=n[se]||null;t:switch(n=s.stateNode,s.type){case"input":if(_c(n,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=n;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Fr(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var g=c[s];if(g!==n&&g.form===n.form){var b=g[se]||null;if(!b)throw Error(Z(90));_c(g,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<c.length;s++)g=c[s],g.form===n.form&&_h(g)}break t;case"textarea":Ga(n,c.value,c.defaultValue);break t;case"select":s=c.value,s!=null&&Fo(n,!!c.multiple,s,!1)}}}var Ti=!1;function gu(n,s,c){if(Ti)return n(s,c);Ti=!0;try{var g=n(s);return g}finally{if(Ti=!1,(gn!==null||_n!==null)&&(vd(),gn&&(s=gn,n=_n,_n=gn=null,An(s),n)))for(s=0;s<n.length;s++)An(n[s])}}function kn(n,s){var c=n.stateNode;if(c===null)return null;var g=c[se]||null;if(g===null)return null;c=g[s];t:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(n=n.type,g=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!g;break t;default:n=!1}if(n)return null;if(c&&typeof c!="function")throw Error(Z(231,s,typeof c));return c}var hn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zn=!1;if(hn)try{var Il={};Object.defineProperty(Il,"passive",{get:function(){Zn=!0}}),window.addEventListener("test",Il,Il),window.removeEventListener("test",Il,Il)}catch{Zn=!1}var Mr=null,Ri=null,ys=null;function vs(){if(ys)return ys;var n,s=Ri,c=s.length,g,b="value"in Mr?Mr.value:Mr.textContent,E=b.length;for(n=0;n<c&&s[n]===b[n];n++);var O=c-n;for(g=1;g<=O&&s[c-g]===b[E-g];g++);return ys=b.slice(n,1<g?1-g:void 0)}function io(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function Kn(){return!0}function Oi(){return!1}function rn(n){function s(c,g,b,E,O){this._reactName=c,this._targetInst=b,this.type=g,this.nativeEvent=E,this.target=O,this.currentTarget=null;for(var W in n)n.hasOwnProperty(W)&&(c=n[W],this[W]=c?c(E):E[W]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?Kn:Oi,this.isPropagationStopped=Oi,this}return jt(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Kn)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Kn)},persist:function(){},isPersistent:Kn}),s}var Ze={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Be=rn(Ze),Xa=jt({},Ze,{view:0,detail:0}),Qe=rn(Xa),no,ta,xs,$a=jt({},Xa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bc,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==xs&&(xs&&n.type==="mousemove"?(no=n.screenX-xs.screenX,ta=n.screenY-xs.screenY):ta=no=0,xs=n),no)},movementY:function(n){return"movementY"in n?n.movementY:ta}}),_u=rn($a),yu=jt({},$a,{dataTransfer:0}),vu=rn(yu),vc=jt({},Xa,{relatedTarget:0}),ro=rn(vc),Rf=jt({},Ze,{animationName:0,elapsedTime:0,pseudoElement:0}),Ya=rn(Rf),Qn=jt({},Ze,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),xc=rn(Qn),Lf=jt({},Ze,{data:0}),qn=rn(Lf),Cn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wa={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Rl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xh(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=Rl[n])?!!s[n]:!1}function bc(){return xh}var Ta=jt({},Xa,{key:function(n){if(n.key){var s=Cn[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=io(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?wa[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bc,charCode:function(n){return n.type==="keypress"?io(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?io(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),wc=rn(Ta),bh=jt({},$a,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kf=rn(bh),Bf=jt({},Xa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bc}),Tc=rn(Bf),Sc=jt({},Ze,{propertyName:0,elapsedTime:0,pseudoElement:0}),Nr=rn(Sc),Mc=jt({},$a,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),jo=rn(Mc),wh=jt({},Ze,{newState:0,oldState:0}),xu=rn(wh),Wa=[9,13,27,32],Th=hn&&"CompositionEvent"in window,Vo=null;hn&&"documentMode"in document&&(Vo=document.documentMode);var bu=hn&&"TextEvent"in window&&!Vo,bs=hn&&(!Th||Vo&&8<Vo&&11>=Vo),Of=" ",Ll=!1;function Sh(n,s){switch(n){case"keyup":return Wa.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Go(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Zo=!1;function Ff(n,s){switch(n){case"compositionend":return Go(s);case"keypress":return s.which!==32?null:(Ll=!0,Of);case"textInput":return n=s.data,n===Of&&Ll?null:n;default:return null}}function np(n,s){if(Zo)return n==="compositionend"||!Th&&Sh(n,s)?(n=vs(),ys=Ri=Mr=null,Zo=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return bs&&s.locale!=="ko"?null:s.data;default:return null}}var Nf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ec(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!Nf[n.type]:s==="textarea"}function Mh(n,s,c,g){gn?_n?_n.push(g):_n=[g]:gn=g,s=cf(s,"onChange"),0<s.length&&(c=new Be("onChange","change",null,c,g),n.push({event:c,listeners:s}))}var qo=null,Ho=null;function Eh(n){zm(n,0)}function Ka(n){var s=xa(n);if(_h(s))return n}function Ah(n,s){if(n==="change")return s}var Ch=!1;if(hn){var Xo;if(hn){var kl="oninput"in document;if(!kl){var Bl=document.createElement("div");Bl.setAttribute("oninput","return;"),kl=typeof Bl.oninput=="function"}Xo=kl}else Xo=!1;Ch=Xo&&(!document.documentMode||9<document.documentMode)}function Uf(){qo&&(qo.detachEvent("onpropertychange",jf),Ho=qo=null)}function jf(n){if(n.propertyName==="value"&&Ka(Ho)){var s=[];Mh(s,Ho,n,cn(n)),gu(Eh,s)}}function Vf(n,s,c){n==="focusin"?(Uf(),qo=s,Ho=c,qo.attachEvent("onpropertychange",jf)):n==="focusout"&&Uf()}function Ac(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Ka(Ho)}function zh(n,s){if(n==="click")return Ka(s)}function Dh(n,s){if(n==="input"||n==="change")return Ka(s)}function Gf(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var Jn=typeof Object.is=="function"?Object.is:Gf;function Ur(n,s){if(Jn(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var c=Object.keys(n),g=Object.keys(s);if(c.length!==g.length)return!1;for(g=0;g<c.length;g++){var b=c[g];if(!la.call(s,b)||!Jn(n[b],s[b]))return!1}return!0}function Cc(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function zc(n,s){var c=Cc(n);n=0;for(var g;c;){if(c.nodeType===3){if(g=n+c.textContent.length,n<=s&&g>=s)return{node:c,offset:s-n};n=g}t:{for(;c;){if(c.nextSibling){c=c.nextSibling;break t}c=c.parentNode}c=void 0}c=Cc(c)}}function Dc(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?Dc(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function Pc(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var s=du(n.document);s instanceof n.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)n=s.contentWindow;else break;s=du(n.document)}return s}function wu(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}var $o=hn&&"documentMode"in document&&11>=document.documentMode,ao=null,Ph=null,ei=null,Ih=!1;function Zf(n,s,c){var g=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Ih||ao==null||ao!==du(g)||(g=ao,"selectionStart"in g&&wu(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),ei&&Ur(ei,g)||(ei=g,g=cf(Ph,"onSelect"),0<g.length&&(s=new Be("onSelect","select",null,s,c),n.push({event:s,listeners:g}),s.target=ao)))}function so(n,s){var c={};return c[n.toLowerCase()]=s.toLowerCase(),c["Webkit"+n]="webkit"+s,c["Moz"+n]="moz"+s,c}var Ol={animationend:so("Animation","AnimationEnd"),animationiteration:so("Animation","AnimationIteration"),animationstart:so("Animation","AnimationStart"),transitionrun:so("Transition","TransitionRun"),transitionstart:so("Transition","TransitionStart"),transitioncancel:so("Transition","TransitionCancel"),transitionend:so("Transition","TransitionEnd")},Ic={},Tu={};hn&&(Tu=document.createElement("div").style,"AnimationEvent"in window||(delete Ol.animationend.animation,delete Ol.animationiteration.animation,delete Ol.animationstart.animation),"TransitionEvent"in window||delete Ol.transitionend.transition);function Qa(n){if(Ic[n])return Ic[n];if(!Ol[n])return n;var s=Ol[n],c;for(c in s)if(s.hasOwnProperty(c)&&c in Tu)return Ic[n]=s[c];return n}var Su=Qa("animationend"),Rc=Qa("animationiteration"),oo=Qa("animationstart"),Mu=Qa("transitionrun"),Fl=Qa("transitionstart"),ua=Qa("transitioncancel"),Rh=Qa("transitionend"),Lh=new Map,Eu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Eu.push("scrollEnd");function tr(n,s){Lh.set(n,s),Oo(s,[n])}var Yo=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},Er=[],Ja=0,Nl=0;function Au(){for(var n=Ja,s=Nl=Ja=0;s<n;){var c=Er[s];Er[s++]=null;var g=Er[s];Er[s++]=null;var b=Er[s];Er[s++]=null;var E=Er[s];if(Er[s++]=null,g!==null&&b!==null){var O=g.pending;O===null?b.next=b:(b.next=O.next,O.next=b),g.pending=b}E!==0&&Lc(c,b,E)}}function ws(n,s,c,g){Er[Ja++]=n,Er[Ja++]=s,Er[Ja++]=c,Er[Ja++]=g,Nl|=g,n.lanes|=g,n=n.alternate,n!==null&&(n.lanes|=g)}function lo(n,s,c,g){return ws(n,s,c,g),Ve(n)}function uo(n,s){return ws(n,null,null,s),Ve(n)}function Lc(n,s,c){n.lanes|=c;var g=n.alternate;g!==null&&(g.lanes|=c);for(var b=!1,E=n.return;E!==null;)E.childLanes|=c,g=E.alternate,g!==null&&(g.childLanes|=c),E.tag===22&&(n=E.stateNode,n===null||n._visibility&1||(b=!0)),n=E,E=E.return;return n.tag===3?(E=n.stateNode,b&&s!==null&&(b=31-j(c),n=E.hiddenUpdates,g=n[b],g===null?n[b]=[s]:g.push(s),s.lane=c|536870912),E):null}function Ve(n){if(50<Ju)throw Ju=0,_d=null,Error(Z(185));for(var s=n.return;s!==null;)n=s,s=n.return;return n.tag===3?n.stateNode:null}var Ts={};function rp(n,s,c,g){this.tag=n,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jr(n,s,c,g){return new rp(n,s,c,g)}function Wo(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Sa(n,s){var c=n.alternate;return c===null?(c=jr(n.tag,s,n.key,n.mode),c.elementType=n.elementType,c.type=n.type,c.stateNode=n.stateNode,c.alternate=n,n.alternate=c):(c.pendingProps=s,c.type=n.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=n.flags&65011712,c.childLanes=n.childLanes,c.lanes=n.lanes,c.child=n.child,c.memoizedProps=n.memoizedProps,c.memoizedState=n.memoizedState,c.updateQueue=n.updateQueue,s=n.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=n.sibling,c.index=n.index,c.ref=n.ref,c.refCleanup=n.refCleanup,c}function qf(n,s){n.flags&=65011714;var c=n.alternate;return c===null?(n.childLanes=0,n.lanes=s,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=c.childLanes,n.lanes=c.lanes,n.child=c.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=c.memoizedProps,n.memoizedState=c.memoizedState,n.updateQueue=c.updateQueue,n.type=c.type,s=c.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),n}function Cu(n,s,c,g,b,E){var O=0;if(g=n,typeof n=="function")Wo(n)&&(O=1);else if(typeof n=="string")O=lg(n,c,fe.current)?26:n==="html"||n==="head"||n==="body"?27:5;else t:switch(n){case $i:return n=jr(31,c,s,b),n.elementType=$i,n.lanes=E,n;case he:return Ko(c.children,b,E,s);case Ct:O=8,b|=24;break;case Ai:return n=jr(12,c,s,b|2),n.elementType=Ai,n.lanes=E,n;case Ci:return n=jr(13,c,s,b),n.elementType=Ci,n.lanes=E,n;case un:return n=jr(19,c,s,b),n.elementType=un,n.lanes=E,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Ee:O=10;break t;case ti:O=9;break t;case di:O=11;break t;case Re:O=14;break t;case En:O=16,g=null;break t}O=29,c=Error(Z(130,n===null?"null":typeof n,"")),g=null}return s=jr(O,c,s,b),s.elementType=n,s.type=g,s.lanes=E,s}function Ko(n,s,c,g){return n=jr(7,n,g,s),n.lanes=c,n}function Ul(n,s,c){return n=jr(6,n,null,s),n.lanes=c,n}function zu(n){var s=jr(18,null,null,0);return s.stateNode=n,s}function jl(n,s,c){return s=jr(4,n.children!==null?n.children:[],n.key,s),s.lanes=c,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}var co=new WeakMap;function Ar(n,s){if(typeof n=="object"&&n!==null){var c=co.get(n);return c!==void 0?c:(s={value:n,source:s,stack:ya(s)},co.set(n,s),s)}return{value:n,source:s,stack:ya(s)}}var Qo=[],Ss=0,Jo=null,ho=0,er=[],Cr=0,Ms=null,Vr=1,ts="";function Ma(n,s){Qo[Ss++]=ho,Qo[Ss++]=Jo,Jo=n,ho=s}function Vl(n,s,c){er[Cr++]=Vr,er[Cr++]=ts,er[Cr++]=Ms,Ms=n;var g=Vr;n=ts;var b=32-j(g)-1;g&=~(1<<b),c+=1;var E=32-j(s)+b;if(30<E){var O=b-b%5;E=(g&(1<<O)-1).toString(32),g>>=O,b-=O,Vr=1<<32-j(s)+b|c<<b|g,ts=E+n}else Vr=1<<E|c<<b|g,ts=n}function Gl(n){n.return!==null&&(Ma(n,1),Vl(n,1,0))}function kc(n){for(;n===Jo;)Jo=Qo[--Ss],Qo[Ss]=null,ho=Qo[--Ss],Qo[Ss]=null;for(;n===Ms;)Ms=er[--Cr],er[Cr]=null,ts=er[--Cr],er[Cr]=null,Vr=er[--Cr],er[Cr]=null}function kh(n,s){er[Cr++]=Vr,er[Cr++]=ts,er[Cr++]=Ms,Vr=s.id,ts=s.overflow,Ms=n}var zn=null,Fi=null,ii=!1,es=null,ri=!1,Ea=Error(Z(519));function yn(n){var s=Error(Z(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Es(Ar(s,n)),Ea}function Zl(n){var s=n.stateNode,c=n.type,g=n.memoizedProps;switch(s[Ht]=n,s[se]=g,c){case"dialog":Je("cancel",s),Je("close",s);break;case"iframe":case"object":case"embed":Je("load",s);break;case"video":case"audio":for(c=0;c<lf.length;c++)Je(lf[c],s);break;case"source":Je("error",s);break;case"img":case"image":case"link":Je("error",s),Je("load",s);break;case"details":Je("toggle",s);break;case"input":Je("invalid",s),yc(s,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":Je("invalid",s);break;case"textarea":Je("invalid",s),mu(s,g.value,g.defaultValue,g.children)}c=g.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||g.suppressHydrationWarning===!0||Ip(s.textContent,c)?(g.popover!=null&&(Je("beforetoggle",s),Je("toggle",s)),g.onScroll!=null&&Je("scroll",s),g.onScrollEnd!=null&&Je("scrollend",s),g.onClick!=null&&(s.onclick=Ne),s=!0):s=!1,s||yn(n,!0)}function fo(n){for(zn=n.return;zn;)switch(zn.tag){case 5:case 31:case 13:ri=!1;return;case 27:case 3:ri=!0;return;default:zn=zn.return}}function tl(n){if(n!==zn)return!1;if(!ii)return fo(n),ii=!0,!1;var s=n.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=n.type,c=!(c!=="form"&&c!=="button")||ff(n.type,n.memoizedProps)),c=!c),c&&Fi&&yn(n),fo(n),s===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Z(317));Fi=nc(n)}else if(s===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Z(317));Fi=nc(n)}else s===27?(s=Fi,ma(n.type)?(n=ml,ml=null,Fi=n):Fi=s):Fi=zn?Ba(n.stateNode.nextSibling):null;return!0}function ca(){Fi=zn=null,ii=!1}function Du(){var n=es;return n!==null&&(ra===null?ra=n:ra.push.apply(ra,n),es=null),n}function Es(n){es===null?es=[n]:es.push(n)}var Pu=vt(null),po=null,Aa=null;function is(n,s,c){ae(Pu,s._currentValue),s._currentValue=c}function ea(n){n._currentValue=Pu.current,qt(Pu)}function Bc(n,s,c){for(;n!==null;){var g=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,g!==null&&(g.childLanes|=s)):g!==null&&(g.childLanes&s)!==s&&(g.childLanes|=s),n===c)break;n=n.return}}function ns(n,s,c,g){var b=n.child;for(b!==null&&(b.return=n);b!==null;){var E=b.dependencies;if(E!==null){var O=b.child;E=E.firstContext;t:for(;E!==null;){var W=E;E=b;for(var gt=0;gt<s.length;gt++)if(W.context===s[gt]){E.lanes|=c,W=E.alternate,W!==null&&(W.lanes|=c),Bc(E.return,c,n),g||(O=null);break t}E=W.next}}else if(b.tag===18){if(O=b.return,O===null)throw Error(Z(341));O.lanes|=c,E=O.alternate,E!==null&&(E.lanes|=c),Bc(O,c,n),O=null}else O=b.child;if(O!==null)O.return=b;else for(O=b;O!==null;){if(O===n){O=null;break}if(b=O.sibling,b!==null){b.return=O.return,O=b;break}O=O.return}b=O}}function mo(n,s,c,g){n=null;for(var b=s,E=!1;b!==null;){if(!E){if((b.flags&524288)!==0)E=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var O=b.alternate;if(O===null)throw Error(Z(387));if(O=O.memoizedProps,O!==null){var W=b.type;Jn(b.pendingProps.value,O.value)||(n!==null?n.push(W):n=[W])}}else if(b===Ue.current){if(O=b.alternate,O===null)throw Error(Z(387));O.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(n!==null?n.push(bf):n=[bf])}b=b.return}n!==null&&ns(s,n,c,g),s.flags|=262144}function Iu(n){for(n=n.firstContext;n!==null;){if(!Jn(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function As(n){po=n,Aa=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Bn(n){return Bh(po,n)}function Cs(n,s){return po===null&&As(n),Bh(n,s)}function Bh(n,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},Aa===null){if(n===null)throw Error(Z(308));Aa=s,n.dependencies={lanes:0,firstContext:s},n.flags|=524288}else Aa=Aa.next=s;return c}var Hf=typeof AbortController<"u"?AbortController:function(){var n=[],s=this.signal={aborted:!1,addEventListener:function(c,g){n.push(g)}};this.abort=function(){s.aborted=!0,n.forEach(function(c){return c()})}},Xf=V.unstable_scheduleCallback,Oc=V.unstable_NormalPriority,vn={$$typeof:Ee,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Gr(){return{controller:new Hf,data:new Map,refCount:0}}function On(n){n.refCount--,n.refCount===0&&Xf(Oc,function(){n.controller.abort()})}var rs=null,Hi=0,as=0,ha=null;function ap(n,s){if(rs===null){var c=rs=[];Hi=0,as=Cd(),ha={status:"pending",value:void 0,then:function(g){c.push(g)}}}return Hi++,s.then($f,$f),s}function $f(){if(--Hi===0&&rs!==null){ha!==null&&(ha.status="fulfilled");var n=rs;rs=null,as=0,ha=null;for(var s=0;s<n.length;s++)(0,n[s])()}}function Ru(n,s){var c=[],g={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return n.then(function(){g.status="fulfilled",g.value=s;for(var b=0;b<c.length;b++)(0,c[b])(s)},function(b){for(g.status="rejected",g.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),g}var Oh=Nt.S;Nt.S=function(n,s){nf=Ln(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&ap(n,s),Oh!==null&&Oh(n,s)};var ss=vt(null);function el(){var n=ss.current;return n!==null?n:Xi.pooledCache}function Zr(n,s){s===null?ae(ss,ss.current):ae(ss,s.pool)}function le(){var n=el();return n===null?null:{parent:vn._currentValue,pool:n}}var Ca=Error(Z(460)),Lu=Error(Z(474)),ku=Error(Z(542)),go={then:function(){}};function os(n){return n=n.status,n==="fulfilled"||n==="rejected"}function Fc(n,s,c){switch(c=n[c],c===void 0?n.push(s):c!==s&&(s.then(Ne,Ne),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,Uc(n),n;default:if(typeof s.status=="string")s.then(Ne,Ne);else{if(n=Xi,n!==null&&100<n.shellSuspendCounter)throw Error(Z(482));n=s,n.status="pending",n.then(function(g){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=g}},function(g){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=g}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw n=s.reason,Uc(n),n}throw fa=s,Ca}}function il(n){try{var s=n._init;return s(n._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(fa=c,Ca):c}}var fa=null;function Nc(){if(fa===null)throw Error(Z(459));var n=fa;return fa=null,n}function Uc(n){if(n===Ca||n===ku)throw Error(Z(483))}var ls=null,ql=0;function Bu(n){var s=ql;return ql+=1,ls===null&&(ls=[]),Fc(ls,n,s)}function nl(n,s){s=s.props.ref,n.ref=s!==void 0?s:null}function Ou(n,s){throw s.$$typeof===re?Error(Z(525)):(n=Object.prototype.toString.call(s),Error(Z(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n)))}function Fu(n){function s(St,bt){if(n){var Rt=St.deletions;Rt===null?(St.deletions=[bt],St.flags|=16):Rt.push(bt)}}function c(St,bt){if(!n)return null;for(;bt!==null;)s(St,bt),bt=bt.sibling;return null}function g(St){for(var bt=new Map;St!==null;)St.key!==null?bt.set(St.key,St):bt.set(St.index,St),St=St.sibling;return bt}function b(St,bt){return St=Sa(St,bt),St.index=0,St.sibling=null,St}function E(St,bt,Rt){return St.index=Rt,n?(Rt=St.alternate,Rt!==null?(Rt=Rt.index,Rt<bt?(St.flags|=67108866,bt):Rt):(St.flags|=67108866,bt)):(St.flags|=1048576,bt)}function O(St){return n&&St.alternate===null&&(St.flags|=67108866),St}function W(St,bt,Rt,Xt){return bt===null||bt.tag!==6?(bt=Ul(Rt,St.mode,Xt),bt.return=St,bt):(bt=b(bt,Rt),bt.return=St,bt)}function gt(St,bt,Rt,Xt){var Ae=Rt.type;return Ae===he?Vt(St,bt,Rt.props.children,Xt,Rt.key):bt!==null&&(bt.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===En&&il(Ae)===bt.type)?(bt=b(bt,Rt.props),nl(bt,Rt),bt.return=St,bt):(bt=Cu(Rt.type,Rt.key,Rt.props,null,St.mode,Xt),nl(bt,Rt),bt.return=St,bt)}function Lt(St,bt,Rt,Xt){return bt===null||bt.tag!==4||bt.stateNode.containerInfo!==Rt.containerInfo||bt.stateNode.implementation!==Rt.implementation?(bt=jl(Rt,St.mode,Xt),bt.return=St,bt):(bt=b(bt,Rt.children||[]),bt.return=St,bt)}function Vt(St,bt,Rt,Xt,Ae){return bt===null||bt.tag!==7?(bt=Ko(Rt,St.mode,Xt,Ae),bt.return=St,bt):(bt=b(bt,Rt),bt.return=St,bt)}function Yt(St,bt,Rt){if(typeof bt=="string"&&bt!==""||typeof bt=="number"||typeof bt=="bigint")return bt=Ul(""+bt,St.mode,Rt),bt.return=St,bt;if(typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case ve:return Rt=Cu(bt.type,bt.key,bt.props,null,St.mode,Rt),nl(Rt,bt),Rt.return=St,Rt;case Ke:return bt=jl(bt,St.mode,Rt),bt.return=St,bt;case En:return bt=il(bt),Yt(St,bt,Rt)}if(Vn(bt)||Yi(bt))return bt=Ko(bt,St.mode,Rt,null),bt.return=St,bt;if(typeof bt.then=="function")return Yt(St,Bu(bt),Rt);if(bt.$$typeof===Ee)return Yt(St,Cs(St,bt),Rt);Ou(St,bt)}return null}function Bt(St,bt,Rt,Xt){var Ae=bt!==null?bt.key:null;if(typeof Rt=="string"&&Rt!==""||typeof Rt=="number"||typeof Rt=="bigint")return Ae!==null?null:W(St,bt,""+Rt,Xt);if(typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case ve:return Rt.key===Ae?gt(St,bt,Rt,Xt):null;case Ke:return Rt.key===Ae?Lt(St,bt,Rt,Xt):null;case En:return Rt=il(Rt),Bt(St,bt,Rt,Xt)}if(Vn(Rt)||Yi(Rt))return Ae!==null?null:Vt(St,bt,Rt,Xt,null);if(typeof Rt.then=="function")return Bt(St,bt,Bu(Rt),Xt);if(Rt.$$typeof===Ee)return Bt(St,bt,Cs(St,Rt),Xt);Ou(St,Rt)}return null}function Ft(St,bt,Rt,Xt,Ae){if(typeof Xt=="string"&&Xt!==""||typeof Xt=="number"||typeof Xt=="bigint")return St=St.get(Rt)||null,W(bt,St,""+Xt,Ae);if(typeof Xt=="object"&&Xt!==null){switch(Xt.$$typeof){case ve:return St=St.get(Xt.key===null?Rt:Xt.key)||null,gt(bt,St,Xt,Ae);case Ke:return St=St.get(Xt.key===null?Rt:Xt.key)||null,Lt(bt,St,Xt,Ae);case En:return Xt=il(Xt),Ft(St,bt,Rt,Xt,Ae)}if(Vn(Xt)||Yi(Xt))return St=St.get(Rt)||null,Vt(bt,St,Xt,Ae,null);if(typeof Xt.then=="function")return Ft(St,bt,Rt,Bu(Xt),Ae);if(Xt.$$typeof===Ee)return Ft(St,bt,Rt,Cs(bt,Xt),Ae);Ou(bt,Xt)}return null}function ye(St,bt,Rt,Xt){for(var Ae=null,hi=null,Te=bt,He=bt=0,ni=null;Te!==null&&He<Rt.length;He++){Te.index>He?(ni=Te,Te=null):ni=Te.sibling;var xi=Bt(St,Te,Rt[He],Xt);if(xi===null){Te===null&&(Te=ni);break}n&&Te&&xi.alternate===null&&s(St,Te),bt=E(xi,bt,He),hi===null?Ae=xi:hi.sibling=xi,hi=xi,Te=ni}if(He===Rt.length)return c(St,Te),ii&&Ma(St,He),Ae;if(Te===null){for(;He<Rt.length;He++)Te=Yt(St,Rt[He],Xt),Te!==null&&(bt=E(Te,bt,He),hi===null?Ae=Te:hi.sibling=Te,hi=Te);return ii&&Ma(St,He),Ae}for(Te=g(Te);He<Rt.length;He++)ni=Ft(Te,St,He,Rt[He],Xt),ni!==null&&(n&&ni.alternate!==null&&Te.delete(ni.key===null?He:ni.key),bt=E(ni,bt,He),hi===null?Ae=ni:hi.sibling=ni,hi=ni);return n&&Te.forEach(function(r){return s(St,r)}),ii&&Ma(St,He),Ae}function ke(St,bt,Rt,Xt){if(Rt==null)throw Error(Z(151));for(var Ae=null,hi=null,Te=bt,He=bt=0,ni=null,xi=Rt.next();Te!==null&&!xi.done;He++,xi=Rt.next()){Te.index>He?(ni=Te,Te=null):ni=Te.sibling;var r=Bt(St,Te,xi.value,Xt);if(r===null){Te===null&&(Te=ni);break}n&&Te&&r.alternate===null&&s(St,Te),bt=E(r,bt,He),hi===null?Ae=r:hi.sibling=r,hi=r,Te=ni}if(xi.done)return c(St,Te),ii&&Ma(St,He),Ae;if(Te===null){for(;!xi.done;He++,xi=Rt.next())xi=Yt(St,xi.value,Xt),xi!==null&&(bt=E(xi,bt,He),hi===null?Ae=xi:hi.sibling=xi,hi=xi);return ii&&Ma(St,He),Ae}for(Te=g(Te);!xi.done;He++,xi=Rt.next())xi=Ft(Te,St,He,xi.value,Xt),xi!==null&&(n&&xi.alternate!==null&&Te.delete(xi.key===null?He:xi.key),bt=E(xi,bt,He),hi===null?Ae=xi:hi.sibling=xi,hi=xi);return n&&Te.forEach(function(t){return s(St,t)}),ii&&Ma(St,He),Ae}function Ni(St,bt,Rt,Xt){if(typeof Rt=="object"&&Rt!==null&&Rt.type===he&&Rt.key===null&&(Rt=Rt.props.children),typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case ve:t:{for(var Ae=Rt.key;bt!==null;){if(bt.key===Ae){if(Ae=Rt.type,Ae===he){if(bt.tag===7){c(St,bt.sibling),Xt=b(bt,Rt.props.children),Xt.return=St,St=Xt;break t}}else if(bt.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===En&&il(Ae)===bt.type){c(St,bt.sibling),Xt=b(bt,Rt.props),nl(Xt,Rt),Xt.return=St,St=Xt;break t}c(St,bt);break}else s(St,bt);bt=bt.sibling}Rt.type===he?(Xt=Ko(Rt.props.children,St.mode,Xt,Rt.key),Xt.return=St,St=Xt):(Xt=Cu(Rt.type,Rt.key,Rt.props,null,St.mode,Xt),nl(Xt,Rt),Xt.return=St,St=Xt)}return O(St);case Ke:t:{for(Ae=Rt.key;bt!==null;){if(bt.key===Ae)if(bt.tag===4&&bt.stateNode.containerInfo===Rt.containerInfo&&bt.stateNode.implementation===Rt.implementation){c(St,bt.sibling),Xt=b(bt,Rt.children||[]),Xt.return=St,St=Xt;break t}else{c(St,bt);break}else s(St,bt);bt=bt.sibling}Xt=jl(Rt,St.mode,Xt),Xt.return=St,St=Xt}return O(St);case En:return Rt=il(Rt),Ni(St,bt,Rt,Xt)}if(Vn(Rt))return ye(St,bt,Rt,Xt);if(Yi(Rt)){if(Ae=Yi(Rt),typeof Ae!="function")throw Error(Z(150));return Rt=Ae.call(Rt),ke(St,bt,Rt,Xt)}if(typeof Rt.then=="function")return Ni(St,bt,Bu(Rt),Xt);if(Rt.$$typeof===Ee)return Ni(St,bt,Cs(St,Rt),Xt);Ou(St,Rt)}return typeof Rt=="string"&&Rt!==""||typeof Rt=="number"||typeof Rt=="bigint"?(Rt=""+Rt,bt!==null&&bt.tag===6?(c(St,bt.sibling),Xt=b(bt,Rt),Xt.return=St,St=Xt):(c(St,bt),Xt=Ul(Rt,St.mode,Xt),Xt.return=St,St=Xt),O(St)):c(St,bt)}return function(St,bt,Rt,Xt){try{ql=0;var Ae=Ni(St,bt,Rt,Xt);return ls=null,Ae}catch(Te){if(Te===Ca||Te===ku)throw Te;var hi=jr(29,Te,null,St.mode);return hi.lanes=Xt,hi.return=St,hi}finally{}}}var _o=Fu(!0),Yf=Fu(!1),fr=!1;function _i(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function jc(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function za(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Da(n,s,c){var g=n.updateQueue;if(g===null)return null;if(g=g.shared,(mi&2)!==0){var b=g.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),g.pending=s,s=Ve(n),Lc(n,null,c),s}return ws(n,g,s,c),Ve(n)}function rl(n,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var g=s.lanes;g&=n.pendingLanes,c|=g,s.lanes=c,li(n,c)}}function Vc(n,s){var c=n.updateQueue,g=n.alternate;if(g!==null&&(g=g.updateQueue,c===g)){var b=null,E=null;if(c=c.firstBaseUpdate,c!==null){do{var O={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};E===null?b=E=O:E=E.next=O,c=c.next}while(c!==null);E===null?b=E=s:E=E.next=s}else b=E=s;c={baseState:g.baseState,firstBaseUpdate:b,lastBaseUpdate:E,shared:g.shared,callbacks:g.callbacks},n.updateQueue=c;return}n=c.lastBaseUpdate,n===null?c.firstBaseUpdate=s:n.next=s,c.lastBaseUpdate=s}var Gc=!1;function Hl(){if(Gc){var n=ha;if(n!==null)throw n}}function zr(n,s,c,g){Gc=!1;var b=n.updateQueue;fr=!1;var E=b.firstBaseUpdate,O=b.lastBaseUpdate,W=b.shared.pending;if(W!==null){b.shared.pending=null;var gt=W,Lt=gt.next;gt.next=null,O===null?E=Lt:O.next=Lt,O=gt;var Vt=n.alternate;Vt!==null&&(Vt=Vt.updateQueue,W=Vt.lastBaseUpdate,W!==O&&(W===null?Vt.firstBaseUpdate=Lt:W.next=Lt,Vt.lastBaseUpdate=gt))}if(E!==null){var Yt=b.baseState;O=0,Vt=Lt=gt=null,W=E;do{var Bt=W.lane&-536870913,Ft=Bt!==W.lane;if(Ft?(si&Bt)===Bt:(g&Bt)===Bt){Bt!==0&&Bt===as&&(Gc=!0),Vt!==null&&(Vt=Vt.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});t:{var ye=n,ke=W;Bt=s;var Ni=c;switch(ke.tag){case 1:if(ye=ke.payload,typeof ye=="function"){Yt=ye.call(Ni,Yt,Bt);break t}Yt=ye;break t;case 3:ye.flags=ye.flags&-65537|128;case 0:if(ye=ke.payload,Bt=typeof ye=="function"?ye.call(Ni,Yt,Bt):ye,Bt==null)break t;Yt=jt({},Yt,Bt);break t;case 2:fr=!0}}Bt=W.callback,Bt!==null&&(n.flags|=64,Ft&&(n.flags|=8192),Ft=b.callbacks,Ft===null?b.callbacks=[Bt]:Ft.push(Bt))}else Ft={lane:Bt,tag:W.tag,payload:W.payload,callback:W.callback,next:null},Vt===null?(Lt=Vt=Ft,gt=Yt):Vt=Vt.next=Ft,O|=Bt;if(W=W.next,W===null){if(W=b.shared.pending,W===null)break;Ft=W,W=Ft.next,Ft.next=null,b.lastBaseUpdate=Ft,b.shared.pending=null}}while(!0);Vt===null&&(gt=Yt),b.baseState=gt,b.firstBaseUpdate=Lt,b.lastBaseUpdate=Vt,E===null&&(b.shared.lanes=0),tu|=O,n.lanes=O,n.memoizedState=Yt}}function Xl(n,s){if(typeof n!="function")throw Error(Z(191,n));n.call(s)}function pe(n,s){var c=n.callbacks;if(c!==null)for(n.callbacks=null,n=0;n<c.length;n++)Xl(c[n],s)}var _e=vt(null),yo=vt(0);function Nu(n,s){n=cl,ae(yo,n),ae(_e,s),cl=n|s.baseLanes}function $l(){ae(yo,cl),ae(_e,_e.current)}function ir(){cl=yo.current,qt(_e),qt(yo)}var Dr=vt(null),an=null;function us(n){var s=n.alternate;ae(je,je.current&1),ae(Dr,n),an===null&&(s===null||_e.current!==null||s.memoizedState!==null)&&(an=n)}function Fh(n){ae(je,je.current),ae(Dr,n),an===null&&(an=n)}function Wf(n){n.tag===22?(ae(je,je.current),ae(Dr,n),an===null&&(an=n)):vo()}function vo(){ae(je,je.current),ae(Dr,Dr.current)}function nr(n){qt(Dr),an===n&&(an=null),qt(je)}var je=vt(0);function yi(n){for(var s=n;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Tn(c)||oh(c)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var cs=0,Fe=null,pi=null,sn=null,Yl=!1,xo=!1,rr=!1,al=0,zs=0,Ds=null,Uu=0;function Ki(){throw Error(Z(321))}function bo(n,s){if(s===null)return!1;for(var c=0;c<s.length&&c<n.length;c++)if(!Jn(n[c],s[c]))return!1;return!0}function Ps(n,s,c,g,b,E){return cs=E,Fe=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Nt.H=n===null||n.memoizedState===null?So:jh,rr=!1,E=c(g,b),rr=!1,xo&&(E=ju(s,c,g,b)),Zc(n),E}function Zc(n){Nt.H=Wl;var s=pi!==null&&pi.next!==null;if(cs=0,sn=pi=Fe=null,Yl=!1,zs=0,Ds=null,s)throw Error(Z(300));n===null||Fn||(n=n.dependencies,n!==null&&Iu(n)&&(Fn=!0))}function ju(n,s,c,g){Fe=n;var b=0;do{if(xo&&(Ds=null),zs=0,xo=!1,25<=b)throw Error(Z(301));if(b+=1,sn=pi=null,n.updateQueue!=null){var E=n.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}Nt.H=Vh,E=s(c,g)}while(xo);return E}function wo(){var n=Nt.H,s=n.useState()[0];return s=typeof s.then=="function"?a(s):s,n=n.useState()[0],(pi!==null?pi.memoizedState:null)!==n&&(Fe.flags|=1024),s}function Vu(){var n=al!==0;return al=0,n}function Gu(n,s,c){s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~c}function sl(n){if(Yl){for(n=n.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}Yl=!1}cs=0,sn=pi=Fe=null,xo=!1,zs=al=0,Ds=null}function ar(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return sn===null?Fe.memoizedState=sn=n:sn=sn.next=n,sn}function m(){if(pi===null){var n=Fe.alternate;n=n!==null?n.memoizedState:null}else n=pi.next;var s=sn===null?Fe.memoizedState:sn.next;if(s!==null)sn=s,pi=n;else{if(n===null)throw Fe.alternate===null?Error(Z(467)):Error(Z(310));pi=n,n={memoizedState:pi.memoizedState,baseState:pi.baseState,baseQueue:pi.baseQueue,queue:pi.queue,next:null},sn===null?Fe.memoizedState=sn=n:sn=sn.next=n}return sn}function e(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function a(n){var s=zs;return zs+=1,Ds===null&&(Ds=[]),n=Fc(Ds,n,s),s=Fe,(sn===null?s.memoizedState:sn.next)===null&&(s=s.alternate,Nt.H=s===null||s.memoizedState===null?So:jh),n}function u(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return a(n);if(n.$$typeof===Ee)return Bn(n)}throw Error(Z(438,String(n)))}function f(n){var s=null,c=Fe.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var g=Fe.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(s={data:g.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=e(),Fe.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(n),g=0;g<n;g++)c[g]=Yn;return s.index++,c}function _(n,s){return typeof s=="function"?s(n):s}function v(n){var s=m();return T(s,pi,n)}function T(n,s,c){var g=n.queue;if(g===null)throw Error(Z(311));g.lastRenderedReducer=c;var b=n.baseQueue,E=g.pending;if(E!==null){if(b!==null){var O=b.next;b.next=E.next,E.next=O}s.baseQueue=b=E,g.pending=null}if(E=n.baseState,b===null)n.memoizedState=E;else{s=b.next;var W=O=null,gt=null,Lt=s,Vt=!1;do{var Yt=Lt.lane&-536870913;if(Yt!==Lt.lane?(si&Yt)===Yt:(cs&Yt)===Yt){var Bt=Lt.revertLane;if(Bt===0)gt!==null&&(gt=gt.next={lane:0,revertLane:0,gesture:null,action:Lt.action,hasEagerState:Lt.hasEagerState,eagerState:Lt.eagerState,next:null}),Yt===as&&(Vt=!0);else if((cs&Bt)===Bt){Lt=Lt.next,Bt===as&&(Vt=!0);continue}else Yt={lane:0,revertLane:Lt.revertLane,gesture:null,action:Lt.action,hasEagerState:Lt.hasEagerState,eagerState:Lt.eagerState,next:null},gt===null?(W=gt=Yt,O=E):gt=gt.next=Yt,Fe.lanes|=Bt,tu|=Bt;Yt=Lt.action,rr&&c(E,Yt),E=Lt.hasEagerState?Lt.eagerState:c(E,Yt)}else Bt={lane:Yt,revertLane:Lt.revertLane,gesture:Lt.gesture,action:Lt.action,hasEagerState:Lt.hasEagerState,eagerState:Lt.eagerState,next:null},gt===null?(W=gt=Bt,O=E):gt=gt.next=Bt,Fe.lanes|=Yt,tu|=Yt;Lt=Lt.next}while(Lt!==null&&Lt!==s);if(gt===null?O=E:gt.next=W,!Jn(E,n.memoizedState)&&(Fn=!0,Vt&&(c=ha,c!==null)))throw c;n.memoizedState=E,n.baseState=O,n.baseQueue=gt,g.lastRenderedState=E}return b===null&&(g.lanes=0),[n.memoizedState,g.dispatch]}function S(n){var s=m(),c=s.queue;if(c===null)throw Error(Z(311));c.lastRenderedReducer=n;var g=c.dispatch,b=c.pending,E=s.memoizedState;if(b!==null){c.pending=null;var O=b=b.next;do E=n(E,O.action),O=O.next;while(O!==b);Jn(E,s.memoizedState)||(Fn=!0),s.memoizedState=E,s.baseQueue===null&&(s.baseState=E),c.lastRenderedState=E}return[E,g]}function C(n,s,c){var g=Fe,b=m(),E=ii;if(E){if(c===void 0)throw Error(Z(407));c=c()}else c=s();var O=!Jn((pi||b).memoizedState,c);if(O&&(b.memoizedState=c,Fn=!0),b=b.queue,ci(R.bind(null,g,b,n),[n]),b.getSnapshot!==s||O||sn!==null&&sn.memoizedState.tag&1){if(g.flags|=2048,Kt(9,{destroy:void 0},B.bind(null,g,b,c,s),null),Xi===null)throw Error(Z(349));E||(cs&127)!==0||z(g,s,c)}return c}function z(n,s,c){n.flags|=16384,n={getSnapshot:s,value:c},s=Fe.updateQueue,s===null?(s=e(),Fe.updateQueue=s,s.stores=[n]):(c=s.stores,c===null?s.stores=[n]:c.push(n))}function B(n,s,c,g){s.value=c,s.getSnapshot=g,N(s)&&q(n)}function R(n,s,c){return c(function(){N(s)&&q(n)})}function N(n){var s=n.getSnapshot;n=n.value;try{var c=s();return!Jn(n,c)}catch{return!0}}function q(n){var s=uo(n,2);s!==null&&or(s,n,2)}function K(n){var s=ar();if(typeof n=="function"){var c=n;if(n=c(),rr){mt(!0);try{c()}finally{mt(!1)}}}return s.memoizedState=s.baseState=n,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:n},s}function J(n,s,c,g){return n.baseState=c,T(n,pi,typeof g=="function"?g:_)}function et(n,s,c,g,b){if(ki(n))throw Error(Z(485));if(n=s.action,n!==null){var E={payload:b,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(O){E.listeners.push(O)}};Nt.T!==null?c(!0):E.isTransition=!1,g(E),c=s.pending,c===null?(E.next=s.pending=E,at(s,E)):(E.next=c.next,s.pending=c.next=E)}}function at(n,s){var c=s.action,g=s.payload,b=n.state;if(s.isTransition){var E=Nt.T,O={};Nt.T=O;try{var W=c(b,g),gt=Nt.S;gt!==null&&gt(O,W),ct(n,s,W)}catch(Lt){ht(n,s,Lt)}finally{E!==null&&O.types!==null&&(E.types=O.types),Nt.T=E}}else try{E=c(b,g),ct(n,s,E)}catch(Lt){ht(n,s,Lt)}}function ct(n,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(g){rt(n,s,g)},function(g){return ht(n,s,g)}):rt(n,s,c)}function rt(n,s,c){s.status="fulfilled",s.value=c,pt(s),n.state=c,s=n.pending,s!==null&&(c=s.next,c===s?n.pending=null:(c=c.next,s.next=c,at(n,c)))}function ht(n,s,c){var g=n.pending;if(n.pending=null,g!==null){g=g.next;do s.status="rejected",s.reason=c,pt(s),s=s.next;while(s!==g)}n.action=null}function pt(n){n=n.listeners;for(var s=0;s<n.length;s++)(0,n[s])()}function lt(n,s){return s}function xt(n,s){if(ii){var c=Xi.formState;if(c!==null){t:{var g=Fe;if(ii){if(Fi){e:{for(var b=Fi,E=ri;b.nodeType!==8;){if(!E){b=null;break e}if(b=Ba(b.nextSibling),b===null){b=null;break e}}E=b.data,b=E==="F!"||E==="F"?b:null}if(b){Fi=Ba(b.nextSibling),g=b.data==="F!";break t}}yn(g)}g=!1}g&&(s=c[0])}}return c=ar(),c.memoizedState=c.baseState=s,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:lt,lastRenderedState:s},c.queue=g,c=Vi.bind(null,Fe,g),g.dispatch=c,g=K(!1),E=Qi.bind(null,Fe,!1,g.queue),g=ar(),b={state:s,dispatch:null,action:n,pending:null},g.queue=b,c=et.bind(null,Fe,b,E,c),b.dispatch=c,g.memoizedState=n,[s,c,!1]}function Dt(n){var s=m();return Mt(s,pi,n)}function Mt(n,s,c){if(s=T(n,s,lt)[0],n=v(_)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var g=a(s)}catch(O){throw O===Ca?ku:O}else g=s;s=m();var b=s.queue,E=b.dispatch;return c!==s.memoizedState&&(Fe.flags|=2048,Kt(9,{destroy:void 0},Et.bind(null,b,c),null)),[g,E,n]}function Et(n,s){n.action=s}function Pt(n){var s=m(),c=pi;if(c!==null)return Mt(s,c,n);m(),s=s.memoizedState,c=m();var g=c.queue.dispatch;return c.memoizedState=n,[s,g,!1]}function Kt(n,s,c,g){return n={tag:n,create:c,deps:g,inst:s,next:null},s=Fe.updateQueue,s===null&&(s=e(),Fe.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=n.next=n:(g=c.next,c.next=n,n.next=g,s.lastEffect=n),n}function Jt(){return m().memoizedState}function Gt(n,s,c,g){var b=ar();Fe.flags|=n,b.memoizedState=Kt(1|s,{destroy:void 0},c,g===void 0?null:g)}function ce(n,s,c,g){var b=m();g=g===void 0?null:g;var E=b.memoizedState.inst;pi!==null&&g!==null&&bo(g,pi.memoizedState.deps)?b.memoizedState=Kt(s,E,c,g):(Fe.flags|=n,b.memoizedState=Kt(1|s,E,c,g))}function me(n,s){Gt(8390656,8,n,s)}function ci(n,s){ce(2048,8,n,s)}function Ui(n){Fe.flags|=4;var s=Fe.updateQueue;if(s===null)s=e(),Fe.updateQueue=s,s.events=[n];else{var c=s.events;c===null?s.events=[n]:c.push(n)}}function Li(n){var s=m().memoizedState;return Ui({ref:s,nextImpl:n}),function(){if((mi&2)!==0)throw Error(Z(440));return s.impl.apply(void 0,arguments)}}function ji(n,s){return ce(4,2,n,s)}function Si(n,s){return ce(4,4,n,s)}function xn(n,s){if(typeof s=="function"){n=n();var c=s(n);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function Mi(n,s,c){c=c!=null?c.concat([n]):null,ce(4,4,xn.bind(null,s,n),c)}function Dn(){}function on(n,s){var c=m();s=s===void 0?null:s;var g=c.memoizedState;return s!==null&&bo(s,g[1])?g[0]:(c.memoizedState=[n,s],n)}function bn(n,s){var c=m();s=s===void 0?null:s;var g=c.memoizedState;if(s!==null&&bo(s,g[1]))return g[0];if(g=n(),rr){mt(!0);try{n()}finally{mt(!1)}}return c.memoizedState=[g,s],g}function Hn(n,s,c){return c===void 0||(cs&1073741824)!==0&&(si&261930)===0?n.memoizedState=s:(n.memoizedState=c,n=yd(),Fe.lanes|=n,tu|=n,c)}function Pa(n,s,c,g){return Jn(c,s)?c:_e.current!==null?(n=Hn(n,c,g),Jn(n,s)||(Fn=!0),n):(cs&42)===0||(cs&1073741824)!==0&&(si&261930)===0?(Fn=!0,n.memoizedState=c):(n=yd(),Fe.lanes|=n,tu|=n,s)}function Is(n,s,c,g,b){var E=ne.p;ne.p=E!==0&&8>E?E:8;var O=Nt.T,W={};Nt.T=W,Qi(n,!1,s,c);try{var gt=b(),Lt=Nt.S;if(Lt!==null&&Lt(W,gt),gt!==null&&typeof gt=="object"&&typeof gt.then=="function"){var Vt=Ru(gt,g);vi(n,s,Vt,pa(n))}else vi(n,s,g,pa(n))}catch(Yt){vi(n,s,{then:function(){},status:"rejected",reason:Yt},pa())}finally{ne.p=E,O!==null&&W.types!==null&&(O.types=W.types),Nt.T=O}}function Rs(){}function Ia(n,s,c,g){if(n.tag!==5)throw Error(Z(476));var b=ia(n).queue;Is(n,b,s,Pe,c===null?Rs:function(){return To(n),c(g)})}function ia(n){var s=n.memoizedState;if(s!==null)return s;s={memoizedState:Pe,baseState:Pe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:Pe},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:c},next:null},n.memoizedState=s,n=n.alternate,n!==null&&(n.memoizedState=s),s}function To(n){var s=ia(n);s.next===null&&(s=n.alternate.memoizedState),vi(n,s.next.queue,{},pa())}function Ls(){return Bn(bf)}function qr(){return m().memoizedState}function ks(){return m().memoizedState}function Bs(n){for(var s=n.return;s!==null;){switch(s.tag){case 24:case 3:var c=pa();n=za(c);var g=Da(s,n,c);g!==null&&(or(g,s,c),rl(g,s,c)),s={cache:Gr()},n.payload=s;return}s=s.return}}function Os(n,s,c){var g=pa();c={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},ki(n)?Nh(s,c):(c=lo(n,s,c,g),c!==null&&(or(c,n,g),Uh(c,s,g)))}function Vi(n,s,c){var g=pa();vi(n,s,c,g)}function vi(n,s,c,g){var b={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(ki(n))Nh(s,b);else{var E=n.alternate;if(n.lanes===0&&(E===null||E.lanes===0)&&(E=s.lastRenderedReducer,E!==null))try{var O=s.lastRenderedState,W=E(O,c);if(b.hasEagerState=!0,b.eagerState=W,Jn(W,O))return ws(n,s,b,0),Xi===null&&Au(),!1}catch{}finally{}if(c=lo(n,s,b,g),c!==null)return or(c,n,g),Uh(c,s,g),!0}return!1}function Qi(n,s,c,g){if(g={lane:2,revertLane:Cd(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},ki(n)){if(s)throw Error(Z(479))}else s=lo(n,c,g,2),s!==null&&or(s,n,2)}function ki(n){var s=n.alternate;return n===Fe||s!==null&&s===Fe}function Nh(n,s){xo=Yl=!0;var c=n.pending;c===null?s.next=s:(s.next=c.next,c.next=s),n.pending=s}function Uh(n,s,c){if((c&4194048)!==0){var g=s.lanes;g&=n.pendingLanes,c|=g,s.lanes=c,li(n,c)}}var Wl={readContext:Bn,use:u,useCallback:Ki,useContext:Ki,useEffect:Ki,useImperativeHandle:Ki,useLayoutEffect:Ki,useInsertionEffect:Ki,useMemo:Ki,useReducer:Ki,useRef:Ki,useState:Ki,useDebugValue:Ki,useDeferredValue:Ki,useTransition:Ki,useSyncExternalStore:Ki,useId:Ki,useHostTransitionStatus:Ki,useFormState:Ki,useActionState:Ki,useOptimistic:Ki,useMemoCache:Ki,useCacheRefresh:Ki};Wl.useEffectEvent=Ki;var So={readContext:Bn,use:u,useCallback:function(n,s){return ar().memoizedState=[n,s===void 0?null:s],n},useContext:Bn,useEffect:me,useImperativeHandle:function(n,s,c){c=c!=null?c.concat([n]):null,Gt(4194308,4,xn.bind(null,s,n),c)},useLayoutEffect:function(n,s){return Gt(4194308,4,n,s)},useInsertionEffect:function(n,s){Gt(4,2,n,s)},useMemo:function(n,s){var c=ar();s=s===void 0?null:s;var g=n();if(rr){mt(!0);try{n()}finally{mt(!1)}}return c.memoizedState=[g,s],g},useReducer:function(n,s,c){var g=ar();if(c!==void 0){var b=c(s);if(rr){mt(!0);try{c(s)}finally{mt(!1)}}}else b=s;return g.memoizedState=g.baseState=b,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:b},g.queue=n,n=n.dispatch=Os.bind(null,Fe,n),[g.memoizedState,n]},useRef:function(n){var s=ar();return n={current:n},s.memoizedState=n},useState:function(n){n=K(n);var s=n.queue,c=Vi.bind(null,Fe,s);return s.dispatch=c,[n.memoizedState,c]},useDebugValue:Dn,useDeferredValue:function(n,s){var c=ar();return Hn(c,n,s)},useTransition:function(){var n=K(!1);return n=Is.bind(null,Fe,n.queue,!0,!1),ar().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,s,c){var g=Fe,b=ar();if(ii){if(c===void 0)throw Error(Z(407));c=c()}else{if(c=s(),Xi===null)throw Error(Z(349));(si&127)!==0||z(g,s,c)}b.memoizedState=c;var E={value:c,getSnapshot:s};return b.queue=E,me(R.bind(null,g,E,n),[n]),g.flags|=2048,Kt(9,{destroy:void 0},B.bind(null,g,E,c,s),null),c},useId:function(){var n=ar(),s=Xi.identifierPrefix;if(ii){var c=ts,g=Vr;c=(g&~(1<<32-j(g)-1)).toString(32)+c,s="_"+s+"R_"+c,c=al++,0<c&&(s+="H"+c.toString(32)),s+="_"}else c=Uu++,s="_"+s+"r_"+c.toString(32)+"_";return n.memoizedState=s},useHostTransitionStatus:Ls,useFormState:xt,useActionState:xt,useOptimistic:function(n){var s=ar();s.memoizedState=s.baseState=n;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=Qi.bind(null,Fe,!0,c),c.dispatch=s,[n,s]},useMemoCache:f,useCacheRefresh:function(){return ar().memoizedState=Bs.bind(null,Fe)},useEffectEvent:function(n){var s=ar(),c={impl:n};return s.memoizedState=c,function(){if((mi&2)!==0)throw Error(Z(440));return c.impl.apply(void 0,arguments)}}},jh={readContext:Bn,use:u,useCallback:on,useContext:Bn,useEffect:ci,useImperativeHandle:Mi,useInsertionEffect:ji,useLayoutEffect:Si,useMemo:bn,useReducer:v,useRef:Jt,useState:function(){return v(_)},useDebugValue:Dn,useDeferredValue:function(n,s){var c=m();return Pa(c,pi.memoizedState,n,s)},useTransition:function(){var n=v(_)[0],s=m().memoizedState;return[typeof n=="boolean"?n:a(n),s]},useSyncExternalStore:C,useId:qr,useHostTransitionStatus:Ls,useFormState:Dt,useActionState:Dt,useOptimistic:function(n,s){var c=m();return J(c,pi,n,s)},useMemoCache:f,useCacheRefresh:ks};jh.useEffectEvent=Li;var Vh={readContext:Bn,use:u,useCallback:on,useContext:Bn,useEffect:ci,useImperativeHandle:Mi,useInsertionEffect:ji,useLayoutEffect:Si,useMemo:bn,useReducer:S,useRef:Jt,useState:function(){return S(_)},useDebugValue:Dn,useDeferredValue:function(n,s){var c=m();return pi===null?Hn(c,n,s):Pa(c,pi.memoizedState,n,s)},useTransition:function(){var n=S(_)[0],s=m().memoizedState;return[typeof n=="boolean"?n:a(n),s]},useSyncExternalStore:C,useId:qr,useHostTransitionStatus:Ls,useFormState:Pt,useActionState:Pt,useOptimistic:function(n,s){var c=m();return pi!==null?J(c,pi,n,s):(c.baseState=n,[n,c.queue.dispatch])},useMemoCache:f,useCacheRefresh:ks};Vh.useEffectEvent=Li;function Ra(n,s,c,g){s=n.memoizedState,c=c(g,s),c=c==null?s:jt({},s,c),n.memoizedState=c,n.lanes===0&&(n.updateQueue.baseState=c)}var Zu={enqueueSetState:function(n,s,c){n=n._reactInternals;var g=pa(),b=za(g);b.payload=s,c!=null&&(b.callback=c),s=Da(n,b,g),s!==null&&(or(s,n,g),rl(s,n,g))},enqueueReplaceState:function(n,s,c){n=n._reactInternals;var g=pa(),b=za(g);b.tag=1,b.payload=s,c!=null&&(b.callback=c),s=Da(n,b,g),s!==null&&(or(s,n,g),rl(s,n,g))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var c=pa(),g=za(c);g.tag=2,s!=null&&(g.callback=s),s=Da(n,g,c),s!==null&&(or(s,n,c),rl(s,n,c))}};function Fs(n,s,c,g,b,E,O){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(g,E,O):s.prototype&&s.prototype.isPureReactComponent?!Ur(c,g)||!Ur(b,E):!0}function Ns(n,s,c,g){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,g),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,g),s.state!==n&&Zu.enqueueReplaceState(s,s.state,null)}function hs(n,s){var c=s;if("ref"in s){c={};for(var g in s)g!=="ref"&&(c[g]=s[g])}if(n=n.defaultProps){c===s&&(c=jt({},c));for(var b in n)c[b]===void 0&&(c[b]=n[b])}return c}function Gh(n){Yo(n)}function Kl(n){console.error(n)}function sp(n){Yo(n)}function qu(n,s){try{var c=n.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(g){setTimeout(function(){throw g})}}function op(n,s,c){try{var g=n.onCaughtError;g(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function lp(n,s,c){return c=za(c),c.tag=3,c.payload={element:null},c.callback=function(){qu(n,s)},c}function Kf(n){return n=za(n),n.tag=3,n}function Kp(n,s,c,g){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var E=g.value;n.payload=function(){return b(E)},n.callback=function(){op(s,c,g)}}var O=c.stateNode;O!==null&&typeof O.componentDidCatch=="function"&&(n.callback=function(){op(s,c,g),typeof b!="function"&&(iu===null?iu=new Set([this]):iu.add(this));var W=g.stack;this.componentDidCatch(g.value,{componentStack:W!==null?W:""})})}function up(n,s,c,g,b){if(c.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(s=c.alternate,s!==null&&mo(s,c,b,!0),c=Dr.current,c!==null){switch(c.tag){case 31:case 13:return an===null?xd():c.alternate===null&&In===0&&(In=3),c.flags&=-257,c.flags|=65536,c.lanes=b,g===go?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([g]):s.add(g),Cp(n,g,b)),!1;case 22:return c.flags|=65536,g===go?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([g])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([g]):c.add(g)),Cp(n,g,b)),!1}throw Error(Z(435,c.tag))}return Cp(n,g,b),xd(),!1}if(ii)return s=Dr.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,g!==Ea&&(n=Error(Z(422),{cause:g}),Es(Ar(n,c)))):(g!==Ea&&(s=Error(Z(423),{cause:g}),Es(Ar(s,c))),n=n.current.alternate,n.flags|=65536,b&=-b,n.lanes|=b,g=Ar(g,c),b=lp(n.stateNode,g,b),Vc(n,b),In!==4&&(In=2)),!1;var E=Error(Z(520),{cause:g});if(E=Ar(E,c),Jc===null?Jc=[E]:Jc.push(E),In!==4&&(In=2),s===null)return!0;g=Ar(g,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,n=b&-b,c.lanes|=n,n=lp(c.stateNode,g,n),Vc(c,n),!1;case 1:if(s=c.type,E=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(iu===null||!iu.has(E))))return c.flags|=65536,b&=-b,c.lanes|=b,b=Kf(b),Kp(b,n,c,g),Vc(c,b),!1}c=c.return}while(c!==null);return!1}var Qf=Error(Z(461)),Fn=!1;function Pn(n,s,c,g){s.child=n===null?Yf(s,null,c,g):_o(s,n.child,c,g)}function Qp(n,s,c,g,b){c=c.render;var E=s.ref;if("ref"in g){var O={};for(var W in g)W!=="ref"&&(O[W]=g[W])}else O=g;return As(s),g=Ps(n,s,c,O,E,b),W=Vu(),n!==null&&!Fn?(Gu(n,s,b),ol(n,s,b)):(ii&&W&&Gl(s),s.flags|=1,Pn(n,s,g,b),s.child)}function Hu(n,s,c,g,b){if(n===null){var E=c.type;return typeof E=="function"&&!Wo(E)&&E.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=E,Zh(n,s,E,g,b)):(n=Cu(c.type,null,g,s,s.mode,b),n.ref=s.ref,n.return=s,s.child=n)}if(E=n.child,!od(n,b)){var O=E.memoizedProps;if(c=c.compare,c=c!==null?c:Ur,c(O,g)&&n.ref===s.ref)return ol(n,s,b)}return s.flags|=1,n=Sa(E,g),n.ref=s.ref,n.return=s,s.child=n}function Zh(n,s,c,g,b){if(n!==null){var E=n.memoizedProps;if(Ur(E,g)&&n.ref===s.ref)if(Fn=!1,s.pendingProps=g=E,od(n,b))(n.flags&131072)!==0&&(Fn=!0);else return s.lanes=n.lanes,ol(n,s,b)}return td(n,s,c,g,b)}function qh(n,s,c,g){var b=g.children,E=n!==null?n.memoizedState:null;if(n===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((s.flags&128)!==0){if(E=E!==null?E.baseLanes|c:c,n!==null){for(g=s.child=n.child,b=0;g!==null;)b=b|g.lanes|g.childLanes,g=g.sibling;g=b&~E}else g=0,s.child=null;return Jp(n,s,E,c,g)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},n!==null&&Zr(s,E!==null?E.cachePool:null),E!==null?Nu(s,E):$l(),Wf(s);else return g=s.lanes=536870912,Jp(n,s,E!==null?E.baseLanes|c:c,c,g)}else E!==null?(Zr(s,E.cachePool),Nu(s,E),vo(),s.memoizedState=null):(n!==null&&Zr(s,null),$l(),vo());return Pn(n,s,b,c),s.child}function Hh(n,s){return n!==null&&n.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Jp(n,s,c,g,b){var E=el();return E=E===null?null:{parent:vn._currentValue,pool:E},s.memoizedState={baseLanes:c,cachePool:E},n!==null&&Zr(s,null),$l(),Wf(s),n!==null&&mo(n,s,g,!0),s.childLanes=b,null}function Jf(n,s){return s=Hc({mode:s.mode,children:s.children},n.mode),s.ref=n.ref,n.child=s,s.return=n,s}function tm(n,s,c){return _o(s,n.child,null,c),n=Jf(s,s.pendingProps),n.flags|=2,nr(s),s.memoizedState=null,n}function em(n,s,c){var g=s.pendingProps,b=(s.flags&128)!==0;if(s.flags&=-129,n===null){if(ii){if(g.mode==="hidden")return n=Jf(s,g),s.lanes=536870912,Hh(null,n);if(Fh(s),(n=Fi)?(n=Bd(n,ri),n=n!==null&&n.data==="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:Ms!==null?{id:Vr,overflow:ts}:null,retryLane:536870912,hydrationErrors:null},c=zu(n),c.return=s,s.child=c,zn=s,Fi=null)):n=null,n===null)throw yn(s);return s.lanes=536870912,null}return Jf(s,g)}var E=n.memoizedState;if(E!==null){var O=E.dehydrated;if(Fh(s),b)if(s.flags&256)s.flags&=-257,s=tm(n,s,c);else if(s.memoizedState!==null)s.child=n.child,s.flags|=128,s=null;else throw Error(Z(558));else if(Fn||mo(n,s,c,!1),b=(c&n.childLanes)!==0,Fn||b){if(g=Xi,g!==null&&(O=zi(g,c),O!==0&&O!==E.retryLane))throw E.retryLane=O,uo(n,O),or(g,n,O),Qf;xd(),s=tm(n,s,c)}else n=E.treeContext,Fi=Ba(O.nextSibling),zn=s,ii=!0,es=null,ri=!1,n!==null&&kh(s,n),s=Jf(s,g),s.flags|=4096;return s}return n=Sa(n.child,{mode:g.mode,children:g.children}),n.ref=s.ref,s.child=n,n.return=s,n}function qc(n,s){var c=s.ref;if(c===null)n!==null&&n.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(Z(284));(n===null||n.ref!==c)&&(s.flags|=4194816)}}function td(n,s,c,g,b){return As(s),c=Ps(n,s,c,g,void 0,b),g=Vu(),n!==null&&!Fn?(Gu(n,s,b),ol(n,s,b)):(ii&&g&&Gl(s),s.flags|=1,Pn(n,s,c,b),s.child)}function cp(n,s,c,g,b,E){return As(s),s.updateQueue=null,c=ju(s,g,c,b),Zc(n),g=Vu(),n!==null&&!Fn?(Gu(n,s,E),ol(n,s,E)):(ii&&g&&Gl(s),s.flags|=1,Pn(n,s,c,E),s.child)}function im(n,s,c,g,b){if(As(s),s.stateNode===null){var E=Ts,O=c.contextType;typeof O=="object"&&O!==null&&(E=Bn(O)),E=new c(g,E),s.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=Zu,s.stateNode=E,E._reactInternals=s,E=s.stateNode,E.props=g,E.state=s.memoizedState,E.refs={},_i(s),O=c.contextType,E.context=typeof O=="object"&&O!==null?Bn(O):Ts,E.state=s.memoizedState,O=c.getDerivedStateFromProps,typeof O=="function"&&(Ra(s,c,O,g),E.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(O=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),O!==E.state&&Zu.enqueueReplaceState(E,E.state,null),zr(s,g,E,b),Hl(),E.state=s.memoizedState),typeof E.componentDidMount=="function"&&(s.flags|=4194308),g=!0}else if(n===null){E=s.stateNode;var W=s.memoizedProps,gt=hs(c,W);E.props=gt;var Lt=E.context,Vt=c.contextType;O=Ts,typeof Vt=="object"&&Vt!==null&&(O=Bn(Vt));var Yt=c.getDerivedStateFromProps;Vt=typeof Yt=="function"||typeof E.getSnapshotBeforeUpdate=="function",W=s.pendingProps!==W,Vt||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(W||Lt!==O)&&Ns(s,E,g,O),fr=!1;var Bt=s.memoizedState;E.state=Bt,zr(s,g,E,b),Hl(),Lt=s.memoizedState,W||Bt!==Lt||fr?(typeof Yt=="function"&&(Ra(s,c,Yt,g),Lt=s.memoizedState),(gt=fr||Fs(s,c,gt,g,Bt,Lt,O))?(Vt||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(s.flags|=4194308)):(typeof E.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=g,s.memoizedState=Lt),E.props=g,E.state=Lt,E.context=O,g=gt):(typeof E.componentDidMount=="function"&&(s.flags|=4194308),g=!1)}else{E=s.stateNode,jc(n,s),O=s.memoizedProps,Vt=hs(c,O),E.props=Vt,Yt=s.pendingProps,Bt=E.context,Lt=c.contextType,gt=Ts,typeof Lt=="object"&&Lt!==null&&(gt=Bn(Lt)),W=c.getDerivedStateFromProps,(Lt=typeof W=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(O!==Yt||Bt!==gt)&&Ns(s,E,g,gt),fr=!1,Bt=s.memoizedState,E.state=Bt,zr(s,g,E,b),Hl();var Ft=s.memoizedState;O!==Yt||Bt!==Ft||fr||n!==null&&n.dependencies!==null&&Iu(n.dependencies)?(typeof W=="function"&&(Ra(s,c,W,g),Ft=s.memoizedState),(Vt=fr||Fs(s,c,Vt,g,Bt,Ft,gt)||n!==null&&n.dependencies!==null&&Iu(n.dependencies))?(Lt||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(g,Ft,gt),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(g,Ft,gt)),typeof E.componentDidUpdate=="function"&&(s.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof E.componentDidUpdate!="function"||O===n.memoizedProps&&Bt===n.memoizedState||(s.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||O===n.memoizedProps&&Bt===n.memoizedState||(s.flags|=1024),s.memoizedProps=g,s.memoizedState=Ft),E.props=g,E.state=Ft,E.context=gt,g=Vt):(typeof E.componentDidUpdate!="function"||O===n.memoizedProps&&Bt===n.memoizedState||(s.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||O===n.memoizedProps&&Bt===n.memoizedState||(s.flags|=1024),g=!1)}return E=g,qc(n,s),g=(s.flags&128)!==0,E||g?(E=s.stateNode,c=g&&typeof c.getDerivedStateFromError!="function"?null:E.render(),s.flags|=1,n!==null&&g?(s.child=_o(s,n.child,null,b),s.child=_o(s,null,c,b)):Pn(n,s,c,b),s.memoizedState=E.state,n=s.child):n=ol(n,s,b),n}function nm(n,s,c,g){return ca(),s.flags|=256,Pn(n,s,c,g),s.child}var ed={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function id(n){return{baseLanes:n,cachePool:le()}}function hp(n,s,c){return n=n!==null?n.childLanes&~c:0,s&&(n|=da),n}function nd(n,s,c){var g=s.pendingProps,b=!1,E=(s.flags&128)!==0,O;if((O=E)||(O=n!==null&&n.memoizedState===null?!1:(je.current&2)!==0),O&&(b=!0,s.flags&=-129),O=(s.flags&32)!==0,s.flags&=-33,n===null){if(ii){if(b?us(s):vo(),(n=Fi)?(n=Bd(n,ri),n=n!==null&&n.data!=="&"?n:null,n!==null&&(s.memoizedState={dehydrated:n,treeContext:Ms!==null?{id:Vr,overflow:ts}:null,retryLane:536870912,hydrationErrors:null},c=zu(n),c.return=s,s.child=c,zn=s,Fi=null)):n=null,n===null)throw yn(s);return oh(n)?s.lanes=32:s.lanes=536870912,null}var W=g.children;return g=g.fallback,b?(vo(),b=s.mode,W=Hc({mode:"hidden",children:W},b),g=Ko(g,b,c,null),W.return=s,g.return=s,W.sibling=g,s.child=W,g=s.child,g.memoizedState=id(c),g.childLanes=hp(n,O,c),s.memoizedState=ed,Hh(null,g)):(us(s),rd(s,W))}var gt=n.memoizedState;if(gt!==null&&(W=gt.dehydrated,W!==null)){if(E)s.flags&256?(us(s),s.flags&=-257,s=Xu(n,s,c)):s.memoizedState!==null?(vo(),s.child=n.child,s.flags|=128,s=null):(vo(),W=g.fallback,b=s.mode,g=Hc({mode:"visible",children:g.children},b),W=Ko(W,b,c,null),W.flags|=2,g.return=s,W.return=s,g.sibling=W,s.child=g,_o(s,n.child,null,c),g=s.child,g.memoizedState=id(c),g.childLanes=hp(n,O,c),s.memoizedState=ed,s=Hh(null,g));else if(us(s),oh(W)){if(O=W.nextSibling&&W.nextSibling.dataset,O)var Lt=O.dgst;O=Lt,g=Error(Z(419)),g.stack="",g.digest=O,Es({value:g,source:null,stack:null}),s=Xu(n,s,c)}else if(Fn||mo(n,s,c,!1),O=(c&n.childLanes)!==0,Fn||O){if(O=Xi,O!==null&&(g=zi(O,c),g!==0&&g!==gt.retryLane))throw gt.retryLane=g,uo(n,g),or(O,n,g),Qf;Tn(W)||xd(),s=Xu(n,s,c)}else Tn(W)?(s.flags|=192,s.child=n.child,s=null):(n=gt.treeContext,Fi=Ba(W.nextSibling),zn=s,ii=!0,es=null,ri=!1,n!==null&&kh(s,n),s=rd(s,g.children),s.flags|=4096);return s}return b?(vo(),W=g.fallback,b=s.mode,gt=n.child,Lt=gt.sibling,g=Sa(gt,{mode:"hidden",children:g.children}),g.subtreeFlags=gt.subtreeFlags&65011712,Lt!==null?W=Sa(Lt,W):(W=Ko(W,b,c,null),W.flags|=2),W.return=s,g.return=s,g.sibling=W,s.child=g,Hh(null,g),g=s.child,W=n.child.memoizedState,W===null?W=id(c):(b=W.cachePool,b!==null?(gt=vn._currentValue,b=b.parent!==gt?{parent:gt,pool:gt}:b):b=le(),W={baseLanes:W.baseLanes|c,cachePool:b}),g.memoizedState=W,g.childLanes=hp(n,O,c),s.memoizedState=ed,Hh(n.child,g)):(us(s),c=n.child,n=c.sibling,c=Sa(c,{mode:"visible",children:g.children}),c.return=s,c.sibling=null,n!==null&&(O=s.deletions,O===null?(s.deletions=[n],s.flags|=16):O.push(n)),s.child=c,s.memoizedState=null,c)}function rd(n,s){return s=Hc({mode:"visible",children:s},n.mode),s.return=n,n.child=s}function Hc(n,s){return n=jr(22,n,null,s),n.lanes=0,n}function Xu(n,s,c){return _o(s,n.child,null,c),n=rd(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function Hr(n,s,c){n.lanes|=s;var g=n.alternate;g!==null&&(g.lanes|=s),Bc(n.return,s,c)}function ad(n,s,c,g,b,E){var O=n.memoizedState;O===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:g,tail:c,tailMode:b,treeForkCount:E}:(O.isBackwards=s,O.rendering=null,O.renderingStartTime=0,O.last=g,O.tail=c,O.tailMode=b,O.treeForkCount=E)}function sd(n,s,c){var g=s.pendingProps,b=g.revealOrder,E=g.tail;g=g.children;var O=je.current,W=(O&2)!==0;if(W?(O=O&1|2,s.flags|=128):O&=1,ae(je,O),Pn(n,s,g,c),g=ii?ho:0,!W&&n!==null&&(n.flags&128)!==0)t:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Hr(n,c,s);else if(n.tag===19)Hr(n,c,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break t;for(;n.sibling===null;){if(n.return===null||n.return===s)break t;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(b){case"forwards":for(c=s.child,b=null;c!==null;)n=c.alternate,n!==null&&yi(n)===null&&(b=c),c=c.sibling;c=b,c===null?(b=s.child,s.child=null):(b=c.sibling,c.sibling=null),ad(s,!1,b,c,E,g);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=s.child,s.child=null;b!==null;){if(n=b.alternate,n!==null&&yi(n)===null){s.child=b;break}n=b.sibling,b.sibling=c,c=b,b=n}ad(s,!0,c,null,E,g);break;case"together":ad(s,!1,null,null,void 0,g);break;default:s.memoizedState=null}return s.child}function ol(n,s,c){if(n!==null&&(s.dependencies=n.dependencies),tu|=s.lanes,(c&s.childLanes)===0)if(n!==null){if(mo(n,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(n!==null&&s.child!==n.child)throw Error(Z(153));if(s.child!==null){for(n=s.child,c=Sa(n,n.pendingProps),s.child=c,c.return=s;n.sibling!==null;)n=n.sibling,c=c.sibling=Sa(n,n.pendingProps),c.return=s;c.sibling=null}return s.child}function od(n,s){return(n.lanes&s)!==0?!0:(n=n.dependencies,!!(n!==null&&Iu(n)))}function Ym(n,s,c){switch(s.tag){case 3:fi(s,s.stateNode.containerInfo),is(s,vn,n.memoizedState.cache),ca();break;case 27:case 5:Lr(s);break;case 4:fi(s,s.stateNode.containerInfo);break;case 10:is(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Fh(s),null;break;case 13:var g=s.memoizedState;if(g!==null)return g.dehydrated!==null?(us(s),s.flags|=128,null):(c&s.child.childLanes)!==0?nd(n,s,c):(us(s),n=ol(n,s,c),n!==null?n.sibling:null);us(s);break;case 19:var b=(n.flags&128)!==0;if(g=(c&s.childLanes)!==0,g||(mo(n,s,c,!1),g=(c&s.childLanes)!==0),b){if(g)return sd(n,s,c);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),ae(je,je.current),g)break;return null;case 22:return s.lanes=0,qh(n,s,c,s.pendingProps);case 24:is(s,vn,n.memoizedState.cache)}return ol(n,s,c)}function rm(n,s,c){if(n!==null)if(n.memoizedProps!==s.pendingProps)Fn=!0;else{if(!od(n,c)&&(s.flags&128)===0)return Fn=!1,Ym(n,s,c);Fn=(n.flags&131072)!==0}else Fn=!1,ii&&(s.flags&1048576)!==0&&Vl(s,ho,s.index);switch(s.lanes=0,s.tag){case 16:t:{var g=s.pendingProps;if(n=il(s.elementType),s.type=n,typeof n=="function")Wo(n)?(g=hs(n,g),s.tag=1,s=im(null,s,n,g,c)):(s.tag=0,s=td(null,s,n,g,c));else{if(n!=null){var b=n.$$typeof;if(b===di){s.tag=11,s=Qp(null,s,n,g,c);break t}else if(b===Re){s.tag=14,s=Hu(null,s,n,g,c);break t}}throw s=br(n)||n,Error(Z(306,s,""))}}return s;case 0:return td(n,s,s.type,s.pendingProps,c);case 1:return g=s.type,b=hs(g,s.pendingProps),im(n,s,g,b,c);case 3:t:{if(fi(s,s.stateNode.containerInfo),n===null)throw Error(Z(387));g=s.pendingProps;var E=s.memoizedState;b=E.element,jc(n,s),zr(s,g,null,c);var O=s.memoizedState;if(g=O.cache,is(s,vn,g),g!==E.cache&&ns(s,[vn],c,!0),Hl(),g=O.element,E.isDehydrated)if(E={element:g,isDehydrated:!1,cache:O.cache},s.updateQueue.baseState=E,s.memoizedState=E,s.flags&256){s=nm(n,s,g,c);break t}else if(g!==b){b=Ar(Error(Z(424)),s),Es(b),s=nm(n,s,g,c);break t}else{switch(n=s.stateNode.containerInfo,n.nodeType){case 9:n=n.body;break;default:n=n.nodeName==="HTML"?n.ownerDocument.body:n}for(Fi=Ba(n.firstChild),zn=s,ii=!0,es=null,ri=!0,c=Yf(s,null,g,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(ca(),g===b){s=ol(n,s,c);break t}Pn(n,s,g,c)}s=s.child}return s;case 26:return qc(n,s),n===null?(c=Om(s.type,null,s.pendingProps,null))?s.memoizedState=c:ii||(c=s.type,n=s.pendingProps,g=sh(ze.current).createElement(c),g[Ht]=s,g[se]=n,Un(g,c,n),nn(g),s.stateNode=g):s.memoizedState=Om(s.type,n.memoizedProps,s.pendingProps,n.memoizedState),null;case 27:return Lr(s),n===null&&ii&&(g=s.stateNode=kp(s.type,s.pendingProps,ze.current),zn=s,ri=!0,b=Fi,ma(s.type)?(ml=b,Fi=Ba(g.firstChild)):Fi=b),Pn(n,s,s.pendingProps.children,c),qc(n,s),n===null&&(s.flags|=4194304),s.child;case 5:return n===null&&ii&&((b=g=Fi)&&(g=Rm(g,s.type,s.pendingProps,ri),g!==null?(s.stateNode=g,zn=s,Fi=Ba(g.firstChild),ri=!1,b=!0):b=!1),b||yn(s)),Lr(s),b=s.type,E=s.pendingProps,O=n!==null?n.memoizedProps:null,g=E.children,ff(b,E)?g=null:O!==null&&ff(b,O)&&(s.flags|=32),s.memoizedState!==null&&(b=Ps(n,s,wo,null,null,c),bf._currentValue=b),qc(n,s),Pn(n,s,g,c),s.child;case 6:return n===null&&ii&&((n=c=Fi)&&(c=ka(c,s.pendingProps,ri),c!==null?(s.stateNode=c,zn=s,Fi=null,n=!0):n=!1),n||yn(s)),null;case 13:return nd(n,s,c);case 4:return fi(s,s.stateNode.containerInfo),g=s.pendingProps,n===null?s.child=_o(s,null,g,c):Pn(n,s,g,c),s.child;case 11:return Qp(n,s,s.type,s.pendingProps,c);case 7:return Pn(n,s,s.pendingProps,c),s.child;case 8:return Pn(n,s,s.pendingProps.children,c),s.child;case 12:return Pn(n,s,s.pendingProps.children,c),s.child;case 10:return g=s.pendingProps,is(s,s.type,g.value),Pn(n,s,g.children,c),s.child;case 9:return b=s.type._context,g=s.pendingProps.children,As(s),b=Bn(b),g=g(b),s.flags|=1,Pn(n,s,g,c),s.child;case 14:return Hu(n,s,s.type,s.pendingProps,c);case 15:return Zh(n,s,s.type,s.pendingProps,c);case 19:return sd(n,s,c);case 31:return em(n,s,c);case 22:return qh(n,s,c,s.pendingProps);case 24:return As(s),g=Bn(vn),n===null?(b=el(),b===null&&(b=Xi,E=Gr(),b.pooledCache=E,E.refCount++,E!==null&&(b.pooledCacheLanes|=c),b=E),s.memoizedState={parent:g,cache:b},_i(s),is(s,vn,b)):((n.lanes&c)!==0&&(jc(n,s),zr(s,null,null,c),Hl()),b=n.memoizedState,E=s.memoizedState,b.parent!==g?(b={parent:g,cache:g},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),is(s,vn,g)):(g=E.cache,is(s,vn,g),g!==b.cache&&ns(s,[vn],c,!0))),Pn(n,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(Z(156,s.tag))}function Mo(n){n.flags|=4}function fp(n,s,c,g,b){if((s=(n.mode&32)!==0)&&(s=!1),s){if(n.flags|=16777216,(b&335544128)===b)if(n.stateNode.complete)n.flags|=8192;else if(_m())n.flags|=8192;else throw fa=go,Lu}else n.flags&=-16777217}function ld(n,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!jd(s))if(_m())n.flags|=8192;else throw fa=go,Lu}function Xh(n,s){s!==null&&(n.flags|=4),n.flags&16384&&(s=n.tag!==22?ue():536870912,n.lanes|=s,eu|=s)}function Xc(n,s){if(!ii)switch(n.tailMode){case"hidden":s=n.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?n.tail=null:c.sibling=null;break;case"collapsed":c=n.tail;for(var g=null;c!==null;)c.alternate!==null&&(g=c),c=c.sibling;g===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:g.sibling=null}}function ln(n){var s=n.alternate!==null&&n.alternate.child===n.child,c=0,g=0;if(s)for(var b=n.child;b!==null;)c|=b.lanes|b.childLanes,g|=b.subtreeFlags&65011712,g|=b.flags&65011712,b.return=n,b=b.sibling;else for(b=n.child;b!==null;)c|=b.lanes|b.childLanes,g|=b.subtreeFlags,g|=b.flags,b.return=n,b=b.sibling;return n.subtreeFlags|=g,n.childLanes=c,s}function Wm(n,s,c){var g=s.pendingProps;switch(kc(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ln(s),null;case 1:return ln(s),null;case 3:return c=s.stateNode,g=null,n!==null&&(g=n.memoizedState.cache),s.memoizedState.cache!==g&&(s.flags|=2048),ea(vn),wi(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(n===null||n.child===null)&&(tl(s)?Mo(s):n===null||n.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Du())),ln(s),null;case 26:var b=s.type,E=s.memoizedState;return n===null?(Mo(s),E!==null?(ln(s),ld(s,E)):(ln(s),fp(s,b,null,g,c))):E?E!==n.memoizedState?(Mo(s),ln(s),ld(s,E)):(ln(s),s.flags&=-16777217):(n=n.memoizedProps,n!==g&&Mo(s),ln(s),fp(s,b,n,g,c)),null;case 27:if(Wr(s),c=ze.current,b=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==g&&Mo(s);else{if(!g){if(s.stateNode===null)throw Error(Z(166));return ln(s),null}n=fe.current,tl(s)?Zl(s):(n=kp(b,g,c),s.stateNode=n,Mo(s))}return ln(s),null;case 5:if(Wr(s),b=s.type,n!==null&&s.stateNode!=null)n.memoizedProps!==g&&Mo(s);else{if(!g){if(s.stateNode===null)throw Error(Z(166));return ln(s),null}if(E=fe.current,tl(s))Zl(s);else{var O=sh(ze.current);switch(E){case 1:E=O.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:E=O.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":E=O.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":E=O.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":E=O.createElement("div"),E.innerHTML="<script><\/script>",E=E.removeChild(E.firstChild);break;case"select":E=typeof g.is=="string"?O.createElement("select",{is:g.is}):O.createElement("select"),g.multiple?E.multiple=!0:g.size&&(E.size=g.size);break;default:E=typeof g.is=="string"?O.createElement(b,{is:g.is}):O.createElement(b)}}E[Ht]=s,E[se]=g;t:for(O=s.child;O!==null;){if(O.tag===5||O.tag===6)E.appendChild(O.stateNode);else if(O.tag!==4&&O.tag!==27&&O.child!==null){O.child.return=O,O=O.child;continue}if(O===s)break t;for(;O.sibling===null;){if(O.return===null||O.return===s)break t;O=O.return}O.sibling.return=O.return,O=O.sibling}s.stateNode=E;t:switch(Un(E,b,g),b){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break t;case"img":g=!0;break t;default:g=!1}g&&Mo(s)}}return ln(s),fp(s,s.type,n===null?null:n.memoizedProps,s.pendingProps,c),null;case 6:if(n&&s.stateNode!=null)n.memoizedProps!==g&&Mo(s);else{if(typeof g!="string"&&s.stateNode===null)throw Error(Z(166));if(n=ze.current,tl(s)){if(n=s.stateNode,c=s.memoizedProps,g=null,b=zn,b!==null)switch(b.tag){case 27:case 5:g=b.memoizedProps}n[Ht]=s,n=!!(n.nodeValue===c||g!==null&&g.suppressHydrationWarning===!0||Ip(n.nodeValue,c)),n||yn(s,!0)}else n=sh(n).createTextNode(g),n[Ht]=s,s.stateNode=n}return ln(s),null;case 31:if(c=s.memoizedState,n===null||n.memoizedState!==null){if(g=tl(s),c!==null){if(n===null){if(!g)throw Error(Z(318));if(n=s.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Z(557));n[Ht]=s}else ca(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;ln(s),n=!1}else c=Du(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=c),n=!0;if(!n)return s.flags&256?(nr(s),s):(nr(s),null);if((s.flags&128)!==0)throw Error(Z(558))}return ln(s),null;case 13:if(g=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(b=tl(s),g!==null&&g.dehydrated!==null){if(n===null){if(!b)throw Error(Z(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(Z(317));b[Ht]=s}else ca(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;ln(s),b=!1}else b=Du(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?(nr(s),s):(nr(s),null)}return nr(s),(s.flags&128)!==0?(s.lanes=c,s):(c=g!==null,n=n!==null&&n.memoizedState!==null,c&&(g=s.child,b=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(b=g.alternate.memoizedState.cachePool.pool),E=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(E=g.memoizedState.cachePool.pool),E!==b&&(g.flags|=2048)),c!==n&&c&&(s.child.flags|=8192),Xh(s,s.updateQueue),ln(s),null);case 4:return wi(),n===null&&Pd(s.stateNode.containerInfo),ln(s),null;case 10:return ea(s.type),ln(s),null;case 19:if(qt(je),g=s.memoizedState,g===null)return ln(s),null;if(b=(s.flags&128)!==0,E=g.rendering,E===null)if(b)Xc(g,!1);else{if(In!==0||n!==null&&(n.flags&128)!==0)for(n=s.child;n!==null;){if(E=yi(n),E!==null){for(s.flags|=128,Xc(g,!1),n=E.updateQueue,s.updateQueue=n,Xh(s,n),s.subtreeFlags=0,n=c,c=s.child;c!==null;)qf(c,n),c=c.sibling;return ae(je,je.current&1|2),ii&&Ma(s,g.treeForkCount),s.child}n=n.sibling}g.tail!==null&&Ln()>gd&&(s.flags|=128,b=!0,Xc(g,!1),s.lanes=4194304)}else{if(!b)if(n=yi(E),n!==null){if(s.flags|=128,b=!0,n=n.updateQueue,s.updateQueue=n,Xh(s,n),Xc(g,!0),g.tail===null&&g.tailMode==="hidden"&&!E.alternate&&!ii)return ln(s),null}else 2*Ln()-g.renderingStartTime>gd&&c!==536870912&&(s.flags|=128,b=!0,Xc(g,!1),s.lanes=4194304);g.isBackwards?(E.sibling=s.child,s.child=E):(n=g.last,n!==null?n.sibling=E:s.child=E,g.last=E)}return g.tail!==null?(n=g.tail,g.rendering=n,g.tail=n.sibling,g.renderingStartTime=Ln(),n.sibling=null,c=je.current,ae(je,b?c&1|2:c&1),ii&&Ma(s,g.treeForkCount),n):(ln(s),null);case 22:case 23:return nr(s),ir(),g=s.memoizedState!==null,n!==null?n.memoizedState!==null!==g&&(s.flags|=8192):g&&(s.flags|=8192),g?(c&536870912)!==0&&(s.flags&128)===0&&(ln(s),s.subtreeFlags&6&&(s.flags|=8192)):ln(s),c=s.updateQueue,c!==null&&Xh(s,c.retryQueue),c=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),g=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),g!==c&&(s.flags|=2048),n!==null&&qt(ss),null;case 24:return c=null,n!==null&&(c=n.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),ea(vn),ln(s),null;case 25:return null;case 30:return null}throw Error(Z(156,s.tag))}function Km(n,s){switch(kc(s),s.tag){case 1:return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return ea(vn),wi(),n=s.flags,(n&65536)!==0&&(n&128)===0?(s.flags=n&-65537|128,s):null;case 26:case 27:case 5:return Wr(s),null;case 31:if(s.memoizedState!==null){if(nr(s),s.alternate===null)throw Error(Z(340));ca()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 13:if(nr(s),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error(Z(340));ca()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return qt(je),null;case 4:return wi(),null;case 10:return ea(s.type),null;case 22:case 23:return nr(s),ir(),n!==null&&qt(ss),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 24:return ea(vn),null;case 25:return null;default:return null}}function $h(n,s){switch(kc(s),s.tag){case 3:ea(vn),wi();break;case 26:case 27:case 5:Wr(s);break;case 4:wi();break;case 31:s.memoizedState!==null&&nr(s);break;case 13:nr(s);break;case 19:qt(je);break;case 10:ea(s.type);break;case 22:case 23:nr(s),ir(),n!==null&&qt(ss);break;case 24:ea(vn)}}function $u(n,s){try{var c=s.updateQueue,g=c!==null?c.lastEffect:null;if(g!==null){var b=g.next;c=b;do{if((c.tag&n)===n){g=void 0;var E=c.create,O=c.inst;g=E(),O.destroy=g}c=c.next}while(c!==b)}}catch(W){Ei(s,s.return,W)}}function ll(n,s,c){try{var g=s.updateQueue,b=g!==null?g.lastEffect:null;if(b!==null){var E=b.next;g=E;do{if((g.tag&n)===n){var O=g.inst,W=O.destroy;if(W!==void 0){O.destroy=void 0,b=s;var gt=c,Lt=W;try{Lt()}catch(Vt){Ei(b,gt,Vt)}}}g=g.next}while(g!==E)}}catch(Vt){Ei(s,s.return,Vt)}}function Ql(n){var s=n.updateQueue;if(s!==null){var c=n.stateNode;try{pe(s,c)}catch(g){Ei(n,n.return,g)}}}function $c(n,s,c){c.props=hs(n.type,n.memoizedProps),c.state=n.memoizedState;try{c.componentWillUnmount()}catch(g){Ei(n,s,g)}}function Yh(n,s){try{var c=n.ref;if(c!==null){switch(n.tag){case 26:case 27:case 5:var g=n.stateNode;break;case 30:g=n.stateNode;break;default:g=n.stateNode}typeof c=="function"?n.refCleanup=c(g):c.current=g}}catch(b){Ei(n,s,b)}}function Eo(n,s){var c=n.ref,g=n.refCleanup;if(c!==null)if(typeof g=="function")try{g()}catch(b){Ei(n,s,b)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){Ei(n,s,b)}else c.current=null}function am(n){var s=n.type,c=n.memoizedProps,g=n.stateNode;try{t:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&g.focus();break t;case"img":c.src?g.src=c.src:c.srcSet&&(g.srcset=c.srcSet)}}catch(b){Ei(n,n.return,b)}}function dp(n,s,c){try{var g=n.stateNode;ic(g,n.type,c,s),g[se]=s}catch(b){Ei(n,n.return,b)}}function sm(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&ma(n.type)||n.tag===4}function pp(n){t:for(;;){for(;n.sibling===null;){if(n.return===null||sm(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&ma(n.type)||n.flags&2||n.child===null||n.tag===4)continue t;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function mp(n,s,c){var g=n.tag;if(g===5||g===6)n=n.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(n,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(n),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=Ne));else if(g!==4&&(g===27&&ma(n.type)&&(c=n.stateNode,s=null),n=n.child,n!==null))for(mp(n,s,c),n=n.sibling;n!==null;)mp(n,s,c),n=n.sibling}function Yc(n,s,c){var g=n.tag;if(g===5||g===6)n=n.stateNode,s?c.insertBefore(n,s):c.appendChild(n);else if(g!==4&&(g===27&&ma(n.type)&&(c=n.stateNode),n=n.child,n!==null))for(Yc(n,s,c),n=n.sibling;n!==null;)Yc(n,s,c),n=n.sibling}function om(n){var s=n.stateNode,c=n.memoizedProps;try{for(var g=n.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);Un(s,g,c),s[Ht]=n,s[se]=c}catch(E){Ei(n,n.return,E)}}var Ao=!1,fn=!1,gp=!1,dn=typeof WeakSet=="function"?WeakSet:Set,wn=null;function lm(n,s){if(n=n.containerInfo,su=hc,n=Pc(n),wu(n)){if("selectionStart"in n)var c={start:n.selectionStart,end:n.selectionEnd};else t:{c=(c=n.ownerDocument)&&c.defaultView||window;var g=c.getSelection&&c.getSelection();if(g&&g.rangeCount!==0){c=g.anchorNode;var b=g.anchorOffset,E=g.focusNode;g=g.focusOffset;try{c.nodeType,E.nodeType}catch{c=null;break t}var O=0,W=-1,gt=-1,Lt=0,Vt=0,Yt=n,Bt=null;e:for(;;){for(var Ft;Yt!==c||b!==0&&Yt.nodeType!==3||(W=O+b),Yt!==E||g!==0&&Yt.nodeType!==3||(gt=O+g),Yt.nodeType===3&&(O+=Yt.nodeValue.length),(Ft=Yt.firstChild)!==null;)Bt=Yt,Yt=Ft;for(;;){if(Yt===n)break e;if(Bt===c&&++Lt===b&&(W=O),Bt===E&&++Vt===g&&(gt=O),(Ft=Yt.nextSibling)!==null)break;Yt=Bt,Bt=Yt.parentNode}Yt=Ft}c=W===-1||gt===-1?null:{start:W,end:gt}}else c=null}c=c||{start:0,end:0}}else c=null;for(ah={focusedElem:n,selectionRange:c},hc=!1,wn=s;wn!==null;)if(s=wn,n=s.child,(s.subtreeFlags&1028)!==0&&n!==null)n.return=s,wn=n;else for(;wn!==null;){switch(s=wn,E=s.alternate,n=s.flags,s.tag){case 0:if((n&4)!==0&&(n=s.updateQueue,n=n!==null?n.events:null,n!==null))for(c=0;c<n.length;c++)b=n[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&E!==null){n=void 0,c=s,b=E.memoizedProps,E=E.memoizedState,g=c.stateNode;try{var ye=hs(c.type,b);n=g.getSnapshotBeforeUpdate(ye,E),g.__reactInternalSnapshotBeforeUpdate=n}catch(ke){Ei(c,c.return,ke)}}break;case 3:if((n&1024)!==0){if(n=s.stateNode.containerInfo,c=n.nodeType,c===9)Rn(n);else if(c===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":Rn(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(Z(163))}if(n=s.sibling,n!==null){n.return=s.return,wn=n;break}wn=s.return}}function Wh(n,s,c){var g=c.flags;switch(c.tag){case 0:case 11:case 15:zo(n,c),g&4&&$u(5,c);break;case 1:if(zo(n,c),g&4)if(n=c.stateNode,s===null)try{n.componentDidMount()}catch(O){Ei(c,c.return,O)}else{var b=hs(c.type,s.memoizedProps);s=s.memoizedState;try{n.componentDidUpdate(b,s,n.__reactInternalSnapshotBeforeUpdate)}catch(O){Ei(c,c.return,O)}}g&64&&Ql(c),g&512&&Yh(c,c.return);break;case 3:if(zo(n,c),g&64&&(n=c.updateQueue,n!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{pe(n,s)}catch(O){Ei(c,c.return,O)}}break;case 27:s===null&&g&4&&om(c);case 26:case 5:zo(n,c),s===null&&g&4&&am(c),g&512&&Yh(c,c.return);break;case 12:zo(n,c);break;case 31:zo(n,c),g&4&&ud(n,c);break;case 13:zo(n,c),g&4&&Yu(n,c),g&64&&(n=c.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(c=Jm.bind(null,c),sg(n,c))));break;case 22:if(g=c.memoizedState!==null||Ao,!g){s=s!==null&&s.memoizedState!==null||fn,b=Ao;var E=fn;Ao=g,(fn=s)&&!E?Vs(n,c,(c.subtreeFlags&8772)!==0):zo(n,c),Ao=b,fn=E}break;case 30:break;default:zo(n,c)}}function Kh(n){var s=n.alternate;s!==null&&(n.alternate=null,Kh(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&eo(s)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var Gi=null,na=!1;function Co(n,s,c){for(c=c.child;c!==null;)Wc(n,s,c),c=c.sibling}function Wc(n,s,c){if(Zi&&typeof Zi.onCommitFiberUnmount=="function")try{Zi.onCommitFiberUnmount(wr,c)}catch{}switch(c.tag){case 26:fn||Eo(c,s),Co(n,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:fn||Eo(c,s);var g=Gi,b=na;ma(c.type)&&(Gi=c.stateNode,na=!1),Co(n,s,c),lh(c.stateNode),Gi=g,na=b;break;case 5:fn||Eo(c,s);case 6:if(g=Gi,b=na,Gi=null,Co(n,s,c),Gi=g,na=b,Gi!==null)if(na)try{(Gi.nodeType===9?Gi.body:Gi.nodeName==="HTML"?Gi.ownerDocument.body:Gi).removeChild(c.stateNode)}catch(E){Ei(c,s,E)}else try{Gi.removeChild(c.stateNode)}catch(E){Ei(c,s,E)}break;case 18:Gi!==null&&(na?(n=Gi,aa(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,c.stateNode),fc(n)):aa(Gi,c.stateNode));break;case 4:g=Gi,b=na,Gi=c.stateNode.containerInfo,na=!0,Co(n,s,c),Gi=g,na=b;break;case 0:case 11:case 14:case 15:ll(2,c,s),fn||ll(4,c,s),Co(n,s,c);break;case 1:fn||(Eo(c,s),g=c.stateNode,typeof g.componentWillUnmount=="function"&&$c(c,s,g)),Co(n,s,c);break;case 21:Co(n,s,c);break;case 22:fn=(g=fn)||c.memoizedState!==null,Co(n,s,c),fn=g;break;default:Co(n,s,c)}}function ud(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{fc(n)}catch(c){Ei(s,s.return,c)}}}function Yu(n,s){if(s.memoizedState===null&&(n=s.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{fc(n)}catch(c){Ei(s,s.return,c)}}function cd(n){switch(n.tag){case 31:case 13:case 19:var s=n.stateNode;return s===null&&(s=n.stateNode=new dn),s;case 22:return n=n.stateNode,s=n._retryCache,s===null&&(s=n._retryCache=new dn),s;default:throw Error(Z(435,n.tag))}}function ul(n,s){var c=cd(n);s.forEach(function(g){if(!c.has(g)){c.add(g);var b=tg.bind(null,n,g);g.then(b,b)}})}function dr(n,s){var c=s.deletions;if(c!==null)for(var g=0;g<c.length;g++){var b=c[g],E=n,O=s,W=O;t:for(;W!==null;){switch(W.tag){case 27:if(ma(W.type)){Gi=W.stateNode,na=!1;break t}break;case 5:Gi=W.stateNode,na=!1;break t;case 3:case 4:Gi=W.stateNode.containerInfo,na=!0;break t}W=W.return}if(Gi===null)throw Error(Z(160));Wc(E,O,b),Gi=null,na=!1,E=b.alternate,E!==null&&(E.return=null),b.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)_p(s,n),s=s.sibling}var Us=null;function _p(n,s){var c=n.alternate,g=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:dr(s,n),Xn(n),g&4&&(ll(3,n,n.return),$u(3,n),ll(5,n,n.return));break;case 1:dr(s,n),Xn(n),g&512&&(fn||c===null||Eo(c,c.return)),g&64&&Ao&&(n=n.updateQueue,n!==null&&(g=n.callbacks,g!==null&&(c=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=c===null?g:c.concat(g))));break;case 26:var b=Us;if(dr(s,n),Xn(n),g&512&&(fn||c===null||Eo(c,c.return)),g&4){var E=c!==null?c.memoizedState:null;if(g=n.memoizedState,c===null)if(g===null)if(n.stateNode===null){t:{g=n.type,c=n.memoizedProps,b=b.ownerDocument||b;e:switch(g){case"title":E=b.getElementsByTagName("title")[0],(!E||E[Qr]||E[Ht]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=b.createElement(g),b.head.insertBefore(E,b.querySelector("head > title"))),Un(E,g,c),E[Ht]=n,nn(E),g=E;break t;case"link":var O=yf("link","href",b).get(g+(c.href||""));if(O){for(var W=0;W<O.length;W++)if(E=O[W],E.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&E.getAttribute("rel")===(c.rel==null?null:c.rel)&&E.getAttribute("title")===(c.title==null?null:c.title)&&E.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){O.splice(W,1);break e}}E=b.createElement(g),Un(E,g,c),b.head.appendChild(E);break;case"meta":if(O=yf("meta","content",b).get(g+(c.content||""))){for(W=0;W<O.length;W++)if(E=O[W],E.getAttribute("content")===(c.content==null?null:""+c.content)&&E.getAttribute("name")===(c.name==null?null:c.name)&&E.getAttribute("property")===(c.property==null?null:c.property)&&E.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&E.getAttribute("charset")===(c.charSet==null?null:c.charSet)){O.splice(W,1);break e}}E=b.createElement(g),Un(E,g,c),b.head.appendChild(E);break;default:throw Error(Z(468,g))}E[Ht]=n,nn(E),g=E}n.stateNode=g}else vf(b,n.type,n.stateNode);else n.stateNode=Ud(b,g,n.memoizedProps);else E!==g?(E===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):E.count--,g===null?vf(b,n.type,n.stateNode):Ud(b,g,n.memoizedProps)):g===null&&n.stateNode!==null&&dp(n,n.memoizedProps,c.memoizedProps)}break;case 27:dr(s,n),Xn(n),g&512&&(fn||c===null||Eo(c,c.return)),c!==null&&g&4&&dp(n,n.memoizedProps,c.memoizedProps);break;case 5:if(dr(s,n),Xn(n),g&512&&(fn||c===null||Eo(c,c.return)),n.flags&32){b=n.stateNode;try{No(b,"")}catch(ye){Ei(n,n.return,ye)}}g&4&&n.stateNode!=null&&(b=n.memoizedProps,dp(n,b,c!==null?c.memoizedProps:b)),g&1024&&(gp=!0);break;case 6:if(dr(s,n),Xn(n),g&4){if(n.stateNode===null)throw Error(Z(162));g=n.memoizedProps,c=n.stateNode;try{c.nodeValue=g}catch(ye){Ei(n,n.return,ye)}}break;case 3:if(_f=null,b=Us,Us=pf(s.containerInfo),dr(s,n),Us=b,Xn(n),g&4&&c!==null&&c.memoizedState.isDehydrated)try{fc(s.containerInfo)}catch(ye){Ei(n,n.return,ye)}gp&&(gp=!1,um(n));break;case 4:g=Us,Us=pf(n.stateNode.containerInfo),dr(s,n),Xn(n),Us=g;break;case 12:dr(s,n),Xn(n);break;case 31:dr(s,n),Xn(n),g&4&&(g=n.updateQueue,g!==null&&(n.updateQueue=null,ul(n,g)));break;case 13:dr(s,n),Xn(n),n.child.flags&8192&&n.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(md=Ln()),g&4&&(g=n.updateQueue,g!==null&&(n.updateQueue=null,ul(n,g)));break;case 22:b=n.memoizedState!==null;var gt=c!==null&&c.memoizedState!==null,Lt=Ao,Vt=fn;if(Ao=Lt||b,fn=Vt||gt,dr(s,n),fn=Vt,Ao=Lt,Xn(n),g&8192)t:for(s=n.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(c===null||gt||Ao||fn||js(n)),c=null,s=n;;){if(s.tag===5||s.tag===26){if(c===null){gt=c=s;try{if(E=gt.stateNode,b)O=E.style,typeof O.setProperty=="function"?O.setProperty("display","none","important"):O.display="none";else{W=gt.stateNode;var Yt=gt.memoizedProps.style,Bt=Yt!=null&&Yt.hasOwnProperty("display")?Yt.display:null;W.style.display=Bt==null||typeof Bt=="boolean"?"":(""+Bt).trim()}}catch(ye){Ei(gt,gt.return,ye)}}}else if(s.tag===6){if(c===null){gt=s;try{gt.stateNode.nodeValue=b?"":gt.memoizedProps}catch(ye){Ei(gt,gt.return,ye)}}}else if(s.tag===18){if(c===null){gt=s;try{var Ft=gt.stateNode;b?jn(Ft,!0):jn(gt.stateNode,!1)}catch(ye){Ei(gt,gt.return,ye)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===n)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break t;for(;s.sibling===null;){if(s.return===null||s.return===n)break t;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}g&4&&(g=n.updateQueue,g!==null&&(c=g.retryQueue,c!==null&&(g.retryQueue=null,ul(n,c))));break;case 19:dr(s,n),Xn(n),g&4&&(g=n.updateQueue,g!==null&&(n.updateQueue=null,ul(n,g)));break;case 30:break;case 21:break;default:dr(s,n),Xn(n)}}function Xn(n){var s=n.flags;if(s&2){try{for(var c,g=n.return;g!==null;){if(sm(g)){c=g;break}g=g.return}if(c==null)throw Error(Z(160));switch(c.tag){case 27:var b=c.stateNode,E=pp(n);Yc(n,E,b);break;case 5:var O=c.stateNode;c.flags&32&&(No(O,""),c.flags&=-33);var W=pp(n);Yc(n,W,O);break;case 3:case 4:var gt=c.stateNode.containerInfo,Lt=pp(n);mp(n,Lt,gt);break;default:throw Error(Z(161))}}catch(Vt){Ei(n,n.return,Vt)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function um(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var s=n;um(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),n=n.sibling}}function zo(n,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)Wh(n,s.alternate,s),s=s.sibling}function js(n){for(n=n.child;n!==null;){var s=n;switch(s.tag){case 0:case 11:case 14:case 15:ll(4,s,s.return),js(s);break;case 1:Eo(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&$c(s,s.return,c),js(s);break;case 27:lh(s.stateNode);case 26:case 5:Eo(s,s.return),js(s);break;case 22:s.memoizedState===null&&js(s);break;case 30:js(s);break;default:js(s)}n=n.sibling}}function Vs(n,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var g=s.alternate,b=n,E=s,O=E.flags;switch(E.tag){case 0:case 11:case 15:Vs(b,E,c),$u(4,E);break;case 1:if(Vs(b,E,c),g=E,b=g.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Lt){Ei(g,g.return,Lt)}if(g=E,b=g.updateQueue,b!==null){var W=g.stateNode;try{var gt=b.shared.hiddenCallbacks;if(gt!==null)for(b.shared.hiddenCallbacks=null,b=0;b<gt.length;b++)Xl(gt[b],W)}catch(Lt){Ei(g,g.return,Lt)}}c&&O&64&&Ql(E),Yh(E,E.return);break;case 27:om(E);case 26:case 5:Vs(b,E,c),c&&g===null&&O&4&&am(E),Yh(E,E.return);break;case 12:Vs(b,E,c);break;case 31:Vs(b,E,c),c&&O&4&&ud(b,E);break;case 13:Vs(b,E,c),c&&O&4&&Yu(b,E);break;case 22:E.memoizedState===null&&Vs(b,E,c),Yh(E,E.return);break;case 30:break;default:Vs(b,E,c)}s=s.sibling}}function hd(n,s){var c=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),n=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(n=s.memoizedState.cachePool.pool),n!==c&&(n!=null&&n.refCount++,c!=null&&On(c))}function fd(n,s){n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&On(n))}function Gs(n,s,c,g){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)cm(n,s,c,g),s=s.sibling}function cm(n,s,c,g){var b=s.flags;switch(s.tag){case 0:case 11:case 15:Gs(n,s,c,g),b&2048&&$u(9,s);break;case 1:Gs(n,s,c,g);break;case 3:Gs(n,s,c,g),b&2048&&(n=null,s.alternate!==null&&(n=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==n&&(s.refCount++,n!=null&&On(n)));break;case 12:if(b&2048){Gs(n,s,c,g),n=s.stateNode;try{var E=s.memoizedProps,O=E.id,W=E.onPostCommit;typeof W=="function"&&W(O,s.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(gt){Ei(s,s.return,gt)}}else Gs(n,s,c,g);break;case 31:Gs(n,s,c,g);break;case 13:Gs(n,s,c,g);break;case 23:break;case 22:E=s.stateNode,O=s.alternate,s.memoizedState!==null?E._visibility&2?Gs(n,s,c,g):Qh(n,s):E._visibility&2?Gs(n,s,c,g):(E._visibility|=2,Kc(n,s,c,g,(s.subtreeFlags&10256)!==0||!1)),b&2048&&hd(O,s);break;case 24:Gs(n,s,c,g),b&2048&&fd(s.alternate,s);break;default:Gs(n,s,c,g)}}function Kc(n,s,c,g,b){for(b=b&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var E=n,O=s,W=c,gt=g,Lt=O.flags;switch(O.tag){case 0:case 11:case 15:Kc(E,O,W,gt,b),$u(8,O);break;case 23:break;case 22:var Vt=O.stateNode;O.memoizedState!==null?Vt._visibility&2?Kc(E,O,W,gt,b):Qh(E,O):(Vt._visibility|=2,Kc(E,O,W,gt,b)),b&&Lt&2048&&hd(O.alternate,O);break;case 24:Kc(E,O,W,gt,b),b&&Lt&2048&&fd(O.alternate,O);break;default:Kc(E,O,W,gt,b)}s=s.sibling}}function Qh(n,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=n,g=s,b=g.flags;switch(g.tag){case 22:Qh(c,g),b&2048&&hd(g.alternate,g);break;case 24:Qh(c,g),b&2048&&fd(g.alternate,g);break;default:Qh(c,g)}s=s.sibling}}var Jh=8192;function Zs(n,s,c){if(n.subtreeFlags&Jh)for(n=n.child;n!==null;)hm(n,s,c),n=n.sibling}function hm(n,s,c){switch(n.tag){case 26:Zs(n,s,c),n.flags&Jh&&n.memoizedState!==null&&Fm(c,Us,n.memoizedState,n.memoizedProps);break;case 5:Zs(n,s,c);break;case 3:case 4:var g=Us;Us=pf(n.stateNode.containerInfo),Zs(n,s,c),Us=g;break;case 22:n.memoizedState===null&&(g=n.alternate,g!==null&&g.memoizedState!==null?(g=Jh,Jh=16777216,Zs(n,s,c),Jh=g):Zs(n,s,c));break;default:Zs(n,s,c)}}function fm(n){var s=n.alternate;if(s!==null&&(n=s.child,n!==null)){s.child=null;do s=n.sibling,n.sibling=null,n=s;while(n!==null)}}function Qc(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];wn=g,pm(g,n)}fm(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)dm(n),n=n.sibling}function dm(n){switch(n.tag){case 0:case 11:case 15:Qc(n),n.flags&2048&&ll(9,n,n.return);break;case 3:Qc(n);break;case 12:Qc(n);break;case 22:var s=n.stateNode;n.memoizedState!==null&&s._visibility&2&&(n.return===null||n.return.tag!==13)?(s._visibility&=-3,tf(n)):Qc(n);break;default:Qc(n)}}function tf(n){var s=n.deletions;if((n.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];wn=g,pm(g,n)}fm(n)}for(n=n.child;n!==null;){switch(s=n,s.tag){case 0:case 11:case 15:ll(8,s,s.return),tf(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,tf(s));break;default:tf(s)}n=n.sibling}}function pm(n,s){for(;wn!==null;){var c=wn;switch(c.tag){case 0:case 11:case 15:ll(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var g=c.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:On(c.memoizedState.cache)}if(g=c.child,g!==null)g.return=c,wn=g;else t:for(c=n;wn!==null;){g=wn;var b=g.sibling,E=g.return;if(Kh(g),g===c){wn=null;break t}if(b!==null){b.return=E,wn=b;break t}wn=E}}}var yp={getCacheForType:function(n){var s=Bn(vn),c=s.data.get(n);return c===void 0&&(c=n(),s.data.set(n,c)),c},cacheSignal:function(){return Bn(vn).controller.signal}},ef=typeof WeakMap=="function"?WeakMap:Map,mi=0,Xi=null,ai=null,si=0,Bi=0,La=null,Jl=!1,Do=!1,dd=!1,cl=0,In=0,tu=0,Wu=0,vp=0,da=0,eu=0,Jc=null,ra=null,pd=!1,md=0,nf=0,gd=1/0,rf=null,iu=null,sr=0,nu=null,Ku=null,hl=0,xp=0,Qu=null,Nn=null,Ju=0,_d=null;function pa(){return(mi&2)!==0&&si!==0?si&-si:Nt.T!==null?Cd():Pi()}function yd(){if(da===0)if((si&536870912)===0||ii){var n=Tt;Tt<<=1,(Tt&3932160)===0&&(Tt=262144),da=n}else da=536870912;return n=Dr.current,n!==null&&(n.flags|=32),da}function or(n,s,c){(n===Xi&&(Bi===2||Bi===9)||n.cancelPendingCommit!==null)&&(th(n,0),ru(n,si,da,!1)),Le(n,c),((mi&2)===0||n!==Xi)&&(n===Xi&&((mi&2)===0&&(Wu|=c),In===4&&ru(n,si,da,!1)),ds(n))}function bp(n,s,c){if((mi&6)!==0)throw Error(Z(327));var g=!c&&(s&127)===0&&(s&n.expiredLanes)===0||kt(n,s),b=g?Sp(n,s):Tp(n,s,!0),E=g;do{if(b===0){Do&&!g&&ru(n,s,0,!1);break}else{if(c=n.current.alternate,E&&!Qm(c)){b=Tp(n,s,!1),E=!1;continue}if(b===2){if(E=s,n.errorRecoveryDisabledLanes&E)var O=0;else O=n.pendingLanes&-536870913,O=O!==0?O:O&536870912?536870912:0;if(O!==0){s=O;t:{var W=n;b=Jc;var gt=W.current.memoizedState.isDehydrated;if(gt&&(th(W,O).flags|=256),O=Tp(W,O,!1),O!==2){if(dd&&!gt){W.errorRecoveryDisabledLanes|=E,Wu|=E,b=4;break t}E=ra,ra=b,E!==null&&(ra===null?ra=E:ra.push.apply(ra,E))}b=O}if(E=!1,b!==2)continue}}if(b===1){th(n,0),ru(n,s,0,!0);break}t:{switch(g=n,E=b,E){case 0:case 1:throw Error(Z(345));case 4:if((s&4194048)!==s)break;case 6:ru(g,s,da,!Jl);break t;case 2:ra=null;break;case 3:case 5:break;default:throw Error(Z(329))}if((s&62914560)===s&&(b=md+300-Ln(),10<b)){if(ru(g,s,da,!Jl),It(g,0,!0)!==0)break t;hl=s,g.timeoutHandle=Im(mm.bind(null,g,c,ra,rf,pd,s,da,Wu,eu,Jl,E,"Throttled",-0,0),b);break t}mm(g,c,ra,rf,pd,s,da,Wu,eu,Jl,E,null,-0,0)}}break}while(!0);ds(n)}function mm(n,s,c,g,b,E,O,W,gt,Lt,Vt,Yt,Bt,Ft){if(n.timeoutHandle=-1,Yt=s.subtreeFlags,Yt&8192||(Yt&16785408)===16785408){Yt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ne},hm(s,E,Yt);var ye=(E&62914560)===E?md-Ln():(E&4194048)===E?nf-Ln():0;if(ye=ug(Yt,ye),ye!==null){hl=E,n.cancelPendingCommit=ye(wm.bind(null,n,s,E,c,g,b,O,W,gt,Vt,Yt,null,Bt,Ft)),ru(n,E,O,!Lt);return}}wm(n,s,E,c,g,b,O,W,gt)}function Qm(n){for(var s=n;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var g=0;g<c.length;g++){var b=c[g],E=b.getSnapshot;b=b.value;try{if(!Jn(E(),b))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function ru(n,s,c,g){s&=~vp,s&=~Wu,n.suspendedLanes|=s,n.pingedLanes&=~s,g&&(n.warmLanes|=s),g=n.expirationTimes;for(var b=s;0<b;){var E=31-j(b),O=1<<E;g[E]=-1,b&=~O}c!==0&&Ge(n,c,s)}function vd(){return(mi&6)===0?(of(0),!1):!0}function wp(){if(ai!==null){if(Bi===0)var n=ai.return;else n=ai,Aa=po=null,sl(n),ls=null,ql=0,n=ai;for(;n!==null;)$h(n.alternate,n),n=n.return;ai=null}}function th(n,s){var c=n.timeoutHandle;c!==-1&&(n.timeoutHandle=-1,pr(c)),c=n.cancelPendingCommit,c!==null&&(n.cancelPendingCommit=null,c()),hl=0,wp(),Xi=n,ai=c=Sa(n.current,null),si=s,Bi=0,La=null,Jl=!1,Do=kt(n,s),dd=!1,eu=da=vp=Wu=tu=In=0,ra=Jc=null,pd=!1,(s&8)!==0&&(s|=s&32);var g=n.entangledLanes;if(g!==0)for(n=n.entanglements,g&=s;0<g;){var b=31-j(g),E=1<<b;s|=n[b],g&=~E}return cl=s,Au(),c}function gm(n,s){Fe=null,Nt.H=Wl,s===Ca||s===ku?(s=Nc(),Bi=3):s===Lu?(s=Nc(),Bi=4):Bi=s===Qf?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,La=s,ai===null&&(In=1,qu(n,Ar(s,n.current)))}function _m(){var n=Dr.current;return n===null?!0:(si&4194048)===si?an===null:(si&62914560)===si||(si&536870912)!==0?n===an:!1}function ym(){var n=Nt.H;return Nt.H=Wl,n===null?Wl:n}function vm(){var n=Nt.A;return Nt.A=yp,n}function xd(){In=4,Jl||(si&4194048)!==si&&Dr.current!==null||(Do=!0),(tu&134217727)===0&&(Wu&134217727)===0||Xi===null||ru(Xi,si,da,!1)}function Tp(n,s,c){var g=mi;mi|=2;var b=ym(),E=vm();(Xi!==n||si!==s)&&(rf=null,th(n,s)),s=!1;var O=In;t:do try{if(Bi!==0&&ai!==null){var W=ai,gt=La;switch(Bi){case 8:wp(),O=6;break t;case 3:case 2:case 9:case 6:Dr.current===null&&(s=!0);var Lt=Bi;if(Bi=0,La=null,qs(n,W,gt,Lt),c&&Do){O=0;break t}break;default:Lt=Bi,Bi=0,La=null,qs(n,W,gt,Lt)}}xm(),O=In;break}catch(Vt){gm(n,Vt)}while(!0);return s&&n.shellSuspendCounter++,Aa=po=null,mi=g,Nt.H=b,Nt.A=E,ai===null&&(Xi=null,si=0,Au()),O}function xm(){for(;ai!==null;)fl(ai)}function Sp(n,s){var c=mi;mi|=2;var g=ym(),b=vm();Xi!==n||si!==s?(rf=null,gd=Ln()+500,th(n,s)):Do=kt(n,s);t:do try{if(Bi!==0&&ai!==null){s=ai;var E=La;e:switch(Bi){case 1:Bi=0,La=null,qs(n,s,E,1);break;case 2:case 9:if(os(E)){Bi=0,La=null,eh(s);break}s=function(){Bi!==2&&Bi!==9||Xi!==n||(Bi=7),ds(n)},E.then(s,s);break t;case 3:Bi=7;break t;case 4:Bi=5;break t;case 7:os(E)?(Bi=0,La=null,eh(s)):(Bi=0,La=null,qs(n,s,E,7));break;case 5:var O=null;switch(ai.tag){case 26:O=ai.memoizedState;case 5:case 27:var W=ai;if(O?jd(O):W.stateNode.complete){Bi=0,La=null;var gt=W.sibling;if(gt!==null)ai=gt;else{var Lt=W.return;Lt!==null?(ai=Lt,tc(Lt)):ai=null}break e}}Bi=0,La=null,qs(n,s,E,5);break;case 6:Bi=0,La=null,qs(n,s,E,6);break;case 8:wp(),In=6;break t;default:throw Error(Z(462))}}bm();break}catch(Vt){gm(n,Vt)}while(!0);return Aa=po=null,Nt.H=g,Nt.A=b,mi=c,ai!==null?0:(Xi=null,si=0,Au(),In)}function bm(){for(;ai!==null&&!ja();)fl(ai)}function fl(n){var s=rm(n.alternate,n,cl);n.memoizedProps=n.pendingProps,s===null?tc(n):ai=s}function eh(n){var s=n,c=s.alternate;switch(s.tag){case 15:case 0:s=cp(c,s,s.pendingProps,s.type,void 0,si);break;case 11:s=cp(c,s,s.pendingProps,s.type.render,s.ref,si);break;case 5:sl(s);default:$h(c,s),s=ai=qf(s,cl),s=rm(c,s,cl)}n.memoizedProps=n.pendingProps,s===null?tc(n):ai=s}function qs(n,s,c,g){Aa=po=null,sl(s),ls=null,ql=0;var b=s.return;try{if(up(n,b,s,c,si)){In=1,qu(n,Ar(c,n.current)),ai=null;return}}catch(E){if(b!==null)throw ai=b,E;In=1,qu(n,Ar(c,n.current)),ai=null;return}s.flags&32768?(ii||g===1?n=!0:Do||(si&536870912)!==0?n=!1:(Jl=n=!0,(g===2||g===9||g===3||g===6)&&(g=Dr.current,g!==null&&g.tag===13&&(g.flags|=16384))),af(s,n)):tc(s)}function tc(n){var s=n;do{if((s.flags&32768)!==0){af(s,Jl);return}n=s.return;var c=Wm(s.alternate,s,cl);if(c!==null){ai=c;return}if(s=s.sibling,s!==null){ai=s;return}ai=s=n}while(s!==null);In===0&&(In=5)}function af(n,s){do{var c=Km(n.alternate,n);if(c!==null){c.flags&=32767,ai=c;return}if(c=n.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(n=n.sibling,n!==null)){ai=n;return}ai=n=c}while(n!==null);In=6,ai=null}function wm(n,s,c,g,b,E,O,W,gt){n.cancelPendingCommit=null;do sf();while(sr!==0);if((mi&6)!==0)throw Error(Z(327));if(s!==null){if(s===n.current)throw Error(Z(177));if(E=s.lanes|s.childLanes,E|=Nl,en(n,c,E,O,W,gt),n===Xi&&(ai=Xi=null,si=0),Ku=s,nu=n,hl=c,xp=E,Qu=b,Nn=g,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,eg(Va,function(){return Ap(),null})):(n.callbackNode=null,n.callbackPriority=0),g=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||g){g=Nt.T,Nt.T=null,b=ne.p,ne.p=2,O=mi,mi|=4;try{lm(n,s,c)}finally{mi=O,ne.p=b,Nt.T=g}}sr=1,Tm(),Mp(),Ep()}}function Tm(){if(sr===1){sr=0;var n=nu,s=Ku,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=Nt.T,Nt.T=null;var g=ne.p;ne.p=2;var b=mi;mi|=4;try{_p(s,n);var E=ah,O=Pc(n.containerInfo),W=E.focusedElem,gt=E.selectionRange;if(O!==W&&W&&W.ownerDocument&&Dc(W.ownerDocument.documentElement,W)){if(gt!==null&&wu(W)){var Lt=gt.start,Vt=gt.end;if(Vt===void 0&&(Vt=Lt),"selectionStart"in W)W.selectionStart=Lt,W.selectionEnd=Math.min(Vt,W.value.length);else{var Yt=W.ownerDocument||document,Bt=Yt&&Yt.defaultView||window;if(Bt.getSelection){var Ft=Bt.getSelection(),ye=W.textContent.length,ke=Math.min(gt.start,ye),Ni=gt.end===void 0?ke:Math.min(gt.end,ye);!Ft.extend&&ke>Ni&&(O=Ni,Ni=ke,ke=O);var St=zc(W,ke),bt=zc(W,Ni);if(St&&bt&&(Ft.rangeCount!==1||Ft.anchorNode!==St.node||Ft.anchorOffset!==St.offset||Ft.focusNode!==bt.node||Ft.focusOffset!==bt.offset)){var Rt=Yt.createRange();Rt.setStart(St.node,St.offset),Ft.removeAllRanges(),ke>Ni?(Ft.addRange(Rt),Ft.extend(bt.node,bt.offset)):(Rt.setEnd(bt.node,bt.offset),Ft.addRange(Rt))}}}}for(Yt=[],Ft=W;Ft=Ft.parentNode;)Ft.nodeType===1&&Yt.push({element:Ft,left:Ft.scrollLeft,top:Ft.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<Yt.length;W++){var Xt=Yt[W];Xt.element.scrollLeft=Xt.left,Xt.element.scrollTop=Xt.top}}hc=!!su,ah=su=null}finally{mi=b,ne.p=g,Nt.T=c}}n.current=s,sr=2}}function Mp(){if(sr===2){sr=0;var n=nu,s=Ku,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=Nt.T,Nt.T=null;var g=ne.p;ne.p=2;var b=mi;mi|=4;try{Wh(n,s.alternate,s)}finally{mi=b,ne.p=g,Nt.T=c}}sr=3}}function Ep(){if(sr===4||sr===3){sr=0,to();var n=nu,s=Ku,c=hl,g=Nn;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?sr=5:(sr=0,Ku=nu=null,Sm(n,n.pendingLanes));var b=n.pendingLanes;if(b===0&&(iu=null),Di(c),s=s.stateNode,Zi&&typeof Zi.onCommitFiberRoot=="function")try{Zi.onCommitFiberRoot(wr,s,void 0,(s.current.flags&128)===128)}catch{}if(g!==null){s=Nt.T,b=ne.p,ne.p=2,Nt.T=null;try{for(var E=n.onRecoverableError,O=0;O<g.length;O++){var W=g[O];E(W.value,{componentStack:W.stack})}}finally{Nt.T=s,ne.p=b}}(hl&3)!==0&&sf(),ds(n),b=n.pendingLanes,(c&261930)!==0&&(b&42)!==0?n===_d?Ju++:(Ju=0,_d=n):Ju=0,of(0)}}function Sm(n,s){(n.pooledCacheLanes&=s)===0&&(s=n.pooledCache,s!=null&&(n.pooledCache=null,On(s)))}function sf(){return Tm(),Mp(),Ep(),Ap()}function Ap(){if(sr!==5)return!1;var n=nu,s=xp;xp=0;var c=Di(hl),g=Nt.T,b=ne.p;try{ne.p=32>c?32:c,Nt.T=null,c=Qu,Qu=null;var E=nu,O=hl;if(sr=0,Ku=nu=null,hl=0,(mi&6)!==0)throw Error(Z(331));var W=mi;if(mi|=4,dm(E.current),cm(E,E.current,O,c),mi=W,of(0,!1),Zi&&typeof Zi.onPostCommitFiberRoot=="function")try{Zi.onPostCommitFiberRoot(wr,E)}catch{}return!0}finally{ne.p=b,Nt.T=g,Sm(n,s)}}function bd(n,s,c){s=Ar(c,s),s=lp(n.stateNode,s,2),n=Da(n,s,2),n!==null&&(Le(n,2),ds(n))}function Ei(n,s,c){if(n.tag===3)bd(n,n,c);else for(;s!==null;){if(s.tag===3){bd(s,n,c);break}else if(s.tag===1){var g=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(iu===null||!iu.has(g))){n=Ar(c,n),c=Kf(2),g=Da(s,c,2),g!==null&&(Kp(c,g,s,n),Le(g,2),ds(g));break}}s=s.return}}function Cp(n,s,c){var g=n.pingCache;if(g===null){g=n.pingCache=new ef;var b=new Set;g.set(s,b)}else b=g.get(s),b===void 0&&(b=new Set,g.set(s,b));b.has(c)||(dd=!0,b.add(c),n=Mm.bind(null,n,s,c),s.then(n,n))}function Mm(n,s,c){var g=n.pingCache;g!==null&&g.delete(s),n.pingedLanes|=n.suspendedLanes&c,n.warmLanes&=~c,Xi===n&&(si&c)===c&&(In===4||In===3&&(si&62914560)===si&&300>Ln()-md?(mi&2)===0&&th(n,0):vp|=c,eu===si&&(eu=0)),ds(n)}function Em(n,s){s===0&&(s=ue()),n=uo(n,s),n!==null&&(Le(n,s),ds(n))}function Jm(n){var s=n.memoizedState,c=0;s!==null&&(c=s.retryLane),Em(n,c)}function tg(n,s){var c=0;switch(n.tag){case 31:case 13:var g=n.stateNode,b=n.memoizedState;b!==null&&(c=b.retryLane);break;case 19:g=n.stateNode;break;case 22:g=n.stateNode._retryCache;break;default:throw Error(Z(314))}g!==null&&g.delete(s),Em(n,c)}function eg(n,s){return Js(n,s)}var wd=null,ec=null,Td=!1,fs=!1,Po=!1,dl=0;function ds(n){n!==ec&&n.next===null&&(ec===null?wd=ec=n:ec=ec.next=n),fs=!0,Td||(Td=!0,ih())}function of(n,s){if(!Po&&fs){Po=!0;do for(var c=!1,g=wd;g!==null;){if(n!==0){var b=g.pendingLanes;if(b===0)var E=0;else{var O=g.suspendedLanes,W=g.pingedLanes;E=(1<<31-j(42|n)+1)-1,E&=b&~(O&~W),E=E&201326741?E&201326741|1:E?E|2:0}E!==0&&(c=!0,Ad(g,E))}else E=si,E=It(g,g===Xi?E:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(E&3)===0||kt(g,E)||(c=!0,Ad(g,E));g=g.next}while(c);Po=!1}}function Sd(){Md()}function Md(){fs=Td=!1;var n=0;dl!==0&&ag()&&(n=dl);for(var s=Ln(),c=null,g=wd;g!==null;){var b=g.next,E=Am(g,s);E===0?(g.next=null,c===null?wd=b:c.next=b,b===null&&(ec=c)):(c=g,(n!==0||(E&3)!==0)&&(fs=!0)),g=b}sr!==0&&sr!==5||of(n),dl!==0&&(dl=0)}function Am(n,s){for(var c=n.suspendedLanes,g=n.pingedLanes,b=n.expirationTimes,E=n.pendingLanes&-62914561;0<E;){var O=31-j(E),W=1<<O,gt=b[O];gt===-1?((W&c)===0||(W&g)!==0)&&(b[O]=Ot(W,s)):gt<=s&&(n.expiredLanes|=W),E&=~W}if(s=Xi,c=si,c=It(n,n===s?c:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),g=n.callbackNode,c===0||n===s&&(Bi===2||Bi===9)||n.cancelPendingCommit!==null)return g!==null&&g!==null&&Ua(g),n.callbackNode=null,n.callbackPriority=0;if((c&3)===0||kt(n,c)){if(s=c&-c,s===n.callbackPriority)return s;switch(g!==null&&Ua(g),Di(c)){case 2:case 8:c=Cl;break;case 32:c=Va;break;case 268435456:c=ms;break;default:c=Va}return g=Ed.bind(null,n),c=Js(c,g),n.callbackPriority=s,n.callbackNode=c,s}return g!==null&&g!==null&&Ua(g),n.callbackPriority=2,n.callbackNode=null,2}function Ed(n,s){if(sr!==0&&sr!==5)return n.callbackNode=null,n.callbackPriority=0,null;var c=n.callbackNode;if(sf()&&n.callbackNode!==c)return null;var g=si;return g=It(n,n===Xi?g:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),g===0?null:(bp(n,g,s),Am(n,Ln()),n.callbackNode!=null&&n.callbackNode===c?Ed.bind(null,n):null)}function Ad(n,s){if(sf())return null;bp(n,s,!0)}function ih(){pl(function(){(mi&6)!==0?Js(Al,Sd):Md()})}function Cd(){if(dl===0){var n=as;n===0&&(n=ut,ut<<=1,(ut&261888)===0&&(ut=256)),dl=n}return dl}function zp(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Sr(""+n)}function zd(n,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,n.id&&c.setAttribute("form",n.id),s.parentNode.insertBefore(c,s),n=new FormData(n),c.parentNode.removeChild(c),n}function Cm(n,s,c,g,b){if(s==="submit"&&c&&c.stateNode===b){var E=zp((b[se]||null).action),O=g.submitter;O&&(s=(s=O[se]||null)?zp(s.formAction):O.getAttribute("formAction"),s!==null&&(E=s,O=null));var W=new Be("action","action",null,g,b);n.push({event:W,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(dl!==0){var gt=O?zd(b,O):new FormData(b);Ia(c,{pending:!0,data:gt,method:b.method,action:E},null,gt)}}else typeof E=="function"&&(W.preventDefault(),gt=O?zd(b,O):new FormData(b),Ia(c,{pending:!0,data:gt,method:b.method,action:E},E,gt))},currentTarget:b}]})}}for(var nh=0;nh<Eu.length;nh++){var Dd=Eu[nh],ig=Dd.toLowerCase(),ng=Dd[0].toUpperCase()+Dd.slice(1);tr(ig,"on"+ng)}tr(Su,"onAnimationEnd"),tr(Rc,"onAnimationIteration"),tr(oo,"onAnimationStart"),tr("dblclick","onDoubleClick"),tr("focusin","onFocus"),tr("focusout","onBlur"),tr(Mu,"onTransitionRun"),tr(Fl,"onTransitionStart"),tr(ua,"onTransitionCancel"),tr(Rh,"onTransitionEnd"),Tr("onMouseEnter",["mouseout","mouseover"]),Tr("onMouseLeave",["mouseout","mouseover"]),Tr("onPointerEnter",["pointerout","pointerover"]),Tr("onPointerLeave",["pointerout","pointerover"]),Oo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Oo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Oo("onBeforeInput",["compositionend","keypress","textInput","paste"]),Oo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Oo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Oo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(lf));function zm(n,s){s=(s&4)!==0;for(var c=0;c<n.length;c++){var g=n[c],b=g.event;g=g.listeners;t:{var E=void 0;if(s)for(var O=g.length-1;0<=O;O--){var W=g[O],gt=W.instance,Lt=W.currentTarget;if(W=W.listener,gt!==E&&b.isPropagationStopped())break t;E=W,b.currentTarget=Lt;try{E(b)}catch(Vt){Yo(Vt)}b.currentTarget=null,E=gt}else for(O=0;O<g.length;O++){if(W=g[O],gt=W.instance,Lt=W.currentTarget,W=W.listener,gt!==E&&b.isPropagationStopped())break t;E=W,b.currentTarget=Lt;try{E(b)}catch(Vt){Yo(Vt)}b.currentTarget=null,E=gt}}}}function Je(n,s){var c=s[cr];c===void 0&&(c=s[cr]=new Set);var g=n+"__bubble";c.has(g)||(Dp(s,n,2,!1),c.add(g))}function Io(n,s,c){var g=0;s&&(g|=4),Dp(c,n,g,s)}var uf="_reactListening"+Math.random().toString(36).slice(2);function Pd(n){if(!n[uf]){n[uf]=!0,Br.forEach(function(c){c!=="selectionchange"&&(rg.has(c)||Io(c,!1,n),Io(c,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[uf]||(s[uf]=!0,Io("selectionchange",!1,s))}}function Dp(n,s,c,g){switch(Vm(s)){case 2:var b=cg;break;case 8:b=jm;break;default:b=Zd}c=b.bind(null,s,c,n),b=void 0,!Zn||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),g?b!==void 0?n.addEventListener(s,c,{capture:!0,passive:b}):n.addEventListener(s,c,!0):b!==void 0?n.addEventListener(s,c,{passive:b}):n.addEventListener(s,c,!1)}function Id(n,s,c,g,b){var E=g;if((s&1)===0&&(s&2)===0&&g!==null)t:for(;;){if(g===null)return;var O=g.tag;if(O===3||O===4){var W=g.stateNode.containerInfo;if(W===b)break;if(O===4)for(O=g.return;O!==null;){var gt=O.tag;if((gt===3||gt===4)&&O.stateNode.containerInfo===b)return;O=O.return}for(;W!==null;){if(O=va(W),O===null)return;if(gt=O.tag,gt===5||gt===6||gt===26||gt===27){g=E=O;continue t}W=W.parentNode}}g=g.return}gu(function(){var Lt=E,Vt=cn(c),Yt=[];t:{var Bt=Lh.get(n);if(Bt!==void 0){var Ft=Be,ye=n;switch(n){case"keypress":if(io(c)===0)break t;case"keydown":case"keyup":Ft=wc;break;case"focusin":ye="focus",Ft=ro;break;case"focusout":ye="blur",Ft=ro;break;case"beforeblur":case"afterblur":Ft=ro;break;case"click":if(c.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ft=_u;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ft=vu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ft=Tc;break;case Su:case Rc:case oo:Ft=Ya;break;case Rh:Ft=Nr;break;case"scroll":case"scrollend":Ft=Qe;break;case"wheel":Ft=jo;break;case"copy":case"cut":case"paste":Ft=xc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ft=kf;break;case"toggle":case"beforetoggle":Ft=xu}var ke=(s&4)!==0,Ni=!ke&&(n==="scroll"||n==="scrollend"),St=ke?Bt!==null?Bt+"Capture":null:Bt;ke=[];for(var bt=Lt,Rt;bt!==null;){var Xt=bt;if(Rt=Xt.stateNode,Xt=Xt.tag,Xt!==5&&Xt!==26&&Xt!==27||Rt===null||St===null||(Xt=kn(bt,St),Xt!=null&&ke.push(rh(bt,Xt,Rt))),Ni)break;bt=bt.return}0<ke.length&&(Bt=new Ft(Bt,ye,null,c,Vt),Yt.push({event:Bt,listeners:ke}))}}if((s&7)===0){t:{if(Bt=n==="mouseover"||n==="pointerover",Ft=n==="mouseout"||n==="pointerout",Bt&&c!==Ha&&(ye=c.relatedTarget||c.fromElement)&&(va(ye)||ye[be]))break t;if((Ft||Bt)&&(Bt=Vt.window===Vt?Vt:(Bt=Vt.ownerDocument)?Bt.defaultView||Bt.parentWindow:window,Ft?(ye=c.relatedTarget||c.toElement,Ft=Lt,ye=ye?va(ye):null,ye!==null&&(Ni=ft(ye),ke=ye.tag,ye!==Ni||ke!==5&&ke!==27&&ke!==6)&&(ye=null)):(Ft=null,ye=Lt),Ft!==ye)){if(ke=_u,Xt="onMouseLeave",St="onMouseEnter",bt="mouse",(n==="pointerout"||n==="pointerover")&&(ke=kf,Xt="onPointerLeave",St="onPointerEnter",bt="pointer"),Ni=Ft==null?Bt:xa(Ft),Rt=ye==null?Bt:xa(ye),Bt=new ke(Xt,bt+"leave",Ft,c,Vt),Bt.target=Ni,Bt.relatedTarget=Rt,Xt=null,va(Vt)===Lt&&(ke=new ke(St,bt+"enter",ye,c,Vt),ke.target=Rt,ke.relatedTarget=Ni,Xt=ke),Ni=Xt,Ft&&ye)e:{for(ke=Rd,St=Ft,bt=ye,Rt=0,Xt=St;Xt;Xt=ke(Xt))Rt++;Xt=0;for(var Ae=bt;Ae;Ae=ke(Ae))Xt++;for(;0<Rt-Xt;)St=ke(St),Rt--;for(;0<Xt-Rt;)bt=ke(bt),Xt--;for(;Rt--;){if(St===bt||bt!==null&&St===bt.alternate){ke=St;break e}St=ke(St),bt=ke(bt)}ke=null}else ke=null;Ft!==null&&Pp(Yt,Bt,Ft,ke,!1),ye!==null&&Ni!==null&&Pp(Yt,Ni,ye,ke,!0)}}t:{if(Bt=Lt?xa(Lt):window,Ft=Bt.nodeName&&Bt.nodeName.toLowerCase(),Ft==="select"||Ft==="input"&&Bt.type==="file")var hi=Ah;else if(Ec(Bt))if(Ch)hi=Dh;else{hi=Ac;var Te=Vf}else Ft=Bt.nodeName,!Ft||Ft.toLowerCase()!=="input"||Bt.type!=="checkbox"&&Bt.type!=="radio"?Lt&&qa(Lt.elementType)&&(hi=Ah):hi=zh;if(hi&&(hi=hi(n,Lt))){Mh(Yt,hi,c,Vt);break t}Te&&Te(n,Bt,Lt),n==="focusout"&&Lt&&Bt.type==="number"&&Lt.memoizedProps.value!=null&&pu(Bt,"number",Bt.value)}switch(Te=Lt?xa(Lt):window,n){case"focusin":(Ec(Te)||Te.contentEditable==="true")&&(ao=Te,Ph=Lt,ei=null);break;case"focusout":ei=Ph=ao=null;break;case"mousedown":Ih=!0;break;case"contextmenu":case"mouseup":case"dragend":Ih=!1,Zf(Yt,c,Vt);break;case"selectionchange":if($o)break;case"keydown":case"keyup":Zf(Yt,c,Vt)}var He;if(Th)t:{switch(n){case"compositionstart":var ni="onCompositionStart";break t;case"compositionend":ni="onCompositionEnd";break t;case"compositionupdate":ni="onCompositionUpdate";break t}ni=void 0}else Zo?Sh(n,c)&&(ni="onCompositionEnd"):n==="keydown"&&c.keyCode===229&&(ni="onCompositionStart");ni&&(bs&&c.locale!=="ko"&&(Zo||ni!=="onCompositionStart"?ni==="onCompositionEnd"&&Zo&&(He=vs()):(Mr=Vt,Ri="value"in Mr?Mr.value:Mr.textContent,Zo=!0)),Te=cf(Lt,ni),0<Te.length&&(ni=new qn(ni,n,null,c,Vt),Yt.push({event:ni,listeners:Te}),He?ni.data=He:(He=Go(c),He!==null&&(ni.data=He)))),(He=bu?Ff(n,c):np(n,c))&&(ni=cf(Lt,"onBeforeInput"),0<ni.length&&(Te=new qn("onBeforeInput","beforeinput",null,c,Vt),Yt.push({event:Te,listeners:ni}),Te.data=He)),Cm(Yt,n,Lt,c,Vt)}zm(Yt,s)})}function rh(n,s,c){return{instance:n,listener:s,currentTarget:c}}function cf(n,s){for(var c=s+"Capture",g=[];n!==null;){var b=n,E=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||E===null||(b=kn(n,c),b!=null&&g.unshift(rh(n,b,E)),b=kn(n,s),b!=null&&g.push(rh(n,b,E))),n.tag===3)return g;n=n.return}return[]}function Rd(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function Pp(n,s,c,g,b){for(var E=s._reactName,O=[];c!==null&&c!==g;){var W=c,gt=W.alternate,Lt=W.stateNode;if(W=W.tag,gt!==null&&gt===g)break;W!==5&&W!==26&&W!==27||Lt===null||(gt=Lt,b?(Lt=kn(c,E),Lt!=null&&O.unshift(rh(c,Lt,gt))):b||(Lt=kn(c,E),Lt!=null&&O.push(rh(c,Lt,gt)))),c=c.return}O.length!==0&&n.push({event:s,listeners:O})}var hf=/\r\n?/g,Dm=/\u0000|\uFFFD/g;function Ld(n){return(typeof n=="string"?n:""+n).replace(hf,`
`).replace(Dm,"")}function Ip(n,s){return s=Ld(s),Ld(n)===s}function We(n,s,c,g,b,E){switch(c){case"children":typeof g=="string"?s==="body"||s==="textarea"&&g===""||No(n,g):(typeof g=="number"||typeof g=="bigint")&&s!=="body"&&No(n,""+g);break;case"className":Pl(n,"class",g);break;case"tabIndex":Pl(n,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":Pl(n,c,g);break;case"style":If(n,g,E);break;case"data":if(s!=="object"){Pl(n,"data",g);break}case"src":case"href":if(g===""&&(s!=="a"||c!=="href")){n.removeAttribute(c);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){n.removeAttribute(c);break}g=Sr(""+g),n.setAttribute(c,g);break;case"action":case"formAction":if(typeof g=="function"){n.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(c==="formAction"?(s!=="input"&&We(n,s,"name",b.name,b,null),We(n,s,"formEncType",b.formEncType,b,null),We(n,s,"formMethod",b.formMethod,b,null),We(n,s,"formTarget",b.formTarget,b,null)):(We(n,s,"encType",b.encType,b,null),We(n,s,"method",b.method,b,null),We(n,s,"target",b.target,b,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){n.removeAttribute(c);break}g=Sr(""+g),n.setAttribute(c,g);break;case"onClick":g!=null&&(n.onclick=Ne);break;case"onScroll":g!=null&&Je("scroll",n);break;case"onScrollEnd":g!=null&&Je("scrollend",n);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(Z(61));if(c=g.__html,c!=null){if(b.children!=null)throw Error(Z(60));n.innerHTML=c}}break;case"multiple":n.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":n.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){n.removeAttribute("xlink:href");break}c=Sr(""+g),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?n.setAttribute(c,""+g):n.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?n.setAttribute(c,""):n.removeAttribute(c);break;case"capture":case"download":g===!0?n.setAttribute(c,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?n.setAttribute(c,g):n.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?n.setAttribute(c,g):n.removeAttribute(c);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?n.removeAttribute(c):n.setAttribute(c,g);break;case"popover":Je("beforetoggle",n),Je("toggle",n),_s(n,"popover",g);break;case"xlinkActuate":Or(n,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":Or(n,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":Or(n,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":Or(n,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":Or(n,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":Or(n,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":Or(n,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":Or(n,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":Or(n,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":_s(n,"is",g);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Uo.get(c)||c,_s(n,c,g))}}function au(n,s,c,g,b,E){switch(c){case"style":If(n,g,E);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(Z(61));if(c=g.__html,c!=null){if(b.children!=null)throw Error(Z(60));n.innerHTML=c}}break;case"children":typeof g=="string"?No(n,g):(typeof g=="number"||typeof g=="bigint")&&No(n,""+g);break;case"onScroll":g!=null&&Je("scroll",n);break;case"onScrollEnd":g!=null&&Je("scrollend",n);break;case"onClick":g!=null&&(n.onclick=Ne);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ii.hasOwnProperty(c))t:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),s=c.slice(2,b?c.length-7:void 0),E=n[se]||null,E=E!=null?E[c]:null,typeof E=="function"&&n.removeEventListener(s,E,b),typeof g=="function")){typeof E!="function"&&E!==null&&(c in n?n[c]=null:n.hasAttribute(c)&&n.removeAttribute(c)),n.addEventListener(s,g,b);break t}c in n?n[c]=g:g===!0?n.setAttribute(c,""):_s(n,c,g)}}}function Un(n,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Je("error",n),Je("load",n);var g=!1,b=!1,E;for(E in c)if(c.hasOwnProperty(E)){var O=c[E];if(O!=null)switch(E){case"src":g=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(Z(137,s));default:We(n,s,E,O,c,null)}}b&&We(n,s,"srcSet",c.srcSet,c,null),g&&We(n,s,"src",c.src,c,null);return;case"input":Je("invalid",n);var W=E=O=b=null,gt=null,Lt=null;for(g in c)if(c.hasOwnProperty(g)){var Vt=c[g];if(Vt!=null)switch(g){case"name":b=Vt;break;case"type":O=Vt;break;case"checked":gt=Vt;break;case"defaultChecked":Lt=Vt;break;case"value":E=Vt;break;case"defaultValue":W=Vt;break;case"children":case"dangerouslySetInnerHTML":if(Vt!=null)throw Error(Z(137,s));break;default:We(n,s,g,Vt,c,null)}}yc(n,E,W,gt,Lt,O,b,!1);return;case"select":Je("invalid",n),g=O=E=null;for(b in c)if(c.hasOwnProperty(b)&&(W=c[b],W!=null))switch(b){case"value":E=W;break;case"defaultValue":O=W;break;case"multiple":g=W;default:We(n,s,b,W,c,null)}s=E,c=O,n.multiple=!!g,s!=null?Fo(n,!!g,s,!1):c!=null&&Fo(n,!!g,c,!0);return;case"textarea":Je("invalid",n),E=b=g=null;for(O in c)if(c.hasOwnProperty(O)&&(W=c[O],W!=null))switch(O){case"value":g=W;break;case"defaultValue":b=W;break;case"children":E=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(Z(91));break;default:We(n,s,O,W,c,null)}mu(n,g,b,E);return;case"option":for(gt in c)if(c.hasOwnProperty(gt)&&(g=c[gt],g!=null))switch(gt){case"selected":n.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:We(n,s,gt,g,c,null)}return;case"dialog":Je("beforetoggle",n),Je("toggle",n),Je("cancel",n),Je("close",n);break;case"iframe":case"object":Je("load",n);break;case"video":case"audio":for(g=0;g<lf.length;g++)Je(lf[g],n);break;case"image":Je("error",n),Je("load",n);break;case"details":Je("toggle",n);break;case"embed":case"source":case"link":Je("error",n),Je("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Lt in c)if(c.hasOwnProperty(Lt)&&(g=c[Lt],g!=null))switch(Lt){case"children":case"dangerouslySetInnerHTML":throw Error(Z(137,s));default:We(n,s,Lt,g,c,null)}return;default:if(qa(s)){for(Vt in c)c.hasOwnProperty(Vt)&&(g=c[Vt],g!==void 0&&au(n,s,Vt,g,c,void 0));return}}for(W in c)c.hasOwnProperty(W)&&(g=c[W],g!=null&&We(n,s,W,g,c,null))}function ic(n,s,c,g){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,E=null,O=null,W=null,gt=null,Lt=null,Vt=null;for(Ft in c){var Yt=c[Ft];if(c.hasOwnProperty(Ft)&&Yt!=null)switch(Ft){case"checked":break;case"value":break;case"defaultValue":gt=Yt;default:g.hasOwnProperty(Ft)||We(n,s,Ft,null,g,Yt)}}for(var Bt in g){var Ft=g[Bt];if(Yt=c[Bt],g.hasOwnProperty(Bt)&&(Ft!=null||Yt!=null))switch(Bt){case"type":E=Ft;break;case"name":b=Ft;break;case"checked":Lt=Ft;break;case"defaultChecked":Vt=Ft;break;case"value":O=Ft;break;case"defaultValue":W=Ft;break;case"children":case"dangerouslySetInnerHTML":if(Ft!=null)throw Error(Z(137,s));break;default:Ft!==Yt&&We(n,s,Bt,Ft,g,Yt)}}_c(n,O,W,gt,Lt,Vt,E,b);return;case"select":Ft=O=W=Bt=null;for(E in c)if(gt=c[E],c.hasOwnProperty(E)&&gt!=null)switch(E){case"value":break;case"multiple":Ft=gt;default:g.hasOwnProperty(E)||We(n,s,E,null,g,gt)}for(b in g)if(E=g[b],gt=c[b],g.hasOwnProperty(b)&&(E!=null||gt!=null))switch(b){case"value":Bt=E;break;case"defaultValue":W=E;break;case"multiple":O=E;default:E!==gt&&We(n,s,b,E,g,gt)}s=W,c=O,g=Ft,Bt!=null?Fo(n,!!c,Bt,!1):!!g!=!!c&&(s!=null?Fo(n,!!c,s,!0):Fo(n,!!c,c?[]:"",!1));return;case"textarea":Ft=Bt=null;for(W in c)if(b=c[W],c.hasOwnProperty(W)&&b!=null&&!g.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:We(n,s,W,null,g,b)}for(O in g)if(b=g[O],E=c[O],g.hasOwnProperty(O)&&(b!=null||E!=null))switch(O){case"value":Bt=b;break;case"defaultValue":Ft=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(Z(91));break;default:b!==E&&We(n,s,O,b,g,E)}Ga(n,Bt,Ft);return;case"option":for(var ye in c)if(Bt=c[ye],c.hasOwnProperty(ye)&&Bt!=null&&!g.hasOwnProperty(ye))switch(ye){case"selected":n.selected=!1;break;default:We(n,s,ye,null,g,Bt)}for(gt in g)if(Bt=g[gt],Ft=c[gt],g.hasOwnProperty(gt)&&Bt!==Ft&&(Bt!=null||Ft!=null))switch(gt){case"selected":n.selected=Bt&&typeof Bt!="function"&&typeof Bt!="symbol";break;default:We(n,s,gt,Bt,g,Ft)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ke in c)Bt=c[ke],c.hasOwnProperty(ke)&&Bt!=null&&!g.hasOwnProperty(ke)&&We(n,s,ke,null,g,Bt);for(Lt in g)if(Bt=g[Lt],Ft=c[Lt],g.hasOwnProperty(Lt)&&Bt!==Ft&&(Bt!=null||Ft!=null))switch(Lt){case"children":case"dangerouslySetInnerHTML":if(Bt!=null)throw Error(Z(137,s));break;default:We(n,s,Lt,Bt,g,Ft)}return;default:if(qa(s)){for(var Ni in c)Bt=c[Ni],c.hasOwnProperty(Ni)&&Bt!==void 0&&!g.hasOwnProperty(Ni)&&au(n,s,Ni,void 0,g,Bt);for(Vt in g)Bt=g[Vt],Ft=c[Vt],!g.hasOwnProperty(Vt)||Bt===Ft||Bt===void 0&&Ft===void 0||au(n,s,Vt,Bt,g,Ft);return}}for(var St in c)Bt=c[St],c.hasOwnProperty(St)&&Bt!=null&&!g.hasOwnProperty(St)&&We(n,s,St,null,g,Bt);for(Yt in g)Bt=g[Yt],Ft=c[Yt],!g.hasOwnProperty(Yt)||Bt===Ft||Bt==null&&Ft==null||We(n,s,Yt,Bt,g,Ft)}function Rp(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Pm(){if(typeof performance.getEntriesByType=="function"){for(var n=0,s=0,c=performance.getEntriesByType("resource"),g=0;g<c.length;g++){var b=c[g],E=b.transferSize,O=b.initiatorType,W=b.duration;if(E&&W&&Rp(O)){for(O=0,W=b.responseEnd,g+=1;g<c.length;g++){var gt=c[g],Lt=gt.startTime;if(Lt>W)break;var Vt=gt.transferSize,Yt=gt.initiatorType;Vt&&Rp(Yt)&&(gt=gt.responseEnd,O+=Vt*(gt<W?1:(W-Lt)/(gt-Lt)))}if(--g,s+=8*(E+O)/(b.duration/1e3),n++,10<n)break}}if(0<n)return s/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var su=null,ah=null;function sh(n){return n.nodeType===9?n:n.ownerDocument}function kd(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Lp(n,s){if(n===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&s==="foreignObject"?0:n}function ff(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var df=null;function ag(){var n=window.event;return n&&n.type==="popstate"?n===df?!1:(df=n,!0):(df=null,!1)}var Im=typeof setTimeout=="function"?setTimeout:void 0,pr=typeof clearTimeout=="function"?clearTimeout:void 0,qe=typeof Promise=="function"?Promise:void 0,pl=typeof queueMicrotask=="function"?queueMicrotask:typeof qe<"u"?function(n){return qe.resolve(null).then(n).catch(Hs)}:Im;function Hs(n){setTimeout(function(){throw n})}function ma(n){return n==="head"}function aa(n,s){var c=s,g=0;do{var b=c.nextSibling;if(n.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(g===0){n.removeChild(b),fc(s);return}g--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")g++;else if(c==="html")lh(n.ownerDocument.documentElement);else if(c==="head"){c=n.ownerDocument.head,lh(c);for(var E=c.firstChild;E;){var O=E.nextSibling,W=E.nodeName;E[Qr]||W==="SCRIPT"||W==="STYLE"||W==="LINK"&&E.rel.toLowerCase()==="stylesheet"||c.removeChild(E),E=O}}else c==="body"&&lh(n.ownerDocument.body);c=b}while(c);fc(s)}function jn(n,s){var c=n;n=0;do{var g=c.nextSibling;if(c.nodeType===1?s?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(s?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),g&&g.nodeType===8)if(c=g.data,c==="/$"){if(n===0)break;n--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||n++;c=g}while(c)}function Rn(n){var s=n.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Rn(c),eo(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}n.removeChild(c)}}function Rm(n,s,c,g){for(;n.nodeType===1;){var b=c;if(n.nodeName.toLowerCase()!==s.toLowerCase()){if(!g&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(g){if(!n[Qr])switch(s){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(E=n.getAttribute("rel"),E==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(E!==b.rel||n.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||n.getAttribute("title")!==(b.title==null?null:b.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(E=n.getAttribute("src"),(E!==(b.src==null?null:b.src)||n.getAttribute("type")!==(b.type==null?null:b.type)||n.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&E&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(s==="input"&&n.type==="hidden"){var E=b.name==null?null:""+b.name;if(b.type==="hidden"&&n.getAttribute("name")===E)return n}else return n;if(n=Ba(n.nextSibling),n===null)break}return null}function ka(n,s,c){if(s==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!c||(n=Ba(n.nextSibling),n===null))return null;return n}function Bd(n,s){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!s||(n=Ba(n.nextSibling),n===null))return null;return n}function Tn(n){return n.data==="$?"||n.data==="$~"}function oh(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function sg(n,s){var c=n.ownerDocument;if(n.data==="$~")n._reactRetry=s;else if(n.data!=="$?"||c.readyState!=="loading")s();else{var g=function(){s(),c.removeEventListener("DOMContentLoaded",g)};c.addEventListener("DOMContentLoaded",g),n._reactRetry=g}}function Ba(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return n}var ml=null;function nc(n){n=n.nextSibling;for(var s=0;n;){if(n.nodeType===8){var c=n.data;if(c==="/$"||c==="/&"){if(s===0)return Ba(n.nextSibling);s--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||s++}n=n.nextSibling}return null}function Lm(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var c=n.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(s===0)return n;s--}else c!=="/$"&&c!=="/&"||s++}n=n.previousSibling}return null}function kp(n,s,c){switch(s=sh(c),n){case"html":if(n=s.documentElement,!n)throw Error(Z(452));return n;case"head":if(n=s.head,!n)throw Error(Z(453));return n;case"body":if(n=s.body,!n)throw Error(Z(454));return n;default:throw Error(Z(451))}}function lh(n){for(var s=n.attributes;s.length;)n.removeAttributeNode(s[0]);eo(n)}var Oa=new Map,Od=new Set;function pf(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var Xr=ne.d;ne.d={f:rc,r:Fd,D:Xs,C:Oe,L:km,m:Bm,X:og,S:uh,M:ch};function rc(){var n=Xr.f(),s=vd();return n||s}function Fd(n){var s=hr(n);s!==null&&s.tag===5&&s.type==="form"?To(s):Xr.r(n)}var Ro=typeof document>"u"?null:document;function mr(n,s,c){var g=Ro;if(g&&typeof s=="string"&&s){var b=Fr(s);b='link[rel="'+n+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),Od.has(b)||(Od.add(b),n={rel:n,crossOrigin:c,href:s},g.querySelector(b)===null&&(s=g.createElement("link"),Un(s,"link",n),nn(s),g.head.appendChild(s)))}}function Xs(n){Xr.D(n),mr("dns-prefetch",n,null)}function Oe(n,s){Xr.C(n,s),mr("preconnect",n,s)}function km(n,s,c){Xr.L(n,s,c);var g=Ro;if(g&&n&&s){var b='link[rel="preload"][as="'+Fr(s)+'"]';s==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+Fr(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+Fr(c.imageSizes)+'"]')):b+='[href="'+Fr(n)+'"]';var E=b;switch(s){case"style":E=ac(n);break;case"script":E=lu(n)}Oa.has(E)||(n=jt({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:n,as:s},c),Oa.set(E,n),g.querySelector(b)!==null||s==="style"&&g.querySelector(ou(E))||s==="script"&&g.querySelector(sc(E))||(s=g.createElement("link"),Un(s,"link",n),nn(s),g.head.appendChild(s)))}}function Bm(n,s){Xr.m(n,s);var c=Ro;if(c&&n){var g=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+Fr(g)+'"][href="'+Fr(n)+'"]',E=b;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=lu(n)}if(!Oa.has(E)&&(n=jt({rel:"modulepreload",href:n},s),Oa.set(E,n),c.querySelector(b)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(sc(E)))return}g=c.createElement("link"),Un(g,"link",n),nn(g),c.head.appendChild(g)}}}function uh(n,s,c){Xr.S(n,s,c);var g=Ro;if(g&&n){var b=ba(g).hoistableStyles,E=ac(n);s=s||"default";var O=b.get(E);if(!O){var W={loading:0,preload:null};if(O=g.querySelector(ou(E)))W.loading=5;else{n=jt({rel:"stylesheet",href:n,"data-precedence":s},c),(c=Oa.get(E))&&oc(n,c);var gt=O=g.createElement("link");nn(gt),Un(gt,"link",n),gt._p=new Promise(function(Lt,Vt){gt.onload=Lt,gt.onerror=Vt}),gt.addEventListener("load",function(){W.loading|=1}),gt.addEventListener("error",function(){W.loading|=2}),W.loading|=4,gf(O,s,g)}O={type:"stylesheet",instance:O,count:1,state:W},b.set(E,O)}}}function og(n,s){Xr.X(n,s);var c=Ro;if(c&&n){var g=ba(c).hoistableScripts,b=lu(n),E=g.get(b);E||(E=c.querySelector(sc(b)),E||(n=jt({src:n,async:!0},s),(s=Oa.get(b))&&lc(n,s),E=c.createElement("script"),nn(E),Un(E,"link",n),c.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},g.set(b,E))}}function ch(n,s){Xr.M(n,s);var c=Ro;if(c&&n){var g=ba(c).hoistableScripts,b=lu(n),E=g.get(b);E||(E=c.querySelector(sc(b)),E||(n=jt({src:n,async:!0,type:"module"},s),(s=Oa.get(b))&&lc(n,s),E=c.createElement("script"),nn(E),Un(E,"link",n),c.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},g.set(b,E))}}function Om(n,s,c,g){var b=(b=ze.current)?pf(b):null;if(!b)throw Error(Z(446));switch(n){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=ac(c.href),c=ba(b).hoistableStyles,g=c.get(s),g||(g={type:"style",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){n=ac(c.href);var E=ba(b).hoistableStyles,O=E.get(n);if(O||(b=b.ownerDocument||b,O={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(n,O),(E=b.querySelector(ou(n)))&&!E._p&&(O.instance=E,O.state.loading=5),Oa.has(n)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Oa.set(n,c),E||Nd(b,n,c,O.state))),s&&g===null)throw Error(Z(528,""));return O}if(s&&g!==null)throw Error(Z(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=lu(c),c=ba(b).hoistableScripts,g=c.get(s),g||(g={type:"script",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(Z(444,n))}}function ac(n){return'href="'+Fr(n)+'"'}function ou(n){return'link[rel="stylesheet"]['+n+"]"}function mf(n){return jt({},n,{"data-precedence":n.precedence,precedence:null})}function Nd(n,s,c,g){n.querySelector('link[rel="preload"][as="style"]['+s+"]")?g.loading=1:(s=n.createElement("link"),g.preload=s,s.addEventListener("load",function(){return g.loading|=1}),s.addEventListener("error",function(){return g.loading|=2}),Un(s,"link",c),nn(s),n.head.appendChild(s))}function lu(n){return'[src="'+Fr(n)+'"]'}function sc(n){return"script[async]"+n}function Ud(n,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var g=n.querySelector('style[data-href~="'+Fr(c.href)+'"]');if(g)return s.instance=g,nn(g),g;var b=jt({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return g=(n.ownerDocument||n).createElement("style"),nn(g),Un(g,"style",b),gf(g,c.precedence,n),s.instance=g;case"stylesheet":b=ac(c.href);var E=n.querySelector(ou(b));if(E)return s.state.loading|=4,s.instance=E,nn(E),E;g=mf(c),(b=Oa.get(b))&&oc(g,b),E=(n.ownerDocument||n).createElement("link"),nn(E);var O=E;return O._p=new Promise(function(W,gt){O.onload=W,O.onerror=gt}),Un(E,"link",g),s.state.loading|=4,gf(E,c.precedence,n),s.instance=E;case"script":return E=lu(c.src),(b=n.querySelector(sc(E)))?(s.instance=b,nn(b),b):(g=c,(b=Oa.get(E))&&(g=jt({},c),lc(g,b)),n=n.ownerDocument||n,b=n.createElement("script"),nn(b),Un(b,"link",g),n.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(Z(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(g=s.instance,s.state.loading|=4,gf(g,c.precedence,n));return s.instance}function gf(n,s,c){for(var g=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=g.length?g[g.length-1]:null,E=b,O=0;O<g.length;O++){var W=g[O];if(W.dataset.precedence===s)E=W;else if(E!==b)break}E?E.parentNode.insertBefore(n,E.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(n,s.firstChild))}function oc(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.title==null&&(n.title=s.title)}function lc(n,s){n.crossOrigin==null&&(n.crossOrigin=s.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=s.referrerPolicy),n.integrity==null&&(n.integrity=s.integrity)}var _f=null;function yf(n,s,c){if(_f===null){var g=new Map,b=_f=new Map;b.set(c,g)}else b=_f,g=b.get(c),g||(g=new Map,b.set(c,g));if(g.has(n))return g;for(g.set(n,null),c=c.getElementsByTagName(n),b=0;b<c.length;b++){var E=c[b];if(!(E[Qr]||E[Ht]||n==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var O=E.getAttribute(s)||"";O=n+O;var W=g.get(O);W?W.push(E):g.set(O,[E])}}return g}function vf(n,s,c){n=n.ownerDocument||n,n.head.insertBefore(c,s==="title"?n.querySelector("head > title"):null)}function lg(n,s,c){if(c===1||s.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return n=s.disabled,typeof s.precedence=="string"&&n==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function jd(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function Fm(n,s,c,g){if(c.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=ac(g.href),E=s.querySelector(ou(b));if(E){s=E._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(n.count++,n=xf.bind(n),s.then(n,n)),c.state.loading|=4,c.instance=E,nn(E);return}E=s.ownerDocument||s,g=mf(g),(b=Oa.get(b))&&oc(g,b),E=E.createElement("link"),nn(E);var O=E;O._p=new Promise(function(W,gt){O.onload=W,O.onerror=gt}),Un(E,"link",g),c.instance=E}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(n.count++,c=xf.bind(n),s.addEventListener("load",c),s.addEventListener("error",c))}}var Bp=0;function ug(n,s){return n.stylesheets&&n.count===0&&uu(n,n.stylesheets),0<n.count||0<n.imgCount?function(c){var g=setTimeout(function(){if(n.stylesheets&&uu(n,n.stylesheets),n.unsuspend){var E=n.unsuspend;n.unsuspend=null,E()}},6e4+s);0<n.imgBytes&&Bp===0&&(Bp=62500*Pm());var b=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&uu(n,n.stylesheets),n.unsuspend)){var E=n.unsuspend;n.unsuspend=null,E()}},(n.imgBytes>Bp?50:800)+s);return n.unsuspend=c,function(){n.unsuspend=null,clearTimeout(g),clearTimeout(b)}}:null}function xf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)uu(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var Vd=null;function uu(n,s){n.stylesheets=null,n.unsuspend!==null&&(n.count++,Vd=new Map,s.forEach(Nm,n),Vd=null,xf.call(n))}function Nm(n,s){if(!(s.state.loading&4)){var c=Vd.get(n);if(c)var g=c.get(null);else{c=new Map,Vd.set(n,c);for(var b=n.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<b.length;E++){var O=b[E];(O.nodeName==="LINK"||O.getAttribute("media")!=="not all")&&(c.set(O.dataset.precedence,O),g=O)}g&&c.set(null,g)}b=s.instance,O=b.getAttribute("data-precedence"),E=c.get(O)||g,E===g&&c.set(null,b),c.set(O,b),this.count++,g=xf.bind(this),b.addEventListener("load",g),b.addEventListener("error",g),E?E.parentNode.insertBefore(b,E.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(b,n.firstChild)),s.state.loading|=4}}var bf={$$typeof:Ee,Provider:null,Consumer:null,_currentValue:Pe,_currentValue2:Pe,_threadCount:0};function Op(n,s,c,g,b,E,O,W,gt){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=xe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xe(0),this.hiddenUpdates=xe(null),this.identifierPrefix=g,this.onUncaughtError=b,this.onCaughtError=E,this.onRecoverableError=O,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=gt,this.incompleteTransitions=new Map}function Gd(n,s,c,g,b,E,O,W,gt,Lt,Vt,Yt){return n=new Op(n,s,c,O,gt,Lt,Vt,Yt,W),s=1,E===!0&&(s|=24),E=jr(3,null,null,s),n.current=E,E.stateNode=n,s=Gr(),s.refCount++,n.pooledCache=s,s.refCount++,E.memoizedState={element:g,isDehydrated:c,cache:s},_i(E),n}function Fp(n){return n?(n=Ts,n):Ts}function uc(n,s,c,g,b,E){b=Fp(b),g.context===null?g.context=b:g.pendingContext=b,g=za(s),g.payload={element:c},E=E===void 0?null:E,E!==null&&(g.callback=E),c=Da(n,g,s),c!==null&&(or(c,n,s),rl(c,n,s))}function Np(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var c=n.retryLane;n.retryLane=c!==0&&c<s?c:s}}function cc(n,s){Np(n,s),(n=n.alternate)&&Np(n,s)}function Um(n){if(n.tag===13||n.tag===31){var s=uo(n,67108864);s!==null&&or(s,n,67108864),cc(n,67108864)}}function hh(n){if(n.tag===13||n.tag===31){var s=pa();s=Qt(s);var c=uo(n,s);c!==null&&or(c,n,s),cc(n,s)}}var hc=!0;function cg(n,s,c,g){var b=Nt.T;Nt.T=null;var E=ne.p;try{ne.p=2,Zd(n,s,c,g)}finally{ne.p=E,Nt.T=b}}function jm(n,s,c,g){var b=Nt.T;Nt.T=null;var E=ne.p;try{ne.p=8,Zd(n,s,c,g)}finally{ne.p=E,Nt.T=b}}function Zd(n,s,c,g){if(hc){var b=Up(g);if(b===null)Id(n,s,g,qd,c),Gp(n,g);else if(fg(b,n,s,c,g))g.stopPropagation();else if(Gp(n,g),s&4&&-1<hg.indexOf(n)){for(;b!==null;){var E=hr(b);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var O=yt(E.pendingLanes);if(O!==0){var W=E;for(W.pendingLanes|=2,W.entangledLanes|=2;O;){var gt=1<<31-j(O);W.entanglements[1]|=gt,O&=~gt}ds(E),(mi&6)===0&&(gd=Ln()+500,of(0))}}break;case 31:case 13:W=uo(E,2),W!==null&&or(W,E,2),vd(),cc(E,2)}if(E=Up(g),E===null&&Id(n,s,g,qd,c),E===b)break;b=E}b!==null&&g.stopPropagation()}else Id(n,s,g,null,c)}}function Up(n){return n=cn(n),jp(n)}var qd=null;function jp(n){if(qd=null,n=va(n),n!==null){var s=ft(n);if(s===null)n=null;else{var c=s.tag;if(c===13){if(n=P(s),n!==null)return n;n=null}else if(c===31){if(n=d(s),n!==null)return n;n=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null)}}return qd=n,null}function Vm(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(kr()){case Al:return 2;case Cl:return 8;case Va:case zl:return 32;case ms:return 268435456;default:return 32}default:return 32}}var Vp=!1,gl=null,_l=null,yl=null,wf=new Map,fh=new Map,vl=[],hg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Gp(n,s){switch(n){case"focusin":case"focusout":gl=null;break;case"dragenter":case"dragleave":_l=null;break;case"mouseover":case"mouseout":yl=null;break;case"pointerover":case"pointerout":wf.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":fh.delete(s.pointerId)}}function Tf(n,s,c,g,b,E){return n===null||n.nativeEvent!==E?(n={blockedOn:s,domEventName:c,eventSystemFlags:g,nativeEvent:E,targetContainers:[b]},s!==null&&(s=hr(s),s!==null&&Um(s)),n):(n.eventSystemFlags|=g,s=n.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),n)}function fg(n,s,c,g,b){switch(s){case"focusin":return gl=Tf(gl,n,s,c,g,b),!0;case"dragenter":return _l=Tf(_l,n,s,c,g,b),!0;case"mouseover":return yl=Tf(yl,n,s,c,g,b),!0;case"pointerover":var E=b.pointerId;return wf.set(E,Tf(wf.get(E)||null,n,s,c,g,b)),!0;case"gotpointercapture":return E=b.pointerId,fh.set(E,Tf(fh.get(E)||null,n,s,c,g,b)),!0}return!1}function xl(n){var s=va(n.target);if(s!==null){var c=ft(s);if(c!==null){if(s=c.tag,s===13){if(s=P(c),s!==null){n.blockedOn=s,mn(n.priority,function(){hh(c)});return}}else if(s===31){if(s=d(c),s!==null){n.blockedOn=s,mn(n.priority,function(){hh(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){n.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Sf(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var c=Up(n.nativeEvent);if(c===null){c=n.nativeEvent;var g=new c.constructor(c.type,c);Ha=g,c.target.dispatchEvent(g),Ha=null}else return s=hr(c),s!==null&&Um(s),n.blockedOn=c,!1;s.shift()}return!0}function Zp(n,s,c){Sf(n)&&c.delete(s)}function Gm(){Vp=!1,gl!==null&&Sf(gl)&&(gl=null),_l!==null&&Sf(_l)&&(_l=null),yl!==null&&Sf(yl)&&(yl=null),wf.forEach(Zp),fh.forEach(Zp)}function Mf(n,s){n.blockedOn===s&&(n.blockedOn=null,Vp||(Vp=!0,V.unstable_scheduleCallback(V.unstable_NormalPriority,Gm)))}var Hd=null;function Zm(n){Hd!==n&&(Hd=n,V.unstable_scheduleCallback(V.unstable_NormalPriority,function(){Hd===n&&(Hd=null);for(var s=0;s<n.length;s+=3){var c=n[s],g=n[s+1],b=n[s+2];if(typeof g!="function"){if(jp(g||c)===null)continue;break}var E=hr(c);E!==null&&(n.splice(s,3),s-=3,Ia(E,{pending:!0,data:b,method:c.method,action:g},g,b))}}))}function fc(n){function s(gt){return Mf(gt,n)}gl!==null&&Mf(gl,n),_l!==null&&Mf(_l,n),yl!==null&&Mf(yl,n),wf.forEach(s),fh.forEach(s);for(var c=0;c<vl.length;c++){var g=vl[c];g.blockedOn===n&&(g.blockedOn=null)}for(;0<vl.length&&(c=vl[0],c.blockedOn===null);)xl(c),c.blockedOn===null&&vl.shift();if(c=(n.ownerDocument||n).$$reactFormReplay,c!=null)for(g=0;g<c.length;g+=3){var b=c[g],E=c[g+1],O=b[se]||null;if(typeof E=="function")O||Zm(c);else if(O){var W=null;if(E&&E.hasAttribute("formAction")){if(b=E,O=E[se]||null)W=O.formAction;else if(jp(b)!==null)continue}else W=O.action;typeof W=="function"?c[g+1]=W:(c.splice(g,3),g-=3),Zm(c)}}}function qp(){function n(E){E.canIntercept&&E.info==="react-transition"&&E.intercept({handler:function(){return new Promise(function(O){return b=O})},focusReset:"manual",scroll:"manual"})}function s(){b!==null&&(b(),b=null),g||setTimeout(c,20)}function c(){if(!g&&!navigation.transition){var E=navigation.currentEntry;E&&E.url!=null&&navigation.navigate(E.url,{state:E.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,b=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(c,100),function(){g=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),b!==null&&(b(),b=null)}}}function dh(n){this._internalRoot=n}Ef.prototype.render=dh.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error(Z(409));var c=s.current,g=pa();uc(c,g,n,s,null,null)},Ef.prototype.unmount=dh.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;uc(n.current,2,null,n,null,null),vd(),s[be]=null}};function Ef(n){this._internalRoot=n}Ef.prototype.unstable_scheduleHydration=function(n){if(n){var s=Pi();n={blockedOn:null,target:n,priority:s};for(var c=0;c<vl.length&&s!==0&&s<vl[c].priority;c++);vl.splice(c,0,n),c===0&&xl(n)}};var Af=$.version;if(Af!=="19.2.0")throw Error(Z(527,Af,"19.2.0"));ne.findDOMNode=function(n){var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error(Z(188)):(n=Object.keys(n).join(","),Error(Z(268,n)));return n=At(s),n=n!==null?ie(n):null,n=n===null?null:n.stateNode,n};var Xd={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Nt,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dc.isDisabled&&dc.supportsFiber)try{wr=dc.inject(Xd),Zi=dc}catch{}}return Xp.createRoot=function(n,s){if(!nt(n))throw Error(Z(299));var c=!1,g="",b=Gh,E=Kl,O=sp;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(g=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(E=s.onCaughtError),s.onRecoverableError!==void 0&&(O=s.onRecoverableError)),s=Gd(n,1,!1,null,null,c,g,null,b,E,O,qp),n[be]=s.current,Pd(n),new dh(s)},Xp.hydrateRoot=function(n,s,c){if(!nt(n))throw Error(Z(299));var g=!1,b="",E=Gh,O=Kl,W=sp,gt=null;return c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(E=c.onUncaughtError),c.onCaughtError!==void 0&&(O=c.onCaughtError),c.onRecoverableError!==void 0&&(W=c.onRecoverableError),c.formState!==void 0&&(gt=c.formState)),s=Gd(n,1,!0,s,c??null,g,b,gt,E,O,W,qp),s.context=Fp(null),c=s.current,g=pa(),g=Qt(g),b=za(g),b.callback=null,Da(c,b,g),c=g,s.current.lanes=c,Le(s,c),ds(s),n[be]=s.current,Pd(n),new Ef(s)},Xp.version="19.2.0",Xp}var $g;function J_(){if($g)return _g.exports;$g=1;function V(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(V)}catch($){console.error($)}}return V(),_g.exports=Q_(),_g.exports}var ty=J_();const ey=Mg(ty),iy="modulepreload",ny=function(V){return"/vite-react-map-gl-template/"+V},Yg={},ry=function($,H,Z){let nt=Promise.resolve();if(H&&H.length>0){let At=function(ie){return Promise.all(ie.map(jt=>Promise.resolve(jt).then(re=>({status:"fulfilled",value:re}),re=>({status:"rejected",reason:re}))))};var P=At;document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),wt=d?.nonce||d?.getAttribute("nonce");nt=At(H.map(ie=>{if(ie=ny(ie),ie in Yg)return;Yg[ie]=!0;const jt=ie.endsWith(".css"),re=jt?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${ie}"]${re}`))return;const ve=document.createElement("link");if(ve.rel=jt?"stylesheet":iy,jt||(ve.as="script"),ve.crossOrigin="",ve.href=ie,wt&&ve.setAttribute("nonce",wt),document.head.appendChild(ve),jt)return new Promise((Ke,he)=>{ve.addEventListener("load",Ke),ve.addEventListener("error",()=>he(new Error(`Unable to preload CSS for ${ie}`)))})}))}function ft(d){const wt=new Event("vite:preloadError",{cancelable:!0});if(wt.payload=d,window.dispatchEvent(wt),!wt.defaultPrevented)throw d}return nt.then(d=>{for(const wt of d||[])wt.status==="rejected"&&ft(wt.reason);return $().catch(ft)})},ay=De.createContext(null);function sy(V,$){const H=Array.isArray(V)?V[0]:V?V.x:0,Z=Array.isArray(V)?V[1]:V?V.y:0,nt=Array.isArray($)?$[0]:$?$.x:0,ft=Array.isArray($)?$[1]:$?$.y:0;return H===nt&&Z===ft}function hu(V,$){if(V===$)return!0;if(!V||!$)return!1;if(Array.isArray(V)){if(!Array.isArray($)||V.length!==$.length)return!1;for(let H=0;H<V.length;H++)if(!hu(V[H],$[H]))return!1;return!0}else if(Array.isArray($))return!1;if(typeof V=="object"&&typeof $=="object"){const H=Object.keys(V),Z=Object.keys($);if(H.length!==Z.length)return!1;for(const nt of H)if(!$.hasOwnProperty(nt)||!hu(V[nt],$[nt]))return!1;return!0}return!1}function Wg(V){return{longitude:V.center.lng,latitude:V.center.lat,zoom:V.zoom,pitch:V.pitch,bearing:V.bearing,padding:V.padding}}function Kg(V,$){const H=$.viewState||$,Z={};if("longitude"in H&&"latitude"in H&&(H.longitude!==V.center.lng||H.latitude!==V.center.lat)){const nt=V.center.constructor;Z.center=new nt(H.longitude,H.latitude)}return"zoom"in H&&H.zoom!==V.zoom&&(Z.zoom=H.zoom),"bearing"in H&&H.bearing!==V.bearing&&(Z.bearing=H.bearing),"pitch"in H&&H.pitch!==V.pitch&&(Z.pitch=H.pitch),H.padding&&V.padding&&!hu(H.padding,V.padding)&&(Z.padding=H.padding),Z}const oy=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Qg(V){if(!V)return null;if(typeof V=="string"||("toJS"in V&&(V=V.toJS()),!V.layers))return V;const $={};for(const Z of V.layers)$[Z.id]=Z;const H=V.layers.map(Z=>{let nt=null;"interactive"in Z&&(nt=Object.assign({},Z),delete nt.interactive);const ft=$[Z.ref];if(ft){nt=nt||Object.assign({},Z),delete nt.ref;for(const P of oy)P in ft&&(nt[P]=ft[P])}return nt||Z});return{...V,layers:H}}const Jg={version:8,sources:{},layers:[]},t_={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},e_={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},i_={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},ly=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],uy=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class ep{constructor($,H,Z){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=nt=>{const ft=this.props[i_[nt.type]];ft?ft(nt):nt.type==="error"&&console.error(nt.error)},this._onCameraEvent=nt=>{if(this._internalUpdate)return;nt.viewState=this._propsedCameraUpdate||Wg(this._map.transform);const ft=this.props[e_[nt.type]];ft&&ft(nt)},this._onCameraUpdate=nt=>this._internalUpdate?nt:(this._propsedCameraUpdate=Wg(nt),Kg(nt,this.props)),this._onPointerEvent=nt=>{(nt.type==="mousemove"||nt.type==="mouseout")&&this._updateHover(nt);const ft=this.props[t_[nt.type]];ft&&(this.props.interactiveLayerIds&&nt.type!=="mouseover"&&nt.type!=="mouseout"&&(nt.features=this._hoveredFeatures||this._queryRenderedFeatures(nt.point)),ft(nt),delete nt.features)},this._MapClass=$,this.props=H,this._initialize(Z)}get map(){return this._map}setProps($){const H=this.props;this.props=$;const Z=this._updateSettings($,H),nt=this._updateSize($),ft=this._updateViewState($);this._updateStyle($,H),this._updateStyleComponents($),this._updateHandlers($,H),(Z||nt||ft&&!this._map.isMoving())&&this.redraw()}static reuse($,H){const Z=ep.savedMaps.pop();if(!Z)return null;const nt=Z.map,ft=nt.getContainer();for(H.className=ft.className;ft.childNodes.length>0;)H.appendChild(ft.childNodes[0]);nt._container=H;const P=nt._resizeObserver;P&&(P.disconnect(),P.observe(H)),Z.setProps({...$,styleDiffing:!1}),nt.resize();const{initialViewState:d}=$;return d&&(d.bounds?nt.fitBounds(d.bounds,{...d.fitBoundsOptions,duration:0}):Z._updateViewState(d)),nt.isStyleLoaded()?nt.fire("load"):nt.once("style.load",()=>nt.fire("load")),nt._update(),Z}_initialize($){const{props:H}=this,{mapStyle:Z=Jg}=H,nt={...H,...H.initialViewState,container:$,style:Qg(Z)},ft=nt.initialViewState||nt.viewState||nt;if(Object.assign(nt,{center:[ft.longitude||0,ft.latitude||0],zoom:ft.zoom||0,pitch:ft.pitch||0,bearing:ft.bearing||0}),H.gl){const d=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=d,H.gl)}const P=new this._MapClass(nt);ft.padding&&P.setPadding(ft.padding),H.cursor&&(P.getCanvas().style.cursor=H.cursor),P.transformCameraUpdate=this._onCameraUpdate,P.on("style.load",()=>{this._styleComponents={light:P.getLight(),sky:P.getSky(),projection:P.getProjection?.(),terrain:P.getTerrain()},this._updateStyleComponents(this.props)}),P.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const d in t_)P.on(d,this._onPointerEvent);for(const d in e_)P.on(d,this._onCameraEvent);for(const d in i_)P.on(d,this._onEvent);this._map=P}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),ep.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const $=this._map;$.style&&($._frame&&($._frame.cancel(),$._frame=null),$._render())}_updateSize($){const{viewState:H}=$;if(H){const Z=this._map;if(H.width!==Z.transform.width||H.height!==Z.transform.height)return Z.resize(),!0}return!1}_updateViewState($){const H=this._map,Z=H.transform;if(!H.isMoving()){const ft=Kg(Z,$);if(Object.keys(ft).length>0)return this._internalUpdate=!0,H.jumpTo(ft),this._internalUpdate=!1,!0}return!1}_updateSettings($,H){const Z=this._map;let nt=!1;for(const ft of ly)ft in $&&!hu($[ft],H[ft])&&(nt=!0,Z[`set${ft[0].toUpperCase()}${ft.slice(1)}`]?.call(Z,$[ft]));return nt}_updateStyle($,H){if($.cursor!==H.cursor&&(this._map.getCanvas().style.cursor=$.cursor||""),$.mapStyle!==H.mapStyle){const{mapStyle:Z=Jg,styleDiffing:nt=!0}=$,ft={diff:nt};"localIdeographFontFamily"in $&&(ft.localIdeographFontFamily=$.localIdeographFontFamily),this._map.setStyle(Qg(Z),ft)}}_updateStyleComponents({light:$,projection:H,sky:Z,terrain:nt}){const ft=this._map,P=this._styleComponents;ft.style._loaded&&($&&!hu($,P.light)&&(P.light=$,ft.setLight($)),H&&!hu(H,P.projection)&&H!==P.projection?.type&&(P.projection=typeof H=="string"?{type:H}:H,ft.setProjection?.(P.projection)),Z&&!hu(Z,P.sky)&&(P.sky=Z,ft.setSky(Z)),nt!==void 0&&!hu(nt,P.terrain)&&(!nt||ft.getSource(nt.source))&&(P.terrain=nt,ft.setTerrain(nt)))}_updateHandlers($,H){const Z=this._map;for(const nt of uy){const ft=$[nt]??!0,P=H[nt]??!0;hu(ft,P)||(ft?Z[nt].enable(ft):Z[nt].disable())}}_queryRenderedFeatures($){const H=this._map,{interactiveLayerIds:Z=[]}=this.props;try{return H.queryRenderedFeatures($,{layers:Z.filter(H.getLayer.bind(H))})}catch{return[]}}_updateHover($){const{props:H}=this;if(H.interactiveLayerIds&&(H.onMouseMove||H.onMouseEnter||H.onMouseLeave)){const nt=$.type,ft=this._hoveredFeatures?.length>0,P=this._queryRenderedFeatures($.point),d=P.length>0;!d&&ft&&($.type="mouseleave",this._onPointerEvent($)),this._hoveredFeatures=P,d&&!ft&&($.type="mouseenter",this._onPointerEvent($)),$.type=nt}else this._hoveredFeatures=null}}ep.savedMaps=[];const cy=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function hy(V){if(!V)return null;const $=V.map,H={getMap:()=>$};for(const Z of fy($))!(Z in H)&&!cy.includes(Z)&&(H[Z]=$[Z].bind($));return H}function fy(V){const $=new Set;let H=V;for(;H;){for(const Z of Object.getOwnPropertyNames(H))Z[0]!=="_"&&typeof V[Z]=="function"&&Z!=="fire"&&Z!=="setEventedParent"&&$.add(Z);H=Object.getPrototypeOf(H)}return Array.from($)}const dy=typeof document<"u"?De.useLayoutEffect:De.useEffect;function py(V,$){const{RTLTextPlugin:H,maxParallelImageRequests:Z,workerCount:nt,workerUrl:ft}=$;if(H&&V.getRTLTextPluginStatus&&V.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:P,lazy:d=!0}=typeof H=="string"?{pluginUrl:H}:H;V.setRTLTextPlugin(P,wt=>{wt&&console.error(wt)},d)}Z!==void 0&&V.setMaxParallelImageRequests(Z),nt!==void 0&&V.setWorkerCount(nt),ft!==void 0&&V.setWorkerUrl(ft)}const Xm=De.createContext(null);function my(V,$){const H=De.useContext(ay),[Z,nt]=De.useState(null),ft=De.useRef(),{current:P}=De.useRef({mapLib:null,map:null});De.useEffect(()=>{const At=V.mapLib;let ie=!0,jt;return Promise.resolve(At||ry(()=>Promise.resolve().then(()=>zy),void 0)).then(re=>{if(!ie)return;if(!re)throw new Error("Invalid mapLib");const ve="Map"in re?re:re.default;if(!ve.Map)throw new Error("Invalid mapLib");py(ve,V),V.reuseMaps&&(jt=ep.reuse(V,ft.current)),jt||(jt=new ep(ve.Map,V,ft.current)),P.map=hy(jt),P.mapLib=ve,nt(jt),H?.onMapMount(P.map,V.id)}).catch(re=>{const{onError:ve}=V;ve?ve({type:"error",target:null,originalEvent:null,error:re}):console.error(re)}),()=>{ie=!1,jt&&(H?.onMapUnmount(V.id),V.reuseMaps?jt.recycle():jt.destroy())}},[]),dy(()=>{Z&&Z.setProps(V)}),De.useImperativeHandle($,()=>P.map,[Z]);const d=De.useMemo(()=>({position:"relative",width:"100%",height:"100%",...V.style}),[V.style]),wt={height:"100%"};return De.createElement("div",{id:V.id,ref:ft,style:d},Z&&De.createElement(Xm.Provider,{value:P},De.createElement("div",{"mapboxgl-children":"",style:wt},V.children)))}const gy=De.forwardRef(my);var u_=l_();const _y=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function mc(V,$){if(!V||!$)return;const H=V.style;for(const Z in $){const nt=$[Z];Number.isFinite(nt)&&!_y.test(Z)?H[Z]=`${nt}px`:H[Z]=nt}}function c_(V,$){if(V===$)return null;const H=n_(V),Z=n_($),nt=[];for(const ft of Z)H.has(ft)||nt.push(ft);for(const ft of H)Z.has(ft)||nt.push(ft);return nt.length===0?null:nt}function n_(V){return new Set(V?V.trim().split(/\s+/):[])}De.memo(De.forwardRef((V,$)=>{const{map:H,mapLib:Z}=De.useContext(Xm),nt=De.useRef({props:V}),ft=De.useMemo(()=>{let Ai=!1;De.Children.forEach(V.children,di=>{di&&(Ai=!0)});const ti={...V,element:Ai?document.createElement("div"):void 0},Ee=new Z.Marker(ti);return Ee.setLngLat([V.longitude,V.latitude]),Ee.getElement().addEventListener("click",di=>{nt.current.props.onClick?.({type:"click",target:Ee,originalEvent:di})}),Ee.on("dragstart",di=>{const Ci=di;Ci.lngLat=ft.getLngLat(),nt.current.props.onDragStart?.(Ci)}),Ee.on("drag",di=>{const Ci=di;Ci.lngLat=ft.getLngLat(),nt.current.props.onDrag?.(Ci)}),Ee.on("dragend",di=>{const Ci=di;Ci.lngLat=ft.getLngLat(),nt.current.props.onDragEnd?.(Ci)}),Ee},[]);De.useEffect(()=>(ft.addTo(H.getMap()),()=>{ft.remove()}),[]);const{longitude:P,latitude:d,offset:wt,style:At,draggable:ie=!1,popup:jt=null,rotation:re=0,rotationAlignment:ve="auto",pitchAlignment:Ke="auto"}=V;De.useEffect(()=>{mc(ft.getElement(),At)},[At]),De.useImperativeHandle($,()=>ft,[]);const he=nt.current.props;(ft.getLngLat().lng!==P||ft.getLngLat().lat!==d)&&ft.setLngLat([P,d]),wt&&!sy(ft.getOffset(),wt)&&ft.setOffset(wt),ft.isDraggable()!==ie&&ft.setDraggable(ie),ft.getRotation()!==re&&ft.setRotation(re),ft.getRotationAlignment()!==ve&&ft.setRotationAlignment(ve),ft.getPitchAlignment()!==Ke&&ft.setPitchAlignment(Ke),ft.getPopup()!==jt&&ft.setPopup(jt);const Ct=c_(he.className,V.className);if(Ct)for(const Ai of Ct)ft.toggleClassName(Ai);return nt.current.props=V,u_.createPortal(V.children,ft.getElement())}));De.memo(De.forwardRef((V,$)=>{const{map:H,mapLib:Z}=De.useContext(Xm),nt=De.useMemo(()=>document.createElement("div"),[]),ft=De.useRef({props:V}),P=De.useMemo(()=>{const d={...V},wt=new Z.Popup(d);return wt.setLngLat([V.longitude,V.latitude]),wt.once("open",At=>{ft.current.props.onOpen?.(At)}),wt},[]);if(De.useEffect(()=>{const d=wt=>{ft.current.props.onClose?.(wt)};return P.on("close",d),P.setDOMContent(nt).addTo(H.getMap()),()=>{P.off("close",d),P.isOpen()&&P.remove()}},[]),De.useEffect(()=>{mc(P.getElement(),V.style)},[V.style]),De.useImperativeHandle($,()=>P,[]),P.isOpen()){const d=ft.current.props;(P.getLngLat().lng!==V.longitude||P.getLngLat().lat!==V.latitude)&&P.setLngLat([V.longitude,V.latitude]),V.offset&&!hu(d.offset,V.offset)&&P.setOffset(V.offset),(d.anchor!==V.anchor||d.maxWidth!==V.maxWidth)&&(P.options.anchor=V.anchor,P.setMaxWidth(V.maxWidth));const wt=c_(d.className,V.className);if(wt)for(const At of wt)P.toggleClassName(At);ft.current.props=V}return u_.createPortal(V.children,nt)}));function Pf(V,$,H,Z){const nt=De.useContext(Xm),ft=De.useMemo(()=>V(nt),[]);return De.useEffect(()=>{const P=$,d=null,wt=typeof $=="function"?$:null,{map:At}=nt;return At.hasControl(ft)||(At.addControl(ft,P?.position),d&&d(nt)),()=>{wt&&wt(nt),At.hasControl(ft)&&At.removeControl(ft)}},[]),ft}function yy(V){const $=Pf(({mapLib:H})=>new H.AttributionControl(V),{position:V.position});return De.useEffect(()=>{mc($._container,V.style)},[V.style]),null}De.memo(yy);function vy(V){const $=Pf(({mapLib:H})=>new H.FullscreenControl({container:V.containerId&&document.getElementById(V.containerId)}),{position:V.position});return De.useEffect(()=>{mc($._controlContainer,V.style)},[V.style]),null}De.memo(vy);function xy(V,$){const H=De.useRef({props:V}),Z=Pf(({mapLib:nt})=>{const ft=new nt.GeolocateControl(V),P=ft._setupUI;return ft._setupUI=()=>{ft._container.hasChildNodes()||P()},ft.on("geolocate",d=>{H.current.props.onGeolocate?.(d)}),ft.on("error",d=>{H.current.props.onError?.(d)}),ft.on("outofmaxbounds",d=>{H.current.props.onOutOfMaxBounds?.(d)}),ft.on("trackuserlocationstart",d=>{H.current.props.onTrackUserLocationStart?.(d)}),ft.on("trackuserlocationend",d=>{H.current.props.onTrackUserLocationEnd?.(d)}),ft},{position:V.position});return H.current.props=V,De.useImperativeHandle($,()=>Z,[]),De.useEffect(()=>{mc(Z._container,V.style)},[V.style]),null}const by=De.memo(De.forwardRef(xy));function wy(V){const $=Pf(({mapLib:H})=>new H.NavigationControl(V),{position:V.position});return De.useEffect(()=>{mc($._container,V.style)},[V.style]),null}const Ty=De.memo(wy);function Sy(V){const $=Pf(({mapLib:ft})=>new ft.ScaleControl(V),{position:V.position}),H=De.useRef(V),Z=H.current;H.current=V;const{style:nt}=V;return V.maxWidth!==void 0&&V.maxWidth!==Z.maxWidth&&($.options.maxWidth=V.maxWidth),V.unit!==void 0&&V.unit!==Z.unit&&$.setUnit(V.unit),De.useEffect(()=>{mc($._container,nt)},[nt]),null}De.memo(Sy);function My(V){const $=Pf(({mapLib:H})=>new H.TerrainControl(V),{position:V.position});return De.useEffect(()=>{mc($._container,V.style)},[V.style]),null}De.memo(My);function Ey(V){const $=Pf(({mapLib:H})=>new H.LogoControl(V),{position:V.position});return De.useEffect(()=>{mc($._container,V.style)},[V.style]),null}De.memo(Ey);var Hm={exports:{}};var Ay=Hm.exports,r_;function Cy(){return r_||(r_=1,function(V,$){(function(H,Z){V.exports=Z()})(Ay,function(){var H={},Z={};function nt(P,d,wt){if(Z[P]=wt,P==="index"){var At="var sharedModule = {}; ("+Z.shared+")(sharedModule); ("+Z.worker+")(sharedModule);",ie={};return Z.shared(ie),Z.index(H,ie),typeof window<"u"&&H.setWorkerUrl(window.URL.createObjectURL(new Blob([At],{type:"text/javascript"}))),H}}nt("shared",["exports"],function(P){function d(r,t,i,o){return new(i||(i=Promise))(function(l,h){function p(w){try{x(o.next(w))}catch(M){h(M)}}function y(w){try{x(o.throw(w))}catch(M){h(M)}}function x(w){var M;w.done?l(w.value):(M=w.value,M instanceof i?M:new i(function(A){A(M)})).then(p,y)}x((o=o.apply(r,t||[])).next())})}function wt(r,t){this.x=r,this.y=t}function At(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var ie,jt;typeof SuppressedError=="function"&&SuppressedError,wt.prototype={clone(){return new wt(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,t){return this.clone()._rotateAround(r,t)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const t=r.x-this.x,i=r.y-this.y;return t*t+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult(r){const t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const t=Math.cos(r),i=Math.sin(r),o=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=o,this},_rotateAround(r,t){const i=Math.cos(r),o=Math.sin(r),l=t.y+o*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-o*(this.y-t.y),this.y=l,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:wt},wt.convert=function(r){if(r instanceof wt)return r;if(Array.isArray(r))return new wt(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new wt(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};var re=function(){if(jt)return ie;function r(t,i,o,l){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=o,this.p2y=l}return jt=1,ie=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,l=0;l<8;l++){var h=this.sampleCurveX(o)-t;if(Math.abs(h)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=h/p}var y=0,x=1;for(o=t,l=0;l<20&&(h=this.sampleCurveX(o),!(Math.abs(h-t)<i));l++)t>h?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},ie}(),ve=At(re);let Ke,he;function Ct(){return Ke==null&&(Ke=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ke}function Ai(){if(he==null&&(he=!1,Ct())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const l=4*o;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const i=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&i[o]!==o){he=!0;break}}}return he||!1}var ti=1e-6,Ee=typeof Float32Array<"u"?Float32Array:Array;function di(){var r=new Ee(9);return Ee!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Ci(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function un(){var r=new Ee(3);return Ee!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Re(r){var t=r[0],i=r[1],o=r[2];return Math.sqrt(t*t+i*i+o*o)}function En(r,t,i){var o=new Ee(3);return o[0]=r,o[1]=t,o[2]=i,o}function $i(r,t,i){return r[0]=t[0]+i[0],r[1]=t[1]+i[1],r[2]=t[2]+i[2],r}function Yn(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r}function bi(r,t,i){var o=t[0],l=t[1],h=t[2],p=i[0],y=i[1],x=i[2];return r[0]=l*x-h*y,r[1]=h*p-o*x,r[2]=o*y-l*p,r}var Yi,xr=Re;function br(r,t,i){var o=t[0],l=t[1],h=t[2],p=t[3];return r[0]=i[0]*o+i[4]*l+i[8]*h+i[12]*p,r[1]=i[1]*o+i[5]*l+i[9]*h+i[13]*p,r[2]=i[2]*o+i[6]*l+i[10]*h+i[14]*p,r[3]=i[3]*o+i[7]*l+i[11]*h+i[15]*p,r}function Vn(){var r=new Ee(4);return Ee!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Nt(r,t,i,o){var l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",h=Math.PI/360;t*=h,o*=h,i*=h;var p=Math.sin(t),y=Math.cos(t),x=Math.sin(i),w=Math.cos(i),M=Math.sin(o),A=Math.cos(o);switch(l){case"xyz":r[0]=p*w*A+y*x*M,r[1]=y*x*A-p*w*M,r[2]=y*w*M+p*x*A,r[3]=y*w*A-p*x*M;break;case"xzy":r[0]=p*w*A-y*x*M,r[1]=y*x*A-p*w*M,r[2]=y*w*M+p*x*A,r[3]=y*w*A+p*x*M;break;case"yxz":r[0]=p*w*A+y*x*M,r[1]=y*x*A-p*w*M,r[2]=y*w*M-p*x*A,r[3]=y*w*A+p*x*M;break;case"yzx":r[0]=p*w*A+y*x*M,r[1]=y*x*A+p*w*M,r[2]=y*w*M-p*x*A,r[3]=y*w*A-p*x*M;break;case"zxy":r[0]=p*w*A-y*x*M,r[1]=y*x*A+p*w*M,r[2]=y*w*M+p*x*A,r[3]=y*w*A-p*x*M;break;case"zyx":r[0]=p*w*A-y*x*M,r[1]=y*x*A+p*w*M,r[2]=y*w*M-p*x*A,r[3]=y*w*A+p*x*M;break;default:throw new Error("Unknown angle order "+l)}return r}function ne(){var r=new Ee(2);return Ee!=Float32Array&&(r[0]=0,r[1]=0),r}function Pe(r,t){var i=new Ee(2);return i[0]=r,i[1]=t,i}un(),Yi=new Ee(4),Ee!=Float32Array&&(Yi[0]=0,Yi[1]=0,Yi[2]=0,Yi[3]=0),un(),En(1,0,0),En(0,1,0),Vn(),Vn(),di(),ne();const ge=8192;function oi(r,t,i){return t*(ge/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}function vt(r,t){return(r%t+t)%t}function qt(r,t,i){return r*(1-i)+t*i}function ae(r){if(r<=0)return 0;if(r>=1)return 1;const t=r*r,i=t*r;return 4*(r<.5?i:3*(r-t)+i-.75)}function fe(r,t,i,o){const l=new ve(r,t,i,o);return h=>l.solve(h)}const Ce=fe(.25,.1,.25,1);function ze(r,t,i){return Math.min(i,Math.max(t,r))}function Ue(r,t,i){const o=i-t,l=((r-t)%o+o)%o+t;return l===t?i:l}function fi(r,...t){for(const i of t)for(const o in i)r[o]=i[o];return r}let wi=1;function Lr(r,t,i){const o={};for(const l in r)o[l]=t.call(this,r[l],l,r);return o}function Wr(r,t,i){const o={};for(const l in r)t.call(this,r[l],l,r)&&(o[l]=r[l]);return o}function Wn(r){return Array.isArray(r)?r.map(Wn):typeof r=="object"&&r?Lr(r,Wn):r}const ps={};function gi(r){ps[r]||(typeof console<"u"&&console.warn(r),ps[r]=!0)}function Kr(r,t,i){return(i.y-r.y)*(t.x-r.x)>(t.y-r.y)*(i.x-r.x)}function oa(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let Wi=null;function ya(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const la="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Js(r,t,i,o,l){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const h=new VideoFrame(r,{timestamp:0});try{const p=h?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const y=p.startsWith("BGR"),x=new Uint8ClampedArray(o*l*4);if(yield h.copyTo(x,function(w,M,A,D,I){const k=4*Math.max(-M,0),F=(Math.max(0,A)-A)*D*4+k,U=4*D,X=Math.max(0,M),st=Math.max(0,A);return{rect:{x:X,y:st,width:Math.min(w.width,M+D)-X,height:Math.min(w.height,A+I)-st},layout:[{offset:F,stride:U}]}}(r,t,i,o,l)),y)for(let w=0;w<x.length;w+=4){const M=x[w];x[w]=x[w+2],x[w+2]=M}return x}finally{h.close()}})}let Ua,ja;function to(r,t,i,o){return r.addEventListener(t,i,o),{unsubscribe:()=>{r.removeEventListener(t,i,o)}}}function Ln(r){return r*Math.PI/180}function kr(r){return r/Math.PI*180}const Al={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Cl={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Va="AbortError";function zl(){return new Error(Va)}const ms={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Dl(r){return ms.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const ko="global-dispatcher";class wr extends Error{constructor(t,i,o,l){super(`AJAXError: ${i} (${t}): ${o}`),this.status=t,this.statusText=i,this.url=o,this.body=l}}const Zi=()=>oa(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,mt=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=Dl(r.url);if(o)return o(r,t);if(oa(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:ko},t)}if(!(/^file:/.test(i=r.url)||/^file:/.test(Zi())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,l){return d(this,void 0,void 0,function*(){const h=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Zi(),signal:l.signal});let p,y;o.type!=="json"||h.headers.has("Accept")||h.headers.set("Accept","application/json");try{p=yield fetch(h)}catch(w){throw new wr(0,w.message,o.url,new Blob)}if(!p.ok){const w=yield p.blob();throw new wr(p.status,p.statusText,o.url,w)}y=o.type==="arrayBuffer"||o.type==="image"?p.arrayBuffer():o.type==="json"?p.json():p.text();const x=yield y;if(l.signal.aborted)throw zl();return{data:x,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}})}(r,t);if(oa(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:ko},t)}var i;return function(o,l){return new Promise((h,p)=>{var y;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const w in o.headers)x.setRequestHeader(w,o.headers[w]);o.type==="json"&&(x.responseType="text",!((y=o.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if(!l.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let w=x.response;if(o.type==="json")try{w=JSON.parse(x.response)}catch(M){return void p(M)}h({data:w,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const w=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});p(new wr(x.status,x.statusText,o.url,w))}},l.signal.addEventListener("abort",()=>{x.abort(),p(zl())}),x.send(o.body)})}(r,t)};function j(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),i=window.location;return t.protocol===i.protocol&&t.host===i.host}function G(r,t,i){i[r]&&i[r].indexOf(t)!==-1||(i[r]=i[r]||[],i[r].push(t))}function Y(r,t,i){if(i&&i[r]){const o=i[r].indexOf(t);o!==-1&&i[r].splice(o,1)}}class ot{constructor(t,i={}){fi(this,i),this.type=t}}class ut extends ot{constructor(t,i={}){super("error",fi({error:t},i))}}class Tt{on(t,i){return this._listeners=this._listeners||{},G(t,i,this._listeners),{unsubscribe:()=>{this.off(t,i)}}}off(t,i){return Y(t,i,this._listeners),Y(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},G(t,i,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,i){typeof t=="string"&&(t=new ot(t,i||{}));const o=t.type;if(this.listens(o)){t.target=this;const l=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of l)y.call(this,t);const h=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of h)Y(o,y,this._oneTimeListeners),y.call(this,t);const p=this._eventedParent;p&&(fi(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(t))}else t instanceof ut&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var tt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const yt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function It(r,t){const i={};for(const o in r)o!=="ref"&&(i[o]=r[o]);return yt.forEach(o=>{o in t&&(i[o]=t[o])}),i}function kt(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let i=0;i<r.length;i++)if(!kt(r[i],t[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const i in r)if(!kt(r[i],t[i]))return!1;return!0}return r===t}function Ot(r,t){r.push(t)}function ue(r,t,i){Ot(i,{command:"addSource",args:[r,t[r]]})}function xe(r,t,i){Ot(t,{command:"removeSource",args:[r]}),i[r]=!0}function Le(r,t,i,o){xe(r,i,o),ue(r,t,i)}function en(r,t,i){let o;for(o in r[i])if(Object.prototype.hasOwnProperty.call(r[i],o)&&o!=="data"&&!kt(r[i][o],t[i][o]))return!1;for(o in t[i])if(Object.prototype.hasOwnProperty.call(t[i],o)&&o!=="data"&&!kt(r[i][o],t[i][o]))return!1;return!0}function Ge(r,t,i,o,l,h){r=r||{},t=t||{};for(const p in r)Object.prototype.hasOwnProperty.call(r,p)&&(kt(r[p],t[p])||i.push({command:h,args:[o,p,t[p],l]}));for(const p in t)Object.prototype.hasOwnProperty.call(t,p)&&!Object.prototype.hasOwnProperty.call(r,p)&&(kt(r[p],t[p])||i.push({command:h,args:[o,p,t[p],l]}))}function li(r){return r.id}function zi(r,t){return r[t.id]=t,r}class Qt{constructor(t,i,o,l){this.message=(t?`${t}: `:"")+o,l&&(this.identifier=l),i!=null&&i.__line__&&(this.line=i.__line__)}}function Di(r,...t){for(const i of t)for(const o in i)r[o]=i[o];return r}class Pi extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class mn{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[o,l]of i)this.bindings[o]=l}concat(t){return new mn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ui={kind:"null"},Ht={kind:"number"},se={kind:"string"},be={kind:"boolean"},cr={kind:"color"},Bo={kind:"projectionDefinition"},Gn={kind:"object"},Ie={kind:"value"},Qr={kind:"collator"},eo={kind:"formatted"},va={kind:"padding"},hr={kind:"colorArray"},xa={kind:"numberArray"},ba={kind:"resolvedImage"},nn={kind:"variableAnchorOffsetCollection"};function Br(r,t){return{kind:"array",itemType:r,N:t}}function Ii(r){if(r.kind==="array"){const t=Ii(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const Oo=[ui,Ht,se,be,cr,Bo,eo,Gn,Br(Ie),va,xa,hr,ba,nn];function Tr(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Tr(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const i of Oo)if(!Tr(i,t))return null}}return`Expected ${Ii(r)} but found ${Ii(t)} instead.`}function fu(r,t){return t.some(i=>i.kind===r.kind)}function qi(r,t){return t.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}function gs(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const mh=.96422,_s=.82521,Pl=4/29,Or=6/29,Jr=3*Or*Or,gh=Or*Or*Or,ip=Math.PI/180,gc=180/Math.PI;function _h(r){return(r%=360)<0&&(r+=360),r}function du([r,t,i,o]){let l,h;const p=Fr((.2225045*(r=yh(r))+.7168786*(t=yh(t))+.0606169*(i=yh(i)))/1);r===t&&t===i?l=h=p:(l=Fr((.4360747*r+.3850649*t+.1430804*i)/mh),h=Fr((.0139322*r+.0971045*t+.7141733*i)/_s));const y=116*p-16;return[y<0?0:y,500*(l-p),200*(p-h),o]}function yh(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Fr(r){return r>gh?Math.pow(r,1/3):r/Jr+Pl}function _c([r,t,i,o]){let l=(r+16)/116,h=isNaN(t)?l:l+t/500,p=isNaN(i)?l:l-i/200;return l=1*pu(l),h=mh*pu(h),p=_s*pu(p),[yc(3.1338561*h-1.6168667*l-.4906146*p),yc(-.9787684*h+1.9161415*l+.033454*p),yc(.0719453*h-.2289914*l+1.4052427*p),o]}function yc(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function pu(r){return r>Or?r*r*r:Jr*(r-Pl)}const Fo=Object.hasOwn||function(r,t){return Object.prototype.hasOwnProperty.call(r,t)};function Ga(r,t){return Fo(r,t)?r[t]:void 0}function mu(r){return parseInt(r.padEnd(2,r),16)/255}function No(r,t){return Za(t?r/100:r,0,1)}function Za(r,t,i){return Math.min(Math.max(t,r),i)}function vh(r){return!r.some(Number.isNaN)}const If={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function qa(r,t,i){return r+i*(t-r)}function Uo(r,t,i){return r.map((o,l)=>qa(o,t[l],i))}class Xe{constructor(t,i,o,l=1,h=!0){this.r=t,this.g=i,this.b=o,this.a=l,h||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,i,o,l]))}static parse(t){if(t instanceof Xe)return t;if(typeof t!="string")return;const i=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=Ga(If,o);if(l){const[p,y,x]=l;return[p/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const p=o.length<6?1:2;let y=1;return[mu(o.slice(y,y+=p)),mu(o.slice(y,y+=p)),mu(o.slice(y,y+=p)),mu(o.slice(y,y+p)||"ff")]}if(o.startsWith("rgb")){const p=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[y,x,w,M,A,D,I,k,F,U,X,st]=p,Q=[M||" ",I||" ",U].join("");if(Q==="  "||Q==="  /"||Q===",,"||Q===",,,"){const it=[w,D,F].join(""),dt=it==="%%%"?100:it===""?255:0;if(dt){const _t=[Za(+x/dt,0,1),Za(+A/dt,0,1),Za(+k/dt,0,1),X?No(+X,st):1];if(vh(_t))return _t}}return}}const h=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(h){const[p,y,x,w,M,A,D,I,k]=h,F=[x||" ",M||" ",D].join("");if(F==="  "||F==="  /"||F===",,"||F===",,,"){const U=[+y,Za(+w,0,100),Za(+A,0,100),I?No(+I,k):1];if(vh(U))return function([X,st,Q,it]){function dt(_t){const zt=(_t+X/30)%12,$t=st*Math.min(Q,1-Q);return Q-$t*Math.max(-1,Math.min(zt-3,9-zt,1))}return X=_h(X),st/=100,Q/=100,[dt(0),dt(8),dt(4),it]}(U)}}}(t);return i?new Xe(...i,!1):void 0}get rgb(){const{r:t,g:i,b:o,a:l}=this,h=l||1/0;return this.overwriteGetter("rgb",[t/h,i/h,o/h,l])}get hcl(){return this.overwriteGetter("hcl",function(t){const[i,o,l,h]=du(t),p=Math.sqrt(o*o+l*l);return[Math.round(1e4*p)?_h(Math.atan2(l,o)*gc):NaN,p,i,h]}(this.rgb))}get lab(){return this.overwriteGetter("lab",du(this.rgb))}overwriteGetter(t,i){return Object.defineProperty(this,t,{value:i}),i}toString(){const[t,i,o,l]=this.rgb;return`rgba(${[t,i,o].map(h=>Math.round(255*h)).join(",")},${l})`}static interpolate(t,i,o,l="rgb"){switch(l){case"rgb":{const[h,p,y,x]=Uo(t.rgb,i.rgb,o);return new Xe(h,p,y,x,!1)}case"hcl":{const[h,p,y,x]=t.hcl,[w,M,A,D]=i.hcl;let I,k;if(isNaN(h)||isNaN(w))isNaN(h)?isNaN(w)?I=NaN:(I=w,y!==1&&y!==0||(k=M)):(I=h,A!==1&&A!==0||(k=p));else{let Q=w-h;w>h&&Q>180?Q-=360:w<h&&h-w>180&&(Q+=360),I=h+o*Q}const[F,U,X,st]=function([Q,it,dt,_t]){return Q=isNaN(Q)?0:Q*ip,_c([dt,Math.cos(Q)*it,Math.sin(Q)*it,_t])}([I,k??qa(p,M,o),qa(y,A,o),qa(x,D,o)]);return new Xe(F,U,X,st,!1)}case"lab":{const[h,p,y,x]=_c(Uo(t.lab,i.lab,o));return new Xe(h,p,y,x,!1)}}}}Xe.black=new Xe(0,0,0,1),Xe.white=new Xe(1,1,1,1),Xe.transparent=new Xe(0,0,0,0),Xe.red=new Xe(1,0,0,1);class Sr{constructor(t,i,o){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ne=["bottom","center","top"];class Ha{constructor(t,i,o,l,h,p){this.text=t,this.image=i,this.scale=o,this.fontStack=l,this.textColor=h,this.verticalAlign=p}}class cn{constructor(t){this.sections=t}static fromString(t){return new cn([new Ha(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof cn?t:cn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class gn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof gn)return t;if(typeof t=="number")return new gn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const i of t)if(typeof i!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new gn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,o){return new gn(Uo(t.values,i.values,o))}}class _n{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof _n)return t;if(typeof t=="number")return new _n([t]);if(Array.isArray(t)){for(const i of t)if(typeof i!="number")return;return new _n(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,o){return new _n(Uo(t.values,i.values,o))}}class An{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof An)return t;if(typeof t=="string"){const o=Xe.parse(t);return o?new An([o]):void 0}if(!Array.isArray(t))return;const i=[];for(const o of t){if(typeof o!="string")return;const l=Xe.parse(o);if(!l)return;i.push(l)}return new An(i)}toString(){return JSON.stringify(this.values)}static interpolate(t,i,o,l="rgb"){const h=[];if(t.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let p=0;p<t.values.length;p++)h.push(Xe.interpolate(t.values[p],i.values[p],o,l));return new An(h)}}class Ti extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const gu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class kn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof kn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let i=0;i<t.length;i+=2){const o=t[i],l=t[i+1];if(typeof o!="string"||!gu.has(o)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new kn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,i,o){const l=t.values,h=i.values;if(l.length!==h.length)throw new Ti(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${i.toString()}`);const p=[];for(let y=0;y<l.length;y+=2){if(l[y]!==h[y])throw new Ti(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${l[y]}, to[${y}]: ${h[y]}`);p.push(l[y]);const[x,w]=l[y+1],[M,A]=h[y+1];p.push([qa(x,M,o),qa(w,A,o)])}return new kn(p)}}class hn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new hn({name:t,available:!1}):null}}class Zn{constructor(t,i,o){this.from=t,this.to=i,this.transition=o}static interpolate(t,i,o){return new Zn(t,i,o)}static parse(t){return t instanceof Zn?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Zn(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Zn(t.from,t.to,t.transition):typeof t=="string"?new Zn(t,t,1):void 0}}function Il(r,t,i,o){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,t,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,t,i,o]:[r,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Mr(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Zn||r instanceof Xe||r instanceof Sr||r instanceof cn||r instanceof gn||r instanceof _n||r instanceof An||r instanceof kn||r instanceof hn)return!0;if(Array.isArray(r)){for(const t of r)if(!Mr(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!Mr(r[t]))return!1;return!0}return!1}function Ri(r){if(r===null)return ui;if(typeof r=="string")return se;if(typeof r=="boolean")return be;if(typeof r=="number")return Ht;if(r instanceof Xe)return cr;if(r instanceof Zn)return Bo;if(r instanceof Sr)return Qr;if(r instanceof cn)return eo;if(r instanceof gn)return va;if(r instanceof _n)return xa;if(r instanceof An)return hr;if(r instanceof kn)return nn;if(r instanceof hn)return ba;if(Array.isArray(r)){const t=r.length;let i;for(const o of r){const l=Ri(o);if(i){if(i===l)continue;i=Ie;break}i=l}return Br(i||Ie,t)}return Gn}function ys(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof Xe||r instanceof Zn||r instanceof cn||r instanceof gn||r instanceof _n||r instanceof An||r instanceof kn||r instanceof hn?r.toString():JSON.stringify(r)}class vs{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Mr(t[1]))return i.error("invalid value");const o=t[1];let l=Ri(o);const h=i.expectedType;return l.kind!=="array"||l.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(l=h),new vs(l,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const io={string:se,number:Ht,boolean:be,object:Gn};class Kn{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let o,l=1;const h=t[0];if(h==="array"){let y,x;if(t.length>2){const w=t[1];if(typeof w!="string"||!(w in io)||w==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=io[w],l++}else y=Ie;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=t[2],l++}o=Br(y,x)}else{if(!io[h])throw new Error(`Types doesn't contain name = ${h}`);o=io[h]}const p=[];for(;l<t.length;l++){const y=i.parse(t[l],l,Ie);if(!y)return null;p.push(y)}return new Kn(o,p)}evaluate(t){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(t);if(!Tr(this.type,Ri(o)))return o;if(i===this.args.length-1)throw new Ti(`Expected value to be of type ${Ii(this.type)}, but found ${Ii(Ri(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Oi={"to-boolean":be,"to-color":cr,"to-number":Ht,"to-string":se};class rn{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const o=t[0];if(!Oi[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return i.error("Expected one argument.");const l=Oi[o],h=[];for(let p=1;p<t.length;p++){const y=i.parse(t[p],p,Ie);if(!y)return null;h.push(y)}return new rn(l,h)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let i,o;for(const l of this.args){if(i=l.evaluate(t),o=null,i instanceof Xe)return i;if(typeof i=="string"){const h=t.parseColor(i);if(h)return h}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Il(i[0],i[1],i[2],i[3]),!o))return new Xe(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ti(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(t);const l=gn.parse(i);if(l)return l}throw new Ti(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const o of this.args){i=o.evaluate(t);const l=_n.parse(i);if(l)return l}throw new Ti(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const o of this.args){i=o.evaluate(t);const l=An.parse(i);if(l)return l}throw new Ti(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(t);const l=kn.parse(i);if(l)return l}throw new Ti(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(t),i===null)return 0;const l=Number(i);if(!isNaN(l))return l}throw new Ti(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return cn.fromString(ys(this.args[0].evaluate(t)));case"resolvedImage":return hn.fromString(ys(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return ys(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Ze=["Unknown","Point","LineString","Polygon"];class Be{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ze[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let i=this._parseColorCache.get(t);return i||(i=Xe.parse(t),this._parseColorCache.set(t,i)),i}}class Xa{constructor(t,i,o=[],l,h=new mn,p=[]){this.registry=t,this.path=o,this.key=o.map(y=>`[${y}]`).join(""),this.scope=h,this.errors=p,this.expectedType=l,this._isConstant=i}parse(t,i,o,l,h={}){return i?this.concat(i,o,l)._parse(t,h):this._parse(t,h)}_parse(t,i){function o(l,h,p){return p==="assert"?new Kn(h,[l]):p==="coerce"?new rn(h,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const h=this.registry[l];if(h){let p=h.parse(t,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,x=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(x.kind)||y.kind==="colorArray"&&["value","string","array"].includes(x.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))p=o(p,y,i.typeAnnotation||"coerce");else if(this.checkSubtype(y,x))return null}else p=o(p,y,i.typeAnnotation||"assert")}if(!(p instanceof vs)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const y=new Be;try{p=new vs(p.type,p.evaluate(y))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,o){const l=typeof t=="number"?this.path.concat(t):this.path,h=o?this.scope.concat(o):this.scope;return new Xa(this.registry,this._isConstant,l,i||null,h,this.errors)}error(t,...i){const o=`${this.key}${i.map(l=>`[${l}]`).join("")}`;this.errors.push(new Pi(o,t))}checkSubtype(t,i){const o=Tr(t,i);return o&&this.error(o),o}}class Qe{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let h=1;h<t.length-1;h+=2){const p=t[h];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,h);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",h);const y=i.parse(t[h+1],h+1);if(!y)return null;o.push([p,y])}const l=i.parse(t[t.length-1],t.length-1,i.expectedType,o);return l?new Qe(o,l):null}outputDefined(){return this.result.outputDefined()}}class no{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=t[1];return i.scope.has(o)?new no(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ta{constructor(t,i,o){this.type=t,this.index=i,this.input=o}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=i.parse(t[1],1,Ht),l=i.parse(t[2],2,Br(i.expectedType||Ie));return o&&l?new ta(l.type.itemType,o,l):null}evaluate(t){const i=this.index.evaluate(t),o=this.input.evaluate(t);if(i<0)throw new Ti(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Ti(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Ti(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class xs{constructor(t,i){this.type=be,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=i.parse(t[1],1,Ie),l=i.parse(t[2],2,Ie);return o&&l?fu(o.type,[be,se,Ht,ui,Ie])?new xs(o,l):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(o.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!qi(i,["boolean","string","number","null"]))throw new Ti(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(Ri(i))} instead.`);if(!qi(o,["string","array"]))throw new Ti(`Expected second argument to be of type array or string, but found ${Ii(Ri(o))} instead.`);return o.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class $a{constructor(t,i,o){this.type=Ht,this.needle=t,this.haystack=i,this.fromIndex=o}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=i.parse(t[1],1,Ie),l=i.parse(t[2],2,Ie);if(!o||!l)return null;if(!fu(o.type,[be,se,Ht,ui,Ie]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(o.type)} instead`);if(t.length===4){const h=i.parse(t[3],3,Ht);return h?new $a(o,l,h):null}return new $a(o,l)}evaluate(t){const i=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!qi(i,["boolean","string","number","null"]))throw new Ti(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(Ri(i))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),qi(o,["string"])){const h=o.indexOf(i,l);return h===-1?-1:[...o.slice(0,h)].length}if(qi(o,["array"]))return o.indexOf(i,l);throw new Ti(`Expected second argument to be of type array or string, but found ${Ii(Ri(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class _u{constructor(t,i,o,l,h,p){this.inputType=t,this.type=i,this.input=o,this.cases=l,this.outputs=h,this.otherwise=p}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let o,l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const h={},p=[];for(let w=2;w<t.length-1;w+=2){let M=t[w];const A=t[w+1];Array.isArray(M)||(M=[M]);const D=i.concat(w);if(M.length===0)return D.error("Expected at least one branch label.");for(const k of M){if(typeof k!="number"&&typeof k!="string")return D.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,Ri(k)))return null}else o=Ri(k);if(h[String(k)]!==void 0)return D.error("Branch labels must be unique.");h[String(k)]=p.length}const I=i.parse(A,w,l);if(!I)return null;l=l||I.type,p.push(I)}const y=i.parse(t[1],1,Ie);if(!y)return null;const x=i.parse(t[t.length-1],t.length-1,l);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(o,y.type)?null:new _u(o,l,y,h,p,x):null}evaluate(t){const i=this.input.evaluate(t);return(Ri(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class yu{constructor(t,i,o){this.type=t,this.branches=i,this.otherwise=o}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const l=[];for(let p=1;p<t.length-1;p+=2){const y=i.parse(t[p],p,be);if(!y)return null;const x=i.parse(t[p+1],p+1,o);if(!x)return null;l.push([y,x]),o=o||x.type}const h=i.parse(t[t.length-1],t.length-1,o);if(!h)return null;if(!o)throw new Error("Can't infer output type");return new yu(o,l,h)}evaluate(t){for(const[i,o]of this.branches)if(i.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,o]of this.branches)t(i),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class vu{constructor(t,i,o,l){this.type=t,this.input=i,this.beginIndex=o,this.endIndex=l}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${t.length-1} instead.`);const o=i.parse(t[1],1,Ie),l=i.parse(t[2],2,Ht);if(!o||!l)return null;if(!fu(o.type,[Br(Ie),se,Ie]))return i.error(`Expected first argument to be of type array or string, but found ${Ii(o.type)} instead`);if(t.length===4){const h=i.parse(t[3],3,Ht);return h?new vu(o.type,o,l,h):null}return new vu(o.type,o,l)}evaluate(t){const i=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),qi(i,["string"]))return[...i].slice(o,l).join("");if(qi(i,["array"]))return i.slice(o,l);throw new Ti(`Expected first argument to be of type array or string, but found ${Ii(Ri(i))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function vc(r,t){const i=r.length-1;let o,l,h=0,p=i,y=0;for(;h<=p;)if(y=Math.floor((h+p)/2),o=r[y],l=r[y+1],o<=t){if(y===i||t<l)return y;h=y+1}else{if(!(o>t))throw new Ti("Input is not a number.");p=y-1}return 0}class ro{constructor(t,i,o){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[l,h]of o)this.labels.push(l),this.outputs.push(h)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(t[1],1,Ht);if(!o)return null;const l=[];let h=null;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);for(let p=1;p<t.length;p+=2){const y=p===1?-1/0:t[p],x=t[p+1],w=p,M=p+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(l.length&&l[l.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const A=i.parse(x,M,h);if(!A)return null;h=h||A.type,l.push([y,A])}return new ro(h,o,l)}evaluate(t){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(t);const l=this.input.evaluate(t);if(l<=i[0])return o[0].evaluate(t);const h=i.length;return l>=i[h-1]?o[h-1].evaluate(t):o[vc(i,l)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Rf(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Ya,Qn,xc=function(){if(Qn)return Ya;function r(t,i,o,l){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=o,this.p2y=l}return Qn=1,Ya=r,r.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,l=0;l<8;l++){var h=this.sampleCurveX(o)-t;if(Math.abs(h)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=h/p}var y=0,x=1;for(o=t,l=0;l<20&&(h=this.sampleCurveX(o),!(Math.abs(h-t)<i));l++)t>h?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},Ya}(),Lf=Rf(xc);class qn{constructor(t,i,o,l,h){this.type=t,this.operator=i,this.interpolation=o,this.input=l,this.labels=[],this.outputs=[];for(const[p,y]of h)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(t,i,o,l){let h=0;if(t.name==="exponential")h=Cn(i,t.base,o,l);else if(t.name==="linear")h=Cn(i,1,o,l);else if(t.name==="cubic-bezier"){const p=t.controlPoints;h=new Lf(p[0],p[1],p[2],p[3]).solve(Cn(i,1,o,l))}return h}static parse(t,i){let[o,l,h,...p]=t;if(!Array.isArray(l)||l.length===0)return i.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const w=l[1];if(typeof w!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:w}}else{if(l[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const w=l.slice(1);if(w.length!==4||w.some(M=>typeof M!="number"||M<0||M>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:w}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(h=i.parse(h,2,Ht),!h)return null;const y=[];let x=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||i.expectedType==hr?i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType):x=cr;for(let w=0;w<p.length;w+=2){const M=p[w],A=p[w+1],D=w+3,I=w+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const k=i.parse(A,I,x);if(!k)return null;x=x||k.type,y.push([M,k])}return gs(x,Ht)||gs(x,Bo)||gs(x,cr)||gs(x,va)||gs(x,xa)||gs(x,hr)||gs(x,nn)||gs(x,Br(Ht))?new qn(x,o,l,h,y):i.error(`Type ${Ii(x)} is not interpolatable.`)}evaluate(t){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(t);const l=this.input.evaluate(t);if(l<=i[0])return o[0].evaluate(t);const h=i.length;if(l>=i[h-1])return o[h-1].evaluate(t);const p=vc(i,l),y=qn.interpolationFactor(this.interpolation,l,i[p],i[p+1]),x=o[p].evaluate(t),w=o[p+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return qa(x,w,y);case"color":return Xe.interpolate(x,w,y);case"padding":return gn.interpolate(x,w,y);case"colorArray":return An.interpolate(x,w,y);case"numberArray":return _n.interpolate(x,w,y);case"variableAnchorOffsetCollection":return kn.interpolate(x,w,y);case"array":return Uo(x,w,y);case"projectionDefinition":return Zn.interpolate(x,w,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return Xe.interpolate(x,w,y,"hcl");case"colorArray":return An.interpolate(x,w,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Xe.interpolate(x,w,y,"lab");case"colorArray":return An.interpolate(x,w,y,"lab")}}}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Cn(r,t,i,o){const l=o-i,h=r-i;return l===0?0:t===1?h/l:(Math.pow(t,h)-1)/(Math.pow(t,l)-1)}const wa={color:Xe.interpolate,number:qa,padding:gn.interpolate,numberArray:_n.interpolate,colorArray:An.interpolate,variableAnchorOffsetCollection:kn.interpolate,array:Uo};class Rl{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let o=null;const l=i.expectedType;l&&l.kind!=="value"&&(o=l);const h=[];for(const y of t.slice(1)){const x=i.parse(y,1+h.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,h.push(x)}if(!o)throw new Error("No output type");const p=l&&h.some(y=>Tr(l,y.type));return new Rl(p?Ie:o,h)}evaluate(t){let i,o=null,l=0;for(const h of this.args)if(l++,o=h.evaluate(t),o&&o instanceof hn&&!o.available&&(i||(i=o.name),o=null,l===this.args.length&&(o=i)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function xh(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function bc(r,t,i,o){return o.compare(t,i)===0}function Ta(r,t,i){const o=r!=="=="&&r!=="!=";return class h_{constructor(h,p,y){this.type=be,this.lhs=h,this.rhs=p,this.collator=y,this.hasUntypedArgument=h.type.kind==="value"||p.type.kind==="value"}static parse(h,p){if(h.length!==3&&h.length!==4)return p.error("Expected two or three arguments.");const y=h[0];let x=p.parse(h[1],1,Ie);if(!x)return null;if(!xh(y,x.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${Ii(x.type)}'.`);let w=p.parse(h[2],2,Ie);if(!w)return null;if(!xh(y,w.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${Ii(w.type)}'.`);if(x.type.kind!==w.type.kind&&x.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${Ii(x.type)}' and '${Ii(w.type)}'.`);o&&(x.type.kind==="value"&&w.type.kind!=="value"?x=new Kn(w.type,[x]):x.type.kind!=="value"&&w.type.kind==="value"&&(w=new Kn(x.type,[w])));let M=null;if(h.length===4){if(x.type.kind!=="string"&&w.type.kind!=="string"&&x.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(M=p.parse(h[3],3,Qr),!M)return null}return new h_(x,w,M)}evaluate(h){const p=this.lhs.evaluate(h),y=this.rhs.evaluate(h);if(o&&this.hasUntypedArgument){const x=Ri(p),w=Ri(y);if(x.kind!==w.kind||x.kind!=="string"&&x.kind!=="number")throw new Ti(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${w.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=Ri(p),w=Ri(y);if(x.kind!=="string"||w.kind!=="string")return t(h,p,y)}return this.collator?i(h,p,y,this.collator.evaluate(h)):t(h,p,y)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}}}const wc=Ta("==",function(r,t,i){return t===i},bc),bh=Ta("!=",function(r,t,i){return t!==i},function(r,t,i,o){return!bc(0,t,i,o)}),kf=Ta("<",function(r,t,i){return t<i},function(r,t,i,o){return o.compare(t,i)<0}),Bf=Ta(">",function(r,t,i){return t>i},function(r,t,i,o){return o.compare(t,i)>0}),Tc=Ta("<=",function(r,t,i){return t<=i},function(r,t,i,o){return o.compare(t,i)<=0}),Sc=Ta(">=",function(r,t,i){return t>=i},function(r,t,i,o){return o.compare(t,i)>=0});class Nr{constructor(t,i,o){this.type=Qr,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const l=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,be);if(!l)return null;const h=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,be);if(!h)return null;let p=null;return o.locale&&(p=i.parse(o.locale,1,se),!p)?null:new Nr(l,h,p)}evaluate(t){return new Sr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Mc{constructor(t,i,o,l,h){this.type=se,this.number=t,this.locale=i,this.currency=o,this.minFractionDigits=l,this.maxFractionDigits=h}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const o=i.parse(t[1],1,Ht);if(!o)return null;const l=t[2];if(typeof l!="object"||Array.isArray(l))return i.error("NumberFormat options argument must be an object.");let h=null;if(l.locale&&(h=i.parse(l.locale,1,se),!h))return null;let p=null;if(l.currency&&(p=i.parse(l.currency,1,se),!p))return null;let y=null;if(l["min-fraction-digits"]&&(y=i.parse(l["min-fraction-digits"],1,Ht),!y))return null;let x=null;return l["max-fraction-digits"]&&(x=i.parse(l["max-fraction-digits"],1,Ht),!x)?null:new Mc(o,h,p,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class jo{constructor(t){this.type=eo,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const l=[];let h=!1;for(let p=1;p<=t.length-1;++p){const y=t[p];if(h&&typeof y=="object"&&!Array.isArray(y)){h=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,Ht),!x))return null;let w=null;if(y["text-font"]&&(w=i.parse(y["text-font"],1,Br(se)),!w))return null;let M=null;if(y["text-color"]&&(M=i.parse(y["text-color"],1,cr),!M))return null;let A=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!Ne.includes(y["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(A=i.parse(y["vertical-align"],1,se),!A)return null}const D=l[l.length-1];D.scale=x,D.font=w,D.textColor=M,D.verticalAlign=A}else{const x=i.parse(t[p],1,Ie);if(!x)return null;const w=x.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,l.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new jo(l)}evaluate(t){return new cn(this.sections.map(i=>{const o=i.content.evaluate(t);return Ri(o)===ba?new Ha("",o,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(t):null):new Ha(ys(o),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null,i.verticalAlign?i.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor),i.verticalAlign&&t(i.verticalAlign)}outputDefined(){return!1}}class wh{constructor(t){this.type=ba,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const o=i.parse(t[1],1,se);return o?new wh(o):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),o=hn.fromString(i);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(i)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class xu{constructor(t){this.type=Ht,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=i.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Ii(o.type)} instead.`):new xu(o):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Ti(`Expected value to be of type string or array, but found ${Ii(Ri(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Wa=8192;function Th(r,t){const i=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(i*l*Wa),Math.round(o*l*Wa)]}function Vo(r,t){const i=Math.pow(2,t.z);return[(l=(r[0]/Wa+t.x)/i,360*l-180),(o=(r[1]/Wa+t.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,l}function bu(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function bs(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Of(r,t,i){const o=r[0]-t[0],l=r[1]-t[1],h=r[0]-i[0],p=r[1]-i[1];return o*p-h*l==0&&o*h<=0&&l*p<=0}function Ll(r,t,i,o){return(l=[o[0]-i[0],o[1]-i[1]])[0]*(h=[t[0]-r[0],t[1]-r[1]])[1]-l[1]*h[0]!=0&&!(!Nf(r,t,i,o)||!Nf(i,o,r,t));var l,h}function Sh(r,t,i){for(const o of i)for(let l=0;l<o.length-1;++l)if(Ll(r,t,o[l],o[l+1]))return!0;return!1}function Go(r,t,i=!1){let o=!1;for(const y of t)for(let x=0;x<y.length-1;x++){if(Of(r,y[x],y[x+1]))return i;(h=y[x])[1]>(l=r)[1]!=(p=y[x+1])[1]>l[1]&&l[0]<(p[0]-h[0])*(l[1]-h[1])/(p[1]-h[1])+h[0]&&(o=!o)}var l,h,p;return o}function Zo(r,t){for(const i of t)if(Go(r,i))return!0;return!1}function Ff(r,t){for(const i of r)if(!Go(i,t))return!1;for(let i=0;i<r.length-1;++i)if(Sh(r[i],r[i+1],t))return!1;return!0}function np(r,t){for(const i of t)if(Ff(r,i))return!0;return!1}function Nf(r,t,i,o){const l=o[0]-i[0],h=o[1]-i[1],p=(r[0]-i[0])*h-l*(r[1]-i[1]),y=(t[0]-i[0])*h-l*(t[1]-i[1]);return p>0&&y<0||p<0&&y>0}function Ec(r,t,i){const o=[];for(let l=0;l<r.length;l++){const h=[];for(let p=0;p<r[l].length;p++){const y=Th(r[l][p],i);bu(t,y),h.push(y)}o.push(h)}return o}function Mh(r,t,i){const o=[];for(let l=0;l<r.length;l++){const h=Ec(r[l],t,i);o.push(h)}return o}function qo(r,t,i,o){if(r[0]<i[0]||r[0]>i[2]){const l=.5*o;let h=r[0]-i[0]>l?-o:i[0]-r[0]>l?o:0;h===0&&(h=r[0]-i[2]>l?-o:i[2]-r[0]>l?o:0),r[0]+=h}bu(t,r)}function Ho(r,t,i,o){const l=Math.pow(2,o.z)*Wa,h=[o.x*Wa,o.y*Wa],p=[];for(const y of r)for(const x of y){const w=[x.x+h[0],x.y+h[1]];qo(w,t,i,l),p.push(w)}return p}function Eh(r,t,i,o){const l=Math.pow(2,o.z)*Wa,h=[o.x*Wa,o.y*Wa],p=[];for(const x of r){const w=[];for(const M of x){const A=[M.x+h[0],M.y+h[1]];bu(t,A),w.push(A)}p.push(w)}if(t[2]-t[0]<=l/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of p)for(const w of x)qo(w,t,i,l)}var y;return p}class Ka{constructor(t,i){this.type=be,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Mr(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const l=[];for(const h of o.features){const{type:p,coordinates:y}=h.geometry;p==="Polygon"&&l.push(y),p==="MultiPolygon"&&l.push(...y)}if(l.length)return new Ka(o,{type:"MultiPolygon",coordinates:l})}else if(o.type==="Feature"){const l=o.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new Ka(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Ka(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,o){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=Ec(o.coordinates,h,p),x=Ho(i.geometry(),l,h,p);if(!bs(l,h))return!1;for(const w of x)if(!Go(w,y))return!1}if(o.type==="MultiPolygon"){const y=Mh(o.coordinates,h,p),x=Ho(i.geometry(),l,h,p);if(!bs(l,h))return!1;for(const w of x)if(!Zo(w,y))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,o){const l=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=Ec(o.coordinates,h,p),x=Eh(i.geometry(),l,h,p);if(!bs(l,h))return!1;for(const w of x)if(!Ff(w,y))return!1}if(o.type==="MultiPolygon"){const y=Mh(o.coordinates,h,p),x=Eh(i.geometry(),l,h,p);if(!bs(l,h))return!1;for(const w of x)if(!np(w,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ah=class{constructor(r=[],t=(i,o)=>i<o?-1:i>o?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:i}=this,o=t[r];for(;r>0;){const l=r-1>>1,h=t[l];if(i(o,h)>=0)break;t[r]=h,r=l}t[r]=o}_down(r){const{data:t,compare:i}=this,o=this.length>>1,l=t[r];for(;r<o;){let h=1+(r<<1);const p=h+1;if(p<this.length&&i(t[p],t[h])<0&&(h=p),i(t[h],l)>=0)break;t[r]=t[h],r=h}t[r]=l}};function Ch(r,t,i=0,o=r.length-1,l=kl){for(;o>i;){if(o-i>600){const x=o-i+1,w=t-i+1,M=Math.log(x),A=.5*Math.exp(2*M/3),D=.5*Math.sqrt(M*A*(x-A)/x)*(w-x/2<0?-1:1);Ch(r,t,Math.max(i,Math.floor(t-w*A/x+D)),Math.min(o,Math.floor(t+(x-w)*A/x+D)),l)}const h=r[t];let p=i,y=o;for(Xo(r,i,t),l(r[o],h)>0&&Xo(r,i,o);p<y;){for(Xo(r,p,y),p++,y--;l(r[p],h)<0;)p++;for(;l(r[y],h)>0;)y--}l(r[i],h)===0?Xo(r,i,y):(y++,Xo(r,y,o)),y<=t&&(i=y+1),t<=y&&(o=y-1)}}function Xo(r,t,i){const o=r[t];r[t]=r[i],r[i]=o}function kl(r,t){return r<t?-1:r>t?1:0}function Bl(r,t){if(r.length<=1)return[r];const i=[];let o,l;for(const h of r){const p=jf(h);p!==0&&(h.area=Math.abs(p),l===void 0&&(l=p<0),l===p<0?(o&&i.push(o),o=[h]):o.push(h))}if(o&&i.push(o),t>1)for(let h=0;h<i.length;h++)i[h].length<=t||(Ch(i[h],t,1,i[h].length-1,Uf),i[h]=i[h].slice(0,t));return i}function Uf(r,t){return t.area-r.area}function jf(r){let t=0;for(let i,o,l=0,h=r.length,p=h-1;l<h;p=l++)i=r[l],o=r[p],t+=(o.x-i.x)*(i.y+o.y);return t}const Vf=1/298.257223563,Ac=Vf*(2-Vf),zh=Math.PI/180;class Dh{constructor(t){const i=6378.137*zh*1e3,o=Math.cos(t*zh),l=1/(1-Ac*(1-o*o)),h=Math.sqrt(l);this.kx=i*h*o,this.ky=i*h*l*(1-Ac)}distance(t,i){const o=this.wrap(t[0]-i[0])*this.kx,l=(t[1]-i[1])*this.ky;return Math.sqrt(o*o+l*l)}pointOnLine(t,i){let o,l,h,p,y=1/0;for(let x=0;x<t.length-1;x++){let w=t[x][0],M=t[x][1],A=this.wrap(t[x+1][0]-w)*this.kx,D=(t[x+1][1]-M)*this.ky,I=0;A===0&&D===0||(I=(this.wrap(i[0]-w)*this.kx*A+(i[1]-M)*this.ky*D)/(A*A+D*D),I>1?(w=t[x+1][0],M=t[x+1][1]):I>0&&(w+=A/this.kx*I,M+=D/this.ky*I)),A=this.wrap(i[0]-w)*this.kx,D=(i[1]-M)*this.ky;const k=A*A+D*D;k<y&&(y=k,o=w,l=M,h=x,p=I)}return{point:[o,l],index:h,t:Math.max(0,Math.min(1,p))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Gf(r,t){return t[0]-r[0]}function Jn(r){return r[1]-r[0]+1}function Ur(r,t){return r[1]>=r[0]&&r[1]<t}function Cc(r,t){if(r[0]>r[1])return[null,null];const i=Jn(r);if(t){if(i===2)return[r,null];const l=Math.floor(i/2);return[[r[0],r[0]+l],[r[0]+l,r[1]]]}if(i===1)return[r,null];const o=Math.floor(i/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function zc(r,t){if(!Ur(t,r.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)bu(i,r[o]);return i}function Dc(r){const t=[1/0,1/0,-1/0,-1/0];for(const i of r)for(const o of i)bu(t,o);return t}function Pc(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function wu(r,t,i){if(!Pc(r)||!Pc(t))return NaN;let o=0,l=0;return r[2]<t[0]&&(o=t[0]-r[2]),r[0]>t[2]&&(o=r[0]-t[2]),r[1]>t[3]&&(l=r[1]-t[3]),r[3]<t[1]&&(l=t[1]-r[3]),i.distance([0,0],[o,l])}function $o(r,t,i){const o=i.pointOnLine(t,r);return i.distance(r,o.point)}function ao(r,t,i,o,l){const h=Math.min($o(r,[i,o],l),$o(t,[i,o],l)),p=Math.min($o(i,[r,t],l),$o(o,[r,t],l));return Math.min(h,p)}function Ph(r,t,i,o,l){if(!Ur(t,r.length)||!Ur(o,i.length))return 1/0;let h=1/0;for(let p=t[0];p<t[1];++p){const y=r[p],x=r[p+1];for(let w=o[0];w<o[1];++w){const M=i[w],A=i[w+1];if(Ll(y,x,M,A))return 0;h=Math.min(h,ao(y,x,M,A,l))}}return h}function ei(r,t,i,o,l){if(!Ur(t,r.length)||!Ur(o,i.length))return NaN;let h=1/0;for(let p=t[0];p<=t[1];++p)for(let y=o[0];y<=o[1];++y)if(h=Math.min(h,l.distance(r[p],i[y])),h===0)return h;return h}function Ih(r,t,i){if(Go(r,t,!0))return 0;let o=1/0;for(const l of t){const h=l[0],p=l[l.length-1];if(h!==p&&(o=Math.min(o,$o(r,[p,h],i)),o===0))return o;const y=i.pointOnLine(l,r);if(o=Math.min(o,i.distance(r,y.point)),o===0)return o}return o}function Zf(r,t,i,o){if(!Ur(t,r.length))return NaN;for(let h=t[0];h<=t[1];++h)if(Go(r[h],i,!0))return 0;let l=1/0;for(let h=t[0];h<t[1];++h){const p=r[h],y=r[h+1];for(const x of i)for(let w=0,M=x.length,A=M-1;w<M;A=w++){const D=x[A],I=x[w];if(Ll(p,y,D,I))return 0;l=Math.min(l,ao(p,y,D,I,o))}}return l}function so(r,t){for(const i of r)for(const o of i)if(Go(o,t,!0))return!0;return!1}function Ol(r,t,i,o=1/0){const l=Dc(r),h=Dc(t);if(o!==1/0&&wu(l,h,i)>=o)return o;if(bs(l,h)){if(so(r,t))return 0}else if(so(t,r))return 0;let p=1/0;for(const y of r)for(let x=0,w=y.length,M=w-1;x<w;M=x++){const A=y[M],D=y[x];for(const I of t)for(let k=0,F=I.length,U=F-1;k<F;U=k++){const X=I[U],st=I[k];if(Ll(A,D,X,st))return 0;p=Math.min(p,ao(A,D,X,st,i))}}return p}function Ic(r,t,i,o,l,h){if(!h)return;const p=wu(zc(o,h),l,i);p<t&&r.push([p,h,[0,0]])}function Tu(r,t,i,o,l,h,p){if(!h||!p)return;const y=wu(zc(o,h),zc(l,p),i);y<t&&r.push([y,h,p])}function Qa(r,t,i,o,l=1/0){let h=Math.min(o.distance(r[0],i[0][0]),l);if(h===0)return h;const p=new Ah([[0,[0,r.length-1],[0,0]]],Gf),y=Dc(i);for(;p.length>0;){const x=p.pop();if(x[0]>=h)continue;const w=x[1],M=t?50:100;if(Jn(w)<=M){if(!Ur(w,r.length))return NaN;if(t){const A=Zf(r,w,i,o);if(isNaN(A)||A===0)return A;h=Math.min(h,A)}else for(let A=w[0];A<=w[1];++A){const D=Ih(r[A],i,o);if(h=Math.min(h,D),h===0)return 0}}else{const A=Cc(w,t);Ic(p,h,o,r,y,A[0]),Ic(p,h,o,r,y,A[1])}}return h}function Su(r,t,i,o,l,h=1/0){let p=Math.min(h,l.distance(r[0],i[0]));if(p===0)return p;const y=new Ah([[0,[0,r.length-1],[0,i.length-1]]],Gf);for(;y.length>0;){const x=y.pop();if(x[0]>=p)continue;const w=x[1],M=x[2],A=t?50:100,D=o?50:100;if(Jn(w)<=A&&Jn(M)<=D){if(!Ur(w,r.length)&&Ur(M,i.length))return NaN;let I;if(t&&o)I=Ph(r,w,i,M,l),p=Math.min(p,I);else if(t&&!o){const k=r.slice(w[0],w[1]+1);for(let F=M[0];F<=M[1];++F)if(I=$o(i[F],k,l),p=Math.min(p,I),p===0)return p}else if(!t&&o){const k=i.slice(M[0],M[1]+1);for(let F=w[0];F<=w[1];++F)if(I=$o(r[F],k,l),p=Math.min(p,I),p===0)return p}else I=ei(r,w,i,M,l),p=Math.min(p,I)}else{const I=Cc(w,t),k=Cc(M,o);Tu(y,p,l,r,i,I[0],k[0]),Tu(y,p,l,r,i,I[0],k[1]),Tu(y,p,l,r,i,I[1],k[0]),Tu(y,p,l,r,i,I[1],k[1])}}return p}function Rc(r){return r.type==="MultiPolygon"?r.coordinates.map(t=>({type:"Polygon",coordinates:t})):r.type==="MultiLineString"?r.coordinates.map(t=>({type:"LineString",coordinates:t})):r.type==="MultiPoint"?r.coordinates.map(t=>({type:"Point",coordinates:t})):[r]}class oo{constructor(t,i){this.type=Ht,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Mr(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new oo(o,o.features.map(l=>Rc(l.geometry)).flat());if(o.type==="Feature")return new oo(o,Rc(o.geometry));if("type"in o&&"coordinates"in o)return new oo(o,Rc(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,o){const l=i.geometry(),h=l.flat().map(x=>Vo([x.x,x.y],i.canonical));if(l.length===0)return NaN;const p=new Dh(h[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Su(h,!1,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Su(h,!1,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,Qa(h,!1,x.coordinates,p,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,o){const l=i.geometry(),h=l.flat().map(x=>Vo([x.x,x.y],i.canonical));if(l.length===0)return NaN;const p=new Dh(h[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Su(h,!0,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Su(h,!0,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,Qa(h,!0,x.coordinates,p,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="Polygon")return function(i,o){const l=i.geometry();if(l.length===0||l[0].length===0)return NaN;const h=Bl(l,0).map(x=>x.map(w=>w.map(M=>Vo([M.x,M.y],i.canonical)))),p=new Dh(h[0][0][0][1]);let y=1/0;for(const x of o)for(const w of h){switch(x.type){case"Point":y=Math.min(y,Qa([x.coordinates],!1,w,p,y));break;case"LineString":y=Math.min(y,Qa(x.coordinates,!0,w,p,y));break;case"Polygon":y=Math.min(y,Ol(w,x.coordinates,p,y))}if(y===0)return y}return y}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Mu{constructor(t){this.type=Ie,this.key=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?i.error("Global state property must be defined."):typeof o!="string"?i.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Mu(o)}evaluate(t){var i;const o=(i=t.globals)===null||i===void 0?void 0:i.globalState;return o&&Object.keys(o).length!==0?Ga(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Fl={"==":wc,"!=":bh,">":Bf,"<":kf,">=":Sc,"<=":Tc,array:Kn,at:ta,boolean:Kn,case:yu,coalesce:Rl,collator:Nr,format:jo,image:wh,in:xs,"index-of":$a,interpolate:qn,"interpolate-hcl":qn,"interpolate-lab":qn,length:xu,let:Qe,literal:vs,match:_u,number:Kn,"number-format":Mc,object:Kn,slice:vu,step:ro,string:Kn,"to-boolean":rn,"to-color":rn,"to-number":rn,"to-string":rn,var:no,within:Ka,distance:oo,"global-state":Mu};class ua{constructor(t,i,o,l){this.name=t,this.type=i,this._evaluate=o,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,i){const o=t[0],l=ua.definitions[o];if(!l)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(l)?l[0]:l.type,p=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,y=p.filter(([w])=>!Array.isArray(w)||w.length===t.length-1);let x=null;for(const[w,M]of y){x=new Xa(i.registry,Yo,i.path,null,i.scope);const A=[];let D=!1;for(let I=1;I<t.length;I++){const k=t[I],F=Array.isArray(w)?w[I-1]:w.type,U=x.parse(k,1+A.length,F);if(!U){D=!0;break}A.push(U)}if(!D)if(Array.isArray(w)&&w.length!==A.length)x.error(`Expected ${w.length} arguments, but found ${A.length} instead.`);else{for(let I=0;I<A.length;I++){const k=Array.isArray(w)?w[I]:w.type,F=A[I];x.concat(I+1).checkSubtype(k,F.type)}if(x.errors.length===0)return new ua(o,h,M,A)}}if(y.length===1)i.errors.push(...x.errors);else{const w=(y.length?y:p).map(([A])=>{return D=A,Array.isArray(D)?`(${D.map(Ii).join(", ")})`:`(${Ii(D.type)}...)`;var D}).join(" | "),M=[];for(let A=1;A<t.length;A++){const D=i.parse(t[A],1+M.length);if(!D)return null;M.push(Ii(D.type))}i.error(`Expected arguments of type ${w}, but found (${M.join(", ")}) instead.`)}return null}static register(t,i){ua.definitions=i;for(const o in i)t[o]=ua}}function Rh(r,[t,i,o,l]){t=t.evaluate(r),i=i.evaluate(r),o=o.evaluate(r);const h=l?l.evaluate(r):1,p=Il(t,i,o,h);if(p)throw new Ti(p);return new Xe(t/255,i/255,o/255,h,!1)}function Lh(r,t){return r in t}function Eu(r,t){const i=t[r];return i===void 0?null:i}function tr(r){return{type:r}}function Yo(r){if(r instanceof no)return Yo(r.boundExpression);if(r instanceof ua&&r.name==="error"||r instanceof Nr||r instanceof Ka||r instanceof oo||r instanceof Mu)return!1;const t=r instanceof rn||r instanceof Kn;let i=!0;return r.eachChild(o=>{i=t?i&&Yo(o):i&&o instanceof vs}),!!i&&Er(r)&&Nl(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Er(r){if(r instanceof ua&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Ka||r instanceof oo)return!1;let t=!0;return r.eachChild(i=>{t&&!Er(i)&&(t=!1)}),t}function Ja(r){if(r instanceof ua&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(i=>{t&&!Ja(i)&&(t=!1)}),t}function Nl(r,t){if(r instanceof ua&&t.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(o=>{i&&!Nl(o,t)&&(i=!1)}),i}function Au(r){return{result:"success",value:r}}function ws(r){return{result:"error",value:r}}function lo(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function uo(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Lc(r){return!!r.expression&&r.expression.interpolated}function Ve(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Ts(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&Ri(r)===Gn}function rp(r){return r}function jr(r,t){const i=r.stops&&typeof r.stops[0][0]=="object",o=i||!(i||r.property!==void 0),l=r.type||(Lc(t)?"exponential":"interval"),h=function(M){switch(M.type){case"color":return Xe.parse;case"padding":return gn.parse;case"numberArray":return _n.parse;case"colorArray":return An.parse;default:return null}}(t);if(h&&((r=Di({},r)).stops&&(r.stops=r.stops.map(M=>[M[0],h(M[1])])),r.default=h(r.default?r.default:t.default)),r.colorSpace&&(p=r.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var p;const y=function(M){switch(M){case"exponential":return Cu;case"interval":return qf;case"categorical":return Sa;case"identity":return Ko;default:throw new Error(`Unknown function type "${M}"`)}}(l);let x,w;if(l==="categorical"){x=Object.create(null);for(const M of r.stops)x[M[0]]=M[1];w=typeof r.stops[0][0]}if(i){const M={},A=[];for(let k=0;k<r.stops.length;k++){const F=r.stops[k],U=F[0].zoom;M[U]===void 0&&(M[U]={zoom:U,type:r.type,property:r.property,default:r.default,stops:[]},A.push(U)),M[U].stops.push([F[0].value,F[1]])}const D=[];for(const k of A)D.push([M[k].zoom,jr(M[k],t)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:qn.interpolationFactor.bind(void 0,I),zoomStops:D.map(k=>k[0]),evaluate:({zoom:k},F)=>Cu({stops:D,base:r.base},t,k).evaluate(k,F)}}if(o){const M=l==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:qn.interpolationFactor.bind(void 0,M),zoomStops:r.stops.map(A=>A[0]),evaluate:({zoom:A})=>y(r,t,A,x,w)}}return{kind:"source",evaluate(M,A){const D=A&&A.properties?A.properties[r.property]:void 0;return D===void 0?Wo(r.default,t.default):y(r,t,D,x,w)}}}function Wo(r,t,i){return r!==void 0?r:t!==void 0?t:i!==void 0?i:void 0}function Sa(r,t,i,o,l){return Wo(typeof i===l?o[i]:void 0,r.default,t.default)}function qf(r,t,i){if(Ve(i)!=="number")return Wo(r.default,t.default);const o=r.stops.length;if(o===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[o-1][0])return r.stops[o-1][1];const l=vc(r.stops.map(h=>h[0]),i);return r.stops[l][1]}function Cu(r,t,i){const o=r.base!==void 0?r.base:1;if(Ve(i)!=="number")return Wo(r.default,t.default);const l=r.stops.length;if(l===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[l-1][0])return r.stops[l-1][1];const h=vc(r.stops.map(M=>M[0]),i),p=function(M,A,D,I){const k=I-D,F=M-D;return k===0?0:A===1?F/k:(Math.pow(A,F)-1)/(Math.pow(A,k)-1)}(i,o,r.stops[h][0],r.stops[h+1][0]),y=r.stops[h][1],x=r.stops[h+1][1],w=wa[t.type]||rp;return typeof y.evaluate=="function"?{evaluate(...M){const A=y.evaluate.apply(void 0,M),D=x.evaluate.apply(void 0,M);if(A!==void 0&&D!==void 0)return w(A,D,p,r.colorSpace)}}:w(y,x,p,r.colorSpace)}function Ko(r,t,i){switch(t.type){case"color":i=Xe.parse(i);break;case"formatted":i=cn.fromString(i.toString());break;case"resolvedImage":i=hn.fromString(i.toString());break;case"padding":i=gn.parse(i);break;case"colorArray":i=An.parse(i);break;case"numberArray":i=_n.parse(i);break;default:Ve(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0)}return Wo(i,r.default,t.default)}ua.register(Fl,{error:[{kind:"error"},[se],(r,[t])=>{throw new Ti(t.evaluate(r))}],typeof:[se,[Ie],(r,[t])=>Ii(Ri(t.evaluate(r)))],"to-rgba":[Br(Ht,4),[cr],(r,[t])=>{const[i,o,l,h]=t.evaluate(r).rgb;return[255*i,255*o,255*l,h]}],rgb:[cr,[Ht,Ht,Ht],Rh],rgba:[cr,[Ht,Ht,Ht,Ht],Rh],has:{type:be,overloads:[[[se],(r,[t])=>Lh(t.evaluate(r),r.properties())],[[se,Gn],(r,[t,i])=>Lh(t.evaluate(r),i.evaluate(r))]]},get:{type:Ie,overloads:[[[se],(r,[t])=>Eu(t.evaluate(r),r.properties())],[[se,Gn],(r,[t,i])=>Eu(t.evaluate(r),i.evaluate(r))]]},"feature-state":[Ie,[se],(r,[t])=>Eu(t.evaluate(r),r.featureState||{})],properties:[Gn,[],r=>r.properties()],"geometry-type":[se,[],r=>r.geometryType()],id:[Ie,[],r=>r.id()],zoom:[Ht,[],r=>r.globals.zoom],"heatmap-density":[Ht,[],r=>r.globals.heatmapDensity||0],elevation:[Ht,[],r=>r.globals.elevation||0],"line-progress":[Ht,[],r=>r.globals.lineProgress||0],accumulated:[Ie,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ht,tr(Ht),(r,t)=>{let i=0;for(const o of t)i+=o.evaluate(r);return i}],"*":[Ht,tr(Ht),(r,t)=>{let i=1;for(const o of t)i*=o.evaluate(r);return i}],"-":{type:Ht,overloads:[[[Ht,Ht],(r,[t,i])=>t.evaluate(r)-i.evaluate(r)],[[Ht],(r,[t])=>-t.evaluate(r)]]},"/":[Ht,[Ht,Ht],(r,[t,i])=>t.evaluate(r)/i.evaluate(r)],"%":[Ht,[Ht,Ht],(r,[t,i])=>t.evaluate(r)%i.evaluate(r)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(r,[t,i])=>Math.pow(t.evaluate(r),i.evaluate(r))],sqrt:[Ht,[Ht],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[Ht,[Ht],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[Ht,[Ht],(r,[t])=>Math.log(t.evaluate(r))],log2:[Ht,[Ht],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[Ht,[Ht],(r,[t])=>Math.sin(t.evaluate(r))],cos:[Ht,[Ht],(r,[t])=>Math.cos(t.evaluate(r))],tan:[Ht,[Ht],(r,[t])=>Math.tan(t.evaluate(r))],asin:[Ht,[Ht],(r,[t])=>Math.asin(t.evaluate(r))],acos:[Ht,[Ht],(r,[t])=>Math.acos(t.evaluate(r))],atan:[Ht,[Ht],(r,[t])=>Math.atan(t.evaluate(r))],min:[Ht,tr(Ht),(r,t)=>Math.min(...t.map(i=>i.evaluate(r)))],max:[Ht,tr(Ht),(r,t)=>Math.max(...t.map(i=>i.evaluate(r)))],abs:[Ht,[Ht],(r,[t])=>Math.abs(t.evaluate(r))],round:[Ht,[Ht],(r,[t])=>{const i=t.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ht,[Ht],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[Ht,[Ht],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[be,[se,Ie],(r,[t,i])=>r.properties()[t.value]===i.value],"filter-id-==":[be,[Ie],(r,[t])=>r.id()===t.value],"filter-type-==":[be,[se],(r,[t])=>r.geometryType()===t.value],"filter-<":[be,[se,Ie],(r,[t,i])=>{const o=r.properties()[t.value],l=i.value;return typeof o==typeof l&&o<l}],"filter-id-<":[be,[Ie],(r,[t])=>{const i=r.id(),o=t.value;return typeof i==typeof o&&i<o}],"filter->":[be,[se,Ie],(r,[t,i])=>{const o=r.properties()[t.value],l=i.value;return typeof o==typeof l&&o>l}],"filter-id->":[be,[Ie],(r,[t])=>{const i=r.id(),o=t.value;return typeof i==typeof o&&i>o}],"filter-<=":[be,[se,Ie],(r,[t,i])=>{const o=r.properties()[t.value],l=i.value;return typeof o==typeof l&&o<=l}],"filter-id-<=":[be,[Ie],(r,[t])=>{const i=r.id(),o=t.value;return typeof i==typeof o&&i<=o}],"filter->=":[be,[se,Ie],(r,[t,i])=>{const o=r.properties()[t.value],l=i.value;return typeof o==typeof l&&o>=l}],"filter-id->=":[be,[Ie],(r,[t])=>{const i=r.id(),o=t.value;return typeof i==typeof o&&i>=o}],"filter-has":[be,[Ie],(r,[t])=>t.value in r.properties()],"filter-has-id":[be,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[be,[Br(se)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[be,[Br(Ie)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[be,[se,Br(Ie)],(r,[t,i])=>i.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[be,[se,Br(Ie)],(r,[t,i])=>function(o,l,h,p){for(;h<=p;){const y=h+p>>1;if(l[y]===o)return!0;l[y]>o?p=y-1:h=y+1}return!1}(r.properties()[t.value],i.value,0,i.value.length-1)],all:{type:be,overloads:[[[be,be],(r,[t,i])=>t.evaluate(r)&&i.evaluate(r)],[tr(be),(r,t)=>{for(const i of t)if(!i.evaluate(r))return!1;return!0}]]},any:{type:be,overloads:[[[be,be],(r,[t,i])=>t.evaluate(r)||i.evaluate(r)],[tr(be),(r,t)=>{for(const i of t)if(i.evaluate(r))return!0;return!1}]]},"!":[be,[be],(r,[t])=>!t.evaluate(r)],"is-supported-script":[be,[se],(r,[t])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(t.evaluate(r))}],upcase:[se,[se],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[se,[se],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[se,tr(Ie),(r,t)=>t.map(i=>ys(i.evaluate(r))).join("")],"resolved-locale":[se,[Qr],(r,[t])=>t.evaluate(r).resolvedLocale()]});class Ul{constructor(t,i,o){this.expression=t,this._warningHistory={},this._evaluator=new Be,this._defaultValue=i?function(l){if(l.type==="color"&&Ts(l.default))return new Xe(0,0,0,0);switch(l.type){case"color":return Xe.parse(l.default)||null;case"padding":return gn.parse(l.default)||null;case"numberArray":return _n.parse(l.default)||null;case"colorArray":return An.parse(l.default)||null;case"variableAnchorOffsetCollection":return kn.parse(l.default)||null;case"projectionDefinition":return Zn.parse(l.default)||null;default:return l.default===void 0?null:l.default}}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=o}evaluateWithoutErrorHandling(t,i,o,l,h,p){return this._globalState&&(t=er(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(t,i,o,l,h,p){this._globalState&&(t=er(t,this._globalState)),this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=l,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=p||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Ti(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function zu(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Fl}function jl(r,t,i){const o=new Xa(Fl,Yo,[],t?function(h){const p={color:cr,string:se,number:Ht,enum:se,boolean:be,formatted:eo,padding:va,numberArray:xa,colorArray:hr,projectionDefinition:Bo,resolvedImage:ba,variableAnchorOffsetCollection:nn};return h.type==="array"?Br(p[h.value]||Ie,h.length):p[h.type]}(t):void 0),l=o.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Au(new Ul(l,t,i)):ws(o.errors)}class co{constructor(t,i,o){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!Ja(i.expression),this.globalStateRefs=ho(i.expression),this._globalState=o}evaluateWithoutErrorHandling(t,i,o,l,h,p){return this._globalState&&(t=er(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,i,o,l,h,p)}evaluate(t,i,o,l,h,p){return this._globalState&&(t=er(t,this._globalState)),this._styleExpression.evaluate(t,i,o,l,h,p)}}class Ar{constructor(t,i,o,l,h){this.kind=t,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!Ja(i.expression),this.globalStateRefs=ho(i.expression),this.interpolationType=l,this._globalState=h}evaluateWithoutErrorHandling(t,i,o,l,h,p){return this._globalState&&(t=er(t,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(t,i,o,l,h,p)}evaluate(t,i,o,l,h,p){return this._globalState&&(t=er(t,this._globalState)),this._styleExpression.evaluate(t,i,o,l,h,p)}interpolationFactor(t,i,o){return this.interpolationType?qn.interpolationFactor(this.interpolationType,t,i,o):0}}function Qo(r,t,i){const o=jl(r,t,i);if(o.result==="error")return o;const l=o.value.expression,h=Er(l);if(!h&&!lo(t))return ws([new Pi("","data expressions not supported")]);const p=Nl(l,["zoom"]);if(!p&&!uo(t))return ws([new Pi("","zoom expressions not supported")]);const y=Jo(l);return y||p?y instanceof Pi?ws([y]):y instanceof qn&&!Lc(t)?ws([new Pi("",'"interpolate" expressions cannot be used with this property')]):Au(y?new Ar(h?"camera":"composite",o.value,y.labels,y instanceof qn?y.interpolation:void 0,i):new co(h?"constant":"source",o.value,i)):ws([new Pi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ss{constructor(t,i){this._parameters=t,this._specification=i,Di(this,jr(this._parameters,this._specification))}static deserialize(t){return new Ss(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Jo(r){let t=null;if(r instanceof Qe)t=Jo(r.result);else if(r instanceof Rl){for(const i of r.args)if(t=Jo(i),t)break}else(r instanceof ro||r instanceof qn)&&r.input instanceof ua&&r.input.name==="zoom"&&(t=r);return t instanceof Pi||r.eachChild(i=>{const o=Jo(i);o instanceof Pi?t=o:!t&&o?t=new Pi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Pi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function ho(r,t=new Set){return r instanceof Mu&&t.add(r.key),r.eachChild(i=>{ho(i,t)}),t}function er(r,t){const{zoom:i,heatmapDensity:o,elevation:l,lineProgress:h,isSupportedScript:p,accumulated:y}=r??{};return{zoom:i,heatmapDensity:o,elevation:l,lineProgress:h,isSupportedScript:p,accumulated:y,globalState:t}}function Cr(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!Cr(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Ms={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Vr(r,t){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Cr(r)||(r=Vl(r));const i=jl(r,Ms,t);if(i.result==="error")throw new Error(i.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,l,h)=>i.value.evaluate(o,l,{},h),needGeometry:Ma(r),getGlobalStateRefs:()=>ho(i.value.expression)}}function ts(r,t){return r<t?-1:r>t?1:0}function Ma(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(Ma(r[t]))return!0;return!1}function Vl(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?Gl(r[1],r[2],"=="):t==="!="?zn(Gl(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Gl(r[1],r[2],t):t==="any"?(i=r.slice(1),["any"].concat(i.map(Vl))):t==="all"?["all"].concat(r.slice(1).map(Vl)):t==="none"?["all"].concat(r.slice(1).map(Vl).map(zn)):t==="in"?kc(r[1],r.slice(2)):t==="!in"?zn(kc(r[1],r.slice(2))):t==="has"?kh(r[1]):t!=="!has"||zn(kh(r[1]));var i}function Gl(r,t,i){switch(r){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,r,t]}}function kc(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",r,["literal",t.sort(ts)]]:["filter-in-small",r,["literal",t]]}}function kh(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function zn(r){return["!",r]}function Fi(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let l="[";for(const h of r)l+=`${Fi(h)},`;return`${l}]`}const i=Object.keys(r).sort();let o="{";for(let l=0;l<i.length;l++)o+=`${JSON.stringify(i[l])}:${Fi(r[i[l]])},`;return`${o}}`}function ii(r){let t="";for(const i of yt)t+=`/${Fi(r[i])}`;return t}function es(r){const t=r.value;return t?[new Qt(r.key,t,"constants have been deprecated as of v8")]:[]}function ri(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Ea(r){if(Array.isArray(r))return r.map(Ea);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const i in r)t[i]=Ea(r[i]);return t}return ri(r)}function yn(r){const t=r.key,i=r.value,o=r.valueSpec||{},l=r.objectElementValidators||{},h=r.style,p=r.styleSpec,y=r.validateSpec;let x=[];const w=Ve(i);if(w!=="object")return[new Qt(t,i,`object expected, ${w} found`)];for(const M in i){const A=M.split(".")[0],D=Ga(o,A)||o["*"];let I;if(Ga(l,A))I=l[A];else if(Ga(o,A))I=y;else if(l["*"])I=l["*"];else{if(!o["*"]){x.push(new Qt(t,i[M],`unknown property "${M}"`));continue}I=y}x=x.concat(I({key:(t&&`${t}.`)+M,value:i[M],valueSpec:D,style:h,styleSpec:p,object:i,objectKey:M,validateSpec:y},i))}for(const M in o)l[M]||o[M].required&&o[M].default===void 0&&i[M]===void 0&&x.push(new Qt(t,i,`missing required property "${M}"`));return x}function Zl(r){const t=r.value,i=r.valueSpec,o=r.style,l=r.styleSpec,h=r.key,p=r.arrayElementValidator||r.validateSpec;if(Ve(t)!=="array")return[new Qt(h,t,`array expected, ${Ve(t)} found`)];if(i.length&&t.length!==i.length)return[new Qt(h,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new Qt(h,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let y={type:i.value,values:i.values};l.$version<7&&(y.function=i.function),Ve(i.value)==="object"&&(y=i.value);let x=[];for(let w=0;w<t.length;w++)x=x.concat(p({array:t,arrayIndex:w,value:t[w],valueSpec:y,validateSpec:r.validateSpec,style:o,styleSpec:l,key:`${h}[${w}]`}));return x}function fo(r){const t=r.key,i=r.value,o=r.valueSpec;let l=Ve(i);return l==="number"&&i!=i&&(l="NaN"),l!=="number"?[new Qt(t,i,`number expected, ${l} found`)]:"minimum"in o&&i<o.minimum?[new Qt(t,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new Qt(t,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function tl(r){const t=r.valueSpec,i=ri(r.value.type);let o,l,h,p={};const y=i!=="categorical"&&r.value.property===void 0,x=!y,w=Ve(r.value.stops)==="array"&&Ve(r.value.stops[0])==="array"&&Ve(r.value.stops[0][0])==="object",M=yn({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(I){if(i==="identity")return[new Qt(I.key,I.value,'identity function may not have a "stops" property')];let k=[];const F=I.value;return k=k.concat(Zl({key:I.key,value:F,valueSpec:I.valueSpec,validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec,arrayElementValidator:A})),Ve(F)==="array"&&F.length===0&&k.push(new Qt(I.key,F,"array must have at least one stop")),k},default:function(I){return I.validateSpec({key:I.key,value:I.value,valueSpec:t,validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec})}}});return i==="identity"&&y&&M.push(new Qt(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||M.push(new Qt(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!Lc(r.valueSpec)&&M.push(new Qt(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!lo(r.valueSpec)?M.push(new Qt(r.key,r.value,"property functions not supported")):y&&!uo(r.valueSpec)&&M.push(new Qt(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!w||r.value.property!==void 0||M.push(new Qt(r.key,r.value,'"property" property is required')),M;function A(I){let k=[];const F=I.value,U=I.key;if(Ve(F)!=="array")return[new Qt(U,F,`array expected, ${Ve(F)} found`)];if(F.length!==2)return[new Qt(U,F,`array length 2 expected, length ${F.length} found`)];if(w){if(Ve(F[0])!=="object")return[new Qt(U,F,`object expected, ${Ve(F[0])} found`)];if(F[0].zoom===void 0)return[new Qt(U,F,"object stop key must have zoom")];if(F[0].value===void 0)return[new Qt(U,F,"object stop key must have value")];if(h&&h>ri(F[0].zoom))return[new Qt(U,F[0].zoom,"stop zoom values must appear in ascending order")];ri(F[0].zoom)!==h&&(h=ri(F[0].zoom),l=void 0,p={}),k=k.concat(yn({key:`${U}[0]`,value:F[0],valueSpec:{zoom:{}},validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec,objectElementValidators:{zoom:fo,value:D}}))}else k=k.concat(D({key:`${U}[0]`,value:F[0],validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec},F));return zu(Ea(F[1]))?k.concat([new Qt(`${U}[1]`,F[1],"expressions are not allowed in function stops.")]):k.concat(I.validateSpec({key:`${U}[1]`,value:F[1],valueSpec:t,validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec}))}function D(I,k){const F=Ve(I.value),U=ri(I.value),X=I.value!==null?I.value:k;if(o){if(F!==o)return[new Qt(I.key,X,`${F} stop domain type must match previous stop domain type ${o}`)]}else o=F;if(F!=="number"&&F!=="string"&&F!=="boolean")return[new Qt(I.key,X,"stop domain value must be a number, string, or boolean")];if(F!=="number"&&i!=="categorical"){let st=`number expected, ${F} found`;return lo(t)&&i===void 0&&(st+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qt(I.key,X,st)]}return i!=="categorical"||F!=="number"||isFinite(U)&&Math.floor(U)===U?i!=="categorical"&&F==="number"&&l!==void 0&&U<l?[new Qt(I.key,X,"stop domain values must appear in ascending order")]:(l=U,i==="categorical"&&U in p?[new Qt(I.key,X,"stop domain values must be unique")]:(p[U]=!0,[])):[new Qt(I.key,X,`integer expected, found ${U}`)]}}function ca(r){const t=(r.expressionContext==="property"?Qo:jl)(Ea(r.value),r.valueSpec);if(t.result==="error")return t.value.map(o=>new Qt(`${r.key}${o.key}`,r.value,o.message));const i=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new Qt(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Ja(i))return[new Qt(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Ja(i))return[new Qt(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Nl(i,["zoom","feature-state"]))return[new Qt(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Er(i))return[new Qt(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Du(r){const t=r.key,i=r.value,o=Ve(i);return o!=="string"?[new Qt(t,i,`color expected, ${o} found`)]:Xe.parse(String(i))?[]:[new Qt(t,i,`color expected, "${i}" found`)]}function Es(r){const t=r.key,i=r.value,o=r.valueSpec,l=[];return Array.isArray(o.values)?o.values.indexOf(ri(i))===-1&&l.push(new Qt(t,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(ri(i))===-1&&l.push(new Qt(t,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),l}function Pu(r){return Cr(Ea(r.value))?ca(Di({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):po(r)}function po(r){const t=r.value,i=r.key;if(Ve(t)!=="array")return[new Qt(i,t,`array expected, ${Ve(t)} found`)];const o=r.styleSpec;let l,h=[];if(t.length<1)return[new Qt(i,t,"filter array must have at least 1 element")];switch(h=h.concat(Es({key:`${i}[0]`,value:t[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),ri(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&ri(t[1])==="$type"&&h.push(new Qt(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&h.push(new Qt(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=Ve(t[1]),l!=="string"&&h.push(new Qt(`${i}[1]`,t[1],`string expected, ${l} found`)));for(let p=2;p<t.length;p++)l=Ve(t[p]),ri(t[1])==="$type"?h=h.concat(Es({key:`${i}[${p}]`,value:t[p],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&h.push(new Qt(`${i}[${p}]`,t[p],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let p=1;p<t.length;p++)h=h.concat(po({key:`${i}[${p}]`,value:t[p],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":l=Ve(t[1]),t.length!==2?h.push(new Qt(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&h.push(new Qt(`${i}[1]`,t[1],`string expected, ${l} found`))}return h}function Aa(r,t){const i=r.key,o=r.validateSpec,l=r.style,h=r.styleSpec,p=r.value,y=r.objectKey,x=h[`${t}_${r.layerType}`];if(!x)return[];const w=y.match(/^(.*)-transition$/);if(t==="paint"&&w&&x[w[1]]&&x[w[1]].transition)return o({key:i,value:p,valueSpec:h.transition,style:l,styleSpec:h});const M=r.valueSpec||x[y];if(!M)return[new Qt(i,p,`unknown property "${y}"`)];let A;if(Ve(p)==="string"&&lo(M)&&!M.tokens&&(A=/^{([^}]+)}$/.exec(p)))return[new Qt(i,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const D=[];return r.layerType==="symbol"&&y==="text-font"&&Ts(Ea(p))&&ri(p.type)==="identity"&&D.push(new Qt(i,p,'"text-font" does not support identity functions')),D.concat(o({key:r.key,value:p,valueSpec:M,style:l,styleSpec:h,expressionContext:"property",propertyType:t,propertyKey:y}))}function is(r){return Aa(r,"paint")}function ea(r){return Aa(r,"layout")}function Bc(r){let t=[];const i=r.value,o=r.key,l=r.style,h=r.styleSpec;if(Ve(i)!=="object")return[new Qt(o,i,`object expected, ${Ve(i)} found`)];i.type||i.ref||t.push(new Qt(o,i,'either "type" or "ref" is required'));let p=ri(i.type);const y=ri(i.ref);if(i.id){const x=ri(i.id);for(let w=0;w<r.arrayIndex;w++){const M=l.layers[w];ri(M.id)===x&&t.push(new Qt(o,i.id,`duplicate layer id "${i.id}", previously used at line ${M.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach(w=>{w in i&&t.push(new Qt(o,i[w],`"${w}" is prohibited for ref layers`))}),l.layers.forEach(w=>{ri(w.id)===y&&(x=w)}),x?x.ref?t.push(new Qt(o,i.ref,"ref cannot reference another ref layer")):p=ri(x.type):t.push(new Qt(o,i.ref,`ref layer "${y}" not found`))}else if(p!=="background")if(i.source){const x=l.sources&&l.sources[i.source],w=x&&ri(x.type);x?w==="vector"&&p==="raster"?t.push(new Qt(o,i.source,`layer "${i.id}" requires a raster source`)):w!=="raster-dem"&&p==="hillshade"||w!=="raster-dem"&&p==="color-relief"?t.push(new Qt(o,i.source,`layer "${i.id}" requires a raster-dem source`)):w==="raster"&&p!=="raster"?t.push(new Qt(o,i.source,`layer "${i.id}" requires a vector source`)):w!=="vector"||i["source-layer"]?w==="raster-dem"&&p!=="hillshade"&&p!=="color-relief"?t.push(new Qt(o,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):p!=="line"||!i.paint||!i.paint["line-gradient"]||w==="geojson"&&x.lineMetrics||t.push(new Qt(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Qt(o,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new Qt(o,i.source,`source "${i.source}" not found`))}else t.push(new Qt(o,i,'missing required property "source"'));return t=t.concat(yn({key:o,value:i,valueSpec:h.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:i.type,valueSpec:h.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:i,objectKey:"type"}),filter:Pu,layout:x=>yn({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":w=>ea(Di({layerType:p},w))}}),paint:x=>yn({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":w=>is(Di({layerType:p},w))}})}})),t}function ns(r){const t=r.value,i=r.key,o=Ve(t);return o!=="string"?[new Qt(i,t,`string expected, ${o} found`)]:[]}const mo={promoteId:function({key:r,value:t}){if(Ve(t)==="string")return ns({key:r,value:t});{const i=[];for(const o in t)i.push(...ns({key:`${r}.${o}`,value:t[o]}));return i}}};function Iu(r){const t=r.value,i=r.key,o=r.styleSpec,l=r.style,h=r.validateSpec;if(!t.type)return[new Qt(i,t,'"type" is required')];const p=ri(t.type);let y;switch(p){case"vector":case"raster":return y=yn({key:i,value:t,valueSpec:o[`source_${p.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:mo,validateSpec:h}),y;case"raster-dem":return y=function(x){var w;const M=(w=x.sourceName)!==null&&w!==void 0?w:"",A=x.value,D=x.styleSpec,I=D.source_raster_dem,k=x.style;let F=[];const U=Ve(A);if(A===void 0)return F;if(U!=="object")return F.push(new Qt("source_raster_dem",A,`object expected, ${U} found`)),F;const X=ri(A.encoding)==="custom",st=["redFactor","greenFactor","blueFactor","baseShift"],Q=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const it in A)!X&&st.includes(it)?F.push(new Qt(it,A[it],`In "${M}": "${it}" is only valid when "encoding" is set to "custom". ${Q} encoding found`)):I[it]?F=F.concat(x.validateSpec({key:it,value:A[it],valueSpec:I[it],validateSpec:x.validateSpec,style:k,styleSpec:D})):F.push(new Qt(it,A[it],`unknown property "${it}"`));return F}({sourceName:i,value:t,style:r.style,styleSpec:o,validateSpec:h}),y;case"geojson":if(y=yn({key:i,value:t,valueSpec:o.source_geojson,style:l,styleSpec:o,validateSpec:h,objectElementValidators:mo}),t.cluster)for(const x in t.clusterProperties){const[w,M]=t.clusterProperties[x],A=typeof w=="string"?[w,["accumulated"],["get",x]]:w;y.push(...ca({key:`${i}.${x}.map`,value:M,expressionContext:"cluster-map"})),y.push(...ca({key:`${i}.${x}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return y;case"video":return yn({key:i,value:t,valueSpec:o.source_video,style:l,validateSpec:h,styleSpec:o});case"image":return yn({key:i,value:t,valueSpec:o.source_image,style:l,validateSpec:h,styleSpec:o});case"canvas":return[new Qt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Es({key:`${i}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function As(r){const t=r.value,i=r.styleSpec,o=i.light,l=r.style;let h=[];const p=Ve(t);if(t===void 0)return h;if(p!=="object")return h=h.concat([new Qt("light",t,`object expected, ${p} found`)]),h;for(const y in t){const x=y.match(/^(.*)-transition$/);h=h.concat(x&&o[x[1]]&&o[x[1]].transition?r.validateSpec({key:y,value:t[y],valueSpec:i.transition,validateSpec:r.validateSpec,style:l,styleSpec:i}):o[y]?r.validateSpec({key:y,value:t[y],valueSpec:o[y],validateSpec:r.validateSpec,style:l,styleSpec:i}):[new Qt(y,t[y],`unknown property "${y}"`)])}return h}function Bn(r){const t=r.value,i=r.styleSpec,o=i.sky,l=r.style,h=Ve(t);if(t===void 0)return[];if(h!=="object")return[new Qt("sky",t,`object expected, ${h} found`)];let p=[];for(const y in t)p=p.concat(o[y]?r.validateSpec({key:y,value:t[y],valueSpec:o[y],style:l,styleSpec:i}):[new Qt(y,t[y],`unknown property "${y}"`)]);return p}function Cs(r){const t=r.value,i=r.styleSpec,o=i.terrain,l=r.style;let h=[];const p=Ve(t);if(t===void 0)return h;if(p!=="object")return h=h.concat([new Qt("terrain",t,`object expected, ${p} found`)]),h;for(const y in t)h=h.concat(o[y]?r.validateSpec({key:y,value:t[y],valueSpec:o[y],validateSpec:r.validateSpec,style:l,styleSpec:i}):[new Qt(y,t[y],`unknown property "${y}"`)]);return h}function Bh(r){let t=[];const i=r.value,o=r.key;if(Array.isArray(i)){const l=[],h=[];for(const p in i)i[p].id&&l.includes(i[p].id)&&t.push(new Qt(o,i,`all the sprites' ids must be unique, but ${i[p].id} is duplicated`)),l.push(i[p].id),i[p].url&&h.includes(i[p].url)&&t.push(new Qt(o,i,`all the sprites' URLs must be unique, but ${i[p].url} is duplicated`)),h.push(i[p].url),t=t.concat(yn({key:`${o}[${p}]`,value:i[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return ns({key:o,value:i})}function Hf(r){return t=r.value,t&&t.constructor===Object?[]:[new Qt(r.key,r.value,`object expected, ${Ve(r.value)} found`)];var t}const Xf={"*":()=>[],array:Zl,boolean:function(r){const t=r.value,i=r.key,o=Ve(t);return o!=="boolean"?[new Qt(i,t,`boolean expected, ${o} found`)]:[]},number:fo,color:Du,constants:es,enum:Es,filter:Pu,function:tl,layer:Bc,object:yn,source:Iu,light:As,sky:Bn,terrain:Cs,projection:function(r){const t=r.value,i=r.styleSpec,o=i.projection,l=r.style,h=Ve(t);if(t===void 0)return[];if(h!=="object")return[new Qt("projection",t,`object expected, ${h} found`)];let p=[];for(const y in t)p=p.concat(o[y]?r.validateSpec({key:y,value:t[y],valueSpec:o[y],style:l,styleSpec:i}):[new Qt(y,t[y],`unknown property "${y}"`)]);return p},projectionDefinition:function(r){const t=r.key;let i=r.value;i=i instanceof String?i.valueOf():i;const o=Ve(i);return o!=="array"||function(l){return Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"}(i)||function(l){return!!["interpolate","step","literal"].includes(l[0])}(i)?["array","string"].includes(o)?[]:[new Qt(t,i,`projection expected, invalid type "${o}" found`)]:[new Qt(t,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:ns,formatted:function(r){return ns(r).length===0?[]:ca(r)},resolvedImage:function(r){return ns(r).length===0?[]:ca(r)},padding:function(r){const t=r.key,i=r.value;if(Ve(i)==="array"){if(i.length<1||i.length>4)return[new Qt(t,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let l=[];for(let h=0;h<i.length;h++)l=l.concat(r.validateSpec({key:`${t}[${h}]`,value:i[h],validateSpec:r.validateSpec,valueSpec:o}));return l}return fo({key:t,value:i,valueSpec:{}})},numberArray:function(r){const t=r.key,i=r.value;if(Ve(i)==="array"){const o={type:"number"};if(i.length<1)return[new Qt(t,i,"array length at least 1 expected, length 0 found")];let l=[];for(let h=0;h<i.length;h++)l=l.concat(r.validateSpec({key:`${t}[${h}]`,value:i[h],validateSpec:r.validateSpec,valueSpec:o}));return l}return fo({key:t,value:i,valueSpec:{}})},colorArray:function(r){const t=r.key,i=r.value;if(Ve(i)==="array"){if(i.length<1)return[new Qt(t,i,"array length at least 1 expected, length 0 found")];let o=[];for(let l=0;l<i.length;l++)o=o.concat(Du({key:`${t}[${l}]`,value:i[l]}));return o}return Du({key:t,value:i})},variableAnchorOffsetCollection:function(r){const t=r.key,i=r.value,o=Ve(i),l=r.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new Qt(t,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let h=[];for(let p=0;p<i.length;p+=2)h=h.concat(Es({key:`${t}[${p}]`,value:i[p],valueSpec:l.layout_symbol["text-anchor"]})),h=h.concat(Zl({key:`${t}[${p+1}]`,value:i[p+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:l}));return h},sprite:Bh,state:Hf};function Oc(r){const t=r.value,i=r.valueSpec,o=r.styleSpec;return r.validateSpec=Oc,i.expression&&Ts(ri(t))?tl(r):i.expression&&zu(Ea(t))?ca(r):i.type&&Xf[i.type]?Xf[i.type](r):yn(Di({},r,{valueSpec:i.type?o[i.type]:i}))}function vn(r){const t=r.value,i=r.key,o=ns(r);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Qt(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Qt(i,t,'"glyphs" url must include a "{range}" token'))),o}function Gr(r,t=tt){let i=[];return i=i.concat(Oc({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:Oc,objectElementValidators:{glyphs:vn,"*":()=>[]}})),r.constants&&(i=i.concat(es({key:"constants",value:r.constants}))),rs(i)}function On(r){return function(t){return r(Object.assign({},t,{validateSpec:Oc}))}}function rs(r){return[].concat(r).sort((t,i)=>t.line-i.line)}function Hi(r){return function(...t){return rs(r.apply(this,t))}}Gr.source=Hi(On(Iu)),Gr.sprite=Hi(On(Bh)),Gr.glyphs=Hi(On(vn)),Gr.light=Hi(On(As)),Gr.sky=Hi(On(Bn)),Gr.terrain=Hi(On(Cs)),Gr.state=Hi(On(Hf)),Gr.layer=Hi(On(Bc)),Gr.filter=Hi(On(Pu)),Gr.paintProperty=Hi(On(is)),Gr.layoutProperty=Hi(On(ea));const as=tt,ha=Gr,ap=ha.light,$f=ha.sky,Ru=ha.paintProperty,Oh=ha.layoutProperty;function ss(r,t){let i=!1;if(t&&t.length)for(const o of t)r.fire(new ut(new Error(o.message))),i=!0;return i}class el{constructor(t,i,o){const l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const p=new Int32Array(this.arrayBuffer);t=p[0],this.d=(i=p[1])+2*(o=p[2]);for(let x=0;x<this.d*this.d;x++){const w=p[3+x],M=p[3+x+1];l.push(w===M?null:p.subarray(w,M))}const y=p[3+l.length+1];this.keys=p.subarray(p[3+l.length],y),this.bboxes=p.subarray(y),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let p=0;p<this.d*this.d;p++)l.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=t,this.padding=o,this.scale=i/t,this.uid=0;const h=o/i*t;this.min=-h,this.max=t+h}insert(t,i,o,l,h){this._forEachCell(i,o,l,h,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(h)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,i,o,l,h,p){this.cells[h].push(p)}query(t,i,o,l,h){const p=this.min,y=this.max;if(t<=p&&i<=p&&y<=o&&y<=l&&!h)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,i,o,l,this._queryCell,x,{},h),x}}_queryCell(t,i,o,l,h,p,y,x){const w=this.cells[h];if(w!==null){const M=this.keys,A=this.bboxes;for(let D=0;D<w.length;D++){const I=w[D];if(y[I]===void 0){const k=4*I;(x?x(A[k+0],A[k+1],A[k+2],A[k+3]):t<=A[k+2]&&i<=A[k+3]&&o>=A[k+0]&&l>=A[k+1])?(y[I]=!0,p.push(M[I])):y[I]=!1}}}}_forEachCell(t,i,o,l,h,p,y,x){const w=this._convertToCellCoord(t),M=this._convertToCellCoord(i),A=this._convertToCellCoord(o),D=this._convertToCellCoord(l);for(let I=w;I<=A;I++)for(let k=M;k<=D;k++){const F=this.d*k+I;if((!x||x(this._convertFromCellCoord(I),this._convertFromCellCoord(k),this._convertFromCellCoord(I+1),this._convertFromCellCoord(k+1)))&&h.call(this,t,i,o,l,F,p,y,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,i=3+this.cells.length+1+1;let o=0;for(let p=0;p<this.cells.length;p++)o+=this.cells[p].length;const l=new Int32Array(i+o+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let h=i;for(let p=0;p<t.length;p++){const y=t[p];l[3+p]=h,l.set(y,h),h+=y.length}return l[3+t.length]=h,l.set(this.keys,h),h+=this.keys.length,l[3+t.length+1]=h,l.set(this.bboxes,h),h+=this.bboxes.length,l.buffer}static serialize(t,i){const o=t.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(t){return new el(t.buffer)}}const Zr={};function le(r,t,i={}){if(Zr[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Zr[r]={klass:t,omit:i.omit||[],shallow:i.shallow||[]}}le("Object",Object),le("Set",Set),le("TransferableGridIndex",el),le("Color",Xe),le("Error",Error),le("AJAXError",wr),le("ResolvedImage",hn),le("StylePropertyFunction",Ss),le("StyleExpression",Ul,{omit:["_evaluator"]}),le("ZoomDependentExpression",Ar),le("ZoomConstantExpression",co),le("CompoundExpression",ua,{omit:["_evaluate"]});for(const r in Fl)Fl[r]._classRegistryKey||le(`Expression_${r}`,Fl[r]);function Ca(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Lu(r){return r.$name||r.constructor._classRegistryKey}function ku(r){return!function(t){if(t===null||typeof t!="object")return!1;const i=Lu(t);return!(!i||i==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||Ca(r)||ya(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function go(r,t){if(ku(r))return(Ca(r)||ya(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const h=[];for(const p of r)h.push(go(p,t));return h}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const i=Lu(r);if(!i)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!Zr[i])throw new Error(`${i} is not registered.`);const{klass:o}=Zr[i],l=o.serialize?o.serialize(r,t):{};if(o.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const h in r){if(!r.hasOwnProperty(h)||Zr[i].omit.indexOf(h)>=0)continue;const p=r[h];l[h]=Zr[i].shallow.indexOf(h)>=0?p:go(p,t)}r instanceof Error&&(l.message=r.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(l.$name=i),l}function os(r){if(ku(r))return r;if(Array.isArray(r))return r.map(os);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=Lu(r)||"Object";if(!Zr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:i}=Zr[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(r);const o=Object.create(i.prototype);for(const l of Object.keys(r)){if(l==="$name")continue;const h=r[l];o[l]=Zr[t].shallow.indexOf(l)>=0?h:os(h)}return o}class Fc{constructor(){this.first=!0}update(t,i){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}function il(r){return/[\u02EA\u02EB\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD83C\uDE00|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))}function fa(r){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD806[\uDEB0-\uDEBF]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD83C\uDE00|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))}function Nc(r){for(const t of r)if(fa(t.charCodeAt(0)))return!0;return!1}function Uc(r){for(const t of r)if(!Bu(t.charCodeAt(0)))return!1;return!0}function ls(r){const t=r.map(i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}}).filter(i=>i);return new RegExp(t.join("|"),"u")}const ql=ls(["Arab","Dupl","Mong","Ougr","Syrc"]);function Bu(r){return!ql.test(String.fromCodePoint(r))}function nl(r){return!(fa(r)||(t=r,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]/gim.test(String.fromCodePoint(t))));var t}const Ou=ls(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Fu(r){return Ou.test(String.fromCodePoint(r))}function _o(r,t){return!(!t&&Fu(r)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(r)))}function Yf(r){for(const t of r)if(Fu(t.charCodeAt(0)))return!0;return!1}const fr=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){if(fr.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(r,t){return d(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(r.pluginStatus!=="loading")return this.setState(r),r;const i=r.pluginURL,o=new Promise(h=>{this.loadScriptResolve=h});t(i);const l=new Promise(h=>setTimeout(()=>h(),this.TIMEOUT));if(yield Promise.race([o,l]),this.isParsed()){const h={pluginStatus:"loaded",pluginURL:i};return this.setState(h),h}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)})}};class _i{constructor(t,i){this.isSupportedScript=jc,this.zoom=t,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new Fc,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Fc,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,i=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}function jc(r){return function(t,i){for(const o of t)if(!_o(o.charCodeAt(0),i))return!1;return!0}(r,fr.getRTLTextPluginStatus()==="loaded")}class za{constructor(t,i,o){this.property=t,this.value=i,this.expression=function(l,h,p){if(Ts(l))return new Ss(l,h);if(zu(l)){const y=Qo(l,h,p);if(y.result==="error")throw new Error(y.value.map(x=>`${x.key}: ${x.message}`).join(", "));return y.value}{let y=l;return h.type==="color"&&typeof l=="string"?y=Xe.parse(l):h.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?h.type!=="numberArray"||typeof l!="number"&&!Array.isArray(l)?h.type!=="colorArray"||typeof l!="string"&&!Array.isArray(l)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(l)?y=kn.parse(l):h.type==="projectionDefinition"&&typeof l=="string"&&(y=Zn.parse(l)):y=An.parse(l):y=_n.parse(l):y=gn.parse(l),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}}(i===void 0?t.specification.default:i,t.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,i,o){return this.property.possiblyEvaluate(this,t,i,o)}}class Da{constructor(t,i){this.property=t,this.value=new za(t,void 0,i)}transitioned(t,i){return new Vc(this.property,this.value,i,fi({},t.transition,this.transition),t.now)}untransitioned(){return new Vc(this.property,this.value,null,{},0)}}class rl{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._globalState=i}getValue(t){return Wn(this._values[t].value.value)}setValue(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Da(this._values[t].property,this._globalState)),this._values[t].value=new za(this._values[t].property,i===null?void 0:Wn(i),this._globalState)}getTransition(t){return Wn(this._values[t].transition)}setTransition(t,i){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Da(this._values[t].property,this._globalState)),this._values[t].transition=Wn(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(t[i]=o);const l=this.getTransition(i);l!==void 0&&(t[`${i}-transition`]=l)}return t}transitioned(t,i){const o=new Gc(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].transitioned(t,i._values[l]);return o}untransitioned(){const t=new Gc(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class Vc{constructor(t,i,o,l,h){this.property=t,this.value=i,this.begin=h+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=o)}possiblyEvaluate(t,i,o){const l=t.now||0,h=this.value.possiblyEvaluate(t,i,o),p=this.prior;if(p){if(l>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(l<this.begin)return p.possiblyEvaluate(t,i,o);{const y=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(t,i,o),h,ae(y))}}return h}}class Gc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,o){const l=new Xl(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(t,i,o);return l}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Hl{constructor(t,i){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._globalState=i}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Wn(this._values[t].value)}setValue(t,i){this._values[t]=new za(this._values[t].property,i===null?void 0:Wn(i),this._globalState)}serialize(){const t={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(t[i]=o)}return t}possiblyEvaluate(t,i,o){const l=new Xl(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].possiblyEvaluate(t,i,o);return l}}class zr{constructor(t,i,o){this.property=t,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,o,l){return this.property.evaluate(this.value,this.parameters,t,i,o,l)}}class Xl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class pe{constructor(t){this.specification=t}possiblyEvaluate(t,i){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(i)}interpolate(t,i,o){const l=wa[this.specification.type];return l?l(t,i,o):t}}class _e{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,o,l){return new zr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},o,l)}:t.expression,i)}interpolate(t,i,o){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new zr(this,{kind:"constant",value:void 0},t.parameters);const l=wa[this.specification.type];if(l){const h=l(t.value.value,i.value.value,o);return new zr(this,{kind:"constant",value:h},t.parameters)}return t}evaluate(t,i,o,l,h,p){return t.kind==="constant"?t.value:t.evaluate(i,o,l,h,p)}}class yo extends _e{possiblyEvaluate(t,i,o,l){if(t.value===void 0)return new zr(this,{kind:"constant",value:void 0},i);if(t.expression.kind==="constant"){const h=t.expression.evaluate(i,null,{},o,l),p=t.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,y=this._calculate(p,p,p,i);return new zr(this,{kind:"constant",value:y},i)}if(t.expression.kind==="camera"){const h=this._calculate(t.expression.evaluate({zoom:i.zoom-1}),t.expression.evaluate({zoom:i.zoom}),t.expression.evaluate({zoom:i.zoom+1}),i);return new zr(this,{kind:"constant",value:h},i)}return new zr(this,t.expression,i)}evaluate(t,i,o,l,h,p){if(t.kind==="source"){const y=t.evaluate(i,o,l,h,p);return this._calculate(y,y,y,i)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(i.zoom)-1},o,l),t.evaluate({zoom:Math.floor(i.zoom)},o,l),t.evaluate({zoom:Math.floor(i.zoom)+1},o,l),i):t.value}_calculate(t,i,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:o,to:i}}interpolate(t){return t}}class Nu{constructor(t){this.specification=t}possiblyEvaluate(t,i,o,l){if(t.value!==void 0){if(t.expression.kind==="constant"){const h=t.expression.evaluate(i,null,{},o,l);return this._calculate(h,h,h,i)}return this._calculate(t.expression.evaluate(new _i(Math.floor(i.zoom-1),i)),t.expression.evaluate(new _i(Math.floor(i.zoom),i)),t.expression.evaluate(new _i(Math.floor(i.zoom+1),i)),i)}}_calculate(t,i,o,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:i}:{from:o,to:i}}interpolate(t){return t}}class $l{constructor(t){this.specification=t}possiblyEvaluate(t,i,o,l){return!!t.expression.evaluate(i,null,{},o,l)}interpolate(){return!1}}class ir{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in t){const o=t[i];o.specification.overridable&&this.overridableProperties.push(i);const l=this.defaultPropertyValues[i]=new za(o,void 0,void 0),h=this.defaultTransitionablePropertyValues[i]=new Da(o,void 0);this.defaultTransitioningPropertyValues[i]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=l.possiblyEvaluate({})}}}le("DataDrivenProperty",_e),le("DataConstantProperty",pe),le("CrossFadedDataDrivenProperty",yo),le("CrossFadedProperty",Nu),le("ColorRampProperty",$l);const Dr="-transition";class an extends Tt{constructor(t,i,o){if(super(),this.id=t.id,this.type=t.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=Vr(t.filter,o)),i.layout&&(this._unevaluatedLayout=new Hl(i.layout,o)),i.paint)){this._transitionablePaint=new rl(i.paint,o);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xl(i.paint)}}setFilter(t){this.filter=t,this._featureFilter=Vr(t,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[i];for(const l of o.getGlobalStateRefs())t.add(l)}for(const i of this._featureFilter.getGlobalStateRefs())t.add(i);return t}getPaintAffectingGlobalStateRefs(){var t;const i=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const l=this._transitionablePaint._values[o].value;for(const h of l.getGlobalStateRefs()){const p=(t=i.get(h))!==null&&t!==void 0?t:[];p.push({name:o,value:l.value}),i.set(h,p)}}return i}setLayoutProperty(t,i,o={}){i!=null&&this._validate(Oh,`layers.${this.id}.layout.${t}`,t,i,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return t.endsWith(Dr)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,o={}){if(i!=null&&this._validate(Ru,`layers.${this.id}.paint.${t}`,t,i,o))return!1;if(t.endsWith(Dr))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{const l=this._transitionablePaint._values[t],h=l.property.specification["property-type"]==="cross-faded-data-driven",p=l.value.isDataDriven(),y=l.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||p||h||this._handleOverridablePaintPropertyUpdate(t,y,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,i,o){return!1}isHidden(t,i=!1){return!!(this.minzoom&&t<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Wr(t,(i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length))}_validate(t,i,o,l,h={}){return(!h||h.validate!==!1)&&ss(this,t.call(ha,{key:i,layerType:this.type,objectKey:o,value:l,styleSpec:tt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof zr&&lo(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let us;var Fh={get paint(){return us=us||new ir({"raster-opacity":new pe(tt.paint_raster["raster-opacity"]),"raster-hue-rotate":new pe(tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pe(tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pe(tt.paint_raster["raster-brightness-max"]),"raster-saturation":new pe(tt.paint_raster["raster-saturation"]),"raster-contrast":new pe(tt.paint_raster["raster-contrast"]),"raster-resampling":new pe(tt.paint_raster["raster-resampling"]),"raster-fade-duration":new pe(tt.paint_raster["raster-fade-duration"])})}};class Wf extends an{constructor(t,i){super(t,Fh,i)}}const vo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class nr{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class je{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function yi(r,t=1){let i=0,o=0;return{members:r.map(l=>{const h=vo[l.type].BYTES_PER_ELEMENT,p=i=cs(i,Math.max(t,h)),y=l.components||1;return o=Math.max(o,h),i+=h*y,{name:l.name,type:l.type,components:y,offset:p}}),size:cs(i,Math.max(o,t)),alignment:t}}function cs(r,t){return Math.ceil(r/t)*t}class Fe extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){const l=2*t;return this.int16[l+0]=i,this.int16[l+1]=o,t}}Fe.prototype.bytesPerElement=4,le("StructArrayLayout2i4",Fe);class pi extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const h=3*t;return this.int16[h+0]=i,this.int16[h+1]=o,this.int16[h+2]=l,t}}pi.prototype.bytesPerElement=6,le("StructArrayLayout3i6",pi);class sn extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,o,l)}emplace(t,i,o,l,h){const p=4*t;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=l,this.int16[p+3]=h,t}}sn.prototype.bytesPerElement=8,le("StructArrayLayout4i8",sn);class Yl extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,o,l,h,p)}emplace(t,i,o,l,h,p,y){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=l,this.int16[x+3]=h,this.int16[x+4]=p,this.int16[x+5]=y,t}}Yl.prototype.bytesPerElement=12,le("StructArrayLayout2i4i12",Yl);class xo extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,o,l,h,p)}emplace(t,i,o,l,h,p,y){const x=4*t,w=8*t;return this.int16[x+0]=i,this.int16[x+1]=o,this.uint8[w+4]=l,this.uint8[w+5]=h,this.uint8[w+6]=p,this.uint8[w+7]=y,t}}xo.prototype.bytesPerElement=8,le("StructArrayLayout2i4ub8",xo);class rr extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){const l=2*t;return this.float32[l+0]=i,this.float32[l+1]=o,t}}rr.prototype.bytesPerElement=8,le("StructArrayLayout2f8",rr);class al extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p,y,x,w,M){const A=this.length;return this.resize(A+1),this.emplace(A,t,i,o,l,h,p,y,x,w,M)}emplace(t,i,o,l,h,p,y,x,w,M,A){const D=10*t;return this.uint16[D+0]=i,this.uint16[D+1]=o,this.uint16[D+2]=l,this.uint16[D+3]=h,this.uint16[D+4]=p,this.uint16[D+5]=y,this.uint16[D+6]=x,this.uint16[D+7]=w,this.uint16[D+8]=M,this.uint16[D+9]=A,t}}al.prototype.bytesPerElement=20,le("StructArrayLayout10ui20",al);class zs extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p,y,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,o,l,h,p,y,x)}emplace(t,i,o,l,h,p,y,x,w){const M=8*t;return this.uint16[M+0]=i,this.uint16[M+1]=o,this.uint16[M+2]=l,this.uint16[M+3]=h,this.uint16[M+4]=p,this.uint16[M+5]=y,this.uint16[M+6]=x,this.uint16[M+7]=w,t}}zs.prototype.bytesPerElement=16,le("StructArrayLayout8ui16",zs);class Ds extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p,y,x,w,M,A,D){const I=this.length;return this.resize(I+1),this.emplace(I,t,i,o,l,h,p,y,x,w,M,A,D)}emplace(t,i,o,l,h,p,y,x,w,M,A,D,I){const k=12*t;return this.int16[k+0]=i,this.int16[k+1]=o,this.int16[k+2]=l,this.int16[k+3]=h,this.uint16[k+4]=p,this.uint16[k+5]=y,this.uint16[k+6]=x,this.uint16[k+7]=w,this.int16[k+8]=M,this.int16[k+9]=A,this.int16[k+10]=D,this.int16[k+11]=I,t}}Ds.prototype.bytesPerElement=24,le("StructArrayLayout4i4ui4i24",Ds);class Uu extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const h=3*t;return this.float32[h+0]=i,this.float32[h+1]=o,this.float32[h+2]=l,t}}Uu.prototype.bytesPerElement=12,le("StructArrayLayout3f12",Uu);class Ki extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}Ki.prototype.bytesPerElement=4,le("StructArrayLayout1ul4",Ki);class bo extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p,y,x,w){const M=this.length;return this.resize(M+1),this.emplace(M,t,i,o,l,h,p,y,x,w)}emplace(t,i,o,l,h,p,y,x,w,M){const A=10*t,D=5*t;return this.int16[A+0]=i,this.int16[A+1]=o,this.int16[A+2]=l,this.int16[A+3]=h,this.int16[A+4]=p,this.int16[A+5]=y,this.uint32[D+3]=x,this.uint16[A+8]=w,this.uint16[A+9]=M,t}}bo.prototype.bytesPerElement=20,le("StructArrayLayout6i1ul2ui20",bo);class Ps extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,o,l,h,p)}emplace(t,i,o,l,h,p,y){const x=6*t;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=l,this.int16[x+3]=h,this.int16[x+4]=p,this.int16[x+5]=y,t}}Ps.prototype.bytesPerElement=12,le("StructArrayLayout2i2i2i12",Ps);class Zc extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h){const p=this.length;return this.resize(p+1),this.emplace(p,t,i,o,l,h)}emplace(t,i,o,l,h,p){const y=4*t,x=8*t;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=l,this.int16[x+6]=h,this.int16[x+7]=p,t}}Zc.prototype.bytesPerElement=16,le("StructArrayLayout2f1f2i16",Zc);class ju extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,o,l,h,p)}emplace(t,i,o,l,h,p,y){const x=16*t,w=4*t,M=8*t;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[w+1]=l,this.float32[w+2]=h,this.int16[M+6]=p,this.int16[M+7]=y,t}}ju.prototype.bytesPerElement=16,le("StructArrayLayout2ub2f2i16",ju);class wo extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const h=3*t;return this.uint16[h+0]=i,this.uint16[h+1]=o,this.uint16[h+2]=l,t}}wo.prototype.bytesPerElement=6,le("StructArrayLayout3ui6",wo);class Vu extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p,y,x,w,M,A,D,I,k,F,U,X){const st=this.length;return this.resize(st+1),this.emplace(st,t,i,o,l,h,p,y,x,w,M,A,D,I,k,F,U,X)}emplace(t,i,o,l,h,p,y,x,w,M,A,D,I,k,F,U,X,st){const Q=24*t,it=12*t,dt=48*t;return this.int16[Q+0]=i,this.int16[Q+1]=o,this.uint16[Q+2]=l,this.uint16[Q+3]=h,this.uint32[it+2]=p,this.uint32[it+3]=y,this.uint32[it+4]=x,this.uint16[Q+10]=w,this.uint16[Q+11]=M,this.uint16[Q+12]=A,this.float32[it+7]=D,this.float32[it+8]=I,this.uint8[dt+36]=k,this.uint8[dt+37]=F,this.uint8[dt+38]=U,this.uint32[it+10]=X,this.int16[Q+22]=st,t}}Vu.prototype.bytesPerElement=48,le("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Vu);class Gu extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,l,h,p,y,x,w,M,A,D,I,k,F,U,X,st,Q,it,dt,_t,zt,$t,Zt,Wt,oe,te){const ee=this.length;return this.resize(ee+1),this.emplace(ee,t,i,o,l,h,p,y,x,w,M,A,D,I,k,F,U,X,st,Q,it,dt,_t,zt,$t,Zt,Wt,oe,te)}emplace(t,i,o,l,h,p,y,x,w,M,A,D,I,k,F,U,X,st,Q,it,dt,_t,zt,$t,Zt,Wt,oe,te,ee){const Ut=32*t,Me=16*t;return this.int16[Ut+0]=i,this.int16[Ut+1]=o,this.int16[Ut+2]=l,this.int16[Ut+3]=h,this.int16[Ut+4]=p,this.int16[Ut+5]=y,this.int16[Ut+6]=x,this.int16[Ut+7]=w,this.uint16[Ut+8]=M,this.uint16[Ut+9]=A,this.uint16[Ut+10]=D,this.uint16[Ut+11]=I,this.uint16[Ut+12]=k,this.uint16[Ut+13]=F,this.uint16[Ut+14]=U,this.uint16[Ut+15]=X,this.uint16[Ut+16]=st,this.uint16[Ut+17]=Q,this.uint16[Ut+18]=it,this.uint16[Ut+19]=dt,this.uint16[Ut+20]=_t,this.uint16[Ut+21]=zt,this.uint16[Ut+22]=$t,this.uint32[Me+12]=Zt,this.float32[Me+13]=Wt,this.float32[Me+14]=oe,this.uint16[Ut+30]=te,this.uint16[Ut+31]=ee,t}}Gu.prototype.bytesPerElement=64,le("StructArrayLayout8i15ui1ul2f2ui64",Gu);class sl extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}sl.prototype.bytesPerElement=4,le("StructArrayLayout1f4",sl);class ar extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const h=3*t;return this.uint16[6*t+0]=i,this.float32[h+1]=o,this.float32[h+2]=l,t}}ar.prototype.bytesPerElement=12,le("StructArrayLayout1ui2f12",ar);class m extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,i,o)}emplace(t,i,o,l){const h=4*t;return this.uint32[2*t+0]=i,this.uint16[h+2]=o,this.uint16[h+3]=l,t}}m.prototype.bytesPerElement=8,le("StructArrayLayout1ul2ui8",m);class e extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,i)}emplace(t,i,o){const l=2*t;return this.uint16[l+0]=i,this.uint16[l+1]=o,t}}e.prototype.bytesPerElement=4,le("StructArrayLayout2ui4",e);class a extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}a.prototype.bytesPerElement=2,le("StructArrayLayout1ui2",a);class u extends je{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,o,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,o,l)}emplace(t,i,o,l,h){const p=4*t;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=l,this.float32[p+3]=h,t}}u.prototype.bytesPerElement=16,le("StructArrayLayout4f16",u);class f extends nr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new wt(this.anchorPointX,this.anchorPointY)}}f.prototype.size=20;class _ extends bo{get(t){return new f(this,t)}}le("CollisionBoxArray",_);class v extends nr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}v.prototype.size=48;class T extends Vu{get(t){return new v(this,t)}}le("PlacedSymbolArray",T);class S extends nr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}S.prototype.size=64;class C extends Gu{get(t){return new S(this,t)}}le("SymbolInstanceArray",C);class z extends sl{getoffsetX(t){return this.float32[1*t+0]}}le("GlyphOffsetArray",z);class B extends pi{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}le("SymbolLineVertexArray",B);class R extends nr{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}R.prototype.size=12;class N extends ar{get(t){return new R(this,t)}}le("TextAnchorOffsetArray",N);class q extends nr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}q.prototype.size=8;class K extends m{get(t){return new q(this,t)}}le("FeatureIndexArray",K);class J extends Fe{}class et extends Fe{}class at extends Fe{}class ct extends Yl{}class rt extends xo{}class ht extends rr{}class pt extends al{}class lt extends zs{}class xt extends Ds{}class Dt extends Uu{}class Mt extends Ki{}class Et extends Ps{}class Pt extends ju{}class Kt extends wo{}class Jt extends e{}const Gt=yi([{name:"a_pos",components:2,type:"Int16"}],4),{members:ce}=Gt;class me{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,i,o,l){const h=this.segments[this.segments.length-1];return t>me.MAX_VERTEX_ARRAY_LENGTH&&gi(`Max vertices per segment is ${me.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${me.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!h||h.vertexLength+t>me.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==l?this.createNewSegment(i,o,l):h}createNewSegment(t,i,o){const l={vertexOffset:t.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(l.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(l),l}getOrCreateLatestSegment(t,i,o){return this.prepareSegment(0,t,i,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,o,l){return new me([{vertexOffset:t,primitiveOffset:i,vertexLength:o,primitiveLength:l,vaos:{},sortKey:0}])}}function ci(r,t){return 256*(r=ze(Math.floor(r),0,255))+ze(Math.floor(t),0,255)}me.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,le("SegmentVector",me);const Ui=yi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Li=yi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var ji,Si,xn,Mi={exports:{}},Dn={exports:{}},on={exports:{}},bn=function(){if(xn)return Mi.exports;xn=1;var r=(ji||(ji=1,Dn.exports=function(i,o){var l,h,p,y,x,w,M,A;for(h=i.length-(l=3&i.length),p=o,x=3432918353,w=461845907,A=0;A<h;)M=255&i.charCodeAt(A)|(255&i.charCodeAt(++A))<<8|(255&i.charCodeAt(++A))<<16|(255&i.charCodeAt(++A))<<24,++A,p=27492+(65535&(y=5*(65535&(p=(p^=M=(65535&(M=(M=(65535&M)*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*w+(((M>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(M=0,l){case 3:M^=(255&i.charCodeAt(A+2))<<16;case 2:M^=(255&i.charCodeAt(A+1))<<8;case 1:p^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(A)))*x+(((M>>>16)*x&65535)<<16)&4294967295)<<15|M>>>17))*w+(((M>>>16)*w&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),Dn.exports),t=(Si||(Si=1,on.exports=function(i,o){for(var l,h=i.length,p=o^h,y=0;h>=4;)l=1540483477*(65535&(l=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++y;switch(h){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),on.exports);return Mi.exports=r,Mi.exports.murmur3=r,Mi.exports.murmur2=t,Mi.exports}(),Hn=At(bn);class Pa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,o,l){this.ids.push(Is(t)),this.positions.push(i,o,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=Is(t);let o=0,l=this.ids.length-1;for(;o<l;){const p=o+l>>1;this.ids[p]>=i?l=p:o=p+1}const h=[];for(;this.ids[o]===i;)h.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return h}static serialize(t,i){const o=new Float64Array(t.ids),l=new Uint32Array(t.positions);return Rs(o,l,0,o.length-1),i&&i.push(o.buffer,l.buffer),{ids:o,positions:l}}static deserialize(t){const i=new Pa;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Is(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Hn(String(r))}function Rs(r,t,i,o){for(;i<o;){const l=r[i+o>>1];let h=i-1,p=o+1;for(;;){do h++;while(r[h]<l);do p--;while(r[p]>l);if(h>=p)break;Ia(r,h,p),Ia(t,3*h,3*p),Ia(t,3*h+1,3*p+1),Ia(t,3*h+2,3*p+2)}p-i<o-p?(Rs(r,t,i,p),i=p+1):(Rs(r,t,p+1,o),o=p)}}function Ia(r,t,i){const o=r[t];r[t]=r[i],r[i]=o}le("FeaturePositionMap",Pa);class ia{constructor(t,i){this.gl=t.gl,this.location=i}}class To extends ia{constructor(t,i){super(t,i),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ls extends ia{constructor(t,i){super(t,i),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class qr extends ia{constructor(t,i){super(t,i),this.current=Xe.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const ks=new Float32Array(16);function Bs(r){return[ci(255*r.r,255*r.g),ci(255*r.b,255*r.a)]}class Os{constructor(t,i,o){this.value=t,this.uniformNames=i.map(l=>`u_${l}`),this.type=o}setUniform(t,i,o){t.set(o.constantOr(this.value))}getBinding(t,i,o){return this.type==="color"?new qr(t,i):new To(t,i)}}class Vi{constructor(t,i){this.uniformNames=i.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=t.tlbr}setConstantDashPositions(t,i){this.dashTo=[0,t.y,t.height,t.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(t,i,o,l){let h=null;l==="u_pattern_to"?h=this.patternTo:l==="u_pattern_from"?h=this.patternFrom:l==="u_dasharray_to"?h=this.dashTo:l==="u_dasharray_from"?h=this.dashFrom:l==="u_pixel_ratio_to"?h=this.pixelRatioTo:l==="u_pixel_ratio_from"&&(h=this.pixelRatioFrom),h!==null&&t.set(h)}getBinding(t,i,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new Ls(t,i):new To(t,i)}}class vi{constructor(t,i,o,l){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(h=>({name:`a_${h}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(t,i,o){const l=this.paintVertexArray.length,h=this.expression.evaluate(new _i(0,o),i,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(t),this._setPaintValue(l,t,h)}updatePaintArray(t,i,o,l,h){const p=this.expression.evaluate(new _i(0,h),o,l);this._setPaintValue(t,i,p)}_setPaintValue(t,i,o){if(this.type==="color"){const l=Bs(o);for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,l[0],l[1])}else{for(let l=t;l<i;l++)this.paintVertexArray.emplace(l,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qi{constructor(t,i,o,l,h,p){this.expression=t,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=o,this.useIntegerZoom=l,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,i,o){const l=this.expression.evaluate(new _i(this.zoom,o),i,{},o.canonical,[],o.formattedSection),h=this.expression.evaluate(new _i(this.zoom+1,o),i,{},o.canonical,[],o.formattedSection),p=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(p,t,l,h)}updatePaintArray(t,i,o,l,h){const p=this.expression.evaluate(new _i(this.zoom,h),o,l),y=this.expression.evaluate(new _i(this.zoom+1,h),o,l);this._setPaintValue(t,i,p,y)}_setPaintValue(t,i,o,l){if(this.type==="color"){const h=Bs(o),p=Bs(l);for(let y=t;y<i;y++)this.paintVertexArray.emplace(y,h[0],h[1],p[0],p[1])}else{for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,o,l);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,l=ze(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,i,o){return new To(t,i)}}class ki{constructor(t,i,o,l,h,p){this.expression=t,this.type=i,this.useIntegerZoom=o,this.zoom=l,this.layerId=p,this.zoomInPaintVertexArray=new h,this.zoomOutPaintVertexArray=new h}populatePaintArray(t,i,o){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,this.getPositionIds(i),o)}updatePaintArray(t,i,o,l,h){this._setPaintValues(t,i,this.getPositionIds(o),h)}_setPaintValues(t,i,o,l){const h=this.getPositions(l);if(!h||!o)return;const p=h[o.min],y=h[o.mid],x=h[o.max];if(p&&y&&x)for(let w=t;w<i;w++)this.emplace(this.zoomInPaintVertexArray,w,y,p),this.emplace(this.zoomOutPaintVertexArray,w,y,x)}upload(t){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Nh extends ki{getPositions(t){return t.imagePositions}getPositionIds(t){return t.patterns&&t.patterns[this.layerId]}getVertexAttributes(){return Ui.members}emplace(t,i,o,l){t.emplace(i,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],o.pixelRatio,l.pixelRatio)}}class Uh extends ki{getPositions(t){return t.dashPositions}getPositionIds(t){return t.dashes&&t.dashes[this.layerId]}getVertexAttributes(){return Li.members}emplace(t,i,o,l){t.emplace(i,0,o.y,o.height,o.width,0,l.y,l.height,l.width)}}class Wl{constructor(t,i,o){this.binders={},this._buffers=[];const l=[];for(const h in t.paint._values){if(!o(h))continue;const p=t.paint.get(h);if(!(p instanceof zr&&lo(p.property.specification)))continue;const y=jh(h,t.type),x=p.value,w=p.property.specification.type,M=p.property.useIntegerZoom,A=p.property.specification["property-type"],D=A==="cross-faded"||A==="cross-faded-data-driven";if(x.kind==="constant")this.binders[h]=D?new Vi(x.value,y):new Os(x.value,y,w),l.push(`/u_${h}`);else if(x.kind==="source"||D){const I=Vh(h,w,"source");this.binders[h]=D?h==="line-dasharray"?new Uh(x,w,M,i,I,t.id):new Nh(x,w,M,i,I,t.id):new vi(x,y,w,I),l.push(`/a_${h}`)}else{const I=Vh(h,w,"composite");this.binders[h]=new Qi(x,y,w,M,i,I),l.push(`/z_${h}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof vi||i instanceof Qi?i.maxValue:0}populatePaintArrays(t,i,o){for(const l in this.binders){const h=this.binders[l];(h instanceof vi||h instanceof Qi||h instanceof ki)&&h.populatePaintArray(t,i,o)}}setConstantPatternPositions(t,i){for(const o in this.binders){const l=this.binders[o];l instanceof Vi&&l.setConstantPatternPositions(t,i)}}setConstantDashPositions(t,i){for(const o in this.binders){const l=this.binders[o];l instanceof Vi&&l.setConstantDashPositions(t,i)}}updatePaintArrays(t,i,o,l,h){let p=!1;for(const y in t){const x=i.getPositions(y);for(const w of x){const M=o.feature(w.index);for(const A in this.binders){const D=this.binders[A];if((D instanceof vi||D instanceof Qi||D instanceof ki)&&D.expression.isStateDependent===!0){const I=l.paint.get(A);D.expression=I.value,D.updatePaintArray(w.start,w.end,M,t[y],h),p=!0}}}}return p}defines(){const t=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Os||o instanceof Vi)&&t.push(...o.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof vi||o instanceof Qi)for(let l=0;l<o.paintVertexAttributes.length;l++)t.push(o.paintVertexAttributes[l].name);else if(o instanceof ki){const l=o.getVertexAttributes();for(const h of l)t.push(h.name)}}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Os||o instanceof Vi||o instanceof Qi)for(const l of o.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,i){const o=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Os||h instanceof Vi||h instanceof Qi){for(const p of h.uniformNames)if(i[p]){const y=h.getBinding(t,i[p],p);o.push({name:p,property:l,binding:y})}}}return o}setUniforms(t,i,o,l){for(const{name:h,property:p,binding:y}of i)this.binders[p].setUniform(y,l,o.get(p),h)}updatePaintBuffers(t){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(t&&o instanceof ki){const l=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(o instanceof vi||o instanceof Qi)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const i in this.binders){const o=this.binders[i];(o instanceof vi||o instanceof Qi||o instanceof ki)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof vi||i instanceof Qi||i instanceof ki)&&i.destroy()}}}class So{constructor(t,i,o=()=>!0){this.programConfigurations={};for(const l of t)this.programConfigurations[l.id]=new Wl(l,i,o);this.needsUpload=!1,this._featureMap=new Pa,this._bufferOffset=0}populatePaintArrays(t,i,o,l){for(const h in this.programConfigurations)this.programConfigurations[h].populatePaintArrays(t,i,l);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,o,l){for(const h of o)this.needsUpload=this.programConfigurations[h.id].updatePaintArrays(t,this._featureMap,i,h,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function jh(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function Vh(r,t,i){const o={color:{source:rr,composite:u},number:{source:sl,composite:rr}},l=function(h){return{"line-pattern":{source:pt,composite:pt},"fill-pattern":{source:pt,composite:pt},"fill-extrusion-pattern":{source:pt,composite:pt},"line-dasharray":{source:lt,composite:lt}}[h]}(r);return l&&l[i]||o[t][i]}le("ConstantBinder",Os),le("CrossFadedConstantBinder",Vi),le("SourceExpressionBinder",vi),le("CrossFadedPatternBinder",Nh),le("CrossFadedDasharrayBinder",Uh),le("CompositeExpressionBinder",Qi),le("ProgramConfiguration",Wl,{omit:["_buffers"]}),le("ProgramConfigurationSet",So);const Ra=Math.pow(2,14)-1,Zu=-Ra-1;function Fs(r){const t=ge/r.extent,i=r.loadGeometry();for(let o=0;o<i.length;o++){const l=i[o];for(let h=0;h<l.length;h++){const p=l[h],y=Math.round(p.x*t),x=Math.round(p.y*t);p.x=ze(y,Zu,Ra),p.y=ze(x,Zu,Ra),(y<p.x||y>p.x+1||x<p.y||x>p.y+1)&&gi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function Ns(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?Fs(r):[]}}const hs=-32768;function Gh(r,t,i,o,l){r.emplaceBack(hs+8*t+o,hs+8*i+l)}class Kl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new et,this.indexArray=new Kt,this.segments=new me,this.programConfigurations=new So(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,o){const l=this.layers[0],h=[];let p=null,y=!1,x=l.type==="heatmap";if(l.type==="circle"){const M=l;p=M.layout.get("circle-sort-key"),y=!p.isConstant(),x=x||M.paint.get("circle-pitch-alignment")==="map"}const w=x?i.subdivisionGranularity.circle:1;for(const{feature:M,id:A,index:D,sourceLayerIndex:I}of t){const k=this.layers[0]._featureFilter.needGeometry,F=Ns(M,k);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom),F,o))continue;const U=y?p.evaluate(F,{},o):void 0,X={id:A,properties:M.properties,type:M.type,sourceLayerIndex:I,index:D,geometry:k?F.geometry:Fs(M),patterns:{},sortKey:U};h.push(X)}y&&h.sort((M,A)=>M.sortKey-A.sortKey);for(const M of h){const{geometry:A,index:D,sourceLayerIndex:I}=M,k=t[D].feature;this.addFeature(M,A,D,o,w),i.featureIndex.insert(k,A,D,I,this.index)}}update(t,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ce),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,o,l,h=1){let p;switch(h){case 1:p=[0,7];break;case 3:p=[0,2,5,7];break;case 5:p=[0,1,3,4,6,7];break;case 7:p=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${h}; valid values are 1, 3, 5, 7.`)}const y=p.length;for(const x of i)for(const w of x){const M=w.x,A=w.y;if(M<0||M>=ge||A<0||A>=ge)continue;const D=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,t.sortKey),I=D.vertexLength;for(let k=0;k<y;k++)for(let F=0;F<y;F++)Gh(this.layoutVertexArray,M,A,p[F],p[k]);for(let k=0;k<y-1;k++)for(let F=0;F<y-1;F++){const U=I+k*y+F,X=I+(k+1)*y+F;this.indexArray.emplaceBack(U,X+1,U+1),this.indexArray.emplaceBack(U,X,X+1)}D.vertexLength+=y*y,D.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:{},canonical:l})}}function sp(r,t){for(let i=0;i<r.length;i++)if(Pn(t,r[i]))return!0;for(let i=0;i<t.length;i++)if(Pn(r,t[i]))return!0;return!!Kf(r,t)}function qu(r,t,i){return!!Pn(r,t)||!!up(t,r,i)}function op(r,t){if(r.length===1)return Fn(t,r[0]);for(let i=0;i<t.length;i++){const o=t[i];for(let l=0;l<o.length;l++)if(Pn(r,o[l]))return!0}for(let i=0;i<r.length;i++)if(Fn(t,r[i]))return!0;for(let i=0;i<t.length;i++)if(Kf(r,t[i]))return!0;return!1}function lp(r,t,i){if(r.length>1){if(Kf(r,t))return!0;for(let o=0;o<t.length;o++)if(up(t[o],r,i))return!0}for(let o=0;o<r.length;o++)if(up(r[o],t,i))return!0;return!1}function Kf(r,t){if(r.length===0||t.length===0)return!1;for(let i=0;i<r.length-1;i++){const o=r[i],l=r[i+1];for(let h=0;h<t.length-1;h++)if(Kp(o,l,t[h],t[h+1]))return!0}return!1}function Kp(r,t,i,o){return Kr(r,i,o)!==Kr(t,i,o)&&Kr(r,t,i)!==Kr(r,t,o)}function up(r,t,i){const o=i*i;if(t.length===1)return r.distSqr(t[0])<o;for(let l=1;l<t.length;l++)if(Qf(r,t[l-1],t[l])<o)return!0;return!1}function Qf(r,t,i){const o=t.distSqr(i);if(o===0)return r.distSqr(t);const l=((r.x-t.x)*(i.x-t.x)+(r.y-t.y)*(i.y-t.y))/o;return r.distSqr(l<0?t:l>1?i:i.sub(t)._mult(l)._add(t))}function Fn(r,t){let i,o,l,h=!1;for(let p=0;p<r.length;p++){i=r[p];for(let y=0,x=i.length-1;y<i.length;x=y++)o=i[y],l=i[x],o.y>t.y!=l.y>t.y&&t.x<(l.x-o.x)*(t.y-o.y)/(l.y-o.y)+o.x&&(h=!h)}return h}function Pn(r,t){let i=!1;for(let o=0,l=r.length-1;o<r.length;l=o++){const h=r[o],p=r[l];h.y>t.y!=p.y>t.y&&t.x<(p.x-h.x)*(t.y-h.y)/(p.y-h.y)+h.x&&(i=!i)}return i}function Qp(r,t,i){const o=i[0],l=i[2];if(r.x<o.x&&t.x<o.x||r.x>l.x&&t.x>l.x||r.y<o.y&&t.y<o.y||r.y>l.y&&t.y>l.y)return!1;const h=Kr(r,t,i[0]);return h!==Kr(r,t,i[1])||h!==Kr(r,t,i[2])||h!==Kr(r,t,i[3])}function Hu(r,t,i){const o=t.paint.get(r).value;return o.kind==="constant"?o.value:i.programConfigurations.get(t.id).getMaxValue(r)}function Zh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function qh(r,t,i,o,l){if(!t[0]&&!t[1])return r;const h=wt.convert(t)._mult(l);i==="viewport"&&h._rotate(-o);const p=[];for(let y=0;y<r.length;y++)p.push(r[y].sub(h));return p}function Hh({queryGeometry:r,size:t},i){return qu(r,i,t)}function Jp({queryGeometry:r,size:t,transform:i,unwrappedTileID:o,getElevation:l},h){return qu(r,h,t*(i.projectTileCoordinates(h.x,h.y,o,l).signedDistanceFromCamera/i.cameraToCenterDistance))}function Jf({queryGeometry:r,size:t,transform:i,unwrappedTileID:o,getElevation:l},h){const p=i.projectTileCoordinates(h.x,h.y,o,l).signedDistanceFromCamera,y=t*(i.cameraToCenterDistance/p);return qu(r,qc(h,i,o,l),y)}function tm({queryGeometry:r,size:t,transform:i,unwrappedTileID:o,getElevation:l},h){return qu(r,qc(h,i,o,l),t)}function em({queryGeometry:r,size:t,transform:i,unwrappedTileID:o,getElevation:l,pitchAlignment:h="map",pitchScale:p="map"},y){const x=h==="map"?p==="map"?Hh:Jp:p==="map"?Jf:tm,w={queryGeometry:r,size:t,transform:i,unwrappedTileID:o,getElevation:l};for(const M of y)for(const A of M)if(x(w,A))return!0;return!1}function qc(r,t,i,o){const l=t.projectTileCoordinates(r.x,r.y,i,o).point;return new wt((.5*l.x+.5)*t.width,(.5*-l.y+.5)*t.height)}let td,cp;le("CircleBucket",Kl,{omit:["layers"]});var im={get paint(){return cp=cp||new ir({"circle-radius":new _e(tt.paint_circle["circle-radius"]),"circle-color":new _e(tt.paint_circle["circle-color"]),"circle-blur":new _e(tt.paint_circle["circle-blur"]),"circle-opacity":new _e(tt.paint_circle["circle-opacity"]),"circle-translate":new pe(tt.paint_circle["circle-translate"]),"circle-translate-anchor":new pe(tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pe(tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pe(tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new _e(tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new _e(tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new _e(tt.paint_circle["circle-stroke-opacity"])})},get layout(){return td=td||new ir({"circle-sort-key":new _e(tt.layout_circle["circle-sort-key"])})}};class nm extends an{constructor(t,i){super(t,im,i)}createBucket(t){return new Kl(t)}queryRadius(t){const i=t;return Hu("circle-radius",this,i)+Hu("circle-stroke-width",this,i)+Zh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:o,geometry:l,transform:h,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){const w=qh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-h.bearingInRadians,p),M=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),A=this.paint.get("circle-pitch-scale"),D=this.paint.get("circle-pitch-alignment");let I,k;return D==="map"?(I=w,k=M*p):(I=function(F,U,X,st){return F.map(Q=>qc(Q,U,X,st))}(w,h,y,x),k=M),em({queryGeometry:I,size:k,transform:h,unwrappedTileID:y,getElevation:x,pitchAlignment:D,pitchScale:A},l)}}class ed extends Kl{}let id;le("HeatmapBucket",ed,{omit:["layers"]});var hp={get paint(){return id=id||new ir({"heatmap-radius":new _e(tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new _e(tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pe(tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $l(tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pe(tt.paint_heatmap["heatmap-opacity"])})}};function nd(r,{width:t,height:i},o,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*i*o)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*i*o}`)}else l=new Uint8Array(t*i*o);return r.width=t,r.height=i,r.data=l,r}function rd(r,{width:t,height:i},o){if(t===r.width&&i===r.height)return;const l=nd({},{width:t,height:i},o);Hc(r,l,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,i)},o),r.width=t,r.height=i,r.data=l.data}function Hc(r,t,i,o,l,h){if(l.width===0||l.height===0)return t;if(l.width>r.width||l.height>r.height||i.x>r.width-l.width||i.y>r.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||o.x>t.width-l.width||o.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const p=r.data,y=t.data;if(p===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<l.height;x++){const w=((i.y+x)*r.width+i.x)*h,M=((o.y+x)*t.width+o.x)*h;for(let A=0;A<l.width*h;A++)y[M+A]=p[w+A]}return t}class Xu{constructor(t,i){nd(this,t,1,i)}resize(t){rd(this,t,1)}clone(){return new Xu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,o,l,h){Hc(t,i,o,l,h,1)}}class Hr{constructor(t,i){nd(this,t,4,i)}resize(t){rd(this,t,4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Hr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,o,l,h){Hc(t,i,o,l,h,4)}setPixel(t,i,o){const l=4*(t*this.width+i);this.data[l+0]=Math.round(255*o.r/o.a),this.data[l+1]=Math.round(255*o.g/o.a),this.data[l+2]=Math.round(255*o.b/o.a),this.data[l+3]=Math.round(255*o.a)}}function ad(r){const t={},i=r.resolution||256,o=r.clips?r.clips.length:1,l=r.image||new Hr({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const h=(p,y,x)=>{t[r.evaluationKey]=x;const w=r.expression.evaluate(t);l.setPixel(p/4/i,y/4,w)};if(r.clips)for(let p=0,y=0;p<o;++p,y+=4*i)for(let x=0,w=0;x<i;x++,w+=4){const M=x/(i-1),{start:A,end:D}=r.clips[p];h(y,w,A*(1-M)+D*M)}else for(let p=0,y=0;p<i;p++,y+=4)h(0,y,p/(i-1));return l}le("AlphaImage",Xu),le("RGBAImage",Hr);const sd="big-fb";class ol extends an{createBucket(t){return new ed(t)}constructor(t,i){super(t,hp,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ad({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(sd)&&this.heatmapFbos.delete(sd)}queryRadius(t){return Hu("heatmap-radius",this,t)}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:o,geometry:l,transform:h,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){return em({queryGeometry:t,size:this.paint.get("heatmap-radius").evaluate(i,o)*p,transform:h,unwrappedTileID:y,getElevation:x},l)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let od;var Ym={get paint(){return od=od||new ir({"hillshade-illumination-direction":new pe(tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new pe(tt.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new pe(tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pe(tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pe(tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pe(tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pe(tt.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new pe(tt.paint_hillshade["hillshade-method"])})}};class rm extends an{constructor(t,i){super(t,Ym,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,l=this.paint.get("hillshade-shadow-color").values;const h=Math.max(t.length,i.length,o.length,l.length);t=t.concat(Array(h-t.length).fill(t.at(-1))),i=i.concat(Array(h-i.length).fill(i.at(-1))),o=o.concat(Array(h-o.length).fill(o.at(-1))),l=l.concat(Array(h-l.length).fill(l.at(-1)));const p=i.map(Ln);return{directionRadians:t.map(Ln),altitudeRadians:p,shadowColor:l,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Mo;var fp={get paint(){return Mo=Mo||new ir({"color-relief-opacity":new pe(tt["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new $l(tt["paint_color-relief"]["color-relief-color"])})}};class ld{constructor(t,i,o,l){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(i,l)}update(t,i,o){const{width:l,height:h}=t,p=!(this.size&&this.size[0]===l&&this.size[1]===h||o),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(i&&i.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),p)this.size=[l,h],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ya(t)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,l,h,0,this.format,x.UNSIGNED_BYTE,t.data);else{const{x:w,y:M}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ya(t)?x.texSubImage2D(x.TEXTURE_2D,0,w,M,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,w,M,l,h,x.RGBA,x.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,i,o){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),o!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,o||t),this.filter=t),i!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Xh{constructor(t,i,o,l=1,h=1,p=1,y=0){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void gi(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=h,this.blueFactor=p,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let w=0;w<x;w++)this.data[this._idx(-1,w)]=this.data[this._idx(0,w)],this.data[this._idx(x,w)]=this.data[this._idx(x-1,w)],this.data[this._idx(w,-1)]=this.data[this._idx(w,0)],this.data[this._idx(w,x)]=this.data[this._idx(w,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let w=0;w<x;w++)for(let M=0;M<x;M++){const A=this.get(w,M);A>this.max&&(this.max=A),A<this.min&&(this.min=A)}}get(t,i){const o=new Uint8Array(this.data.buffer),l=4*this._idx(t,i);return this.unpack(o[l],o[l+1],o[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}unpack(t,i,o){return t*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return Xc(t,this.getUnpackVector())}getPixels(){return new Hr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,i,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=i*this.dim,h=i*this.dim+this.dim,p=o*this.dim,y=o*this.dim+this.dim;switch(i){case-1:l=h-1;break;case 1:h=l+1}switch(o){case-1:p=y-1;break;case 1:y=p+1}const x=-i*this.dim,w=-o*this.dim;for(let M=p;M<y;M++)for(let A=l;A<h;A++)this.data[this._idx(A,M)]=t.data[this._idx(A+x,M+w)]}}function Xc(r,t){const i=t[0],o=t[1],l=t[2],h=t[3],p=Math.min(i,o,l),y=Math.round((r+h)/p);return{r:Math.floor(y*p/i)%256,g:Math.floor(y*p/o)%256,b:Math.floor(y*p/l)%256}}le("DEMData",Xh);class ln extends an{constructor(t,i){super(t,fp,i)}_createColorRamp(t){const i={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof co&&o._styleExpression.expression instanceof qn){this.colorRampExpression=o;const p=o._styleExpression.expression;i.elevationStops=p.labels,i.colorStops=[];for(const y of i.elevationStops)i.colorStops.push(p.evaluate({globals:{elevation:y}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Xe.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=t)return i;const l={elevationStops:[],colorStops:[]},h=(i.elevationStops.length-1)/(t-1);for(let p=0;p<i.elevationStops.length-.5;p+=h)l.elevationStops.push(i.elevationStops[Math.round(p)]),l.colorStops.push(i.colorStops[Math.round(p)]);return gi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${t}, provided: ${i.elevationStops.length}`),l}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,i,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const l=this._createColorRamp(i),h=new Hr({width:l.colorStops.length,height:1}),p=new Hr({width:l.colorStops.length,height:1});for(let y=0;y<l.elevationStops.length;y++){const x=Xc(l.elevationStops[y],o);p.setPixel(0,y,new Xe(x.r/255,x.g/255,x.b/255,1)),h.setPixel(0,y,l.colorStops[y])}return this.colorRampTextures={elevationTexture:new ld(t,p,t.gl.RGBA),colorTexture:new ld(t,h,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Wm=yi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Km}=Wm;function $h(r,t,i){const o=i.patternDependencies;let l=!1;for(const h of t){const p=h.paint.get(`${r}-pattern`);p.isConstant()||(l=!0);const y=p.constantOr(null);y&&(l=!0,o[y.to]=!0,o[y.from]=!0)}return l}function $u(r,t,i,o,l){const{zoom:h}=o,p=l.patternDependencies;for(const y of t){const x=y.paint.get(`${r}-pattern`).value;if(x.kind!=="constant"){let w=x.evaluate({zoom:h-1},i,{},l.availableImages),M=x.evaluate({zoom:h},i,{},l.availableImages),A=x.evaluate({zoom:h+1},i,{},l.availableImages);w=w&&w.name?w.name:w,M=M&&M.name?M.name:M,A=A&&A.name?A.name:A,p[w]=!0,p[M]=!0,p[A]=!0,i.patterns[y.id]={min:w,mid:M,max:A}}}return i}function ll(r,t,i,o,l){let h;if(l===function(p,y,x,w){let M=0;for(let A=y,D=x-w;A<x;A+=w)M+=(p[D]-p[A])*(p[A+1]+p[D+1]),D=A;return M}(r,t,i,o)>0)for(let p=t;p<i;p+=o)h=Co(p/o|0,r[p],r[p+1],h);else for(let p=i-o;p>=t;p-=o)h=Co(p/o|0,r[p],r[p+1],h);return h&&wn(h,h.next)&&(Wc(h),h=h.next),h}function Ql(r,t){if(!r)return r;t||(t=r);let i,o=r;do if(i=!1,o.steiner||!wn(o,o.next)&&dn(o.prev,o,o.next)!==0)o=o.next;else{if(Wc(o),o=t=o.prev,o===o.next)break;i=!0}while(i||o!==t);return t}function $c(r,t,i,o,l,h,p){if(!r)return;!p&&h&&function(x,w,M,A){let D=x;do D.z===0&&(D.z=Yc(D.x,D.y,w,M,A)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,function(I){let k,F=1;do{let U,X=I;I=null;let st=null;for(k=0;X;){k++;let Q=X,it=0;for(let _t=0;_t<F&&(it++,Q=Q.nextZ,Q);_t++);let dt=F;for(;it>0||dt>0&&Q;)it!==0&&(dt===0||!Q||X.z<=Q.z)?(U=X,X=X.nextZ,it--):(U=Q,Q=Q.nextZ,dt--),st?st.nextZ=U:I=U,U.prevZ=st,st=U;X=Q}st.nextZ=null,F*=2}while(k>1)}(D)}(r,o,l,h);let y=r;for(;r.prev!==r.next;){const x=r.prev,w=r.next;if(h?Eo(r,o,l,h):Yh(r))t.push(x.i,r.i,w.i),Wc(r),r=w.next,y=w.next;else if((r=w)===y){p?p===1?$c(r=am(Ql(r),t),t,i,o,l,h,2):p===2&&dp(r,t,i,o,l,h):$c(Ql(r),t,i,o,l,h,1);break}}}function Yh(r){const t=r.prev,i=r,o=r.next;if(dn(t,i,o)>=0)return!1;const l=t.x,h=i.x,p=o.x,y=t.y,x=i.y,w=o.y,M=Math.min(l,h,p),A=Math.min(y,x,w),D=Math.max(l,h,p),I=Math.max(y,x,w);let k=o.next;for(;k!==t;){if(k.x>=M&&k.x<=D&&k.y>=A&&k.y<=I&&fn(l,y,h,x,p,w,k.x,k.y)&&dn(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function Eo(r,t,i,o){const l=r.prev,h=r,p=r.next;if(dn(l,h,p)>=0)return!1;const y=l.x,x=h.x,w=p.x,M=l.y,A=h.y,D=p.y,I=Math.min(y,x,w),k=Math.min(M,A,D),F=Math.max(y,x,w),U=Math.max(M,A,D),X=Yc(I,k,t,i,o),st=Yc(F,U,t,i,o);let Q=r.prevZ,it=r.nextZ;for(;Q&&Q.z>=X&&it&&it.z<=st;){if(Q.x>=I&&Q.x<=F&&Q.y>=k&&Q.y<=U&&Q!==l&&Q!==p&&fn(y,M,x,A,w,D,Q.x,Q.y)&&dn(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,it.x>=I&&it.x<=F&&it.y>=k&&it.y<=U&&it!==l&&it!==p&&fn(y,M,x,A,w,D,it.x,it.y)&&dn(it.prev,it,it.next)>=0))return!1;it=it.nextZ}for(;Q&&Q.z>=X;){if(Q.x>=I&&Q.x<=F&&Q.y>=k&&Q.y<=U&&Q!==l&&Q!==p&&fn(y,M,x,A,w,D,Q.x,Q.y)&&dn(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;it&&it.z<=st;){if(it.x>=I&&it.x<=F&&it.y>=k&&it.y<=U&&it!==l&&it!==p&&fn(y,M,x,A,w,D,it.x,it.y)&&dn(it.prev,it,it.next)>=0)return!1;it=it.nextZ}return!0}function am(r,t){let i=r;do{const o=i.prev,l=i.next.next;!wn(o,l)&&lm(o,i,i.next,l)&&Gi(o,l)&&Gi(l,o)&&(t.push(o.i,i.i,l.i),Wc(i),Wc(i.next),i=r=l),i=i.next}while(i!==r);return Ql(i)}function dp(r,t,i,o,l,h){let p=r;do{let y=p.next.next;for(;y!==p.prev;){if(p.i!==y.i&&gp(p,y)){let x=na(p,y);return p=Ql(p,p.next),x=Ql(x,x.next),$c(p,t,i,o,l,h,0),void $c(x,t,i,o,l,h,0)}y=y.next}p=p.next}while(p!==r)}function sm(r,t){let i=r.x-t.x;return i===0&&(i=r.y-t.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(t.next.y-t.y)/(t.next.x-t.x)),i}function pp(r,t){const i=function(l,h){let p=h;const y=l.x,x=l.y;let w,M=-1/0;if(wn(l,p))return p;do{if(wn(l,p.next))return p.next;if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){const F=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(F<=y&&F>M&&(M=F,w=p.x<p.next.x?p:p.next,F===y))return w}p=p.next}while(p!==h);if(!w)return null;const A=w,D=w.x,I=w.y;let k=1/0;p=w;do{if(y>=p.x&&p.x>=D&&y!==p.x&&Ao(x<I?y:M,x,D,I,x<I?M:y,x,p.x,p.y)){const F=Math.abs(x-p.y)/(y-p.x);Gi(p,l)&&(F<k||F===k&&(p.x>w.x||p.x===w.x&&mp(w,p)))&&(w=p,k=F)}p=p.next}while(p!==A);return w}(r,t);if(!i)return t;const o=na(i,r);return Ql(o,o.next),Ql(i,i.next)}function mp(r,t){return dn(r.prev,r,t.prev)<0&&dn(t.next,r,r.next)<0}function Yc(r,t,i,o,l){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*l|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function om(r){let t=r,i=r;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==r);return i}function Ao(r,t,i,o,l,h,p,y){return(l-p)*(t-y)>=(r-p)*(h-y)&&(r-p)*(o-y)>=(i-p)*(t-y)&&(i-p)*(h-y)>=(l-p)*(o-y)}function fn(r,t,i,o,l,h,p,y){return!(r===p&&t===y)&&Ao(r,t,i,o,l,h,p,y)}function gp(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(i,o){let l=i;do{if(l.i!==i.i&&l.next.i!==i.i&&l.i!==o.i&&l.next.i!==o.i&&lm(l,l.next,i,o))return!0;l=l.next}while(l!==i);return!1}(r,t)&&(Gi(r,t)&&Gi(t,r)&&function(i,o){let l=i,h=!1;const p=(i.x+o.x)/2,y=(i.y+o.y)/2;do l.y>y!=l.next.y>y&&l.next.y!==l.y&&p<(l.next.x-l.x)*(y-l.y)/(l.next.y-l.y)+l.x&&(h=!h),l=l.next;while(l!==i);return h}(r,t)&&(dn(r.prev,r,t.prev)||dn(r,t.prev,t))||wn(r,t)&&dn(r.prev,r,r.next)>0&&dn(t.prev,t,t.next)>0)}function dn(r,t,i){return(t.y-r.y)*(i.x-t.x)-(t.x-r.x)*(i.y-t.y)}function wn(r,t){return r.x===t.x&&r.y===t.y}function lm(r,t,i,o){const l=Kh(dn(r,t,i)),h=Kh(dn(r,t,o)),p=Kh(dn(i,o,r)),y=Kh(dn(i,o,t));return l!==h&&p!==y||!(l!==0||!Wh(r,i,t))||!(h!==0||!Wh(r,o,t))||!(p!==0||!Wh(i,r,o))||!(y!==0||!Wh(i,t,o))}function Wh(r,t,i){return t.x<=Math.max(r.x,i.x)&&t.x>=Math.min(r.x,i.x)&&t.y<=Math.max(r.y,i.y)&&t.y>=Math.min(r.y,i.y)}function Kh(r){return r>0?1:r<0?-1:0}function Gi(r,t){return dn(r.prev,r,r.next)<0?dn(r,t,r.next)>=0&&dn(r,r.prev,t)>=0:dn(r,t,r.prev)<0||dn(r,r.next,t)<0}function na(r,t){const i=ud(r.i,r.x,r.y),o=ud(t.i,t.x,t.y),l=r.next,h=t.prev;return r.next=t,t.prev=r,i.next=l,l.prev=i,o.next=i,i.prev=o,h.next=o,o.prev=h,o}function Co(r,t,i,o){const l=ud(r,t,i);return o?(l.next=o.next,l.prev=o,o.next.prev=l,o.next=l):(l.prev=l,l.next=l),l}function Wc(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function ud(r,t,i){return{i:r,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Yu{constructor(t,i){if(i>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=i}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class cd{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}cd.noSubdivision=new cd({fill:new Yu(0,0),line:new Yu(0,0),tile:new Yu(0,0),stencil:new Yu(0,0),circle:1}),le("SubdivisionGranularityExpression",Yu),le("SubdivisionGranularitySetting",cd);const ul=-32768,dr=32767;class Us{constructor(t,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=ge/t,this._canonical=i}_getKey(t,i){return(t+=32768)<<16|i+32768}_vertexToIndex(t,i){if(t<-32768||i<-32768||t>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),l=0|Math.round(i),h=this._getKey(o,l);if(this._vertexDictionary.has(h))return this._vertexDictionary.get(h);const p=this._vertexBuffer.length/2;return this._vertexDictionary.set(h,p),this._vertexBuffer.push(o,l),p}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(l,h){const p=[];for(let y=0;y<h.length;y+=3){const x=h[y],w=h[y+1],M=h[y+2],A=l[2*x],D=l[2*x+1];(l[2*w]-A)*(l[2*M+1]-D)-(l[2*w+1]-D)*(l[2*M]-A)>0?(p.push(x),p.push(M),p.push(w)):(p.push(x),p.push(w),p.push(M))}return p}(this._vertexBuffer,t);const i=[],o=t.length;for(let l=0;l<o;l+=3){const h=[t[l+0],t[l+1],t[l+2]],p=[this._vertexBuffer[2*t[l+0]+0],this._vertexBuffer[2*t[l+0]+1],this._vertexBuffer[2*t[l+1]+0],this._vertexBuffer[2*t[l+1]+1],this._vertexBuffer[2*t[l+2]+0],this._vertexBuffer[2*t[l+2]+1]];let y=1/0,x=1/0,w=-1/0,M=-1/0;for(let F=0;F<3;F++){const U=p[2*F],X=p[2*F+1];y=Math.min(y,U),w=Math.max(w,U),x=Math.min(x,X),M=Math.max(M,X)}if(y===w||x===M)continue;const A=Math.floor(y/this._granularityCellSize),D=Math.ceil(w/this._granularityCellSize),I=Math.floor(x/this._granularityCellSize),k=Math.ceil(M/this._granularityCellSize);if(A!==D||I!==k)for(let F=I;F<k;F++){const U=this._scanlineGenerateVertexRingForCellRow(F,p,h);um(this._vertexBuffer,U,i)}else i.push(...h)}return i}_scanlineGenerateVertexRingForCellRow(t,i,o){const l=t*this._granularityCellSize,h=l+this._granularityCellSize,p=[];for(let y=0;y<3;y++){const x=i[2*y],w=i[2*y+1],M=i[2*(y+1)%6],A=i[(2*(y+1)+1)%6],D=i[2*(y+2)%6],I=i[(2*(y+2)+1)%6],k=M-x,F=A-w,U=k===0,X=F===0,st=(l-w)/F,Q=(h-w)/F,it=Math.min(st,Q),dt=Math.max(st,Q);if(!X&&(it>=1||dt<=0)||X&&(w<l||w>h)){A>=l&&A<=h&&p.push(o[(y+1)%3]);continue}!X&&it>0&&p.push(this._vertexToIndex(x+k*it,w+F*it));const _t=x+k*Math.max(it,0),zt=x+k*Math.min(dt,1);U||this._generateIntraEdgeVertices(p,x,w,M,A,_t,zt),!X&&dt<1&&p.push(this._vertexToIndex(x+k*dt,w+F*dt)),(X||A>=l&&A<=h)&&p.push(o[(y+1)%3]),!X&&(A<=l||A>=h)&&this._generateInterEdgeVertices(p,x,w,M,A,D,I,zt,l,h)}return p}_generateIntraEdgeVertices(t,i,o,l,h,p,y){const x=l-i,w=h-o,M=w===0,A=M?Math.min(i,l):Math.min(p,y),D=M?Math.max(i,l):Math.max(p,y),I=Math.floor(A/this._granularityCellSize)+1,k=Math.ceil(D/this._granularityCellSize)-1;if(M?i<l:p<y)for(let F=I;F<=k;F++){const U=F*this._granularityCellSize;t.push(this._vertexToIndex(U,o+w*(U-i)/x))}else for(let F=k;F>=I;F--){const U=F*this._granularityCellSize;t.push(this._vertexToIndex(U,o+w*(U-i)/x))}}_generateInterEdgeVertices(t,i,o,l,h,p,y,x,w,M){const A=h-o,D=p-l,I=y-h,k=(w-h)/I,F=(M-h)/I,U=Math.min(k,F),X=Math.max(k,F),st=l+D*U;let Q=Math.floor(Math.min(st,x)/this._granularityCellSize)+1,it=Math.ceil(Math.max(st,x)/this._granularityCellSize)-1,dt=x<st;const _t=I===0;if(_t&&(y===w||y===M))return;if(_t||U>=1||X<=0){const $t=o-y,Zt=p+(i-p)*Math.min((w-y)/$t,(M-y)/$t);Q=Math.floor(Math.min(Zt,x)/this._granularityCellSize)+1,it=Math.ceil(Math.max(Zt,x)/this._granularityCellSize)-1,dt=x<Zt}const zt=A>0?M:w;if(dt)for(let $t=Q;$t<=it;$t++)t.push(this._vertexToIndex($t*this._granularityCellSize,zt));else for(let $t=it;$t>=Q;$t--)t.push(this._vertexToIndex($t*this._granularityCellSize,zt))}_generateOutline(t){const i=[];for(const o of t){const l=Xn(o,this._granularity,!0),h=this._pointArrayToIndices(l),p=[];for(let y=1;y<h.length;y++)p.push(h[y-1]),p.push(h[y]);i.push(p)}return i}_handlePoles(t){let i=!1,o=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(i||o)&&this._fillPoles(t,i,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let i=0;i<t.length;i+=2){const o=t[i+1];o===ul&&(t[i+1]=-32767),o===dr&&(t[i+1]=32766)}}_generatePoleQuad(t,i,o,l,h,p){l>h!=(p===ul)?(t.push(i),t.push(o),t.push(this._vertexToIndex(l,p)),t.push(o),t.push(this._vertexToIndex(h,p)),t.push(this._vertexToIndex(l,p))):(t.push(o),t.push(i),t.push(this._vertexToIndex(l,p)),t.push(this._vertexToIndex(h,p)),t.push(o),t.push(this._vertexToIndex(l,p)))}_fillPoles(t,i,o){const l=this._vertexBuffer,h=ge,p=t.length;for(let y=2;y<p;y+=3){const x=t[y-2],w=t[y-1],M=t[y],A=l[2*x],D=l[2*x+1],I=l[2*w],k=l[2*w+1],F=l[2*M],U=l[2*M+1];i&&(D===0&&k===0&&this._generatePoleQuad(t,x,w,A,I,ul),k===0&&U===0&&this._generatePoleQuad(t,w,M,I,F,ul),U===0&&D===0&&this._generatePoleQuad(t,M,x,F,A,ul)),o&&(D===h&&k===h&&this._generatePoleQuad(t,x,w,A,I,dr),k===h&&U===h&&this._generatePoleQuad(t,w,M,I,F,dr),U===h&&D===h&&this._generatePoleQuad(t,M,x,F,A,dr))}}_initializeVertices(t){for(let i=0;i<t.length;i+=2)this._vertexToIndex(t[i],t[i+1])}subdividePolygonInternal(t,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:l}=function(y){const x=[],w=[];for(const M of y)if(M.length!==0){M!==y[0]&&x.push(w.length/2);for(let A=0;A<M.length;A++)w.push(M[A].x),w.push(M[A].y)}return{flattened:w,holeIndices:x}}(t);let h;this._initializeVertices(o);try{const y=function(w,M,A=2){const D=M&&M.length,I=D?M[0]*A:w.length;let k=ll(w,0,I,A,!0);const F=[];if(!k||k.next===k.prev)return F;let U,X,st;if(D&&(k=function(Q,it,dt,_t){const zt=[];for(let $t=0,Zt=it.length;$t<Zt;$t++){const Wt=ll(Q,it[$t]*_t,$t<Zt-1?it[$t+1]*_t:Q.length,_t,!1);Wt===Wt.next&&(Wt.steiner=!0),zt.push(om(Wt))}zt.sort(sm);for(let $t=0;$t<zt.length;$t++)dt=pp(zt[$t],dt);return dt}(w,M,k,A)),w.length>80*A){U=w[0],X=w[1];let Q=U,it=X;for(let dt=A;dt<I;dt+=A){const _t=w[dt],zt=w[dt+1];_t<U&&(U=_t),zt<X&&(X=zt),_t>Q&&(Q=_t),zt>it&&(it=zt)}st=Math.max(Q-U,it-X),st=st!==0?32767/st:0}return $c(k,F,A,U,X,st,0),F}(o,l),x=this._convertIndices(o,y);h=this._subdivideTrianglesScanline(x)}catch(y){console.error(y)}let p=[];return i&&(p=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(h),{verticesFlattened:this._vertexBuffer,indicesTriangles:h,indicesLineList:p}}_convertIndices(t,i){const o=[];for(let l=0;l<i.length;l++)o.push(this._vertexToIndex(t[2*i[l]],t[2*i[l]+1]));return o}_pointArrayToIndices(t){const i=[];for(let o=0;o<t.length;o++){const l=t[o];i.push(this._vertexToIndex(l.x,l.y))}return i}}function _p(r,t,i,o=!0){return new Us(i,t).subdividePolygonInternal(r,o)}function Xn(r,t,i=!1){if(!r||r.length<1)return[];if(r.length<2)return[];const o=r[0],l=r[r.length-1],h=i&&(o.x!==l.x||o.y!==l.y);if(t<2)return h?[...r,r[0]]:[...r];const p=Math.floor(ge/t),y=[];y.push(new wt(r[0].x,r[0].y));const x=r.length,w=h?x:x-1;for(let M=0;M<w;M++){const A=r[M],D=M<x-1?r[M+1]:r[0],I=A.x,k=A.y,F=D.x,U=D.y,X=I!==F,st=k!==U;if(!X&&!st)continue;const Q=F-I,it=U-k,dt=Math.abs(Q),_t=Math.abs(it);let zt=I,$t=k;for(;;){const Wt=Q>0?(Math.floor(zt/p)+1)*p:(Math.ceil(zt/p)-1)*p,oe=it>0?(Math.floor($t/p)+1)*p:(Math.ceil($t/p)-1)*p,te=Math.abs(zt-Wt),ee=Math.abs($t-oe),Ut=Math.abs(zt-F),Me=Math.abs($t-U),we=X?te/dt:Number.POSITIVE_INFINITY,Se=st?ee/_t:Number.POSITIVE_INFINITY;if((Ut<=te||!X)&&(Me<=ee||!st))break;if(we<Se&&X||!st){zt=Wt,$t+=it*we;const de=new wt(zt,Math.round($t));y[y.length-1].x===de.x&&y[y.length-1].y===de.y||y.push(de)}else{zt+=Q*Se,$t=oe;const de=new wt(Math.round(zt),$t);y[y.length-1].x===de.x&&y[y.length-1].y===de.y||y.push(de)}}const Zt=new wt(F,U);y[y.length-1].x===Zt.x&&y[y.length-1].y===Zt.y||y.push(Zt)}return y}function um(r,t,i){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,l=r[2*t[0]];for(let x=1;x<t.length;x++){const w=r[2*t[x]];w<l&&(l=w,o=x)}const h=t.length;let p=o,y=(p+1)%h;for(;;){const x=p-1>=0?p-1:h-1,w=(y+1)%h,M=r[2*t[x]],A=r[2*t[w]],D=r[2*t[p]],I=r[2*t[p]+1],k=r[2*t[y]+1];let F=!1;if(M<A)F=!0;else if(M>A)F=!1;else{const U=k-I,X=-(r[2*t[y]]-D),st=I<k?1:-1;((M-D)*U+(r[2*t[x]+1]-I)*X)*st>((A-D)*U+(r[2*t[w]+1]-I)*X)*st&&(F=!0)}if(F){const U=t[x],X=t[p],st=t[y];U!==X&&U!==st&&X!==st&&i.push(st,X,U),p--,p<0&&(p=h-1)}else{const U=t[w],X=t[p],st=t[y];U!==X&&U!==st&&X!==st&&i.push(st,X,U),y++,y>=h&&(y=0)}if(x===w)break}}function zo(r,t,i,o,l,h,p,y,x){const w=l.length/2,M=p&&y&&x;if(w<me.MAX_VERTEX_ARRAY_LENGTH){const A=t.prepareSegment(w,i,o),D=A.vertexLength;for(let F=0;F<h.length;F+=3)o.emplaceBack(D+h[F],D+h[F+1],D+h[F+2]);let I,k;A.vertexLength+=w,A.primitiveLength+=h.length/3,M&&(k=p.prepareSegment(w,i,y),I=k.vertexLength,k.vertexLength+=w);for(let F=0;F<l.length;F+=2)r(l[F],l[F+1]);if(M)for(let F=0;F<x.length;F++){const U=x[F];for(let X=1;X<U.length;X+=2)y.emplaceBack(I+U[X-1],I+U[X]);k.primitiveLength+=U.length/2}}else(function(A,D,I,k,F,U){const X=[];for(let _t=0;_t<k.length/2;_t++)X.push(-1);const st={count:0};let Q=0,it=A.getOrCreateLatestSegment(D,I),dt=it.vertexLength;for(let _t=2;_t<F.length;_t+=3){const zt=F[_t-2],$t=F[_t-1],Zt=F[_t];let Wt=X[zt]<Q,oe=X[$t]<Q,te=X[Zt]<Q;it.vertexLength+((Wt?1:0)+(oe?1:0)+(te?1:0))>me.MAX_VERTEX_ARRAY_LENGTH&&(it=A.createNewSegment(D,I),Q=st.count,Wt=!0,oe=!0,te=!0,dt=0);const ee=js(X,k,U,st,zt,Wt,it),Ut=js(X,k,U,st,$t,oe,it),Me=js(X,k,U,st,Zt,te,it);I.emplaceBack(dt+ee-Q,dt+Ut-Q,dt+Me-Q),it.primitiveLength++}})(t,i,o,l,h,r),M&&function(A,D,I,k,F,U){const X=[];for(let _t=0;_t<k.length/2;_t++)X.push(-1);const st={count:0};let Q=0,it=A.getOrCreateLatestSegment(D,I),dt=it.vertexLength;for(let _t=0;_t<F.length;_t++){const zt=F[_t];for(let $t=1;$t<F[_t].length;$t+=2){const Zt=zt[$t-1],Wt=zt[$t];let oe=X[Zt]<Q,te=X[Wt]<Q;it.vertexLength+((oe?1:0)+(te?1:0))>me.MAX_VERTEX_ARRAY_LENGTH&&(it=A.createNewSegment(D,I),Q=st.count,oe=!0,te=!0,dt=0);const ee=js(X,k,U,st,Zt,oe,it),Ut=js(X,k,U,st,Wt,te,it);I.emplaceBack(dt+ee-Q,dt+Ut-Q),it.primitiveLength++}}}(p,i,y,l,x,r),t.forceNewSegmentOnNextPrepare(),p?.forceNewSegmentOnNextPrepare()}function js(r,t,i,o,l,h,p){if(h){const y=o.count;return i(t[2*l],t[2*l+1]),r[l]=o.count,o.count++,p.vertexLength++,y}return r[l]}class Vs{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new at,this.indexArray=new Kt,this.indexArray2=new Jt,this.programConfigurations=new So(t.layers,t.zoom),this.segments=new me,this.segments2=new me,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,o){this.hasDependencies=$h("fill",this.layers,i);const l=this.layers[0].layout.get("fill-sort-key"),h=!l.isConstant(),p=[];for(const{feature:y,id:x,index:w,sourceLayerIndex:M}of t){const A=this.layers[0]._featureFilter.needGeometry,D=Ns(y,A);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom),D,o))continue;const I=h?l.evaluate(D,{},o,i.availableImages):void 0,k={id:x,properties:y.properties,type:y.type,sourceLayerIndex:M,index:w,geometry:A?D.geometry:Fs(y),patterns:{},sortKey:I};p.push(k)}h&&p.sort((y,x)=>y.sortKey-x.sortKey);for(const y of p){const{geometry:x,index:w,sourceLayerIndex:M}=y;if(this.hasDependencies){const A=$u("fill",this.layers,y,{zoom:this.zoom},i);this.patternFeatures.push(A)}else this.addFeature(y,x,w,o,{},i.subdivisionGranularity);i.featureIndex.insert(t[w].feature,x,w,M,this.index)}}update(t,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:o})}addFeatures(t,i,o){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,i,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Km),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,o,l,h,p){for(const y of Bl(i,500)){const x=_p(y,l,p.fill.getGranularityForZoomLevel(l.z)),w=this.layoutVertexArray;zo((M,A)=>{w.emplaceBack(M,A)},this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:h,canonical:l})}}let hd,fd;le("FillBucket",Vs,{omit:["layers","patternFeatures"]});var Gs={get paint(){return fd=fd||new ir({"fill-antialias":new pe(tt.paint_fill["fill-antialias"]),"fill-opacity":new _e(tt.paint_fill["fill-opacity"]),"fill-color":new _e(tt.paint_fill["fill-color"]),"fill-outline-color":new _e(tt.paint_fill["fill-outline-color"]),"fill-translate":new pe(tt.paint_fill["fill-translate"]),"fill-translate-anchor":new pe(tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new yo(tt.paint_fill["fill-pattern"])})},get layout(){return hd=hd||new ir({"fill-sort-key":new _e(tt.layout_fill["fill-sort-key"])})}};class cm extends an{constructor(t,i){super(t,Gs,i)}recalculate(t,i){super.recalculate(t,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Vs(t)}queryRadius(){return Zh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:i,transform:o,pixelsToTileUnits:l}){return op(qh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,l),i)}isTileClipped(){return!0}}const Kc=yi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Qh=yi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Jh}=Kc;class Zs{constructor(t,i,o,l,h){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=l,this._values=h,t.readFields(hm,this,i)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos,o=[];let l,h=1,p=0,y=0,x=0;for(;t.pos<i;){if(p<=0){const w=t.readVarint();h=7&w,p=w>>3}if(p--,h===1||h===2)y+=t.readSVarint(),x+=t.readSVarint(),h===1&&(l&&o.push(l),l=[]),l&&l.push(new wt(y,x));else{if(h!==7)throw new Error(`unknown command ${h}`);l&&l.push(l[0].clone())}}return l&&o.push(l),o}bbox(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos;let o=1,l=0,h=0,p=0,y=1/0,x=-1/0,w=1/0,M=-1/0;for(;t.pos<i;){if(l<=0){const A=t.readVarint();o=7&A,l=A>>3}if(l--,o===1||o===2)h+=t.readSVarint(),p+=t.readSVarint(),h<y&&(y=h),h>x&&(x=h),p<w&&(w=p),p>M&&(M=p);else if(o!==7)throw new Error(`unknown command ${o}`)}return[y,w,x,M]}toGeoJSON(t,i,o){const l=this.extent*Math.pow(2,o),h=this.extent*t,p=this.extent*i,y=this.loadGeometry();function x(D){return[360*(D.x+h)/l-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+p)/l)*Math.PI))-90]}function w(D){return D.map(x)}let M;if(this.type===1){const D=[];for(const k of y)D.push(k[0]);const I=w(D);M=D.length===1?{type:"Point",coordinates:I[0]}:{type:"MultiPoint",coordinates:I}}else if(this.type===2){const D=y.map(w);M=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=function(k){const F=k.length;if(F<=1)return[k];const U=[];let X,st;for(let Q=0;Q<F;Q++){const it=fm(k[Q]);it!==0&&(st===void 0&&(st=it<0),st===it<0?(X&&U.push(X),X=[k[Q]]):X&&X.push(k[Q]))}return X&&U.push(X),U}(y),I=[];for(const k of D)I.push(k.map(w));M=I.length===1?{type:"Polygon",coordinates:I[0]}:{type:"MultiPolygon",coordinates:I}}}const A={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(A.id=this.id),A}}function hm(r,t,i){r===1?t.id=i.readVarint():r===2?function(o,l){const h=o.readVarint()+o.pos;for(;o.pos<h;){const p=l._keys[o.readVarint()],y=l._values[o.readVarint()];l.properties[p]=y}}(i,t):r===3?t.type=i.readVarint():r===4&&(t._geometry=i.pos)}function fm(r){let t=0;for(let i,o,l=0,h=r.length,p=h-1;l<h;p=l++)i=r[l],o=r[p],t+=(o.x-i.x)*(i.y+o.y);return t}Zs.types=["Unknown","Point","LineString","Polygon"];class Qc{constructor(t,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(dm,this,i),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const i=this._pbf.readVarint()+this._pbf.pos;return new Zs(this._pbf,i,this.extent,this._keys,this._values)}}function dm(r,t,i){r===15?t.version=i.readVarint():r===1?t.name=i.readString():r===5?t.extent=i.readVarint():r===2?t._features.push(i.pos):r===3?t._keys.push(i.readString()):r===4&&t._values.push(function(o){let l=null;const h=o.readVarint()+o.pos;for(;o.pos<h;){const p=o.readVarint()>>3;l=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}if(l==null)throw new Error("unknown feature value");return l}(i))}class tf{constructor(t,i){this.layers=t.readFields(pm,{},i)}}function pm(r,t,i){if(r===3){const o=new Qc(i,i.readVarint()+i.pos);o.length&&(t[o.name]=o)}}const yp=Math.pow(2,13);function ef(r,t,i,o,l,h,p,y){r.emplaceBack(t,i,2*Math.floor(o*yp)+p,l*yp*2,h*yp*2,Math.round(y))}class mi{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasDependencies=!1,this.layoutVertexArray=new ct,this.centroidVertexArray=new J,this.indexArray=new Kt,this.programConfigurations=new So(t.layers,t.zoom),this.segments=new me,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,o){this.features=[],this.hasDependencies=$h("fill-extrusion",this.layers,i);for(const{feature:l,id:h,index:p,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,w=Ns(l,x);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom),w,o))continue;const M={id:h,sourceLayerIndex:y,index:p,geometry:x?w.geometry:Fs(l),properties:l.properties,type:l.type,patterns:{}};this.hasDependencies?this.features.push($u("fill-extrusion",this.layers,M,{zoom:this.zoom},i)):this.addFeature(M,M.geometry,p,o,{},i.subdivisionGranularity),i.featureIndex.insert(l,M.geometry,p,y,this.index,!0)}}addFeatures(t,i,o){for(const l of this.features){const{geometry:h}=l;this.addFeature(l,h,l.index,i,o,t.subdivisionGranularity)}}update(t,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jh),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,Qh.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,i,o,l,h,p){for(const y of Bl(i,500)){const x={x:0,y:0,sampleCount:0},w=this.layoutVertexArray.length;this.processPolygon(x,l,t,y,p);const M=this.layoutVertexArray.length-w,A=Math.floor(x.x/x.sampleCount),D=Math.floor(x.y/x.sampleCount);for(let I=0;I<M;I++)this.centroidVertexArray.emplaceBack(A,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:h,canonical:l})}processPolygon(t,i,o,l,h){if(l.length<1||si(l[0]))return;for(const A of l)A.length!==0&&Xi(t,A);const p={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=h.fill.getGranularityForZoomLevel(i.z),x=Zs.types[o.type]==="Polygon";for(const A of l){if(A.length===0||si(A))continue;const D=Xn(A,y,x);this._generateSideFaces(D,p)}if(!x)return;const w=_p(l,i,y,!1),M=this.layoutVertexArray;zo((A,D)=>{ef(M,A,D,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,w.verticesFlattened,w.indicesTriangles)}_generateSideFaces(t,i){let o=0;for(let l=1;l<t.length;l++){const h=t[l],p=t[l-1];if(ai(h,p))continue;i.segment.vertexLength+4>me.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=h.sub(p)._perp()._unit(),x=p.dist(h);o+x>32768&&(o=0),ef(this.layoutVertexArray,h.x,h.y,y.x,y.y,0,0,o),ef(this.layoutVertexArray,h.x,h.y,y.x,y.y,0,1,o),o+=x,ef(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,0,o),ef(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,1,o);const w=i.segment.vertexLength;this.indexArray.emplaceBack(w,w+2,w+1),this.indexArray.emplaceBack(w+1,w+2,w+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function Xi(r,t){for(let i=0;i<t.length;i++){const o=t[i];i===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(r.x+=o.x,r.y+=o.y,r.sampleCount++)}}function ai(r,t){return r.x===t.x&&(r.x<0||r.x>ge)||r.y===t.y&&(r.y<0||r.y>ge)}function si(r){return r.every(t=>t.x<0)||r.every(t=>t.x>ge)||r.every(t=>t.y<0)||r.every(t=>t.y>ge)}let Bi;le("FillExtrusionBucket",mi,{omit:["layers","features"]});var La={get paint(){return Bi=Bi||new ir({"fill-extrusion-opacity":new pe(tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new _e(tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pe(tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pe(tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yo(tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new _e(tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new _e(tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pe(tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Jl extends an{constructor(t,i){super(t,La,i)}createBucket(t){return new mi(t)}queryRadius(){return Zh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:o,geometry:l,transform:h,pixelsToTileUnits:p,pixelPosMatrix:y}){const x=qh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-h.bearingInRadians,p),w=this.paint.get("fill-extrusion-height").evaluate(i,o),M=this.paint.get("fill-extrusion-base").evaluate(i,o),A=function(I,k){const F=[];for(const U of I){const X=[U.x,U.y,0,1];br(X,X,k),F.push(new wt(X[0]/X[3],X[1]/X[3]))}return F}(x,y),D=function(I,k,F,U){const X=[],st=[],Q=U[8]*k,it=U[9]*k,dt=U[10]*k,_t=U[11]*k,zt=U[8]*F,$t=U[9]*F,Zt=U[10]*F,Wt=U[11]*F;for(const oe of I){const te=[],ee=[];for(const Ut of oe){const Me=Ut.x,we=Ut.y,Se=U[0]*Me+U[4]*we+U[12],de=U[1]*Me+U[5]*we+U[13],Ye=U[2]*Me+U[6]*we+U[14],Sn=U[3]*Me+U[7]*we+U[15],lr=Ye+dt,$r=Sn+_t,$s=Se+zt,Fa=de+$t,Pr=Ye+Zt,pn=Sn+Wt,gr=new wt((Se+Q)/$r,(de+it)/$r);gr.z=lr/$r,te.push(gr);const Ir=new wt($s/pn,Fa/pn);Ir.z=Pr/pn,ee.push(Ir)}X.push(te),st.push(ee)}return[X,st]}(l,M,w,y);return function(I,k,F){let U=1/0;op(F,k)&&(U=dd(F,k[0]));for(let X=0;X<k.length;X++){const st=k[X],Q=I[X];for(let it=0;it<st.length-1;it++){const dt=st[it],_t=[dt,st[it+1],Q[it+1],Q[it],dt];sp(F,_t)&&(U=Math.min(U,dd(F,_t)))}}return U!==1/0&&U}(D[0],D[1],A)}}function Do(r,t){return r.x*t.x+r.y*t.y}function dd(r,t){if(r.length===1){let i=0;const o=t[i++];let l;for(;!l||o.equals(l);)if(l=t[i++],!l)return 1/0;for(;i<t.length;i++){const h=t[i],p=r[0],y=l.sub(o),x=h.sub(o),w=p.sub(o),M=Do(y,y),A=Do(y,x),D=Do(x,x),I=Do(w,y),k=Do(w,x),F=M*D-A*A,U=(D*I-A*k)/F,X=(M*k-A*I)/F,st=o.z*(1-U-X)+l.z*U+h.z*X;if(isFinite(st))return st}return 1/0}{let i=1/0;for(const o of t)i=Math.min(i,o.z);return i}}const cl=yi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:In}=cl,tu=yi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Wu}=tu,vp=Math.cos(Math.PI/180*37.5),da=Math.pow(2,14)/.5;class eu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new rt,this.layoutVertexArray2=new ht,this.indexArray=new Kt,this.programConfigurations=new So(t.layers,t.zoom),this.segments=new me,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,o){this.hasDependencies=$h("line",this.layers,i)||this.hasLineDasharray(this.layers);const l=this.layers[0].layout.get("line-sort-key"),h=!l.isConstant(),p=[];for(const{feature:y,id:x,index:w,sourceLayerIndex:M}of t){const A=this.layers[0]._featureFilter.needGeometry,D=Ns(y,A);if(!this.layers[0]._featureFilter.filter(new _i(this.zoom),D,o))continue;const I=h?l.evaluate(D,{},o):void 0,k={id:x,properties:y.properties,type:y.type,sourceLayerIndex:M,index:w,geometry:A?D.geometry:Fs(y),patterns:{},dashes:{},sortKey:I};p.push(k)}h&&p.sort((y,x)=>y.sortKey-x.sortKey);for(const y of p){const{geometry:x,index:w,sourceLayerIndex:M}=y;this.hasDependencies?($h("line",this.layers,i)?$u("line",this.layers,y,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,i),this.patternFeatures.push(y)):this.addFeature(y,x,w,o,{},{},i.subdivisionGranularity),i.featureIndex.insert(t[w].feature,x,w,M,this.index)}}update(t,i,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,{imagePositions:o,dashPositions:l})}addFeatures(t,i,o,l){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,i,o,l,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Wu)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,In),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,o,l,h,p,y){const x=this.layers[0].layout,w=x.get("line-join").evaluate(t,{}),M=x.get("line-cap"),A=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const I of i)this.addLine(I,t,w,M,A,D,l,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{imagePositions:h,dashPositions:p,canonical:l})}addLine(t,i,o,l,h,p,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Xn(t,y?x.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<t.length-1;Q++)this.totalDistance+=t[Q].dist(t[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=Zs.types[i.type]==="Polygon";let M=t.length;for(;M>=2&&t[M-1].equals(t[M-2]);)M--;let A=0;for(;A<M-1&&t[A].equals(t[A+1]);)A++;if(M<(w?3:2))return;o==="bevel"&&(h=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let k,F,U,X,st;this.e1=this.e2=-1,w&&(k=t[M-2],st=t[A].sub(k)._unit()._perp());for(let Q=A;Q<M;Q++){if(U=Q===M-1?w?t[A+1]:void 0:t[Q+1],U&&t[Q].equals(U))continue;st&&(X=st),k&&(F=k),k=t[Q],st=U?U.sub(k)._unit()._perp():X,X=X||st;let it=X.add(st);it.x===0&&it.y===0||it._unit();const dt=X.x*st.x+X.y*st.y,_t=it.x*st.x+it.y*st.y,zt=_t!==0?1/_t:1/0,$t=2*Math.sqrt(2-2*_t),Zt=_t<vp&&F&&U,Wt=X.x*st.y-X.y*st.x>0;if(Zt&&Q>A){const ee=k.dist(F);if(ee>2*D){const Ut=k.sub(k.sub(F)._mult(D/ee)._round());this.updateDistance(F,Ut),this.addCurrentVertex(Ut,X,0,0,I),F=Ut}}const oe=F&&U;let te=oe?o:w?"butt":l;if(oe&&te==="round"&&(zt<p?te="miter":zt<=2&&(te="fakeround")),te==="miter"&&zt>h&&(te="bevel"),te==="bevel"&&(zt>2&&(te="flipbevel"),zt<h&&(te="miter")),F&&this.updateDistance(F,k),te==="miter")it._mult(zt),this.addCurrentVertex(k,it,0,0,I);else if(te==="flipbevel"){if(zt>100)it=st.mult(-1);else{const ee=zt*X.add(st).mag()/X.sub(st).mag();it._perp()._mult(ee*(Wt?-1:1))}this.addCurrentVertex(k,it,0,0,I),this.addCurrentVertex(k,it.mult(-1),0,0,I)}else if(te==="bevel"||te==="fakeround"){const ee=-Math.sqrt(zt*zt-1),Ut=Wt?ee:0,Me=Wt?0:ee;if(F&&this.addCurrentVertex(k,X,Ut,Me,I),te==="fakeround"){const we=Math.round(180*$t/Math.PI/20);for(let Se=1;Se<we;Se++){let de=Se/we;if(de!==.5){const Sn=de-.5;de+=de*Sn*(de-1)*((1.0904+dt*(dt*(3.55645-1.43519*dt)-3.2452))*Sn*Sn+(.848013+dt*(.215638*dt-1.06021)))}const Ye=st.sub(X)._mult(de)._add(X)._unit()._mult(Wt?-1:1);this.addHalfVertex(k,Ye.x,Ye.y,!1,Wt,0,I)}}U&&this.addCurrentVertex(k,st,-Ut,-Me,I)}else if(te==="butt")this.addCurrentVertex(k,it,0,0,I);else if(te==="square"){const ee=F?1:-1;this.addCurrentVertex(k,it,ee,ee,I)}else te==="round"&&(F&&(this.addCurrentVertex(k,X,0,0,I),this.addCurrentVertex(k,X,1,1,I,!0)),U&&(this.addCurrentVertex(k,st,-1,-1,I,!0),this.addCurrentVertex(k,st,0,0,I)));if(Zt&&Q<M-1){const ee=k.dist(U);if(ee>2*D){const Ut=k.add(U.sub(k)._mult(D/ee)._round());this.updateDistance(k,Ut),this.addCurrentVertex(Ut,st,0,0,I),k=Ut}}}}addCurrentVertex(t,i,o,l,h,p=!1){const y=i.y*l-i.x,x=-i.y-i.x*l;this.addHalfVertex(t,i.x+i.y*o,i.y-i.x*o,p,!1,o,h),this.addHalfVertex(t,y,x,p,!0,-l,h),this.distance>da/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,i,o,l,h,p))}addHalfVertex({x:t,y:i},o,l,h,p,y,x){const w=.5*(this.lineClips?this.scaledDistance*(da-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(h?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*l)+128,1+(y===0?0:y<0?-1:1)|(63&w)<<2,w>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const M=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,M,this.e2),x.primitiveLength++),p?this.e2=M:this.e1=M}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}hasLineDasharray(t){for(const i of t){const o=i.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(t,i,o,l){for(const h of t){const p=h.paint.get("line-dasharray");if(!p||p.value.kind==="constant")continue;const y=h.layout.get("line-cap")==="round",x={dasharray:p.value.evaluate({zoom:o-1},i,{}),round:y},w={dasharray:p.value.evaluate({zoom:o},i,{}),round:y},M={dasharray:p.value.evaluate({zoom:o+1},i,{}),round:y},A=`${x.dasharray.join(",")},${x.round}`,D=`${w.dasharray.join(",")},${w.round}`,I=`${M.dasharray.join(",")},${M.round}`;l.dashDependencies[A]=x,l.dashDependencies[D]=w,l.dashDependencies[I]=M,i.dashes[h.id]={min:A,mid:D,max:I}}}}let Jc,ra;le("LineBucket",eu,{omit:["layers","patternFeatures"]});var pd={get paint(){return ra=ra||new ir({"line-opacity":new _e(tt.paint_line["line-opacity"]),"line-color":new _e(tt.paint_line["line-color"]),"line-translate":new pe(tt.paint_line["line-translate"]),"line-translate-anchor":new pe(tt.paint_line["line-translate-anchor"]),"line-width":new _e(tt.paint_line["line-width"]),"line-gap-width":new _e(tt.paint_line["line-gap-width"]),"line-offset":new _e(tt.paint_line["line-offset"]),"line-blur":new _e(tt.paint_line["line-blur"]),"line-dasharray":new yo(tt.paint_line["line-dasharray"]),"line-pattern":new yo(tt.paint_line["line-pattern"]),"line-gradient":new $l(tt.paint_line["line-gradient"])})},get layout(){return Jc=Jc||new ir({"line-cap":new pe(tt.layout_line["line-cap"]),"line-join":new _e(tt.layout_line["line-join"]),"line-miter-limit":new pe(tt.layout_line["line-miter-limit"]),"line-round-limit":new pe(tt.layout_line["line-round-limit"]),"line-sort-key":new _e(tt.layout_line["line-sort-key"])})}};class md extends _e{possiblyEvaluate(t,i){return i=new _i(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(t,i)}evaluate(t,i,o,l){return i=fi({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,o,l)}}let nf;class gd extends an{constructor(t,i){super(t,pd,i),this.gradientVersion=0,nf||(nf=new md(pd.paint.properties["line-width"].specification),nf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(i)&&i._styleExpression.expression instanceof ro,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,i){super.recalculate(t,i),this.paint._values["line-floorwidth"]=nf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new eu(t)}queryRadius(t){const i=t,o=rf(Hu("line-width",this,i),Hu("line-gap-width",this,i)),l=Hu("line-offset",this,i);return o/2+Math.abs(l)+Zh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:i,featureState:o,geometry:l,transform:h,pixelsToTileUnits:p}){const y=qh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-h.bearingInRadians,p),x=p/2*rf(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),w=this.paint.get("line-offset").evaluate(i,o);return w&&(l=function(M,A){const D=[];for(let I=0;I<M.length;I++){const k=M[I],F=[];for(let U=0;U<k.length;U++){const X=k[U-1],st=k[U],Q=k[U+1],it=U===0?new wt(0,0):st.sub(X)._unit()._perp(),dt=U===k.length-1?new wt(0,0):Q.sub(st)._unit()._perp(),_t=it._add(dt)._unit(),zt=_t.x*dt.x+_t.y*dt.y;zt!==0&&_t._mult(1/zt),F.push(_t._mult(A)._add(st))}D.push(F)}return D}(l,w*p)),function(M,A,D){for(let I=0;I<A.length;I++){const k=A[I];if(M.length>=3){for(let F=0;F<k.length;F++)if(Pn(M,k[F]))return!0}if(lp(M,k,D))return!0}return!1}(y,l,x)}isTileClipped(){return!0}}function rf(r,t){return t>0?t+2*r:r}const iu=yi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sr=yi([{name:"a_projected_pos",components:3,type:"Float32"}],4);yi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const nu=yi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);yi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ku=yi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),hl=yi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function xp(r,t,i){return r.sections.forEach(o=>{o.text=function(l,h,p){const y=h.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?l=l.toLocaleUpperCase():y==="lowercase"&&(l=l.toLocaleLowerCase()),fr.applyArabicShaping&&(l=fr.applyArabicShaping(l)),l}(o.text,t,i)}),r}yi([{name:"triangle",components:3,type:"Uint16"}]),yi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),yi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),yi([{type:"Float32",name:"offsetX"}]),yi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),yi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Qu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Nn=24;const Ju=4294967296,_d=1/Ju,pa=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class yd{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,i,o=this.length){for(;this.pos<o;){const l=this.readVarint(),h=l>>3,p=this.pos;this.type=7&l,t(h,i,this),this.pos===p&&this.skip(l)}return i}readMessage(t,i){return this.readFields(t,i,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Ju;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Ju;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const i=this.buf;let o,l;return l=i[this.pos++],o=127&l,l<128?o:(l=i[this.pos++],o|=(127&l)<<7,l<128?o:(l=i[this.pos++],o|=(127&l)<<14,l<128?o:(l=i[this.pos++],o|=(127&l)<<21,l<128?o:(l=i[this.pos],o|=(15&l)<<28,function(h,p,y){const x=y.buf;let w,M;if(M=x[y.pos++],w=(112&M)>>4,M<128||(M=x[y.pos++],w|=(127&M)<<3,M<128)||(M=x[y.pos++],w|=(127&M)<<10,M<128)||(M=x[y.pos++],w|=(127&M)<<17,M<128)||(M=x[y.pos++],w|=(127&M)<<24,M<128)||(M=x[y.pos++],w|=(1&M)<<31,M<128))return or(h,w,p);throw new Error("Expected varint not more than 10 bytes")}(o,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,i=this.pos;return this.pos=t,t-i>=12&&pa?pa.decode(this.buf.subarray(i,t)):function(o,l,h){let p="",y=l;for(;y<h;){const x=o[y];let w,M,A,D=null,I=x>239?4:x>223?3:x>191?2:1;if(y+I>h)break;I===1?x<128&&(D=x):I===2?(w=o[y+1],(192&w)==128&&(D=(31&x)<<6|63&w,D<=127&&(D=null))):I===3?(w=o[y+1],M=o[y+2],(192&w)==128&&(192&M)==128&&(D=(15&x)<<12|(63&w)<<6|63&M,(D<=2047||D>=55296&&D<=57343)&&(D=null))):I===4&&(w=o[y+1],M=o[y+2],A=o[y+3],(192&w)==128&&(192&M)==128&&(192&A)==128&&(D=(15&x)<<18|(63&w)<<12|(63&M)<<6|63&A,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,I=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=I}return p}(this.buf,i,t)}readBytes(){const t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i}readPackedVarint(t=[],i){const o=this.readPackedEnd();for(;this.pos<o;)t.push(this.readVarint(i));return t}readPackedSVarint(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const i=this.readPackedEnd();for(;this.pos<i;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const i=7&t;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(t,i){this.writeVarint(t<<3|i)}realloc(t){let i=this.length||16;for(;i<this.pos+t;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*_d),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*_d),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?function(i,o){let l,h;if(i>=0?(l=i%4294967296|0,h=i/4294967296|0):(l=~(-i%4294967296),h=~(-i/4294967296),4294967295^l?l=l+1|0:(l=0,h=h+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(p,y,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)}(l,0,o),function(p,y){const x=(7&p)<<4;y.buf[y.pos++]|=x|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))}(h,o)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const i=this.pos;this.pos=function(l,h,p){for(let y,x,w=0;w<h.length;w++){if(y=h.charCodeAt(w),y>55295&&y<57344){if(!x){y>56319||w+1===h.length?(l[p++]=239,l[p++]=191,l[p++]=189):x=y;continue}if(y<56320){l[p++]=239,l[p++]=191,l[p++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(l[p++]=239,l[p++]=191,l[p++]=189,x=null);y<128?l[p++]=y:(y<2048?l[p++]=y>>6|192:(y<65536?l[p++]=y>>12|224:(l[p++]=y>>18|240,l[p++]=y>>12&63|128),l[p++]=y>>6&63|128),l[p++]=63&y|128)}return p}(this.buf,t,this.pos);const o=this.pos-i;o>=128&&bp(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const i=t.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=t[o]}writeRawMessage(t,i){this.pos++;const o=this.pos;t(i,this);const l=this.pos-o;l>=128&&bp(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l}writeMessage(t,i,o){this.writeTag(t,2),this.writeRawMessage(i,o)}writePackedVarint(t,i){i.length&&this.writeMessage(t,mm,i)}writePackedSVarint(t,i){i.length&&this.writeMessage(t,Qm,i)}writePackedBoolean(t,i){i.length&&this.writeMessage(t,wp,i)}writePackedFloat(t,i){i.length&&this.writeMessage(t,ru,i)}writePackedDouble(t,i){i.length&&this.writeMessage(t,vd,i)}writePackedFixed32(t,i){i.length&&this.writeMessage(t,th,i)}writePackedSFixed32(t,i){i.length&&this.writeMessage(t,gm,i)}writePackedFixed64(t,i){i.length&&this.writeMessage(t,_m,i)}writePackedSFixed64(t,i){i.length&&this.writeMessage(t,ym,i)}writeBytesField(t,i){this.writeTag(t,2),this.writeBytes(i)}writeFixed32Field(t,i){this.writeTag(t,5),this.writeFixed32(i)}writeSFixed32Field(t,i){this.writeTag(t,5),this.writeSFixed32(i)}writeFixed64Field(t,i){this.writeTag(t,1),this.writeFixed64(i)}writeSFixed64Field(t,i){this.writeTag(t,1),this.writeSFixed64(i)}writeVarintField(t,i){this.writeTag(t,0),this.writeVarint(i)}writeSVarintField(t,i){this.writeTag(t,0),this.writeSVarint(i)}writeStringField(t,i){this.writeTag(t,2),this.writeString(i)}writeFloatField(t,i){this.writeTag(t,5),this.writeFloat(i)}writeDoubleField(t,i){this.writeTag(t,1),this.writeDouble(i)}writeBooleanField(t,i){this.writeVarintField(t,+i)}}function or(r,t,i){return i?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function bp(r,t,i){const o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(o);for(let l=i.pos-1;l>=r;l--)i.buf[l+o]=i.buf[l]}function mm(r,t){for(let i=0;i<r.length;i++)t.writeVarint(r[i])}function Qm(r,t){for(let i=0;i<r.length;i++)t.writeSVarint(r[i])}function ru(r,t){for(let i=0;i<r.length;i++)t.writeFloat(r[i])}function vd(r,t){for(let i=0;i<r.length;i++)t.writeDouble(r[i])}function wp(r,t){for(let i=0;i<r.length;i++)t.writeBoolean(r[i])}function th(r,t){for(let i=0;i<r.length;i++)t.writeFixed32(r[i])}function gm(r,t){for(let i=0;i<r.length;i++)t.writeSFixed32(r[i])}function _m(r,t){for(let i=0;i<r.length;i++)t.writeFixed64(r[i])}function ym(r,t){for(let i=0;i<r.length;i++)t.writeSFixed64(r[i])}function vm(r,t,i){r===1&&i.readMessage(xd,t)}function xd(r,t,i){if(r===3){const{id:o,bitmap:l,width:h,height:p,left:y,top:x,advance:w}=i.readMessage(Tp,{});t.push({id:o,bitmap:new Xu({width:h+6,height:p+6},l),metrics:{width:h,height:p,left:y,top:x,advance:w}})}}function Tp(r,t,i){r===1?t.id=i.readVarint():r===2?t.bitmap=i.readBytes():r===3?t.width=i.readVarint():r===4?t.height=i.readVarint():r===5?t.left=i.readSVarint():r===6?t.top=i.readSVarint():r===7&&(t.advance=i.readVarint())}function xm(r){let t=0,i=0;for(const p of r)t+=p.w*p.h,i=Math.max(i,p.w);r.sort((p,y)=>y.h-p.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let l=0,h=0;for(const p of r)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,h=Math.max(h,p.y+p.h),l=Math.max(l,p.x+p.w),p.w===x.w&&p.h===x.h){const w=o.pop();w&&y<o.length&&(o[y]=w)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:l,h,fill:t/(l*h)||0}}class Sp{constructor(t,{pixelRatio:i,version:o,stretchX:l,stretchY:h,content:p,textFitWidth:y,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=l,this.stretchY=h,this.content=p,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class bm{constructor(t,i){const o={},l={};this.haveRenderCallbacks=[];const h=[];this.addImages(t,o,h),this.addImages(i,l,h);const{w:p,h:y}=xm(h),x=new Hr({width:p||1,height:y||1});for(const w in t){const M=t[w],A=o[w].paddedRect;Hr.copy(M.data,x,{x:0,y:0},{x:A.x+1,y:A.y+1},M.data)}for(const w in i){const M=i[w],A=l[w].paddedRect,D=A.x+1,I=A.y+1,k=M.data.width,F=M.data.height;Hr.copy(M.data,x,{x:0,y:0},{x:D,y:I},M.data),Hr.copy(M.data,x,{x:0,y:F-1},{x:D,y:I-1},{width:k,height:1}),Hr.copy(M.data,x,{x:0,y:0},{x:D,y:I+F},{width:k,height:1}),Hr.copy(M.data,x,{x:k-1,y:0},{x:D-1,y:I},{width:1,height:F}),Hr.copy(M.data,x,{x:0,y:0},{x:D+k,y:I},{width:1,height:F})}this.image=x,this.iconPositions=o,this.patternPositions=l}addImages(t,i,o){for(const l in t){const h=t[l],p={x:0,y:0,w:h.data.width+2,h:h.data.height+2};o.push(p),i[l]=new Sp(p,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,i){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),i)}patchUpdatedImage(t,i,o){if(!t||!i||t.version===i.version)return;t.version=i.version;const[l,h]=t.tl;o.update(i.data,void 0,{x:l,y:h})}}var fl;le("ImagePosition",Sp),le("ImageAtlas",bm),P.at=void 0,(fl=P.at||(P.at={}))[fl.none=0]="none",fl[fl.horizontal=1]="horizontal",fl[fl.vertical=2]="vertical",fl[fl.horizontalOnly=3]="horizontalOnly";class eh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,i,o){const l=new eh;return l.scale=t||1,l.fontStack=i,l.verticalAlign=o||"bottom",l}static forImage(t,i){const o=new eh;return o.imageName=t,o.verticalAlign=i||"bottom",o}}class qs{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const o=new qs;for(let l=0;l<t.sections.length;l++){const h=t.sections[l];h.image?o.addImageSection(h):o.addTextSection(h,i)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let i="";for(let o=0;o<t.length;o++){const l=t.charCodeAt(o+1)||null,h=t.charCodeAt(o-1)||null;i+=l&&nl(l)&&!Qu[t[o+1]]||h&&nl(h)&&!Qu[t[o-1]]||!Qu[t[o]]?t[o]:Qu[t[o]]}return i}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&af[this.text.charCodeAt(o)];o++)t++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&af[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const o=new qs;return o.text=this.text.substring(t,i),o.sectionIndex=this.sectionIndex.slice(t,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}getMaxImageSize(t){let i=0,o=0;for(let l=0;l<this.length();l++){const h=this.getSection(l);if(h.imageName){const p=t[h.imageName];if(!p)continue;const y=p.displaySize;i=Math.max(i,y[0]),o=Math.max(o,y[1])}}return{maxImageWidth:i,maxImageHeight:o}}addTextSection(t,i){this.text+=t.text,this.sections.push(eh.forText(t.scale,t.fontStack||i,t.verticalAlign));const o=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(o)}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void gi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(eh.forImage(i,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):gi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function tc(r,t,i,o,l,h,p,y,x,w,M,A,D,I,k){const F=qs.fromFeature(r,l);let U;A===P.at.vertical&&F.verticalizePunctuation();const{processBidirectionalText:X,processStyledBidirectionalText:st}=fr;if(X&&F.sections.length===1){U=[];const dt=X(F.toString(),bd(F,w,h,t,o,I));for(const _t of dt){const zt=new qs;zt.text=_t,zt.sections=F.sections;for(let $t=0;$t<_t.length;$t++)zt.sectionIndex.push(0);U.push(zt)}}else if(st){U=[];const dt=st(F.text,F.sectionIndex,bd(F,w,h,t,o,I));for(const _t of dt){const zt=new qs;zt.text=_t[0],zt.sectionIndex=_t[1],zt.sections=F.sections,U.push(zt)}}else U=function(dt,_t){const zt=[],$t=dt.text;let Zt=0;for(const Wt of _t)zt.push(dt.substring(Zt,Wt)),Zt=Wt;return Zt<$t.length&&zt.push(dt.substring(Zt,$t.length)),zt}(F,bd(F,w,h,t,o,I));const Q=[],it={positionedLines:Q,text:F.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:A,iconsInText:!1,verticalizable:!1};return function(dt,_t,zt,$t,Zt,Wt,oe,te,ee,Ut,Me,we){let Se=0,de=0,Ye=0,Sn=0;const lr=te==="right"?1:te==="left"?0:.5,$r=Nn/we;let $s=0;for(const pn of Zt){pn.trim();const gr=pn.getMaxScale(),Ir={positionedGlyphs:[],lineOffset:0};dt.positionedLines[$s]=Ir;const Rr=Ir.positionedGlyphs;let ga=0;if(!pn.length()){de+=Wt,++$s;continue}const Ys=Cp($t,pn,$r);for(let Na=0;Na<pn.length();Na++){const ur=pn.getSection(Na),yr=pn.getSectionIndex(Na),vr=pn.getCharCode(Na),$n=Em(ee,Me,vr);let Ji;if(ur.imageName){if(dt.iconsInText=!0,ur.scale=ur.scale*$r,Ji=tg(ur,$n,gr,Ys,$t),!Ji)continue;ga=Math.max(ga,Ji.imageOffset)}else if(Ji=Jm(ur,vr,$n,Ys,_t,zt),!Ji)continue;const{rect:bl,metrics:$d,baselineOffset:wl}=Ji;Rr.push({glyph:vr,imageName:ur.imageName,x:Se,y:de+wl+-17,vertical:$n,scale:ur.scale,fontStack:ur.fontStack,sectionIndex:yr,metrics:$d,rect:bl}),$n?(dt.verticalizable=!0,Se+=(ur.imageName?$d.advance:Nn)*ur.scale+Ut):Se+=$d.advance*ur.scale+Ut}Rr.length!==0&&(Ye=Math.max(Se-Ut,Ye),eg(Rr,0,Rr.length-1,lr)),Se=0,Ir.lineOffset=Math.max(ga,(gr-1)*Nn);const _r=Wt*gr+ga;de+=_r,Sn=Math.max(_r,Sn),++$s}const{horizontalAlign:Fa,verticalAlign:Pr}=Ei(oe);(function(pn,gr,Ir,Rr,ga,Ys,_r,Na,ur){const yr=(gr-Ir)*ga;let vr=0;vr=Ys!==_r?-Na*Rr- -17:-Rr*ur*_r+.5*_r;for(const $n of pn)for(const Ji of $n.positionedGlyphs)Ji.x+=yr,Ji.y+=vr})(dt.positionedLines,lr,Fa,Pr,Ye,Sn,Wt,de,Zt.length),dt.top+=-Pr*de,dt.bottom=dt.top+de,dt.left+=-Fa*Ye,dt.right=dt.left+Ye}(it,t,i,o,U,p,y,x,A,w,D,k),!function(dt){for(const _t of dt)if(_t.positionedGlyphs.length!==0)return!1;return!0}(Q)&&it}const af={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wm={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Tm={40:!0};function Mp(r,t,i,o,l,h){if(t.imageName){const p=o[t.imageName];return p?p.displaySize[0]*t.scale*Nn/h+l:0}{const p=i[t.fontStack],y=p&&p[r];return y?y.metrics.advance*t.scale+l:0}}function Ep(r,t,i,o){const l=Math.pow(r-t,2);return o?r<t?l/2:2*l:l+Math.abs(i)*i}function Sm(r,t,i){let o=0;return r===10&&(o-=1e4),i&&(o+=150),r!==40&&r!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function sf(r,t,i,o,l,h){let p=null,y=Ep(t,i,l,h);for(const x of o){const w=Ep(t-x.x,i,l,h)+x.badness;w<=y&&(p=x,y=w)}return{index:r,x:t,priorBreak:p,badness:y}}function Ap(r){return r?Ap(r.priorBreak).concat(r.index):[]}function bd(r,t,i,o,l,h){if(!r)return[];const p=[],y=function(M,A,D,I,k,F){let U=0;for(let X=0;X<M.length();X++){const st=M.getSection(X);U+=Mp(M.getCharCode(X),st,I,k,A,F)}return U/Math.max(1,Math.ceil(U/D))}(r,t,i,o,l,h),x=r.text.indexOf("")>=0;let w=0;for(let M=0;M<r.length();M++){const A=r.getSection(M),D=r.getCharCode(M);if(af[D]||(w+=Mp(D,A,o,l,t,h)),M<r.length()-1){const I=il(D);(wm[D]||I||A.imageName||M!==r.length()-2&&Tm[r.getCharCode(M+1)])&&p.push(sf(M+1,w,y,p,Sm(D,r.getCharCode(M+1),I&&x),!1))}}return Ap(sf(r.length(),w,y,p,0,!0))}function Ei(r){let t=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Cp(r,t,i){const o=t.getMaxScale()*Nn,{maxImageWidth:l,maxImageHeight:h}=t.getMaxImageSize(r),p=Math.max(o,h*i);return{verticalLineContentWidth:Math.max(o,l*i),horizontalLineContentHeight:p}}function Mm(r){switch(r){case"top":return 0;case"center":return .5;default:return 1}}function Em(r,t,i){return!(r===P.at.horizontal||!t&&!fa(i)||t&&(af[i]||(o=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Jm(r,t,i,o,l,h){const p=h[r.fontStack],y=function(w,M,A,D){if(w&&w.rect)return w;const I=M[A.fontStack],k=I&&I[D];return k?{rect:null,metrics:k.metrics}:null}(p&&p[t],l,r,t);if(y===null)return null;let x;if(i)x=o.verticalLineContentWidth-r.scale*Nn;else{const w=Mm(r.verticalAlign);x=(o.horizontalLineContentHeight-r.scale*Nn)*w}return{rect:y.rect,metrics:y.metrics,baselineOffset:x}}function tg(r,t,i,o,l){const h=l[r.imageName];if(!h)return null;const p=h.paddedRect,y=h.displaySize,x={width:y[0],height:y[1],left:1,top:-3,advance:t?y[1]:y[0]};let w;if(t)w=o.verticalLineContentWidth-y[1]*r.scale;else{const M=Mm(r.verticalAlign);w=(o.horizontalLineContentHeight-y[1]*r.scale)*M}return{rect:p,metrics:x,baselineOffset:w,imageOffset:(t?y[0]:y[1])*r.scale-Nn*i}}function eg(r,t,i,o){if(o===0)return;const l=r[i],h=(r[i].x+l.metrics.advance*l.scale)*o;for(let p=t;p<=i;p++)r[p].x-=h}function wd(r,t,i){const{horizontalAlign:o,verticalAlign:l}=Ei(i),h=t[0]-r.displaySize[0]*o,p=t[1]-r.displaySize[1]*l;return{image:r,top:p,bottom:p+r.displaySize[1],left:h,right:h+r.displaySize[0]}}function ec(r){var t,i;let o=r.left,l=r.top,h=r.right-o,p=r.bottom-l;const y=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(i=r.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",w=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&h/p<w||y==="proportional"){const M=Math.ceil(p*w);o*=M/h,h=M}}else if(y==="proportional"&&x==="stretchOnly"&&w!==0&&h/p>w){const M=Math.ceil(h/w);l*=M/p,p=M}return{x1:o,y1:l,x2:o+h,y2:l+p}}function Td(r,t,i,o,l,h){const p=r.image;let y;if(p.content){const U=p.content,X=p.pixelRatio||1;y=[U[0]/X,U[1]/X,p.displaySize[0]-U[2]/X,p.displaySize[1]-U[3]/X]}const x=t.left*h,w=t.right*h;let M,A,D,I;i==="width"||i==="both"?(I=l[0]+x-o[3],A=l[0]+w+o[1]):(I=l[0]+(x+w-p.displaySize[0])/2,A=I+p.displaySize[0]);const k=t.top*h,F=t.bottom*h;return i==="height"||i==="both"?(M=l[1]+k-o[0],D=l[1]+F+o[2]):(M=l[1]+(k+F-p.displaySize[1])/2,D=M+p.displaySize[1]),{image:p,top:M,right:A,bottom:D,left:I,collisionPadding:y}}const fs=128,Po=32640;function dl(r,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new _i(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:l}=i;let h=0;for(;h<o.length&&o[h]<=r;)h++;h=Math.max(0,h-1);let p=h;for(;p<o.length&&o[p]<r+1;)p++;p=Math.min(o.length-1,p);const y=o[h],x=o[p];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:l}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new _i(y)),maxSize:i.evaluate(new _i(x)),interpolationType:l}}}function ds(r,t,i){let o="never";const l=r.get(t);return l?o=l:r.get(i)&&(o="always"),o}const of=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sd(r,t,i,o,l,h,p,y,x,w,M,A,D){const I=y?Math.min(Po,Math.round(y[0])):0,k=y?Math.min(Po,Math.round(y[1])):0;r.emplaceBack(t,i,Math.round(32*o),Math.round(32*l),h,p,(I<<1)+(x?1:0),k,16*w,16*M,256*A,256*D)}function Md(r,t,i){r.emplaceBack(t.x,t.y,i),r.emplaceBack(t.x,t.y,i),r.emplaceBack(t.x,t.y,i),r.emplaceBack(t.x,t.y,i)}function Am(r){for(const t of r.sections)if(Yf(t.text))return!0;return!1}class Ed{constructor(t){this.layoutVertexArray=new xt,this.indexArray=new Kt,this.programConfigurations=t,this.segments=new me,this.dynamicLayoutVertexArray=new Dt,this.opacityVertexArray=new Mt,this.hasVisibleVertices=!1,this.placedSymbolArray=new T}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,o,l){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,iu.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,sr.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,of,!0),this.opacityVertexBuffer.itemSize=1),(o||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}le("SymbolBuffers",Ed);class Ad{constructor(t,i,o){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new o,this.segments=new me,this.collisionVertexArray=new Pt}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,nu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}le("CollisionBuffers",Ad);class ih{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(p=>p.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=dl(this.zoom,i["text-size"]),this.iconSizeData=dl(this.zoom,i["icon-size"]);const o=this.layers[0].layout,l=o.get("symbol-sort-key"),h=o.get("symbol-z-order");this.canOverlap=ds(o,"text-overlap","text-allow-overlap")!=="never"||ds(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(p=>P.at[p])),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=t.sourceID}createArrays(){this.text=new Ed(new So(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Ed(new So(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new z,this.lineVertexArray=new B,this.symbolInstances=new C,this.textAnchorOffsets=new N}calculateGlyphDependencies(t,i,o,l,h){for(let p=0;p<t.length;p++)if(i[t.charCodeAt(p)]=!0,(o||l)&&h){const y=Qu[t.charAt(p)];y&&(i[y.charCodeAt(0)]=!0)}}populate(t,i,o){const l=this.layers[0],h=l.layout,p=h.get("text-font"),y=h.get("text-field"),x=h.get("icon-image"),w=(y.value.kind!=="constant"||y.value.value instanceof cn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),M=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,A=h.get("symbol-sort-key");if(this.features=[],!w&&!M)return;const D=i.iconDependencies,I=i.glyphDependencies,k=i.availableImages,F=new _i(this.zoom);for(const{feature:U,id:X,index:st,sourceLayerIndex:Q}of t){const it=l._featureFilter.needGeometry,dt=Ns(U,it);if(!l._featureFilter.filter(F,dt,o))continue;let _t,zt;if(it||(dt.geometry=Fs(U)),w){const Zt=l.getValueAndResolveTokens("text-field",dt,o,k),Wt=cn.factory(Zt),oe=this.hasRTLText=this.hasRTLText||Am(Wt);(!oe||fr.getRTLTextPluginStatus()==="unavailable"||oe&&fr.isParsed())&&(_t=xp(Wt,l,dt))}if(M){const Zt=l.getValueAndResolveTokens("icon-image",dt,o,k);zt=Zt instanceof hn?Zt:hn.fromString(Zt)}if(!_t&&!zt)continue;const $t=this.sortFeaturesByKey?A.evaluate(dt,{},o):void 0;if(this.features.push({id:X,text:_t,icon:zt,index:st,sourceLayerIndex:Q,geometry:dt.geometry,properties:U.properties,type:Zs.types[U.type],sortKey:$t}),zt&&(D[zt.name]=!0),_t){const Zt=p.evaluate(dt,{},o).join(","),Wt=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(P.at.vertical)>=0;for(const oe of _t.sections)if(oe.image)D[oe.image.name]=!0;else{const te=Nc(_t.toString()),ee=oe.fontStack||Zt,Ut=I[ee]=I[ee]||{};this.calculateGlyphDependencies(oe.text,Ut,Wt,this.allowVerticalPlacement,te)}}}h.get("symbol-placement")==="line"&&(this.features=function(U){const X={},st={},Q=[];let it=0;function dt(Zt){Q.push(U[Zt]),it++}function _t(Zt,Wt,oe){const te=st[Zt];return delete st[Zt],st[Wt]=te,Q[te].geometry[0].pop(),Q[te].geometry[0]=Q[te].geometry[0].concat(oe[0]),te}function zt(Zt,Wt,oe){const te=X[Wt];return delete X[Wt],X[Zt]=te,Q[te].geometry[0].shift(),Q[te].geometry[0]=oe[0].concat(Q[te].geometry[0]),te}function $t(Zt,Wt,oe){const te=oe?Wt[0][Wt[0].length-1]:Wt[0][0];return`${Zt}:${te.x}:${te.y}`}for(let Zt=0;Zt<U.length;Zt++){const Wt=U[Zt],oe=Wt.geometry,te=Wt.text?Wt.text.toString():null;if(!te){dt(Zt);continue}const ee=$t(te,oe),Ut=$t(te,oe,!0);if(ee in st&&Ut in X&&st[ee]!==X[Ut]){const Me=zt(ee,Ut,oe),we=_t(ee,Ut,Q[Me].geometry);delete X[ee],delete st[Ut],st[$t(te,Q[we].geometry,!0)]=we,Q[Me].geometry=null}else ee in st?_t(ee,Ut,oe):Ut in X?zt(ee,Ut,oe):(dt(Zt),X[ee]=it-1,st[Ut]=it-1)}return Q.filter(Zt=>Zt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((U,X)=>U.sortKey-X.sortKey)}update(t,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const o=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(i[t.segment+1]),h=t.dist(i[t.segment]);const p={};for(let y=t.segment+1;y<i.length;y++)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:l},y<i.length-1&&(l+=i[y+1].dist(i[y]));for(let y=t.segment||0;y>=0;y--)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:h},y>0&&(h+=i[y-1].dist(i[y]));for(let y=0;y<i.length;y++){const x=p[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,i,o,l,h,p,y,x,w,M,A,D){const I=t.indexArray,k=t.layoutVertexArray,F=t.segments.prepareSegment(4*i.length,k,I,this.canOverlap?p.sortKey:void 0),U=this.glyphOffsetArray.length,X=F.vertexLength,st=this.allowVerticalPlacement&&y===P.at.vertical?Math.PI/2:0,Q=p.text&&p.text.sections;for(let it=0;it<i.length;it++){const{tl:dt,tr:_t,bl:zt,br:$t,tex:Zt,pixelOffsetTL:Wt,pixelOffsetBR:oe,minFontScaleX:te,minFontScaleY:ee,glyphOffset:Ut,isSDF:Me,sectionIndex:we}=i[it],Se=F.vertexLength,de=Ut[1];Sd(k,x.x,x.y,dt.x,de+dt.y,Zt.x,Zt.y,o,Me,Wt.x,Wt.y,te,ee),Sd(k,x.x,x.y,_t.x,de+_t.y,Zt.x+Zt.w,Zt.y,o,Me,oe.x,Wt.y,te,ee),Sd(k,x.x,x.y,zt.x,de+zt.y,Zt.x,Zt.y+Zt.h,o,Me,Wt.x,oe.y,te,ee),Sd(k,x.x,x.y,$t.x,de+$t.y,Zt.x+Zt.w,Zt.y+Zt.h,o,Me,oe.x,oe.y,te,ee),Md(t.dynamicLayoutVertexArray,x,st),I.emplaceBack(Se,Se+2,Se+1),I.emplaceBack(Se+1,Se+2,Se+3),F.vertexLength+=4,F.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ut[0]),it!==i.length-1&&we===i[it+1].sectionIndex||t.programConfigurations.populatePaintArrays(k.length,p,p.index,{imagePositions:{},canonical:D,formattedSection:Q&&Q[we]})}t.placedSymbolArray.emplaceBack(x.x,x.y,U,this.glyphOffsetArray.length-U,X,w,M,x.segment,o?o[0]:0,o?o[1]:0,l[0],l[1],y,0,!1,0,A)}_addCollisionDebugVertex(t,i,o,l,h,p){return i.emplaceBack(0,0),t.emplaceBack(o.x,o.y,l,h,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(t,i,o,l,h,p,y){const x=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),w=x.vertexLength,M=h.layoutVertexArray,A=h.collisionVertexArray,D=y.anchorX,I=y.anchorY;this._addCollisionDebugVertex(M,A,p,D,I,new wt(t,i)),this._addCollisionDebugVertex(M,A,p,D,I,new wt(o,i)),this._addCollisionDebugVertex(M,A,p,D,I,new wt(o,l)),this._addCollisionDebugVertex(M,A,p,D,I,new wt(t,l)),x.vertexLength+=4;const k=h.indexArray;k.emplaceBack(w,w+1),k.emplaceBack(w+1,w+2),k.emplaceBack(w+2,w+3),k.emplaceBack(w+3,w),x.primitiveLength+=4}addDebugCollisionBoxes(t,i,o,l){for(let h=t;h<i;h++){const p=this.collisionBoxArray.get(h);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,l?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ad(Et,Ku.members,Jt),this.iconCollisionBox=new Ad(Et,Ku.members,Jt);for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(t,i,o,l,h,p,y,x,w){const M={};for(let A=i;A<o;A++){const D=t.get(A);M.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},M.textFeatureIndex=D.featureIndex;break}for(let A=l;A<h;A++){const D=t.get(A);M.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},M.verticalTextFeatureIndex=D.featureIndex;break}for(let A=p;A<y;A++){const D=t.get(A);M.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},M.iconFeatureIndex=D.featureIndex;break}for(let A=x;A<w;A++){const D=t.get(A);M.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},M.verticalIconFeatureIndex=D.featureIndex;break}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const o=t.placedSymbolArray.get(i),l=o.vertexStartIndex+4*o.numGlyphs;for(let h=o.vertexStartIndex;h<l;h+=4)t.indexArray.emplaceBack(h,h+2,h+1),t.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),o=Math.cos(t),l=[],h=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const x=this.symbolInstances.get(y);l.push(0|Math.round(i*x.anchorX+o*x.anchorY)),h.push(x.featureIndex)}return p.sort((y,x)=>l[y]-l[x]||h[x]-h[y]),p}addToSortKeyRanges(t,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((l,h,p)=>{l>=0&&p.indexOf(l)===h&&this.addIndicesForPlacedSymbol(this.text,l)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Cd,zp;le("SymbolBucket",ih,{omit:["layers","collisionBoxArray","features","compareText"]}),ih.MAX_GLYPHS=65535,ih.addDynamicAttributes=Md;var zd={get paint(){return zp=zp||new ir({"icon-opacity":new _e(tt.paint_symbol["icon-opacity"]),"icon-color":new _e(tt.paint_symbol["icon-color"]),"icon-halo-color":new _e(tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new _e(tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new _e(tt.paint_symbol["icon-halo-blur"]),"icon-translate":new pe(tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new pe(tt.paint_symbol["icon-translate-anchor"]),"text-opacity":new _e(tt.paint_symbol["text-opacity"]),"text-color":new _e(tt.paint_symbol["text-color"],{runtimeType:cr,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new _e(tt.paint_symbol["text-halo-color"]),"text-halo-width":new _e(tt.paint_symbol["text-halo-width"]),"text-halo-blur":new _e(tt.paint_symbol["text-halo-blur"]),"text-translate":new pe(tt.paint_symbol["text-translate"]),"text-translate-anchor":new pe(tt.paint_symbol["text-translate-anchor"])})},get layout(){return Cd=Cd||new ir({"symbol-placement":new pe(tt.layout_symbol["symbol-placement"]),"symbol-spacing":new pe(tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pe(tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new _e(tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pe(tt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new pe(tt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new pe(tt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new pe(tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new pe(tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pe(tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new _e(tt.layout_symbol["icon-size"]),"icon-text-fit":new pe(tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pe(tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new _e(tt.layout_symbol["icon-image"]),"icon-rotate":new _e(tt.layout_symbol["icon-rotate"]),"icon-padding":new _e(tt.layout_symbol["icon-padding"]),"icon-keep-upright":new pe(tt.layout_symbol["icon-keep-upright"]),"icon-offset":new _e(tt.layout_symbol["icon-offset"]),"icon-anchor":new _e(tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pe(tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pe(tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pe(tt.layout_symbol["text-rotation-alignment"]),"text-field":new _e(tt.layout_symbol["text-field"]),"text-font":new _e(tt.layout_symbol["text-font"]),"text-size":new _e(tt.layout_symbol["text-size"]),"text-max-width":new _e(tt.layout_symbol["text-max-width"]),"text-line-height":new pe(tt.layout_symbol["text-line-height"]),"text-letter-spacing":new _e(tt.layout_symbol["text-letter-spacing"]),"text-justify":new _e(tt.layout_symbol["text-justify"]),"text-radial-offset":new _e(tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pe(tt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new _e(tt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new _e(tt.layout_symbol["text-anchor"]),"text-max-angle":new pe(tt.layout_symbol["text-max-angle"]),"text-writing-mode":new pe(tt.layout_symbol["text-writing-mode"]),"text-rotate":new _e(tt.layout_symbol["text-rotate"]),"text-padding":new pe(tt.layout_symbol["text-padding"]),"text-keep-upright":new pe(tt.layout_symbol["text-keep-upright"]),"text-transform":new _e(tt.layout_symbol["text-transform"]),"text-offset":new _e(tt.layout_symbol["text-offset"]),"text-allow-overlap":new pe(tt.layout_symbol["text-allow-overlap"]),"text-overlap":new pe(tt.layout_symbol["text-overlap"]),"text-ignore-placement":new pe(tt.layout_symbol["text-ignore-placement"]),"text-optional":new pe(tt.layout_symbol["text-optional"])})}};class Cm{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:ui,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}le("FormatSectionOverride",Cm,{omit:["defaultValue"]});class nh extends an{constructor(t,i){super(t,zd,i)}recalculate(t,i){if(super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const l=[];for(const h of o)l.indexOf(h)<0&&l.push(h);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,i,o,l){const h=this.layout.get(t).evaluate(i,{},o,l),p=this._unevaluatedLayout._values[t];return p.isDataDriven()||zu(p.value)||!h?h:function(y,x){return x.replace(/{([^{}]+)}/g,(w,M)=>y&&M in y?String(y[M]):"")}(i.properties,h)}createBucket(t){return new ih(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of zd.paint.overridableProperties){if(!nh.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),o=new Cm(i),l=new Ul(o,i.property.specification);let h=null;h=i.value.kind==="constant"||i.value.kind==="source"?new co("source",l):new Ar("composite",l,i.value.zoomStops),this.paint._values[t]=new zr(i.property,h,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&nh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const o=t.get("text-field"),l=zd.paint.properties[i];let h=!1;const p=y=>{for(const x of y)if(l.overrides&&l.overrides.hasOverride(x))return void(h=!0)};if(o.value.kind==="constant"&&o.value.value instanceof cn)p(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const y=w=>{h||(w instanceof vs&&Ri(w.value)===eo?p(w.value.sections):w instanceof jo?p(w.sections):w.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return h}}let Dd;var ig={get paint(){return Dd=Dd||new ir({"background-color":new pe(tt.paint_background["background-color"]),"background-pattern":new Nu(tt.paint_background["background-pattern"]),"background-opacity":new pe(tt.paint_background["background-opacity"])})}};class ng extends an{constructor(t,i){super(t,ig,i)}}class lf extends an{constructor(t,i){super(t,{},i),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class rg{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const zm={once:!0},Je=63710088e-1;class Io{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Io(Ue(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,o=this.lat*i,l=t.lat*i,h=Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos((t.lng-this.lng)*i);return Je*Math.acos(Math.min(h,1))}static convert(t){if(t instanceof Io)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Io(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Io(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const uf=2*Math.PI*Je;function Pd(r){return uf*Math.cos(r*Math.PI/180)}function Dp(r){return(180+r)/360}function Id(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function rh(r,t){return r/Pd(t)}function cf(r){return 360*r-180}function Rd(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Pp(r,t){return r*Pd(Rd(t))}class hf{constructor(t,i,o=0){this.x=+t,this.y=+i,this.z=+o}static fromLngLat(t,i=0){const o=Io.convert(t);return new hf(Dp(o.lng),Id(o.lat),rh(i,o.lat))}toLngLat(){return new Io(cf(this.x),Rd(this.y))}toAltitude(){return Pp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/uf*(t=Rd(this.y),1/Math.cos(t*Math.PI/180));var t}}function Dm(r,t,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[r*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class Ld{constructor(t,i,o){if(!function(l,h,p){return!(l<0||l>25||p<0||p>=Math.pow(2,l)||h<0||h>=Math.pow(2,l))}(t,i,o))throw new Error(`x=${i}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=i,this.y=o,this.key=au(0,t,t,i,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i,o){const l=(p=this.y,y=this.z,x=Dm(256*(h=this.x),256*(p=Math.pow(2,y)-p-1),y),w=Dm(256*(h+1),256*(p+1),y),x[0]+","+x[1]+","+w[0]+","+w[1]);var h,p,y,x,w;const M=function(A,D,I){let k,F="";for(let U=A;U>0;U--)k=1<<U-1,F+=(D&k?1:0)+(I&k?2:0);return F}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,M).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){const i=this.z-t.z;return i>0&&t.x===this.x>>i&&t.y===this.y>>i}getTilePoint(t){const i=Math.pow(2,this.z);return new wt((t.x*i-this.x)*ge,(t.y*i-this.y)*ge)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ip{constructor(t,i){this.wrap=t,this.canonical=i,this.key=au(t,i.z,i.z,i.x,i.y)}}class We{constructor(t,i,o,l,h){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=i,this.canonical=new Ld(o,+l,+h),this.key=au(i,t,o,l,h)}clone(){return new We(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-t;return t>this.canonical.z?new We(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new We(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(t,i){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?au(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y):au(this.wrap*+i,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap||this.overscaledZ-t.overscaledZ<=0)return!1;if(t.overscaledZ===0)return this.overscaledZ>0;const i=this.canonical.z-t.canonical.z;return!(i<0)&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new We(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,l=2*this.canonical.y;return[new We(i,this.wrap,i,o,l),new We(i,this.wrap,i,o+1,l),new We(i,this.wrap,i,o,l+1),new We(i,this.wrap,i,o+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new We(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new We(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ip(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new hf(t.x-this.wrap,t.y))}}function au(r,t,i,o,l){(r*=2)<0&&(r=-1*r-1);const h=1<<i;return(h*h*r+h*l+o).toString(36)+i.toString(36)+t.toString(36)}function Un(r,t){return t?r.properties[t]:r.id}le("CanonicalTileID",Ld),le("OverscaledTileID",We,{omit:["terrainRttPosMatrix32f"]});class ic{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const i=new ic;return i.extend(t(new wt(this.minX,this.minY))),i.extend(t(new wt(this.maxX,this.minY))),i.extend(t(new wt(this.minX,this.maxY))),i.extend(t(new wt(this.maxX,this.maxY))),i}static fromPoints(t){const i=new ic;for(const o of t)i.extend(o);return i}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class Rp{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const o=t[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Pm{constructor(t,i,o,l,h){this.type="Feature",this._vectorTileFeature=t,t._z=i,t._x=o,t._y=l,this.properties=t.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(t[i]=this[i]);return t}}class su{_name;dataBuffer;nullabilityBuffer;_size;constructor(t,i,o){this._name=t,this.dataBuffer=i,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(t){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(t)?null:this.getValueFromBuffer(t)}has(t){return this.nullabilityBuffer&&this.nullabilityBuffer.get(t)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class ah extends su{}class sh extends ah{getValueFromBuffer(t){return this.dataBuffer[t]}}class kd extends ah{getValueFromBuffer(t){return this.dataBuffer[t]}}class Lp extends su{delta;constructor(t,i,o,l){super(t,i,l),this.delta=o}}class ff extends Lp{constructor(t,i,o,l){super(t,Int32Array.of(i),o,l)}getValueFromBuffer(t){return this.dataBuffer[0]+t*this.delta}}class df extends su{constructor(t,i,o){super(t,Int32Array.of(i),o)}getValueFromBuffer(t){return this.dataBuffer[0]}}class ag{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(t,i,o,l,h=4096){this._name=t,this._geometryVector=i,this._idVector=o,this._propertyVectors=l,this._extent=h}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(t){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map(i=>[i.name,i]))),this.propertyVectorsMap.get(t)}*[Symbol.iterator](){const t=this.geometryVector[Symbol.iterator]();let i=0;for(;i<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));const l=t?.next().value,h={};for(const p of this.propertyVectors){if(!p)continue;const y=p.name,x=p.getValue(i);x!==null&&(h[y]=x)}i++,yield{id:o,geometry:l,properties:h}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const t=[],i=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const h={coordinates:i[o],type:this.geometryVector.geometryType(o)},p={};for(const y of this.propertyVectors){if(!y)continue;const x=y.name,w=y.getValue(o);w!==null&&(p[x]=w)}t.push({id:l,geometry:h,properties:p})}return t}containsMaxSaveIntegerValues(t){return t instanceof sh||t instanceof df&&t instanceof ff||t instanceof kd}}class Im{value;constructor(t){this.value=t}get(){return this.value}set(t){this.value=t}increment(){return this.value++}add(t){this.value+=t}}var pr,qe,pl,Hs,ma,aa,jn,Rn,Rm,ka;(function(r){r.PRESENT="PRESENT",r.DATA="DATA",r.OFFSET="OFFSET",r.LENGTH="LENGTH"})(pr||(pr={}));class Bd{_dictionaryType;_offsetType;_lengthType;constructor(t,i,o){this._dictionaryType=t,this._offsetType=i,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Tn(r,t,i){const o=new Int32Array(i);let l=0,h=t.get();for(let p=0;p<o.length;p++){let y=r[h++],x=127&y;y<128||(y=r[h++],x|=(127&y)<<7,y<128||(y=r[h++],x|=(127&y)<<14,y<128||(y=r[h++],x|=(127&y)<<21,y<128||(y=r[h++],x|=(15&y)<<28)))),o[l++]=x}return t.set(h),o}function oh(r,t,i){const o=new BigInt64Array(i);for(let l=0;l<o.length;l++)o[l]=Lm(r,t);return o}function sg(r,t){let i,o;return o=r[t.get()],t.increment(),i=127&o,o<128?i:(o=r[t.get()],t.increment(),i|=(127&o)<<7,o<128?i:(o=r[t.get()],t.increment(),i|=(127&o)<<14,o<128?i:(o=r[t.get()],t.increment(),i|=(127&o)<<21,o<128?i:(o=r[t.get()],i|=(15&o)<<28,function(l,h,p){let y,x;if(x=h[p.get()],p.increment(),y=(112&x)>>4,x<128||(x=h[p.get()],p.increment(),y|=(127&x)<<3,x<128)||(x=h[p.get()],p.increment(),y|=(127&x)<<10,x<128)||(x=h[p.get()],p.increment(),y|=(127&x)<<17,x<128)||(x=h[p.get()],p.increment(),y|=(127&x)<<24,x<128)||(x=h[p.get()],p.increment(),y|=(1&x)<<31,x<128))return 4294967296*y+(l>>>0);throw new Error("Expected varint not more than 10 bytes")}(i,r,t)))))}function Ba(r,t,i,o){throw new Error("FastPFor is not implemented yet.")}function ml(r){return r>>>1^-(1&r)}function nc(r){return r>>1n^-(1n&r)}function Lm(r,t){let i=0n,o=0,l=t.get();for(;l<r.length;){const h=r[l++];if(i|=BigInt(127&h)<<BigInt(o),!(128&h))break;if(o+=7,o>=64)throw new Error("Varint too long")}return t.set(l),i}function kp(r,t,i){const o=new Int32Array(i);let l=0;for(let h=0;h<t;h++){const p=r[h];o.fill(r[h+t],l,l+p),l+=p}return o}function lh(r,t,i){const o=new BigInt64Array(i);let l=0;for(let h=0;h<t;h++){const p=Number(r[h]);o.fill(r[h+t],l,l+p),l+=p}return o}function Oa(r,t,i){const o=new Float64Array(i);let l=0;for(let h=0;h<t;h++){const p=r[h];o.fill(r[h+t],l,l+p),l+=p}return o}function Od(r){const t=r.length/4*4;let i=1;if(t>=4)for(let o=r[0];i<t-4;i+=4)o=r[i]+=o,o=r[i+1]+=o,o=r[i+2]+=o,o=r[i+3]+=o;for(;i!=r.length;)r[i]+=r[i-1],++i}function pf(r){r[0]=r[0]>>>1^-(1&r[0]),r[1]=r[1]>>>1^-(1&r[1]);const t=r.length/4*4;let i=2;if(t>=4)for(;i<t-4;i+=4){const o=r[i],l=r[i+1],h=r[i+2],p=r[i+3];r[i]=(o>>>1^-(1&o))+r[i-2],r[i+1]=(l>>>1^-(1&l))+r[i-1],r[i+2]=(h>>>1^-(1&h))+r[i],r[i+3]=(p>>>1^-(1&p))+r[i+1]}for(;i!=r.length;i+=2)r[i]=(r[i]>>>1^-(1&r[i]))+r[i-2],r[i+1]=(r[i+1]>>>1^-(1&r[i+1]))+r[i-1]}function Xr(r,t,i){return Math.min(i,Math.max(t,r))}(function(r){r.NONE="NONE",r.DELTA="DELTA",r.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",r.RLE="RLE",r.MORTON="MORTON",r.PDE="PDE"})(qe||(qe={})),function(r){r.NONE="NONE",r.FAST_PFOR="FAST_PFOR",r.VARINT="VARINT",r.ALP="ALP"}(pl||(pl={})),function(r){r.NONE="NONE",r.SINGLE="SINGLE",r.SHARED="SHARED",r.VERTEX="VERTEX",r.MORTON="MORTON",r.FSST="FSST"}(Hs||(Hs={})),function(r){r.VERTEX="VERTEX",r.INDEX="INDEX",r.STRING="STRING",r.KEY="KEY"}(ma||(ma={})),function(r){r.VAR_BINARY="VAR_BINARY",r.GEOMETRIES="GEOMETRIES",r.PARTS="PARTS",r.RINGS="RINGS",r.TRIANGLES="TRIANGLES",r.SYMBOL="SYMBOL",r.DICTIONARY="DICTIONARY"}(aa||(aa={}));class rc{_physicalStreamType;_logicalStreamType;_logicalLevelTechnique1;_logicalLevelTechnique2;_physicalLevelTechnique;_numValues;_byteLength;constructor(t,i,o,l,h,p,y){this._physicalStreamType=t,this._logicalStreamType=i,this._logicalLevelTechnique1=o,this._logicalLevelTechnique2=l,this._physicalLevelTechnique=h,this._numValues=p,this._byteLength=y}static decode(t,i){const o=t[i.get()],l=Object.values(pr)[o>>4];let h=null;switch(l){case pr.DATA:h=new Bd(Object.values(Hs)[15&o]);break;case pr.OFFSET:h=new Bd(null,Object.values(ma)[15&o]);break;case pr.LENGTH:h=new Bd(null,null,Object.values(aa)[15&o])}i.increment();const p=t[i.get()],y=Object.values(qe)[p>>5],x=Object.values(qe)[p>>2&7],w=Object.values(pl)[3&p];i.increment();const M=Tn(t,i,2);return new rc(l,h,y,x,w,M[0],M[1])}get physicalStreamType(){return this._physicalStreamType}get logicalStreamType(){return this._logicalStreamType}get logicalLevelTechnique1(){return this._logicalLevelTechnique1}get logicalLevelTechnique2(){return this._logicalLevelTechnique2}get physicalLevelTechnique(){return this._physicalLevelTechnique}get numValues(){return this._numValues}get byteLength(){return this._byteLength}getDecompressedCount(){return this._numValues}}class Fd extends rc{num_bits;coordinate_shift;constructor(t,i,o,l,h,p,y,x,w){super(t,i,o,l,h,p,y),this.num_bits=x,this.coordinate_shift=w}static decode(t,i){const o=rc.decode(t,i),l=Tn(t,i,2);return new Fd(o.physicalStreamType,o.logicalStreamType,o.logicalLevelTechnique1,o.logicalLevelTechnique2,o.physicalLevelTechnique,o.numValues,o.byteLength,l[0],l[1])}static decodePartial(t,i,o){const l=Tn(i,o,2);return new Fd(t.physicalStreamType,t.logicalStreamType,t.logicalLevelTechnique1,t.logicalLevelTechnique2,t.physicalLevelTechnique,t.numValues,t.byteLength,l[0],l[1])}numBits(){return this.num_bits}coordinateShift(){return this.coordinate_shift}}class Ro extends rc{_runs;_numRleValues;constructor(t,i,o,l,h,p,y,x,w){super(t,i,o,l,h,p,y),this._runs=x,this._numRleValues=w}static decode(t,i){const o=rc.decode(t,i),l=Tn(t,i,2);return new Ro(o.physicalStreamType,o.logicalStreamType,o.logicalLevelTechnique1,o.logicalLevelTechnique2,o.physicalLevelTechnique,o.numValues,o.byteLength,l[0],l[1])}static decodePartial(t,i,o){const l=Tn(i,o,2);return new Ro(t.physicalStreamType,t.logicalStreamType,t.logicalLevelTechnique1,t.logicalLevelTechnique2,t.physicalLevelTechnique,t.numValues,t.byteLength,l[0],l[1])}get runs(){return this._runs}get numRleValues(){return this._numRleValues}getDecompressedCount(){return this._numRleValues}}class mr{static decode(t,i){const o=rc.decode(t,i);return o.logicalLevelTechnique1===qe.MORTON?Fd.decodePartial(o,t,i):qe.RLE!==o.logicalLevelTechnique1&&qe.RLE!==o.logicalLevelTechnique2||pl.NONE===o.physicalLevelTechnique?o:Ro.decodePartial(o,t,i)}}(function(r){r[r.FLAT=0]="FLAT",r[r.CONST=1]="CONST",r[r.SEQUENCE=2]="SEQUENCE",r[r.DICTIONARY=3]="DICTIONARY",r[r.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(jn||(jn={}));class Xs{values;_size;constructor(t,i){this.values=t,this._size=i}get(t){const i=Math.floor(t/8);return(this.values[i]>>t%8&1)==1}set(t,i){const o=Math.floor(t/8);this.values[o]=this.values[o]|(i?1:0)<<t%8}getInt(t){const i=Math.floor(t/8);return this.values[i]>>t%8&1}size(){return this._size}getBuffer(){return this.values}}class Oe{constructor(){}static decodeIntStream(t,i,o,l,h){const p=Oe.decodePhysicalLevelTechnique(t,i,o);return this.decodeIntBuffer(p,o,l,h)}static decodeLengthStreamToOffsetBuffer(t,i,o){const l=Oe.decodePhysicalLevelTechnique(t,i,o);return this.decodeLengthToOffsetBuffer(l,o)}static decodePhysicalLevelTechnique(t,i,o){const l=o.physicalLevelTechnique;if(l===pl.FAST_PFOR)return Ba();if(l===pl.VARINT)return Tn(t,i,o.numValues);if(l===pl.NONE){const h=i.get();i.add(o.byteLength);const p=t.subarray(h,i.get());return new Int32Array(p)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}static decodeConstIntStream(t,i,o,l){const h=Oe.decodePhysicalLevelTechnique(t,i,o);if(h.length===1){const p=h[0];return l?ml(p):p}return l?function(p){return ml(p[1])}(h):function(p){return p[1]}(h)}static decodeSequenceIntStream(t,i,o){return function(l){if(l.length==2){const h=ml(l[1]);return[h,h]}return[ml(l[2]),ml(l[3])]}(Oe.decodePhysicalLevelTechnique(t,i,o))}static decodeSequenceLongStream(t,i,o){return function(l){if(l.length==2){const h=nc(l[1]);return[h,h]}return[nc(l[2]),nc(l[3])]}(oh(t,i,o.numValues))}static decodeLongStream(t,i,o,l){const h=oh(t,i,o.numValues);return this.decodeLongBuffer(h,o,l)}static decodeLongFloat64Stream(t,i,o,l){const h=function(p,y,x){const w=new Float64Array(y);for(let M=0;M<y;M++)w[M]=sg(p,x);return w}(t,o.numValues,i);return this.decodeFloat64Buffer(h,o,l)}static decodeConstLongStream(t,i,o,l){const h=oh(t,i,o.numValues);if(h.length===1){const p=h[0];return l?nc(p):p}return l?function(p){return nc(p[1])}(h):function(p){return p[1]}(h)}static decodeIntBuffer(t,i,o,l){switch(i.logicalLevelTechnique1){case qe.DELTA:return i.logicalLevelTechnique2===qe.RLE?function(h,p,y){const x=new Int32Array(y);let w=0,M=0;for(let A=0;A<p;A++){const D=h[A],I=ml(h[A+p]);for(let k=0;k<D;k++)M+=I,x[w++]=M}return x}(t,i.runs,i.numRleValues):(function(h){h[0]=h[0]>>>1^-(1&h[0]);const p=h.length/4*4;let y=1;if(p>=4)for(;y<p-4;y+=4){const x=h[y],w=h[y+1],M=h[y+2],A=h[y+3];h[y]=(x>>>1^-(1&x))+h[y-1],h[y+1]=(w>>>1^-(1&w))+h[y],h[y+2]=(M>>>1^-(1&M))+h[y+1],h[y+3]=(A>>>1^-(1&A))+h[y+2]}for(;y!=h.length;++y)h[y]=(h[y]>>>1^-(1&h[y]))+h[y-1]}(t),t);case qe.RLE:return function(h,p,y){return y?function(x,w,M){const A=new Int32Array(M);let D=0;for(let I=0;I<w;I++){const k=x[I];let F=x[I+w];F=F>>>1^-(1&F),A.fill(F,D,D+k),D+=k}return A}(h,p.runs,p.numRleValues):kp(h,p.runs,p.numRleValues)}(t,i,o);case qe.MORTON:return Od(t),t;case qe.COMPONENTWISE_DELTA:return l?(function(h,p,y,x){let w=h[0]>>>1^-(1&h[0]),M=h[1]>>>1^-(1&h[1]);h[0]=Xr(Math.round(w*p),y,x),h[1]=Xr(Math.round(M*p),y,x);const A=h.length/16;let D=2;if(A>=4)for(;D<A-4;D+=4){const I=h[D],k=h[D+1],F=(I>>>1^-(1&I))+w,U=(k>>>1^-(1&k))+M;h[D]=Xr(Math.round(F*p),y,x),h[D+1]=Xr(Math.round(U*p),y,x);const X=h[D+2],st=h[D+3];w=(X>>>1^-(1&X))+F,M=(st>>>1^-(1&st))+U,h[D+2]=Xr(Math.round(w*p),y,x),h[D+3]=Xr(Math.round(M*p),y,x)}for(;D!=h.length;D+=2)w+=h[D]>>>1^-(1&h[D]),M+=h[D+1]>>>1^-(1&h[D+1]),h[D]=Xr(Math.round(w*p),y,x),h[D+1]=Xr(Math.round(M*p),y,x)}(t,l.scale,l.min,l.max),t):(pf(t),t);case qe.NONE:return o&&function(h){for(let p=0;p<h.length;p++){const y=h[p];h[p]=y>>>1^-(1&y)}}(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${i.logicalLevelTechnique1}`)}}static decodeLongBuffer(t,i,o){switch(i.logicalLevelTechnique1){case qe.DELTA:return i.logicalLevelTechnique2===qe.RLE?function(l,h,p){const y=new BigInt64Array(p);let x=0,w=0n;for(let M=0;M<h;M++){const A=Number(l[M]),D=nc(l[M+h]);for(let I=0;I<A;I++)w+=D,y[x++]=w}return y}(t,i.runs,i.numRleValues):(function(l){l[0]=l[0]>>1n^-(1n&l[0]);const h=l.length/4*4;let p=1;if(h>=4)for(;p<h-4;p+=4){const y=l[p],x=l[p+1],w=l[p+2],M=l[p+3];l[p]=(y>>1n^-(1n&y))+l[p-1],l[p+1]=(x>>1n^-(1n&x))+l[p],l[p+2]=(w>>1n^-(1n&w))+l[p+1],l[p+3]=(M>>1n^-(1n&M))+l[p+2]}for(;p!=l.length;++p)l[p]=(l[p]>>1n^-(1n&l[p]))+l[p-1]}(t),t);case qe.RLE:return function(l,h,p){return p?function(y,x,w){const M=new BigInt64Array(w);let A=0;for(let D=0;D<x;D++){const I=Number(y[D]);let k=y[D+x];k=k>>1n^-(1n&k),M.fill(k,A,A+I),A+=I}return M}(l,h.runs,h.numRleValues):lh(l,h.runs,h.numRleValues)}(t,i,o);case qe.NONE:return o&&function(l){for(let h=0;h<l.length;h++){const p=l[h];l[h]=p>>1n^-(1n&p)}}(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${i.logicalLevelTechnique1}`)}}static decodeFloat64Buffer(t,i,o){switch(i.logicalLevelTechnique1){case qe.DELTA:return i.logicalLevelTechnique2===qe.RLE&&(t=Oa(t,i.runs,i.numRleValues)),function(l){l[0]=l[0]%2==1?(l[0]+1)/-2:l[0]/2;const h=l.length/4*4;let p=1;if(h>=4)for(;p<h-4;p+=4){const y=l[p],x=l[p+1],w=l[p+2],M=l[p+3];l[p]=(y%2==1?(y+1)/-2:y/2)+l[p-1],l[p+1]=(x%2==1?(x+1)/-2:x/2)+l[p],l[p+2]=(w%2==1?(w+1)/-2:w/2)+l[p+1],l[p+3]=(M%2==1?(M+1)/-2:M/2)+l[p+2]}for(;p!=l.length;++p)l[p]=(l[p]%2==1?(l[p]+1)/-2:l[p]/2)+l[p-1]}(t),t;case qe.RLE:return function(l,h,p){return p?function(y,x,w){const M=new Float64Array(w);let A=0;for(let D=0;D<x;D++){const I=y[D];let k=y[D+x];k=k%2==1?(k+1)/-2:k/2,M.fill(k,A,A+I),A+=I}return M}(l,h.runs,h.numRleValues):Oa(l,h.runs,h.numRleValues)}(t,i,o);case qe.NONE:return o&&function(l){for(let h=0;h<l.length;h++){const p=l[h];l[h]=p%2==1?(p+1)/-2:p/2}}(t),t;default:throw new Error(`The specified Logical level technique is not supported: ${i.logicalLevelTechnique1}`)}}static decodeLengthToOffsetBuffer(t,i){if(i.logicalLevelTechnique1===qe.DELTA&&i.logicalLevelTechnique2===qe.NONE)return function(o){const l=new Int32Array(o.length+1);l[0]=0,l[1]=ml(o[0]);let h=l[1],p=2;for(;p!=l.length;++p){const y=o[p-1];h+=y>>>1^-(1&y),l[p]=l[p-1]+h}return l}(t);if(i.logicalLevelTechnique1===qe.RLE&&i.logicalLevelTechnique2===qe.NONE)return function(o,l,h){const p=new Int32Array(h+1);p[0]=0;let y=1,x=p[0];for(let w=0;w<l;w++){const M=o[w],A=o[w+l];for(let D=y;D<y+M;D++)p[D]=A+x,x=p[D];y+=M}return p}(t,i.runs,i.numRleValues);if(i.logicalLevelTechnique1===qe.NONE&&i.logicalLevelTechnique2===qe.NONE){(function(l){let h=0;for(let p=0;p<l.length;p++)l[p]+=h,h=l[p]})(t);const o=new Int32Array(i.numValues+1);return o[0]=0,o.set(t,1),o}if(i.logicalLevelTechnique1===qe.DELTA&&i.logicalLevelTechnique2===qe.RLE){const o=function(l,h,p){const y=new Int32Array(p+1);y[0]=0;let x=1,w=y[0];for(let M=0;M<h;M++){const A=l[M];let D=l[M+h];D=D>>>1^-(1&D);for(let I=x;I<x+A;I++)y[I]=D+w,w=y[I];x+=A}return y}(t,i.runs,i.numRleValues);return Od(o),o}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}static decodeNullableIntStream(t,i,o,l,h){const p=o.physicalLevelTechnique===pl.FAST_PFOR?Ba():Tn(t,i,o.numValues);return this.decodeNullableIntBuffer(p,o,l,h)}static decodeNullableLongStream(t,i,o,l,h){const p=oh(t,i,o.numValues);return this.decodeNullableLongBuffer(p,o,l,h)}static decodeNullableIntBuffer(t,i,o,l){switch(i.logicalLevelTechnique1){case qe.DELTA:return i.logicalLevelTechnique2===qe.RLE&&(t=kp(t,i.runs,i.numRleValues)),function(h,p){const y=new Int32Array(h.size());let x=0;h.get(0)?(y[0]=h.get(0)?p[0]>>>1^-(1&p[0]):0,x=1):y[0]=0;let w=1;for(;w!=y.length;++w)y[w]=h.get(w)?y[w-1]+(p[x]>>>1^-(1&p[x++])):y[w-1];return y}(l,t);case qe.RLE:return function(h,p,y,x){const w=p;return y?function(M,A,D){const I=new Int32Array(M.size());let k=0;for(let F=0;F<D;F++){const U=A[F];let X=A[F+D];X=X>>>1^-(1&X);for(let st=k;st<k+U;st++)M.get(st)?I[st]=X:(I[st]=0,k++);k+=U}return I}(x,h,w.runs):function(M,A,D){const I=new Int32Array(M.size());let k=0;for(let F=0;F<D;F++){const U=A[F],X=A[F+D];for(let st=k;st<k+U;st++)M.get(st)?I[st]=X:(I[st]=0,k++);k+=U}return I}(x,h,w.runs)}(t,i,o,l);case qe.MORTON:return Od(t),t;case qe.COMPONENTWISE_DELTA:return pf(t),t;case qe.NONE:return t=o?function(h,p){const y=new Int32Array(h.size());let x=0,w=0;for(;w!=y.length;++w)if(h.get(w)){const M=p[x++];y[w]=M>>>1^-(1&M)}else y[w]=0;return y}(l,t):function(h,p){const y=new Int32Array(h.size());let x=0,w=0;for(;w!=y.length;++w)y[w]=h.get(w)?p[x++]:0;return y}(l,t),t;default:throw new Error("The specified Logical level technique is not supported")}}static decodeNullableLongBuffer(t,i,o,l){switch(i.logicalLevelTechnique1){case qe.DELTA:return i.logicalLevelTechnique2===qe.RLE&&(t=lh(t,i.runs,i.numRleValues)),function(h,p){const y=new BigInt64Array(h.size());let x=0;h.get(0)?(y[0]=h.get(0)?p[0]>>1n^-(1n&p[0]):0n,x=1):y[0]=0n;let w=1;for(;w!=y.length;++w)y[w]=h.get(w)?y[w-1]+(p[x]>>1n^-(1n&p[x++])):y[w-1];return y}(l,t);case qe.RLE:return function(h,p,y,x){const w=p;return y?function(M,A,D){const I=new BigInt64Array(M.size());let k=0;for(let F=0;F<D;F++){const U=Number(A[F]);let X=A[F+D];X=X>>1n^-(1n&X);for(let st=k;st<k+U;st++)M.get(st)?I[st]=X:(I[st]=0n,k++);k+=U}return I}(x,h,w.runs):function(M,A,D){const I=new BigInt64Array(M.size());let k=0;for(let F=0;F<D;F++){const U=Number(A[F]),X=A[F+D];for(let st=k;st<k+U;st++)M.get(st)?I[st]=X:(I[st]=0n,k++);k+=U}return I}(x,h,w.runs)}(t,i,o,l);case qe.NONE:return t=o?function(h,p){const y=new BigInt64Array(h.size());let x=0,w=0;for(;w!=y.length;++w)if(h.get(w)){const M=p[x++];y[w]=M>>1n^-(1n&M)}else y[w]=0n;return y}(l,t):function(h,p){const y=new BigInt64Array(h.size());let x=0,w=0;for(;w!=y.length;++w)y[w]=h.get(w)?p[x++]:0n;return y}(l,t),t;default:throw new Error("The specified Logical level technique is not supported")}}static getVectorType(t,i,o,l){const h=t.logicalLevelTechnique1;if(h===qe.RLE)return t.runs===1?jn.CONST:jn.FLAT;const p=i instanceof Xs?i.size():i;if(h===qe.DELTA&&t.logicalLevelTechnique2===qe.RLE){const y=t.runs,x=2;if(t.numRleValues!==p)return jn.FLAT;if(y===1)return jn.SEQUENCE;if(y===2){const w=l.get();let M;if(t.physicalLevelTechnique===pl.VARINT)M=Tn(o,l,4);else{const A=l.get();M=new Int32Array(o.buffer,o.byteOffset+A,4)}if(l.set(w),M[2]===x&&M[3]===x)return jn.SEQUENCE}}return t.numValues===1?jn.CONST:jn.FLAT}}class km extends ah{getValueFromBuffer(t){return this.dataBuffer[t]}}class Bm extends Lp{constructor(t,i,o,l){super(t,BigInt64Array.of(i),o,l)}getValueFromBuffer(t){return this.dataBuffer[0]+BigInt(t)*this.delta}}class uh{_geometryOffsets;_partOffsets;_ringOffsets;constructor(t,i,o){this._geometryOffsets=t,this._partOffsets=i,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}class og{tileExtent;_numBits;_coordinateShift;minBound;maxBound;constructor(t,i){this._coordinateShift=t<0?Math.abs(t):0,this.tileExtent=i+this._coordinateShift,this._numBits=Math.ceil(Math.log2(this.tileExtent)),this.minBound=t,this.maxBound=i}validateCoordinates(t){if(t.x<this.minBound||t.y<this.minBound||t.x>this.maxBound||t.y>this.maxBound)throw new Error("The specified tile buffer size is currently not supported.")}numBits(){return this._numBits}coordinateShift(){return this._coordinateShift}}class ch extends og{encode(t){this.validateCoordinates(t);const i=t.x+this._coordinateShift,o=t.y+this._coordinateShift;let l=0;for(let h=0;h<this._numBits;h++)l|=(i&1<<h)<<h|(o&1<<h)<<h+1;return l}decode(t){return{x:this.decodeMorton(t)-this._coordinateShift,y:this.decodeMorton(t>>1)-this._coordinateShift}}decodeMorton(t){let i=0;for(let o=0;o<this._numBits;o++)i|=(t&1<<2*o)>>o;return i}static decode(t,i,o){return{x:ch.decodeMorton(t,i)-o,y:ch.decodeMorton(t>>1,i)-o}}static decodeMorton(t,i){let o=0;for(let l=0;l<i;l++)o|=(t&1<<2*l)>>l;return o}}(function(r){r[r.POINT=0]="POINT",r[r.LINESTRING=1]="LINESTRING",r[r.POLYGON=2]="POLYGON",r[r.MULTIPOINT=3]="MULTIPOINT",r[r.MULTILINESTRING=4]="MULTILINESTRING",r[r.MULTIPOLYGON=5]="MULTIPOLYGON"})(Rn||(Rn={})),function(r){r[r.POINT=0]="POINT",r[r.LINESTRING=1]="LINESTRING",r[r.POLYGON=2]="POLYGON"}(Rm||(Rm={})),function(r){r[r.MORTON=0]="MORTON",r[r.VEC_2=1]="VEC_2",r[r.VEC_3=2]="VEC_3"}(ka||(ka={}));class Om{createPoint(t){return[[t]]}createMultiPoint(t){return t.map(i=>[i])}createLineString(t){return[t]}createMultiLineString(t){return t}createPolygon(t,i){return[t,...i]}createMultiPolygon(t){return t.flat()}}function ac(r){const t=new Array(r.numGeometries);let i=1,o=1,l=1,h=0;const p=new Om;let y=0,x=0;const w=r.mortonSettings,M=r.topologyVector,A=M.geometryOffsets,D=M.partOffsets,I=M.ringOffsets,k=r.vertexOffsets,F=r.containsPolygonGeometry(),U=r.vertexBuffer;for(let X=0;X<r.numGeometries;X++){const st=r.geometryType(X);if(st===Rn.POINT){if(k&&k.length!==0)if(r.vertexBufferType===ka.VEC_2){const Q=2*k[x++],it=new wt(U[Q],U[Q+1]);t[h++]=p.createPoint(it)}else{const Q=k[x++],it=ch.decode(U[Q],w.numBits,w.coordinateShift),dt=new wt(it.x,it.y);t[h++]=p.createPoint(dt)}else{const Q=new wt(U[y++],U[y++]);t[h++]=p.createPoint(Q)}A&&l++,D&&i++,I&&o++}else if(st===Rn.MULTIPOINT){const Q=A[l]-A[l-1];l++;const it=new Array(Q);if(k&&k.length!==0){for(let dt=0;dt<Q;dt++){const _t=2*k[x++];it[dt]=new wt(U[_t],U[_t+1])}t[h++]=p.createMultiPoint(it)}else{for(let dt=0;dt<Q;dt++){const _t=U[y++],zt=U[y++];it[dt]=new wt(_t,zt)}t[h++]=p.createMultiPoint(it)}}else if(st===Rn.LINESTRING){let Q,it=0;F?(it=I[o]-I[o-1],o++):it=D[i]-D[i-1],i++,k&&k.length!==0?(Q=r.vertexBufferType===ka.VEC_2?sc(U,k,x,it,!1):Ud(U,k,x,it,!1,w),x+=it):(Q=lu(U,y,it,!1),y+=2*it),t[h++]=p.createLineString(Q),A&&l++}else if(st===Rn.POLYGON){const Q=D[i]-D[i-1];i++;const it=new Array(Q-1);let dt=I[o]-I[o-1];if(o++,k&&k.length!==0){const _t=r.vertexBufferType===ka.VEC_2?mf(U,k,x,dt):Nd(U,k,x,dt,0,w);x+=dt;for(let zt=0;zt<it.length;zt++)dt=I[o]-I[o-1],o++,it[zt]=r.vertexBufferType===ka.VEC_2?mf(U,k,x,dt):Nd(U,k,x,dt,0,w),x+=dt;t[h++]=p.createPolygon(_t,it)}else{const _t=ou(U,y,dt);y+=2*dt;for(let zt=0;zt<it.length;zt++)dt=I[o]-I[o-1],o++,it[zt]=ou(U,y,dt),y+=2*dt;t[h++]=p.createPolygon(_t,it)}A&&l++}else if(st===Rn.MULTILINESTRING){const Q=A[l]-A[l-1];l++;const it=new Array(Q);if(k&&k.length!==0){for(let dt=0;dt<Q;dt++){let _t=0;F?(_t=I[o]-I[o-1],o++):_t=D[i]-D[i-1],i++;const zt=r.vertexBufferType===ka.VEC_2?sc(U,k,x,_t,!1):Ud(U,k,x,_t,!1,w);it[dt]=zt,x+=_t}t[h++]=p.createMultiLineString(it)}else{for(let dt=0;dt<Q;dt++){let _t=0;F?(_t=I[o]-I[o-1],o++):_t=D[i]-D[i-1],i++,it[dt]=lu(U,y,_t,!1),y+=2*_t}t[h++]=p.createMultiLineString(it)}}else{if(st!==Rn.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const Q=A[l]-A[l-1];l++;const it=new Array(Q);let dt=0;if(k&&k.length!==0){for(let _t=0;_t<Q;_t++){const zt=D[i]-D[i-1];i++;const $t=new Array(zt-1);dt=I[o]-I[o-1],o++;const Zt=r.vertexBufferType===ka.VEC_2?mf(U,k,x,dt):Nd(U,k,x,dt,0,w);x+=dt;for(let Wt=0;Wt<$t.length;Wt++)dt=I[o]-I[o-1],o++,$t[Wt]=r.vertexBufferType===ka.VEC_2?mf(U,k,x,dt):Nd(U,k,x,dt,0,w),x+=dt;it[_t]=p.createPolygon(Zt,$t)}t[h++]=p.createMultiPolygon(it)}else{for(let _t=0;_t<Q;_t++){const zt=D[i]-D[i-1];i++;const $t=new Array(zt-1);dt=I[o]-I[o-1],o++;const Zt=ou(U,y,dt);y+=2*dt;for(let Wt=0;Wt<$t.length;Wt++){const oe=I[o]-I[o-1];o++,$t[Wt]=ou(U,y,oe),y+=2*oe}it[_t]=p.createPolygon(Zt,$t)}t[h++]=p.createMultiPolygon(it)}}}}return t}function ou(r,t,i){return lu(r,t,i,!0)}function mf(r,t,i,o){return sc(r,t,i,o,!0)}function Nd(r,t,i,o,l,h){return Ud(r,t,i,o,!0,h)}function lu(r,t,i,o){const l=new Array(o?i+1:i);for(let h=0;h<2*i;h+=2)l[h/2]=new wt(r[t+h],r[t+h+1]);return o&&(l[l.length-1]=l[0]),l}function sc(r,t,i,o,l){const h=new Array(l?o+1:o);for(let p=0;p<2*o;p+=2){const y=2*t[i+p/2];h[p/2]=new wt(r[y],r[y+1])}return l&&(h[h.length-1]=h[0]),h}function Ud(r,t,i,o,l,h){const p=new Array(l?o+1:o);for(let y=0;y<o;y++){const x=ch.decode(r[t[i+y]],h.numBits,h.coordinateShift);p[y]=new wt(x.x,x.y)}return l&&(p[p.length-1]=p[0]),p}class gf{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(t,i,o,l,h){this._vertexBufferType=t,this._topologyVector=i,this._vertexOffsets=o,this._vertexBuffer=l,this._mortonSettings=h}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const t=ac(this);let i=0;for(;i<this.numGeometries;)yield{coordinates:t[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(t){const i=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(t){if(this.vertexOffsets&&this.mortonSettings){const o=ch.decode(this.vertexBuffer[this.vertexOffsets[t]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const i=this.vertexOffsets?2*this.vertexOffsets[t]:2*t;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return ac(this)}get mortonSettings(){return this._mortonSettings}}class oc extends gf{_numGeometries;_geometryType;constructor(t,i,o,l,h,p,y){super(o,l,h,p,y),this._numGeometries=t,this._geometryType=i}static createMortonEncoded(t,i,o,l,h,p){return new oc(t,i,ka.MORTON,o,l,h,p)}static create(t,i,o,l,h){return new oc(t,i,ka.VEC_2,o,l,h)}geometryType(t){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Rn.POLYGON||this._geometryType===Rn.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class lc extends gf{_geometryTypes;constructor(t,i,o,l,h,p){super(t,o,l,h,p),this._geometryTypes=i}static createMortonEncoded(t,i,o,l,h){return new lc(ka.MORTON,t,i,o,l,h)}static create(t,i,o,l){return new lc(ka.VEC_2,t,i,o,l)}geometryType(t){return this._geometryTypes[t]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let t=0;t<this.numGeometries;t++)if(this.geometryType(t)===Rn.POLYGON||this.geometryType(t)===Rn.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class _f{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(t,i,o,l){this._triangleOffsets=t,this._indexBuffer=i,this._vertexBuffer=o,this._topologyVector=l}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const t=new Array(this.numGeometries),i=this._topologyVector,o=i.partOffsets,l=i.ringOffsets,h=i.geometryOffsets;let p=0,y=1,x=1,w=1;for(let M=0;M<this.numGeometries;M++)switch(this.geometryType(M)){case Rn.POLYGON:{const A=o[y]-o[y-1];y++;const D=[];for(let I=0;I<A;I++){const k=l[x]-l[x-1];x++;const F=[];for(let U=0;U<k;U++){const X=this._vertexBuffer[p++],st=this._vertexBuffer[p++];F.push(new wt(X,st))}F.length>0&&F.push(F[0]),D.push(F)}t[M]=D,h&&w++}break;case Rn.MULTIPOLYGON:{const A=h[w]-h[w-1];w++;const D=[];for(let I=0;I<A;I++){const k=o[y]-o[y-1];y++;for(let F=0;F<k;F++){const U=l[x]-l[x-1];x++;const X=[];for(let st=0;st<U;st++){const Q=this._vertexBuffer[p++],it=this._vertexBuffer[p++];X.push(new wt(Q,it))}X.length>0&&X.push(X[0]),D.push(X)}}t[M]=D}}return t}[Symbol.iterator](){return null}}class yf extends _f{_numGeometries;_geometryType;constructor(t,i,o,l,h,p){super(o,l,h,p),this._numGeometries=t,this._geometryType=i}static create(t,i,o,l,h,p){return new yf(t,i,o,l,h,p)}geometryType(t){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}class vf extends _f{_geometryTypes;constructor(t,i,o,l,h){super(i,o,l,h),this._geometryTypes=t}static create(t,i,o,l,h){return new vf(t,i,o,l,h)}geometryType(t){return this._geometryTypes[t]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function lg(r,t,i,o,l){const h=mr.decode(r,i);let p=null,y=null,x=null,w=null,M=null,A=null,D=null,I=null;if(Oe.getVectorType(h,o,r,i)===jn.CONST){const F=Oe.decodeConstIntStream(r,i,h,!1);for(let U=0;U<t-1;U++){const X=mr.decode(r,i);switch(X.physicalStreamType){case pr.LENGTH:switch(X.logicalStreamType.lengthType){case aa.GEOMETRIES:p=Oe.decodeLengthStreamToOffsetBuffer(r,i,X);break;case aa.PARTS:y=Oe.decodeLengthStreamToOffsetBuffer(r,i,X);break;case aa.RINGS:x=Oe.decodeLengthStreamToOffsetBuffer(r,i,X);break;case aa.TRIANGLES:D=Oe.decodeLengthStreamToOffsetBuffer(r,i,X)}break;case pr.OFFSET:switch(X.logicalStreamType.offsetType){case ma.VERTEX:w=Oe.decodeIntStream(r,i,X,!1);break;case ma.INDEX:I=Oe.decodeIntStream(r,i,X,!1)}break;case pr.DATA:if(Hs.VERTEX===X.logicalStreamType.dictionaryType)M=Oe.decodeIntStream(r,i,X,!0,l);else{const st=X;A={numBits:st.numBits(),coordinateShift:st.coordinateShift()},M=Oe.decodeIntStream(r,i,X,!1,l)}}}if(I!==null){if(p!=null||y!=null){const U=new uh(p,y,x);return yf.create(o,F,D,I,M,U)}return yf.create(o,F,D,I,M)}return A===null?oc.create(o,F,new uh(p,y,x),w,M):oc.createMortonEncoded(o,F,new uh(p,y,x),w,M,A)}const k=Oe.decodeIntStream(r,i,h,!1);for(let F=0;F<t-1;F++){const U=mr.decode(r,i);switch(U.physicalStreamType){case pr.LENGTH:switch(U.logicalStreamType.lengthType){case aa.GEOMETRIES:p=Oe.decodeIntStream(r,i,U,!1);break;case aa.PARTS:y=Oe.decodeIntStream(r,i,U,!1);break;case aa.RINGS:x=Oe.decodeIntStream(r,i,U,!1);break;case aa.TRIANGLES:D=Oe.decodeLengthStreamToOffsetBuffer(r,i,U)}break;case pr.OFFSET:switch(U.logicalStreamType.offsetType){case ma.VERTEX:w=Oe.decodeIntStream(r,i,U,!1);break;case ma.INDEX:I=Oe.decodeIntStream(r,i,U,!1)}break;case pr.DATA:if(Hs.VERTEX===U.logicalStreamType.dictionaryType)M=Oe.decodeIntStream(r,i,U,!0,l);else{const X=U;A={numBits:X.numBits(),coordinateShift:X.coordinateShift()},M=Oe.decodeIntStream(r,i,U,!1,l)}}}return I!==null&&y===null?vf.create(k,D,I,M):(p!==null?(p=jd(k,p,2),y!==null&&x!==null?(y=Fm(k,p,y,!1),x=function(F,U,X,st){const Q=new Int32Array(X[X.length-1]+1);let it=0;Q[0]=it;let dt=1,_t=1,zt=0;for(let $t=0;$t<F.length;$t++){const Zt=F[$t],Wt=U[$t+1]-U[$t];if(Zt!==0&&Zt!==3)for(let oe=0;oe<Wt;oe++){const te=X[dt]-X[dt-1];dt++;for(let ee=0;ee<te;ee++)it=Q[_t++]=it+st[zt++]}else for(let oe=0;oe<Wt;oe++)Q[_t++]=++it,dt++}return Q}(k,p,y,x)):y!==null&&(y=function(F,U,X){const st=new Int32Array(U[U.length-1]+1);let Q=0;st[0]=Q;let it=1,dt=0;for(let _t=0;_t<F.length;_t++){const zt=F[_t],$t=U[_t+1]-U[_t];if(zt===4||zt===1)for(let Zt=0;Zt<$t;Zt++)Q=st[it++]=Q+X[dt++];else for(let Zt=0;Zt<$t;Zt++)st[it++]=++Q}return st}(k,p,y))):y!==null&&x!==null?(y=jd(k,y,1),x=Fm(k,y,x,!0)):y!==null&&(y=jd(k,y,0)),I!==null?vf.create(k,D,I,M,new uh(p,y,x)):A===null?lc.create(k,new uh(p,y,x),w,M):lc.createMortonEncoded(k,new uh(p,y,x),w,M,A))}function jd(r,t,i){const o=new Int32Array(r.length+1);let l=0;o[0]=l;let h=0;for(let p=0;p<r.length;p++)l=o[p+1]=l+(r[p]>i?t[h++]:1);return o}function Fm(r,t,i,o){const l=new Int32Array(t[t.length-1]+1);let h=0;l[0]=h;let p=1,y=0;for(let x=0;x<r.length;x++){const w=r[x],M=t[x+1]-t[x];if(w===5||w===2||o&&(w===4||w===1))for(let A=0;A<M;A++)h=l[p++]=h+i[y++];else for(let A=0;A<M;A++)l[p++]=++h}return l}class Bp extends su{dataVector;constructor(t,i,o){super(t,i.getBuffer(),o),this.dataVector=i}getValueFromBuffer(t){return this.dataVector.get(t)}}class ug extends ah{getValueFromBuffer(t){return this.dataBuffer[t]}}class xf extends su{constructor(t,i,o){super(t,BigInt64Array.of(i),o)}getValueFromBuffer(t){return this.dataBuffer[0]}}function Vd(r,t,i){for(let o=0;o<r;o++){const l=mr.decode(t,i);i.add(l.byteLength)}}function uu(r,t,i){return Nm(r,Math.ceil(t/8),i)}function Nm(r,t,i){const o=new Uint8Array(t);let l=0;for(;l<t;){const h=r[i.increment()];if(h<=127){const p=h+3,y=r[i.increment()],x=l+p;o.fill(y,l,x),l=x}else{const p=256-h;for(let y=0;y<p;y++)o[l++]=r[i.increment()]}}return o}const bf=new TextDecoder;function Op(r,t,i){return i-t>=12?bf.decode(r.subarray(t,i)):function(o,l,h){let p="",y=l;for(;y<h;){const x=o[y];let w,M,A,D=null,I=x>239?4:x>223?3:x>191?2:1;if(y+I>h)break;I===1?x<128&&(D=x):I===2?(w=o[y+1],(192&w)==128&&(D=(31&x)<<6|63&w,D<=127&&(D=null))):I===3?(w=o[y+1],M=o[y+2],(192&w)==128&&(192&M)==128&&(D=(15&x)<<12|(63&w)<<6|63&M,(D<=2047||D>=55296&&D<=57343)&&(D=null))):I===4&&(w=o[y+1],M=o[y+2],A=o[y+3],(192&w)==128&&(192&M)==128&&(192&A)==128&&(D=(15&x)<<18|(63&w)<<12|(63&M)<<6|63&A,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,I=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=I}return p}(r,t,i)}class Gd extends su{offsetBuffer;constructor(t,i,o,l){super(t,o,l),this.offsetBuffer=i}}class Fp extends Gd{textEncoder;constructor(t,i,o,l){super(t,i,o,l??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(t){return Op(this.dataBuffer,this.offsetBuffer[t],this.offsetBuffer[t+1])}}class uc extends Gd{indexBuffer;textEncoder;constructor(t,i,o,l,h){super(t,o,l,h??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(t){const i=this.indexBuffer[t];return Op(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class Np extends Gd{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(t,i,o,l,h,p,y){super(t,o,l,y),this.indexBuffer=i,this.symbolOffsetBuffer=h,this.symbolTableBuffer=p,this.textEncoder=new TextEncoder}getValueFromBuffer(t){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=function(o,l,h){const p=[],y=new Array(l.length).fill(0);for(let x=1;x<l.length;x++)y[x]=y[x-1]+l[x-1];for(let x=0;x<h.length;x++)if(h[x]===255)p.push(h[++x]);else{const w=l[h[x]],M=y[h[x]];for(let A=0;A<w;A++)p.push(o[M+A])}return new Uint8Array(p)}(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const i=this.indexBuffer[t];return Op(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(t){const i=new Uint32Array(t.length-1);let o=t[0];for(let l=1;l<t.length;l++){const h=t[l];i[l-1]=h-o,o=h}return i}}class cc{static ROOT_COLUMN_NAME="default";static NESTED_COLUMN_SEPARATOR=":";constructor(){}static decode(t,i,o,l,h){let p=null,y=null,x=null,w=null,M=null,A=null,D=null,I=null;for(let k=0;k<l;k++){const F=mr.decode(i,o);if(F.byteLength!==0)switch(F.physicalStreamType){case pr.PRESENT:{const U=uu(i,F.numValues,o);A=new Xs(U,F.numValues);break}case pr.OFFSET:y=h!=null||A!=null?Oe.decodeNullableIntStream(i,o,F,!1,h??A):Oe.decodeIntStream(i,o,F,!1);break;case pr.LENGTH:{const U=Oe.decodeLengthStreamToOffsetBuffer(i,o,F);aa.DICTIONARY===F.logicalStreamType.lengthType?p=U:aa.SYMBOL===F.logicalStreamType.lengthType?w=U:D=U;break}case pr.DATA:{const U=i.subarray(o.get(),o.get()+F.byteLength);o.add(F.byteLength);const X=F.logicalStreamType.dictionaryType;Hs.FSST===X?M=U:Hs.SINGLE===X||Hs.SHARED===X?x=U:Hs.NONE===X&&(I=U);break}}}return this.decodeFsstDictionaryVector(t,M,y,p,x,w,h??A)??this.decodeDictionaryVector(t,x,y,p,h??A)??this.decodePlainStringVector(t,D,I,y,h??A)}static decodeFsstDictionaryVector(t,i,o,l,h,p,y){return i?new Np(t,o,l,h,p,i,y):null}static decodeDictionaryVector(t,i,o,l,h){return i?h?new uc(t,o,l,i,h):new uc(t,o,l,i):null}static decodePlainStringVector(t,i,o,l,h){if(!i||!o)return null;if(l)return h?new uc(t,l,i,o,h):new uc(t,l,i,o);if(h&&h.size()!==i.length-1){const p=new Int32Array(h.size());let y=0;for(let x=0;x<h.size();x++)p[x]=h.get(x)?y++:0;return new uc(t,p,i,o,h)}return h?new Fp(t,i,o,h):new Fp(t,i,o)}static decodeSharedDictionary(t,i,o,l,h){let p=null,y=null,x=null,w=null,M=!1;for(;!M;){const k=mr.decode(t,i);switch(k.physicalStreamType){case pr.LENGTH:aa.DICTIONARY===k.logicalStreamType.lengthType?p=Oe.decodeLengthStreamToOffsetBuffer(t,i,k):x=Oe.decodeLengthStreamToOffsetBuffer(t,i,k);break;case pr.DATA:Hs.SINGLE===k.logicalStreamType.dictionaryType||Hs.SHARED===k.logicalStreamType.dictionaryType?(y=t.subarray(i.get(),i.get()+k.byteLength),M=!0):w=t.subarray(i.get(),i.get()+k.byteLength),i.add(k.byteLength)}}const A=o.complexType.children,D=[];let I=0;for(const k of A){const F=Tn(t,i,1)[0];if(F==0)continue;const U=`${o.name}${k.name===cc.ROOT_COLUMN_NAME?"":cc.NESTED_COLUMN_SEPARATOR+k.name}`;if(h&&!h.has(U)){Vd(F,t,i);continue}if(F!==2||k.type!=="scalarField"||k.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const X=mr.decode(t,i),st=uu(t,X.numValues,i),Q=mr.decode(t,i),it=(Q instanceof Ro?Q.numRleValues:Q.numValues)!==l?Oe.decodeNullableIntStream(t,i,Q,!1,new Xs(st,X.numValues)):Oe.decodeIntStream(t,i,Q,!1);D[I++]=w?new Np(U,it,p,y,x,w,new Xs(st,X.numValues)):new uc(U,it,p,y,new Xs(st,X.numValues))}return D}}function Um(r,t,i,o,l,h){return i.type==="scalarType"?function(p,y,x,w,M,A){let D=null,I=0;if(p===0)return null;if(A.nullable){const F=mr.decode(y,x);I=F.numValues;const U=x.get(),X=uu(y,I,x);x.set(U+F.byteLength),D=new Xs(X,F.numValues)}const k=D??w;switch(M.physicalType){case 4:case 3:return function(F,U,X,st,Q){const it=mr.decode(F,U),dt=Oe.getVectorType(it,Q,F,U),_t=st.physicalType===3;if(dt===jn.FLAT){const zt=hh(Q)?Oe.decodeNullableIntStream(F,U,it,_t,Q):Oe.decodeIntStream(F,U,it,_t);return new sh(X.name,zt,Q)}if(dt===jn.SEQUENCE){const zt=Oe.decodeSequenceIntStream(F,U,it);return new ff(X.name,zt[0],zt[1],it.numRleValues)}{const zt=Oe.decodeConstIntStream(F,U,it,_t);return new df(X.name,zt,Q)}}(y,x,A,M,k);case 9:return cc.decode(A.name,y,x,A.nullable?p-1:p,D);case 0:return function(F,U,X,st,Q){const it=mr.decode(F,U),dt=it.numValues,_t=U.get(),zt=hh(Q)?function(Zt,Wt,oe,te){const ee=Nm(Zt,Math.ceil(Wt/8),oe),Ut=new Xs(ee,Wt),Me=te.size(),we=new Xs(new Uint8Array(Me),Me);let Se=0;for(let de=0;de<te.size();de++){const Ye=!!te.get(de)&&Ut.get(Se++);we.set(de,Ye)}return we.getBuffer()}(F,dt,U,Q):uu(F,dt,U);U.set(_t+it.byteLength);const $t=new Xs(zt,dt);return new Bp(X.name,$t,Q)}(y,x,A,0,k);case 6:case 5:return function(F,U,X,st,Q){const it=mr.decode(F,U),dt=Oe.getVectorType(it,st,F,U),_t=Q.physicalType===5;if(dt===jn.FLAT){const zt=hh(st)?Oe.decodeNullableLongStream(F,U,it,_t,st):Oe.decodeLongStream(F,U,it,_t);return new km(X.name,zt,st)}if(dt===jn.SEQUENCE){const zt=Oe.decodeSequenceLongStream(F,U,it);return new Bm(X.name,zt[0],zt[1],it.numRleValues)}{const zt=Oe.decodeConstLongStream(F,U,it,_t);return new xf(X.name,zt,st)}}(y,x,A,k,M);case 7:return function(F,U,X,st){const Q=mr.decode(F,U),it=hh(st)?function(dt,_t,zt,$t){const Zt=_t.get(),Wt=Zt+$t*Float32Array.BYTES_PER_ELEMENT,oe=new Uint8Array(dt.subarray(Zt,Wt)).buffer,te=new Float32Array(oe);_t.set(Wt);const ee=zt.size(),Ut=new Float32Array(ee);let Me=0;for(let we=0;we<ee;we++)Ut[we]=zt.get(we)?te[Me++]:0;return Ut}(F,U,st,Q.numValues):function(dt,_t,zt){const $t=_t.get(),Zt=$t+zt*Float32Array.BYTES_PER_ELEMENT,Wt=new Uint8Array(dt.subarray($t,Zt)).buffer,oe=new Float32Array(Wt);return _t.set(Zt),oe}(F,U,Q.numValues);return new ug(X.name,it,st)}(y,x,A,k);case 8:return function(F,U,X,st){const Q=mr.decode(F,U),it=hh(st)?function(dt,_t,zt,$t){const Zt=_t.get(),Wt=Zt+$t*Float64Array.BYTES_PER_ELEMENT,oe=new Uint8Array(dt.subarray(Zt,Wt)).buffer,te=new Float64Array(oe);_t.set(Wt);const ee=zt.size(),Ut=new Float64Array(ee);let Me=0;for(let we=0;we<ee;we++)Ut[we]=zt.get(we)?te[Me++]:0;return Ut}(F,U,st,Q.numValues):function(dt,_t,zt){const $t=_t.get(),Zt=$t+zt*Float64Array.BYTES_PER_ELEMENT,Wt=new Uint8Array(dt.subarray($t,Zt)).buffer,oe=new Float64Array(Wt);return _t.set(Zt),oe}(F,U,Q.numValues);return new kd(X.name,it,st)}(y,x,A,k);default:throw new Error(`The specified data type for the field is currently not supported: ${M}`)}}(o,r,t,l,i.scalarType,i):o!=1?null:cc.decodeSharedDictionary(r,t,i,l,h)}function hh(r){return r instanceof Xs}class hc{static decodeColumnType(t){switch(t){case 0:case 1:case 2:case 3:{const i={};i.nullable=!!(1&t),i.columnScope=0;const o={};return o.physicalType=t>1?6:4,o.type="physicalType",i.scalarType=o,i.type="scalarType",i}case 4:{const i={nullable:!1,columnScope:0},o={type:"physicalType",physicalType:0};return i.type="complexType",i.complexType=o,i}case 30:{const i={nullable:!1,columnScope:0},o={type:"physicalType",physicalType:1};return i.type="complexType",i.complexType=o,i}default:return this.mapScalarType(t)}}static columnTypeHasName(t){return t>=10}static columnTypeHasChildren(t){return t===30}static hasStreamCount(t){if(t.name==="id")return!1;if(t.type==="scalarType"){const i=t.scalarType;if(i.type==="physicalType")switch(i.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(i.type==="logicalType")return!1}else if(t.type==="complexType"){const i=t.complexType;if(i.type==="physicalType")switch(i.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",t),!1}static mapScalarType(t){let i=null;switch(t){case 10:case 11:i=0;break;case 12:case 13:i=1;break;case 14:case 15:i=2;break;case 16:case 17:i=3;break;case 18:case 19:i=4;break;case 20:case 21:i=5;break;case 22:case 23:i=6;break;case 24:case 25:i=7;break;case 26:case 27:i=8;break;case 28:case 29:i=9;break;default:return null}const o={};o.nullable=!!(1&t),o.columnScope=0;const l={type:"physicalType"};return l.physicalType=i,o.type="scalarType",o.scalarType=l,o}}const cg=new TextDecoder;function jm(r,t){const i=Tn(r,t,1)[0];if(i===0)return"";const o=t.get(),l=r.subarray(o,o+i);return t.add(i),cg.decode(l)}function Zd(r,t){const i=Tn(r,t,1)[0]>>>0,o=!!(4&i),l=!!(2&i),h=Tn(r,t,1)[0]>>>0,p={};if(1&i&&(p.nullable=!0),l){const y={};if(o?(y.type="logicalType",y.logicalType=h):(y.type="physicalType",y.physicalType=h),8&i){const x=Tn(r,t,1)[0]>>>0;y.children=new Array(x);for(let w=0;w<x;w++)y.children[w]=Zd(r,t)}p.type="complexField",p.complexField=y}else{const y={};o?(y.type="logicalType",y.logicalType=h):(y.type="physicalType",y.physicalType=h),p.type="scalarField",p.scalarField=y}return p}function Up(r,t){const i=Tn(r,t,1)[0]>>>0,o=hc.decodeColumnType(i);if(!o)throw new Error(`Unsupported column type code: ${i}`);if(hc.columnTypeHasName(i)?o.name=jm(r,t):i>=0&&i<=3?o.name="id":i===4&&(o.name="geometry"),hc.columnTypeHasChildren(i)){const l=Tn(r,t,1)[0]>>>0,h=o.complexType;h.children=new Array(l);for(let p=0;p<l;p++)h.children[p]=Zd(r,t)}return o}function qd(r,t){const i={featureTables:[]},o={};o.name=jm(r,t);const l=Tn(r,t,1)[0]>>>0,h=Tn(r,t,1)[0]>>>0;o.columns=new Array(h);for(let p=0;p<h;p++)o.columns[p]=Up(r,t);return i.featureTables.push(o),[i,l]}function jp(r,t,i,o,l,h,p=!1){const y=t.scalarType.physicalType,x=Oe.getVectorType(l,h,r,i);if(y===4)switch(x){case jn.FLAT:{const w=Oe.decodeIntStream(r,i,l,!1);return new sh(o,w,h)}case jn.SEQUENCE:{const w=Oe.decodeSequenceIntStream(r,i,l);return new ff(o,w[0],w[1],l.numRleValues)}case jn.CONST:{const w=Oe.decodeConstIntStream(r,i,l,!1);return new df(o,w,h)}}else switch(x){case jn.FLAT:{if(p){const M=Oe.decodeLongFloat64Stream(r,i,l,!1);return new kd(o,M,h)}const w=Oe.decodeLongStream(r,i,l,!1);return new km(o,w,h)}case jn.SEQUENCE:{const w=Oe.decodeSequenceLongStream(r,i,l);return new Bm(o,w[0],w[1],l.numRleValues)}case jn.CONST:{const w=Oe.decodeConstLongStream(r,i,l,!1);return new xf(o,w,h)}}throw new Error("Vector type not supported for id column.")}class Vm{constructor(t,i){var o;switch(this._featureData=t,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case Rn.POINT:case Rn.MULTIPOINT:this.type=1;break;case Rn.LINESTRING:case Rn.MULTILINESTRING:this.type=2;break;case Rn.POLYGON:case Rn.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}projectPoint(t,i,o,l){return[360*(t.x+i)/l-180,360/Math.PI*Math.atan(Math.exp((1-2*(t.y+o)/l)*Math.PI))-90]}projectLine(t,i,o,l){return t.map(h=>this.projectPoint(h,i,o,l))}toGeoJSON(t,i,o){const l=this.extent*Math.pow(2,o),h=this.extent*t,p=this.extent*i,y=this.loadGeometry();let x;switch(this.type){case 1:{const M=[];for(const D of y)M.push(D[0]);const A=this.projectLine(M,h,p,l);x=M.length===1?{type:"Point",coordinates:A[0]}:{type:"MultiPoint",coordinates:A};break}case 2:{const M=y.map(A=>this.projectLine(A,h,p,l));x=M.length===1?{type:"LineString",coordinates:M[0]}:{type:"MultiLineString",coordinates:M};break}case 3:{const M=Bl(y),A=[];for(const D of M)A.push(D.map(I=>this.projectLine(I,h,p,l)));x=A.length===1?{type:"Polygon",coordinates:A[0]}:{type:"MultiPolygon",coordinates:A};break}default:throw new Error(`unknown feature type: ${this.type}`)}const w={type:"Feature",geometry:x,properties:this.properties};return this.id!=null&&(w.id=this.id),w}loadGeometry(){const t=[];for(const i of this._featureData.geometry.coordinates){const o=[];for(const l of i)o.push(new wt(l.x,l.y));t.push(o)}return t}bbox(){return[0,0,0,0]}}class Vp{constructor(t){this.features=[],this.featureTable=t,this.name=t.name,this.extent=t.extent,this.version=2,this.features=t.getFeatures(),this.length=this.features.length}feature(t){return new Vm(this.features[t],this.extent)}}class gl{constructor(t){this.layers={};const i=function(o,l,h=!0){const p=new Im(0),y=[];for(;p.get()<o.length;){const x=Tn(o,p,1)[0]>>>0,w=p.get()+x;if(w>o.length)throw new Error(`Block overruns tile: ${w} > ${o.length}`);if(Tn(o,p,1)[0]>>>0!=1){p.set(w);continue}const M=qd(o,p),A=M[1],D=M[0].featureTables[0];let I=null,k=null;const F=[];let U=0;for(const st of D.columns){const Q=st.name;if(Q==="id"){let it=null;if(st.nullable){const _t=mr.decode(o,p),zt=p.get(),$t=uu(o,_t.numValues,p);p.set(zt+_t.byteLength),it=new Xs($t,_t.numValues)}const dt=mr.decode(o,p);U=dt.getDecompressedCount(),I=jp(o,st,p,Q,dt,it??U,h)}else if(Q==="geometry"){const it=Tn(o,p,1)[0];if(U===0){const dt=p.get();U=mr.decode(o,p).getDecompressedCount(),p.set(dt)}k=lg(o,it,p,U,l)}else{const it=hc.hasStreamCount(st)?Tn(o,p,1)[0]:1;if(it===0&&st.type==="scalarType")continue;const dt=Um(o,p,st,it,U,void 0);dt&&(Array.isArray(dt)?F.push(...dt):F.push(dt))}}const X=new ag(D.name,k,I,F,A);y.push(X),p.set(w)}return y}(new Uint8Array(t));this.layers=i.reduce((o,l)=>Object.assign(Object.assign({},o),{[l.name]:new Vp(l)}),{})}}class _l{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new el(ge,16,0),this.grid3D=new el(ge,16,0),this.featureIndexArray=new K,this.promoteId=i}insert(t,i,o,l,h,p){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,l,h);const x=p?this.grid3D:this.grid;for(let w=0;w<i.length;w++){const M=i[w],A=[1/0,1/0,-1/0,-1/0];for(let D=0;D<M.length;D++){const I=M[D];A[0]=Math.min(A[0],I.x),A[1]=Math.min(A[1],I.y),A[2]=Math.max(A[2],I.x),A[3]=Math.max(A[3],I.y)}A[0]<ge&&A[1]<ge&&A[2]>=0&&A[3]>=0&&x.insert(y,A[0],A[1],A[2],A[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new tf(new yd(this.rawTileData)).layers:new gl(this.rawTileData).layers,this.sourceLayerCoder=new Rp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,i,o,l){this.loadVTLayers();const h=t.params,p=ge/t.tileSize/t.scale,y=Vr(h.filter,h.globalState),x=t.queryGeometry,w=t.queryPadding*p,M=ic.fromPoints(x),A=this.grid.query(M.minX-w,M.minY-w,M.maxX+w,M.maxY+w),D=ic.fromPoints(t.cameraQueryGeometry).expandBy(w),I=this.grid3D.query(D.minX,D.minY,D.maxX,D.maxY,(U,X,st,Q)=>function(it,dt,_t,zt,$t){for(const Wt of it)if(dt<=Wt.x&&_t<=Wt.y&&zt>=Wt.x&&$t>=Wt.y)return!0;const Zt=[new wt(dt,_t),new wt(dt,$t),new wt(zt,$t),new wt(zt,_t)];if(it.length>2){for(const Wt of Zt)if(Pn(it,Wt))return!0}for(let Wt=0;Wt<it.length-1;Wt++)if(Qp(it[Wt],it[Wt+1],Zt))return!0;return!1}(t.cameraQueryGeometry,U-w,X-w,st+w,Q+w));for(const U of I)A.push(U);A.sort(wf);const k={};let F;for(let U=0;U<A.length;U++){const X=A[U];if(X===F)continue;F=X;const st=this.featureIndexArray.get(X);let Q=null;this.loadMatchingFeature(k,st.bucketIndex,st.sourceLayerIndex,st.featureIndex,y,h.layers,h.availableImages,i,o,l,(it,dt,_t)=>(Q||(Q=Fs(it)),dt.queryIntersectsFeature({queryGeometry:x,feature:it,featureState:_t,geometry:Q,zoom:this.z,transform:t.transform,pixelsToTileUnits:p,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return k}loadMatchingFeature(t,i,o,l,h,p,y,x,w,M,A){const D=this.bucketLayerIDs[i];if(p&&!D.some(U=>p.has(U)))return;const I=this.sourceLayerCoder.decode(o),k=this.vtLayers[I].feature(l);if(h.needGeometry){const U=Ns(k,!0);if(!h.filter(new _i(this.tileID.overscaledZ),U,this.tileID.canonical))return}else if(!h.filter(new _i(this.tileID.overscaledZ),k))return;const F=this.getId(k,I);for(let U=0;U<D.length;U++){const X=D[U];if(p&&!p.has(X))continue;const st=x[X];if(!st)continue;let Q={};F&&M&&(Q=M.getState(st.sourceLayer||"_geojsonTileLayer",F));const it=fi({},w[X]);it.paint=yl(it.paint,st.paint,k,Q,y),it.layout=yl(it.layout,st.layout,k,Q,y);const dt=!A||A(k,st,Q);if(!dt)continue;const _t=new Pm(k,this.z,this.x,this.y,F);_t.layer=it;let zt=t[X];zt===void 0&&(zt=t[X]=[]),zt.push({featureIndex:l,feature:_t,intersectionZ:dt})}}lookupSymbolFeatures(t,i,o,l,h,p,y,x){const w={};this.loadVTLayers();const M=Vr(h.filterSpec,h.globalState);for(const A of t)this.loadMatchingFeature(w,o,l,A,M,p,y,x,i);return w}hasLayer(t){for(const i of this.bucketLayerIDs)for(const o of i)if(t===o)return!0;return!1}getId(t,i){var o;let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof l=="boolean"&&(l=Number(l)),l===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(l=Number(t.properties.cluster_id))),l}}function yl(r,t,i,o,l){return Lr(r,(h,p)=>{const y=t instanceof Xl?t.get(p):null;return y&&y.evaluate?y.evaluate(i,o,l):y})}function wf(r,t){return t-r}function fh(r,t,i,o,l){const h=[];for(let p=0;p<r.length;p++){const y=r[p];let x;for(let w=0;w<y.length-1;w++){let M=y[w],A=y[w+1];M.x<t&&A.x<t||(M.x<t?M=new wt(t,M.y+(t-M.x)/(A.x-M.x)*(A.y-M.y))._round():A.x<t&&(A=new wt(t,M.y+(t-M.x)/(A.x-M.x)*(A.y-M.y))._round()),M.y<i&&A.y<i||(M.y<i?M=new wt(M.x+(i-M.y)/(A.y-M.y)*(A.x-M.x),i)._round():A.y<i&&(A=new wt(M.x+(i-M.y)/(A.y-M.y)*(A.x-M.x),i)._round()),M.x>=o&&A.x>=o||(M.x>=o?M=new wt(o,M.y+(o-M.x)/(A.x-M.x)*(A.y-M.y))._round():A.x>=o&&(A=new wt(o,M.y+(o-M.x)/(A.x-M.x)*(A.y-M.y))._round()),M.y>=l&&A.y>=l||(M.y>=l?M=new wt(M.x+(l-M.y)/(A.y-M.y)*(A.x-M.x),l)._round():A.y>=l&&(A=new wt(M.x+(l-M.y)/(A.y-M.y)*(A.x-M.x),l)._round()),x&&M.equals(x[x.length-1])||(x=[M],h.push(x)),x.push(A)))))}}return h}function vl(r,t,i,o,l){switch(t){case 1:return function(h,p,y,x){const w=[];for(const M of h)for(const A of M){const D=x===0?A.x:A.y;D>=p&&D<=y&&w.push([A])}return w}(r,i,o,l);case 2:return Gp(r,i,o,l,!1);case 3:return Gp(r,i,o,l,!0)}return[]}function hg(r,t,i,o,l){const h=o===0?Tf:fg;let p=[];const y=[];for(let M=0;M<r.length-1;M++){const A=r[M],D=r[M+1],I=o===0?A.x:A.y,k=o===0?D.x:D.y;let F=!1;I<t?k>t&&p.push(h(A,D,t)):I>i?k<i&&p.push(h(A,D,i)):p.push(A),k<t&&I>=t&&(p.push(h(A,D,t)),F=!0),k>i&&I<=i&&(p.push(h(A,D,i)),F=!0),!l&&F&&(y.push(p),p=[])}const x=r.length-1,w=o===0?r[x].x:r[x].y;return w>=t&&w<=i&&p.push(r[x]),l&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(new wt(p[0].x,p[0].y)),p.length>0&&y.push(p),y}function Gp(r,t,i,o,l){const h=[];for(const p of r){const y=hg(p,t,i,o,l);y.length>0&&h.push(...y)}return h}function Tf(r,t,i){return new wt(i,r.y+(i-r.x)/(t.x-r.x)*(t.y-r.y))}function fg(r,t,i){return new wt(r.x+(i-r.y)/(t.y-r.y)*(t.x-r.x),i)}le("FeatureIndex",_l,{omit:["rawTileData","sourceLayerCoder"]});class xl extends wt{constructor(t,i,o,l){super(t,i),this.angle=o,l!==void 0&&(this.segment=l)}clone(){return new xl(this.x,this.y,this.angle,this.segment)}}function Sf(r,t,i,o,l){if(t.segment===void 0||i===0)return!0;let h=t,p=t.segment+1,y=0;for(;y>-i/2;){if(p--,p<0)return!1;y-=r[p].dist(h),h=r[p]}y+=r[p].dist(r[p+1]),p++;const x=[];let w=0;for(;y<i/2;){const M=r[p],A=r[p+1];if(!A)return!1;let D=r[p-1].angleTo(M)-M.angleTo(A);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:D}),w+=D;y-x[0].distance>o;)w-=x.shift().angleDelta;if(w>l)return!1;p++,y+=M.dist(A)}return!0}function Zp(r){let t=0;for(let i=0;i<r.length-1;i++)t+=r[i].dist(r[i+1]);return t}function Gm(r,t,i){return r?.6*t*i:0}function Mf(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Hd(r,t,i,o,l,h){const p=Gm(i,l,h),y=Mf(i,o)*h;let x=0;const w=Zp(r)/2;for(let M=0;M<r.length-1;M++){const A=r[M],D=r[M+1],I=A.dist(D);if(x+I>w){const k=(w-x)/I,F=wa.number(A.x,D.x,k),U=wa.number(A.y,D.y,k),X=new xl(F,U,D.angleTo(A),M);return X._round(),!p||Sf(r,X,y,p,t)?X:void 0}x+=I}}function Zm(r,t,i,o,l,h,p,y,x){const w=Gm(o,h,p),M=Mf(o,l),A=M*p,D=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return t-A<t/4&&(t=A+t/4),fc(r,D?t/2*y%t:(M/2+2*h)*p*y%t,t,w,i,A,D,!1,x)}function fc(r,t,i,o,l,h,p,y,x){const w=h/2,M=Zp(r);let A=0,D=t-i,I=[];for(let k=0;k<r.length-1;k++){const F=r[k],U=r[k+1],X=F.dist(U),st=U.angleTo(F);for(;D+i<A+X;){D+=i;const Q=(D-A)/X,it=wa.number(F.x,U.x,Q),dt=wa.number(F.y,U.y,Q);if(it>=0&&it<x&&dt>=0&&dt<x&&D-w>=0&&D+w<=M){const _t=new xl(it,dt,st,k);_t._round(),o&&!Sf(r,_t,h,o,l)||I.push(_t)}}A+=X}return y||I.length||p||(I=fc(r,A/2,i,o,l,h,p,!0,x)),I}function qp(r,t,i,o){const l=[],h=r.image,p=h.pixelRatio,y=h.paddedRect.w-2,x=h.paddedRect.h-2;let w={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const M=h.stretchX||[[0,y]],A=h.stretchY||[[0,x]],D=(Ut,Me)=>Ut+Me[1]-Me[0],I=M.reduce(D,0),k=A.reduce(D,0),F=y-I,U=x-k;let X=0,st=I,Q=0,it=k,dt=0,_t=F,zt=0,$t=U;if(h.content&&o){const Ut=h.content,Me=Ut[2]-Ut[0],we=Ut[3]-Ut[1];(h.textFitWidth||h.textFitHeight)&&(w=ec(r)),X=dh(M,0,Ut[0]),Q=dh(A,0,Ut[1]),st=dh(M,Ut[0],Ut[2]),it=dh(A,Ut[1],Ut[3]),dt=Ut[0]-X,zt=Ut[1]-Q,_t=Me-st,$t=we-it}const Zt=w.x1,Wt=w.y1,oe=w.x2-Zt,te=w.y2-Wt,ee=(Ut,Me,we,Se)=>{const de=Af(Ut.stretch-X,st,oe,Zt),Ye=Xd(Ut.fixed-dt,_t,Ut.stretch,I),Sn=Af(Me.stretch-Q,it,te,Wt),lr=Xd(Me.fixed-zt,$t,Me.stretch,k),$r=Af(we.stretch-X,st,oe,Zt),$s=Xd(we.fixed-dt,_t,we.stretch,I),Fa=Af(Se.stretch-Q,it,te,Wt),Pr=Xd(Se.fixed-zt,$t,Se.stretch,k),pn=new wt(de,Sn),gr=new wt($r,Sn),Ir=new wt($r,Fa),Rr=new wt(de,Fa),ga=new wt(Ye/p,lr/p),Ys=new wt($s/p,Pr/p),_r=t*Math.PI/180;if(_r){const yr=Math.sin(_r),vr=Math.cos(_r),$n=[vr,-yr,yr,vr];pn._matMult($n),gr._matMult($n),Rr._matMult($n),Ir._matMult($n)}const Na=Ut.stretch+Ut.fixed,ur=Me.stretch+Me.fixed;return{tl:pn,tr:gr,bl:Rr,br:Ir,tex:{x:h.paddedRect.x+1+Na,y:h.paddedRect.y+1+ur,w:we.stretch+we.fixed-Na,h:Se.stretch+Se.fixed-ur},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ga,pixelOffsetBR:Ys,minFontScaleX:_t/p/oe,minFontScaleY:$t/p/te,isSDF:i}};if(o&&(h.stretchX||h.stretchY)){const Ut=Ef(M,F,I),Me=Ef(A,U,k);for(let we=0;we<Ut.length-1;we++){const Se=Ut[we],de=Ut[we+1];for(let Ye=0;Ye<Me.length-1;Ye++)l.push(ee(Se,Me[Ye],de,Me[Ye+1]))}}else l.push(ee({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return l}function dh(r,t,i){let o=0;for(const l of r)o+=Math.max(t,Math.min(i,l[1]))-Math.max(t,Math.min(i,l[0]));return o}function Ef(r,t,i){const o=[{fixed:-1,stretch:0}];for(const[l,h]of r){const p=o[o.length-1];o.push({fixed:l-p.stretch,stretch:p.stretch}),o.push({fixed:l-p.stretch,stretch:p.stretch+(h-l)})}return o.push({fixed:t+1,stretch:i}),o}function Af(r,t,i,o){return r/t*i+o}function Xd(r,t,i,o){return r-t*i/o}le("Anchor",xl);class dc{constructor(t,i,o,l,h,p,y,x,w,M){var A;if(this.boxStartIndex=t.length,w){let D=p.top,I=p.bottom;const k=p.collisionPadding;k&&(D-=k[1],I+=k[3]);let F=I-D;F>0&&(F=Math.max(10,F),this.circleDiameter=F)}else{const D=!((A=p.image)===null||A===void 0)&&A.content&&(p.image.textFitWidth||p.image.textFitHeight)?ec(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};D.y1=D.y1*y-x[0],D.y2=D.y2*y+x[2],D.x1=D.x1*y-x[3],D.x2=D.x2*y+x[1];const I=p.collisionPadding;if(I&&(D.x1-=I[0]*y,D.y1-=I[1]*y,D.x2+=I[2]*y,D.y2+=I[3]*y),M){const k=new wt(D.x1,D.y1),F=new wt(D.x2,D.y1),U=new wt(D.x1,D.y2),X=new wt(D.x2,D.y2),st=M*Math.PI/180;k._rotate(st),F._rotate(st),U._rotate(st),X._rotate(st),D.x1=Math.min(k.x,F.x,U.x,X.x),D.x2=Math.max(k.x,F.x,U.x,X.x),D.y1=Math.min(k.y,F.y,U.y,X.y),D.y2=Math.max(k.y,F.y,U.y,X.y)}t.emplaceBack(i.x,i.y,D.x1,D.y1,D.x2,D.y2,o,l,h)}this.boxEndIndex=t.length}}class n{constructor(t=[],i=(o,l)=>o<l?-1:o>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:o}=this,l=i[t];for(;t>0;){const h=t-1>>1,p=i[h];if(o(l,p)>=0)break;i[t]=p,t=h}i[t]=l}_down(t){const{data:i,compare:o}=this,l=this.length>>1,h=i[t];for(;t<l;){let p=1+(t<<1);const y=p+1;if(y<this.length&&o(i[y],i[p])<0&&(p=y),o(i[p],h)>=0)break;i[t]=i[p],t=p}i[t]=h}}function s(r,t=1,i=!1){const o=ic.fromPoints(r[0]),l=Math.min(o.width(),o.height());let h=l/2;const p=new n([],c),{minX:y,minY:x,maxX:w,maxY:M}=o;if(l===0)return new wt(y,x);for(let I=y;I<w;I+=l)for(let k=x;k<M;k+=l)p.push(new g(I+h,k+h,h,r));let A=function(I){let k=0,F=0,U=0;const X=I[0];for(let st=0,Q=X.length,it=Q-1;st<Q;it=st++){const dt=X[st],_t=X[it],zt=dt.x*_t.y-_t.x*dt.y;F+=(dt.x+_t.x)*zt,U+=(dt.y+_t.y)*zt,k+=3*zt}return new g(F/k,U/k,0,I)}(r),D=p.length;for(;p.length;){const I=p.pop();(I.d>A.d||!A.d)&&(A=I,i&&console.log("found best %d after %d probes",Math.round(1e4*I.d)/1e4,D)),I.max-A.d<=t||(h=I.h/2,p.push(new g(I.p.x-h,I.p.y-h,h,r)),p.push(new g(I.p.x+h,I.p.y-h,h,r)),p.push(new g(I.p.x-h,I.p.y+h,h,r)),p.push(new g(I.p.x+h,I.p.y+h,h,r)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${A.d}`)),A.p}function c(r,t){return t.max-r.max}function g(r,t,i,o){this.p=new wt(r,t),this.h=i,this.d=function(l,h){let p=!1,y=1/0;for(let x=0;x<h.length;x++){const w=h[x];for(let M=0,A=w.length,D=A-1;M<A;D=M++){const I=w[M],k=w[D];I.y>l.y!=k.y>l.y&&l.x<(k.x-I.x)*(l.y-I.y)/(k.y-I.y)+I.x&&(p=!p),y=Math.min(y,Qf(l,I,k))}}return(p?1:-1)*Math.sqrt(y)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var b;P.aJ=void 0,(b=P.aJ||(P.aJ={}))[b.center=1]="center",b[b.left=2]="left",b[b.right=3]="right",b[b.top=4]="top",b[b.bottom=5]="bottom",b[b["top-left"]=6]="top-left",b[b["top-right"]=7]="top-right",b[b["bottom-left"]=8]="bottom-left",b[b["bottom-right"]=9]="bottom-right";const E=Number.POSITIVE_INFINITY;function O(r,t){return t[1]!==E?function(i,o,l){let h=0,p=0;switch(o=Math.abs(o),l=Math.abs(l),i){case"top-right":case"top-left":case"top":p=l-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-l}switch(i){case"top-right":case"bottom-right":case"right":h=-o;break;case"top-left":case"bottom-left":case"left":h=o}return[h,p]}(r,t[0],t[1]):function(i,o){let l=0,h=0;o<0&&(o=0);const p=o/Math.SQRT2;switch(i){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-o;break;case"top":h=o-7}switch(i){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=o;break;case"right":l=-o}return[l,h]}(r,t[0])}function W(r,t,i){var o;const l=r.layout,h=(o=l.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},i);if(h){const y=h.values,x=[];for(let w=0;w<y.length;w+=2){const M=x[w]=y[w],A=y[w+1].map(D=>D*Nn);M.startsWith("top")?A[1]-=7:M.startsWith("bottom")&&(A[1]+=7),x[w+1]=A}return new kn(x)}const p=l.get("text-variable-anchor");if(p){let y;y=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},i)*Nn,E]:l.get("text-offset").evaluate(t,{},i).map(w=>w*Nn);const x=[];for(const w of p)x.push(w,O(w,y));return new kn(x)}return null}function gt(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Lt(r,t,i,o,l,h,p,y,x,w,M,A){let D=h.textMaxSize.evaluate(t,{});D===void 0&&(D=p);const I=r.layers[0].layout,k=I.get("icon-offset").evaluate(t,{},M),F=Yt(i.horizontal),U=p/24,X=r.tilePixelRatio*U,st=r.tilePixelRatio*D/24,Q=r.tilePixelRatio*y,it=r.tilePixelRatio*I.get("symbol-spacing"),dt=I.get("text-padding")*r.tilePixelRatio,_t=function(we,Se,de,Ye=1){const Sn=we.get("icon-padding").evaluate(Se,{},de),lr=Sn&&Sn.values;return[lr[0]*Ye,lr[1]*Ye,lr[2]*Ye,lr[3]*Ye]}(I,t,M,r.tilePixelRatio),zt=I.get("text-max-angle")/180*Math.PI,$t=I.get("text-rotation-alignment")!=="viewport"&&I.get("symbol-placement")!=="point",Zt=I.get("icon-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",Wt=I.get("symbol-placement"),oe=it/2,te=I.get("icon-text-fit");let ee;o&&te!=="none"&&(r.allowVerticalPlacement&&i.vertical&&(ee=Td(o,i.vertical,te,I.get("icon-text-fit-padding"),k,U)),F&&(o=Td(o,F,te,I.get("icon-text-fit-padding"),k,U)));const Ut=M?A.line.getGranularityForZoomLevel(M.z):1,Me=(we,Se)=>{Se.x<0||Se.x>=ge||Se.y<0||Se.y>=ge||function(de,Ye,Sn,lr,$r,$s,Fa,Pr,pn,gr,Ir,Rr,ga,Ys,_r,Na,ur,yr,vr,$n,Ji,bl,$d,wl,I_){const Yd=de.addToLineVertexArray(Ye,Sn);let Cf,Wd,Kd,Qd,Ig=0,Rg=0,Lg=0,kg=0,dg=-1,pg=-1;const pc={};let Bg=Hn("");if(de.allowVerticalPlacement&&lr.vertical){const sa=Pr.layout.get("text-rotate").evaluate(Ji,{},wl)+90;Kd=new dc(pn,Ye,gr,Ir,Rr,lr.vertical,ga,Ys,_r,sa),Fa&&(Qd=new dc(pn,Ye,gr,Ir,Rr,Fa,ur,yr,_r,sa))}if($r){const sa=Pr.layout.get("icon-rotate").evaluate(Ji,{}),Ws=Pr.layout.get("icon-text-fit")!=="none",zf=qp($r,sa,$d,Ws),Sl=Fa?qp(Fa,sa,$d,Ws):void 0;Wd=new dc(pn,Ye,gr,Ir,Rr,$r,ur,yr,!1,sa),Ig=4*zf.length;const Df=de.iconSizeData;let cu=null;Df.kind==="source"?(cu=[fs*Pr.layout.get("icon-size").evaluate(Ji,{})],cu[0]>Po&&gi(`${de.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Df.kind==="composite"&&(cu=[fs*bl.compositeIconSizes[0].evaluate(Ji,{},wl),fs*bl.compositeIconSizes[1].evaluate(Ji,{},wl)],(cu[0]>Po||cu[1]>Po)&&gi(`${de.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),de.addSymbols(de.icon,zf,cu,$n,vr,Ji,P.at.none,Ye,Yd.lineStartIndex,Yd.lineLength,-1,wl),dg=de.icon.placedSymbolArray.length-1,Sl&&(Rg=4*Sl.length,de.addSymbols(de.icon,Sl,cu,$n,vr,Ji,P.at.vertical,Ye,Yd.lineStartIndex,Yd.lineLength,-1,wl),pg=de.icon.placedSymbolArray.length-1)}const Og=Object.keys(lr.horizontal);for(const sa of Og){const Ws=lr.horizontal[sa];if(!Cf){Bg=Hn(Ws.text);const Sl=Pr.layout.get("text-rotate").evaluate(Ji,{},wl);Cf=new dc(pn,Ye,gr,Ir,Rr,Ws,ga,Ys,_r,Sl)}const zf=Ws.positionedLines.length===1;if(Lg+=Vt(de,Ye,Ws,$s,Pr,_r,Ji,Na,Yd,lr.vertical?P.at.horizontal:P.at.horizontalOnly,zf?Og:[sa],pc,dg,bl,wl),zf)break}lr.vertical&&(kg+=Vt(de,Ye,lr.vertical,$s,Pr,_r,Ji,Na,Yd,P.at.vertical,["vertical"],pc,pg,bl,wl));const R_=Cf?Cf.boxStartIndex:de.collisionBoxArray.length,L_=Cf?Cf.boxEndIndex:de.collisionBoxArray.length,k_=Kd?Kd.boxStartIndex:de.collisionBoxArray.length,B_=Kd?Kd.boxEndIndex:de.collisionBoxArray.length,O_=Wd?Wd.boxStartIndex:de.collisionBoxArray.length,F_=Wd?Wd.boxEndIndex:de.collisionBoxArray.length,N_=Qd?Qd.boxStartIndex:de.collisionBoxArray.length,U_=Qd?Qd.boxEndIndex:de.collisionBoxArray.length;let Tl=-1;const qm=(sa,Ws)=>sa&&sa.circleDiameter?Math.max(sa.circleDiameter,Ws):Ws;Tl=qm(Cf,Tl),Tl=qm(Kd,Tl),Tl=qm(Wd,Tl),Tl=qm(Qd,Tl);const Fg=Tl>-1?1:0;Fg&&(Tl*=I_/Nn),de.glyphOffsetArray.length>=ih.MAX_GLYPHS&&gi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ji.sortKey!==void 0&&de.addToSortKeyRanges(de.symbolInstances.length,Ji.sortKey);const j_=W(Pr,Ji,wl),[V_,G_]=function(sa,Ws){const zf=sa.length,Sl=Ws?.values;if(Sl?.length>0)for(let Df=0;Df<Sl.length;Df+=2){const cu=Sl[Df+1];sa.emplaceBack(P.aJ[Sl[Df]],cu[0],cu[1])}return[zf,sa.length]}(de.textAnchorOffsets,j_);de.symbolInstances.emplaceBack(Ye.x,Ye.y,pc.right>=0?pc.right:-1,pc.center>=0?pc.center:-1,pc.left>=0?pc.left:-1,pc.vertical||-1,dg,pg,Bg,R_,L_,k_,B_,O_,F_,N_,U_,gr,Lg,kg,Ig,Rg,Fg,0,ga,Tl,V_,G_)}(r,Se,we,i,o,l,ee,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,X,[dt,dt,dt,dt],$t,x,Q,_t,Zt,k,t,h,w,M,p)};if(Wt==="line")for(const we of fh(t.geometry,0,0,ge,ge)){const Se=Xn(we,Ut),de=Zm(Se,it,zt,i.vertical||F,o,24,st,r.overscaling,ge);for(const Ye of de)F&&Bt(r,F.text,oe,Ye)||Me(Se,Ye)}else if(Wt==="line-center"){for(const we of t.geometry)if(we.length>1){const Se=Xn(we,Ut),de=Hd(Se,zt,i.vertical||F,o,24,st);de&&Me(Se,de)}}else if(t.type==="Polygon")for(const we of Bl(t.geometry,0)){const Se=s(we,16);Me(Xn(we[0],Ut,!0),new xl(Se.x,Se.y,0))}else if(t.type==="LineString")for(const we of t.geometry){const Se=Xn(we,Ut);Me(Se,new xl(Se[0].x,Se[0].y,0))}else if(t.type==="Point")for(const we of t.geometry)for(const Se of we)Me([Se],new xl(Se.x,Se.y,0))}function Vt(r,t,i,o,l,h,p,y,x,w,M,A,D,I,k){const F=function(st,Q,it,dt,_t,zt,$t,Zt){const Wt=dt.layout.get("text-rotate").evaluate(zt,{})*Math.PI/180,oe=[];for(const te of Q.positionedLines)for(const ee of te.positionedGlyphs){if(!ee.rect)continue;const Ut=ee.rect||{};let Me=4,we=!0,Se=1,de=0;const Ye=(_t||Zt)&&ee.vertical,Sn=ee.metrics.advance*ee.scale/2;if(Zt&&Q.verticalizable&&(de=te.lineOffset/2-(ee.imageName?-(Nn-ee.metrics.width*ee.scale)/2:(ee.scale-1)*Nn)),ee.imageName){const yr=$t[ee.imageName];we=yr.sdf,Se=yr.pixelRatio,Me=1/Se}const lr=_t?[ee.x+Sn,ee.y]:[0,0];let $r=_t?[0,0]:[ee.x+Sn+it[0],ee.y+it[1]-de],$s=[0,0];Ye&&($s=$r,$r=[0,0]);const Fa=ee.metrics.isDoubleResolution?2:1,Pr=(ee.metrics.left-Me)*ee.scale-Sn+$r[0],pn=(-ee.metrics.top-Me)*ee.scale+$r[1],gr=Pr+Ut.w/Fa*ee.scale/Se,Ir=pn+Ut.h/Fa*ee.scale/Se,Rr=new wt(Pr,pn),ga=new wt(gr,pn),Ys=new wt(Pr,Ir),_r=new wt(gr,Ir);if(Ye){const yr=new wt(-Sn,Sn- -17),vr=-Math.PI/2,$n=12-Sn,Ji=new wt(22-$n,-(ee.imageName?$n:0)),bl=new wt(...$s);Rr._rotateAround(vr,yr)._add(Ji)._add(bl),ga._rotateAround(vr,yr)._add(Ji)._add(bl),Ys._rotateAround(vr,yr)._add(Ji)._add(bl),_r._rotateAround(vr,yr)._add(Ji)._add(bl)}if(Wt){const yr=Math.sin(Wt),vr=Math.cos(Wt),$n=[vr,-yr,yr,vr];Rr._matMult($n),ga._matMult($n),Ys._matMult($n),_r._matMult($n)}const Na=new wt(0,0),ur=new wt(0,0);oe.push({tl:Rr,tr:ga,bl:Ys,br:_r,tex:Ut,writingMode:Q.writingMode,glyphOffset:lr,sectionIndex:ee.sectionIndex,isSDF:we,pixelOffsetTL:Na,pixelOffsetBR:ur,minFontScaleX:0,minFontScaleY:0})}return oe}(0,i,y,l,h,p,o,r.allowVerticalPlacement),U=r.textSizeData;let X=null;U.kind==="source"?(X=[fs*l.layout.get("text-size").evaluate(p,{})],X[0]>Po&&gi(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):U.kind==="composite"&&(X=[fs*I.compositeTextSizes[0].evaluate(p,{},k),fs*I.compositeTextSizes[1].evaluate(p,{},k)],(X[0]>Po||X[1]>Po)&&gi(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,F,X,y,h,p,w,t,x.lineStartIndex,x.lineLength,D,k);for(const st of M)A[st]=r.text.placedSymbolArray.length-1;return 4*F.length}function Yt(r){for(const t in r)return r[t];return null}function Bt(r,t,i,o){const l=r.compareText;if(t in l){const h=l[t];for(let p=h.length-1;p>=0;p--)if(o.dist(h[p])<i)return!0}else l[t]=[];return l[t].push(o),!1}const Ft=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ye{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=o>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const h=Ft[15&o];if(!h)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new ye(y,p,h,t)}constructor(t,i=64,o=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const h=Ft.indexOf(this.ArrayType),p=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${o}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=i,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return ke(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,o,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:y}=this,x=[0,h.length-1,0],w=[];for(;x.length;){const M=x.pop()||0,A=x.pop()||0,D=x.pop()||0;if(A-D<=y){for(let U=D;U<=A;U++){const X=p[2*U],st=p[2*U+1];X>=t&&X<=o&&st>=i&&st<=l&&w.push(h[U])}continue}const I=D+A>>1,k=p[2*I],F=p[2*I+1];k>=t&&k<=o&&F>=i&&F<=l&&w.push(h[I]),(M===0?t<=k:i<=F)&&(x.push(D),x.push(I-1),x.push(1-M)),(M===0?o>=k:l>=F)&&(x.push(I+1),x.push(A),x.push(1-M))}return w}within(t,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:h,nodeSize:p}=this,y=[0,l.length-1,0],x=[],w=o*o;for(;y.length;){const M=y.pop()||0,A=y.pop()||0,D=y.pop()||0;if(A-D<=p){for(let U=D;U<=A;U++)Rt(h[2*U],h[2*U+1],t,i)<=w&&x.push(l[U]);continue}const I=D+A>>1,k=h[2*I],F=h[2*I+1];Rt(k,F,t,i)<=w&&x.push(l[I]),(M===0?t-o<=k:i-o<=F)&&(y.push(D),y.push(I-1),y.push(1-M)),(M===0?t+o>=k:i+o>=F)&&(y.push(I+1),y.push(A),y.push(1-M))}return x}}function ke(r,t,i,o,l,h){if(l-o<=i)return;const p=o+l>>1;Ni(r,t,p,o,l,h),ke(r,t,i,o,p-1,1-h),ke(r,t,i,p+1,l,1-h)}function Ni(r,t,i,o,l,h){for(;l>o;){if(l-o>600){const w=l-o+1,M=i-o+1,A=Math.log(w),D=.5*Math.exp(2*A/3),I=.5*Math.sqrt(A*D*(w-D)/w)*(M-w/2<0?-1:1);Ni(r,t,i,Math.max(o,Math.floor(i-M*D/w+I)),Math.min(l,Math.floor(i+(w-M)*D/w+I)),h)}const p=t[2*i+h];let y=o,x=l;for(St(r,t,o,i),t[2*l+h]>p&&St(r,t,o,l);y<x;){for(St(r,t,y,x),y++,x--;t[2*y+h]<p;)y++;for(;t[2*x+h]>p;)x--}t[2*o+h]===p?St(r,t,o,x):(x++,St(r,t,x,l)),x<=i&&(o=x+1),i<=x&&(l=x-1)}}function St(r,t,i,o){bt(r,i,o),bt(t,2*i,2*o),bt(t,2*i+1,2*o+1)}function bt(r,t,i){const o=r[t];r[t]=r[i],r[i]=o}function Rt(r,t,i,o){const l=r-i,h=t-o;return l*l+h*h}var Xt;P.cB=void 0,(Xt=P.cB||(P.cB={})).create="create",Xt.load="load",Xt.fullLoad="fullLoad";let Ae=null,hi=[];const Te=1e3/60,He="loadTime",ni="fullLoadTime",xi={mark(r){performance.mark(r)},frame(r){const t=r;Ae!=null&&hi.push(t-Ae),Ae=t},clearMetrics(){Ae=null,hi=[],performance.clearMeasures(He),performance.clearMeasures(ni);for(const r in P.cB)performance.clearMarks(P.cB[r])},getPerformanceMetrics(){performance.measure(He,P.cB.create,P.cB.load),performance.measure(ni,P.cB.create,P.cB.fullLoad);const r=performance.getEntriesByName(He)[0].duration,t=performance.getEntriesByName(ni)[0].duration,i=hi.length,o=1/(hi.reduce((h,p)=>h+p,0)/i/1e3),l=hi.filter(h=>h>Te).reduce((h,p)=>h+(p-Te)/Te,0);return{loadTime:r,fullLoadTime:t,fps:o,percentDroppedFrames:l/(i+l)*100,totalFrames:i}}};P.$=Js,P.A=Ee,P.B=ha,P.C=function([r,t,i]){return t+=90,t*=Math.PI/180,i*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(i),y:r*Math.sin(t)*Math.sin(i),z:r*Math.cos(i)}},P.D=pe,P.E=Tt,P.F=wa,P.G=_i,P.H=$f,P.I=Sp,P.J=function(r){if(Wi==null){const t=r.navigator?r.navigator.userAgent:null;Wi=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Wi},P.K=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new rg(()=>this.process()),this.subscription=to(this.target,"message",i=>this.receive(i),!1),this.globalScope=oa(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}unregisterMessageHandler(r){delete this.messageHandlers[r]}sendAsync(r,t){return new Promise((i,o)=>{const l=Math.round(1e18*Math.random()).toString(36).substring(0,10),h=t?to(t.signal,"abort",()=>{h?.unsubscribe(),delete this.resolveRejects[l];const x={id:l,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)},zm):null;this.resolveRejects[l]={resolve:x=>{h?.unsubscribe(),i(x)},reject:x=>{h?.unsubscribe(),o(x)}};const p=[],y=Object.assign(Object.assign({},r),{id:l,sourceMapId:this.mapId,origin:location.origin,data:go(r.data,p)});this.target.postMessage(y,{transfer:p})})}receive(r){const t=r.data,i=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(oa(self)||t.mustQueue)return this.tasks[i]=t,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const l=this.resolveRejects[r];return delete this.resolveRejects[r],l?void(t.error?l.reject(os(t.error)):l.resolve(os(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=os(t.data),o=new AbortController;this.abortControllers[r]=o;try{const l=yield this.messageHandlers[t.type](t.sourceMapId,i,o);this.completeTask(r,null,l)}catch(l){this.completeTask(r,l)}})}completeTask(r,t,i){const o=[];delete this.abortControllers[r];const l={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?go(t):null,data:go(i,o)};this.target.postMessage(l,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},P.L=ko,P.M=function(){var r=new Ee(16);return Ee!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},P.N=function(r,t,i){var o,l,h,p,y,x,w,M,A,D,I,k,F=i[0],U=i[1],X=i[2];return t===r?(r[12]=t[0]*F+t[4]*U+t[8]*X+t[12],r[13]=t[1]*F+t[5]*U+t[9]*X+t[13],r[14]=t[2]*F+t[6]*U+t[10]*X+t[14],r[15]=t[3]*F+t[7]*U+t[11]*X+t[15]):(l=t[1],h=t[2],p=t[3],y=t[4],x=t[5],w=t[6],M=t[7],A=t[8],D=t[9],I=t[10],k=t[11],r[0]=o=t[0],r[1]=l,r[2]=h,r[3]=p,r[4]=y,r[5]=x,r[6]=w,r[7]=M,r[8]=A,r[9]=D,r[10]=I,r[11]=k,r[12]=o*F+y*U+A*X+t[12],r[13]=l*F+x*U+D*X+t[13],r[14]=h*F+w*U+I*X+t[14],r[15]=p*F+M*U+k*X+t[15]),r},P.O=function(r,t,i){var o=i[0],l=i[1],h=i[2];return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=t[3]*o,r[4]=t[4]*l,r[5]=t[5]*l,r[6]=t[6]*l,r[7]=t[7]*l,r[8]=t[8]*h,r[9]=t[9]*h,r[10]=t[10]*h,r[11]=t[11]*h,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},P.P=wt,P.Q=function(r,t,i){var o=t[0],l=t[1],h=t[2],p=t[3],y=t[4],x=t[5],w=t[6],M=t[7],A=t[8],D=t[9],I=t[10],k=t[11],F=t[12],U=t[13],X=t[14],st=t[15],Q=i[0],it=i[1],dt=i[2],_t=i[3];return r[0]=Q*o+it*y+dt*A+_t*F,r[1]=Q*l+it*x+dt*D+_t*U,r[2]=Q*h+it*w+dt*I+_t*X,r[3]=Q*p+it*M+dt*k+_t*st,r[4]=(Q=i[4])*o+(it=i[5])*y+(dt=i[6])*A+(_t=i[7])*F,r[5]=Q*l+it*x+dt*D+_t*U,r[6]=Q*h+it*w+dt*I+_t*X,r[7]=Q*p+it*M+dt*k+_t*st,r[8]=(Q=i[8])*o+(it=i[9])*y+(dt=i[10])*A+(_t=i[11])*F,r[9]=Q*l+it*x+dt*D+_t*U,r[10]=Q*h+it*w+dt*I+_t*X,r[11]=Q*p+it*M+dt*k+_t*st,r[12]=(Q=i[12])*o+(it=i[13])*y+(dt=i[14])*A+(_t=i[15])*F,r[13]=Q*l+it*x+dt*D+_t*U,r[14]=Q*h+it*w+dt*I+_t*X,r[15]=Q*p+it*M+dt*k+_t*st,r},P.R=Hr,P.S=function(r,t){const i={};for(let o=0;o<t.length;o++){const l=t[o];l in r&&(i[l]=r[l])}return i},P.T=ld,P.U=Io,P.V=Ue,P.W=Id,P.X=Dp,P.Y=Ct,P.Z=Ai,P._=d,P.a=ms,P.a$=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]},P.a0=We,P.a1=cf,P.a2=Rd,P.a3=ge,P.a4=function(r,t){var i,o,l,h,p;if(!r)return t??{};if(!t)return r;let y=Object.assign({},r);if(t.removeAll&&(y={removeAll:!0}),t.remove){const x=new Set(t.remove);y.add&&(y.add=y.add.filter(M=>!x.has(M.id))),y.update&&(y.update=y.update.filter(M=>!x.has(M.id)));const w=new Set(((i=r.add)!==null&&i!==void 0?i:[]).map(M=>M.id));t.remove=t.remove.filter(M=>!w.has(M))}if(t.remove){const x=new Set(y.remove?y.remove.concat(t.remove):t.remove);y.remove=Array.from(x.values())}if(t.add){const x=y.add?y.add.concat(t.add):t.add,w=new Map(x.map(M=>[M.id,M]));y.add=Array.from(w.values())}if(t.update){const x=new Map((o=y.update)===null||o===void 0?void 0:o.map(w=>[w.id,w]));for(const w of t.update){const M=(l=x.get(w.id))!==null&&l!==void 0?l:{id:w.id};w.newGeometry&&(M.newGeometry=w.newGeometry),w.addOrUpdateProperties&&(M.addOrUpdateProperties=((h=M.addOrUpdateProperties)!==null&&h!==void 0?h:[]).concat(w.addOrUpdateProperties)),w.removeProperties&&(M.removeProperties=((p=M.removeProperties)!==null&&p!==void 0?p:[]).concat(w.removeProperties)),w.removeAllProperties&&(M.removeAllProperties=!0),x.set(w.id,M)}y.update=Array.from(x.values())}return y.remove&&y.add&&(y.remove=y.remove.filter(x=>y.add.findIndex(w=>w.id===x)===-1)),y},P.a5=hf,P.a6=ic,P.a7=25,P.a8=Ld,P.a9=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(i=>{t.onloadstart=()=>{i(t)};for(const o of r){const l=window.document.createElement("source");j(o)||(t.crossOrigin="Anonymous"),l.src=o,t.appendChild(l)}})},P.aA=Md,P.aB=br,P.aC=function(r,t,i,o){const l=t.y-r.y,h=t.x-r.x,p=o.y-i.y,y=o.x-i.x,x=p*h-y*l;if(x===0)return null;const w=(y*(r.y-i.y)-p*(r.x-i.x))/x;return new wt(r.x+w*h,r.y+w*l)},P.aD=fh,P.aE=sp,P.aF=function(r){let t=1/0,i=1/0,o=-1/0,l=-1/0;for(const h of r)t=Math.min(t,h.x),i=Math.min(i,h.y),o=Math.max(o,h.x),l=Math.max(l,h.y);return[t,i,o,l]},P.aG=Nn,P.aH=oi,P.aI=function(r,t,i,o,l=!1){if(!i[0]&&!i[1])return[0,0];const h=l?o==="map"?-r.bearingInRadians:0:o==="viewport"?r.bearingInRadians:0;if(h){const p=Math.sin(h),y=Math.cos(h);i=[i[0]*y-i[1]*p,i[0]*p+i[1]*y]}return[l?i[0]:oi(t,i[0],r.zoom),l?i[1]:oi(t,i[1],r.zoom)]},P.aK=ds,P.aL=gt,P.aM=Ei,P.aN=ye,P.aO=yi,P.aP=cd,P.aQ=J,P.aR=me,P.aS=Kt,P.aT=kr,P.aU=Pp,P.aV=Yn,P.aW=$i,P.aX=function(r){var t=new Ee(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},P.aY=function(r,t,i){return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],r},P.aZ=function(r,t){var i=t[0],o=t[1],l=t[2],h=i*i+o*o+l*l;return h>0&&(h=1/Math.sqrt(h)),r[0]=t[0]*h,r[1]=t[1]*h,r[2]=t[2]*h,r},P.a_=bi,P.aa=Qt,P.ab=function(){return wi++},P.ac=_,P.ad=ih,P.ae=Vr,P.af=Ns,P.ag=Pm,P.ah=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,l,h)=>{const p=l||h;return t[o]=!p||p.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t},P.ai=ze,P.aj=85.051129,P.ak=Ln,P.al=function(r){return Math.pow(2,r)},P.am=Ci,P.an=rh,P.ao=function(r){return Math.log(r)/Math.LN2},P.ap=function(r){var t=r[0],i=r[1];return t*t+i*i},P.aq=class{constructor(r,t){this.max=r,this.onRemove=t,this.reset()}reset(){for(const r in this.data)for(const t of this.data[r])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(r,t,i){const o=r.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const l={value:t,timeout:void 0};if(i!==void 0&&(l.timeout=setTimeout(()=>{this.remove(r,l)},i)),this.data[o].push(l),this.order.push(o),this.order.length>this.max){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const t=this.data[r].shift();return t.timeout&&clearTimeout(t.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),t.value}getByKey(r){const t=this.data[r];return t?t[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,t){if(!this.has(r))return this;const i=r.wrapped().key,o=t===void 0?0:this.data[i].indexOf(t),l=this.data[i][o];return this.data[i].splice(o,1),l.timeout&&clearTimeout(l.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(l.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(r){const t=[];for(const i in this.data)for(const o of this.data[i])r(o.value)||t.push(o);for(const i of t)this.remove(i.value.tileID,i)}},P.ar=function(r){if(!r.length)return new Set;const t=Math.max(...r.map(x=>x.canonical.z));let i=1/0,o=-1/0,l=1/0,h=-1/0;const p=[];for(const x of r){const{x:w,y:M,z:A}=x.canonical,D=Math.pow(2,t-A),I=w*D,k=M*D;p.push({id:x,x:I,y:k}),I<i&&(i=I),I>o&&(o=I),k<l&&(l=k),k>h&&(h=k)}const y=new Set;for(const x of p)x.x!==i&&x.x!==o&&x.y!==l&&x.y!==h||y.add(x.id);return y},P.as=function(r,t){let i=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:l,minZoom:h,maxZoom:p}=r,y=l?ze(qn.interpolationFactor(l,t,h,p),0,1):0;r.kind==="camera"?o=wa.number(r.minSize,r.maxSize,y):i=y}return{uSizeT:i,uSize:o}},P.au=function(r,{uSize:t,uSizeT:i},{lowerSize:o,upperSize:l}){return r.kind==="source"?o/fs:r.kind==="composite"?wa.number(o/fs,l/fs,i):t},P.av=function(r,t){var i=t[0],o=t[1],l=t[2],h=t[3],p=t[4],y=t[5],x=t[6],w=t[7],M=t[8],A=t[9],D=t[10],I=t[11],k=t[12],F=t[13],U=t[14],X=t[15],st=i*y-o*p,Q=i*x-l*p,it=i*w-h*p,dt=o*x-l*y,_t=o*w-h*y,zt=l*w-h*x,$t=M*F-A*k,Zt=M*U-D*k,Wt=M*X-I*k,oe=A*U-D*F,te=A*X-I*F,ee=D*X-I*U,Ut=st*ee-Q*te+it*oe+dt*Wt-_t*Zt+zt*$t;return Ut?(r[0]=(y*ee-x*te+w*oe)*(Ut=1/Ut),r[1]=(l*te-o*ee-h*oe)*Ut,r[2]=(F*zt-U*_t+X*dt)*Ut,r[3]=(D*_t-A*zt-I*dt)*Ut,r[4]=(x*Wt-p*ee-w*Zt)*Ut,r[5]=(i*ee-l*Wt+h*Zt)*Ut,r[6]=(U*it-k*zt-X*Q)*Ut,r[7]=(M*zt-D*it+I*Q)*Ut,r[8]=(p*te-y*Wt+w*$t)*Ut,r[9]=(o*Wt-i*te-h*$t)*Ut,r[10]=(k*_t-F*it+X*st)*Ut,r[11]=(A*it-M*_t-I*st)*Ut,r[12]=(y*Zt-p*oe-x*$t)*Ut,r[13]=(i*oe-o*Zt+l*$t)*Ut,r[14]=(F*Q-k*dt-U*st)*Ut,r[15]=(M*dt-A*Q+D*st)*Ut,r):null},P.aw=ne,P.ax=function(r){var t=r[0],i=r[1];return Math.sqrt(t*t+i*i)},P.ay=function(r){return r[0]=0,r[1]=0,r},P.az=function(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r},P.b=ya,P.b$=function(r,t){var i=Math.sin(t),o=Math.cos(t);return r[0]=o,r[1]=i,r[2]=0,r[3]=-i,r[4]=o,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},P.b0=function(r,t,i){return r[0]=t[0]*i[0],r[1]=t[1]*i[1],r[2]=t[2]*i[2],r[3]=t[3]*i[3],r},P.b1=Re,P.b2=function(r,t,i){const o=t[0]*i[0]+t[1]*i[1]+t[2]*i[2];return o===0?null:(-(r[0]*i[0]+r[1]*i[1]+r[2]*i[2])-i[3])/o},P.b3=xr,P.b4=function(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r},P.b5=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]},P.b6=Ip,P.b7=au,P.b8=function(r,t,i,o,l){var h=1/Math.tan(t/2);if(r[0]=h/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,l!=null&&l!==1/0){var p=1/(o-l);r[10]=(l+o)*p,r[14]=2*l*o*p}else r[10]=-1,r[14]=-2*o;return r},P.b9=function(r){var t=new Ee(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},P.bA=function(r,t,i,o){var l=[],h=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],h[0]=l[0]*Math.cos(o)-l[1]*Math.sin(o),h[1]=l[0]*Math.sin(o)+l[1]*Math.cos(o),h[2]=l[2],r[0]=h[0]+i[0],r[1]=h[1]+i[1],r[2]=h[2]+i[2],r},P.bB=function(r,t,i,o){var l=[],h=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],h[0]=l[0],h[1]=l[1]*Math.cos(o)-l[2]*Math.sin(o),h[2]=l[1]*Math.sin(o)+l[2]*Math.cos(o),r[0]=h[0]+i[0],r[1]=h[1]+i[1],r[2]=h[2]+i[2],r},P.bC=function(r,t,i,o){var l=[],h=[];return l[0]=t[0]-i[0],l[1]=t[1]-i[1],l[2]=t[2]-i[2],h[0]=l[2]*Math.sin(o)+l[0]*Math.cos(o),h[1]=l[1],h[2]=l[2]*Math.cos(o)-l[0]*Math.sin(o),r[0]=h[0]+i[0],r[1]=h[1]+i[1],r[2]=h[2]+i[2],r},P.bD=function(r,t,i){var o=Math.sin(i),l=Math.cos(i),h=t[0],p=t[1],y=t[2],x=t[3],w=t[8],M=t[9],A=t[10],D=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=h*l-w*o,r[1]=p*l-M*o,r[2]=y*l-A*o,r[3]=x*l-D*o,r[8]=h*o+w*l,r[9]=p*o+M*l,r[10]=y*o+A*l,r[11]=x*o+D*l,r},P.bE=function(r,t){const i=vt(r,360),o=vt(t,360),l=o-i,h=o>i?l-360:l+360;return Math.abs(l)<Math.abs(h)?l:h},P.bF=function(r){return r[0]=0,r[1]=0,r[2]=0,r},P.bG=function(r,t,i,o){const l=Math.sqrt(r*r+t*t),h=Math.sqrt(i*i+o*o);r/=l,t/=l,i/=h,o/=h;const p=Math.acos(r*i+t*o);return-t*i+r*o>0?p:-p},P.bH=function(r,t){const i=vt(r,2*Math.PI),o=vt(t,2*Math.PI);return Math.min(Math.abs(i-o),Math.abs(i-o+2*Math.PI),Math.abs(i-o-2*Math.PI))},P.bI=function(){const r={},t=tt.$version;for(const i in tt.$root){const o=tt.$root[i];if(o.required){let l=null;l=i==="version"?t:o.type==="array"?[]:{},l!=null&&(r[i]=l)}}return r},P.bJ=Zi,P.bK=Fc,P.bL=function r(t,i){if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let o=0;o<t.length;o++)if(!r(t[o],i[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&i!==null){if(typeof i!="object"||Object.keys(t).length!==Object.keys(i).length)return!1;for(const o in t)if(!r(t[o],i[o]))return!1;return!0}return t===i},P.bM=function(r){r=r.slice();const t=Object.create(null);for(let i=0;i<r.length;i++)t[r[i].id]=r[i];for(let i=0;i<r.length;i++)"ref"in r[i]&&(r[i]=It(r[i],t[r[i].ref]));return r},P.bN=function(r,t){if(r.type==="custom")return new lf(r,t);switch(r.type){case"background":return new ng(r,t);case"circle":return new nm(r,t);case"color-relief":return new ln(r,t);case"fill":return new cm(r,t);case"fill-extrusion":return new Jl(r,t);case"heatmap":return new ol(r,t);case"hillshade":return new rm(r,t);case"line":return new gd(r,t);case"raster":return new Wf(r,t);case"symbol":return new nh(r,t)}},P.bO=r=>r.type==="raster",P.bP=Wn,P.bQ=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let i=[];try{if(!kt(r.version,t.version))return[{command:"setStyle",args:[t]}];kt(r.center,t.center)||i.push({command:"setCenter",args:[t.center]}),kt(r.state,t.state)||i.push({command:"setGlobalState",args:[t.state]}),kt(r.centerAltitude,t.centerAltitude)||i.push({command:"setCenterAltitude",args:[t.centerAltitude]}),kt(r.zoom,t.zoom)||i.push({command:"setZoom",args:[t.zoom]}),kt(r.bearing,t.bearing)||i.push({command:"setBearing",args:[t.bearing]}),kt(r.pitch,t.pitch)||i.push({command:"setPitch",args:[t.pitch]}),kt(r.roll,t.roll)||i.push({command:"setRoll",args:[t.roll]}),kt(r.sprite,t.sprite)||i.push({command:"setSprite",args:[t.sprite]}),kt(r.glyphs,t.glyphs)||i.push({command:"setGlyphs",args:[t.glyphs]}),kt(r.transition,t.transition)||i.push({command:"setTransition",args:[t.transition]}),kt(r.light,t.light)||i.push({command:"setLight",args:[t.light]}),kt(r.terrain,t.terrain)||i.push({command:"setTerrain",args:[t.terrain]}),kt(r.sky,t.sky)||i.push({command:"setSky",args:[t.sky]}),kt(r.projection,t.projection)||i.push({command:"setProjection",args:[t.projection]});const o={},l=[];(function(p,y,x,w){let M;for(M in y=y||{},p=p||{})Object.prototype.hasOwnProperty.call(p,M)&&(Object.prototype.hasOwnProperty.call(y,M)||xe(M,x,w));for(M in y)Object.prototype.hasOwnProperty.call(y,M)&&(Object.prototype.hasOwnProperty.call(p,M)?kt(p[M],y[M])||(p[M].type==="geojson"&&y[M].type==="geojson"&&en(p,y,M)?Ot(x,{command:"setGeoJSONSourceData",args:[M,y[M].data]}):Le(M,y,x,w)):ue(M,y,x))})(r.sources,t.sources,l,o);const h=[];r.layers&&r.layers.forEach(p=>{"source"in p&&o[p.source]?i.push({command:"removeLayer",args:[p.id]}):h.push(p)}),i=i.concat(l),function(p,y,x){y=y||[];const w=(p=p||[]).map(li),M=y.map(li),A=p.reduce(zi,{}),D=y.reduce(zi,{}),I=w.slice(),k=Object.create(null);let F,U,X,st,Q;for(let it=0,dt=0;it<w.length;it++)F=w[it],Object.prototype.hasOwnProperty.call(D,F)?dt++:(Ot(x,{command:"removeLayer",args:[F]}),I.splice(I.indexOf(F,dt),1));for(let it=0,dt=0;it<M.length;it++)F=M[M.length-1-it],I[I.length-1-it]!==F&&(Object.prototype.hasOwnProperty.call(A,F)?(Ot(x,{command:"removeLayer",args:[F]}),I.splice(I.lastIndexOf(F,I.length-dt),1)):dt++,st=I[I.length-it],Ot(x,{command:"addLayer",args:[D[F],st]}),I.splice(I.length-it,0,F),k[F]=!0);for(let it=0;it<M.length;it++)if(F=M[it],U=A[F],X=D[F],!k[F]&&!kt(U,X))if(kt(U.source,X.source)&&kt(U["source-layer"],X["source-layer"])&&kt(U.type,X.type)){for(Q in Ge(U.layout,X.layout,x,F,null,"setLayoutProperty"),Ge(U.paint,X.paint,x,F,null,"setPaintProperty"),kt(U.filter,X.filter)||Ot(x,{command:"setFilter",args:[F,X.filter]}),kt(U.minzoom,X.minzoom)&&kt(U.maxzoom,X.maxzoom)||Ot(x,{command:"setLayerZoomRange",args:[F,X.minzoom,X.maxzoom]}),U)Object.prototype.hasOwnProperty.call(U,Q)&&Q!=="layout"&&Q!=="paint"&&Q!=="filter"&&Q!=="metadata"&&Q!=="minzoom"&&Q!=="maxzoom"&&(Q.indexOf("paint.")===0?Ge(U[Q],X[Q],x,F,Q.slice(6),"setPaintProperty"):kt(U[Q],X[Q])||Ot(x,{command:"setLayerProperty",args:[F,Q,X[Q]]}));for(Q in X)Object.prototype.hasOwnProperty.call(X,Q)&&!Object.prototype.hasOwnProperty.call(U,Q)&&Q!=="layout"&&Q!=="paint"&&Q!=="filter"&&Q!=="metadata"&&Q!=="minzoom"&&Q!=="maxzoom"&&(Q.indexOf("paint.")===0?Ge(U[Q],X[Q],x,F,Q.slice(6),"setPaintProperty"):kt(U[Q],X[Q])||Ot(x,{command:"setLayerProperty",args:[F,Q,X[Q]]}))}else Ot(x,{command:"removeLayer",args:[F]}),st=I[I.lastIndexOf(F)+1],Ot(x,{command:"addLayer",args:[X,st]})}(h,t.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[t]}]}return i},P.bR=function(r){const t=[],i=r.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},P.bS=Lr,P.bT=Wr,P.bU=class extends ia{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},P.bV=qr,P.bW=class extends ia{constructor(r,t){super(r,t),this.current=ks}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},P.bX=Ls,P.bY=class extends ia{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},P.bZ=class extends ia{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},P.b_=di,P.ba=function(r,t,i){var o=Math.sin(i),l=Math.cos(i),h=t[0],p=t[1],y=t[2],x=t[3],w=t[4],M=t[5],A=t[6],D=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=h*l+w*o,r[1]=p*l+M*o,r[2]=y*l+A*o,r[3]=x*l+D*o,r[4]=w*l-h*o,r[5]=M*l-p*o,r[6]=A*l-y*o,r[7]=D*l-x*o,r},P.bb=function(r,t,i){var o=Math.sin(i),l=Math.cos(i),h=t[4],p=t[5],y=t[6],x=t[7],w=t[8],M=t[9],A=t[10],D=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=h*l+w*o,r[5]=p*l+M*o,r[6]=y*l+A*o,r[7]=x*l+D*o,r[8]=w*l-h*o,r[9]=M*l-p*o,r[10]=A*l-y*o,r[11]=D*l-x*o,r},P.bc=function(){const r=new Float32Array(16);return Ci(r),r},P.bd=function(){const r=new Float64Array(16);return Ci(r),r},P.be=function(){return new Float64Array(16)},P.bf=function(r,t,i){const o=new Float64Array(4);return Nt(o,r,t-90,i),o},P.bg=function(r,t,i,o){var l,h,p,y,x,w=t[0],M=t[1],A=t[2],D=t[3],I=i[0],k=i[1],F=i[2],U=i[3];return(h=w*I+M*k+A*F+D*U)<0&&(h=-h,I=-I,k=-k,F=-F,U=-U),1-h>ti?(l=Math.acos(h),p=Math.sin(l),y=Math.sin((1-o)*l)/p,x=Math.sin(o*l)/p):(y=1-o,x=o),r[0]=y*w+x*I,r[1]=y*M+x*k,r[2]=y*A+x*F,r[3]=y*D+x*U,r},P.bh=function(r){const t=new Float64Array(9);var i,o,l,h,p,y,x,w,M,A,D,I,k,F,U,X,st,Q;A=(l=(o=r)[0])*(x=l+l),D=(h=o[1])*x,k=(p=o[2])*x,F=p*(w=h+h),X=(y=o[3])*x,st=y*w,Q=y*(M=p+p),(i=t)[0]=1-(I=h*w)-(U=p*M),i[3]=D-Q,i[6]=k+st,i[1]=D+Q,i[4]=1-A-U,i[7]=F-X,i[2]=k-st,i[5]=F+X,i[8]=1-A-I;const it=kr(-Math.asin(ze(t[2],-1,1)));let dt,_t;return Math.hypot(t[5],t[8])<.001?(dt=0,_t=-kr(Math.atan2(t[3],t[4]))):(dt=kr(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),_t=kr(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:dt,pitch:it+90,bearing:_t}},P.bi=function(r,t){return r.roll==t.roll&&r.pitch==t.pitch&&r.bearing==t.bearing},P.bj=Xe,P.bk=To,P.bl=ul,P.bm=dr,P.bn=Yu,P.bo=qt,P.bp=ae,P.bq=Zn,P.br=function(r,t,i,o,l){return qt(o,l,ze((r-t)/(i-t),0,1))},P.bs=vt,P.bt=function(){return new Float64Array(3)},P.bu=function(r,t,i,o){return r[0]=t[0]+i[0]*o,r[1]=t[1]+i[1]*o,r[2]=t[2]+i[2]*o,r},P.bv=Nt,P.bw=function(r,t,i){var o=i[0],l=i[1],h=i[2],p=i[3],y=t[0],x=t[1],w=t[2],M=l*w-h*x,A=h*y-o*w,D=o*x-l*y;return r[0]=y+p*(M+=M)+l*(D+=D)-h*(A+=A),r[1]=x+p*A+h*M-o*D,r[2]=w+p*D+o*A-l*M,r},P.bx=function(r,t,i){const o=(l=[r[0],r[1],r[2],t[0],t[1],t[2],i[0],i[1],i[2]])[0]*((M=l[8])*(p=l[4])-(y=l[5])*(w=l[7]))+l[1]*(-M*(h=l[3])+y*(x=l[6]))+l[2]*(w*h-p*x);var l,h,p,y,x,w,M;if(o===0)return null;const A=bi([],[t[0],t[1],t[2]],[i[0],i[1],i[2]]),D=bi([],[i[0],i[1],i[2]],[r[0],r[1],r[2]]),I=bi([],[r[0],r[1],r[2]],[t[0],t[1],t[2]]),k=Yn([],A,-r[3]);return $i(k,k,Yn([],D,-t[3])),$i(k,k,Yn([],I,-i[3])),Yn(k,k,1/o),k},P.by=Je,P.bz=function(){return new Float64Array(4)},P.c=zl,P.c$=function(r,t){const i=new Map;if(r!=null)if(r.type==="Feature")i.set(Un(r,t),r);else for(const o of r.features)i.set(Un(o,t),o);return i},P.c0=function(r,t,i){var o=t[0],l=t[1],h=t[2];return r[0]=o*i[0]+l*i[3]+h*i[6],r[1]=o*i[1]+l*i[4]+h*i[7],r[2]=o*i[2]+l*i[5]+h*i[8],r},P.c1=function(r,t,i,o,l,h,p){var y=1/(t-i),x=1/(o-l),w=1/(h-p);return r[0]=-2*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*w,r[11]=0,r[12]=(t+i)*y,r[13]=(l+o)*x,r[14]=(p+h)*w,r[15]=1,r},P.c2=class extends ia{constructor(r,t){super(r,t),this.current=new Array}set(r){if(r!=this.current){this.current=r;const t=new Float32Array(4*r.length);for(let i=0;i<r.length;i++)t[4*i]=r[i].r,t[4*i+1]=r[i].g,t[4*i+2]=r[i].b,t[4*i+3]=r[i].a;this.gl.uniform4fv(this.location,t)}}},P.c3=class extends ia{constructor(r,t){super(r,t),this.current=new Array}set(r){if(r!=this.current){this.current=r;const t=new Float32Array(r);this.gl.uniform1fv(this.location,t)}}},P.c4=class extends Zc{},P.c5=hl,P.c6=class extends wo{},P.c7=sd,P.c8=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},P.c9=ad,P.cA=xi,P.cC=function(r){return r.message===Va},P.cD=wr,P.cE=function(r,t){ms.REGISTERED_PROTOCOLS[r]=t},P.cF=function(r){delete ms.REGISTERED_PROTOCOLS[r]},P.cG=function(r,t){const i={};for(let l=0;l<r.length;l++){const h=t&&t[r[l].id]||ii(r[l]);t&&(t[r[l].id]=h);let p=i[h];p||(p=i[h]=[]),p.push(r[l])}const o=[];for(const l in i)o.push(i[l]);return o},P.cH=le,P.cI=Rp,P.cJ=_l,P.cK=bm,P.cL=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=ge/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],i=t.layout,o=t._unevaluatedLayout._values,l={layoutIconSize:o["icon-size"].possiblyEvaluate(new _i(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new _i(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new _i(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:w,maxZoom:M}=r.bucket.textSizeData;l.compositeTextSizes=[o["text-size"].possiblyEvaluate(new _i(w),r.canonical),o["text-size"].possiblyEvaluate(new _i(M),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:w,maxZoom:M}=r.bucket.iconSizeData;l.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new _i(w),r.canonical),o["icon-size"].possiblyEvaluate(new _i(M),r.canonical)]}const h=i.get("text-line-height")*Nn,p=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",y=i.get("text-keep-upright"),x=i.get("text-size");for(const w of r.bucket.features){const M=i.get("text-font").evaluate(w,{},r.canonical).join(","),A=x.evaluate(w,{},r.canonical),D=l.layoutTextSize.evaluate(w,{},r.canonical),I=l.layoutIconSize.evaluate(w,{},r.canonical),k={horizontal:{},vertical:void 0},F=w.text;let U,X=[0,0];if(F){const it=F.toString(),dt=i.get("text-letter-spacing").evaluate(w,{},r.canonical)*Nn,_t=Uc(it)?dt:0,zt=i.get("text-anchor").evaluate(w,{},r.canonical),$t=W(t,w,r.canonical);if(!$t){const te=i.get("text-radial-offset").evaluate(w,{},r.canonical);X=te?O(zt,[te*Nn,E]):i.get("text-offset").evaluate(w,{},r.canonical).map(ee=>ee*Nn)}let Zt=p?"center":i.get("text-justify").evaluate(w,{},r.canonical);const Wt=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(w,{},r.canonical)*Nn:1/0,oe=()=>{r.bucket.allowVerticalPlacement&&Nc(it)&&(k.vertical=tc(F,r.glyphMap,r.glyphPositions,r.imagePositions,M,Wt,h,zt,"left",_t,X,P.at.vertical,!0,D,A))};if(!p&&$t){const te=new Set;if(Zt==="auto")for(let Ut=0;Ut<$t.values.length;Ut+=2)te.add(gt($t.values[Ut]));else te.add(Zt);let ee=!1;for(const Ut of te)if(!k.horizontal[Ut])if(ee)k.horizontal[Ut]=k.horizontal[0];else{const Me=tc(F,r.glyphMap,r.glyphPositions,r.imagePositions,M,Wt,h,"center",Ut,_t,X,P.at.horizontal,!1,D,A);Me&&(k.horizontal[Ut]=Me,ee=Me.positionedLines.length===1)}oe()}else{Zt==="auto"&&(Zt=gt(zt));const te=tc(F,r.glyphMap,r.glyphPositions,r.imagePositions,M,Wt,h,zt,Zt,_t,X,P.at.horizontal,!1,D,A);te&&(k.horizontal[Zt]=te),oe(),Nc(it)&&p&&y&&(k.vertical=tc(F,r.glyphMap,r.glyphPositions,r.imagePositions,M,Wt,h,zt,Zt,_t,X,P.at.vertical,!1,D,A))}}let st=!1;if(w.icon&&w.icon.name){const it=r.imageMap[w.icon.name];it&&(U=wd(r.imagePositions[w.icon.name],i.get("icon-offset").evaluate(w,{},r.canonical),i.get("icon-anchor").evaluate(w,{},r.canonical)),st=!!it.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=st:r.bucket.sdfIcons!==st&&gi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(it.pixelRatio!==r.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const Q=Yt(k.horizontal)||k.vertical;r.bucket.iconsInText=!!Q&&Q.iconsInText,(Q||U)&&Lt(r.bucket,w,k,U,r.imageMap,l,D,I,X,st,r.canonical,r.subdivisionGranularity)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},P.cM=Vs,P.cN=mi,P.cO=eu,P.cP=Qc,P.cQ=yd,P.cR=Zs,P.cS=function(r,t,i,o,l,h){let p=vl(r,t,i,l,0);return p=vl(p,t,o,h,1),p},P.cT=class{constructor(r){this.maxEntries=r,this.map=new Map}get(r){const t=this.map.get(r);return t!==void 0&&(this.map.delete(r),this.map.set(r,t)),t}set(r,t){if(this.map.has(r))this.map.delete(r);else if(this.map.size>=this.maxEntries){const i=this.map.keys().next().value;this.map.delete(i)}this.map.set(r,t)}clear(){this.map.clear()}},P.cU=tf,P.cV=gl,P.cW=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},P.cX=function(r,t,i,o,l){return d(this,void 0,void 0,function*(){if(Ai())try{return yield Js(r,t,i,o,l)}catch{}return function(h,p,y,x,w){const M=h.width,A=h.height;Ua&&ja||(Ua=new OffscreenCanvas(M,A),ja=Ua.getContext("2d",{willReadFrequently:!0})),Ua.width=M,Ua.height=A,ja.drawImage(h,0,0,M,A);const D=ja.getImageData(p,y,x,w);return ja.clearRect(0,0,M,A),D.data}(r,t,i,o,l)})},P.cY=Xh,P.cZ=At,P.c_=jl,P.ca=function(r,t,i){var o=t[0],l=t[1],h=t[2],p=i[3]*o+i[7]*l+i[11]*h+i[15];return r[0]=(i[0]*o+i[4]*l+i[8]*h+i[12])/(p=p||1),r[1]=(i[1]*o+i[5]*l+i[9]*h+i[13])/p,r[2]=(i[2]*o+i[6]*l+i[10]*h+i[14])/p,r},P.cb=class extends sn{},P.cc=class extends a{},P.cd=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},P.ce=function(r,t){var i=r[0],o=r[1],l=r[2],h=r[3],p=r[4],y=r[5],x=r[6],w=r[7],M=r[8],A=r[9],D=r[10],I=r[11],k=r[12],F=r[13],U=r[14],X=r[15],st=t[0],Q=t[1],it=t[2],dt=t[3],_t=t[4],zt=t[5],$t=t[6],Zt=t[7],Wt=t[8],oe=t[9],te=t[10],ee=t[11],Ut=t[12],Me=t[13],we=t[14],Se=t[15];return Math.abs(i-st)<=ti*Math.max(1,Math.abs(i),Math.abs(st))&&Math.abs(o-Q)<=ti*Math.max(1,Math.abs(o),Math.abs(Q))&&Math.abs(l-it)<=ti*Math.max(1,Math.abs(l),Math.abs(it))&&Math.abs(h-dt)<=ti*Math.max(1,Math.abs(h),Math.abs(dt))&&Math.abs(p-_t)<=ti*Math.max(1,Math.abs(p),Math.abs(_t))&&Math.abs(y-zt)<=ti*Math.max(1,Math.abs(y),Math.abs(zt))&&Math.abs(x-$t)<=ti*Math.max(1,Math.abs(x),Math.abs($t))&&Math.abs(w-Zt)<=ti*Math.max(1,Math.abs(w),Math.abs(Zt))&&Math.abs(M-Wt)<=ti*Math.max(1,Math.abs(M),Math.abs(Wt))&&Math.abs(A-oe)<=ti*Math.max(1,Math.abs(A),Math.abs(oe))&&Math.abs(D-te)<=ti*Math.max(1,Math.abs(D),Math.abs(te))&&Math.abs(I-ee)<=ti*Math.max(1,Math.abs(I),Math.abs(ee))&&Math.abs(k-Ut)<=ti*Math.max(1,Math.abs(k),Math.abs(Ut))&&Math.abs(F-Me)<=ti*Math.max(1,Math.abs(F),Math.abs(Me))&&Math.abs(U-we)<=ti*Math.max(1,Math.abs(U),Math.abs(we))&&Math.abs(X-Se)<=ti*Math.max(1,Math.abs(X),Math.abs(Se))},P.cf=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},P.cg=r=>r.type==="symbol",P.ch=r=>r.type==="circle",P.ci=r=>r.type==="heatmap",P.cj=r=>r.type==="line",P.ck=r=>r.type==="fill",P.cl=r=>r.type==="fill-extrusion",P.cm=r=>r.type==="hillshade",P.cn=r=>r.type==="color-relief",P.co=r=>r.type==="background",P.cp=r=>r.type==="custom",P.cq=fe,P.cr=function(r,t,i){const o=Pe(t.x-i.x,t.y-i.y),l=Pe(r.x-i.x,r.y-i.y);var h,p;return kr(Math.atan2(o[0]*l[1]-o[1]*l[0],(h=o)[0]*(p=l)[0]+h[1]*p[1]))},P.cs=Ce,P.ct=function(r,t){return Cl[t]&&(r instanceof MouseEvent||r instanceof WheelEvent)},P.cu=function(r,t){return Al[t]&&"touches"in r},P.cv=function(r){return Al[r]||Cl[r]},P.cw=function(r,t,i){var o=t[0],l=t[1];return r[0]=i[0]*o+i[4]*l+i[12],r[1]=i[1]*o+i[5]*l+i[13],r},P.cx=function(r,t){const{x:i,y:o}=hf.fromLngLat(t);return!(r<0||r>25||o<0||o>=1||i<0||i>=1)},P.cy=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},P.cz=class extends pi{},P.d=j,P.d0=function(r,t){if(r==null)return!0;if(r.type==="Feature")return Un(r,t)!=null;if(r.type==="FeatureCollection"){const i=new Set;for(const o of r.features){const l=Un(o,t);if(l==null||i.has(l))return!1;i.add(l)}return!0}return!1},P.d1=function(r,t,i){var o,l,h,p;if(t.removeAll&&r.clear(),t.remove)for(const y of t.remove)r.delete(y);if(t.add)for(const y of t.add){const x=Un(y,i);x!=null&&r.set(x,y)}if(t.update)for(const y of t.update){let x=r.get(y.id);if(x==null)continue;const w=!y.removeAllProperties&&(((o=y.removeProperties)===null||o===void 0?void 0:o.length)>0||((l=y.addOrUpdateProperties)===null||l===void 0?void 0:l.length)>0);if((y.newGeometry||y.removeAllProperties||w)&&(x=Object.assign({},x),r.set(y.id,x),w&&(x.properties=Object.assign({},x.properties))),y.newGeometry&&(x.geometry=y.newGeometry),y.removeAllProperties)x.properties={};else if(((h=y.removeProperties)===null||h===void 0?void 0:h.length)>0)for(const M of y.removeProperties)Object.prototype.hasOwnProperty.call(x.properties,M)&&delete x.properties[M];if(((p=y.addOrUpdateProperties)===null||p===void 0?void 0:p.length)>0)for(const{key:M,value:A}of y.addOrUpdateProperties)x.properties[M]=A}},P.d2=fr,P.e=fi,P.f=r=>d(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),P.g=Dl,P.h=r=>new Promise((t,i)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=la})},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(l):la}),P.i=oa,P.j=(r,t)=>mt(fi(r,{type:"json"}),t),P.k=ut,P.l=ot,P.m=mt,P.n=(r,t)=>mt(fi(r,{type:"arrayBuffer"}),t),P.o=function(r){return new yd(r).readFields(vm,[])},P.p=xm,P.q=function(r){return/[\u1100-\u11FF\u3000-\u30FF\u3131-\u318E\u31F0-\u321E\u3260-\u327E\u32D0-\u32FE\u3300-\u3357\u3400-\u4DBF\u4E00-\u9FFF\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFF00-\uFFEF]|\uD81B[\uDFE4\uDFF2-\uDFF6]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD32\uDD50-\uDD52\uDD55\uDD64-\uDD67\uDD70-\uDEFB]|\uD83C\uDE00|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(r))},P.r=Xu,P.s=to,P.t=ir,P.u=tt,P.v=as,P.w=gi,P.x=rl,P.y=ap,P.z=ss}),nt("worker",["./shared"],function(P){class d{constructor(j,G){this.keyCache={},j&&this.replace(j,G)}replace(j,G){this._layerConfigs={},this._layers={},this.update(j,[],G)}update(j,G,Y){for(const ut of j){this._layerConfigs[ut.id]=ut;const Tt=this._layers[ut.id]=P.bN(ut,Y);Tt._featureFilter=P.ae(Tt.filter,Y),this.keyCache[ut.id]&&delete this.keyCache[ut.id]}for(const ut of G)delete this.keyCache[ut],delete this._layerConfigs[ut],delete this._layers[ut];this.familiesBySource={};const ot=P.cG(Object.values(this._layerConfigs),this.keyCache);for(const ut of ot){const Tt=ut.map(ue=>this._layers[ue.id]),tt=Tt[0];if(tt.visibility==="none")continue;const yt=tt.source||"";let It=this.familiesBySource[yt];It||(It=this.familiesBySource[yt]={});const kt=tt.sourceLayer||"_geojsonTileLayer";let Ot=It[kt];Ot||(Ot=It[kt]=[]),Ot.push(Tt)}}}class wt{constructor(j){const G={},Y=[];for(const tt in j){const yt=j[tt],It=G[tt]={};for(const kt in yt){const Ot=yt[+kt];if(!Ot||Ot.bitmap.width===0||Ot.bitmap.height===0)continue;const ue={x:0,y:0,w:Ot.bitmap.width+2,h:Ot.bitmap.height+2};Y.push(ue),It[kt]={rect:ue,metrics:Ot.metrics}}}const{w:ot,h:ut}=P.p(Y),Tt=new P.r({width:ot||1,height:ut||1});for(const tt in j){const yt=j[tt];for(const It in yt){const kt=yt[+It];if(!kt||kt.bitmap.width===0||kt.bitmap.height===0)continue;const Ot=G[tt][It].rect;P.r.copy(kt.bitmap,Tt,{x:0,y:0},{x:Ot.x+1,y:Ot.y+1},kt.bitmap)}}this.image=Tt,this.positions=G}}P.cH("GlyphAtlas",wt);class At{constructor(j){this.tileID=new P.a0(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,G,Y,ot,ut){return P._(this,void 0,void 0,function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new P.ac;const Tt=new P.cI(Object.keys(j.layers).sort()),tt=new P.cJ(this.tileID,this.promoteId);tt.bucketLayerIDs=[];const yt={},It={featureIndex:tt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:Y,subdivisionGranularity:ut},kt=G.familiesBySource[this.source];for(const se in kt){const be=j.layers[se];if(!be)continue;be.version===1&&P.w(`Vector tile source "${this.source}" layer "${se}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const cr=Tt.encode(se),Bo=[];for(let Gn=0;Gn<be.length;Gn++){const Ie=be.feature(Gn),Qr=tt.getId(Ie,se);Bo.push({feature:Ie,id:Qr,index:Gn,sourceLayerIndex:cr})}for(const Gn of kt[se]){const Ie=Gn[0];Ie.source!==this.source&&P.w(`layer.source = ${Ie.source} does not equal this.source = ${this.source}`),Ie.isHidden(this.zoom,!0)||(ie(Gn,this.zoom,Y),(yt[Ie.id]=Ie.createBucket({index:tt.bucketLayerIDs.length,layers:Gn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:cr,sourceID:this.source})).populate(Bo,It,this.tileID.canonical),tt.bucketLayerIDs.push(Gn.map(Qr=>Qr.id)))}}const Ot=P.bS(It.glyphDependencies,se=>Object.keys(se).map(Number));this.inFlightDependencies.forEach(se=>se?.abort()),this.inFlightDependencies=[];let ue=Promise.resolve({});if(Object.keys(Ot).length){const se=new AbortController;this.inFlightDependencies.push(se),ue=ot.sendAsync({type:"GG",data:{stacks:Ot,source:this.source,tileID:this.tileID,type:"glyphs"}},se)}const xe=Object.keys(It.iconDependencies);let Le=Promise.resolve({});if(xe.length){const se=new AbortController;this.inFlightDependencies.push(se),Le=ot.sendAsync({type:"GI",data:{icons:xe,source:this.source,tileID:this.tileID,type:"icons"}},se)}const en=Object.keys(It.patternDependencies);let Ge=Promise.resolve({});if(en.length){const se=new AbortController;this.inFlightDependencies.push(se),Ge=ot.sendAsync({type:"GI",data:{icons:en,source:this.source,tileID:this.tileID,type:"patterns"}},se)}const li=It.dashDependencies;let zi=Promise.resolve({});if(Object.keys(li).length){const se=new AbortController;this.inFlightDependencies.push(se),zi=ot.sendAsync({type:"GDA",data:{dashes:li}},se)}const[Qt,Di,Pi,mn]=yield Promise.all([ue,Le,Ge,zi]),ui=new wt(Qt),Ht=new P.cK(Di,Pi);for(const se in yt){const be=yt[se];be instanceof P.ad?(ie(be.layers,this.zoom,Y),P.cL({bucket:be,glyphMap:Qt,glyphPositions:ui.positions,imageMap:Di,imagePositions:Ht.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:It.subdivisionGranularity})):be.hasDependencies&&(be instanceof P.cM||be instanceof P.cN||be instanceof P.cO)&&(ie(be.layers,this.zoom,Y),be.addFeatures(It,this.tileID.canonical,Ht.patternPositions,mn))}return this.status="done",{buckets:Object.values(yt).filter(se=>!se.isEmpty()),featureIndex:tt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ui.image,imageAtlas:Ht,dashPositions:mn,glyphMap:this.returnDependencies?Qt:null,iconMap:this.returnDependencies?Di:null,glyphPositions:this.returnDependencies?ui.positions:null}})}}function ie(mt,j,G){const Y=new P.G(j);for(const ot of mt)ot.recalculate(Y,G)}class jt extends P.cR{constructor(j,G){super(new P.cQ,0,G,[],[]),this.feature=j,this.type=j.type,this.properties=j.tags?j.tags:{},"id"in j&&(typeof j.id=="string"?this.id=parseInt(j.id,10):typeof j.id!="number"||isNaN(j.id)||(this.id=j.id))}loadGeometry(){const j=[],G=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const Y of G){const ot=[];for(const ut of Y)ot.push(new P.P(ut[0],ut[1]));j.push(ot)}return j}}class re extends P.cP{constructor(j,G){super(new P.cQ),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=G?G.version:1,this.extent=G?G.extent:4096,this.length=j.length,this.features=j}feature(j){return new jt(this.features[j],this.extent)}}function ve(mt,j){j.writeVarintField(15,mt.version||1),j.writeStringField(1,mt.name||""),j.writeVarintField(5,mt.extent||4096);const G={keys:[],values:[],keycache:{},valuecache:{}};for(let ut=0;ut<mt.length;ut++)G.feature=mt.feature(ut),j.writeMessage(2,Ke,G);const Y=G.keys;for(const ut of Y)j.writeStringField(3,ut);const ot=G.values;for(const ut of ot)j.writeMessage(4,Ee,ut)}function Ke(mt,j){if(!mt.feature)return;const G=mt.feature;G.id!==void 0&&j.writeVarintField(1,G.id),j.writeMessage(2,he,mt),j.writeVarintField(3,G.type),j.writeMessage(4,ti,G)}function he(mt,j){for(const G in mt.feature?.properties){let Y=mt.feature.properties[G],ot=mt.keycache[G];if(Y===null)continue;ot===void 0&&(mt.keys.push(G),ot=mt.keys.length-1,mt.keycache[G]=ot),j.writeVarint(ot),typeof Y!="string"&&typeof Y!="boolean"&&typeof Y!="number"&&(Y=JSON.stringify(Y));const ut=typeof Y+":"+Y;let Tt=mt.valuecache[ut];Tt===void 0&&(mt.values.push(Y),Tt=mt.values.length-1,mt.valuecache[ut]=Tt),j.writeVarint(Tt)}}function Ct(mt,j){return(j<<3)+(7&mt)}function Ai(mt){return mt<<1^mt>>31}function ti(mt,j){const G=mt.loadGeometry(),Y=mt.type;let ot=0,ut=0;for(const Tt of G){let tt=1;Y===1&&(tt=Tt.length),j.writeVarint(Ct(1,tt));const yt=Y===3?Tt.length-1:Tt.length;for(let It=0;It<yt;It++){It===1&&Y!==1&&j.writeVarint(Ct(2,yt-1));const kt=Tt[It].x-ot,Ot=Tt[It].y-ut;j.writeVarint(Ai(kt)),j.writeVarint(Ai(Ot)),ot+=kt,ut+=Ot}mt.type===3&&j.writeVarint(Ct(7,1))}}function Ee(mt,j){const G=typeof mt;G==="string"?j.writeStringField(1,mt):G==="boolean"?j.writeBooleanField(7,mt):G==="number"&&(mt%1!=0?j.writeDoubleField(3,mt):mt<0?j.writeSVarintField(6,mt):j.writeVarintField(5,mt))}class di extends P.cR{constructor(j,G,Y,ot,ut){super(new P.cQ,0,ut,[],[]),this.type=j,this.properties=Y||{},this.extent=ut,this.pointsArray=G,this.id=ot}loadGeometry(){return this.pointsArray.map(j=>j.map(G=>new P.P(G.x,G.y)))}}class Ci extends P.cP{constructor(j,G,Y){super(new P.cQ),this.version=2,this._myFeatures=j,this.name=G,this.length=j.length,this.extent=Y}feature(j){return this._myFeatures[j]}}class un{constructor(){this.layers={}}addLayer(j){this.layers[j.name]=j}}function Re(mt){let j=function(G){const Y=new P.cQ;return function(ot,ut){for(const Tt in ot.layers)ut.writeMessage(3,ve,ot.layers[Tt])}(G,Y),Y.finish()}(mt);return j.byteOffset===0&&j.byteLength===j.buffer.byteLength||(j=new Uint8Array(j)),{vectorTile:mt,rawData:j.buffer}}function En(mt,j,G){const{extent:Y}=mt,ot=Math.pow(2,G.z-j.z),ut=(G.x-j.x*ot)*Y,Tt=(G.y-j.y*ot)*Y,tt=[];for(let yt=0;yt<mt.length;yt++){const It=mt.feature(yt);let kt=It.loadGeometry();for(const ue of kt)for(const xe of ue)xe.x=xe.x*ot-ut,xe.y=xe.y*ot-Tt;const Ot=128;kt=P.cS(kt,It.type,-Ot,-Ot,Y+Ot,Y+Ot),kt.length!==0&&tt.push(new di(It.type,kt,It.properties,It.id,Y))}return new Ci(tt,mt.name,Y)}class $i{constructor(j,G,Y){this.actor=j,this.layerIndex=G,this.availableImages=Y,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new P.cT(1e3)}loadVectorTile(j,G){return P._(this,void 0,void 0,function*(){const Y=yield P.n(j.request,G);try{return{vectorTile:j.encoding!=="mlt"?new P.cU(new P.cQ(Y.data)):new P.cV(Y.data),rawData:Y.data,cacheControl:Y.cacheControl,expires:Y.expires}}catch(ot){const ut=new Uint8Array(Y.data);let Tt=`Unable to parse the tile at ${j.request.url}, `;throw Tt+=ut[0]===31&&ut[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ot.message}`,new Error(Tt)}})}loadTile(j){return P._(this,void 0,void 0,function*(){const{uid:G,overzoomParameters:Y}=j;Y&&(j.request=Y.overzoomRequest);const ot=!!(j&&j.request&&j.request.collectResourceTiming)&&new P.cW(j.request),ut=new At(j);this.loading[G]=ut;const Tt=new AbortController;ut.abort=Tt;try{const tt=yield this.loadVectorTile(j,Tt);if(delete this.loading[G],!tt)return null;if(Y){const ue=this._getOverzoomTile(j,tt.vectorTile);tt.rawData=ue.rawData,tt.vectorTile=ue.vectorTile}const yt=tt.rawData,It={};tt.expires&&(It.expires=tt.expires),tt.cacheControl&&(It.cacheControl=tt.cacheControl);const kt={};if(ot){const ue=ot.finish();ue&&(kt.resourceTiming=JSON.parse(JSON.stringify(ue)))}ut.vectorTile=tt.vectorTile;const Ot=ut.parse(tt.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);this.loaded[G]=ut,this.fetching[G]={rawTileData:yt,cacheControl:It,resourceTiming:kt};try{const ue=yield Ot;return P.e({rawTileData:yt.slice(0),encoding:j.encoding},ue,It,kt)}finally{delete this.fetching[G]}}catch(tt){throw delete this.loading[G],ut.status="done",this.loaded[G]=ut,tt}})}_getOverzoomTile(j,G){const{tileID:Y,source:ot,overzoomParameters:ut}=j,{maxZoomTileID:Tt}=ut,tt=`${Tt.key}_${Y.key}`,yt=this.overzoomedTileResultCache.get(tt);if(yt)return yt;const It=new un,kt=this.layerIndex.familiesBySource[ot];for(const ue in kt){const xe=G.layers[ue];if(!xe)continue;const Le=En(xe,Tt,Y.canonical);Le.length>0&&It.addLayer(Le)}const Ot=Re(It);return this.overzoomedTileResultCache.set(tt,Ot),Ot}reloadTile(j){return P._(this,void 0,void 0,function*(){const G=j.uid;if(!this.loaded||!this.loaded[G])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Y=this.loaded[G];if(Y.showCollisionBoxes=j.showCollisionBoxes,Y.status==="parsing"){const ot=yield Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);let ut;if(this.fetching[G]){const{rawTileData:Tt,cacheControl:tt,resourceTiming:yt}=this.fetching[G];delete this.fetching[G],ut=P.e({rawTileData:Tt.slice(0),encoding:j.encoding},ot,tt,yt)}else ut=ot;return ut}if(Y.status==="done"&&Y.vectorTile)return Y.parse(Y.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity)})}abortTile(j){return P._(this,void 0,void 0,function*(){const G=this.loading,Y=j.uid;G&&G[Y]&&G[Y].abort&&(G[Y].abort.abort(),delete G[Y])})}removeTile(j){return P._(this,void 0,void 0,function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]})}}class Yn{constructor(){this.loaded={}}loadTile(j){return P._(this,void 0,void 0,function*(){const{uid:G,encoding:Y,rawImageData:ot,redFactor:ut,greenFactor:Tt,blueFactor:tt,baseShift:yt}=j,It=ot.width+2,kt=ot.height+2,Ot=P.b(ot)?new P.R({width:It,height:kt},yield P.cX(ot,-1,-1,It,kt)):ot,ue=new P.cY(G,Ot,Y,ut,Tt,tt,yt);return this.loaded=this.loaded||{},this.loaded[G]=ue,ue})}removeTile(j){const G=this.loaded,Y=j.uid;G&&G[Y]&&delete G[Y]}}var bi,Yi,xr=function(){if(Yi)return bi;function mt(G,Y){if(G.length!==0){j(G[0],Y);for(var ot=1;ot<G.length;ot++)j(G[ot],!Y)}}function j(G,Y){for(var ot=0,ut=0,Tt=0,tt=G.length,yt=tt-1;Tt<tt;yt=Tt++){var It=(G[Tt][0]-G[yt][0])*(G[yt][1]+G[Tt][1]),kt=ot+It;ut+=Math.abs(ot)>=Math.abs(It)?ot-kt+It:It-kt+ot,ot=kt}ot+ut>=0!=!!Y&&G.reverse()}return Yi=1,bi=function G(Y,ot){var ut,Tt=Y&&Y.type;if(Tt==="FeatureCollection")for(ut=0;ut<Y.features.length;ut++)G(Y.features[ut],ot);else if(Tt==="GeometryCollection")for(ut=0;ut<Y.geometries.length;ut++)G(Y.geometries[ut],ot);else if(Tt==="Feature")G(Y.geometry,ot);else if(Tt==="Polygon")mt(Y.coordinates,ot);else if(Tt==="MultiPolygon")for(ut=0;ut<Y.coordinates.length;ut++)mt(Y.coordinates[ut],ot);return Y}}(),br=P.cZ(xr);const Vn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:mt=>mt},Nt=Math.fround||(ne=new Float32Array(1),mt=>(ne[0]=+mt,ne[0]));var ne;class Pe{constructor(j){this.options=Object.assign(Object.create(Vn),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:G,minZoom:Y,maxZoom:ot}=this.options;G&&console.time("total time");const ut=`prepare ${j.length} points`;G&&console.time(ut),this.points=j;const Tt=[];for(let yt=0;yt<j.length;yt++){const It=j[yt];if(!It.geometry)continue;const[kt,Ot]=It.geometry.coordinates,ue=Nt(vt(kt)),xe=Nt(qt(Ot));Tt.push(ue,xe,1/0,yt,-1,1),this.options.reduce&&Tt.push(0)}let tt=this.trees[ot+1]=this._createTree(Tt);G&&console.timeEnd(ut);for(let yt=ot;yt>=Y;yt--){const It=+Date.now();tt=this.trees[yt]=this._createTree(this._cluster(tt,yt)),G&&console.log("z%d: %d clusters in %dms",yt,tt.numItems,+Date.now()-It)}return G&&console.timeEnd("total time"),this}getClusters(j,G){let Y=((j[0]+180)%360+360)%360-180;const ot=Math.max(-90,Math.min(90,j[1]));let ut=j[2]===180?180:((j[2]+180)%360+360)%360-180;const Tt=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)Y=-180,ut=180;else if(Y>ut){const Ot=this.getClusters([Y,ot,180,Tt],G),ue=this.getClusters([-180,ot,ut,Tt],G);return Ot.concat(ue)}const tt=this.trees[this._limitZoom(G)],yt=tt.range(vt(Y),qt(Tt),vt(ut),qt(ot)),It=tt.data,kt=[];for(const Ot of yt){const ue=this.stride*Ot;kt.push(It[ue+5]>1?ge(It,ue,this.clusterProps):this.points[It[ue+3]])}return kt}getChildren(j){const G=this._getOriginId(j),Y=this._getOriginZoom(j),ot="No cluster with the specified id.",ut=this.trees[Y];if(!ut)throw new Error(ot);const Tt=ut.data;if(G*this.stride>=Tt.length)throw new Error(ot);const tt=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),yt=ut.within(Tt[G*this.stride],Tt[G*this.stride+1],tt),It=[];for(const kt of yt){const Ot=kt*this.stride;Tt[Ot+4]===j&&It.push(Tt[Ot+5]>1?ge(Tt,Ot,this.clusterProps):this.points[Tt[Ot+3]])}if(It.length===0)throw new Error(ot);return It}getLeaves(j,G,Y){const ot=[];return this._appendLeaves(ot,j,G=G||10,Y=Y||0,0),ot}getTile(j,G,Y){const ot=this.trees[this._limitZoom(j)],ut=Math.pow(2,j),{extent:Tt,radius:tt}=this.options,yt=tt/Tt,It=(Y-yt)/ut,kt=(Y+1+yt)/ut,Ot={features:[]};return this._addTileFeatures(ot.range((G-yt)/ut,It,(G+1+yt)/ut,kt),ot.data,G,Y,ut,Ot),G===0&&this._addTileFeatures(ot.range(1-yt/ut,It,1,kt),ot.data,ut,Y,ut,Ot),G===ut-1&&this._addTileFeatures(ot.range(0,It,yt/ut,kt),ot.data,-1,Y,ut,Ot),Ot.features.length?Ot:null}getClusterExpansionZoom(j){let G=this._getOriginZoom(j)-1;for(;G<=this.options.maxZoom;){const Y=this.getChildren(j);if(G++,Y.length!==1)break;j=Y[0].properties.cluster_id}return G}_appendLeaves(j,G,Y,ot,ut){const Tt=this.getChildren(G);for(const tt of Tt){const yt=tt.properties;if(yt&&yt.cluster?ut+yt.point_count<=ot?ut+=yt.point_count:ut=this._appendLeaves(j,yt.cluster_id,Y,ot,ut):ut<ot?ut++:j.push(tt),j.length===Y)break}return ut}_createTree(j){const G=new P.aN(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Y=0;Y<j.length;Y+=this.stride)G.add(j[Y],j[Y+1]);return G.finish(),G.data=j,G}_addTileFeatures(j,G,Y,ot,ut,Tt){for(const tt of j){const yt=tt*this.stride,It=G[yt+5]>1;let kt,Ot,ue;if(It)kt=oi(G,yt,this.clusterProps),Ot=G[yt],ue=G[yt+1];else{const en=this.points[G[yt+3]];kt=en.properties;const[Ge,li]=en.geometry.coordinates;Ot=vt(Ge),ue=qt(li)}const xe={type:1,geometry:[[Math.round(this.options.extent*(Ot*ut-Y)),Math.round(this.options.extent*(ue*ut-ot))]],tags:kt};let Le;Le=It||this.options.generateId?G[yt+3]:this.points[G[yt+3]].id,Le!==void 0&&(xe.id=Le),Tt.features.push(xe)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,G){const{radius:Y,extent:ot,reduce:ut,minPoints:Tt}=this.options,tt=Y/(ot*Math.pow(2,G)),yt=j.data,It=[],kt=this.stride;for(let Ot=0;Ot<yt.length;Ot+=kt){if(yt[Ot+2]<=G)continue;yt[Ot+2]=G;const ue=yt[Ot],xe=yt[Ot+1],Le=j.within(yt[Ot],yt[Ot+1],tt),en=yt[Ot+5];let Ge=en;for(const li of Le){const zi=li*kt;yt[zi+2]>G&&(Ge+=yt[zi+5])}if(Ge>en&&Ge>=Tt){let li,zi=ue*en,Qt=xe*en,Di=-1;const Pi=(Ot/kt<<5)+(G+1)+this.points.length;for(const mn of Le){const ui=mn*kt;if(yt[ui+2]<=G)continue;yt[ui+2]=G;const Ht=yt[ui+5];zi+=yt[ui]*Ht,Qt+=yt[ui+1]*Ht,yt[ui+4]=Pi,ut&&(li||(li=this._map(yt,Ot,!0),Di=this.clusterProps.length,this.clusterProps.push(li)),ut(li,this._map(yt,ui)))}yt[Ot+4]=Pi,It.push(zi/Ge,Qt/Ge,1/0,Pi,-1,Ge),ut&&It.push(Di)}else{for(let li=0;li<kt;li++)It.push(yt[Ot+li]);if(Ge>1)for(const li of Le){const zi=li*kt;if(!(yt[zi+2]<=G)){yt[zi+2]=G;for(let Qt=0;Qt<kt;Qt++)It.push(yt[zi+Qt])}}}}return It}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,G,Y){if(j[G+5]>1){const Tt=this.clusterProps[j[G+6]];return Y?Object.assign({},Tt):Tt}const ot=this.points[j[G+3]].properties,ut=this.options.map(ot);return Y&&ut===ot?Object.assign({},ut):ut}}function ge(mt,j,G){return{type:"Feature",id:mt[j+3],properties:oi(mt,j,G),geometry:{type:"Point",coordinates:[(Y=mt[j],360*(Y-.5)),ae(mt[j+1])]}};var Y}function oi(mt,j,G){const Y=mt[j+5],ot=Y>=1e4?`${Math.round(Y/1e3)}k`:Y>=1e3?Math.round(Y/100)/10+"k":Y,ut=mt[j+6],Tt=ut===-1?{}:Object.assign({},G[ut]);return Object.assign(Tt,{cluster:!0,cluster_id:mt[j+3],point_count:Y,point_count_abbreviated:ot})}function vt(mt){return mt/360+.5}function qt(mt){const j=Math.sin(mt*Math.PI/180),G=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return G<0?0:G>1?1:G}function ae(mt){const j=(180-360*mt)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function fe(mt,j,G,Y){let ot=Y;const ut=j+(G-j>>1);let Tt,tt=G-j;const yt=mt[j],It=mt[j+1],kt=mt[G],Ot=mt[G+1];for(let ue=j+3;ue<G;ue+=3){const xe=Ce(mt[ue],mt[ue+1],yt,It,kt,Ot);if(xe>ot)Tt=ue,ot=xe;else if(xe===ot){const Le=Math.abs(ue-ut);Le<tt&&(Tt=ue,tt=Le)}}ot>Y&&(Tt-j>3&&fe(mt,j,Tt,Y),mt[Tt+2]=ot,G-Tt>3&&fe(mt,Tt,G,Y))}function Ce(mt,j,G,Y,ot,ut){let Tt=ot-G,tt=ut-Y;if(Tt!==0||tt!==0){const yt=((mt-G)*Tt+(j-Y)*tt)/(Tt*Tt+tt*tt);yt>1?(G=ot,Y=ut):yt>0&&(G+=Tt*yt,Y+=tt*yt)}return Tt=mt-G,tt=j-Y,Tt*Tt+tt*tt}function ze(mt,j,G,Y){const ot={id:mt??null,type:j,geometry:G,tags:Y,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Ue(ot,G);else if(j==="Polygon")Ue(ot,G[0]);else if(j==="MultiLineString")for(const ut of G)Ue(ot,ut);else if(j==="MultiPolygon")for(const ut of G)Ue(ot,ut[0]);return ot}function Ue(mt,j){for(let G=0;G<j.length;G+=3)mt.minX=Math.min(mt.minX,j[G]),mt.minY=Math.min(mt.minY,j[G+1]),mt.maxX=Math.max(mt.maxX,j[G]),mt.maxY=Math.max(mt.maxY,j[G+1])}function fi(mt,j,G,Y){if(!j.geometry)return;const ot=j.geometry.coordinates;if(ot&&ot.length===0)return;const ut=j.geometry.type,Tt=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2);let tt=[],yt=j.id;if(G.promoteId?yt=j.properties[G.promoteId]:G.generateId&&(yt=Y||0),ut==="Point")wi(ot,tt);else if(ut==="MultiPoint")for(const It of ot)wi(It,tt);else if(ut==="LineString")Lr(ot,tt,Tt,!1);else if(ut==="MultiLineString"){if(G.lineMetrics){for(const It of ot)tt=[],Lr(It,tt,Tt,!1),mt.push(ze(yt,"LineString",tt,j.properties));return}Wr(ot,tt,Tt,!1)}else if(ut==="Polygon")Wr(ot,tt,Tt,!0);else{if(ut!=="MultiPolygon"){if(ut==="GeometryCollection"){for(const It of j.geometry.geometries)fi(mt,{id:yt,geometry:It,properties:j.properties},G,Y);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const It of ot){const kt=[];Wr(It,kt,Tt,!0),tt.push(kt)}}mt.push(ze(yt,ut,tt,j.properties))}function wi(mt,j){j.push(Wn(mt[0]),ps(mt[1]),0)}function Lr(mt,j,G,Y){let ot,ut,Tt=0;for(let yt=0;yt<mt.length;yt++){const It=Wn(mt[yt][0]),kt=ps(mt[yt][1]);j.push(It,kt,0),yt>0&&(Tt+=Y?(ot*kt-It*ut)/2:Math.sqrt(Math.pow(It-ot,2)+Math.pow(kt-ut,2))),ot=It,ut=kt}const tt=j.length-3;j[2]=1,fe(j,0,tt,G),j[tt+2]=1,j.size=Math.abs(Tt),j.start=0,j.end=j.size}function Wr(mt,j,G,Y){for(let ot=0;ot<mt.length;ot++){const ut=[];Lr(mt[ot],ut,G,Y),j.push(ut)}}function Wn(mt){return mt/360+.5}function ps(mt){const j=Math.sin(mt*Math.PI/180),G=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return G<0?0:G>1?1:G}function gi(mt,j,G,Y,ot,ut,Tt,tt){if(Y/=j,ut>=(G/=j)&&Tt<Y)return mt;if(Tt<G||ut>=Y)return null;const yt=[];for(const It of mt){const kt=It.geometry;let Ot=It.type;const ue=ot===0?It.minX:It.minY,xe=ot===0?It.maxX:It.maxY;if(ue>=G&&xe<Y){yt.push(It);continue}if(xe<G||ue>=Y)continue;let Le=[];if(Ot==="Point"||Ot==="MultiPoint")Kr(kt,Le,G,Y,ot);else if(Ot==="LineString")oa(kt,Le,G,Y,ot,!1,tt.lineMetrics);else if(Ot==="MultiLineString")ya(kt,Le,G,Y,ot,!1);else if(Ot==="Polygon")ya(kt,Le,G,Y,ot,!0);else if(Ot==="MultiPolygon")for(const en of kt){const Ge=[];ya(en,Ge,G,Y,ot,!0),Ge.length&&Le.push(Ge)}if(Le.length){if(tt.lineMetrics&&Ot==="LineString"){for(const en of Le)yt.push(ze(It.id,Ot,en,It.tags));continue}Ot!=="LineString"&&Ot!=="MultiLineString"||(Le.length===1?(Ot="LineString",Le=Le[0]):Ot="MultiLineString"),Ot!=="Point"&&Ot!=="MultiPoint"||(Ot=Le.length===3?"Point":"MultiPoint"),yt.push(ze(It.id,Ot,Le,It.tags))}}return yt.length?yt:null}function Kr(mt,j,G,Y,ot){for(let ut=0;ut<mt.length;ut+=3){const Tt=mt[ut+ot];Tt>=G&&Tt<=Y&&la(j,mt[ut],mt[ut+1],mt[ut+2])}}function oa(mt,j,G,Y,ot,ut,Tt){let tt=Wi(mt);const yt=ot===0?Js:Ua;let It,kt,Ot=mt.start;for(let Ge=0;Ge<mt.length-3;Ge+=3){const li=mt[Ge],zi=mt[Ge+1],Qt=mt[Ge+2],Di=mt[Ge+3],Pi=mt[Ge+4],mn=ot===0?li:zi,ui=ot===0?Di:Pi;let Ht=!1;Tt&&(It=Math.sqrt(Math.pow(li-Di,2)+Math.pow(zi-Pi,2))),mn<G?ui>G&&(kt=yt(tt,li,zi,Di,Pi,G),Tt&&(tt.start=Ot+It*kt)):mn>Y?ui<Y&&(kt=yt(tt,li,zi,Di,Pi,Y),Tt&&(tt.start=Ot+It*kt)):la(tt,li,zi,Qt),ui<G&&mn>=G&&(kt=yt(tt,li,zi,Di,Pi,G),Ht=!0),ui>Y&&mn<=Y&&(kt=yt(tt,li,zi,Di,Pi,Y),Ht=!0),!ut&&Ht&&(Tt&&(tt.end=Ot+It*kt),j.push(tt),tt=Wi(mt)),Tt&&(Ot+=It)}let ue=mt.length-3;const xe=mt[ue],Le=mt[ue+1],en=ot===0?xe:Le;en>=G&&en<=Y&&la(tt,xe,Le,mt[ue+2]),ue=tt.length-3,ut&&ue>=3&&(tt[ue]!==tt[0]||tt[ue+1]!==tt[1])&&la(tt,tt[0],tt[1],tt[2]),tt.length&&j.push(tt)}function Wi(mt){const j=[];return j.size=mt.size,j.start=mt.start,j.end=mt.end,j}function ya(mt,j,G,Y,ot,ut){for(const Tt of mt)oa(Tt,j,G,Y,ot,ut,!1)}function la(mt,j,G,Y){mt.push(j,G,Y)}function Js(mt,j,G,Y,ot,ut){const Tt=(ut-j)/(Y-j);return la(mt,ut,G+(ot-G)*Tt,1),Tt}function Ua(mt,j,G,Y,ot,ut){const Tt=(ut-G)/(ot-G);return la(mt,j+(Y-j)*Tt,ut,1),Tt}function ja(mt,j){const G=[];for(let Y=0;Y<mt.length;Y++){const ot=mt[Y],ut=ot.type;let Tt;if(ut==="Point"||ut==="MultiPoint"||ut==="LineString")Tt=to(ot.geometry,j);else if(ut==="MultiLineString"||ut==="Polygon"){Tt=[];for(const tt of ot.geometry)Tt.push(to(tt,j))}else if(ut==="MultiPolygon"){Tt=[];for(const tt of ot.geometry){const yt=[];for(const It of tt)yt.push(to(It,j));Tt.push(yt)}}G.push(ze(ot.id,ut,Tt,ot.tags))}return G}function to(mt,j){const G=[];G.size=mt.size,mt.start!==void 0&&(G.start=mt.start,G.end=mt.end);for(let Y=0;Y<mt.length;Y+=3)G.push(mt[Y]+j,mt[Y+1],mt[Y+2]);return G}function Ln(mt,j){if(mt.transformed)return mt;const G=1<<mt.z,Y=mt.x,ot=mt.y;for(const ut of mt.features){const Tt=ut.geometry,tt=ut.type;if(ut.geometry=[],tt===1)for(let yt=0;yt<Tt.length;yt+=2)ut.geometry.push(kr(Tt[yt],Tt[yt+1],j,G,Y,ot));else for(let yt=0;yt<Tt.length;yt++){const It=[];for(let kt=0;kt<Tt[yt].length;kt+=2)It.push(kr(Tt[yt][kt],Tt[yt][kt+1],j,G,Y,ot));ut.geometry.push(It)}}return mt.transformed=!0,mt}function kr(mt,j,G,Y,ot,ut){return[Math.round(G*(mt*Y-ot)),Math.round(G*(j*Y-ut))]}function Al(mt,j,G,Y,ot){const ut=j===ot.maxZoom?0:ot.tolerance/((1<<j)*ot.extent),Tt={features:[],numPoints:0,numSimplified:0,numFeatures:mt.length,source:null,x:G,y:Y,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const tt of mt)Cl(Tt,tt,ut,ot);return Tt}function Cl(mt,j,G,Y){const ot=j.geometry,ut=j.type,Tt=[];if(mt.minX=Math.min(mt.minX,j.minX),mt.minY=Math.min(mt.minY,j.minY),mt.maxX=Math.max(mt.maxX,j.maxX),mt.maxY=Math.max(mt.maxY,j.maxY),ut==="Point"||ut==="MultiPoint")for(let tt=0;tt<ot.length;tt+=3)Tt.push(ot[tt],ot[tt+1]),mt.numPoints++,mt.numSimplified++;else if(ut==="LineString")Va(Tt,ot,mt,G,!1,!1);else if(ut==="MultiLineString"||ut==="Polygon")for(let tt=0;tt<ot.length;tt++)Va(Tt,ot[tt],mt,G,ut==="Polygon",tt===0);else if(ut==="MultiPolygon")for(let tt=0;tt<ot.length;tt++){const yt=ot[tt];for(let It=0;It<yt.length;It++)Va(Tt,yt[It],mt,G,!0,It===0)}if(Tt.length){let tt=j.tags||null;if(ut==="LineString"&&Y.lineMetrics){tt={};for(const It in j.tags)tt[It]=j.tags[It];tt.mapbox_clip_start=ot.start/ot.size,tt.mapbox_clip_end=ot.end/ot.size}const yt={geometry:Tt,type:ut==="Polygon"||ut==="MultiPolygon"?3:ut==="LineString"||ut==="MultiLineString"?2:1,tags:tt};j.id!==null&&(yt.id=j.id),mt.features.push(yt)}}function Va(mt,j,G,Y,ot,ut){const Tt=Y*Y;if(Y>0&&j.size<(ot?Tt:Y))return void(G.numPoints+=j.length/3);const tt=[];for(let yt=0;yt<j.length;yt+=3)(Y===0||j[yt+2]>Tt)&&(G.numSimplified++,tt.push(j[yt],j[yt+1])),G.numPoints++;ot&&function(yt,It){let kt=0;for(let Ot=0,ue=yt.length,xe=ue-2;Ot<ue;xe=Ot,Ot+=2)kt+=(yt[Ot]-yt[xe])*(yt[Ot+1]+yt[xe+1]);if(kt>0===It)for(let Ot=0,ue=yt.length;Ot<ue/2;Ot+=2){const xe=yt[Ot],Le=yt[Ot+1];yt[Ot]=yt[ue-2-Ot],yt[Ot+1]=yt[ue-1-Ot],yt[ue-2-Ot]=xe,yt[ue-1-Ot]=Le}}(tt,ut),mt.push(tt)}const zl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ms{constructor(j,G){const Y=(G=this.options=function(ut,Tt){for(const tt in Tt)ut[tt]=Tt[tt];return ut}(Object.create(zl),G)).debug;if(Y&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");let ot=function(ut,Tt){const tt=[];if(ut.type==="FeatureCollection")for(let yt=0;yt<ut.features.length;yt++)fi(tt,ut.features[yt],Tt,yt);else fi(tt,ut.type==="Feature"?ut:{geometry:ut},Tt);return tt}(j,G);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ot=function(ut,Tt){const tt=Tt.buffer/Tt.extent;let yt=ut;const It=gi(ut,1,-1-tt,tt,0,-1,2,Tt),kt=gi(ut,1,1-tt,2+tt,0,-1,2,Tt);return(It||kt)&&(yt=gi(ut,1,-tt,1+tt,0,-1,2,Tt)||[],It&&(yt=ja(It,1).concat(yt)),kt&&(yt=yt.concat(ja(kt,-1)))),yt}(ot,G),ot.length&&this.splitTile(ot,0,0,0),Y&&(ot.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,G,Y,ot,ut,Tt,tt){const yt=[j,G,Y,ot],It=this.options,kt=It.debug;for(;yt.length;){ot=yt.pop(),Y=yt.pop(),G=yt.pop(),j=yt.pop();const Ot=1<<G,ue=Dl(G,Y,ot);let xe=this.tiles[ue];if(!xe&&(kt>1&&console.time("creation"),xe=this.tiles[ue]=Al(j,G,Y,ot,It),this.tileCoords.push({z:G,x:Y,y:ot}),kt)){kt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,Y,ot,xe.numFeatures,xe.numPoints,xe.numSimplified),console.timeEnd("creation"));const Ht=`z${G}`;this.stats[Ht]=(this.stats[Ht]||0)+1,this.total++}if(xe.source=j,ut==null){if(G===It.indexMaxZoom||xe.numPoints<=It.indexMaxPoints)continue}else{if(G===It.maxZoom||G===ut)continue;if(ut!=null){const Ht=ut-G;if(Y!==Tt>>Ht||ot!==tt>>Ht)continue}}if(xe.source=null,j.length===0)continue;kt>1&&console.time("clipping");const Le=.5*It.buffer/It.extent,en=.5-Le,Ge=.5+Le,li=1+Le;let zi=null,Qt=null,Di=null,Pi=null,mn=gi(j,Ot,Y-Le,Y+Ge,0,xe.minX,xe.maxX,It),ui=gi(j,Ot,Y+en,Y+li,0,xe.minX,xe.maxX,It);j=null,mn&&(zi=gi(mn,Ot,ot-Le,ot+Ge,1,xe.minY,xe.maxY,It),Qt=gi(mn,Ot,ot+en,ot+li,1,xe.minY,xe.maxY,It),mn=null),ui&&(Di=gi(ui,Ot,ot-Le,ot+Ge,1,xe.minY,xe.maxY,It),Pi=gi(ui,Ot,ot+en,ot+li,1,xe.minY,xe.maxY,It),ui=null),kt>1&&console.timeEnd("clipping"),yt.push(zi||[],G+1,2*Y,2*ot),yt.push(Qt||[],G+1,2*Y,2*ot+1),yt.push(Di||[],G+1,2*Y+1,2*ot),yt.push(Pi||[],G+1,2*Y+1,2*ot+1)}}getTile(j,G,Y){j=+j,G=+G,Y=+Y;const ot=this.options,{extent:ut,debug:Tt}=ot;if(j<0||j>24)return null;const tt=1<<j,yt=Dl(j,G=G+tt&tt-1,Y);if(this.tiles[yt])return Ln(this.tiles[yt],ut);Tt>1&&console.log("drilling down to z%d-%d-%d",j,G,Y);let It,kt=j,Ot=G,ue=Y;for(;!It&&kt>0;)kt--,Ot>>=1,ue>>=1,It=this.tiles[Dl(kt,Ot,ue)];return It&&It.source?(Tt>1&&(console.log("found parent tile z%d-%d-%d",kt,Ot,ue),console.time("drilling down")),this.splitTile(It.source,kt,Ot,ue,j,G,Y),Tt>1&&console.timeEnd("drilling down"),this.tiles[yt]?Ln(this.tiles[yt],ut):null):null}}function Dl(mt,j,G){return 32*((1<<mt)*G+j)+mt}class ko extends $i{constructor(j,G,Y,ot=wr){super(j,G,Y),this._dataUpdateable=new Map,this._createGeoJSONIndex=ot}loadVectorTile(j,G){return P._(this,void 0,void 0,function*(){const Y=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ot=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);return ot?Re(new re(ot.features,{version:2,extent:P.a3})):null})}loadData(j){return P._(this,void 0,void 0,function*(){var G;(G=this._pendingRequest)===null||G===void 0||G.abort();const Y=!!(j&&j.request&&j.request.collectResourceTiming)&&new P.cW(j.request);this._pendingRequest=new AbortController;try{(!this._pendingData||j.request||j.data||j.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest));const ot=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ot,j),this.loaded={};const ut={data:ot};if(Y){const Tt=Y.finish();Tt&&(ut.resourceTiming={},ut.resourceTiming[j.source]=JSON.parse(JSON.stringify(Tt)))}return ut}catch(ot){if(delete this._pendingRequest,P.cC(ot))return{abandoned:!0};throw ot}})}getData(){return P._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(j){const G=this.loaded;return G&&G[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,G){return P._(this,void 0,void 0,function*(){let Y=yield this.loadGeoJSON(j,G);if(delete this._pendingRequest,typeof Y!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(br(Y,!0),j.filter){const ot=P.c_(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ot.result==="error")throw new Error(ot.value.map(Tt=>`${Tt.key}: ${Tt.message}`).join(", "));Y={type:"FeatureCollection",features:Y.features.filter(Tt=>ot.value.evaluate({zoom:0},Tt))}}return Y})}loadGeoJSON(j,G){return P._(this,void 0,void 0,function*(){const{promoteId:Y}=j;if(j.request){const ot=yield P.j(j.request,G);return this._dataUpdateable=P.d0(ot.data,Y)?P.c$(ot.data,Y):void 0,ot.data}if(typeof j.data=="string")try{const ot=JSON.parse(j.data);return this._dataUpdateable=P.d0(ot,Y)?P.c$(ot,Y):void 0,ot}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return P.d1(this._dataUpdateable,j.dataDiff,Y),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(j){return P._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}function wr(mt,j){return j.cluster?new Pe(function({superclusterOptions:G,clusterProperties:Y}){if(!Y||!G)return G;const ot={},ut={},Tt={accumulated:null,zoom:0},tt={properties:null},yt=Object.keys(Y);for(const It of yt){const[kt,Ot]=Y[It],ue=P.c_(Ot),xe=P.c_(typeof kt=="string"?[kt,["accumulated"],["get",It]]:kt);ot[It]=ue.value,ut[It]=xe.value}return G.map=It=>{tt.properties=It;const kt={};for(const Ot of yt)kt[Ot]=ot[Ot].evaluate(Tt,tt);return kt},G.reduce=(It,kt)=>{tt.properties=kt;for(const Ot of yt)Tt.accumulated=It[Ot],It[Ot]=ut[Ot].evaluate(Tt,tt)},G}(j)).load(mt.features):function(G,Y){return new ms(G,Y)}(mt,j.geojsonVtOptions)}class Zi{constructor(j){this.self=j,this.actor=new P.K(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(G,Y)=>{if(this.externalWorkerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.externalWorkerSourceTypes[G]=Y},this.self.addProtocol=P.cE,this.self.removeProtocol=P.cF,this.self.registerRTLTextPlugin=G=>{P.d2.setMethods(G)},this.actor.registerMessageHandler("LDT",(G,Y)=>this._getDEMWorkerSource(G,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RDT",(G,Y)=>P._(this,void 0,void 0,function*(){this._getDEMWorkerSource(G,Y.source).removeTile(Y)})),this.actor.registerMessageHandler("GCEZ",(G,Y)=>P._(this,void 0,void 0,function*(){return this._getWorkerSource(G,Y.type,Y.source).getClusterExpansionZoom(Y)})),this.actor.registerMessageHandler("GCC",(G,Y)=>P._(this,void 0,void 0,function*(){return this._getWorkerSource(G,Y.type,Y.source).getClusterChildren(Y)})),this.actor.registerMessageHandler("GCL",(G,Y)=>P._(this,void 0,void 0,function*(){return this._getWorkerSource(G,Y.type,Y.source).getClusterLeaves(Y)})),this.actor.registerMessageHandler("LD",(G,Y)=>this._getWorkerSource(G,Y.type,Y.source).loadData(Y)),this.actor.registerMessageHandler("GD",(G,Y)=>this._getWorkerSource(G,Y.type,Y.source).getData()),this.actor.registerMessageHandler("LT",(G,Y)=>this._getWorkerSource(G,Y.type,Y.source).loadTile(Y)),this.actor.registerMessageHandler("RT",(G,Y)=>this._getWorkerSource(G,Y.type,Y.source).reloadTile(Y)),this.actor.registerMessageHandler("AT",(G,Y)=>this._getWorkerSource(G,Y.type,Y.source).abortTile(Y)),this.actor.registerMessageHandler("RMT",(G,Y)=>this._getWorkerSource(G,Y.type,Y.source).removeTile(Y)),this.actor.registerMessageHandler("RS",(G,Y)=>P._(this,void 0,void 0,function*(){if(!this.workerSources[G]||!this.workerSources[G][Y.type]||!this.workerSources[G][Y.type][Y.source])return;const ot=this.workerSources[G][Y.type][Y.source];delete this.workerSources[G][Y.type][Y.source],ot.removeSource!==void 0&&ot.removeSource(Y)})),this.actor.registerMessageHandler("RM",G=>P._(this,void 0,void 0,function*(){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],this.globalStates.delete(G)})),this.actor.registerMessageHandler("SR",(G,Y)=>P._(this,void 0,void 0,function*(){this.referrer=Y})),this.actor.registerMessageHandler("SRPS",(G,Y)=>this._syncRTLPluginState(G,Y)),this.actor.registerMessageHandler("IS",(G,Y)=>P._(this,void 0,void 0,function*(){this.self.importScripts(Y)})),this.actor.registerMessageHandler("SI",(G,Y)=>this._setImages(G,Y)),this.actor.registerMessageHandler("UL",(G,Y)=>P._(this,void 0,void 0,function*(){this._getLayerIndex(G).update(Y.layers,Y.removedIds,this._getGlobalState(G))})),this.actor.registerMessageHandler("UGS",(G,Y)=>P._(this,void 0,void 0,function*(){const ot=this._getGlobalState(G);for(const ut in Y)ot[ut]=Y[ut]})),this.actor.registerMessageHandler("SL",(G,Y)=>P._(this,void 0,void 0,function*(){this._getLayerIndex(G).replace(Y,this._getGlobalState(G))}))}_getGlobalState(j){let G=this.globalStates.get(j);return G||(G={},this.globalStates.set(j,G)),G}_setImages(j,G){return P._(this,void 0,void 0,function*(){this.availableImages[j]=G;for(const Y in this.workerSources[j]){const ot=this.workerSources[j][Y];for(const ut in ot)ot[ut].availableImages=G}})}_syncRTLPluginState(j,G){return P._(this,void 0,void 0,function*(){return yield P.d2.syncState(G,this.self.importScripts)})}_getAvailableImages(j){let G=this.availableImages[j];return G||(G=[]),G}_getLayerIndex(j){let G=this.layerIndexes[j];return G||(G=this.layerIndexes[j]=new d),G}_getWorkerSource(j,G,Y){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][G]||(this.workerSources[j][G]={}),!this.workerSources[j][G][Y]){const ot={sendAsync:(ut,Tt)=>(ut.targetMapId=j,this.actor.sendAsync(ut,Tt))};switch(G){case"vector":this.workerSources[j][G][Y]=new $i(ot,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][G][Y]=new ko(ot,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][G][Y]=new this.externalWorkerSourceTypes[G](ot,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][G][Y]}_getDEMWorkerSource(j,G){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][G]||(this.demWorkerSources[j][G]=new Yn),this.demWorkerSources[j][G]}}return P.i(self)&&(self.worker=new Zi(self)),Zi}),nt("index",["exports","./shared"],function(P,d){var wt="5.12.0";function At(){var m=new d.A(4);return d.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let ie,jt,re;const ve={frame(m,e,a){const u=requestAnimationFrame(_=>{f(),e(_)}),{unsubscribe:f}=d.s(m.signal,"abort",()=>{f(),cancelAnimationFrame(u),a(d.c())},!1)},frameAsync(m){return new Promise((e,a)=>{this.frame(m,e,a)})},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){const e=window.document.createElement("canvas"),a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,a.drawImage(m,0,0,m.width,m.height),a},resolveURL:m=>(ie||(ie=document.createElement("a")),ie.href=m,ie.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return re!==void 0?re:!!matchMedia&&(jt==null&&(jt=matchMedia("(prefers-reduced-motion: reduce)")),jt.matches)},set prefersReducedMotion(m){re=m}},Ke=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function he(){return Ke.getCurrentTime()}class Ct{static testProp(e){if(!Ct.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in Ct.docStyle)return e[a];return e[0]}static create(e,a,u){const f=window.document.createElement(e);return a!==void 0&&(f.className=a),u&&u.appendChild(f),f}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){Ct.docStyle&&Ct.selectProp&&(Ct.userSelect=Ct.docStyle[Ct.selectProp],Ct.docStyle[Ct.selectProp]="none")}static enableDrag(){Ct.docStyle&&Ct.selectProp&&(Ct.docStyle[Ct.selectProp]=Ct.userSelect)}static setTransform(e,a){e.style[Ct.transformProp]=a}static addEventListener(e,a,u,f={}){e.addEventListener(a,u,"passive"in f?f:f.capture)}static removeEventListener(e,a,u,f={}){e.removeEventListener(a,u,"passive"in f?f:f.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",Ct.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ct.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Ct.suppressClickInternal,!0)},0)}static getScale(e){const a=e.getBoundingClientRect();return{x:a.width/e.offsetWidth||1,y:a.height/e.offsetHeight||1,boundingClientRect:a}}static getPoint(e,a,u){const f=a.boundingClientRect;return new d.P((u.clientX-f.left)/a.x-e.clientLeft,(u.clientY-f.top)/a.y-e.clientTop)}static mousePos(e,a){const u=Ct.getScale(e);return Ct.getPoint(e,u,a)}static touchPos(e,a){const u=[],f=Ct.getScale(e);for(let _=0;_<a.length;_++)u.push(Ct.getPoint(e,f,a[_]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const a=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),u=a.querySelectorAll("script");for(const f of u)f.remove();return Ct.clean(a),a.innerHTML}static isPossiblyDangerous(e,a){const u=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!u.includes("javascript:")&&!u.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const a=e.children;for(const u of a)Ct.removeAttributes(u),Ct.clean(u)}static removeAttributes(e){for(const{name:a,value:u}of e.attributes)Ct.isPossiblyDangerous(a,u)&&e.removeAttribute(a)}}Ct.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Ct.selectProp=Ct.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Ct.transformProp=Ct.testProp(["transform","WebkitTransform"]);const Ai={supported:!1,testSupport:function(m){!di&&Ee&&(Ci?un(m):ti=m)}};let ti,Ee,di=!1,Ci=!1;function un(m){const e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Ee),m.isContextLost())return;Ai.supported=!0}catch{}m.deleteTexture(e),di=!0}var Re;typeof document<"u"&&(Ee=document.createElement("img"),Ee.onload=()=>{ti&&un(ti),ti=null,Ci=!0},Ee.onerror=()=>{di=!0,ti=null},Ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let e,a,u,f;m.resetRequestQueue=()=>{e=[],a=0,u=0,f={}},m.addThrottleControl=S=>{const C=u++;return f[C]=S,C},m.removeThrottleControl=S=>{delete f[S],v()},m.getImage=(S,C,z=!0)=>new Promise((B,R)=>{Ai.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),d.e(S,{type:"image"}),e.push({abortController:C,requestParameters:S,supportImageRefresh:z,state:"queued",onError:N=>{R(N)},onSuccess:N=>{B(N)}}),v()});const _=S=>d._(this,void 0,void 0,function*(){S.state="running";const{requestParameters:C,supportImageRefresh:z,onError:B,onSuccess:R,abortController:N}=S,q=z===!1&&!d.i(self)&&!d.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((et,at)=>et&&at==="accept",!0));a++;const K=q?T(C,N):d.m(C,N);try{const et=yield K;delete S.abortController,S.state="completed",et.data instanceof HTMLImageElement||d.b(et.data)?R(et):et.data&&R({data:yield(J=et.data,typeof createImageBitmap=="function"?d.f(J):d.h(J)),cacheControl:et.cacheControl,expires:et.expires})}catch(et){delete S.abortController,B(et)}finally{a--,v()}var J}),v=()=>{const S=(()=>{for(const C of Object.keys(f))if(f[C]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=a;C<S&&e.length>0;C++){const z=e.shift();z.abortController.signal.aborted?C--:_(z)}},T=(S,C)=>new Promise((z,B)=>{const R=new Image,N=S.url,q=S.credentials;q&&q==="include"?R.crossOrigin="use-credentials":(q&&q==="same-origin"||!d.d(N))&&(R.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{R.src="",B(d.c())}),R.fetchPriority="high",R.onload=()=>{R.onerror=R.onload=null,z({data:R})},R.onerror=()=>{R.onerror=R.onload=null,C.signal.aborted||B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},R.src=N})}(Re||(Re={})),Re.resetRequestQueue();class En{constructor(e){this._transformRequestFn=e??null}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function $i(m){const e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){const a=[];for(const{id:u,url:f}of m){const _=`${u}${f}`;a.indexOf(_)===-1&&(a.push(_),e.push({id:u,url:f}))}}return e}function Yn(m,e,a){try{const u=new URL(m);return u.pathname+=`${e}${a}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function bi(m){const{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class Yi extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const e of Object.keys(this.images))this.removeImage(e);this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:a,promiseResolve:u}of this.requestors)u(this._getImagesForIds(a));this.requestors=[]}}getImage(e){const a=this.images[e];if(a&&!a.data&&a.spriteData){const u=a.spriteData;a.data=new d.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let u=!0;const f=a.data||a.spriteData;return this._validateStretch(a.stretchX,f&&f.width)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(a.stretchY,f&&f.height)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(a.content,a)||(this.fire(new d.k(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,a){if(!e)return!0;let u=0;for(const f of e){if(f[0]<u||f[1]<f[0]||a<f[1])return!1;u=f[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;const u=a.spriteData,f=u&&u.width||a.data.width,_=u&&u.height||a.data.height;return!(e[0]<0||f<e[0]||e[1]<0||_<e[1]||e[2]<0||f<e[2]||e[3]<0||_<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,u=!0){const f=this.getImage(e);if(u&&(f.data.width!==a.data.width||f.data.height!==a.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=f.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){const a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((a,u)=>{let f=!0;if(!this.isLoaded())for(const _ of e)this.images[_]||(f=!1);this.isLoaded()||f?a(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:a})})}_getImagesForIds(e){const a={};for(const u of e){let f=this.getImage(u);f||(this.fire(new d.l("styleimagemissing",{id:u})),f=this.getImage(u)),f?a[u]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,textFitWidth:f.textFitWidth,textFitHeight:f.textFitHeight,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:d.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){const a=this.patterns[e],u=this.getImage(e);if(!u)return null;if(a&&a.position.version===u.version)return a.position;if(a)a.position.version=u.version;else{const f={w:u.data.width+2,h:u.data.height+2,x:0,y:0},_=new d.I(f,u);this.patterns[e]={bin:f,position:_}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.T(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const _ in this.patterns)e.push(this.patterns[_].bin);const{w:a,h:u}=d.p(e),f=this.atlasImage;f.resize({width:a||1,height:u||1});for(const _ in this.patterns){const{bin:v}=this.patterns[_],T=v.x+1,S=v.y+1,C=this.getImage(_).data,z=C.width,B=C.height;d.R.copy(C,f,{x:0,y:0},{x:T,y:S},{width:z,height:B}),d.R.copy(C,f,{x:0,y:B-1},{x:T,y:S-1},{width:z,height:1}),d.R.copy(C,f,{x:0,y:0},{x:T,y:S+B},{width:z,height:1}),d.R.copy(C,f,{x:z-1,y:0},{x:T-1,y:S},{width:1,height:B}),d.R.copy(C,f,{x:0,y:0},{x:T+z,y:S},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const u=this.getImage(a);u||d.w(`Image with ID: "${a}" was not found`),bi(u)&&this.updateImage(a,u)}}cloneImages(){const e={};for(const a in this.images){const u=this.images[a];e[a]=Object.assign(Object.assign({},u),{data:u.data?u.data.clone():null})}return e}}const xr=1e20;function br(m,e,a,u,f,_,v,T,S){for(let C=e;C<e+u;C++)Vn(m,a*_+C,_,f,v,T,S);for(let C=a;C<a+f;C++)Vn(m,C*_+e,1,u,v,T,S)}function Vn(m,e,a,u,f,_,v){_[0]=0,v[0]=-xr,v[1]=xr,f[0]=m[e];for(let T=1,S=0,C=0;T<u;T++){f[T]=m[e+T*a];const z=T*T;do{const B=_[S];C=(f[T]-f[B]+z-B*B)/(T-B)/2}while(C<=v[S]&&--S>-1);S++,_[S]=T,v[S]=C,v[S+1]=xr}for(let T=0,S=0;T<u;T++){for(;v[S+1]<T;)S++;const C=_[S],z=T-C;m[e+T*a]=f[C]+z*z}}const Nt=d.v.layout_symbol["text-font"].default.join(",");class ne{constructor(e,a,u){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={},this.lang=u}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const a=[];for(const _ in e)for(const v of e[_])a.push(this._getAndCacheGlyphsPromise(_,v));const u=yield Promise.all(a),f={};for(const{stack:_,id:v,glyph:T}of u)f[_]||(f[_]={}),f[_][v]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};return f})}_getAndCacheGlyphsPromise(e,a){return d._(this,void 0,void 0,function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let f=u.glyphs[a];return f!==void 0?{stack:e,id:a,glyph:f}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(f=u.glyphs[a]=this._drawGlyph(u,e,a),{stack:e,id:a,glyph:f}):yield this._downloadAndCacheRangePromise(e,a)})}_downloadAndCacheRangePromise(e,a){return d._(this,void 0,void 0,function*(){const u=Math.floor(a/256);if(256*u>65535)throw new Error("glyphs > 65535 not supported");const f=this.entries[e];if(f.ranges[u])return{stack:e,id:a,glyph:null};if(!f.requests[u]){const _=ne.loadGlyphRange(e,u,this.url,this.requestManager);f.requests[u]=_}try{const _=yield f.requests[u];for(const v in _)f.glyphs[+v]=_[+v];return f.ranges[u]=!0,{stack:e,id:a,glyph:_[a]||null}}catch(_){const v=f.glyphs[a]=this._drawGlyph(f,e,a);return this._warnOnMissingGlyphRange(v,u,a,_),{stack:e,id:a,glyph:v}}})}_warnOnMissingGlyphRange(e,a,u,f){const _=256*a,v=_+255,T=u.toString(16).padStart(4,"0").toUpperCase();d.w(`Unable to load glyph range ${a}, ${_}-${v}. Rendering codepoint U+${T} locally instead. ${f}`)}_charUsesLocalIdeographFontFamily(e){return!!this.localIdeographFontFamily&&d.q(e)}_drawGlyph(e,a,u){const f=a===Nt&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(u),_=f?"ideographTinySDF":"tinySDF";e[_]||(e[_]=this._createTinySDF(f?this.localIdeographFontFamily:a));const v=e[_].draw(String.fromCharCode(u));return{id:u,bitmap:new d.r({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(e){const a=e?e.split(","):[];a.push("sans-serif");const u=a.map(f=>/[-\w]+/.test(f)?f:`'${CSS.escape(f)}'`).join(",");return new ne.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(e){return/italic/i.test(e)?"italic":/oblique/i.test(e)?"oblique":"normal"}_fontWeight(e){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let u;for(const[f,_]of Object.entries(a))new RegExp(`\\b${f}\\b`,"i").test(e)&&(u=`${_}`);return u}destroy(){for(const e in this.entries){const a=this.entries[e];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}ne.loadGlyphRange=function(m,e,a,u){return d._(this,void 0,void 0,function*(){const f=256*e,_=f+255,v=u.transformRequest(a.replace("{fontstack}",m).replace("{range}",`${f}-${_}`),"Glyphs"),T=yield d.n(v,new AbortController);if(!T||!T.data)throw new Error(`Could not load glyph range. range: ${e}, ${f}-${_}`);const S={};for(const C of d.o(T.data))S[C.id]=C;return S})},ne.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:a=8,cutoff:u=.25,fontFamily:f="sans-serif",fontWeight:_="normal",fontStyle:v="normal",lang:T=null}={}){this.buffer=e,this.cutoff=u,this.radius=a,this.lang=T;const S=this.size=m+4*e,C=this._createCanvas(S),z=this.ctx=C.getContext("2d",{willReadFrequently:!0});z.font=`${v} ${_} ${m}px ${f}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){const{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:f,actualBoundingBoxRight:_}=this.ctx.measureText(m),v=Math.ceil(a),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-f))),S=Math.min(this.size-this.buffer,v+Math.ceil(u)),C=T+2*this.buffer,z=S+2*this.buffer,B=Math.max(C*z,0),R=new Uint8ClampedArray(B),N={data:R,width:C,height:z,glyphWidth:T,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(T===0||S===0)return N;const{ctx:q,buffer:K,gridInner:J,gridOuter:et}=this;this.lang&&(q.lang=this.lang),q.clearRect(K,K,T,S),q.fillText(m,K,K+v);const at=q.getImageData(K,K,T,S);et.fill(xr,0,B),J.fill(0,0,B);for(let ct=0;ct<S;ct++)for(let rt=0;rt<T;rt++){const ht=at.data[4*(ct*T+rt)+3]/255;if(ht===0)continue;const pt=(ct+K)*C+rt+K;if(ht===1)et[pt]=0,J[pt]=xr;else{const lt=.5-ht;et[pt]=lt>0?lt*lt:0,J[pt]=lt<0?lt*lt:0}}br(et,0,0,C,z,C,this.f,this.v,this.z),br(J,K,K,T,S,C,this.f,this.v,this.z);for(let ct=0;ct<B;ct++){const rt=Math.sqrt(et[ct])-Math.sqrt(J[ct]);R[ct]=Math.round(255-255*(rt/this.radius+this.cutoff))}return N}};class Pe{constructor(){this.specification=d.u.light.position}possiblyEvaluate(e,a){return d.C(e.expression.evaluate(a))}interpolate(e,a,u){return{x:d.F.number(e.x,a.x,u),y:d.F.number(e.y,a.y,u),z:d.F.number(e.z,a.z,u)}}}let ge;class oi extends d.E{constructor(e){super(),ge=ge||new d.t({anchor:new d.D(d.u.light.anchor),position:new Pe,color:new d.D(d.u.light.color),intensity:new d.D(d.u.light.intensity)}),this._transitionable=new d.x(ge,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(d.y,e,a))for(const u in e){const f=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),f):this._transitionable.setValue(u,f)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,u){return(!u||u.validate!==!1)&&d.z(this,e.call(d.B,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:d.u}))}}const vt=new d.t({"sky-color":new d.D(d.u.sky["sky-color"]),"horizon-color":new d.D(d.u.sky["horizon-color"]),"fog-color":new d.D(d.u.sky["fog-color"]),"fog-ground-blend":new d.D(d.u.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.u.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.u.sky["atmosphere-blend"])});class qt extends d.E{constructor(e){super(),this._transitionable=new d.x(vt,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.G(0))}setSky(e,a={}){if(!this._validate(d.H,e,a)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const f=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),f):this._transitionable.setValue(u,f)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,u={}){return u?.validate!==!1&&d.z(this,e.call(d.B,d.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:d.u})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ae{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){const u=e.join(",")+String(a);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,a)),this.dashEntry[u]}getDashRanges(e,a,u){const f=[];let _=e.length%2==1?-e[e.length-1]*u:0,v=e[0]*u,T=!0;f.push({left:_,right:v,isDash:T,zeroLength:e[0]===0});let S=e[0];for(let C=1;C<e.length;C++){T=!T;const z=e[C];_=S*u,S+=z,v=S*u,f.push({left:_,right:v,isDash:T,zeroLength:z===0})}return f}addRoundDash(e,a,u){const f=a/2;for(let _=-u;_<=u;_++){const v=this.width*(this.nextRow+u+_);let T=0,S=e[T];for(let C=0;C<this.width;C++){C/S.right>1&&(S=e[++T]);const z=Math.abs(C-S.left),B=Math.abs(C-S.right),R=Math.min(z,B);let N;const q=_/u*(f+1);if(S.isDash){const K=f-Math.abs(q);N=Math.sqrt(R*R+K*K)}else N=f-Math.sqrt(R*R+q*q);this.data[v+C]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(e){for(let T=e.length-1;T>=0;--T){const S=e[T],C=e[T+1];S.zeroLength?e.splice(T,1):C&&C.isDash===S.isDash&&(C.left=S.left,e.splice(T,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const f=this.width*this.nextRow;let _=0,v=e[_];for(let T=0;T<this.width;T++){T/v.right>1&&(v=e[++_]);const S=Math.abs(T-v.left),C=Math.abs(T-v.right),z=Math.min(S,C);this.data[f+T]=Math.max(0,Math.min(255,(v.isDash?z:-z)+128))}}addDash(e,a){const u=a?7:0,f=2*u+1;if(this.nextRow+f>this.height)return d.w("LineAtlas out of space"),null;let _=0;for(let T=0;T<e.length;T++)_+=e[T];if(_!==0){const T=this.width/_,S=this.getDashRanges(e,this.width,T);a?this.addRoundDash(S,T,u):this.addRegularDash(S)}const v={y:this.nextRow+u,height:2*u,width:_};return this.nextRow+=f,this.dirty=!0,v}bind(e){const a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const fe="maplibre_preloaded_worker_pool";class Ce{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ce.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[fe]}numActive(){return Object.keys(this.active).length}}const ze=Math.floor(ve.hardwareConcurrency/2);let Ue,fi;function wi(){return Ue||(Ue=new Ce),Ue}Ce.workerCount=d.J(globalThis)?Math.max(Math.min(ze,3),1):1;class Lr{constructor(e,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;const u=this.workerPool.acquire(a);for(let f=0;f<u.length;f++){const _=new d.K(u[f],a);_.name=`Worker ${f}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a){const u=[];for(const f of this.actors)u.push(f.sendAsync({type:e,data:a}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,a){for(const u of this.actors)u.registerMessageHandler(e,a)}unregisterMessageHandler(e){for(const a of this.actors)a.unregisterMessageHandler(e)}}function Wr(){return fi||(fi=new Lr(wi(),d.L),fi.registerMessageHandler("GR",(m,e,a)=>d.m(e,a))),fi}function Wn(m,e){const a=d.M();return d.N(a,a,[1,1,0]),d.O(a,a,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?d.Q(a,a,m.calculatePosMatrix(e.toUnwrapped())):a}function ps(m,e,a,u,f,_,v){var T;const S=function(R,N,q){if(R)for(const K of R){const J=N[K];if(J&&J.source===q&&J.type==="fill-extrusion")return!0}else for(const K in N){const J=N[K];if(J.source===q&&J.type==="fill-extrusion")return!0}return!1}((T=f?.layers)!==null&&T!==void 0?T:null,e,m.id),C=_.maxPitchScaleFactor(),z=m.tilesIn(u,C,S);z.sort(gi);const B=[];for(const R of z)B.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(e,a,m.getState(),R.queryGeometry,R.cameraQueryGeometry,R.scale,f,_,C,Wn(_,R.tileID),v?(N,q)=>v(R.tileID,N,q):void 0)});return function(R,N){for(const q in R)for(const K of R[q])Kr(K,N);return R}(function(R){const N={},q={};for(const K of R){const J=K.queryResults,et=K.wrappedTileID,at=q[et]=q[et]||{};for(const ct in J){const rt=J[ct],ht=at[ct]=at[ct]||{},pt=N[ct]=N[ct]||[];for(const lt of rt)ht[lt.featureIndex]||(ht[lt.featureIndex]=!0,pt.push(lt))}}return N}(B),m)}function gi(m,e){const a=m.tileID,u=e.tileID;return a.overscaledZ-u.overscaledZ||a.canonical.y-u.canonical.y||a.wrap-u.wrap||a.canonical.x-u.canonical.x}function Kr(m,e){const a=m.feature,u=e.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=u}function oa(m,e,a){return d._(this,void 0,void 0,function*(){let u=m;if(m.url?u=(yield d.j(e.transformRequest(m.url,"Source"),a)).data:yield ve.frameAsync(a),!u)return null;const f=d.S(d.e(u,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(f.vectorLayerIds=u.vector_layers.map(_=>_.id)),f})}class Wi{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.U?new d.U(e.lng,e.lat):d.U.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.U?new d.U(e.lng,e.lat):d.U.convert(e),this}extend(e){const a=this._sw,u=this._ne;let f,_;if(e instanceof d.U)f=e,_=e;else{if(!(e instanceof Wi))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Wi.convert(e)):this.extend(d.U.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.U.convert(e)):this;if(f=e._sw,_=e._ne,!f||!_)return this}return a||u?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),u.lng=Math.max(_.lng,u.lng),u.lat=Math.max(_.lat,u.lat)):(this._sw=new d.U(f.lng,f.lat),this._ne=new d.U(_.lng,_.lat)),this}getCenter(){return new d.U((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.U(this.getWest(),this.getNorth())}getSouthEast(){return new d.U(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:a,lat:u}=d.U.convert(e);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&f}intersects(e){if((e=Wi.convert(e)).getNorth()<this.getSouth()||e.getSouth()>this.getNorth())return!1;const a=d.V(this.getWest(),-180,180),u=d.V(this.getEast(),-180,180),f=d.V(e.getWest(),-180,180),_=d.V(e.getEast(),-180,180),v=a>u,T=f>_;return!(!v||!T)||(v?_>=a||f<=u:T?u>=f||a<=_:!(f>u||_<a))}static convert(e){return e instanceof Wi?e:e&&new Wi(e)}static fromLngLat(e,a=0){const u=360*a/40075017,f=u/Math.cos(Math.PI/180*e.lat);return new Wi(new d.U(e.lng-f,e.lat-u),new d.U(e.lng+f,e.lat+u))}adjustAntiMeridian(){const e=new d.U(this._sw.lng,this._sw.lat),a=new d.U(this._ne.lng,this._ne.lat);return new Wi(e,e.lng>a.lng?new d.U(a.lng+360,a.lat):a)}}class ya{constructor(e,a,u){this.bounds=Wi.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const a=Math.pow(2,e.z),u=Math.floor(d.X(this.bounds.getWest())*a),f=Math.floor(d.W(this.bounds.getNorth())*a),_=Math.ceil(d.X(this.bounds.getEast())*a),v=Math.ceil(d.W(this.bounds.getSouth())*a);return e.x>=u&&e.x<_&&e.y>=f&&e.y<v}}class la extends d.E{constructor(e,a,u,f){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.S(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=d.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield oa(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new ya(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new d.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(a,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(e)};u.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((_,v)=>{e.reloadPromise={resolve:_,reject:v}})}else e.actor=this.dispatcher.getActor(),f="LT";e.abortController=new AbortController;try{const _=yield e.actor.sendAsync({type:f,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,_)}catch(_){if(delete e.abortController,e.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(e,null)}})}_getOverzoomParameters(e){if(e.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=e.tileID.scaledTo(this.maxzoom).canonical,u=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(u,"Tile")}}_afterTileLoadWorkerResponse(e,a){if(a&&a.resourceTiming&&(e.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&e.setExpiryData(a),e.loadVectorData(a,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Js extends d.E{constructor(e,a,u,f){super(),this.id=e,this.dispatcher=u,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},a),d.e(this,d.S(a,["url","scheme","tileSize"]))}load(){return d._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield oa(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(d.e(this,a),a.bounds&&(this.tileBounds=new ya(a.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,this.fire(new d.k(a))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield Re.getImage(this.map._requestManager.transformRequest(a,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const f=this.map.painter.context,_=f.gl,v=u.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new d.T(f,v,_.RGBA,{useMipmap:!0}),e.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Ua extends Js{constructor(e,a,u,f){super(e,a,u,f),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(a,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const f=yield Re.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(f&&f.data){const _=f.data;this.map._refreshExpiredTiles&&(f.cacheControl||f.expires)&&e.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const v=d.b(_)&&d.Y()?_:yield this.readImageNow(_),T={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const S=yield e.actor.sendAsync({type:"LDT",data:T});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(f){if(delete e.abortController,e.aborted)e.state="unloaded";else if(f)throw e.state="errored",f}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.Z()){const a=e.width+2,u=e.height+2;try{return new d.R({width:a,height:u},yield d.$(e,-1,-1,a,u))}catch{}}return ve.getImageData(e,1)})}_getNeighboringTiles(e){const a=e.canonical,u=Math.pow(2,a.z),f=(a.x-1+u)%u,_=a.x===0?e.wrap-1:e.wrap,v=(a.x+1+u)%u,T=a.x+1===u?e.wrap+1:e.wrap,S={};return S[new d.a0(e.overscaledZ,_,a.z,f,a.y).key]={backfilled:!1},S[new d.a0(e.overscaledZ,T,a.z,v,a.y).key]={backfilled:!1},a.y>0&&(S[new d.a0(e.overscaledZ,_,a.z,f,a.y-1).key]={backfilled:!1},S[new d.a0(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},S[new d.a0(e.overscaledZ,T,a.z,v,a.y-1).key]={backfilled:!1}),a.y+1<u&&(S[new d.a0(e.overscaledZ,_,a.z,f,a.y+1).key]={backfilled:!1},S[new d.a0(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},S[new d.a0(e.overscaledZ,T,a.z,v,a.y+1).key]={backfilled:!1}),S}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}function ja(m){return m.type==="GeometryCollection"?m.geometries.map(e=>e.coordinates).flat(1/0):m.coordinates.flat(1/0)}function to(m){const e=new Wi;let a;switch(m.type){case"FeatureCollection":a=m.features.map(u=>ja(u.geometry)).flat(1/0);break;case"Feature":a=ja(m.geometry);break;default:a=ja(m)}if(a.length==0)return e;for(let u=0;u<a.length-1;u+=2)e.extend([a[u],a[u+1]]);return e}class Ln extends d.E{constructor(e,a,u,f){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=u.getActor(),this.setEventedParent(f),this._data=a.data,this._options=d.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:d.a3,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:d.a3,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(d.a3/this.tileSize)}_getClusterMaxZoom(e){const a=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||d.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${a}"`),a}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=d.a4(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getBounds(){return d._(this,void 0,void 0,function*(){return to(yield this.getData())})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,a,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:a,offset:u}})}_updateWorkerData(){return d._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void d.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:e,diff:a}=this._pendingWorkerUpdate,u=d.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(u.request=this.map._requestManager.transformRequest(ve.resolveURL(e),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):a&&(u.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new d.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:u});if(this._isUpdatingWorker=!1,this._removed||f.abandoned)return void this.fire(new d.l("dataabort",{dataType:"source"}));this._data=f.data;let _=null;f.resourceTiming&&f.resourceTiming[this.id]&&(_=f.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&d.e(v,{resourceTiming:_}),this.fire(new d.l("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new d.l("data",Object.assign(Object.assign({},v),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(a)})))}catch(f){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new d.l("dataabort",{dataType:"source"}));this.fire(new d.k(f))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}})}_getShouldReloadTileOptions(e){if(!e||e.removeAll)return;const{add:a=[],update:u=[],remove:f=[]}=e||{},_=new Set([...u.map(v=>v.id),...f]);return{nextBounds:[...u.map(v=>v.newGeometry),...a.map(v=>v.geometry)].map(v=>to(v)),prevIds:_}}shouldReloadTile(e,{nextBounds:a,prevIds:u}){const f=e.latestFeatureIndex.loadVTLayers();for(let S=0;S<e.latestFeatureIndex.featureIndexArray.length;S++){const C=e.latestFeatureIndex.featureIndexArray.get(S),z=f._geojsonTileLayer.feature(C.featureIndex);if(u.has(z.id))return!0}const{buffer:_,extent:v}=this.workerOptions.geojsonVtOptions,T=function({x:S,y:C,z},B=0){const R=d.a1((S-B)/Math.pow(2,z)),N=d.a2((C+1+B)/Math.pow(2,z)),q=d.a1((S+1+B)/Math.pow(2,z)),K=d.a2((C-B)/Math.pow(2,z));return new Wi([R,N],[q,K])}(e.tileID.canonical,_/v);for(const S of a)if(T.intersects(S))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return d._(this,void 0,void 0,function*(){const a=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const f=yield this.actor.sendAsync({type:a,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(f,this.map.painter,a==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class kr extends d.E{constructor(e,a,u,f){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=a}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield Re.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,e&&(this.coordinates=e),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new d.k(a))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const a=e.map(d.a5.fromLngLat);var u;return this.tileID=function(f){const _=d.a6.fromPoints(f),v=_.width(),T=_.height(),S=Math.max(v,T),C=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),z=Math.pow(2,C);return new d.a8(C,Math.floor((_.minX+_.maxX)/2*z),Math.floor((_.minY+_.maxY)/2*z))}(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map(f=>this.tileID.getTilePoint(f)._round()),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,a=e.gl;this.texture||(this.texture=new d.T(e,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let u=!1;for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,u=!0)}u&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:a,minY:u,maxX:f,maxY:_}=d.a6.fromPoints(e),v={};for(let T=0;T<=d.a7;T++){const S=Math.pow(2,T),C=Math.floor(a*S),z=Math.floor(u*S),B=Math.floor(f*S),R=Math.floor(_*S);v[T]={minTileX:C,minTileY:z,maxTileX:B,maxTileY:R}}return v}}class Al extends kr{constructor(e,a,u,f){super(e,a,u,f),this.roundZoom=!0,this.type="video",this.options=a}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const a of e.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield d.a9(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new d.k(a))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new d.k(new d.aa(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,a=e.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new d.T(e,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let u=!1;for(const f in this.tiles){const _=this.tiles[f];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,u=!0)}u&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Cl extends kr{constructor(e,a,u,f){super(e,a,u,f),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(v=>typeof v!="number"))||this.fire(new d.k(new d.aa(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.k(new d.aa(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new d.k(new d.aa(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new d.k(new d.aa(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.k(new d.aa(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,u=a.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.T(a,this.canvas,u.RGBA,{premultiply:!0});let f=!1;for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,f=!0)}f&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Va={},zl=m=>{switch(m){case"geojson":return Ln;case"image":return kr;case"raster":return Js;case"raster-dem":return Ua;case"vector":return la;case"video":return Al;case"canvas":return Cl}return Va[m]},ms="RTLPluginLoaded";class Dl extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Wr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(a=>{throw this.status="error",a})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(a,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ve.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.l(ms))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ko=null;function wr(){return ko||(ko=new Dl),ko}var Zi,mt;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(Zi||(Zi={})),function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"}(mt||(mt={}));class j{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=d.ab(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:a,fadingParentID:u,fadeEndTime:f}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=a,this.fadingParentID=u,this.fadeEndTime=f}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=he(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData,this.latestFeatureIndex.encoding=e.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(f,_){const v={};if(!_)return v;for(const T of f){const S=T.layerIds.map(C=>_.getLayer(C)).filter(Boolean);if(S.length!==0){T.layers=S,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(C=>S.filter(z=>z.id===C)[0]));for(const C of S)v[C.id]=T}}return v}(e.buckets,a?.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof d.ad){if(this.hasSymbolBuckets=!0,!u)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const _=this.buckets[f];if(_ instanceof d.ad&&_.hasRTLText){this.hasRTLText=!0,wr().lazyLoad();break}}this.queryPadding=0;for(const f in this.buckets){const _=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(f).queryRadius(_))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new d.ac}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(e)}const a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new d.T(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new d.T(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,u,f,_,v,T,S,C,z,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:_,scale:v,tileSize:this.tileSize,pixelPosMatrix:z,transform:S,params:T,queryPadding:this.queryPadding*C,getElevation:B},e,a,u):{}}querySourceFeatures(e,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),_=a&&a.sourceLayer?a.sourceLayer:"",v=f._geojsonTileLayer||f[_];if(!v)return;const T=d.ae(a?.filter,a?.globalState),{z:S,x:C,y:z}=this.tileID.canonical,B={z:S,x:C,y:z};for(let R=0;R<v.length;R++){const N=v.feature(R);if(T.needGeometry){const J=d.af(N,!0);if(!T.filter(new d.G(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!T.filter(new d.G(this.tileID.overscaledZ),N))continue;const q=u.getId(N,_),K=new d.ag(N,S,C,z,q);K.tile=B,e.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const a=this.expirationTime;if(e.cacheControl){const u=d.ah(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{const _=this.expirationTime-a;_?this.expirationTime=u+Math.max(_,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const f in this.buckets){if(!a.style.hasLayer(f))continue;const _=this.buckets[f],v=_.layers[0].sourceLayer||"_geojsonTileLayer",T=u[v],S=e[v];if(!T||!S||Object.keys(S).length===0)continue;_.update(S,T,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const C=a&&a.style&&a.style.getLayer(f);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(_)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<he()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=he()+e}setDependencies(e,a){const u={};for(const f of a)u[f]=!0;this.dependencies[e]=u}hasDependency(e,a){for(const u of e){const f=this.dependencies[u];if(f){for(const _ of a)if(f[_])return!0}}return!1}}class G{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,u){const f=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},d.e(this.stateChanges[e][f],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const _ in this.state[e])_!==f&&(this.deletedStates[e][_]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][f]===null){this.deletedStates[e][f]={};for(const _ in this.state[e][f])u[_]||(this.deletedStates[e][f][_]=null)}else for(const _ in u)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][_]===null&&delete this.deletedStates[e][f][_]}removeFeatureState(e,a,u){if(this.deletedStates[e]===null)return;const f=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&a!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][u]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(u in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][u]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}getState(e,a){const u=String(a),f=d.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const _=this.deletedStates[e][a];if(_===null)return{};for(const v in _)delete f[v]}return f}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const _={};for(const v in this.stateChanges[f])this.state[f][v]||(this.state[f][v]={}),d.e(this.state[f][v],this.stateChanges[f][v]),_[v]=this.state[f][v];u[f]=_}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const _={};if(this.deletedStates[f]===null)for(const v in this.state[f])_[v]={},this.state[f][v]={};else for(const v in this.deletedStates[f]){if(this.deletedStates[f][v]===null)this.state[f][v]={};else for(const T of Object.keys(this.deletedStates[f][v]))delete this.state[f][v][T];_[v]=this.state[f][v]}u[f]=u[f]||{},d.e(u[f],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const f in e)e[f].setFeatureState(u,a)}}const Y=89.25;function ot(m,e){const a=d.ai(e.lat,-d.aj,d.aj);return new d.P(d.X(e.lng)*m,d.W(a)*m)}function ut(m,e){return new d.a5(e.x/m,e.y/m).toLngLat()}function Tt(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(d.ak(90-m.pitch)),Math.tan(d.ak(Y-m.pitch)))}function tt(m,e){const a=m.canonical,u=e/d.al(a.z),f=a.x+Math.pow(2,a.z)*m.wrap,_=d.am(new Float64Array(16));return d.N(_,_,[f*u,a.y*u,0]),d.O(_,_,[u/d.a3,u/d.a3,1]),_}function yt(m,e,a,u,f){const _=d.a5.fromLngLat(m,e),v=f*d.an(1,m.lat),T=v*Math.cos(d.ak(a)),S=Math.sqrt(v*v-T*T),C=S*Math.sin(d.ak(-u)),z=S*Math.cos(d.ak(-u));return new d.a5(_.x+C,_.y+z,_.z+T)}function It(m,e,a){const u=e.intersectsFrustum(m);if(!a||u===0)return u;const f=e.intersectsPlane(a);return f===0?0:u===2&&f===2?2:1}function kt(m,e,a){let u=0;const f=(a-e)/10;for(let _=0;_<10;_++)u+=f*Math.pow(Math.cos(e+(_+.5)/10*(a-e)),m);return u}function Ot(m,e){return function(a,u,f,_,v){const T=2*((m-1)/d.ao(Math.cos(d.ak(Y-v))/Math.cos(d.ak(Y)))-1),S=Math.acos(f/_),C=2*kt(T-1,0,d.ak(v/2)),z=Math.min(d.ak(Y),S+d.ak(v/2)),B=kt(T-1,Math.min(z,S-d.ak(v/2)),z),R=Math.atan(u/f),N=Math.hypot(u,f);let q=a;return q+=d.ao(_/N/Math.max(.5,Math.cos(d.ak(v/2)))),q+=T*d.ao(Math.cos(R))/2,q-=d.ao(Math.max(1,B/C/e))/2,q}}const ue=Ot(9.314,3);function xe(m,e){const a=(e.roundZoom?Math.round:Math.floor)(m.zoom+d.ao(m.tileSize/e.tileSize));return Math.max(0,a)}function Le(m,e){const a=m.getCameraFrustum(),u=m.getClippingPlane(),f=m.screenPointToMercatorCoordinate(m.getCameraPoint()),_=d.a5.fromLngLat(m.center,m.elevation);f.z=_.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const v=m.getCoveringTilesDetailsProvider(),T=v.allowVariableZoom(m,e),S=xe(m,e),C=e.minzoom||0,z=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,B=Math.min(Math.max(0,S),z),R=Math.pow(2,B),N=[R*f.x,R*f.y,0],q=[R*_.x,R*_.y,0],K=Math.hypot(_.x-f.x,_.y-f.y),J=Math.abs(_.z-f.z),et=Math.hypot(K,J),at=ht=>({zoom:0,x:0,y:0,wrap:ht,fullyVisible:!1}),ct=[],rt=[];if(m.renderWorldCopies&&v.allowWorldCopies())for(let ht=1;ht<=3;ht++)ct.push(at(-ht)),ct.push(at(ht));for(ct.push(at(0));ct.length>0;){const ht=ct.pop(),pt=ht.x,lt=ht.y;let xt=ht.fullyVisible;const Dt={x:pt,y:lt,z:ht.zoom},Mt=v.getTileBoundingVolume(Dt,ht.wrap,m.elevation,e);if(!xt){const Jt=It(a,Mt,u);if(Jt===0)continue;xt=Jt===2}const Et=v.distanceToTile2d(f.x,f.y,Dt,Mt);let Pt=S;T&&(Pt=(e.calculateTileZoom||ue)(m.zoom+d.ao(m.tileSize/e.tileSize),Et,J,et,m.fov)),Pt=(e.roundZoom?Math.round:Math.floor)(Pt),Pt=Math.max(0,Pt);const Kt=Math.min(Pt,z);if(ht.wrap=v.getWrap(_,Dt,ht.wrap),ht.zoom>=Kt){if(ht.zoom<C)continue;const Jt=B-ht.zoom,Gt=N[0]-.5-(pt<<Jt),ce=N[1]-.5-(lt<<Jt),me=e.reparseOverscaled?Math.max(ht.zoom,Pt):ht.zoom;rt.push({tileID:new d.a0(ht.zoom===z?me:ht.zoom,ht.wrap,ht.zoom,pt,lt),distanceSq:d.ap([q[0]-.5-pt,q[1]-.5-lt]),tileDistanceToCamera:Math.sqrt(Gt*Gt+ce*ce)})}else for(let Jt=0;Jt<4;Jt++)ct.push({zoom:ht.zoom+1,x:(pt<<1)+Jt%2,y:(lt<<1)+(Jt>>1),wrap:ht.wrap,fullyVisible:xt})}return rt.sort((ht,pt)=>ht.distanceSq-pt.distanceSq).map(ht=>ht.tileID)}const en=d.a6.fromPoints([new d.P(0,0),new d.P(d.a3,d.a3)]);class Ge extends d.E{constructor(e,a,u){super(),this.id=e,this.dispatcher=u,this.on("data",f=>this._dataHandler(f)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((f,_,v,T)=>{const S=new(zl(_.type))(f,_,v,T);if(S.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${S.id}`);return S})(e,a,u,this),this._tiles={},this._cache=new d.aq(0,f=>this._unloadTile(f)),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new G,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a,u){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,a,u)}catch(f){e.state="errored",f.status!==404?this._source.fire(new d.k(f,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const u=this._tiles[a];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(li).map(e=>e.key)}getRenderableIds(e){const a=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&a.push(this._tiles[u]);return e?a.sort((u,f)=>{const _=u.tileID,v=f.tileID,T=new d.P(_.canonical.x,_.canonical.y)._rotate(-this.transform.bearingInRadians),S=new d.P(v.canonical.x,v.canonical.y)._rotate(-this.transform.bearingInRadians);return _.overscaledZ-v.overscaledZ||S.y-T.y||S.x-T.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(li).map(u=>u.key)}hasRenderableParent(e){const a=e.overscaledZ-1;if(a>=this._source.minzoom){const u=this.getLoadedTile(e.scaledTo(a));if(u)return this._isIdRenderable(u.tileID.key)}return!1}_isIdRenderable(e,a=!1){var u;return(u=this._tiles[e])===null||u===void 0?void 0:u.isRenderable(a)}reload(e,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const u in this._tiles)a&&this._source.shouldReloadTile&&!this._source.shouldReloadTile(this._tiles[u],a)||(e?this._reloadTile(u,"expired"):this._tiles[u].state!=="errored"&&this._reloadTile(u,"reloading"))}}_reloadTile(e,a){return d._(this,void 0,void 0,function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=a),yield this._loadTile(u,e,a))})}_tileLoaded(e,a,u){e.timeAdded=he(),e.selfFading&&(e.fadeEndTime=e.timeAdded+this._rasterFadeDuration),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const a=this.getRenderableIds();for(let f=0;f<a.length;f++){const _=a[f];if(e.neighboringTiles&&e.neighboringTiles[_]){const v=this.getTileByID(_);u(e,v),u(v,e)}}function u(f,_){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let v=_.tileID.canonical.x-f.tileID.canonical.x;const T=_.tileID.canonical.y-f.tileID.canonical.y,S=Math.pow(2,f.tileID.canonical.z),C=_.tileID.key;v===0&&T===0||Math.abs(T)>1||(Math.abs(v)>1&&(Math.abs(v+S)===1?v+=S:Math.abs(v-S)===1&&(v-=S)),_.dem&&f.dem&&(f.dem.backfillBorder(_.dem,v,T),f.neighboringTiles&&f.neighboringTiles[C]&&(f.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a){const u=Object.values(e),f=this._getLoadedDescendents(u),_={};for(const v of u){const T=f[v.key];if(!T?.length){_[v.key]=v;continue}const S=v.overscaledZ+Ge.maxUnderzooming,C=T.filter(R=>R.tileID.overscaledZ<=S);if(!C.length){_[v.key]=v;continue}const z=Math.min(...C.map(R=>R.tileID.overscaledZ)),B=C.filter(R=>R.tileID.overscaledZ===z).map(R=>R.tileID);for(const R of B)a[R.key]=R;this._areDescendentsComplete(B,z,v.overscaledZ)||(_[v.key]=v)}return _}_getLoadedDescendents(e){var a;const u={};for(const f in this._tiles){const _=this._tiles[f];if(_.hasData())for(const v of e)_.tileID.isChildOf(v)&&(u[a=v.key]||(u[a]=[])).push(_)}return u}_areDescendentsComplete(e,a,u){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===a:Math.pow(4,a-u)===e.length}getLoadedTile(e){const a=this._tiles[e.key];return a?.hasData()?a:null}updateCacheSize(e){const a=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,f=Math.floor(a*u*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(_)}handleWrapJump(e){const a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){const u={};for(const f in this._tiles){const _=this._tiles[f];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+a),u[_.tileID.key]=_}this._tiles=u,this._resetTileReloadTimers()}}update(e,a){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=a,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new d.a0(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(u=Le(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?e.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter(S=>this._source.hasTile(S)))):u=[],this.usedForTerrain&&(u=this._addTerrainIdealTiles(u));const f=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,f&&this.fire(new d.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=xe(e,this._source),v=this._updateRetainedTiles(u,_),T=zi(this._source.type);T&&this._rasterFadeDuration>0&&!a&&this._updateFadingTiles(u,v),T?this._cleanUpRasterTiles(v):this._cleanUpVectorTiles(v)}_cleanUpRasterTiles(e){for(const a in this._tiles)e[a]||this._removeTile(a)}_cleanUpVectorTiles(e){for(const a in this._tiles){const u=this._tiles[a];e[a]?u.clearSymbolFadeHold():u.hasSymbolBuckets?u.holdingForSymbolFade()?u.symbolFadeFinished()&&this._removeTile(a):u.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(e){const a=[];for(const u of e)if(u.canonical.z>this._source.minzoom){const f=u.scaledTo(u.canonical.z-1);a.push(f);const _=u.scaledTo(Math.max(this._source.minzoom,Math.min(u.canonical.z,5)));a.push(_)}return e.concat(a)}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){var u;const f={},_={},v=Math.max(a-Ge.maxOverzooming,this._source.minzoom);let T={};for(const S of e){const C=this._addTile(S);f[S.key]=S,C.hasData()||(T[S.key]=S)}T=this._retainLoadedChildren(T,f);for(const S in T){const C=T[S];let z=this._tiles[S],B=z?.wasRequested();for(let R=C.overscaledZ-1;R>=v;--R){const N=C.scaledTo(R);if(_[N.key])break;if(_[N.key]=!0,z=this.getTile(N),!z&&B&&(z=this._addTile(N)),z){const q=z.hasData();if((q||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||B)&&(f[N.key]=N),B=z.wasRequested(),q)break}}}return f}_updateFadingTiles(e,a){const u=he(),f=d.ar(e);for(const _ of e){const v=this._tiles[_.key];v.fadingDirection!==mt.Departing&&v.fadeOpacity!==0||v.resetFadeLogic(),this._updateFadingAncestor(v,a,u)||this._updateFadingDescendents(v,a,u)||this._updateFadingEdge(v,f,u)||v.resetFadeLogic()}}_updateFadingAncestor(e,a,u){if(!e.hasData())return!1;const{tileID:f,fadingRole:_,fadingDirection:v,fadingParentID:T}=e;if(_===Zi.Base&&v===mt.Incoming&&T)return a[T.key]=T,!0;const S=Math.max(f.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let C=f.overscaledZ-1;C>=S;C--){const z=f.scaledTo(C),B=this.getLoadedTile(z);if(B)return e.setCrossFadeLogic({fadingRole:Zi.Base,fadingDirection:mt.Incoming,fadingParentID:B.tileID,fadeEndTime:u+this._rasterFadeDuration}),B.setCrossFadeLogic({fadingRole:Zi.Parent,fadingDirection:mt.Departing,fadeEndTime:u+this._rasterFadeDuration}),a[z.key]=z,!0}return!1}_updateFadingDescendents(e,a,u){if(!e.hasData())return!1;const f=e.tileID.children(this._source.maxzoom);let _=this._updateFadingChildren(e,f,a,u);if(_)return!0;for(const v of f){const T=v.children(this._source.maxzoom);this._updateFadingChildren(e,T,a,u)&&(_=!0)}return _}_updateFadingChildren(e,a,u,f){if(a[0].overscaledZ>=this._source.maxzoom)return!1;let _=!1;for(const v of a){const T=this.getLoadedTile(v);if(!T)continue;const{fadingRole:S,fadingDirection:C,fadingParentID:z}=T;S===Zi.Base&&C===mt.Departing&&z||(T.setCrossFadeLogic({fadingRole:Zi.Base,fadingDirection:mt.Departing,fadingParentID:e.tileID,fadeEndTime:f+this._rasterFadeDuration}),e.setCrossFadeLogic({fadingRole:Zi.Parent,fadingDirection:mt.Incoming,fadeEndTime:f+this._rasterFadeDuration})),u[v.key]=v,_=!0}return _}_updateFadingEdge(e,a,u){const f=e.tileID;return!!e.selfFading||!e.hasData()&&!!a.has(f)&&(e.setSelfFadeLogic(u+this._rasterFadeDuration),!0)}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(a.resetFadeLogic(),this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null));const u=a;return a||(a=new j(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,e.key,a.state)),a.uses++,this._tiles[e.key]=a,u||this._source.fire(new d.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){this._clearTileReloadTimer(e);const u=a.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_clearTileReloadTimer(e){const a=this._timers[e];a&&(clearTimeout(a),delete this._timers[e])}_resetTileReloadTimers(){for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}refreshTiles(e){for(const a in this._tiles)(this._isIdRenderable(a)||this._tiles[a].state=="errored")&&e.some(u=>u.equals(this._tiles[a].tileID.canonical))&&this._reloadTile(a,"expired")}_removeTile(e){const a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._clearTileReloadTimer(e),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(e){e.dataType==="source"&&(e.sourceDataType!=="metadata"?e.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged,e.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,u){const f=[],_=this.transform;if(!_)return f;const v=_.getCoveringTilesDetailsProvider().allowWorldCopies(),T=u?_.getCameraQueryGeometry(e):e,S=N=>_.screenPointToMercatorCoordinate(N,this.terrain),C=this.transformBbox(e,S,!v),z=this.transformBbox(T,S,!v),B=this.getIds(),R=d.a6.fromPoints(z);for(let N=0;N<B.length;N++){const q=this._tiles[B[N]];if(q.holdingForSymbolFade())continue;const K=v?[q.tileID]:[q.tileID.unwrapTo(-1),q.tileID.unwrapTo(0)],J=Math.pow(2,_.zoom-q.tileID.overscaledZ),et=a*q.queryPadding*d.a3/q.tileSize/J;for(const at of K){const ct=R.map(rt=>at.getTilePoint(new d.a5(rt.x,rt.y)));if(ct.expandBy(et),ct.intersects(en)){const rt=C.map(pt=>at.getTilePoint(pt)),ht=z.map(pt=>at.getTilePoint(pt));f.push({tile:q,tileID:v?at:at.unwrapTo(0),queryGeometry:rt,cameraQueryGeometry:ht,scale:J})}}}return f}transformBbox(e,a,u){let f=e.map(a);if(u){const _=d.a6.fromPoints(e);_.shrinkBy(.001*Math.min(_.width(),_.height()));const v=_.map(a);d.a6.fromPoints(f).covers(v)||(f=f.map(T=>T.x>.5?new d.a5(T.x-1,T.y,T.z):T))}return f}getVisibleCoordinates(e){const a=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);return this.transform&&this.transform.populateCache(a),a}hasTransition(){if(this._source.hasTransition())return!0;if(zi(this._source.type)&&this._rasterFadeDuration>0){const e=he();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,a,u){this._state.updateState(e=e||"_geojsonTileLayer",a,u)}removeFeatureState(e,a,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",a,u)}getFeatureState(e,a){return this._state.getState(e=e||"_geojsonTileLayer",a)}setDependencies(e,a,u){const f=this._tiles[e];f&&f.setDependencies(a,u)}reloadTilesForDependencies(e,a){for(const u in this._tiles)this._tiles[u].hasDependency(e,a)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(e,a))}}function li(m,e){const a=Math.abs(2*m.wrap)-+(m.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||u-a||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function zi(m){return m==="raster"||m==="image"||m==="video"}Ge.maxOverzooming=10,Ge.maxUnderzooming=3;class Qt{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ai(e,0,1);let a=1,u=this._distances[a];const f=e*this.paddedLength+this.padding;for(;u<f&&a<this._distances.length;)u=this._distances[++a];const _=a-1,v=this._distances[_],T=u-v,S=T>0?(f-v)/T:0;return this.points[_].mult(1-S).add(this.points[a].mult(S))}}function Di(m,e){let a=!0;return m==="always"||m!=="never"&&e!=="never"||(a=!1),a}class Pi{constructor(e,a,u){const f=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(a/u);for(let v=0;v<this.xCellCount*this.yCellCount;v++)f.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,u,f,_){this._forEachCell(a,u,f,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(_)}insertCircle(e,a,u,f){this._forEachCell(a-f,u-f,a+f,u+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(u),this.circles.push(f)}_insertBoxCell(e,a,u,f,_,v){this.boxCells[_].push(v)}_insertCircleCell(e,a,u,f,_,v){this.circleCells[_].push(v)}_query(e,a,u,f,_,v,T){if(u<0||e>this.width||f<0||a>this.height)return[];const S=[];if(e<=0&&a<=0&&this.width<=u&&this.height<=f){if(_)return[{key:null,x1:e,y1:a,x2:u,y2:f}];for(let C=0;C<this.boxKeys.length;C++)S.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const z=this.circles[3*C],B=this.circles[3*C+1],R=this.circles[3*C+2];S.push({key:this.circleKeys[C],x1:z-R,y1:B-R,x2:z+R,y2:B+R})}}else this._forEachCell(e,a,u,f,this._queryCell,S,{hitTest:_,overlapMode:v,seenUids:{box:{},circle:{}}},T);return S}query(e,a,u,f){return this._query(e,a,u,f,!1,null)}hitTest(e,a,u,f,_,v){return this._query(e,a,u,f,!0,_,v).length>0}hitTestCircle(e,a,u,f,_){const v=e-u,T=e+u,S=a-u,C=a+u;if(T<0||v>this.width||C<0||S>this.height)return!1;const z=[];return this._forEachCell(v,S,T,C,this._queryCellCircle,z,{hitTest:!0,overlapMode:f,circle:{x:e,y:a,radius:u},seenUids:{box:{},circle:{}}},_),z.length>0}_queryCell(e,a,u,f,_,v,T,S){const{seenUids:C,hitTest:z,overlapMode:B}=T,R=this.boxCells[_];if(R!==null){const q=this.bboxes;for(const K of R)if(!C.box[K]){C.box[K]=!0;const J=4*K,et=this.boxKeys[K];if(e<=q[J+2]&&a<=q[J+3]&&u>=q[J+0]&&f>=q[J+1]&&(!S||S(et))&&(!z||!Di(B,et.overlapMode))&&(v.push({key:et,x1:q[J],y1:q[J+1],x2:q[J+2],y2:q[J+3]}),z))return!0}}const N=this.circleCells[_];if(N!==null){const q=this.circles;for(const K of N)if(!C.circle[K]){C.circle[K]=!0;const J=3*K,et=this.circleKeys[K];if(this._circleAndRectCollide(q[J],q[J+1],q[J+2],e,a,u,f)&&(!S||S(et))&&(!z||!Di(B,et.overlapMode))){const at=q[J],ct=q[J+1],rt=q[J+2];if(v.push({key:et,x1:at-rt,y1:ct-rt,x2:at+rt,y2:ct+rt}),z)return!0}}}return!1}_queryCellCircle(e,a,u,f,_,v,T,S){const{circle:C,seenUids:z,overlapMode:B}=T,R=this.boxCells[_];if(R!==null){const q=this.bboxes;for(const K of R)if(!z.box[K]){z.box[K]=!0;const J=4*K,et=this.boxKeys[K];if(this._circleAndRectCollide(C.x,C.y,C.radius,q[J+0],q[J+1],q[J+2],q[J+3])&&(!S||S(et))&&!Di(B,et.overlapMode))return v.push(!0),!0}}const N=this.circleCells[_];if(N!==null){const q=this.circles;for(const K of N)if(!z.circle[K]){z.circle[K]=!0;const J=3*K,et=this.circleKeys[K];if(this._circlesCollide(q[J],q[J+1],q[J+2],C.x,C.y,C.radius)&&(!S||S(et))&&!Di(B,et.overlapMode))return v.push(!0),!0}}}_forEachCell(e,a,u,f,_,v,T,S){const C=this._convertToXCellCoord(e),z=this._convertToYCellCoord(a),B=this._convertToXCellCoord(u),R=this._convertToYCellCoord(f);for(let N=C;N<=B;N++)for(let q=z;q<=R;q++)if(_.call(this,e,a,u,f,this.xCellCount*q+N,v,T,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,u,f,_,v){const T=f-e,S=_-a,C=u+v;return C*C>T*T+S*S}_circleAndRectCollide(e,a,u,f,_,v,T){const S=(v-f)/2,C=Math.abs(e-(f+S));if(C>S+u)return!1;const z=(T-_)/2,B=Math.abs(a-(_+z));if(B>z+u)return!1;if(C<=S||B<=z)return!0;const R=C-S,N=B-z;return R*R+N*N<=u*u}}function mn(m,e,a){const u=d.M();if(!m){const{vecSouth:B,vecEast:R}=Ht(e),N=At();N[0]=R[0],N[1]=R[1],N[2]=B[0],N[3]=B[1],f=N,(z=(v=(_=N)[0])*(C=_[3])-(S=_[2])*(T=_[1]))&&(f[0]=C*(z=1/z),f[1]=-T*z,f[2]=-S*z,f[3]=v*z),u[0]=N[0],u[1]=N[1],u[4]=N[2],u[5]=N[3]}var f,_,v,T,S,C,z;return d.O(u,u,[1/a,1/a,1]),u}function ui(m,e,a,u){if(m){const f=d.M();if(!e){const{vecSouth:_,vecEast:v}=Ht(a);f[0]=v[0],f[1]=v[1],f[4]=_[0],f[5]=_[1]}return d.O(f,f,[u,u,1]),f}return a.pixelsToClipSpaceMatrix}function Ht(m){const e=Math.cos(m.rollInRadians),a=Math.sin(m.rollInRadians),u=Math.cos(m.pitchInRadians),f=Math.cos(m.bearingInRadians),_=Math.sin(m.bearingInRadians),v=d.aw();v[0]=-f*u*a-_*e,v[1]=-_*u*a+f*e;const T=d.ax(v);T<1e-9?d.ay(v):d.az(v,v,1/T);const S=d.aw();S[0]=f*u*e-_*a,S[1]=_*u*e+f*a;const C=d.ax(S);return C<1e-9?d.ay(S):d.az(S,S,1/C),{vecEast:S,vecSouth:v}}function se(m,e,a,u){let f;u?(f=[m,e,u(m,e),1],d.aB(f,f,a)):(f=[m,e,0,1],fu(f,f,a));const _=f[3];return{point:new d.P(f[0]/_,f[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function be(m,e){return .5+m/e*.5}function cr(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function Bo(m,e,a,u,f,_,v,T,S,C,z,B,R){const N=a?m.textSizeData:m.iconSizeData,q=d.as(N,e.transform.zoom),K=[256/e.width*2+1,256/e.height*2+1],J=a?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;J.clear();const et=m.lineVertexArray,at=a?m.text.placedSymbolArray:m.icon.placedSymbolArray,ct=e.transform.width/e.transform.height;let rt=!1;for(let ht=0;ht<at.length;ht++){const pt=at.get(ht);if(pt.hidden||pt.writingMode===d.at.vertical&&!rt){Tr(pt.numGlyphs,J);continue}rt=!1;const lt=new d.P(pt.anchorX,pt.anchorY),xt={getElevation:R,pitchedLabelPlaneMatrix:u,lineVertexArray:et,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:lt,unwrappedTileID:S,width:C,height:z,translation:B},Dt=ba(pt.anchorX,pt.anchorY,xt);if(!cr(Dt.point,K)){Tr(pt.numGlyphs,J);continue}const Mt=be(e.transform.cameraToCenterDistance,Dt.signedDistanceFromCamera),Et=d.au(N,q,pt),Pt=_?Et*e.transform.getPitchedTextCorrection(pt.anchorX,pt.anchorY,S)/Mt:Et*Mt,Kt=Qr({projectionContext:xt,pitchedLabelPlaneMatrixInverse:f,symbol:pt,fontSize:Pt,flip:!1,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:J,aspectRatio:ct,rotateToLine:T});rt=Kt.useVertical,(Kt.notEnoughRoom||rt||Kt.needsFlipping&&Qr({projectionContext:xt,pitchedLabelPlaneMatrixInverse:f,symbol:pt,fontSize:Pt,flip:!0,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:J,aspectRatio:ct,rotateToLine:T}).notEnoughRoom)&&Tr(pt.numGlyphs,J)}a?m.text.dynamicLayoutVertexBuffer.updateData(J):m.icon.dynamicLayoutVertexBuffer.updateData(J)}function Gn(m,e,a,u,f,_,v,T){const S=_.glyphStartIndex+_.numGlyphs,C=_.lineStartIndex,z=_.lineStartIndex+_.lineLength,B=e.getoffsetX(_.glyphStartIndex),R=e.getoffsetX(S-1),N=Ii(m*B,a,u,f,_.segment,C,z,T,v);if(!N)return null;const q=Ii(m*R,a,u,f,_.segment,C,z,T,v);return q?T.projectionCache.anyProjectionOccluded?null:{first:N,last:q}:null}function Ie(m,e,a,u){return m===d.at.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*u?{useVertical:!0}:(m===d.at.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function Qr(m){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:a,symbol:u,fontSize:f,flip:_,keepUpright:v,glyphOffsetArray:T,dynamicLayoutVertexArray:S,aspectRatio:C,rotateToLine:z}=m,B=f/24,R=u.lineOffsetX*B,N=u.lineOffsetY*B;let q;if(u.numGlyphs>1){const K=u.glyphStartIndex+u.numGlyphs,J=u.lineStartIndex,et=u.lineStartIndex+u.lineLength,at=Gn(B,T,R,N,_,u,z,e);if(!at)return{notEnoughRoom:!0};const ct=xa(at.first.point.x,at.first.point.y,e,a),rt=xa(at.last.point.x,at.last.point.y,e,a);if(v&&!_){const ht=Ie(u.writingMode,ct,rt,C);if(ht)return ht}q=[at.first];for(let ht=u.glyphStartIndex+1;ht<K-1;ht++){const pt=Ii(B*T.getoffsetX(ht),R,N,_,u.segment,J,et,e,z);if(!pt)return{notEnoughRoom:!0};q.push(pt)}q.push(at.last)}else{if(v&&!_){const J=hr(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,et=u.lineStartIndex+u.segment+1,at=new d.P(e.lineVertexArray.getx(et),e.lineVertexArray.gety(et)),ct=hr(at.x,at.y,e),rt=ct.signedDistanceFromCamera>0?ct.point:eo(e.tileAnchorPoint,at,J,1,e),ht=xa(J.x,J.y,e,a),pt=xa(rt.x,rt.y,e,a),lt=Ie(u.writingMode,ht,pt,C);if(lt)return lt}const K=Ii(B*T.getoffsetX(u.glyphStartIndex),R,N,_,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,e,z);if(!K||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};q=[K]}for(const K of q)d.aA(S,K.point,K.angle);return{}}function eo(m,e,a,u,f){const _=m.add(m.sub(e)._unit()),v=hr(_.x,_.y,f).point,T=a.sub(v);return a.add(T._mult(u/T.mag()))}function va(m,e,a){const u=e.projectionCache;if(u.projections[m])return u.projections[m];const f=new d.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),_=hr(f.x,f.y,e);if(_.signedDistanceFromCamera>0)return u.projections[m]=_.point,u.anyProjectionOccluded=u.anyProjectionOccluded||_.isOccluded,_.point;const v=m-a.direction;return eo(a.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),f,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,e)}function hr(m,e,a){const u=m+a.translation[0],f=e+a.translation[1];let _;return a.pitchWithMap?(_=se(u,f,a.pitchedLabelPlaneMatrix,a.getElevation),_.isOccluded=!1):(_=a.transform.projectTileCoordinates(u,f,a.unwrappedTileID,a.getElevation),_.point.x=(.5*_.point.x+.5)*a.width,_.point.y=(.5*-_.point.y+.5)*a.height),_}function xa(m,e,a,u){if(a.pitchWithMap){const f=[m,e,0,1];return d.aB(f,f,u),a.transform.projectTileCoordinates(f[0]/f[3],f[1]/f[3],a.unwrappedTileID,a.getElevation).point}return{x:m/a.width*2-1,y:1-e/a.height*2}}function ba(m,e,a){return a.transform.projectTileCoordinates(m,e,a.unwrappedTileID,a.getElevation)}function nn(m,e,a){return m._unit()._perp()._mult(e*a)}function Br(m,e,a,u,f,_,v,T,S){if(T.projectionCache.offsets[m])return T.projectionCache.offsets[m];const C=a.add(e);if(m+S.direction<u||m+S.direction>=f)return T.projectionCache.offsets[m]=C,C;const z=va(m+S.direction,T,S),B=nn(z.sub(a),v,S.direction),R=a.add(B),N=z.add(B);return T.projectionCache.offsets[m]=d.aC(_,C,R,N)||C,T.projectionCache.offsets[m]}function Ii(m,e,a,u,f,_,v,T,S){const C=u?m-e:m+e;let z=C>0?1:-1,B=0;u&&(z*=-1,B=Math.PI),z<0&&(B+=Math.PI);let R,N=z>0?_+f:_+f+1;T.projectionCache.cachedAnchorPoint?R=T.projectionCache.cachedAnchorPoint:(R=hr(T.tileAnchorPoint.x,T.tileAnchorPoint.y,T).point,T.projectionCache.cachedAnchorPoint=R);let q,K,J=R,et=R,at=0,ct=0;const rt=Math.abs(C),ht=[];let pt;for(;at+ct<=rt;){if(N+=z,N<_||N>=v)return null;at+=ct,et=J,K=q;const Dt={absOffsetX:rt,direction:z,distanceFromAnchor:at,previousVertex:et};if(J=va(N,T,Dt),a===0)ht.push(et),pt=J.sub(et);else{let Mt;const Et=J.sub(et);Mt=Et.mag()===0?nn(va(N+z,T,Dt).sub(J),a,z):nn(Et,a,z),K||(K=et.add(Mt)),q=Br(N,Mt,J,_,v,K,a,T,Dt),ht.push(K),pt=q.sub(K)}ct=pt.mag()}const lt=pt._mult((rt-at)/ct)._add(K||et),xt=B+Math.atan2(J.y-et.y,J.x-et.x);return ht.push(lt),{point:lt,angle:S?xt:0,path:ht}}const Oo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Tr(m,e){for(let a=0;a<m;a++){const u=e.length;e.resize(u+4),e.float32.set(Oo,3*u)}}function fu(m,e,a){const u=e[0],f=e[1];return m[0]=a[0]*u+a[4]*f+a[12],m[1]=a[1]*u+a[5]*f+a[13],m[3]=a[3]*u+a[7]*f+a[15],m}const qi=100;class gs{constructor(e,a=new Pi(e.width+200,e.height+200,25),u=new Pi(e.width+200,e.height+200,25)){this.transform=e,this.grid=a,this.ignoredGrid=u,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+qi,this.screenBottomBoundary=e.height+qi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,u,f,_,v,T,S,C,z,B,R){const N=this.projectAndGetPerspectiveRatio(e.anchorPointX+S[0],e.anchorPointY+S[1],_,z,R),q=u*N.perspectiveRatio;let K;if(v||T)K=this._projectCollisionBox(e,q,f,_,v,T,S,N,z,B,R);else{const pt=N.x+(B?B.x*q:0),lt=N.y+(B?B.y*q:0);K={allPointsOccluded:!1,box:[pt+e.x1*q,lt+e.y1*q,pt+e.x2*q,lt+e.y2*q]}}const[J,et,at,ct]=K.box,rt=v?K.allPointsOccluded:N.isOccluded;let ht=rt;return ht||(ht=N.perspectiveRatio<this.perspectiveRatioCutoff),ht||(ht=!this.isInsideGrid(J,et,at,ct)),ht||a!=="always"&&this.grid.hitTest(J,et,at,ct,a,C)?{box:[J,et,at,ct],placeable:!1,offscreen:!1,occluded:rt}:{box:[J,et,at,ct],placeable:!0,offscreen:this.isOffscreen(J,et,at,ct),occluded:rt}}placeCollisionCircles(e,a,u,f,_,v,T,S,C,z,B,R,N,q){const K=[],J=new d.P(a.anchorX,a.anchorY),et=this.getPerspectiveRatio(J.x,J.y,v,q),at=(C?_*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,v)/et:_*et)/d.aG,ct={getElevation:q,pitchedLabelPlaneMatrix:T,lineVertexArray:u,pitchWithMap:C,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:J,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:N},rt=Gn(at,f,a.lineOffsetX*at,a.lineOffsetY*at,!1,a,!1,ct);let ht=!1,pt=!1,lt=!0;if(rt){const xt=.5*B*et+R,Dt=new d.P(-100,-100),Mt=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Et=new Qt,Pt=rt.first,Kt=rt.last;let Jt=[];for(let me=Pt.path.length-1;me>=1;me--)Jt.push(Pt.path[me]);for(let me=1;me<Kt.path.length;me++)Jt.push(Kt.path[me]);const Gt=2.5*xt;if(C){const me=this.projectPathToScreenSpace(Jt,ct);Jt=me.some(ci=>ci.signedDistanceFromCamera<=0)?[]:me.map(ci=>ci.point)}let ce=[];if(Jt.length>0){const me=Jt[0].clone(),ci=Jt[0].clone();for(let Ui=1;Ui<Jt.length;Ui++)me.x=Math.min(me.x,Jt[Ui].x),me.y=Math.min(me.y,Jt[Ui].y),ci.x=Math.max(ci.x,Jt[Ui].x),ci.y=Math.max(ci.y,Jt[Ui].y);ce=me.x>=Dt.x&&ci.x<=Mt.x&&me.y>=Dt.y&&ci.y<=Mt.y?[Jt]:ci.x<Dt.x||me.x>Mt.x||ci.y<Dt.y||me.y>Mt.y?[]:d.aD([Jt],Dt.x,Dt.y,Mt.x,Mt.y)}for(const me of ce){Et.reset(me,.25*xt);let ci=0;ci=Et.length<=.5*xt?1:Math.ceil(Et.paddedLength/Gt)+1;for(let Ui=0;Ui<ci;Ui++){const Li=Ui/Math.max(ci-1,1),ji=Et.lerp(Li),Si=ji.x+qi,xn=ji.y+qi;K.push(Si,xn,xt,0);const Mi=Si-xt,Dn=xn-xt,on=Si+xt,bn=xn+xt;if(lt=lt&&this.isOffscreen(Mi,Dn,on,bn),pt=pt||this.isInsideGrid(Mi,Dn,on,bn),e!=="always"&&this.grid.hitTestCircle(Si,xn,xt,e,z)&&(ht=!0,!S))return{circles:[],offscreen:!1,collisionDetected:ht}}}}return{circles:!S&&ht||!pt||et<this.perspectiveRatioCutoff?[]:K,offscreen:lt,collisionDetected:ht}}projectPathToScreenSpace(e,a){const u=function(f,_){const v=d.M();return d.av(v,_.pitchedLabelPlaneMatrix),f.map(T=>{const S=se(T.x,T.y,v,_.getElevation),C=_.transform.projectTileCoordinates(S.point.x,S.point.y,_.unwrappedTileID,_.getElevation);return C.point.x=(.5*C.point.x+.5)*_.width,C.point.y=(.5*-C.point.y+.5)*_.height,C})}(e,a);return function(f){let _=0,v=0,T=0,S=0;for(let C=0;C<f.length;C++)f[C].isOccluded?(T=C+1,S=0):(S++,S>v&&(v=S,_=T));return f.slice(_,_+v)}(u)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],u=new d.a6;for(const B of e){const R=new d.P(B.x+qi,B.y+qi);u.extend(R),a.push(R)}const{minX:f,minY:_,maxX:v,maxY:T}=u,S=this.grid.query(f,_,v,T).concat(this.ignoredGrid.query(f,_,v,T)),C={},z={};for(const B of S){const R=B.key;if(C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]={}),C[R.bucketInstanceId][R.featureIndex])continue;const N=[new d.P(B.x1,B.y1),new d.P(B.x2,B.y1),new d.P(B.x2,B.y2),new d.P(B.x1,B.y2)];d.aE(a,N)&&(C[R.bucketInstanceId][R.featureIndex]=!0,z[R.bucketInstanceId]===void 0&&(z[R.bucketInstanceId]=[]),z[R.bucketInstanceId].push(R.featureIndex))}return z}insertCollisionBox(e,a,u,f,_,v){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:v,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,u,f,_,v){const T=u?this.ignoredGrid:this.grid,S={bucketInstanceId:f,featureIndex:_,collisionGroupID:v,overlapMode:a};for(let C=0;C<e.length;C+=4)T.insertCircle(S,e[C],e[C+1],e[C+2])}projectAndGetPerspectiveRatio(e,a,u,f,_){if(_){let v;f?(v=[e,a,f(e,a),1],d.aB(v,v,_)):(v=[e,a,0,1],fu(v,v,_));const T=v[3];return{x:(v[0]/T+1)/2*this.transform.width+qi,y:(-v[1]/T+1)/2*this.transform.height+qi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T*.5,isOccluded:!1,signedDistanceFromCamera:T}}{const v=this.transform.projectTileCoordinates(e,a,u,f);return{x:(v.point.x+1)/2*this.transform.width+qi,y:(1-v.point.y)/2*this.transform.height+qi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(e,a,u,f){const _=this.transform.projectTileCoordinates(e,a,u,f);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(e,a,u,f){return u<qi||e>=this.screenRightBoundary||f<qi||a>this.screenBottomBoundary}isInsideGrid(e,a,u,f){return u>=0&&e<this.gridRightBoundary&&f>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const e=d.am([]);return d.N(e,e,[-100,-100,0]),e}_projectCollisionBox(e,a,u,f,_,v,T,S,C,z,B){let R=1,N=0,q=0,K=1;const J=e.anchorPointX+T[0],et=e.anchorPointY+T[1];if(v&&!_){const Jt=this.projectAndGetPerspectiveRatio(J+1,et,f,C,B),Gt=Jt.x-S.x,ce=Math.atan((Jt.y-S.y)/Gt)+(Gt<0?Math.PI:0),me=Math.sin(ce),ci=Math.cos(ce);R=ci,N=me,q=-me,K=ci}else if(!v&&_){const Jt=Ht(this.transform);R=Jt.vecEast[0],N=Jt.vecEast[1],q=Jt.vecSouth[0],K=Jt.vecSouth[1]}let at=S.x,ct=S.y,rt=a;_&&(at=J,ct=et,rt=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),rt*=this.transform.getPitchedTextCorrection(J,et,f),z||(rt*=d.ai(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(at+=R*z.x*rt+q*z.y*rt,ct+=N*z.x*rt+K*z.y*rt);const ht=e.x1*rt,pt=e.x2*rt,lt=(ht+pt)/2,xt=e.y1*rt,Dt=e.y2*rt,Mt=(xt+Dt)/2,Et=[{offsetX:ht,offsetY:xt},{offsetX:lt,offsetY:xt},{offsetX:pt,offsetY:xt},{offsetX:pt,offsetY:Mt},{offsetX:pt,offsetY:Dt},{offsetX:lt,offsetY:Dt},{offsetX:ht,offsetY:Dt},{offsetX:ht,offsetY:Mt}];let Pt=[];for(const{offsetX:Jt,offsetY:Gt}of Et)Pt.push(new d.P(at+R*Jt+q*Gt,ct+N*Jt+K*Gt));let Kt=!1;if(_){const Jt=Pt.map(Gt=>this.projectAndGetPerspectiveRatio(Gt.x,Gt.y,f,C,B));Kt=Jt.some(Gt=>!Gt.isOccluded),Pt=Jt.map(Gt=>new d.P(Gt.x,Gt.y))}else Kt=!0;return{box:d.aF(Pt),allPointsOccluded:!Kt}}}class mh{constructor(e,a,u,f){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):f&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class _s{constructor(e,a,u,f,_){this.text=new mh(e?e.text:null,a,u,_),this.icon=new mh(e?e.icon:null,a,f,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Pl{constructor(e,a,u){this.text=e,this.icon=a,this.skipFade=u}}class Or{constructor(e,a,u,f,_){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=u,this.bucketIndex=f,this.tileID=_}}class Jr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:u=>u.collisionGroupID===a}}return this.collisionGroups[e]}}function gh(m,e,a,u,f){const{horizontalAlign:_,verticalAlign:v}=d.aM(m);return new d.P(-(_-.5)*e+u[0]*f,-(v-.5)*a+u[1]*f)}class ip{constructor(e,a,u,f,_){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new gs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Jr(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const a=this.terrain;return a?(u,f)=>a.getElevation(e,u,f):null}getBucketParts(e,a,u,f){const _=u.getBucket(a),v=u.latestFeatureIndex;if(!_||!v||a.id!==_.layerIds[0])return;const T=u.collisionBoxArray,S=_.layers[0].layout,C=_.layers[0].paint,z=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),B=u.tileSize/d.a3,R=u.tileID.toUnwrapped(),N=S.get("text-rotation-alignment")==="map",q=d.aH(u,1,this.transform.zoom),K=d.aI(this.collisionIndex.transform,u,C.get("text-translate"),C.get("text-translate-anchor")),J=d.aI(this.collisionIndex.transform,u,C.get("icon-translate"),C.get("icon-translate-anchor")),et=mn(N,this.transform,q);this.retainedQueryData[_.bucketInstanceId]=new Or(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,u.tileID);const at={bucket:_,layout:S,translationText:K,translationIcon:J,unwrappedTileID:R,pitchedLabelPlaneMatrix:et,scale:z,textPixelRatio:B,holdingForFade:u.holdingForSymbolFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:d.as(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(f)for(const ct of _.sortKeyRanges){const{sortKey:rt,symbolInstanceStart:ht,symbolInstanceEnd:pt}=ct;e.push({sortKey:rt,symbolInstanceStart:ht,symbolInstanceEnd:pt,parameters:at})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:at})}attemptAnchorPlacement(e,a,u,f,_,v,T,S,C,z,B,R,N,q,K,J,et,at,ct,rt){const ht=d.aJ[e.textAnchor],pt=[e.textOffset0,e.textOffset1],lt=gh(ht,u,f,pt,_),xt=this.collisionIndex.placeCollisionBox(a,R,S,C,z,T,v,J,B.predicate,ct,lt,rt);if((!at||this.collisionIndex.placeCollisionBox(at,R,S,C,z,T,v,et,B.predicate,ct,lt,rt).placeable)&&xt.placeable){let Dt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID].text&&(Dt=this.prevPlacement.variableOffsets[N.crossTileID].anchor),N.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[N.crossTileID]={textOffset:pt,width:u,height:f,anchor:ht,textBoxScale:_,prevAnchor:Dt},this.markUsedJustification(q,ht,N,K),q.allowVerticalPlacement&&(this.markUsedOrientation(q,K,N),this.placedOrientations[N.crossTileID]=K),{shift:lt,placedGlyphBoxes:xt}}}placeLayerBucketPart(e,a,u){const{bucket:f,layout:_,translationText:v,translationIcon:T,unwrappedTileID:S,pitchedLabelPlaneMatrix:C,textPixelRatio:z,holdingForFade:B,collisionBoxArray:R,partiallyEvaluatedTextSize:N,collisionGroup:q}=e.parameters,K=_.get("text-optional"),J=_.get("icon-optional"),et=d.aK(_,"text-overlap","text-allow-overlap"),at=et==="always",ct=d.aK(_,"icon-overlap","icon-allow-overlap"),rt=ct==="always",ht=_.get("text-rotation-alignment")==="map",pt=_.get("text-pitch-alignment")==="map",lt=_.get("icon-text-fit")!=="none",xt=_.get("symbol-z-order")==="viewport-y",Dt=at&&(rt||!f.hasIconData()||J),Mt=rt&&(at||!f.hasTextData()||K);!f.collisionArrays&&R&&f.deserializeCollisionBoxes(R);const Et=this.retainedQueryData[f.bucketInstanceId].tileID,Pt=this._getTerrainElevationFunc(Et),Kt=this.transform.getFastPathSimpleProjectionMatrix(Et),Jt=(Gt,ce,me)=>{var ci,Ui;if(a[Gt.crossTileID])return;if(B)return void(this.placements[Gt.crossTileID]=new Pl(!1,!1,!1));let Li=!1,ji=!1,Si=!0,xn=null,Mi={box:null,placeable:!1,offscreen:null,occluded:!1},Dn={placeable:!1},on=null,bn=null,Hn=null,Pa=0,Is=0,Rs=0;ce.textFeatureIndex?Pa=ce.textFeatureIndex:Gt.useRuntimeCollisionCircles&&(Pa=Gt.featureIndex),ce.verticalTextFeatureIndex&&(Is=ce.verticalTextFeatureIndex);const Ia=ce.textBox;if(Ia){const qr=Vi=>{let vi=d.at.horizontal;if(f.allowVerticalPlacement&&!Vi&&this.prevPlacement){const Qi=this.prevPlacement.placedOrientations[Gt.crossTileID];Qi&&(this.placedOrientations[Gt.crossTileID]=Qi,vi=Qi,this.markUsedOrientation(f,vi,Gt))}return vi},ks=(Vi,vi)=>{if(f.allowVerticalPlacement&&Gt.numVerticalGlyphVertices>0&&ce.verticalTextBox){for(const Qi of f.writingModes)if(Qi===d.at.vertical?(Mi=vi(),Dn=Mi):Mi=Vi(),Mi&&Mi.placeable)break}else Mi=Vi()},Bs=Gt.textAnchorOffsetStartIndex,Os=Gt.textAnchorOffsetEndIndex;if(Os===Bs){const Vi=(vi,Qi)=>{const ki=this.collisionIndex.placeCollisionBox(vi,et,z,Et,S,pt,ht,v,q.predicate,Pt,void 0,Kt);return ki&&ki.placeable&&(this.markUsedOrientation(f,Qi,Gt),this.placedOrientations[Gt.crossTileID]=Qi),ki};ks(()=>Vi(Ia,d.at.horizontal),()=>{const vi=ce.verticalTextBox;return f.allowVerticalPlacement&&Gt.numVerticalGlyphVertices>0&&vi?Vi(vi,d.at.vertical):{box:null,offscreen:null}}),qr(Mi&&Mi.placeable)}else{let Vi=d.aJ[(Ui=(ci=this.prevPlacement)===null||ci===void 0?void 0:ci.variableOffsets[Gt.crossTileID])===null||Ui===void 0?void 0:Ui.anchor];const vi=(ki,Nh,Uh)=>{const Wl=ki.x2-ki.x1,So=ki.y2-ki.y1,jh=Gt.textBoxScale,Vh=lt&&ct==="never"?Nh:null;let Ra=null,Zu=et==="never"?1:2,Fs="never";Vi&&Zu++;for(let Ns=0;Ns<Zu;Ns++){for(let hs=Bs;hs<Os;hs++){const Gh=f.textAnchorOffsets.get(hs);if(Vi&&Gh.textAnchor!==Vi)continue;const Kl=this.attemptAnchorPlacement(Gh,ki,Wl,So,jh,ht,pt,z,Et,S,q,Fs,Gt,f,Uh,v,T,Vh,Pt);if(Kl&&(Ra=Kl.placedGlyphBoxes,Ra&&Ra.placeable))return Li=!0,xn=Kl.shift,Ra}Vi?Vi=null:Fs=et}return u&&!Ra&&(Ra={box:this.collisionIndex.placeCollisionBox(Ia,"always",z,Et,S,pt,ht,v,q.predicate,Pt,void 0,Kt).box,offscreen:!1,placeable:!1,occluded:!1}),Ra};ks(()=>vi(Ia,ce.iconBox,d.at.horizontal),()=>{const ki=ce.verticalTextBox;return f.allowVerticalPlacement&&(!Mi||!Mi.placeable)&&Gt.numVerticalGlyphVertices>0&&ki?vi(ki,ce.verticalIconBox,d.at.vertical):{box:null,occluded:!0,offscreen:null}}),Mi&&(Li=Mi.placeable,Si=Mi.offscreen);const Qi=qr(Mi&&Mi.placeable);if(!Li&&this.prevPlacement){const ki=this.prevPlacement.variableOffsets[Gt.crossTileID];ki&&(this.variableOffsets[Gt.crossTileID]=ki,this.markUsedJustification(f,ki.anchor,Gt,Qi))}}}if(on=Mi,Li=on&&on.placeable,Si=on&&on.offscreen,Gt.useRuntimeCollisionCircles&&Gt.centerJustifiedTextSymbolIndex>=0){const qr=f.text.placedSymbolArray.get(Gt.centerJustifiedTextSymbolIndex),ks=d.au(f.textSizeData,N,qr),Bs=_.get("text-padding");bn=this.collisionIndex.placeCollisionCircles(et,qr,f.lineVertexArray,f.glyphOffsetArray,ks,S,C,u,pt,q.predicate,Gt.collisionCircleDiameter,Bs,v,Pt),bn.circles.length&&bn.collisionDetected&&!u&&d.w("Collisions detected, but collision boxes are not shown"),Li=at||bn.circles.length>0&&!bn.collisionDetected,Si=Si&&bn.offscreen}if(ce.iconFeatureIndex&&(Rs=ce.iconFeatureIndex),ce.iconBox){const qr=ks=>this.collisionIndex.placeCollisionBox(ks,ct,z,Et,S,pt,ht,T,q.predicate,Pt,lt&&xn?xn:void 0,Kt);Dn&&Dn.placeable&&ce.verticalIconBox?(Hn=qr(ce.verticalIconBox),ji=Hn.placeable):(Hn=qr(ce.iconBox),ji=Hn.placeable),Si=Si&&Hn.offscreen}const ia=K||Gt.numHorizontalGlyphVertices===0&&Gt.numVerticalGlyphVertices===0,To=J||Gt.numIconVertices===0;ia||To?To?ia||(ji=ji&&Li):Li=ji&&Li:ji=Li=ji&&Li;const Ls=ji&&Hn.placeable;if(Li&&on.placeable&&this.collisionIndex.insertCollisionBox(on.box,et,_.get("text-ignore-placement"),f.bucketInstanceId,Dn&&Dn.placeable&&Is?Is:Pa,q.ID),Ls&&this.collisionIndex.insertCollisionBox(Hn.box,ct,_.get("icon-ignore-placement"),f.bucketInstanceId,Rs,q.ID),bn&&Li&&this.collisionIndex.insertCollisionCircles(bn.circles,et,_.get("text-ignore-placement"),f.bucketInstanceId,Pa,q.ID),u&&this.storeCollisionData(f.bucketInstanceId,me,ce,on,Hn,bn),Gt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Gt.crossTileID]=new Pl((Li||Dt)&&!on?.occluded,(ji||Mt)&&!Hn?.occluded,Si||f.justReloaded),a[Gt.crossTileID]=!0};if(xt){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Gt=f.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let ce=Gt.length-1;ce>=0;--ce){const me=Gt[ce];Jt(f.symbolInstances.get(me),f.collisionArrays[me],me)}}else for(let Gt=e.symbolInstanceStart;Gt<e.symbolInstanceEnd;Gt++)Jt(f.symbolInstances.get(Gt),f.collisionArrays[Gt],Gt);f.justReloaded=!1}storeCollisionData(e,a,u,f,_,v){if(u.textBox||u.iconBox){let T,S;this.collisionBoxArrays.has(e)?T=this.collisionBoxArrays.get(e):(T=new Map,this.collisionBoxArrays.set(e,T)),T.has(a)?S=T.get(a):(S={text:null,icon:null},T.set(a,S)),u.textBox&&(S.text=f.box),u.iconBox&&(S.icon=_.box)}if(v){let T=this.collisionCircleArrays[e];T===void 0&&(T=this.collisionCircleArrays[e]=[]);for(let S=0;S<v.circles.length;S+=4)T.push(v.circles[S+0]-qi),T.push(v.circles[S+1]-qi),T.push(v.circles[S+2]),T.push(v.collisionDetected?1:0)}}markUsedJustification(e,a,u,f){let _;_=f===d.at.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[d.aL(a)];const v=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const T of v)T>=0&&(e.text.placedSymbolArray.get(T).crossTileID=_>=0&&T!==_?0:u.crossTileID)}markUsedOrientation(e,a,u){const f=a===d.at.horizontal||a===d.at.horizontalOnly?a:0,_=a===d.at.vertical?a:0,v=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const T of v)e.text.placedSymbolArray.get(T).placedOrientation=f;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let u=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const f=a?a.symbolFadeChange(e):1,_=a?a.opacities:{},v=a?a.variableOffsets:{},T=a?a.placedOrientations:{};for(const S in this.placements){const C=this.placements[S],z=_[S];z?(this.opacities[S]=new _s(z,f,C.text,C.icon),u=u||C.text!==z.text.placed||C.icon!==z.icon.placed):(this.opacities[S]=new _s(null,f,C.text,C.icon,C.skipFade),u=u||C.text||C.icon)}for(const S in _){const C=_[S];if(!this.opacities[S]){const z=new _s(C,f,!1,!1);z.isHidden()||(this.opacities[S]=z,u=u||C.text.placed||C.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in T)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=T[S]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){const u={};for(const f of a){const _=f.getBucket(e);_&&f.latestFeatureIndex&&e.id===_.layerIds[0]&&this.updateBucketOpacities(_,f.tileID,u,f.collisionBoxArray)}}updateBucketOpacities(e,a,u,f){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const _=e.layers[0],v=_.layout,T=new _s(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),C=v.get("icon-allow-overlap"),z=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),B=v.get("text-rotation-alignment")==="map",R=v.get("text-pitch-alignment")==="map",N=v.get("icon-text-fit")!=="none",q=new _s(null,0,S&&(C||!e.hasIconData()||v.get("icon-optional")),C&&(S||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&f&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(f);const K=(et,at,ct)=>{for(let rt=0;rt<at/4;rt++)et.opacityVertexArray.emplaceBack(ct);et.hasVisibleVertices=et.hasVisibleVertices||ct!==Ga},J=this.collisionBoxArrays.get(e.bucketInstanceId);for(let et=0;et<e.symbolInstances.length;et++){const at=e.symbolInstances.get(et),{numHorizontalGlyphVertices:ct,numVerticalGlyphVertices:rt,crossTileID:ht}=at;let pt=this.opacities[ht];u[ht]?pt=T:pt||(pt=q,this.opacities[ht]=pt),u[ht]=!0;const lt=at.numIconVertices>0,xt=this.placedOrientations[at.crossTileID],Dt=xt===d.at.vertical,Mt=xt===d.at.horizontal||xt===d.at.horizontalOnly;if(ct>0||rt>0){const Pt=Fo(pt.text);K(e.text,ct,Dt?Ga:Pt),K(e.text,rt,Mt?Ga:Pt);const Kt=pt.text.isHidden();[at.rightJustifiedTextSymbolIndex,at.centerJustifiedTextSymbolIndex,at.leftJustifiedTextSymbolIndex].forEach(ce=>{ce>=0&&(e.text.placedSymbolArray.get(ce).hidden=Kt||Dt?1:0)}),at.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(at.verticalPlacedTextSymbolIndex).hidden=Kt||Mt?1:0);const Jt=this.variableOffsets[at.crossTileID];Jt&&this.markUsedJustification(e,Jt.anchor,at,xt);const Gt=this.placedOrientations[at.crossTileID];Gt&&(this.markUsedJustification(e,"left",at,Gt),this.markUsedOrientation(e,Gt,at))}if(lt){const Pt=Fo(pt.icon),Kt=!(N&&at.verticalPlacedIconSymbolIndex&&Dt);at.placedIconSymbolIndex>=0&&(K(e.icon,at.numIconVertices,Kt?Pt:Ga),e.icon.placedSymbolArray.get(at.placedIconSymbolIndex).hidden=pt.icon.isHidden()),at.verticalPlacedIconSymbolIndex>=0&&(K(e.icon,at.numVerticalIconVertices,Kt?Ga:Pt),e.icon.placedSymbolArray.get(at.verticalPlacedIconSymbolIndex).hidden=pt.icon.isHidden())}const Et=J&&J.has(et)?J.get(et):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Pt=e.collisionArrays[et];if(Pt){let Kt=new d.P(0,0);if(Pt.textBox||Pt.verticalTextBox){let Jt=!0;if(z){const Gt=this.variableOffsets[ht];Gt?(Kt=gh(Gt.anchor,Gt.width,Gt.height,Gt.textOffset,Gt.textBoxScale),B&&Kt._rotate(R?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Jt=!1}if(Pt.textBox||Pt.verticalTextBox){let Gt;Pt.textBox&&(Gt=Dt),Pt.verticalTextBox&&(Gt=Mt),gc(e.textCollisionBox.collisionVertexArray,pt.text.placed,!Jt||Gt,Et.text,Kt.x,Kt.y)}}if(Pt.iconBox||Pt.verticalIconBox){const Jt=!!(!Mt&&Pt.verticalIconBox);let Gt;Pt.iconBox&&(Gt=Jt),Pt.verticalIconBox&&(Gt=!Jt),gc(e.iconCollisionBox.collisionVertexArray,pt.icon.placed,Gt,Et.icon,N?Kt.x:0,N?Kt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){const u=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function gc(m,e,a,u,f,_){u&&u.length!==0||(u=[0,0,0,0]);const v=u[0]-qi,T=u[1]-qi,S=u[2]-qi,C=u[3]-qi;m.emplaceBack(e?1:0,a?1:0,f||0,_||0,v,T),m.emplaceBack(e?1:0,a?1:0,f||0,_||0,S,T),m.emplaceBack(e?1:0,a?1:0,f||0,_||0,S,C),m.emplaceBack(e?1:0,a?1:0,f||0,_||0,v,C)}const _h=Math.pow(2,25),du=Math.pow(2,24),yh=Math.pow(2,17),Fr=Math.pow(2,16),_c=Math.pow(2,9),yc=Math.pow(2,8),pu=Math.pow(2,1);function Fo(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const e=m.placed?1:0,a=Math.floor(127*m.opacity);return a*_h+e*du+a*yh+e*Fr+a*_c+e*yc+a*pu+e}const Ga=0;class mu{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,u,f,_){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(v,f,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((T,S)=>T.sortKey-S.sortKey));this._currentPartIndex<v.length;)if(a.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,_())return!0;return!1}}class No{constructor(e,a,u,f,_,v,T,S){this.placement=new ip(e,a,v,T,S),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(e,a,u){const f=he(),_=()=>!this._forceFullPlacement&&he()-f>2;for(;this._currentPlacementIndex>=0;){const v=a[e[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=T)&&(!v.maxzoom||v.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new mu(v)),this._inProgressLayer.continuePlacement(u[v.source],this.placement,this._showCollisionBoxes,v,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Za=512/d.a3/2;class vh{constructor(e,a,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const f=new Map;for(let _=0;_<a.length;_++){const v=a.get(_),T=v.key,S=f.get(T);S?S.push(v):f.set(T,[v])}for(const[_,v]of f){const T={positions:v.map(S=>({x:Math.floor(S.anchorX*Za),y:Math.floor(S.anchorY*Za)})),crossTileIDs:v.map(S=>S.crossTileID)};if(T.positions.length>128){const S=new d.aN(T.positions.length,16,Uint16Array);for(const{x:C,y:z}of T.positions)S.add(C,z);S.finish(),delete T.positions,T.index=S}this._symbolsByKey[_]=T}}getScaledCoordinates(e,a){const{x:u,y:f,z:_}=this.tileID.canonical,{x:v,y:T,z:S}=a.canonical,C=Za/Math.pow(2,S-_),z=(T*d.a3+e.anchorY)*C,B=f*d.a3*Za;return{x:Math.floor((v*d.a3+e.anchorX)*C-u*d.a3*Za),y:Math.floor(z-B)}}findMatches(e,a,u){const f=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let _=0;_<e.length;_++){const v=e.get(_);if(v.crossTileID)continue;const T=this._symbolsByKey[v.key];if(!T)continue;const S=this.getScaledCoordinates(v,a);if(T.index){const C=T.index.range(S.x-f,S.y-f,S.x+f,S.y+f).sort();for(const z of C){const B=T.crossTileIDs[z];if(!u[B]){u[B]=!0,v.crossTileID=B;break}}}else if(T.positions)for(let C=0;C<T.positions.length;C++){const z=T.positions[C],B=T.crossTileIDs[C];if(Math.abs(z.x-S.x)<=f&&Math.abs(z.y-S.y)<=f&&!u[B]){u[B]=!0,v.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class If{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const a=Math.round((e-this.lng)/360);if(a!==0)for(const u in this.indexes){const f=this.indexes[u],_={};for(const v in f){const T=f[v];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+a),_[T.tileID.key]=T}this.indexes[u]=_}this.lng=e}addBucket(e,a,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let _=0;_<a.symbolInstances.length;_++)a.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const f=this.usedCrossTileIDs[e.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>e.overscaledZ)for(const T in v){const S=v[T];S.tileID.isChildOf(e)&&S.findMatches(a.symbolInstances,e,f)}else{const T=v[e.scaledTo(Number(_)).key];T&&T.findMatches(a.symbolInstances,e,f)}}for(let _=0;_<a.symbolInstances.length;_++){const v=a.symbolInstances.get(_);v.crossTileID||(v.crossTileID=u.generate(),f[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new vh(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(const u of a.getCrossTileIDsLists())for(const f of u)delete this.usedCrossTileIDs[e][f]}removeStaleBuckets(e){let a=!1;for(const u in this.indexes){const f=this.indexes[u];for(const _ in f)e[f[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,f[_]),delete f[_],a=!0)}return a}}class Uo{constructor(){this.layerIndexes={},this.crossTileIDs=new If,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,u){let f=this.layerIndexes[e.id];f===void 0&&(f=this.layerIndexes[e.id]=new qa);let _=!1;const v={};f.handleWrapJump(u);for(const T of a){const S=T.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(T.tileID,S,this.crossTileIDs)&&(_=!0),v[S.bucketInstanceId]=!0)}return f.removeStaleBuckets(v)&&(_=!0),_}pruneUnusedLayers(e){const a={};e.forEach(u=>{a[u]=!0});for(const u in this.layerIndexes)a[u]||delete this.layerIndexes[u]}}var Xe="void main() {fragColor=vec4(1.0);}";const Sr={prelude:Ne(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Ne("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Ne("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Ne(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Ne(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ne(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ne(Xe,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Ne(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Ne(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ne("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ne("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Ne(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Ne("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Ne(Xe,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Ne(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Ne(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Ne(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Ne(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ne(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ne(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ne(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ne(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Ne(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ne(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ne(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ne(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Ne(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Ne(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Ne(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ne(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ne(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ne("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ne("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ne("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Ne("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Ne(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Ne("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ne(m,e){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/in ([\w]+) ([\w]+)/g),f=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=_?_.concat(f):f,T={};return{fragmentSource:m=m.replace(a,(S,C,z,B,R)=>(T[R]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
in ${z} ${B} ${R};
#else
uniform ${z} ${B} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${z} ${B} ${R} = u_${R};
#endif
`)),vertexSource:e=e.replace(a,(S,C,z,B,R)=>{const N=B==="float"?"vec2":"vec4",q=R.match(/color/)?"color":N;return T[R]?C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${z} ${N} a_${R};
out ${z} ${B} ${R};
#else
uniform ${z} ${B} u_${R};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${z} ${B} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${q}(a_${R}, u_${R}_t);
#else
    ${z} ${B} ${R} = u_${R};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${z} ${N} a_${R};
#else
uniform ${z} ${B} u_${R};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${z} ${B} ${R} = a_${R};
#else
    ${z} ${B} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${z} ${B} ${R} = unpack_mix_${q}(a_${R}, u_${R}_t);
#else
    ${z} ${B} ${R} = u_${R};
#endif
`}),staticAttributes:u,staticUniforms:v}}class Ha{constructor(e,a,u){this.vertexBuffer=e,this.indexBuffer=a,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var cn=d.aO([{name:"a_pos",type:"Int16",components:2}]);const gn="#define PROJECTION_MERCATOR",_n="mercator";class An{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return _n}get shaderDefine(){return gn}get shaderPreludeCode(){return Sr.projectionMercator}get vertexShaderPreludeCode(){return Sr.projectionMercator.vertexSource}get subdivisionGranularity(){return d.aP.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,a,u,f,_){if(this._cachedMesh)return this._cachedMesh;const v=new d.aQ;v.emplaceBack(0,0),v.emplaceBack(d.a3,0),v.emplaceBack(0,d.a3),v.emplaceBack(d.a3,d.a3);const T=e.createVertexBuffer(v,cn.members),S=d.aR.simpleSegment(0,0,4,2),C=new d.aS;C.emplaceBack(1,0,2),C.emplaceBack(1,2,3);const z=e.createIndexBuffer(C);return this._cachedMesh=new Ha(T,z,S),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Ti{constructor(e=0,a=0,u=0,f=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(u)||u<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=u,this.right=f}interpolate(e,a,u){return a.top!=null&&e.top!=null&&(this.top=d.F.number(e.top,a.top,u)),a.bottom!=null&&e.bottom!=null&&(this.bottom=d.F.number(e.bottom,a.bottom,u)),a.left!=null&&e.left!=null&&(this.left=d.F.number(e.left,a.left,u)),a.right!=null&&e.right!=null&&(this.right=d.F.number(e.right,a.right,u)),this}getCenter(e,a){const u=d.ai((this.left+e-this.right)/2,0,e),f=d.ai((this.top+a-this.bottom)/2,0,a);return new d.P(u,f)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ti(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function gu(m,e){if(!m.renderWorldCopies||m.lngRange)return;const a=e.lng-m.center.lng;e.lng+=a>180?-360:a<-180?360:0}function kn(m){return Math.max(0,Math.floor(m))}class hn{constructor(e,a){var u;this.applyConstrain=(f,_)=>this._constrainOverride!==null?this._constrainOverride(f,_):this._callbacks.defaultConstrain(f,_),this._callbacks=e,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(u=a?.constrainOverride)!==null&&u!==void 0?u:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new d.U(0,0),this._elevation=0,this._zoom=0,this._tileZoom=kn(this._zoom),this._scale=d.al(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ti,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,a,u){this._constrainOverride=e.constrainOverride,this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=kn(this._zoom),this._scale=d.al(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Ti(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!u&&e.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get constrainOverride(){return this._constrainOverride}setConstrainOverride(e){e===void 0&&(e=null),this._constrainOverride!==e&&(this._constrainOverride=e,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const a=d.V(e,-180,180)*Math.PI/180;var u,f,_,v,T,S,C,z,B;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=At(),u=this._rotationMatrix,_=-this._bearingInRadians,v=(f=this._rotationMatrix)[0],T=f[1],S=f[2],C=f[3],z=Math.sin(_),B=Math.cos(_),u[0]=v*B+S*z,u[1]=T*B+C*z,u[2]=v*-z+S*B,u[3]=T*-z+C*B)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const a=d.ai(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const a=e/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return d.aT(this._fovInRadians)}setFov(e){e=d.ai(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=d.ak(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const a=this.applyConstrain(this._center,e).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=d.al(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,a){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,u){this._unmodified=!1,this._edgeInsets.interpolate(e,a,u),this.constrainInternal(),this._calcMatrices()}resize(e,a,u=!0){this._width=e,this._height=a,u&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Wi([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-d.aj,d.aj])}getCameraQueryGeometry(e,a){if(a.length===1)return[a[0],e];{const{minX:u,minY:f,maxX:_,maxY:v}=d.a6.fromPoints(a).extend(e);return[new d.P(u,f),new d.P(_,f),new d.P(_,v),new d.P(u,v),new d.P(u,f)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:a,zoom:u}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(u),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=d.am(new Float64Array(16));d.O(e,e,[this._width/2,-this._height/2,1]),d.N(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=d.am(new Float64Array(16)),d.O(e,e,[1,-1,1]),d.N(e,e,[-1,-1,0]),d.O(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,a,u,f){const _=u!==void 0?u:this.bearing,v=f=f!==void 0?f:this.pitch,T=d.a5.fromLngLat(e,a),S=-Math.cos(d.ak(v)),C=Math.sin(d.ak(v)),z=C*Math.sin(d.ak(_)),B=-C*Math.cos(d.ak(_));let R=this.elevation;const N=a-R;let q;S*N>=0||Math.abs(S)<.1?(q=1e4,R=a+q*S):q=-N/S;let K,J,et=d.aU(1,T.y),at=0;do{if(at+=1,at>10)break;J=q/et,K=new d.a5(T.x+z*J,T.y+B*J),et=1/K.meterInMercatorCoordinateUnits()}while(Math.abs(q-J*et)>1e-12);return{center:K.toLngLat(),elevation:R,zoom:d.ao(this.height/2/Math.tan(this.fovInRadians/2)/J/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const a=d.an(1,this.center.lat)*this.worldSize,u=this.cameraToCenterDistance/a,f=d.a5.fromLngLat(this.center,this.elevation),_=yt(this.center,this.elevation,this.pitch,this.bearing,u);this._elevation=e;const v=this.calculateCenterFromCameraLngLatAlt(_.toLngLat(),d.aU(_.z,f.y),this.bearing,this.pitch);this._elevation=v.elevation,this._center=v.center,this.setZoom(v.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=d.an(1,this.center.lat)*this.worldSize;return yt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const a=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/a,e.canonical.y/a,1/a/d.a3,1/a/d.a3]}}class Zn{constructor(e,a){this.min=e,this.max=a,this.center=d.aV([],d.aW([],this.min,this.max),.5)}quadrant(e){const a=[e%2==0,e<2],u=d.aX(this.min),f=d.aX(this.max);for(let _=0;_<a.length;_++)u[_]=a[_]?this.min[_]:this.center[_],f[_]=a[_]?this.center[_]:this.max[_];return f[2]=this.max[2],new Zn(u,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let a=!0;for(let u=0;u<e.planes.length;u++){const f=this.intersectsPlane(e.planes[u]);if(f===0)return 0;f===1&&(a=!1)}return a?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let a=e[3],u=e[3];for(let f=0;f<3;f++)e[f]>0?(a+=e[f]*this.min[f],u+=e[f]*this.max[f]):(u+=e[f]*this.min[f],a+=e[f]*this.max[f]);return a>=0?2:u<0?0:1}}class Il{distanceToTile2d(e,a,u,f){const _=f.distanceX([e,a]),v=f.distanceY([e,a]);return Math.hypot(_,v)}getWrap(e,a,u){return u}getTileBoundingVolume(e,a,u,f){var _,v;let T=0,S=0;if(f?.terrain){const z=new d.a0(e.z,a,e.z,e.x,e.y),B=f.terrain.getMinMaxElevation(z);T=(_=B.minElevation)!==null&&_!==void 0?_:Math.min(0,u),S=(v=B.maxElevation)!==null&&v!==void 0?v:Math.max(0,u)}const C=1<<e.z;return new Zn([a+e.x/C,e.y/C,T],[a+(e.x+1)/C,(e.y+1)/C,S])}allowVariableZoom(e,a){const u=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,f=d.ai(78.5-u/2,0,60);return!!a.terrain||e.pitch>f}allowWorldCopies(){return!0}prepareNextFrame(){}}class Mr{constructor(e,a,u){this.points=e,this.planes=a,this.aabb=u}static fromInvProjectionMatrix(e,a=1,u=0,f,_){const v=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],T=Math.pow(2,u),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>function(N,q,K,J){const et=d.aB([],N,q),at=1/et[3]/K*J;return d.b0(et,et,[at,at,1/et[3],at])}(R,e,a,T));f&&function(R,N,q,K){const J=K?4:0,et=K?0:4;let at=0;const ct=[],rt=[];for(let lt=0;lt<4;lt++){const xt=d.aY([],R[lt+et],R[lt+J]),Dt=d.b1(xt);d.aV(xt,xt,1/Dt),ct.push(Dt),rt.push(xt)}for(let lt=0;lt<4;lt++){const xt=d.b2(R[lt+J],rt[lt],q);at=xt!==null&&xt>=0?Math.max(at,xt):Math.max(at,ct[lt])}const ht=function(lt,xt){const Dt=d.aY([],lt[xt[0]],lt[xt[1]]),Mt=d.aY([],lt[xt[2]],lt[xt[1]]),Et=[0,0,0,0];return d.aZ(Et,d.a_([],Dt,Mt)),Et[3]=-d.a$(Et,lt[xt[0]]),Et}(R,N),pt=function(lt,xt){const Dt=d.b3(lt),Mt=d.b4([],lt,1/Dt),Et=d.aY([],xt,d.aV([],Mt,d.a$(xt,Mt))),Pt=d.b3(Et);if(Pt>0){const Kt=Math.sqrt(1-Mt[3]*Mt[3]),Jt=d.aV([],Mt,-Mt[3]),Gt=d.aW([],Jt,d.aV([],Et,Kt/Pt));return d.b5(xt,Gt)}return null}(q,ht);if(pt!==null){const lt=pt/d.a$(rt[0],ht);at=Math.min(at,lt)}for(let lt=0;lt<4;lt++){const xt=Math.min(at,ct[lt]);R[lt+et]=[R[lt+J][0]+rt[lt][0]*xt,R[lt+J][1]+rt[lt][1]*xt,R[lt+J][2]+rt[lt][2]*xt,1]}}(S,v[0],f,_);const C=v.map(R=>{const N=d.aY([],S[R[0]],S[R[1]]),q=d.aY([],S[R[2]],S[R[1]]),K=d.aZ([],d.a_([],N,q)),J=-d.a$(K,S[R[1]]);return K.concat(J)}),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],B=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const R of S)for(let N=0;N<3;N++)z[N]=Math.min(z[N],R[N]),B[N]=Math.max(B[N],R[N]);return new Mr(S,C,new Zn(z,B))}}class Ri{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,u){return this._helper.interpolatePadding(e,a,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,u=!0){this._helper.resize(e,a,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,a){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,u)=>{u=d.ai(+u,this.minZoom,this.maxZoom);const f={center:new d.U(a.lng,a.lat),zoom:u};let _=this._helper._lngRange;if(!this._helper._renderWorldCopies&&_===null){const rt=179.9999999999;_=[-rt,rt]}const v=this.tileSize*d.al(f.zoom);let T=0,S=v,C=0,z=v,B=0,R=0;const{x:N,y:q}=this.size;if(this._helper._latRange){const rt=this._helper._latRange;T=d.W(rt[1])*v,S=d.W(rt[0])*v,S-T<q&&(B=q/(S-T))}_&&(C=d.V(d.X(_[0])*v,0,v),z=d.V(d.X(_[1])*v,0,v),z<C&&(z+=v),z-C<N&&(R=N/(z-C)));const{x:K,y:J}=ot(v,a);let et,at;const ct=Math.max(R||0,B||0);if(ct){const rt=new d.P(R?(z+C)/2:K,B?(S+T)/2:J);return f.center=ut(v,rt).wrap(),f.zoom+=d.ao(ct),f}if(this._helper._latRange){const rt=q/2;J-rt<T&&(at=T+rt),J+rt>S&&(at=S-rt)}if(_){const rt=(C+z)/2;let ht=K;this._helper._renderWorldCopies&&(ht=d.V(K,rt-v/2,rt+v/2));const pt=N/2;ht-pt<C&&(et=C+pt),ht+pt>z&&(et=z-pt)}if(et!==void 0||at!==void 0){const rt=new d.P(et??K,at??J);f.center=ut(v,rt).wrap()}return f},this.applyConstrain=(a,u)=>this._helper.applyConstrain(a,u),this._helper=new hn({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,u)=>this.defaultConstrain(a,u)},e),this._coveringTilesDetailsProvider=new Il}clone(){const e=new Ri;return e.apply(this),e}apply(e,a,u){this._helper.apply(e,a,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const a=[new d.b6(0,e)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new d.P(0,0)),f=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new d.P(0,this._helper._height)),T=Math.floor(Math.min(u.x,f.x,_.x,v.x)),S=Math.floor(Math.max(u.x,f.x,_.x,v.x)),C=1;for(let z=T-C;z<=S+C;z++)z!==0&&a.push(new d.b6(z,e))}return a}getCameraFrustum(){return Mr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const a=this.screenPointToLocation(this.centerPoint,e),u=e?e.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(e,a){const u=d.an(this.elevation,this.center.lat),f=this.screenPointToMercatorCoordinateAtZ(a,u),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),v=d.a5.fromLngLat(e),T=new d.a5(v.x-(f.x-_.x),v.y-(f.y-_.y));this.setCenter(T?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,a){return a?this.coordinatePoint(d.a5.fromLngLat(e),a.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(d.a5.fromLngLat(e))}screenPointToLocation(e,a){var u;return(u=this.screenPointToMercatorCoordinate(e,a))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(e,a){if(a){const u=a.pointCoordinate(e);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,a){const u=a||0,f=[e.x,e.y,0,1],_=[e.x,e.y,1,1];d.aB(f,f,this._pixelMatrixInverse),d.aB(_,_,this._pixelMatrixInverse);const v=f[3],T=_[3],S=f[1]/v,C=_[1]/T,z=f[2]/v,B=_[2]/T,R=z===B?0:(u-z)/(B-z);return new d.a5(d.F.number(f[0]/v,_[0]/T,R)/this.worldSize,d.F.number(S,C,R)/this.worldSize,u)}coordinatePoint(e,a=0,u=this._pixelMatrix){const f=[e.x*this.worldSize,e.y*this.worldSize,a,1];return d.aB(f,f,u),new d.P(f[0]/f[3],f[1]/f[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Tt(this));return new Wi().extend(this.screenPointToLocation(new d.P(0,e))).extend(this.screenPointToLocation(new d.P(this._helper._width,e))).extend(this.screenPointToLocation(new d.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new d.P(0,this._helper._height)))}isPointOnMapSurface(e,a){return a?a.pointCoordinate(e)!=null:e.y>this.height/2-Tt(this)}calculatePosMatrix(e,a=!1,u){var f;const _=(f=e.key)!==null&&f!==void 0?f:d.b7(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),v=a?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(_)){const C=v.get(_);return u?C.f32:C.f64}const T=tt(e,this.worldSize);d.Q(T,a?this._alignedProjMatrix:this._viewProjMatrix,T);const S={f64:T,f32:new Float32Array(T)};return v.set(_,S),u?S.f32:S.f64}calculateFogMatrix(e){const a=e.key,u=this._fogMatrixCacheF32;if(u.has(a))return u.get(a);const f=tt(e,this.worldSize);return d.Q(f,this._fogMatrix,f),u.set(a,new Float32Array(f)),u.get(a)}calculateCenterFromCameraLngLatAlt(e,a,u,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,u,f)}_calculateNearFarZIfNeeded(e,a,u){if(!this._helper.autoCalculateNearFarZ)return;const f=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=e-f*this._helper._pixelPerMeter/Math.cos(a),v=f<0?_:e,T=Math.PI/2+this.pitchInRadians,S=d.ak(this.fov)*(Math.abs(Math.cos(d.ak(this.roll)))*this.height+Math.abs(Math.sin(d.ak(this.roll)))*this.width)/this.height*(.5+u.y/this.height),C=Math.sin(S)*v/Math.sin(d.ai(Math.PI-T-S,.01,Math.PI-.01)),z=Tt(this),B=Math.atan(z/this._helper.cameraToCenterDistance),R=d.ak(.75),N=B>R?2*B*(.5+u.y/(2*z)):R,q=Math.sin(N)*v/Math.sin(d.ai(Math.PI-T-N,.01,Math.PI-.01)),K=Math.min(C,q);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*K+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,a=ot(this.worldSize,this.center),u=a.x,f=a.y;this._helper._pixelPerMeter=d.an(1,this.center.lat)*this.worldSize;const _=d.ak(Math.min(this.pitch,Y)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let T;this._calculateNearFarZIfNeeded(v,_,e),T=new Float64Array(16),d.b8(T,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),d.av(this._invProjMatrix,T),T[8]=2*-e.x/this._helper._width,T[9]=2*e.y/this._helper._height,this._projectionMatrix=d.b9(T),d.O(T,T,[1,-1,1]),d.N(T,T,[0,0,-this._helper.cameraToCenterDistance]),d.ba(T,T,-this.rollInRadians),d.bb(T,T,this.pitchInRadians),d.ba(T,T,-this.bearingInRadians),d.N(T,T,[-u,-f,0]),this._mercatorMatrix=d.O([],T,[this.worldSize,this.worldSize,this.worldSize]),d.O(T,T,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=d.Q(new Float64Array(16),this.clipSpaceToPixelsMatrix,T),d.N(T,T,[0,0,-this.elevation]),this._viewProjMatrix=T,this._invViewProjMatrix=d.av([],T);const S=[0,0,-1,1];d.aB(S,S,this._invViewProjMatrix),this._cameraPosition=[S[0]/S[3],S[1]/S[3],S[2]/S[3]],this._fogMatrix=new Float64Array(16),d.b8(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,d.O(this._fogMatrix,this._fogMatrix,[1,-1,1]),d.N(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),d.ba(this._fogMatrix,this._fogMatrix,-this.rollInRadians),d.bb(this._fogMatrix,this._fogMatrix,this.pitchInRadians),d.ba(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),d.N(this._fogMatrix,this._fogMatrix,[-u,-f,0]),d.O(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),d.N(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=d.Q(new Float64Array(16),this.clipSpaceToPixelsMatrix,T);const C=this._helper._width%2/2,z=this._helper._height%2/2,B=Math.cos(this.bearingInRadians),R=Math.sin(-this.bearingInRadians),N=u-Math.round(u)+B*C+R*z,q=f-Math.round(f)+B*z+R*C,K=new Float64Array(T);if(d.N(K,K,[N>.5?N-1:N,q>.5?q-1:q,0]),this._alignedProjMatrix=K,T=d.av(new Float64Array(16),this._pixelMatrix),!T)throw new Error("failed to invert matrix");this._pixelMatrixInverse=T,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new d.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.aB(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=d.an(1,this.center.lat)*this.worldSize;return yt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,a){const u=d.a5.fromLngLat(e),f=[u.x*this.worldSize,u.y*this.worldSize,a,1];return d.aB(f,f,this._viewProjMatrix),f[2]/f[3]}getProjectionData(e){const{overscaledTileID:a,aligned:u,applyTerrainMatrix:f}=e,_=this._helper.getMercatorTileCoordinates(a),v=a?this.calculatePosMatrix(a,u,!0):null;let T;return T=a&&a.terrainRttPosMatrix32f&&f?a.terrainRttPosMatrix32f:v||d.bc(),{mainMatrix:T,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:T}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,a,u){return 1}transformLightDirection(e){return d.aX(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,a,u,f){const _=this.calculatePosMatrix(u);let v;f?(v=[e,a,f(e,a),1],d.aB(v,v,_)):(v=[e,a,0,1],fu(v,v,_));const T=v[3];return{point:new d.P(v[0]/T,v[1]/T),signedDistanceFromCamera:T,isOccluded:!1}}populateCache(e){for(const a of e)this.calculatePosMatrix(a)}getMatrixForModel(e,a){const u=d.a5.fromLngLat(e,a),f=u.meterInMercatorCoordinateUnits(),_=d.bd();return d.N(_,_,[u.x,u.y,u.z]),d.ba(_,_,Math.PI),d.bb(_,_,Math.PI/2),d.O(_,_,[-f,f,f]),_}getProjectionDataForCustomLayer(e=!0){const a=new d.a0(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:e}),f=tt(a,this.worldSize);d.Q(f,this._viewProjMatrix,f),u.tileMercatorCoords=[0,0,1,1];const _=[d.a3,d.a3,this.worldSize/this._helper.pixelsPerMeter],v=d.be();return d.O(v,f,_),u.fallbackMatrix=v,u.mainMatrix=v,u}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function ys(){d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function vs(m){if(m.useSlerp)if(m.k<1){const e=d.bf(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),a=d.bf(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),u=new Float64Array(4);d.bg(u,e,a,m.k);const f=d.bh(u);m.tr.setRoll(f.roll),m.tr.setPitch(f.pitch),m.tr.setBearing(f.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(d.F.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(d.F.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(d.F.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function io(m,e,a,u,f){const _=f.padding,v=ot(f.worldSize,a.getNorthWest()),T=ot(f.worldSize,a.getNorthEast()),S=ot(f.worldSize,a.getSouthEast()),C=ot(f.worldSize,a.getSouthWest()),z=d.ak(-u),B=v.rotate(z),R=T.rotate(z),N=S.rotate(z),q=C.rotate(z),K=new d.P(Math.max(B.x,R.x,q.x,N.x),Math.max(B.y,R.y,q.y,N.y)),J=new d.P(Math.min(B.x,R.x,q.x,N.x),Math.min(B.y,R.y,q.y,N.y)),et=K.sub(J),at=(f.width-(_.left+_.right+e.left+e.right))/et.x,ct=(f.height-(_.top+_.bottom+e.top+e.bottom))/et.y;if(ct<0||at<0)return void ys();const rt=Math.min(d.ao(f.scale*Math.min(at,ct)),m.maxZoom),ht=d.P.convert(m.offset),pt=new d.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(d.ak(u)),lt=ht.add(pt).mult(f.scale/d.al(rt));return{center:ut(f.worldSize,v.add(S).div(2).sub(lt)),zoom:rt,bearing:u}}class Kn{get useGlobeControls(){return!1}handlePanInertia(e,a){const u=e.mag(),f=Math.abs(Tt(a));return{easingOffset:e.mult(Math.min(.75*f/u,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(e,a){e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta),e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta)}handleMapControlsPan(e,a,u){e.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(u,e.around)}cameraForBoxAndBearing(e,a,u,f,_){return io(e,a,u,f,_)}handleJumpToCenterZoom(e,a){e.zoom!==(a.zoom!==void 0?+a.zoom:e.zoom)&&e.setZoom(+a.zoom),a.center!==void 0&&e.setCenter(d.U.convert(a.center))}handleEaseTo(e,a){const u=e.zoom,f=e.padding,_={roll:e.roll,pitch:e.pitch,bearing:e.bearing},v={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},T=a.zoom!==void 0,S=!e.isPaddingEqual(a.padding);let C=!1;const z=T?+a.zoom:e.zoom;let B=e.centerPoint.add(a.offsetAsPoint);const R=e.screenPointToLocation(B),{center:N,zoom:q}=e.applyConstrain(d.U.convert(a.center||R),z??u);gu(e,N);const K=ot(e.worldSize,R),J=ot(e.worldSize,N).sub(K),et=d.al(q-u);return C=q!==u,{easeFunc:at=>{if(C&&e.setZoom(d.F.number(u,q,at)),d.bi(_,v)||vs({startEulerAngles:_,endEulerAngles:v,tr:e,k:at,useSlerp:_.roll!=v.roll}),S&&(e.interpolatePadding(f,a.padding,at),B=e.centerPoint.add(a.offsetAsPoint)),a.around)e.setLocationAtPoint(a.around,a.aroundPoint);else{const ct=d.al(e.zoom-u),rt=q>u?Math.min(2,et):Math.max(.5,et),ht=Math.pow(rt,1-at),pt=ut(e.worldSize,K.add(J.mult(at*ht)).mult(ct));e.setLocationAtPoint(e.renderWorldCopies?pt.wrap():pt,B)}},isZooming:C,elevationCenter:N}}handleFlyTo(e,a){const u=a.zoom!==void 0,f=e.zoom,_=e.applyConstrain(d.U.convert(a.center||a.locationAtOffset),u?+a.zoom:f),v=_.center,T=_.zoom;gu(e,v);const S=ot(e.worldSize,a.locationAtOffset),C=ot(e.worldSize,v).sub(S),z=C.mag(),B=d.al(T-f);let R;if(a.minZoom!==void 0){const N=Math.min(+a.minZoom,f,T),q=e.applyConstrain(v,N).zoom;R=d.al(q-f)}return{easeFunc:(N,q,K,J)=>{e.setZoom(N===1?T:f+d.ao(q));const et=N===1?v:ut(e.worldSize,S.add(C.mult(K)).mult(q));e.setLocationAtPoint(e.renderWorldCopies?et.wrap():et,J)},scaleOfZoom:B,targetCenter:v,scaleOfMinZoom:R,pixelPathLength:z}}}class Oi{constructor(e,a,u){this.blendFunction=e,this.blendColor=a,this.mask=u}}Oi.Replace=[1,0],Oi.disabled=new Oi(Oi.Replace,d.bj.transparent,[!1,!1,!1,!1]),Oi.unblended=new Oi(Oi.Replace,d.bj.transparent,[!0,!0,!0,!0]),Oi.alphaBlended=new Oi([1,771],d.bj.transparent,[!0,!0,!0,!0]);const rn=2305;class Ze{constructor(e,a,u){this.enable=e,this.mode=a,this.frontFace=u}}Ze.disabled=new Ze(!1,1029,rn),Ze.backCCW=new Ze(!0,1029,rn),Ze.frontCCW=new Ze(!0,1028,rn);class Be{constructor(e,a,u){this.func=e,this.mask=a,this.range=u}}Be.ReadOnly=!1,Be.ReadWrite=!0,Be.disabled=new Be(519,Be.ReadOnly,[0,1]);const Xa=7680;class Qe{constructor(e,a,u,f,_,v){this.test=e,this.ref=a,this.mask=u,this.fail=f,this.depthFail=_,this.pass=v}}Qe.disabled=new Qe({func:519,mask:0},0,0,Xa,Xa,Xa);const no=new WeakMap;function ta(m){var e;if(no.has(m))return no.get(m);{const a=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return no.set(m,a),a}}class xs{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const a=e.context,u=a.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const f=new d.aQ;f.emplaceBack(-1,-1),f.emplaceBack(2,-1),f.emplaceBack(-1,2);const _=new d.aS;_.emplaceBack(0,1,2),this._fullscreenTriangle=new Ha(a.createVertexBuffer(f,cn.members),a.createIndexBuffer(_),d.aR.simpleSegment(0,0,f.length,_.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(u.TEXTURE1);const v=u.createTexture();u.bindTexture(u.TEXTURE_2D,v),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),ta(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,a){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,a=e.gl;e.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,a){const u=this._cachedRenderContext.context,f=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:d.bj.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,f.TRIANGLES,Be.disabled,Qe.disabled,Oi.unblended,Ze.disabled,((_,v)=>({u_input:_,u_output_expected:v}))(e,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ta(f)){f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.readBuffer(f.COLOR_ATTACHMENT0),f.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,null);const _=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0);f.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ta(e)){const a=e.clientWaitSync(this._readbackQueue.sync,0,0);if(a===e.WAIT_FAILED)return d.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=xs._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let a=0;return a+=e[0]/256,a+=e[1]/65536,a+=e[2]/16777216,e[3]<127&&(a=-a),a/128}}const $a=d.a3/128;function _u(m,e){const a=m.granularity!==void 0?Math.max(m.granularity,1):1,u=a+(m.generateBorders?2:0),f=a+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),_=u+1,v=f+1,T=m.generateBorders?-1:0,S=m.generateBorders||m.extendToNorthPole?-1:0,C=a+(m.generateBorders?1:0),z=a+(m.generateBorders||m.extendToSouthPole?1:0),B=_*v,R=u*f*6,N=_*v>65536;if(N&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const q=N||e==="32bit",K=new Int16Array(2*B);let J=0;for(let ct=S;ct<=z;ct++)for(let rt=T;rt<=C;rt++){let ht=rt/a*d.a3;rt===-1&&(ht=-$a),rt===a+1&&(ht=d.a3+$a);let pt=ct/a*d.a3;ct===-1&&(pt=m.extendToNorthPole?d.bl:-$a),ct===a+1&&(pt=m.extendToSouthPole?d.bm:d.a3+$a),K[J++]=ht,K[J++]=pt}const et=q?new Uint32Array(R):new Uint16Array(R);let at=0;for(let ct=0;ct<f;ct++)for(let rt=0;rt<u;rt++){const ht=rt+1+ct*_,pt=rt+(ct+1)*_,lt=rt+1+(ct+1)*_;et[at++]=rt+ct*_,et[at++]=pt,et[at++]=ht,et[at++]=ht,et[at++]=pt,et[at++]=lt}return{vertices:K.buffer.slice(0),indices:et.buffer.slice(0),uses32bitIndices:q}}const yu=new d.aP({fill:new d.bn(128,2),line:new d.bn(512,0),tile:new d.bn(128,32),stencil:new d.bn(128,1),circle:3});class vu{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Sr.projectionGlobe}get vertexShaderPreludeCode(){return Sr.projectionMercator.vertexSource}get subdivisionGranularity(){return yu}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new xs(e));const a=d.W(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,f=this._errorMeasurement.updateErrorLoop(a,u),_=he();f!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=f,this._errorMeasurementLastChangeTime=_);const v=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=d.bo(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,d.bp(v))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,a,u,f,_){const v=(_==="stencil"?yu.stencil:yu.tile).getGranularityForZoomLevel(a.z);return this._getMesh(e,{granularity:v,generateBorders:u,extendToNorthPole:a.y===0&&f,extendToSouthPole:a.y===(1<<a.z)-1&&f})}_getMesh(e,a){const u=this._getMeshKey(a);if(u in this._tileMeshCache)return this._tileMeshCache[u];const f=function(_,v){const T=_u(v,"16bit"),S=d.aQ.deserialize({arrayBuffer:T.vertices,length:T.vertices.byteLength/2/2}),C=d.aS.deserialize({arrayBuffer:T.indices,length:T.indices.byteLength/2/3});return new Ha(_.createVertexBuffer(S,cn.members),_.createIndexBuffer(C),d.aR.simpleSegment(0,0,S.length,C.length))}(e,a);return this._tileMeshCache[u]=f,f}recalculate(e){}hasTransition(){const e=he();let a=!1;return a=a||(e-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const vc=new d.t({type:new d.D(d.u.projection.type)});class ro extends d.E{constructor(e){super(),this._transitionable=new d.x(vc,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.G(0)),this._mercatorProjection=new An,this._verticalPerspectiveProjection=new vu}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof d.bq){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,a,u,f,_){return this.currentProjection.getMeshFromTileID(e,a,u,f,_)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Rf(m){const e=xc(m.worldSize,m.center.lat);return 2*Math.PI*e}function Ya(m,e,a,u,f){const _=1/(1<<f),v=e/d.a3*_+u*_,T=d.bs((m/d.a3*_+a*_)*Math.PI*2+Math.PI,2*Math.PI),S=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,C=Math.cos(S),z=new Float64Array(3);return z[0]=Math.sin(T)*C,z[1]=Math.sin(S),z[2]=Math.cos(T)*C,z}function Qn(m){return function(e,a){const u=Math.cos(a),f=new Float64Array(3);return f[0]=Math.sin(e)*u,f[1]=Math.sin(a),f[2]=Math.cos(e)*u,f}(m.lng*Math.PI/180,m.lat*Math.PI/180)}function xc(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Lf(m){const e=Math.asin(m[1])/Math.PI*180,a=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(a>1e-6){const u=m[0]/a,f=Math.acos(m[2]/a),_=(u>0?f:-f)/Math.PI*180;return new d.U(d.V(_,-180,180),e)}return new d.U(0,e)}function qn(m){return Math.cos(m*Math.PI/180)}function Cn(m,e){const a=qn(m),u=qn(e);return d.ao(u/a)}function wa(m,e){const a=m.rotate(e.bearingInRadians),u=e.zoom+Cn(e.center.lat,0),f=d.bo(1/qn(e.center.lat),1/qn(Math.min(Math.abs(e.center.lat),60)),d.br(u,7,3,0,1)),_=360/Rf({worldSize:e.worldSize,center:{lat:e.center.lat}});return new d.U(e.center.lng-a.x*_*f,d.ai(e.center.lat+a.y*_,-d.aj,d.aj))}function Rl(m){const e=.5*m,a=Math.sin(e),u=Math.cos(e);return Math.log(a+u)-Math.log(u-a)}function xh(m,e,a,u){const f=m.lat+a*u;if(Math.abs(a)>1){const _=(Math.sign(m.lat+a)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,v=Math.abs(m.lat+a)*Math.PI/180,T=Rl(_+u*(v-_)),S=Rl(_),C=Rl(v);return new d.U(m.lng+e*((T-S)/(C-S)),f)}return new d.U(m.lng+e*u,f)}class bc{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,a,u,f){const _=`${e.z}_${e.x}_${e.y}_${f?.terrain?"t":""}`,v=this._cache.get(_);if(v)return v;const T=this._cachePrevious.get(_);if(T)return this._cache.set(_,T),T;const S=this._boundingVolumeFactory(e,a,u,f);return this._cache.set(_,S),this._hadAnyChanges=!0,S}}class Ta{constructor(e,a,u,f){this.min=u,this.max=f,this.points=e,this.planes=a}static fromAabb(e,a){const u=[];for(let f=0;f<8;f++)u.push([1&~f?e[0]:a[0],(f>>1&1)==1?a[1]:e[1],(f>>2&1)==1?a[2]:e[2]]);return new Ta(u,[[-1,0,0,a[0]],[1,0,0,-e[0]],[0,-1,0,a[1]],[0,1,0,-e[1]],[0,0,-1,a[2]],[0,0,1,-e[2]]],e,a)}static fromCenterSizeAngles(e,a,u){const f=d.bv([],u[0],u[1],u[2]),_=d.bw([],[a[0],0,0],f),v=d.bw([],[0,a[1],0],f),T=d.bw([],[0,0,a[2]],f),S=[...e],C=[...e];for(let B=0;B<8;B++)for(let R=0;R<3;R++){const N=e[R]+_[R]*(1&~B?-1:1)+v[R]*((B>>1&1)==1?1:-1)+T[R]*((B>>2&1)==1?1:-1);S[R]=Math.min(S[R],N),C[R]=Math.max(C[R],N)}const z=[];for(let B=0;B<8;B++){const R=[...e];d.aW(R,R,d.aV([],_,1&~B?-1:1)),d.aW(R,R,d.aV([],v,(B>>1&1)==1?1:-1)),d.aW(R,R,d.aV([],T,(B>>2&1)==1?1:-1)),z.push(R)}return new Ta(z,[[..._,-d.a$(_,z[0])],[...v,-d.a$(v,z[0])],[...T,-d.a$(T,z[0])],[-_[0],-_[1],-_[2],-d.a$(_,z[7])],[-v[0],-v[1],-v[2],-d.a$(v,z[7])],[-T[0],-T[1],-T[2],-d.a$(T,z[7])]],S,C)}intersectsFrustum(e){let a=!0;const u=this.points.length,f=this.planes.length,_=e.planes.length,v=e.points.length;for(let T=0;T<_;T++){const S=e.planes[T];let C=0;for(let z=0;z<u;z++){const B=this.points[z];S[0]*B[0]+S[1]*B[1]+S[2]*B[2]+S[3]>=0&&C++}if(C===0)return 0;C<u&&(a=!1)}if(a)return 2;for(let T=0;T<f;T++){const S=this.planes[T];let C=0;for(let z=0;z<v;z++){const B=e.points[z];S[0]*B[0]+S[1]*B[1]+S[2]*B[2]+S[3]>=0&&C++}if(C===0)return 0}return 1}intersectsPlane(e){const a=this.points.length;let u=0;for(let f=0;f<a;f++){const _=this.points[f];e[0]*_[0]+e[1]*_[1]+e[2]*_[2]+e[3]>=0&&u++}return u===a?2:u===0?0:1}}function wc(m,e,a){const u=m-e;return u<0?-u:Math.max(0,u-a)}function bh(m,e,a,u,f){const _=m-a;let v;return v=_<0?Math.min(-_,1+_-f):_>1?Math.min(Math.max(_-f,0),1-_):0,Math.max(v,wc(e,u,f))}class kf{constructor(){this._boundingVolumeCache=new bc(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,a,u,f){const _=1<<u.z,v=1/_,T=u.x/_,S=u.y/_;let C=2;return C=Math.min(C,bh(e,a,T,S,v)),C=Math.min(C,bh(e,a,T+.5,-S-v,v)),C=Math.min(C,bh(e,a,T+.5,2-S-v,v)),C}getWrap(e,a,u){const f=1<<a.z,_=1/f,v=a.x/f,T=wc(e.x,v,_),S=wc(e.x,v-1,_),C=wc(e.x,v+1,_),z=Math.min(T,S,C);return z===C?1:z===S?-1:0}allowVariableZoom(e,a){return xe(e,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,a,u,f){return this._boundingVolumeCache.getTileBoundingVolume(e,a,u,f)}_computeTileBoundingVolume(e,a,u,f){var _,v;let T=0,S=0;if(f?.terrain){const C=new d.a0(e.z,a,e.z,e.x,e.y),z=f.terrain.getMinMaxElevation(C);T=(_=z.minElevation)!==null&&_!==void 0?_:Math.min(0,u),S=(v=z.maxElevation)!==null&&v!==void 0?v:Math.max(0,u)}if(T/=d.by,S/=d.by,T+=1,S+=1,e.z<=0)return Ta.fromAabb([-S,-S,-S],[S,S,S]);if(e.z===1)return Ta.fromAabb([e.x===0?-S:0,e.y===0?0:-S,-S],[e.x===0?0:S,e.y===0?S:0,S]);{const C=[Ya(0,0,e.x,e.y,e.z),Ya(d.a3,0,e.x,e.y,e.z),Ya(d.a3,d.a3,e.x,e.y,e.z),Ya(0,d.a3,e.x,e.y,e.z)],z=[];for(const Et of C)z.push(d.aV([],Et,S));if(S!==T)for(const Et of C)z.push(d.aV([],Et,T));e.y===0&&z.push([0,1,0]),e.y===(1<<e.z)-1&&z.push([0,-1,0]);const B=[1,1,1],R=[-1,-1,-1];for(const Et of z)for(let Pt=0;Pt<3;Pt++)B[Pt]=Math.min(B[Pt],Et[Pt]),R[Pt]=Math.max(R[Pt],Et[Pt]);const N=Ya(d.a3/2,d.a3/2,e.x,e.y,e.z),q=d.a_([],[0,1,0],N);d.aZ(q,q);const K=d.a_([],N,q);d.aZ(K,K);const J=d.a_([],C[2],C[1]);d.aZ(J,J);const et=d.a_([],C[0],C[3]);d.aZ(et,et),z.push(d.aV([],N,S)),e.y>=(1<<e.z)/2&&z.push(d.aV([],Ya(d.a3/2,0,e.x,e.y,e.z),S)),e.y<(1<<e.z)/2&&z.push(d.aV([],Ya(d.a3/2,d.a3,e.x,e.y,e.z),S));const at=Bf(N,z),ct=Bf(K,z),rt=[-N[0],-N[1],-N[2],at.max],ht=[N[0],N[1],N[2],-at.min],pt=[-K[0],-K[1],-K[2],ct.max],lt=[K[0],K[1],K[2],-ct.min],xt=[...J,0],Dt=[...et,0],Mt=[];return e.y===0?Mt.push(d.bx(Dt,xt,rt),d.bx(Dt,xt,ht)):Mt.push(d.bx(pt,xt,rt),d.bx(pt,xt,ht),d.bx(pt,Dt,rt),d.bx(pt,Dt,ht)),e.y===(1<<e.z)-1?Mt.push(d.bx(Dt,xt,rt),d.bx(Dt,xt,ht)):Mt.push(d.bx(lt,xt,rt),d.bx(lt,xt,ht),d.bx(lt,Dt,rt),d.bx(lt,Dt,ht)),new Ta(Mt,[rt,ht,pt,lt,xt,Dt],B,R)}}}function Bf(m,e){let a=1/0,u=-1/0;for(const f of e){const _=d.a$(m,f);a=Math.min(a,_),u=Math.max(u,_)}return{min:a,max:u}}class Tc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,u){return this._helper.interpolatePadding(e,a,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a){this._helper.resize(e,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=d.bz(),this._projectionMatrix=d.bd(),this._globeViewProjMatrix32f=d.bc(),this._globeViewProjMatrixNoCorrection=d.bd(),this._globeViewProjMatrixNoCorrectionInverted=d.bd(),this._globeProjMatrixInverted=d.bd(),this._cameraPosition=d.bt(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,u)=>{const f=d.ai(a.lat,-d.aj,d.aj),_=d.ai(+u,this.minZoom+Cn(0,f),this.maxZoom);return{center:new d.U(a.lng,f),zoom:_}},this.applyConstrain=(a,u)=>this._helper.applyConstrain(a,u),this._helper=new hn({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,u)=>this.defaultConstrain(a,u)},e),this._coveringTilesDetailsProvider=new kf}clone(){const e=new Tc;return e.apply(this),e}apply(e,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=d.bt();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:a,applyGlobeMatrix:u}=e,f=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:f,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const a=this.pitchInRadians,u=this.cameraToCenterDistance/e,f=Math.sin(a)*u,_=Math.cos(a)*u+1,v=1/Math.sqrt(f*f+_*_)*1;let T=-f,S=_;const C=Math.sqrt(T*T+S*S);T/=C,S/=C;const z=[0,T,S];d.bA(z,z,[0,0,0],-this.bearingInRadians),d.bB(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),d.bC(z,z,[0,0,0],this.center.lng*Math.PI/180);const B=1/d.b1(z);return d.aV(z,z,B),[...z,-v*B]}isLocationOccluded(e){return!this.isSurfacePointVisible(Qn(e))}transformLightDirection(e){const a=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,f=Math.cos(u),_=[Math.sin(a)*f,Math.sin(u),Math.cos(a)*f],v=[_[2],0,-_[0]],T=[0,0,0];d.a_(T,v,_),d.aZ(v,v),d.aZ(T,T);const S=[0,0,0];return d.aZ(S,[v[0]*e[0]+T[0]*e[1]+_[0]*e[2],v[1]*e[0]+T[1]*e[1]+_[1]*e[2],v[2]*e[0]+T[2]*e[1]+_[2]*e[2]]),S}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,a,u){const f=function(T,S,C){const z=1/(1<<C.z);return new d.a5(T/d.a3*z+C.x*z,S/d.a3*z+C.y*z)}(e,a,u.canonical),_=(v=f.y,[d.bs(f.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(e,a,u,f){const _=u.canonical,v=Ya(e,a,_.x,_.y,_.z),T=1+(f?f(e,a):0)/d.by,S=[v[0]*T,v[1]*T,v[2]*T,1];d.aB(S,S,this._globeViewProjMatrixNoCorrection);const C=this._cachedClippingPlane,z=C[0]*v[0]+C[1]*v[1]+C[2]*v[2]+C[3]<0;return{point:new d.P(S[0]/S[3],S[1]/S[3]),signedDistanceFromCamera:S[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=xc(this.worldSize,this.center.lat),a=d.be(),u=d.be();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),d.b8(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const f=this.centerOffset;a[8]=2*-f.x/this._helper._width,a[9]=2*f.y/this._helper._height,this._projectionMatrix=d.b9(a),this._globeProjMatrixInverted=d.be(),d.av(this._globeProjMatrixInverted,a),d.N(a,a,[0,0,-this.cameraToCenterDistance]),d.ba(a,a,this.rollInRadians),d.bb(a,a,-this.pitchInRadians),d.ba(a,a,this.bearingInRadians),d.N(a,a,[0,0,-e]);const _=d.bt();_[0]=e,_[1]=e,_[2]=e,d.bb(u,a,this.center.lat*Math.PI/180),d.bD(u,u,-this.center.lng*Math.PI/180),d.O(u,u,_),this._globeViewProjMatrixNoCorrection=u,d.bb(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),d.bD(a,a,-this.center.lng*Math.PI/180),d.O(a,a,_),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=d.be(),d.av(this._globeViewProjMatrixNoCorrectionInverted,u);const v=d.bt();this._cameraPosition=d.bt(),this._cameraPosition[2]=this.cameraToCenterDistance/e,d.bA(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),d.bB(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),d.bA(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),d.aW(this._cameraPosition,this._cameraPosition,[0,0,1]),d.bB(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),d.bC(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const T=d.b9(this._globeViewProjMatrixNoCorrectionInverted);d.O(T,T,[1,1,-1]),this._cachedFrustum=Mr.fromInvProjectionMatrix(T,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){d.w("calculateFogMatrix is not supported on globe projection.");const a=d.be();return d.am(a),a}getVisibleUnwrappedCoordinates(e){return[new d.b6(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&d.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=Qn(e);d.aV(u,u,1+a/d.by);const f=d.bz();return d.aB(f,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),f[2]/f[3]}populateCache(e){}getBounds(){const e=.5*this.width,a=.5*this.height,u=[new d.P(0,0),new d.P(e,0),new d.P(this.width,0),new d.P(this.width,a),new d.P(this.width,this.height),new d.P(e,this.height),new d.P(0,this.height),new d.P(0,a)],f=[];for(const B of u)f.push(this.unprojectScreenPoint(B));let _=0,v=0,T=0,S=0;const C=this.center;for(const B of f){const R=d.bE(C.lng,B.lng),N=d.bE(C.lat,B.lat);R<v&&(v=R),R>_&&(_=R),N<S&&(S=N),N>T&&(T=N)}const z=[C.lng+v,C.lat+S,C.lng+_,C.lat+T];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new Wi(z)}calculateCenterFromCameraLngLatAlt(e,a,u,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,u,f)}setLocationAtPoint(e,a){const u=Qn(this.unprojectScreenPoint(a)),f=Qn(e),_=d.bt();d.bF(_);const v=d.bt();d.bC(v,u,_,-this.center.lng*Math.PI/180),d.bB(v,v,_,this.center.lat*Math.PI/180);const T=f[0]*f[0]+f[2]*f[2],S=v[0]*v[0];if(T<S)return;const C=Math.sqrt(T-S),z=-C,B=d.bG(f[0],f[2],v[0],C),R=d.bG(f[0],f[2],v[0],z),N=d.bt();d.bC(N,f,_,-B);const q=d.bG(N[1],N[2],v[1],v[2]),K=d.bt();d.bC(K,f,_,-R);const J=d.bG(K[1],K[2],v[1],v[2]),et=.5*Math.PI,at=q>=-et&&q<=et,ct=J>=-et&&J<=et;let rt,ht;if(at&&ct){const Dt=this.center.lng*Math.PI/180,Mt=this.center.lat*Math.PI/180;d.bH(B,Dt)+d.bH(q,Mt)<d.bH(R,Dt)+d.bH(J,Mt)?(rt=B,ht=q):(rt=R,ht=J)}else if(at)rt=B,ht=q;else{if(!ct)return;rt=R,ht=J}const pt=rt/Math.PI*180,lt=ht/Math.PI*180,xt=this.center.lat;this.setCenter(new d.U(pt,d.ai(lt,-90,90))),this.setZoom(this.zoom+Cn(xt,this.center.lat))}locationToScreenPoint(e,a){const u=Qn(e);if(a){const f=a.getElevationForLngLatZoom(e,this._helper._tileZoom);d.aV(u,u,1+f/d.by)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(e){const a=d.bz();return d.aB(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new d.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,a){if(a){const u=a.pointCoordinate(e);if(u)return u}return d.a5.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,a){var u;return(u=this.screenPointToMercatorCoordinate(e,a))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(e,a){const u=this._cameraPosition,f=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(u,f)}getRayDirectionFromPixel(e){const a=d.bz();a[0]=e.x/this.width*2-1,a[1]=-1*(e.y/this.height*2-1),a[2]=1,a[3]=1,d.aB(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const u=d.bt();u[0]=a[0]-this._cameraPosition[0],u[1]=a[1]-this._cameraPosition[1],u[2]=a[2]-this._cameraPosition[2];const f=d.bt();return d.aZ(f,u),f}isSurfacePointVisible(e){const a=this._cachedClippingPlane;return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]+a[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const a=d.bz();return d.aB(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(e,a){const u=d.a$(e,a),f=d.bt(),_=d.bt();d.aV(_,a,u),d.aY(f,e,_);const v=1-d.a$(f,f);if(v<0)return null;const T=d.a$(e,e)-1,S=-u+(u<0?1:-1)*Math.sqrt(v),C=T/S,z=S;return{tMin:Math.min(C,z),tMax:Math.max(C,z)}}unprojectScreenPoint(e){const a=this._cameraPosition,u=this.getRayDirectionFromPixel(e),f=this.rayPlanetIntersection(a,u);if(f){const z=d.bt();d.aW(z,a,[u[0]*f.tMin,u[1]*f.tMin,u[2]*f.tMin]);const B=d.bt();return d.aZ(B,z),Lf(B)}const _=this._cachedClippingPlane,v=_[0]*u[0]+_[1]*u[1]+_[2]*u[2],T=-d.b5(_,a)/v,S=d.bt();if(T>0)d.aW(S,a,[u[0]*T,u[1]*T,u[2]*T]);else{const z=d.bt();d.aW(z,a,[2*u[0],2*u[1],2*u[2]]);const B=d.b5(this._cachedClippingPlane,z);d.aY(S,z,[this._cachedClippingPlane[0]*B,this._cachedClippingPlane[1]*B,this._cachedClippingPlane[2]*B])}const C=function(z){const B=d.bt();return B[0]=z[0]*-z[3],B[1]=z[1]*-z[3],B[2]=z[2]*-z[3],{center:B,radius:Math.sqrt(1-z[3]*z[3])}}(_);return Lf(function(z,B,R){const N=d.bt();d.aY(N,R,z);const q=d.bt();return d.bu(q,z,N,B/d.b3(N)),q}(C.center,C.radius,S))}getMatrixForModel(e,a){const u=d.U.convert(e),f=1/d.by,_=d.bd();return d.bD(_,_,u.lng/180*Math.PI),d.bb(_,_,-u.lat/180*Math.PI),d.N(_,_,[0,0,1+a/d.by]),d.bb(_,_,.5*Math.PI),d.O(_,_,[f,f,f]),_}getProjectionDataForCustomLayer(e=!0){const a=this.getProjectionData({overscaledTileID:new d.a0(0,0,0,0,0),applyGlobeMatrix:e});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(e){}}class Sc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,u){return this._helper.interpolatePadding(e,a,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,u=!0){this._helper.resize(e,a,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrainOverride(e){this._helper.setConstrainOverride(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,a){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,u)=>this.currentTransform.defaultConstrain(a,u),this.applyConstrain=(a,u)=>this._helper.applyConstrain(a,u),this._helper=new hn({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,u)=>this.defaultConstrain(a,u)},e),this._globeness=1,this._mercatorTransform=new Ri,this._verticalPerspectiveTransform=new Tc}clone(){const e=new Sc;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const a=this._mercatorTransform.getProjectionData(e),u=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:a.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return d.bo(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return d.bo(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,a,u){const f=this._mercatorTransform.getPitchedTextCorrection(e,a,u),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,a,u);return d.bo(f,_,this._globeness)}projectTileCoordinates(e,a,u,f){return this.currentTransform.projectTileCoordinates(e,a,u,f)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){return this.currentTransform.lngLatToCameraDepth(e,a)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,a,u,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,u,f)}setLocationAtPoint(e,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,a){return this.currentTransform.locationToScreenPoint(e,a)}screenPointToMercatorCoordinate(e,a){return this.currentTransform.screenPointToMercatorCoordinate(e,a)}screenPointToLocation(e,a){return this.currentTransform.screenPointToLocation(e,a)}isPointOnMapSurface(e,a){return this.currentTransform.isPointOnMapSurface(e,a)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,a){return this.currentTransform.getMatrixForModel(e,a)}getProjectionDataForCustomLayer(e=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return a;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return u.fallbackMatrix=a.mainMatrix,u}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Nr{get useGlobeControls(){return!0}handlePanInertia(e,a){const u=wa(e,a);return Math.abs(u.lng-a.center.lng)>180&&(u.lng=a.center.lng+179.5*Math.sign(u.lng-a.center.lng)),{easingCenter:u,easingOffset:new d.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,a){const u=e.around,f=a.screenPointToLocation(u);e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta);const _=a.zoom;e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta);const v=a.zoom-_;if(v===0)return;const T=d.bE(a.center.lng,f.lng),S=T/(Math.abs(T/180)+1),C=d.bE(a.center.lat,f.lat),z=a.getRayDirectionFromPixel(u),B=a.cameraPosition,R=-1*d.a$(B,z),N=d.bt();d.aW(N,B,[z[0]*R,z[1]*R,z[2]*R]);const q=d.b1(N)-1,K=Math.exp(.5*-Math.max(q-.3,0)),J=xc(a.worldSize,a.center.lat)/Math.min(a.width,a.height),et=d.br(J,.9,.5,1,.25),at=(1-d.al(-v))*Math.min(K,et),ct=a.center.lat,rt=a.zoom,ht=new d.U(a.center.lng+S*at,d.ai(a.center.lat+C*at,-d.aj,d.aj));a.setLocationAtPoint(f,u);const pt=a.center,lt=d.br(Math.abs(T),45,85,0,1),xt=d.br(J,.75,.35,0,1),Dt=Math.pow(Math.max(lt,xt),.25),Mt=d.bE(pt.lng,ht.lng),Et=d.bE(pt.lat,ht.lat);a.setCenter(new d.U(pt.lng+Mt*Dt,pt.lat+Et*Dt).wrap()),a.setZoom(rt+Cn(ct,a.center.lat))}handleMapControlsPan(e,a,u){if(!e.panDelta)return;const f=a.center.lat,_=a.zoom;a.setCenter(wa(e.panDelta,a).wrap()),a.setZoom(_+Cn(f,a.center.lat))}cameraForBoxAndBearing(e,a,u,f,_){const v=io(e,a,u,f,_),T=a.left/_.width*2-1,S=(_.width-a.right)/_.width*2-1,C=a.top/_.height*-2+1,z=(_.height-a.bottom)/_.height*-2+1,B=d.bE(u.getWest(),u.getEast())<0,R=B?u.getEast():u.getWest(),N=B?u.getWest():u.getEast(),q=Math.max(u.getNorth(),u.getSouth()),K=Math.min(u.getNorth(),u.getSouth()),J=R+.5*d.bE(R,N),et=q+.5*d.bE(q,K),at=_.clone();at.setCenter(v.center),at.setBearing(v.bearing),at.setPitch(0),at.setRoll(0),at.setZoom(v.zoom);const ct=at.modelViewProjectionMatrix,rt=[Qn(u.getNorthWest()),Qn(u.getNorthEast()),Qn(u.getSouthWest()),Qn(u.getSouthEast()),Qn(new d.U(N,et)),Qn(new d.U(R,et)),Qn(new d.U(J,q)),Qn(new d.U(J,K))],ht=Qn(v.center);let pt=Number.POSITIVE_INFINITY;for(const lt of rt)T<0&&(pt=Nr.getLesserNonNegativeNonNull(pt,Nr.solveVectorScale(lt,ht,ct,"x",T))),S>0&&(pt=Nr.getLesserNonNegativeNonNull(pt,Nr.solveVectorScale(lt,ht,ct,"x",S))),C>0&&(pt=Nr.getLesserNonNegativeNonNull(pt,Nr.solveVectorScale(lt,ht,ct,"y",C))),z<0&&(pt=Nr.getLesserNonNegativeNonNull(pt,Nr.solveVectorScale(lt,ht,ct,"y",z)));if(Number.isFinite(pt)&&pt!==0)return v.zoom=at.zoom+d.ao(pt),v;ys()}handleJumpToCenterZoom(e,a){const u=e.center.lat,f=e.applyConstrain(a.center?d.U.convert(a.center):e.center,e.zoom).center;e.setCenter(f.wrap());const _=a.zoom!==void 0?+a.zoom:e.zoom+Cn(u,f.lat);e.zoom!==_&&e.setZoom(_)}handleEaseTo(e,a){const u=e.zoom,f=e.center,_=e.padding,v={roll:e.roll,pitch:e.pitch,bearing:e.bearing},T={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},S=a.zoom!==void 0,C=!e.isPaddingEqual(a.padding);let z=!1;const B=a.center?d.U.convert(a.center):f,R=e.applyConstrain(B,u).center;gu(e,R);const N=e.clone();N.setCenter(R),N.setZoom(S?+a.zoom:u+Cn(f.lat,B.lat)),N.setBearing(a.bearing);const q=new d.P(d.ai(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),d.ai(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));N.setLocationAtPoint(R,q);const K=(a.offset&&a.offsetAsPoint.mag())>0?N.center:R,J=S?+a.zoom:u+Cn(f.lat,K.lat),et=u+Cn(f.lat,0),at=J+Cn(K.lat,0),ct=d.bE(f.lng,K.lng),rt=d.bE(f.lat,K.lat),ht=d.al(at-et);return z=J!==u,{easeFunc:pt=>{if(d.bi(v,T)||vs({startEulerAngles:v,endEulerAngles:T,tr:e,k:pt,useSlerp:v.roll!=T.roll}),C&&e.interpolatePadding(_,a.padding,pt),a.around)d.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(a.around,a.aroundPoint);else{const lt=at>et?Math.min(2,ht):Math.max(.5,ht),xt=Math.pow(lt,1-pt),Dt=xh(f,ct,rt,pt*xt);e.setCenter(Dt.wrap())}if(z){const lt=d.F.number(et,at,pt)+Cn(0,e.center.lat);e.setZoom(lt)}},isZooming:z,elevationCenter:K}}handleFlyTo(e,a){const u=a.zoom!==void 0,f=e.center,_=e.zoom,v=e.padding,T=!e.isPaddingEqual(a.padding),S=e.applyConstrain(d.U.convert(a.center||a.locationAtOffset),_).center,C=u?+a.zoom:e.zoom+Cn(e.center.lat,S.lat),z=e.clone();z.setCenter(S),z.setZoom(C),z.setBearing(a.bearing);const B=new d.P(d.ai(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),d.ai(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));z.setLocationAtPoint(S,B);const R=z.center;gu(e,R);const N=function(rt,ht,pt){const lt=Qn(ht),xt=Qn(pt),Dt=d.a$(lt,xt),Mt=Math.acos(Dt),Et=Rf(rt);return Mt/(2*Math.PI)*Et}(e,f,R),q=_+Cn(f.lat,0),K=C+Cn(R.lat,0),J=d.al(K-q);let et;if(typeof a.minZoom=="number"){const rt=+a.minZoom+Cn(R.lat,0),ht=Math.min(rt,q,K)+Cn(0,R.lat),pt=e.applyConstrain(R,ht).zoom+Cn(R.lat,0);et=d.al(pt-q)}const at=d.bE(f.lng,R.lng),ct=d.bE(f.lat,R.lat);return{easeFunc:(rt,ht,pt,lt)=>{const xt=xh(f,at,ct,pt);T&&e.interpolatePadding(v,a.padding,rt);const Dt=rt===1?R:xt;e.setCenter(Dt.wrap());const Mt=q+d.ao(ht);e.setZoom(rt===1?C:Mt+Cn(0,Dt.lat))},scaleOfZoom:J,targetCenter:R,scaleOfMinZoom:et,pixelPathLength:N}}static solveVectorScale(e,a,u,f,_){const v=f==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],T=[u[3],u[7],u[11],u[15]],S=e[0]*v[0]+e[1]*v[1]+e[2]*v[2],C=e[0]*T[0]+e[1]*T[1]+e[2]*T[2],z=a[0]*v[0]+a[1]*v[1]+a[2]*v[2],B=a[0]*T[0]+a[1]*T[1]+a[2]*T[2];return z+_*C===S+_*B||T[3]*(S-z)+v[3]*(B-C)+S*B==z*C?null:(z+v[3]-_*B-_*T[3])/(z-S-_*B+_*C)}static getLesserNonNegativeNonNull(e,a){return a!==null&&a>=0&&a<e?a:e}}class Mc{constructor(e){this._globe=e,this._mercatorCameraHelper=new Kn,this._verticalPerspectiveCameraHelper=new Nr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,a){return this.currentHelper.handlePanInertia(e,a)}handleMapControlsRollPitchBearingZoom(e,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,a)}handleMapControlsPan(e,a,u){this.currentHelper.handleMapControlsPan(e,a,u)}cameraForBoxAndBearing(e,a,u,f,_){return this.currentHelper.cameraForBoxAndBearing(e,a,u,f,_)}handleJumpToCenterZoom(e,a){this.currentHelper.handleJumpToCenterZoom(e,a)}handleEaseTo(e,a){return this.currentHelper.handleEaseTo(e,a)}handleFlyTo(e,a){return this.currentHelper.handleFlyTo(e,a)}}const jo=(m,e)=>d.z(m,e&&e.filter(a=>a.identifier!=="source.canvas")),wh=d.bI();class xu extends d.E{constructor(e,a={}){var u,f;super(),this._rtlPluginLoaded=()=>{for(const v in this.tileManagers){const T=this.tileManagers[v].getSource().type;T!=="vector"&&T!=="geojson"||this.tileManagers[v].reload()}},this.map=e,this.dispatcher=new Lr(wi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(v,T)=>this.getGlyphs(v,T)),this.dispatcher.registerMessageHandler("GI",(v,T)=>this.getImages(v,T)),this.dispatcher.registerMessageHandler("GDA",(v,T)=>this.getDashes(v,T)),this.imageManager=new Yi,this.imageManager.setEventedParent(this);const _=((u=e._container)===null||u===void 0?void 0:u.lang)||typeof document<"u"&&((f=document.documentElement)===null||f===void 0?void 0:f.lang)||void 0;this.glyphManager=new ne(e._requestManager,a.localIdeographFontFamily,_),this.lineAtlas=new ae(256,512),this.crossTileSymbolIndex=new Uo,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",d.bJ()),wr().on(ms,this._rtlPluginLoaded),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const T=this.tileManagers[v.sourceId];if(!T)return;const S=T.getSource();if(S&&S.vectorLayerIds)for(const C in this._layers){const z=this._layers[C];z.source===S.id&&this._validateLayer(z)}})}_setInitialValues(){var e;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new d.bK,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((e=this.crossTileSymbolIndex)===null||e===void 0?void 0:e.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(e,a){var u,f,_;this._checkLoaded();const v=a===null?(_=(f=(u=this.stylesheet.state)===null||u===void 0?void 0:u[e])===null||f===void 0?void 0:f.default)!==null&&_!==void 0?_:null:a;if(d.bL(v,this._globalState[e]))return this;this._globalState[e]=v,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const a=[];for(const u in e)!d.bL(this._globalState[u],e[u].default)&&(a.push(u),this._globalState[u]=e[u].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(e){if(e.length===0)return;const a=new Set,u={};for(const f of e){u[f]=this._globalState[f];for(const _ in this._layers){const v=this._layers[_],T=v.getLayoutAffectingGlobalStateRefs(),S=v.getPaintAffectingGlobalStateRefs();if(T.has(f)&&a.add(v.source),S.has(f))for(const{name:C,value:z}of S.get(f))this._updatePaintProperty(v,C,z)}}this.dispatcher.broadcast("UGS",u);for(const f in this.tileManagers)a.has(f)&&(this._reloadSource(f),this._changed=!0)}loadURL(e,a={},u){this.fire(new d.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const f=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;d.j(f,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,a,u)}).catch(v=>{this._loadStyleRequest=null,v&&!_.signal.aborted&&this.fire(new d.k(v))})}loadJSON(e,a={},u){this.fire(new d.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ve.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(e,a,u)}).catch(()=>{})}loadEmpty(){this.fire(new d.l("dataloading",{dataType:"style"})),this._load(wh,{validate:!1})}_load(e,a,u){var f,_;let v=a.transformStyle?a.transformStyle(u,e):e;if(!a.validate||!jo(this,d.B(v))){v=Object.assign({},v),this._loaded=!0,this.stylesheet=v;for(const T in v.sources)this.addSource(T,v.sources[T],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new oi(this.stylesheet.light),this._setProjectionInternal(((f=this.stylesheet.projection)===null||f===void 0?void 0:f.type)||"mercator"),this.sky=new qt(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new d.l("data",{dataType:"style"})),this.fire(new d.l("style.load"))}}_createLayers(){var e,a,u;const f=d.bM(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",f),this._order=f.map(_=>_.id),this._layers={},this._serializedLayers=null;for(const _ of f){const v=d.bN(_,this._globalState);if(v.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=v,d.bO(v)&&this.tileManagers[v.source]){const T=(u=(a=_.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&u!==void 0?u:v.paint.get("raster-fade-duration");this.tileManagers[v.source].setRasterFadeDuration(T)}}}_loadSprite(e,a=!1,u=void 0){let f;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,v,T,S){return d._(this,void 0,void 0,function*(){const C=$i(_),z=T>1?"@2x":"",B={},R={};for(const{id:N,url:q}of C){const K=v.transformRequest(Yn(q,z,".json"),"SpriteJSON");B[N]=d.j(K,S);const J=v.transformRequest(Yn(q,z,".png"),"SpriteImage");R[N]=Re.getImage(J,S)}return yield Promise.all([...Object.values(B),...Object.values(R)]),function(N,q){return d._(this,void 0,void 0,function*(){const K={};for(const J in N){K[J]={};const et=ve.getImageCanvasContext((yield q[J]).data),at=(yield N[J]).data;for(const ct in at){const{width:rt,height:ht,x:pt,y:lt,sdf:xt,pixelRatio:Dt,stretchX:Mt,stretchY:Et,content:Pt,textFitWidth:Kt,textFitHeight:Jt}=at[ct];K[J][ct]={data:null,pixelRatio:Dt,sdf:xt,stretchX:Mt,stretchY:Et,content:Pt,textFitWidth:Kt,textFitHeight:Jt,spriteData:{width:rt,height:ht,x:pt,y:lt,context:et}}}}return K})}(B,R)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const v in _){this._spritesImagesIds[v]=[];const T=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(S=>!(S in _)):[];for(const S of T)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in _[v]){const C=v==="default"?S:`${v}:${S}`;this._spritesImagesIds[v].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,_[v][S],!1):this.imageManager.addImage(C,_[v][S]),a&&(this._changedImages[C]=!0)}}}).catch(_=>{this._spriteRequest=null,f=_,this.fire(new d.k(f))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"})),u&&u(f)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}_validateLayer(e){const a=this.tileManagers[e.source];if(!a)return;const u=e.sourceLayer;if(!u)return;const f=a.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(u)===-1)&&this.fire(new d.k(new Error(`Source layer "${u}" does not exist on source "${f.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.tileManagers)if(!this.tileManagers[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,a=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a?d.bP(u):u);const f=[];for(const _ of e)if(u[_]){const v=a?d.bP(u[_]):u[_];f.push(v)}return f}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const a=Object.keys(this._layers);for(const u of a){const f=this._layers[u];f.type!=="custom"&&(e[u]=f.serialize())}return e}hasTransitions(){var e,a,u;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const f in this.tileManagers)if(this.tileManagers[f].hasTransition())return!0;for(const f in this._layers)if(this._layers[f].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const a=this._changed;if(a){const f=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(f.length||_.length)&&this._updateWorkerLayers(f,_);for(const v in this._updatedSources){const T=this._updatedSources[v];if(T==="reload")this._reloadSource(v);else{if(T!=="clear")throw new Error(`Invalid action ${T}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const f in this.tileManagers){const _=this.tileManagers[f];u[f]=_.used,_.used=!1}for(const f of this._order){const _=this._layers[f];_.recalculate(e,this._availableImages),!_.isHidden(e.zoom)&&_.source&&(this.tileManagers[_.source].used=!0)}for(const f in u){const _=this.tileManagers[f];!!u[f]!=!!_.used&&_.fire(new d.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,a&&this.fire(new d.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.tileManagers)this.tileManagers[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){var u;this._checkLoaded();const f=this.serialize();if(e=a.transformStyle?a.transformStyle(f,e):e,((u=a.validate)===null||u===void 0||u)&&jo(this,d.B(e)))return!1;(e=d.bP(e)).layers=d.bM(e.layers);const _=d.bQ(f,e),v=this._getOperationsToPerform(_);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const T of v.operations)T();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const a=[],u=[];for(const f of e)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push(()=>this.addLayer.apply(this,f.args));break;case"removeLayer":a.push(()=>this.removeLayer.apply(this,f.args));break;case"setPaintProperty":a.push(()=>this.setPaintProperty.apply(this,f.args));break;case"setLayoutProperty":a.push(()=>this.setLayoutProperty.apply(this,f.args));break;case"setFilter":a.push(()=>this.setFilter.apply(this,f.args));break;case"addSource":a.push(()=>this.addSource.apply(this,f.args));break;case"removeSource":a.push(()=>this.removeSource.apply(this,f.args));break;case"setLayerZoomRange":a.push(()=>this.setLayerZoomRange.apply(this,f.args));break;case"setLight":a.push(()=>this.setLight.apply(this,f.args));break;case"setGeoJSONSourceData":a.push(()=>this.setGeoJSONSourceData.apply(this,f.args));break;case"setGlyphs":a.push(()=>this.setGlyphs.apply(this,f.args));break;case"setSprite":a.push(()=>this.setSprite.apply(this,f.args));break;case"setTerrain":a.push(()=>this.map.setTerrain.apply(this,f.args));break;case"setSky":a.push(()=>this.setSky.apply(this,f.args));break;case"setProjection":this.setProjection.apply(this,f.args);break;case"setGlobalState":a.push(()=>this.setGlobalState.apply(this,f.args));break;case"setTransition":a.push(()=>{});break;default:u.push(f.command)}return{operations:a,unimplemented:u}}addImage(e,a){if(this.getImage(e))return this.fire(new d.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,u={}){if(this._checkLoaded(),this.tileManagers[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(d.B.source,`sources.${e}`,a,null,u))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const f=this.tileManagers[e]=new Ge(e,a,this.dispatcher);f.style=this,f.setEventedParent(this,()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:e})),f.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new d.k(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const a=this.tileManagers[e];delete this.tileManagers[e],delete this._updatedSources[e],a.fire(new d.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.tileManagers[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.tileManagers[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(a),this._changed=!0}getSource(e){return this.tileManagers[e]&&this.tileManagers[e].getSource()}addLayer(e,a,u={}){this._checkLoaded();const f=e.id;if(this.getLayer(f))return void this.fire(new d.k(new Error(`Layer "${f}" already exists on this map.`)));let _;if(e.type==="custom"){if(jo(this,d.bR(e)))return;_=d.bN(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(f,e.source),e=d.bP(e),e=d.e(e,{source:f})),this._validate(d.B.layer,`layers.${f}`,e,{arrayIndex:-1},u))return;_=d.bN(e,this._globalState),this._validateLayer(_),_.setEventedParent(this,{layer:{id:f}})}const v=a?this._order.indexOf(a):this._order.length;if(a&&v===-1)this.fire(new d.k(new Error(`Cannot add layer "${f}" before non-existing layer "${a}".`)));else{if(this._order.splice(v,0,f),this._layerOrderChanged=!0,this._layers[f]=_,this._removedLayers[f]&&_.source&&_.type!=="custom"){const T=this._removedLayers[f];delete this._removedLayers[f],T.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.tileManagers[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;const u=this._order.indexOf(e);this._order.splice(u,1);const f=a?this._order.indexOf(a):this._order.length;a&&f===-1?this.fire(new d.k(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(f,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const a=this._layers[e];if(!a)return void this.fire(new d.k(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,u){this._checkLoaded();const f=this.getLayer(e);f?f.minzoom===a&&f.maxzoom===u||(a!=null&&(f.minzoom=a),u!=null&&(f.maxzoom=u),this._updateLayer(f)):this.fire(new d.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,u={}){this._checkLoaded();const f=this.getLayer(e);if(f){if(!d.bL(f.filter,a))return a==null?(f.setFilter(void 0),void this._updateLayer(f)):void(this._validate(d.B.filter,`layers.${f.id}.filter`,a,null,u)||(f.setFilter(d.bP(a)),this._updateLayer(f)))}else this.fire(new d.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.bP(this.getLayer(e).filter)}setLayoutProperty(e,a,u,f={}){this._checkLoaded();const _=this.getLayer(e);_?d.bL(_.getLayoutProperty(a),u)||(_.setLayoutProperty(a,u,f),this._updateLayer(_)):this.fire(new d.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){const u=this.getLayer(e);if(u)return u.getLayoutProperty(a);this.fire(new d.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,u,f={}){this._checkLoaded();const _=this.getLayer(e);_?d.bL(_.getPaintProperty(a),u)||this._updatePaintProperty(_,a,u,f):this.fire(new d.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,a,u,f={}){e.setPaintProperty(a,u,f)&&this._updateLayer(e),d.bO(e)&&a==="raster-fade-duration"&&this.tileManagers[e.source].setRasterFadeDuration(u),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();const u=e.source,f=e.sourceLayer,_=this.tileManagers[u];if(_===void 0)return void this.fire(new d.k(new Error(`The source '${u}' does not exist in the map's style.`)));const v=_.getSource().type;v==="geojson"&&f?this.fire(new d.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||f?(e.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(f,e.id,a)):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();const u=e.source,f=this.tileManagers[u];if(f===void 0)return void this.fire(new d.k(new Error(`The source '${u}' does not exist in the map's style.`)));const _=f.getSource().type,v=_==="vector"?e.sourceLayer:void 0;_!=="vector"||v?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.k(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(v,e.id,a):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const a=e.source,u=e.sourceLayer,f=this.tileManagers[a];if(f!==void 0)return f.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),f.getFeatureState(u,e.id)):void this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.bS(this.tileManagers,_=>_.serialize()),a=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,f=this.stylesheet;return d.bT({version:f.version,name:f.name,metadata:f.metadata,light:f.light,sky:f.sky,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,projection:f.projection,sources:e,layers:a,terrain:u},_=>_!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.tileManagers[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.tileManagers[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const a=v=>this._layers[v].type==="fill-extrusion",u={},f=[];for(let v=this._order.length-1;v>=0;v--){const T=this._order[v];if(a(T)){u[T]=v;for(const S of e){const C=S[T];if(C)for(const z of C)f.push(z)}}}f.sort((v,T)=>T.intersectionZ-v.intersectionZ);const _=[];for(let v=this._order.length-1;v>=0;v--){const T=this._order[v];if(a(T))for(let S=f.length-1;S>=0;S--){const C=f[S].feature;if(u[C.layer.id]<v)break;_.push(C),f.pop()}else for(const S of e){const C=S[T];if(C)for(const z of C)_.push(z.feature)}}return _}queryRenderedFeatures(e,a,u){a&&a.filter&&this._validate(d.B.filter,"queryRenderedFeatures.filter",a.filter,null,a);const f={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new d.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const C of a.layers){const z=this._layers[C];if(!z)return this.fire(new d.k(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];f[z.source]=!0}}const _=[];a.availableImages=this._availableImages;const v=this._serializedAllLayers(),T=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,S=Object.assign(Object.assign({},a),{layers:T,globalState:this._globalState});for(const C in this.tileManagers)a.layers&&!f[C]||_.push(ps(this.tileManagers[C],this._layers,v,e,S,u,this.map.terrain?(z,B,R)=>this.map.terrain.getElevation(z,B,R):void 0));return this.placement&&_.push(function(C,z,B,R,N,q,K){const J={},et=q.queryRenderedSymbols(R),at=[];for(const ct of Object.keys(et).map(Number))at.push(K[ct]);at.sort(gi);for(const ct of at){const rt=ct.featureIndex.lookupSymbolFeatures(et[ct.bucketInstanceId],z,ct.bucketIndex,ct.sourceLayerIndex,{filterSpec:N.filter,globalState:N.globalState},N.layers,N.availableImages,C);for(const ht in rt){const pt=J[ht]=J[ht]||[],lt=rt[ht];lt.sort((xt,Dt)=>{const Mt=ct.featureSortOrder;if(Mt){const Et=Mt.indexOf(xt.featureIndex);return Mt.indexOf(Dt.featureIndex)-Et}return Dt.featureIndex-xt.featureIndex});for(const xt of lt)pt.push(xt)}}return function(ct,rt,ht){for(const pt in ct)for(const lt of ct[pt])Kr(lt,ht[rt[pt].source]);return ct}(J,C,B)}(this._layers,v,this.tileManagers,e,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(e,a){a?.filter&&this._validate(d.B.filter,"querySourceFeatures.filter",a.filter,null,a);const u=this.tileManagers[e];return u?function(f,_){const v=f.getRenderableIds().map(C=>f.getTileByID(C)),T=[],S={};for(let C=0;C<v.length;C++){const z=v[C],B=z.tileID.canonical.key;S[B]||(S[B]=!0,z.querySourceFeatures(T,_))}return T}(u,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();const u=this.light.getLight();let f=!1;for(const v in e)if(!d.bL(e[v],u[v])){f=!0;break}if(!f)return;const _={now:he(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(_)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,a={}){this._checkLoaded();const u=this.getSky();let f=!1;if(!e&&!u)return;if(e&&!u)f=!0;else if(!e&&u)f=!0;else for(const v in e)if(!d.bL(e[v],u[v])){f=!0;break}if(!f)return;const _={now:he(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,a),this.sky.updateTransitions(_)}_setProjectionInternal(e){const a=function(u,f){const _={constrainOverride:f};if(Array.isArray(u)){const v=new ro({type:u});return{projection:v,transform:new Sc(_),cameraHelper:new Mc(v)}}switch(u){case"mercator":return{projection:new An,transform:new Ri(_),cameraHelper:new Kn};case"globe":{const v=new ro({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new Sc(_),cameraHelper:new Mc(v)}}case"vertical-perspective":return{projection:new vu,transform:new Tc(_),cameraHelper:new Nr};default:return d.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new An,transform:new Ri(_),cameraHelper:new Kn}}}(e,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const u in this.tileManagers)this.tileManagers[u].reload()}_validate(e,a,u,f,_={}){return(!_||_.validate!==!1)&&jo(this,e.call(d.B,d.e({key:a,style:this.serialize(),value:u,styleSpec:d.u},f)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),wr().off(ms,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const u=this.tileManagers[a];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.tileManagers[e].clearTiles()}_reloadSource(e){this.tileManagers[e].resume(),this.tileManagers[e].reload()}_updateSources(e){for(const a in this.tileManagers)this.tileManagers[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.tileManagers)this._reloadSource(e)}_updatePlacement(e,a,u,f,_=!1){let v=!1,T=!1;const S={};for(const C of this._order){const z=this._layers[C];if(z.type!=="symbol")continue;if(!S[z.source]){const R=this.tileManagers[z.source];S[z.source]=R.getRenderableIds(!0).map(N=>R.getTileByID(N)).sort((N,q)=>q.tileID.overscaledZ-N.tileID.overscaledZ||(N.tileID.isLessThan(q.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(z,S[z.source],e.center.lng);v=v||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(he(),e.zoom))&&(this.pauseablePlacement=new No(e,this.map.terrain,this._order,_,a,u,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(he()),T=!0),v&&this.pauseablePlacement.placement.setStale()),T||v)for(const C of this._order){const z=this._layers[C];z.type==="symbol"&&this.placement.updateLayerOpacities(z,S[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(he())}_releaseSymbolFadeTiles(){for(const e in this.tileManagers)this.tileManagers[e].releaseSymbolFadeTiles()}getImages(e,a){return d._(this,void 0,void 0,function*(){const u=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,a.icons),u})}getGlyphs(e,a){return d._(this,void 0,void 0,function*(){const u=yield this.glyphManager.getGlyphs(a.stacks),f=this.tileManagers[a.source];return f&&f.setDependencies(a.tileID.key,a.type,[""]),u})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(d.B.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,a){return d._(this,void 0,void 0,function*(){const u={};for(const[f,_]of Object.entries(a.dashes))u[f]=this.lineAtlas.getDash(_.dasharray,_.round);return u})}addSprite(e,a,u={},f){this._checkLoaded();const _=[{id:e,url:a}],v=[...$i(this.stylesheet.sprite),..._];this._validate(d.B.sprite,"sprite",v,null,u)||(this.stylesheet.sprite=v,this._loadSprite(_,!0,f))}removeSprite(e){this._checkLoaded();const a=$i(this.stylesheet.sprite);if(a.find(u=>u.id===e)){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;a.splice(a.findIndex(u=>u.id===e),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}else this.fire(new d.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return $i(this.stylesheet.sprite)}setSprite(e,a={},u){this._checkLoaded(),e&&this._validate(d.B.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const e in this.tileManagers){const a=this.tileManagers[e];if(a.setEventedParent(null),a._tiles){for(const u in a._tiles)a._tiles[u].unloadVectorData();a._tiles={}}a._cache.reset(),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const e in this._layers){const a=this._layers[e];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Wa=d.aO([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Th{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,u,f,_,v,T,S,C){this.context=e;let z=this.boundPaintVertexBuffers.length!==f.length;for(let B=0;!z&&B<f.length;B++)this.boundPaintVertexBuffers[B]!==f[B]&&(z=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==u||z||this.boundIndexBuffer!==_||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==T||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==C?this.freshBind(a,u,f,_,v,T,S,C):(e.bindVertexArray.set(this.vao),T&&T.bind(),_&&_.dynamicDraw&&_.bind(),S&&S.bind(),C&&C.bind())}freshBind(e,a,u,f,_,v,T,S){const C=e.numAttributes,z=this.context,B=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=f,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=T,this.boundDynamicVertexBuffer3=S,a.enableAttributes(B,e);for(const R of u)R.enableAttributes(B,e);v&&v.enableAttributes(B,e),T&&T.enableAttributes(B,e),S&&S.enableAttributes(B,e),a.bind(),a.setVertexAttribPointers(B,e,_);for(const R of u)R.bind(),R.setVertexAttribPointers(B,e,_);v&&(v.bind(),v.setVertexAttribPointers(B,e,_)),f&&f.bind(),T&&(T.bind(),T.setVertexAttribPointers(B,e,_)),S&&(S.bind(),S.setVertexAttribPointers(B,e,_)),z.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Vo=(m,e,a,u,f)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:a?a.properties.get("fog-color"):d.bj.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?0:a?a.calculateFogBlendOpacity(u):0,u_horizon_color:a?a.properties.get("horizon-color"):d.bj.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:f?1:0}),bu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function bs(m){const e=[];for(let a=0;a<m.length;a++){if(m[a]===null)continue;const u=m[a].split(" ");e.push(u.pop())}return e}class Of{constructor(e,a,u,f,_,v,T,S,C=[]){const z=e.gl;this.program=z.createProgram();const B=bs(a.staticAttributes),R=u?u.getBinderAttributes():[],N=B.concat(R),q=Sr.prelude.staticUniforms?bs(Sr.prelude.staticUniforms):[],K=T.staticUniforms?bs(T.staticUniforms):[],J=a.staticUniforms?bs(a.staticUniforms):[],et=u?u.getBinderUniforms():[],at=q.concat(K).concat(J).concat(et),ct=[];for(const Mt of at)ct.indexOf(Mt)<0&&ct.push(Mt);const rt=u?u.defines():[];ta(z)&&rt.unshift("#version 300 es"),_&&rt.push("#define OVERDRAW_INSPECTOR;"),v&&rt.push("#define TERRAIN3D;"),S&&rt.push(S),C&&rt.push(...C);let ht=rt.concat(Sr.prelude.fragmentSource,T.fragmentSource,a.fragmentSource).join(`
`),pt=rt.concat(Sr.prelude.vertexSource,T.vertexSource,a.vertexSource).join(`
`);ta(z)||(ht=function(Mt){return Mt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ht),pt=function(Mt){return Mt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(pt));const lt=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(lt,ht),z.compileShader(lt),!z.getShaderParameter(lt,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(lt)}`);z.attachShader(this.program,lt);const xt=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(xt,pt),z.compileShader(xt),!z.getShaderParameter(xt,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(xt)}`);z.attachShader(this.program,xt),this.attributes={};const Dt={};this.numAttributes=N.length;for(let Mt=0;Mt<this.numAttributes;Mt++)N[Mt]&&(z.bindAttribLocation(this.program,Mt,N[Mt]),this.attributes[N[Mt]]=Mt);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(xt),z.deleteShader(lt);for(let Mt=0;Mt<ct.length;Mt++){const Et=ct[Mt];if(Et&&!Dt[Et]){const Pt=z.getUniformLocation(this.program,Et);Pt&&(Dt[Et]=Pt)}}this.fixedUniforms=f(e,Dt),this.terrainUniforms=((Mt,Et)=>({u_depth:new d.bU(Mt,Et.u_depth),u_terrain:new d.bU(Mt,Et.u_terrain),u_terrain_dim:new d.bk(Mt,Et.u_terrain_dim),u_terrain_matrix:new d.bW(Mt,Et.u_terrain_matrix),u_terrain_unpack:new d.bX(Mt,Et.u_terrain_unpack),u_terrain_exaggeration:new d.bk(Mt,Et.u_terrain_exaggeration)}))(e,Dt),this.projectionUniforms=((Mt,Et)=>({u_projection_matrix:new d.bW(Mt,Et.u_projection_matrix),u_projection_tile_mercator_coords:new d.bX(Mt,Et.u_projection_tile_mercator_coords),u_projection_clipping_plane:new d.bX(Mt,Et.u_projection_clipping_plane),u_projection_transition:new d.bk(Mt,Et.u_projection_transition),u_projection_fallback_matrix:new d.bW(Mt,Et.u_projection_fallback_matrix)}))(e,Dt),this.binderUniforms=u?u.getUniforms(e,Dt):[]}draw(e,a,u,f,_,v,T,S,C,z,B,R,N,q,K,J,et,at,ct){const rt=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(f),e.setColorMode(_),e.setCullFace(v),S){e.activeTexture.set(rt.TEXTURE2),rt.bindTexture(rt.TEXTURE_2D,S.depthTexture),e.activeTexture.set(rt.TEXTURE3),rt.bindTexture(rt.TEXTURE_2D,S.texture);for(const pt in this.terrainUniforms)this.terrainUniforms[pt].set(S[pt])}if(C)for(const pt in C)this.projectionUniforms[bu[pt]].set(C[pt]);if(T)for(const pt in this.fixedUniforms)this.fixedUniforms[pt].set(T[pt]);J&&J.setUniforms(e,this.binderUniforms,q,{zoom:K});let ht=0;switch(a){case rt.LINES:ht=2;break;case rt.TRIANGLES:ht=3;break;case rt.LINE_STRIP:ht=1}for(const pt of N.get()){const lt=pt.vaos||(pt.vaos={});(lt[z]||(lt[z]=new Th)).bind(e,this,B,J?J.getPaintVertexBuffers():[],R,pt.vertexOffset,et,at,ct),rt.drawElements(a,pt.primitiveLength*ht,rt.UNSIGNED_SHORT,pt.primitiveOffset*ht*2)}}}function Ll(m,e,a){const u=1/d.aH(a,1,e.transform.tileZoom),f=Math.pow(2,a.tileID.overscaledZ),_=a.tileSize*Math.pow(2,e.transform.tileZoom)/f,v=_*(a.tileID.canonical.x+a.tileID.wrap*f),T=_*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[u,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[v>>16,T>>16],u_pixel_coord_lower:[65535&v,65535&T]}}const Sh=(m,e,a,u)=>{const f=m.style.light,_=f.properties.get("position"),v=[_.x,_.y,_.z],T=d.b_();f.properties.get("anchor")==="viewport"&&d.b$(T,m.transform.bearingInRadians),d.c0(v,v,T);const S=m.transform.transformLightDirection(v),C=f.properties.get("color");return{u_lightpos:v,u_lightpos_globe:S,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+e,u_opacity:a,u_fill_translate:u}},Go=(m,e,a,u,f,_,v)=>d.e(Sh(m,e,a,u),Ll(_,m,v),{u_height_factor:-Math.pow(2,f.overscaledZ)/v.tileSize/8}),Zo=(m,e,a,u)=>d.e(Ll(e,m,a),{u_fill_translate:u}),Ff=(m,e)=>({u_world:m,u_fill_translate:e}),np=(m,e,a,u,f)=>d.e(Zo(m,e,a,f),{u_world:u}),Nf=(m,e,a,u,f)=>{const _=m.transform;let v,T,S=0;if(a.paint.get("circle-pitch-alignment")==="map"){const C=d.aH(e,1,_.zoom);v=!0,T=[C,C],S=C/(d.a3*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*f}else v=!1,T=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:T,u_globe_extrude_scale:S,u_translate:u}},Ec=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),Mh=m=>({u_viewport_size:[m.width,m.height]}),qo=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),Ho=(m,e,a,u)=>{const f=d.aH(m,1,e)/(d.a3*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:d.aH(m,1,e),u_intensity:a,u_globe_extrude_scale:f}},Eh=(m,e,a,u)=>{const f=d.M();d.c1(f,0,m.width,m.height,0,0,1);const _=m.context.gl;return{u_matrix:f,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:a,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}},Ka=(m,e,a)=>{const u=a.paint.get("hillshade-accent-color");let f;switch(a.paint.get("hillshade-method")){case"basic":f=4;break;case"combined":f=1;break;case"igor":f=2;break;case"multidirectional":f=3;break;default:f=0}const _=a.getIlluminationProperties();for(let v=0;v<_.directionRadians.length;v++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[v]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Ch(0,e.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:u,u_method:f,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},Ah=(m,e)=>{const a=e.stride,u=d.M();return d.c1(u,0,d.a3,-d.a3,0,0,1),d.N(u,u,[0,-d.a3,0]),{u_matrix:u,u_image:1,u_dimension:[a,a],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function Ch(m,e){const a=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new d.a5(0,u/a).toLngLat().lat,new d.a5(0,(u+1)/a).toLngLat().lat]}const Xo=(m,e,a=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:m.paint.get("color-relief-opacity")}),kl=(m,e,a,u)=>{const f=m.transform;return{u_translation:zh(m,e,a),u_ratio:u/d.aH(e,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Bl=(m,e,a,u,f)=>d.e(kl(m,e,a,u),{u_image:0,u_image_height:f}),Uf=(m,e,a,u,f)=>{const _=m.transform,v=Ac(e,_);return{u_translation:zh(m,e,a),u_texsize:e.imageAtlasTexture.size,u_ratio:u/d.aH(e,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[v,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},jf=(m,e,a,u,f)=>{const _=Ac(e,m.transform);return d.e(kl(m,e,a,u),{u_tileratio:_,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image:0,u_mix:f.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},Vf=(m,e,a,u,f,_)=>{const v=Ac(e,m.transform);return d.e(kl(m,e,a,u),{u_image:0,u_image_height:_,u_tileratio:v,u_crossfade_from:f.fromScale,u_crossfade_to:f.toScale,u_image_dash:1,u_mix:f.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function Ac(m,e){return 1/d.aH(m,1,e.tileZoom)}function zh(m,e,a){return d.aI(m.transform,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Dh=(m,e,a,u,f)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(_=u.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:Gf(u.paint.get("raster-hue-rotate")),u_coords_top:[f[0].x,f[0].y,f[1].x,f[1].y],u_coords_bottom:[f[3].x,f[3].y,f[2].x,f[2].y]};var _,v};function Gf(m){m*=Math.PI/180;const e=Math.sin(m),a=Math.cos(m);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}const Jn=(m,e,a,u,f,_,v,T,S,C,z,B,R)=>{const N=v.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:N.cameraToCenterDistance,u_pitch:N.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:N.width/N.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:T,u_coord_matrix:S,u_is_text:+z,u_pitch_with_map:+u,u_is_along_line:f,u_is_variable_anchor:_,u_texsize:B,u_texture:0,u_translation:C,u_pitched_scale:R}},Ur=(m,e,a,u,f,_,v,T,S,C,z,B,R,N)=>{const q=v.transform;return d.e(Jn(m,e,a,u,f,_,v,T,S,C,z,B,N),{u_gamma_scale:u?Math.cos(q.pitch*Math.PI/180)*q.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},Cc=(m,e,a,u,f,_,v,T,S,C,z,B,R)=>d.e(Ur(m,e,a,u,f,_,v,T,S,C,!0,z,0,R),{u_texsize_icon:B,u_texture_icon:1}),zc=(m,e)=>({u_opacity:m,u_color:e}),Dc=(m,e,a,u,f)=>d.e(function(_,v,T,S){const C=T.imageManager.getPattern(_.from.toString()),z=T.imageManager.getPattern(_.to.toString()),{width:B,height:R}=T.imageManager.getPixelSize(),N=Math.pow(2,S.tileID.overscaledZ),q=S.tileSize*Math.pow(2,T.transform.tileZoom)/N,K=q*(S.tileID.canonical.x+S.tileID.wrap*N),J=q*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:C.tl,u_pattern_br_a:C.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[B,R],u_mix:v.t,u_pattern_size_a:C.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/d.aH(S,1,T.transform.tileZoom),u_pixel_coord_upper:[K>>16,J>>16],u_pixel_coord_lower:[65535&K,65535&J]}}(a,f,e,u),{u_opacity:m}),Pc=(m,e)=>{},wu={fillExtrusion:(m,e)=>({u_lightpos:new d.bY(m,e.u_lightpos),u_lightpos_globe:new d.bY(m,e.u_lightpos_globe),u_lightintensity:new d.bk(m,e.u_lightintensity),u_lightcolor:new d.bY(m,e.u_lightcolor),u_vertical_gradient:new d.bk(m,e.u_vertical_gradient),u_opacity:new d.bk(m,e.u_opacity),u_fill_translate:new d.bZ(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new d.bY(m,e.u_lightpos),u_lightpos_globe:new d.bY(m,e.u_lightpos_globe),u_lightintensity:new d.bk(m,e.u_lightintensity),u_lightcolor:new d.bY(m,e.u_lightcolor),u_vertical_gradient:new d.bk(m,e.u_vertical_gradient),u_height_factor:new d.bk(m,e.u_height_factor),u_opacity:new d.bk(m,e.u_opacity),u_fill_translate:new d.bZ(m,e.u_fill_translate),u_image:new d.bU(m,e.u_image),u_texsize:new d.bZ(m,e.u_texsize),u_pixel_coord_upper:new d.bZ(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bZ(m,e.u_pixel_coord_lower),u_scale:new d.bY(m,e.u_scale),u_fade:new d.bk(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new d.bZ(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new d.bU(m,e.u_image),u_texsize:new d.bZ(m,e.u_texsize),u_pixel_coord_upper:new d.bZ(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bZ(m,e.u_pixel_coord_lower),u_scale:new d.bY(m,e.u_scale),u_fade:new d.bk(m,e.u_fade),u_fill_translate:new d.bZ(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new d.bZ(m,e.u_world),u_fill_translate:new d.bZ(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new d.bZ(m,e.u_world),u_image:new d.bU(m,e.u_image),u_texsize:new d.bZ(m,e.u_texsize),u_pixel_coord_upper:new d.bZ(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bZ(m,e.u_pixel_coord_lower),u_scale:new d.bY(m,e.u_scale),u_fade:new d.bk(m,e.u_fade),u_fill_translate:new d.bZ(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new d.bk(m,e.u_camera_to_center_distance),u_scale_with_map:new d.bU(m,e.u_scale_with_map),u_pitch_with_map:new d.bU(m,e.u_pitch_with_map),u_extrude_scale:new d.bZ(m,e.u_extrude_scale),u_device_pixel_ratio:new d.bk(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new d.bk(m,e.u_globe_extrude_scale),u_translate:new d.bZ(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new d.bZ(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new d.bZ(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new d.bV(m,e.u_color),u_overlay:new d.bU(m,e.u_overlay),u_overlay_scale:new d.bk(m,e.u_overlay_scale)}),depth:Pc,clippingMask:Pc,heatmap:(m,e)=>({u_extrude_scale:new d.bk(m,e.u_extrude_scale),u_intensity:new d.bk(m,e.u_intensity),u_globe_extrude_scale:new d.bk(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new d.bW(m,e.u_matrix),u_world:new d.bZ(m,e.u_world),u_image:new d.bU(m,e.u_image),u_color_ramp:new d.bU(m,e.u_color_ramp),u_opacity:new d.bk(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new d.bU(m,e.u_image),u_latrange:new d.bZ(m,e.u_latrange),u_exaggeration:new d.bk(m,e.u_exaggeration),u_altitudes:new d.c3(m,e.u_altitudes),u_azimuths:new d.c3(m,e.u_azimuths),u_accent:new d.bV(m,e.u_accent),u_method:new d.bU(m,e.u_method),u_shadows:new d.c2(m,e.u_shadows),u_highlights:new d.c2(m,e.u_highlights)}),hillshadePrepare:(m,e)=>({u_matrix:new d.bW(m,e.u_matrix),u_image:new d.bU(m,e.u_image),u_dimension:new d.bZ(m,e.u_dimension),u_zoom:new d.bk(m,e.u_zoom),u_unpack:new d.bX(m,e.u_unpack)}),colorRelief:(m,e)=>({u_image:new d.bU(m,e.u_image),u_unpack:new d.bX(m,e.u_unpack),u_dimension:new d.bZ(m,e.u_dimension),u_elevation_stops:new d.bU(m,e.u_elevation_stops),u_color_stops:new d.bU(m,e.u_color_stops),u_color_ramp_size:new d.bU(m,e.u_color_ramp_size),u_opacity:new d.bk(m,e.u_opacity)}),line:(m,e)=>({u_translation:new d.bZ(m,e.u_translation),u_ratio:new d.bk(m,e.u_ratio),u_device_pixel_ratio:new d.bk(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.bZ(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new d.bZ(m,e.u_translation),u_ratio:new d.bk(m,e.u_ratio),u_device_pixel_ratio:new d.bk(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.bZ(m,e.u_units_to_pixels),u_image:new d.bU(m,e.u_image),u_image_height:new d.bk(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new d.bZ(m,e.u_translation),u_texsize:new d.bZ(m,e.u_texsize),u_ratio:new d.bk(m,e.u_ratio),u_device_pixel_ratio:new d.bk(m,e.u_device_pixel_ratio),u_image:new d.bU(m,e.u_image),u_units_to_pixels:new d.bZ(m,e.u_units_to_pixels),u_scale:new d.bY(m,e.u_scale),u_fade:new d.bk(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new d.bZ(m,e.u_translation),u_ratio:new d.bk(m,e.u_ratio),u_device_pixel_ratio:new d.bk(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.bZ(m,e.u_units_to_pixels),u_image:new d.bU(m,e.u_image),u_mix:new d.bk(m,e.u_mix),u_tileratio:new d.bk(m,e.u_tileratio),u_crossfade_from:new d.bk(m,e.u_crossfade_from),u_crossfade_to:new d.bk(m,e.u_crossfade_to),u_lineatlas_width:new d.bk(m,e.u_lineatlas_width),u_lineatlas_height:new d.bk(m,e.u_lineatlas_height)}),lineGradientSDF:(m,e)=>({u_translation:new d.bZ(m,e.u_translation),u_ratio:new d.bk(m,e.u_ratio),u_device_pixel_ratio:new d.bk(m,e.u_device_pixel_ratio),u_units_to_pixels:new d.bZ(m,e.u_units_to_pixels),u_image:new d.bU(m,e.u_image),u_image_height:new d.bk(m,e.u_image_height),u_tileratio:new d.bk(m,e.u_tileratio),u_crossfade_from:new d.bk(m,e.u_crossfade_from),u_crossfade_to:new d.bk(m,e.u_crossfade_to),u_image_dash:new d.bU(m,e.u_image_dash),u_mix:new d.bk(m,e.u_mix),u_lineatlas_width:new d.bk(m,e.u_lineatlas_width),u_lineatlas_height:new d.bk(m,e.u_lineatlas_height)}),raster:(m,e)=>({u_tl_parent:new d.bZ(m,e.u_tl_parent),u_scale_parent:new d.bk(m,e.u_scale_parent),u_buffer_scale:new d.bk(m,e.u_buffer_scale),u_fade_t:new d.bk(m,e.u_fade_t),u_opacity:new d.bk(m,e.u_opacity),u_image0:new d.bU(m,e.u_image0),u_image1:new d.bU(m,e.u_image1),u_brightness_low:new d.bk(m,e.u_brightness_low),u_brightness_high:new d.bk(m,e.u_brightness_high),u_saturation_factor:new d.bk(m,e.u_saturation_factor),u_contrast_factor:new d.bk(m,e.u_contrast_factor),u_spin_weights:new d.bY(m,e.u_spin_weights),u_coords_top:new d.bX(m,e.u_coords_top),u_coords_bottom:new d.bX(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new d.bU(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bU(m,e.u_is_size_feature_constant),u_size_t:new d.bk(m,e.u_size_t),u_size:new d.bk(m,e.u_size),u_camera_to_center_distance:new d.bk(m,e.u_camera_to_center_distance),u_pitch:new d.bk(m,e.u_pitch),u_rotate_symbol:new d.bU(m,e.u_rotate_symbol),u_aspect_ratio:new d.bk(m,e.u_aspect_ratio),u_fade_change:new d.bk(m,e.u_fade_change),u_label_plane_matrix:new d.bW(m,e.u_label_plane_matrix),u_coord_matrix:new d.bW(m,e.u_coord_matrix),u_is_text:new d.bU(m,e.u_is_text),u_pitch_with_map:new d.bU(m,e.u_pitch_with_map),u_is_along_line:new d.bU(m,e.u_is_along_line),u_is_variable_anchor:new d.bU(m,e.u_is_variable_anchor),u_texsize:new d.bZ(m,e.u_texsize),u_texture:new d.bU(m,e.u_texture),u_translation:new d.bZ(m,e.u_translation),u_pitched_scale:new d.bk(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new d.bU(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bU(m,e.u_is_size_feature_constant),u_size_t:new d.bk(m,e.u_size_t),u_size:new d.bk(m,e.u_size),u_camera_to_center_distance:new d.bk(m,e.u_camera_to_center_distance),u_pitch:new d.bk(m,e.u_pitch),u_rotate_symbol:new d.bU(m,e.u_rotate_symbol),u_aspect_ratio:new d.bk(m,e.u_aspect_ratio),u_fade_change:new d.bk(m,e.u_fade_change),u_label_plane_matrix:new d.bW(m,e.u_label_plane_matrix),u_coord_matrix:new d.bW(m,e.u_coord_matrix),u_is_text:new d.bU(m,e.u_is_text),u_pitch_with_map:new d.bU(m,e.u_pitch_with_map),u_is_along_line:new d.bU(m,e.u_is_along_line),u_is_variable_anchor:new d.bU(m,e.u_is_variable_anchor),u_texsize:new d.bZ(m,e.u_texsize),u_texture:new d.bU(m,e.u_texture),u_gamma_scale:new d.bk(m,e.u_gamma_scale),u_device_pixel_ratio:new d.bk(m,e.u_device_pixel_ratio),u_is_halo:new d.bU(m,e.u_is_halo),u_translation:new d.bZ(m,e.u_translation),u_pitched_scale:new d.bk(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new d.bU(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.bU(m,e.u_is_size_feature_constant),u_size_t:new d.bk(m,e.u_size_t),u_size:new d.bk(m,e.u_size),u_camera_to_center_distance:new d.bk(m,e.u_camera_to_center_distance),u_pitch:new d.bk(m,e.u_pitch),u_rotate_symbol:new d.bU(m,e.u_rotate_symbol),u_aspect_ratio:new d.bk(m,e.u_aspect_ratio),u_fade_change:new d.bk(m,e.u_fade_change),u_label_plane_matrix:new d.bW(m,e.u_label_plane_matrix),u_coord_matrix:new d.bW(m,e.u_coord_matrix),u_is_text:new d.bU(m,e.u_is_text),u_pitch_with_map:new d.bU(m,e.u_pitch_with_map),u_is_along_line:new d.bU(m,e.u_is_along_line),u_is_variable_anchor:new d.bU(m,e.u_is_variable_anchor),u_texsize:new d.bZ(m,e.u_texsize),u_texsize_icon:new d.bZ(m,e.u_texsize_icon),u_texture:new d.bU(m,e.u_texture),u_texture_icon:new d.bU(m,e.u_texture_icon),u_gamma_scale:new d.bk(m,e.u_gamma_scale),u_device_pixel_ratio:new d.bk(m,e.u_device_pixel_ratio),u_is_halo:new d.bU(m,e.u_is_halo),u_translation:new d.bZ(m,e.u_translation),u_pitched_scale:new d.bk(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new d.bk(m,e.u_opacity),u_color:new d.bV(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new d.bk(m,e.u_opacity),u_image:new d.bU(m,e.u_image),u_pattern_tl_a:new d.bZ(m,e.u_pattern_tl_a),u_pattern_br_a:new d.bZ(m,e.u_pattern_br_a),u_pattern_tl_b:new d.bZ(m,e.u_pattern_tl_b),u_pattern_br_b:new d.bZ(m,e.u_pattern_br_b),u_texsize:new d.bZ(m,e.u_texsize),u_mix:new d.bk(m,e.u_mix),u_pattern_size_a:new d.bZ(m,e.u_pattern_size_a),u_pattern_size_b:new d.bZ(m,e.u_pattern_size_b),u_scale_a:new d.bk(m,e.u_scale_a),u_scale_b:new d.bk(m,e.u_scale_b),u_pixel_coord_upper:new d.bZ(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.bZ(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.bk(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new d.bU(m,e.u_texture),u_ele_delta:new d.bk(m,e.u_ele_delta),u_fog_matrix:new d.bW(m,e.u_fog_matrix),u_fog_color:new d.bV(m,e.u_fog_color),u_fog_ground_blend:new d.bk(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.bk(m,e.u_fog_ground_blend_opacity),u_horizon_color:new d.bV(m,e.u_horizon_color),u_horizon_fog_blend:new d.bk(m,e.u_horizon_fog_blend),u_is_globe_mode:new d.bk(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new d.bk(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new d.bU(m,e.u_texture),u_terrain_coords_id:new d.bk(m,e.u_terrain_coords_id),u_ele_delta:new d.bk(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new d.bk(m,e.u_input),u_output_expected:new d.bk(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new d.bY(m,e.u_sun_pos),u_atmosphere_blend:new d.bk(m,e.u_atmosphere_blend),u_globe_position:new d.bY(m,e.u_globe_position),u_globe_radius:new d.bk(m,e.u_globe_radius),u_inv_proj_matrix:new d.bW(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new d.bV(m,e.u_sky_color),u_horizon_color:new d.bV(m,e.u_horizon_color),u_horizon:new d.bZ(m,e.u_horizon),u_horizon_normal:new d.bZ(m,e.u_horizon_normal),u_sky_horizon_blend:new d.bk(m,e.u_sky_horizon_blend),u_sky_blend:new d.bk(m,e.u_sky_blend)})};class $o{constructor(e,a,u){this.context=e;const f=e.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ao={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ph{constructor(e,a,u,f){this.length=a.length,this.attributes=u,this.itemSize=a.bytesPerElement,this.dynamicDraw=f,this.context=e;const _=e.gl;this.buffer=_.createBuffer(),e.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let u=0;u<this.attributes.length;u++){const f=a.attributes[this.attributes[u].name];f!==void 0&&e.enableVertexAttribArray(f)}}setVertexAttribPointers(e,a,u){for(let f=0;f<this.attributes.length;f++){const _=this.attributes[f],v=a.attributes[_.name];v!==void 0&&e.vertexAttribPointer(v,_.components,e[ao[_.type]],!1,this.itemSize,_.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ei{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ih extends ei{getDefault(){return d.bj.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Zf extends ei{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class so extends ei{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Ol extends ei{getDefault(){return[!0,!0,!0,!0]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ic extends ei{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Tu extends ei{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Qa extends ei{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Su extends ei{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Rc extends ei{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class oo extends ei{getDefault(){return[0,1]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Mu extends ei{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class Fl extends ei{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ua extends ei{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class Rh extends ei{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Lh extends ei{getDefault(){return d.bj.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Eu extends ei{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class tr extends ei{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class Yo extends ei{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Er extends ei{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Ja extends ei{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Nl extends ei{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Au extends ei{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ws extends ei{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class lo extends ei{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class uo extends ei{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Lc extends ei{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ve extends ei{getDefault(){return null}set(e){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ts extends ei{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;const u=this.gl;ta(u)?u.bindVertexArray(e):(a=u.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class rp extends ei{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class jr extends ei{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Wo extends ei{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Sa extends ei{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class qf extends Sa{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Cu extends Sa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ko extends Sa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Ul="Framebuffer is not complete";class zu{constructor(e,a,u,f,_){this.context=e,this.width=a,this.height=u;const v=e.gl,T=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new qf(e,T),f)this.depthAttachment=_?new Ko(e,T):new Cu(e,T);else if(_)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(Ul)}destroy(){const e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class jl{constructor(e){var a,u;if(this.gl=e,this.clearColor=new Ih(this),this.clearDepth=new Zf(this),this.clearStencil=new so(this),this.colorMask=new Ol(this),this.depthMask=new Ic(this),this.stencilMask=new Tu(this),this.stencilFunc=new Qa(this),this.stencilOp=new Su(this),this.stencilTest=new Rc(this),this.depthRange=new oo(this),this.depthTest=new Mu(this),this.depthFunc=new Fl(this),this.blend=new ua(this),this.blendFunc=new Rh(this),this.blendColor=new Lh(this),this.blendEquation=new Eu(this),this.cullFace=new tr(this),this.cullFaceSide=new Yo(this),this.frontFace=new Er(this),this.program=new Ja(this),this.activeTexture=new Nl(this),this.viewport=new Au(this),this.bindFramebuffer=new ws(this),this.bindRenderbuffer=new lo(this),this.bindTexture=new uo(this),this.bindVertexBuffer=new Lc(this),this.bindElementBuffer=new Ve(this),this.bindVertexArray=new Ts(this),this.pixelStoreUnpack=new rp(this),this.pixelStoreUnpackPremultiplyAlpha=new jr(this),this.pixelStoreUnpackFlipY=new Wo(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),ta(e)){this.HALF_FLOAT=e.HALF_FLOAT;const f=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:f?.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:f?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const f=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=f?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new $o(this,e,a)}createVertexBuffer(e,a,u){return new Ph(this,e,a,u)}createRenderbuffer(e,a,u){const f=this.gl,_=f.createRenderbuffer();return this.bindRenderbuffer.set(_),f.renderbufferStorage(f.RENDERBUFFER,e,a,u),this.bindRenderbuffer.set(null),_}createFramebuffer(e,a,u,f){return new zu(this,e,a,u,f)}clear({color:e,depth:a,stencil:u}){const f=this.gl;let _=0;e&&(_|=f.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(_|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),u!==void 0&&(_|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),f.clear(_)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.bL(e.blendFunction,Oi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return ta(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return ta(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let co;function Ar(m,e,a,u,f){const _=m.context,v=m.transform,T=_.gl,S=m.useProgram("collisionBox"),C=[];let z=0,B=0;for(let et=0;et<u.length;et++){const at=u[et],ct=e.getTile(at).getBucket(a);if(!ct)continue;const rt=f?ct.textCollisionBox:ct.iconCollisionBox,ht=ct.collisionCircleArray;ht.length>0&&(C.push({circleArray:ht,circleOffset:B,coord:at}),z+=ht.length/4,B=z),rt&&S.draw(_,T.LINES,Be.disabled,Qe.disabled,m.colorModeForRenderPass(),Ze.disabled,Ec(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(at),v.getProjectionData({overscaledTileID:at,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,null,m.transform.zoom,null,null,rt.collisionVertexBuffer)}if(!f||!C.length)return;const R=m.useProgram("collisionCircle"),N=new d.c4;N.resize(4*z),N._trim();let q=0;for(const et of C)for(let at=0;at<et.circleArray.length/4;at++){const ct=4*at,rt=et.circleArray[ct+0],ht=et.circleArray[ct+1],pt=et.circleArray[ct+2],lt=et.circleArray[ct+3];N.emplace(q++,rt,ht,pt,lt,0),N.emplace(q++,rt,ht,pt,lt,1),N.emplace(q++,rt,ht,pt,lt,2),N.emplace(q++,rt,ht,pt,lt,3)}(!co||co.length<2*z)&&(co=function(et){const at=2*et,ct=new d.c6;ct.resize(at),ct._trim();for(let rt=0;rt<at;rt++){const ht=6*rt;ct.uint16[ht+0]=4*rt+0,ct.uint16[ht+1]=4*rt+1,ct.uint16[ht+2]=4*rt+2,ct.uint16[ht+3]=4*rt+2,ct.uint16[ht+4]=4*rt+3,ct.uint16[ht+5]=4*rt+0}return ct}(z));const K=_.createIndexBuffer(co,!0),J=_.createVertexBuffer(N,d.c5.members,!0);for(const et of C){const at=Mh(m.transform);R.draw(_,T.TRIANGLES,Be.disabled,Qe.disabled,m.colorModeForRenderPass(),Ze.disabled,at,m.style.map.terrain&&m.style.map.terrain.getTerrainData(et.coord),null,a.id,J,K,d.aR.simpleSegment(0,2*et.circleOffset,et.circleArray.length,et.circleArray.length/2),null,m.transform.zoom,null,null,null)}J.destroy(),K.destroy()}const Qo=d.am(new Float32Array(16));function Ss(m,e,a,u,f,_){const{horizontalAlign:v,verticalAlign:T}=d.aM(m);return new d.P((-(v-.5)*e/f+u[0])*_,(-(T-.5)*a/f+u[1])*_)}function Jo(m,e,a,u,f,_){const v=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let T=u.mult(_);a||(T=T.rotate(-f));const S=v.add(T);return se(S.x,S.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(a){const T=hr(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),S=Math.atan(T.y/T.x)+(T.x<0?Math.PI:0);return m.add(u.rotate(S))}return m.add(u)}function ho(m,e,a,u,f,_,v,T,S,C,z,B){const R=m.text.placedSymbolArray,N=m.text.dynamicLayoutVertexArray,q=m.icon.dynamicLayoutVertexArray,K={};N.clear();for(let J=0;J<R.length;J++){const et=R.get(J),at=et.hidden||!et.crossTileID||m.allowVerticalPlacement&&!et.placedOrientation?null:u[et.crossTileID];if(at){const ct=new d.P(et.anchorX,et.anchorY),rt={getElevation:B,width:f.width,height:f.height,pitchedLabelPlaneMatrix:_,pitchWithMap:a,transform:f,tileAnchorPoint:ct,translation:C,unwrappedTileID:z},ht=a?ba(ct.x,ct.y,rt):hr(ct.x,ct.y,rt),pt=be(f.cameraToCenterDistance,ht.signedDistanceFromCamera);let lt=d.au(m.textSizeData,T,et)*pt/d.aG;a&&(lt*=m.tilePixelRatio/v);const{width:xt,height:Dt,anchor:Mt,textOffset:Et,textBoxScale:Pt}=at,Kt=Ss(Mt,xt,Dt,Et,Pt,lt),Jt=f.getPitchedTextCorrection(ct.x+C[0],ct.y+C[1],z),Gt=Jo(ht.point,rt,e,Kt,-f.bearingInRadians,Jt),ce=m.allowVerticalPlacement&&et.placedOrientation===d.at.vertical?Math.PI/2:0;for(let me=0;me<et.numGlyphs;me++)d.aA(N,Gt,ce);S&&et.associatedIconIndex>=0&&(K[et.associatedIconIndex]={shiftedAnchor:Gt,angle:ce})}else Tr(et.numGlyphs,N)}if(S){q.clear();const J=m.icon.placedSymbolArray;for(let et=0;et<J.length;et++){const at=J.get(et);if(at.hidden)Tr(at.numGlyphs,q);else{const ct=K[et];if(ct)for(let rt=0;rt<at.numGlyphs;rt++)d.aA(q,ct.shiftedAnchor,ct.angle);else Tr(at.numGlyphs,q)}}m.icon.dynamicLayoutVertexBuffer.updateData(q)}m.text.dynamicLayoutVertexBuffer.updateData(N)}function er(m,e,a){return a.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Cr(m,e,a,u,f,_,v,T,S,C,z,B,R){const N=m.context,q=N.gl,K=m.transform,J=T==="map",et=S==="map",at=T!=="viewport"&&a.layout.get("symbol-placement")!=="point",ct=J&&!et&&!at,rt=!a.layout.get("symbol-sort-key").isConstant();let ht=!1;const pt=m.getDepthModeForSublayer(0,Be.ReadOnly),lt=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),xt=[],Dt=K.getCircleRadiusCorrection();for(const Mt of u){const Et=e.getTile(Mt),Pt=Et.getBucket(a);if(!Pt)continue;const Kt=f?Pt.text:Pt.icon;if(!Kt||!Kt.segments.get().length||!Kt.hasVisibleVertices)continue;const Jt=Kt.programConfigurations.get(a.id),Gt=f||Pt.sdfIcons,ce=f?Pt.textSizeData:Pt.iconSizeData,me=et||K.pitch!==0,ci=m.useProgram(er(Gt,f,Pt),Jt),Ui=d.as(ce,K.zoom),Li=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Mt);let ji,Si,xn,Mi,Dn=[0,0],on=null;if(f)Si=Et.glyphAtlasTexture,xn=q.LINEAR,ji=Et.glyphAtlasTexture.size,Pt.iconsInText&&(Dn=Et.imageAtlasTexture.size,on=Et.imageAtlasTexture,Mi=me||m.options.rotating||m.options.zooming||ce.kind==="composite"||ce.kind==="camera"?q.LINEAR:q.NEAREST);else{const Vi=a.layout.get("icon-size").constantOr(0)!==1||Pt.iconsNeedLinear;Si=Et.imageAtlasTexture,xn=Gt||m.options.rotating||m.options.zooming||Vi||me?q.LINEAR:q.NEAREST,ji=Et.imageAtlasTexture.size}const bn=d.aH(Et,1,m.transform.zoom),Hn=mn(J,m.transform,bn),Pa=d.M();d.av(Pa,Hn);const Is=ui(et,J,m.transform,bn),Rs=d.aI(K,Et,_,v),Ia=K.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),ia=lt&&Pt.hasTextData(),To=a.layout.get("icon-text-fit")!=="none"&&ia&&Pt.hasIconData();if(at){const Vi=m.style.map.terrain?(Qi,ki)=>m.style.map.terrain.getElevation(Mt,Qi,ki):null,vi=a.layout.get("text-rotation-alignment")==="map";Bo(Pt,m,f,Hn,Pa,et,C,vi,Mt.toUnwrapped(),K.width,K.height,Rs,Vi)}const Ls=f&&lt||To,qr=at||Ls?Qo:et?Hn:m.transform.clipSpaceToPixelsMatrix,ks=Gt&&a.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Bs;Bs=Gt?Pt.iconsInText?Cc(ce.kind,Ui,ct,et,at,Ls,m,qr,Is,Rs,ji,Dn,Dt):Ur(ce.kind,Ui,ct,et,at,Ls,m,qr,Is,Rs,f,ji,0,Dt):Jn(ce.kind,Ui,ct,et,at,Ls,m,qr,Is,Rs,f,ji,Dt);const Os={program:ci,buffers:Kt,uniformValues:Bs,projectionData:Ia,atlasTexture:Si,atlasTextureIcon:on,atlasInterpolation:xn,atlasInterpolationIcon:Mi,isSDF:Gt,hasHalo:ks};if(rt&&Pt.canOverlap){ht=!0;const Vi=Kt.segments.get();for(const vi of Vi)xt.push({segments:new d.aR([vi]),sortKey:vi.sortKey,state:Os,terrainData:Li})}else xt.push({segments:Kt.segments,sortKey:0,state:Os,terrainData:Li})}ht&&xt.sort((Mt,Et)=>Mt.sortKey-Et.sortKey);for(const Mt of xt){const Et=Mt.state;if(N.activeTexture.set(q.TEXTURE0),Et.atlasTexture.bind(Et.atlasInterpolation,q.CLAMP_TO_EDGE),Et.atlasTextureIcon&&(N.activeTexture.set(q.TEXTURE1),Et.atlasTextureIcon&&Et.atlasTextureIcon.bind(Et.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),Et.isSDF){const Pt=Et.uniformValues;Et.hasHalo&&(Pt.u_is_halo=1,Ms(Et.buffers,Mt.segments,a,m,Et.program,pt,z,B,Pt,Et.projectionData,Mt.terrainData)),Pt.u_is_halo=0}Ms(Et.buffers,Mt.segments,a,m,Et.program,pt,z,B,Et.uniformValues,Et.projectionData,Mt.terrainData)}}function Ms(m,e,a,u,f,_,v,T,S,C,z){const B=u.context;f.draw(B,B.gl.TRIANGLES,_,v,T,Ze.backCCW,S,z,C,a.id,m.layoutVertexBuffer,m.indexBuffer,e,a.paint,u.transform.zoom,m.programConfigurations.get(a.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Vr(m,e,a,u,f){const _=m.context,v=_.gl,T=Qe.disabled,S=new Oi([v.ONE,v.ONE],d.bj.transparent,[!0,!0,!0,!0]),C=e.getBucket(a);if(!C)return;const z=u.key;let B=a.heatmapFbos.get(z);B||(B=Ma(_,e.tileSize,e.tileSize),a.heatmapFbos.set(z,B)),_.bindFramebuffer.set(B.framebuffer),_.viewport.set([0,0,e.tileSize,e.tileSize]),_.clear({color:d.bj.transparent});const R=C.programConfigurations.get(a.id),N=m.useProgram("heatmap",R,!f),q=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),K=m.style.map.terrain.getTerrainData(u);N.draw(_,v.TRIANGLES,Be.disabled,T,S,Ze.disabled,Ho(e,m.transform.zoom,a.paint.get("heatmap-intensity"),1),K,q,a.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,a.paint,m.transform.zoom,R)}function ts(m,e,a,u,f){const _=m.context,v=_.gl,T=m.transform;_.setColorMode(m.colorModeForRenderPass());const S=Vl(_,e),C=a.key,z=e.heatmapFbos.get(C);if(!z)return;_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,z.colorAttachment.get()),_.activeTexture.set(v.TEXTURE1),S.bind(v.LINEAR,v.CLAMP_TO_EDGE);const B=T.getProjectionData({overscaledTileID:a,applyTerrainMatrix:f,applyGlobeMatrix:!u});m.useProgram("heatmapTexture").draw(_,v.TRIANGLES,Be.disabled,Qe.disabled,m.colorModeForRenderPass(),Ze.disabled,Eh(m,e,0,1),null,B,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,T.zoom),z.destroy(),e.heatmapFbos.delete(C)}function Ma(m,e,a){var u,f;const _=m.gl,v=_.createTexture();_.bindTexture(_.TEXTURE_2D,v),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const T=(u=m.HALF_FLOAT)!==null&&u!==void 0?u:_.UNSIGNED_BYTE,S=(f=m.RGBA16F)!==null&&f!==void 0?f:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,S,e,a,0,_.RGBA,T,null);const C=m.createFramebuffer(e,a,!1,!1);return C.colorAttachment.set(v),C}function Vl(m,e){return e.colorRampTexture||(e.colorRampTexture=new d.T(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function Gl(m,e,a,u,f,_,v,T){let S=256;if(f.stepInterpolant){const C=e.getSource().maxzoom,z=v.canonical.z===C?Math.ceil(1<<m.transform.maxZoom-v.canonical.z):1;S=d.ai(d.c8(_.maxLineLength/d.a3*1024*z),256,a.maxTextureSize)}return T.gradient=d.c9({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:S,image:T.gradient||void 0,clips:_.lineClipsArray}),T.texture?T.texture.update(T.gradient):T.texture=new d.T(a,T.gradient,u.RGBA),T.version=f.gradientVersion,T.texture}function kc(m,e,a,u,f){m.activeTexture.set(e.TEXTURE0),a.imageAtlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE),u.updatePaintBuffers(f)}function kh(m,e,a,u,f,_){(f||m.lineAtlas.dirty)&&(e.activeTexture.set(a.TEXTURE0),m.lineAtlas.bind(e)),u.updatePaintBuffers(_)}function zn(m,e,a,u,f,_,v){const T=_.gradients[f.id];let S=T.texture;f.gradientVersion!==T.version&&(S=Gl(m,e,a,u,f,_,v,T)),a.activeTexture.set(u.TEXTURE0),S.bind(f.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE)}function Fi(m,e,a,u,f,_,v,T,S){const C=_.gradients[f.id];let z=C.texture;f.gradientVersion!==C.version&&(z=Gl(m,e,a,u,f,_,v,C)),a.activeTexture.set(u.TEXTURE0),z.bind(f.stepInterpolant?u.NEAREST:u.LINEAR,u.CLAMP_TO_EDGE),a.activeTexture.set(u.TEXTURE1),m.lineAtlas.bind(a),T.updatePaintBuffers(S)}function ii(m,e,a,u,f){if(!a||!u||!u.imageAtlas)return;const _=u.imageAtlas.patternPositions;let v=_[a.to.toString()],T=_[a.from.toString()];if(!v&&T&&(v=T),!T&&v&&(T=v),!v||!T){const S=f.getPaintProperty(e);v=_[S],T=_[S]}v&&T&&m.setConstantPatternPositions(v,T)}function es(m,e,a,u,f,_,v,T){const S=m.context.gl,C="fill-pattern",z=a.paint.get(C),B=z&&z.constantOr(1),R=a.getCrossfadeParameters();let N,q,K,J,et;const at=m.transform,ct=a.paint.get("fill-translate"),rt=a.paint.get("fill-translate-anchor");v?(q=B&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=S.LINES):(q=B?"fillPattern":"fill",N=S.TRIANGLES);const ht=z.constantOr(null);for(const pt of u){const lt=e.getTile(pt);if(B&&!lt.patternsLoaded())continue;const xt=lt.getBucket(a);if(!xt)continue;const Dt=xt.programConfigurations.get(a.id),Mt=m.useProgram(q,Dt),Et=m.style.map.terrain&&m.style.map.terrain.getTerrainData(pt);B&&(m.context.activeTexture.set(S.TEXTURE0),lt.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Dt.updatePaintBuffers(R)),ii(Dt,C,ht,lt,a);const Pt=at.getProjectionData({overscaledTileID:pt,applyGlobeMatrix:!T,applyTerrainMatrix:!0}),Kt=d.aI(at,lt,ct,rt);if(v){J=xt.indexBuffer2,et=xt.segments2;const Gt=[S.drawingBufferWidth,S.drawingBufferHeight];K=q==="fillOutlinePattern"&&B?np(m,R,lt,Gt,Kt):Ff(Gt,Kt)}else J=xt.indexBuffer,et=xt.segments,K=B?Zo(m,R,lt,Kt):{u_fill_translate:Kt};const Jt=m.stencilModeForClipping(pt);Mt.draw(m.context,N,f,Jt,_,Ze.backCCW,K,Et,Pt,a.id,xt.layoutVertexBuffer,J,et,a.paint,m.transform.zoom,Dt)}}function ri(m,e,a,u,f,_,v,T){const S=m.context,C=S.gl,z="fill-extrusion-pattern",B=a.paint.get(z),R=B.constantOr(1),N=a.getCrossfadeParameters(),q=a.paint.get("fill-extrusion-opacity"),K=B.constantOr(null),J=m.transform;for(const et of u){const at=e.getTile(et),ct=at.getBucket(a);if(!ct)continue;const rt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(et),ht=ct.programConfigurations.get(a.id),pt=m.useProgram(R?"fillExtrusionPattern":"fillExtrusion",ht);R&&(m.context.activeTexture.set(C.TEXTURE0),at.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ht.updatePaintBuffers(N));const lt=J.getProjectionData({overscaledTileID:et,applyGlobeMatrix:!T,applyTerrainMatrix:!0});ii(ht,z,K,at,a);const xt=d.aI(J,at,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Dt=a.paint.get("fill-extrusion-vertical-gradient"),Mt=R?Go(m,Dt,q,xt,et,N,at):Sh(m,Dt,q,xt);pt.draw(S,S.gl.TRIANGLES,f,_,v,Ze.backCCW,Mt,rt,lt,a.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,a.paint,m.transform.zoom,ht,m.style.map.terrain&&ct.centroidVertexBuffer)}}function Ea(m,e,a,u,f,_,v,T,S){var C;const z=m.style.projection,B=m.context,R=m.transform,N=B.gl,q=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],K=m.useProgram("hillshade",null,!1,q),J=!m.options.moving;for(const et of u){const at=e.getTile(et),ct=at.fbo;if(!ct)continue;const rt=z.getMeshFromTileID(B,et.canonical,T,!0,"raster"),ht=(C=m.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(et);B.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,ct.colorAttachment.get());const pt=R.getProjectionData({overscaledTileID:et,aligned:J,applyGlobeMatrix:!S,applyTerrainMatrix:!0});K.draw(B,N.TRIANGLES,_,f[et.overscaledZ],v,Ze.backCCW,Ka(m,at,a),ht,pt,a.id,rt.vertexBuffer,rt.indexBuffer,rt.segments)}}function yn(m,e,a,u,f,_,v,T,S){var C;const z=m.style.projection,B=m.context,R=m.transform,N=B.gl,q=m.useProgram("colorRelief"),K=!m.options.moving;let J=!0,et=0;for(const at of u){const ct=e.getTile(at),rt=ct.dem;if(J){const Mt=N.getParameter(N.MAX_TEXTURE_SIZE),{elevationTexture:Et,colorTexture:Pt}=a.getColorRampTextures(B,Mt,rt.getUnpackVector());B.activeTexture.set(N.TEXTURE1),Et.bind(N.NEAREST,N.CLAMP_TO_EDGE),B.activeTexture.set(N.TEXTURE4),Pt.bind(N.LINEAR,N.CLAMP_TO_EDGE),J=!1,et=Et.size[0]}if(!rt||!rt.data)continue;const ht=rt.stride,pt=rt.getPixels();if(B.activeTexture.set(N.TEXTURE0),B.pixelStoreUnpackPremultiplyAlpha.set(!1),ct.demTexture=ct.demTexture||m.getTileTexture(ht),ct.demTexture){const Mt=ct.demTexture;Mt.update(pt,{premultiply:!1}),Mt.bind(N.LINEAR,N.CLAMP_TO_EDGE)}else ct.demTexture=new d.T(B,pt,N.RGBA,{premultiply:!1}),ct.demTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const lt=z.getMeshFromTileID(B,at.canonical,T,!0,"raster"),xt=(C=m.style.map.terrain)===null||C===void 0?void 0:C.getTerrainData(at),Dt=R.getProjectionData({overscaledTileID:at,aligned:K,applyGlobeMatrix:!S,applyTerrainMatrix:!0});q.draw(B,N.TRIANGLES,_,f[at.overscaledZ],v,Ze.backCCW,Xo(a,ct.dem,et),xt,Dt,a.id,lt.vertexBuffer,lt.indexBuffer,lt.segments)}}const Zl=[new d.P(0,0),new d.P(d.a3,0),new d.P(d.a3,d.a3),new d.P(0,d.a3)];function fo(m,e,a,u,f,_,v,T,S=!1,C=!1){const z=u[u.length-1].overscaledZ,B=m.context,R=B.gl,N=m.useProgram("raster"),q=m.transform,K=m.style.projection,J=m.colorModeForRenderPass(),et=!m.options.moving,at=a.paint.get("raster-opacity"),ct=a.paint.get("raster-resampling"),rt=a.paint.get("raster-fade-duration"),ht=!!m.style.map.terrain;for(const pt of u){const lt=m.getDepthModeForSublayer(pt.overscaledZ-z,at===1?Be.ReadWrite:Be.ReadOnly,R.LESS),xt=e.getTile(pt),Dt=ct==="nearest"?R.NEAREST:R.LINEAR;B.activeTexture.set(R.TEXTURE0),xt.texture.bind(Dt,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),B.activeTexture.set(R.TEXTURE1);const{parentTile:Mt,parentScaleBy:Et,parentTopLeft:Pt,fadeValues:Kt}=tl(xt,e,rt,ht);xt.fadeOpacity=Kt.tileOpacity,Mt?(Mt.fadeOpacity=Kt.parentTileOpacity,Mt.texture.bind(Dt,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST)):xt.texture.bind(Dt,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),xt.texture.useMipmap&&B.extTextureFilterAnisotropic&&m.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const Jt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(pt),Gt=q.getProjectionData({overscaledTileID:pt,aligned:et,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),ce=Dh(Pt,Et,Kt.fadeMix,a,T),me=K.getMeshFromTileID(B,pt.canonical,_,v,"raster");N.draw(B,R.TRIANGLES,lt,f?f[pt.overscaledZ]:Qe.disabled,J,S?Ze.frontCCW:Ze.backCCW,ce,Jt,Gt,a.id,me.vertexBuffer,me.indexBuffer,me.segments)}}function tl(m,e,a,u){const f={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||u)return f;if(m.fadingParentID){const _=e.getLoadedTile(m.fadingParentID);if(!_)return f;const v=Math.pow(2,_.tileID.overscaledZ-m.tileID.overscaledZ),T=[m.tileID.canonical.x*v%1,m.tileID.canonical.y*v%1],S=function(C,z,B){const R=he(),N=(R-z.timeAdded)/B,q=C.fadingDirection===mt.Incoming,K=d.ai((R-C.timeAdded)/B,0,1),J=d.ai(1-N,0,1),et=q?K:J;return{tileOpacity:et,parentTileOpacity:q?J:K,fadeMix:{opacity:1,mix:1-et}}}(m,_,a);return{parentTile:_,parentScaleBy:v,parentTopLeft:T,fadeValues:S}}if(m.selfFading){const _=function(v,T){const S=(he()-v.timeAdded)/T,C=d.ai(S,0,1);return{tileOpacity:C,fadeMix:{opacity:C,mix:0}}}(m,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:_}}return f}const ca=new d.bj(1,0,0,1),Du=new d.bj(0,1,0,1),Es=new d.bj(0,0,1,1),Pu=new d.bj(1,0,1,1),po=new d.bj(0,1,1,1);function Aa(m,e,a,u){ea(m,0,e+a/2,m.transform.width,a,u)}function is(m,e,a,u){ea(m,e-a/2,0,a,m.transform.height,u)}function ea(m,e,a,u,f,_){const v=m.context,T=v.gl;T.enable(T.SCISSOR_TEST),T.scissor(e*m.pixelRatio,a*m.pixelRatio,u*m.pixelRatio,f*m.pixelRatio),v.clear({color:_}),T.disable(T.SCISSOR_TEST)}function Bc(m,e,a){const u=m.context,f=u.gl,_=m.useProgram("debug"),v=Be.disabled,T=Qe.disabled,S=m.colorModeForRenderPass(),C="$debug",z=m.style.map.terrain&&m.style.map.terrain.getTerrainData(a);u.activeTexture.set(f.TEXTURE0);const B=e.getTileByID(a.key).latestRawTileData,R=Math.floor((B&&B.byteLength||0)/1024),N=e.getTile(a).tileSize,q=512/Math.min(N,512)*(a.overscaledZ/m.transform.zoom)*.5;let K=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(K+=` => ${a.overscaledZ}`),function(et,at){et.initDebugOverlayCanvas();const ct=et.debugOverlayCanvas,rt=et.context.gl,ht=et.debugOverlayCanvas.getContext("2d");ht.clearRect(0,0,ct.width,ct.height),ht.shadowColor="white",ht.shadowBlur=2,ht.lineWidth=1.5,ht.strokeStyle="white",ht.textBaseline="top",ht.font="bold 36px Open Sans, sans-serif",ht.fillText(at,5,5),ht.strokeText(at,5,5),et.debugOverlayTexture.update(ct),et.debugOverlayTexture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE)}(m,`${K} ${R}kB`);const J=m.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(u,f.TRIANGLES,v,T,Oi.alphaBlended,Ze.disabled,qo(d.bj.transparent,q),null,J,C,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),_.draw(u,f.LINE_STRIP,v,T,S,Ze.disabled,qo(d.bj.red),z,J,C,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function ns(m,e,a,u){const{isRenderingGlobe:f}=u,_=m.context,v=_.gl,T=m.transform,S=m.colorModeForRenderPass(),C=m.getDepthModeFor3D(),z=m.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,m.width,m.height]);for(const B of a){const R=e.getTerrainMesh(B.tileID),N=m.renderToTexture.getTexture(B),q=e.getTerrainData(B.tileID);_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,N.texture);const K=e.getMeshFrameDelta(T.zoom),J=T.calculateFogMatrix(B.tileID.toUnwrapped()),et=Vo(K,J,m.style.sky,T.pitch,f),at=T.getProjectionData({overscaledTileID:B.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(_,v.TRIANGLES,C,Qe.disabled,S,Ze.backCCW,et,q,at,"terrain",R.vertexBuffer,R.indexBuffer,R.segments)}}function mo(m,e){if(!e.mesh){const a=new d.aQ;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const u=new d.aS;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),e.mesh=new Ha(m.createVertexBuffer(a,cn.members),m.createIndexBuffer(u),d.aR.simpleSegment(0,0,a.length,u.length))}return e.mesh}class Iu{constructor(e,a){this.context=new jl(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.am(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ge.maxUnderzooming+Ge.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Uo}resize(e,a,u){if(this.width=Math.floor(e*u),this.height=Math.floor(a*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style._order)this.style._layers[f].resize()}setup(){const e=this.context,a=new d.aQ;a.emplaceBack(0,0),a.emplaceBack(d.a3,0),a.emplaceBack(0,d.a3),a.emplaceBack(d.a3,d.a3),this.tileExtentBuffer=e.createVertexBuffer(a,cn.members),this.tileExtentSegments=d.aR.simpleSegment(0,0,4,2);const u=new d.aQ;u.emplaceBack(0,0),u.emplaceBack(d.a3,0),u.emplaceBack(0,d.a3),u.emplaceBack(d.a3,d.a3),this.debugBuffer=e.createVertexBuffer(u,cn.members),this.debugSegments=d.aR.simpleSegment(0,0,4,5);const f=new d.cb;f.emplaceBack(0,0,0,0),f.emplaceBack(d.a3,0,d.a3,0),f.emplaceBack(0,d.a3,0,d.a3),f.emplaceBack(d.a3,d.a3,d.a3,d.a3),this.rasterBoundsBuffer=e.createVertexBuffer(f,Wa.members),this.rasterBoundsSegments=d.aR.simpleSegment(0,0,4,2);const _=new d.aQ;_.emplaceBack(0,0),_.emplaceBack(d.a3,0),_.emplaceBack(0,d.a3),_.emplaceBack(d.a3,d.a3),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(_,cn.members),this.rasterBoundsSegmentsPosOnly=d.aR.simpleSegment(0,0,4,5);const v=new d.aQ;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(v,cn.members),this.viewportSegments=d.aR.simpleSegment(0,0,4,2);const T=new d.cc;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(T);const S=new d.aS;S.emplaceBack(1,0,2),S.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(S);const C=this.context.gl;this.stencilClearMode=new Qe({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.tileExtentMesh=new Ha(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=d.M();d.c1(u,0,this.width,this.height,0,0,1),d.O(u,u,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const f={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(e,a.TRIANGLES,Be.disabled,this.stencilClearMode,Oi.disabled,Ze.disabled,null,null,f,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a,u){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source,this.nextStencilID+a.length>256&&this.clearStencil();const f=this.context;f.setColorMode(Oi.disabled),f.setDepthMode(Be.disabled);const _={};for(const v of a)_[v.key]=this.nextStencilID++;this._renderTileMasks(_,a,u,!0),this._renderTileMasks(_,a,u,!1),this._tileClippingMaskIDs=_}_renderTileMasks(e,a,u,f){const _=this.context,v=_.gl,T=this.style.projection,S=this.transform,C=this.useProgram("clippingMask");for(const z of a){const B=e[z.key],R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),N=T.getMeshFromTileID(this.context,z.canonical,f,!0,"stencil"),q=S.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!u,applyTerrainMatrix:!0});C.draw(_,v.TRIANGLES,Be.disabled,new Qe({func:v.ALWAYS,mask:0},B,255,v.KEEP,v.KEEP,v.REPLACE),Oi.disabled,u?Ze.disabled:Ze.backCCW,null,R,q,"$clipping",N.vertexBuffer,N.indexBuffer,N.segments)}}_renderTilesDepthBuffer(){const e=this.context,a=e.gl,u=this.style.projection,f=this.transform,_=this.useProgram("depth"),v=this.getDepthModeFor3D(),T=Le(f,{tileSize:f.tileSize});for(const S of T){const C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S),z=u.getMeshFromTileID(this.context,S.canonical,!0,!0,"raster"),B=f.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(e,a.TRIANGLES,v,Qe.disabled,Oi.disabled,Ze.backCCW,null,C,B,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,a=this.context.gl;return new Qe({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){const a=this.context.gl;return new Qe({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const a=this.context.gl,u=e.sort((v,T)=>T.overscaledZ-v.overscaledZ),f=u[u.length-1].overscaledZ,_=u[0].overscaledZ-f+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let T=0;T<_;T++)v[T+f]=new Qe({func:a.GEQUAL,mask:255},T+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=_,[v,u]}return[{[f]:Qe.disabled},u]}stencilConfigForOverlapTwoPass(e){const a=this.context.gl,u=e.sort((v,T)=>T.overscaledZ-v.overscaledZ),f=u[u.length-1].overscaledZ,_=u[0].overscaledZ-f+1;if(this.clearStencil(),_>1){const v={},T={};for(let S=0;S<_;S++)v[S+f]=new Qe({func:a.GREATER,mask:255},_+1+S,255,a.KEEP,a.KEEP,a.REPLACE),T[S+f]=new Qe({func:a.GREATER,mask:255},1+S,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*_+1,[v,T,u]}return this.nextStencilID=3,[{[f]:new Qe({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[f]:new Qe({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Oi([e.CONSTANT_COLOR,e.ONE],new d.bj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Oi.unblended:Oi.alphaBlended}getDepthModeForSublayer(e,a,u){if(!this.opaquePassEnabledForLayer())return Be.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Be(u||this.context.gl.LEQUAL,a,[f,f])}getDepthModeFor3D(){return new Be(this.context.gl.LEQUAL,Be.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){var u,f;this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(he()),this.imageManager.beginFrame();const _=this.style._order,v=this.style.tileManagers,T={},S={},C={},z={isRenderingToTexture:!1,isRenderingGlobe:((u=e.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const R in v){const N=v[R];N.used&&N.prepare(this.context),T[R]=N.getVisibleCoordinates(!1),S[R]=T[R].slice().reverse(),C[R]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<_.length;R++)if(this.style._layers[_[R]].is3D()){this.opaquePassCutoff=R;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const R of _){const N=this.style._layers[R];if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const q=S[N.source];(N.type==="custom"||q.length)&&this.renderLayer(this,v[N.source],N,q,z)}if((f=this.style.projection)===null||f===void 0||f.updateGPUdependent({context:this.context,useProgram:R=>this.useProgram(R)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?d.bj.black:d.bj.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(R,N){const q=R.context,K=q.gl,J=((pt,lt,xt)=>{const Dt=Math.cos(lt.rollInRadians),Mt=Math.sin(lt.rollInRadians),Et=Tt(lt),Pt=lt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:pt.properties.get("sky-color"),u_horizon_color:pt.properties.get("horizon-color"),u_horizon:[(lt.width/2-Et*Mt)*xt,(lt.height/2+Et*Dt)*xt],u_horizon_normal:[-Mt,Dt],u_sky_horizon_blend:pt.properties.get("sky-horizon-blend")*lt.height/2*xt,u_sky_blend:Pt}})(N,R.style.map.transform,R.pixelRatio),et=new Be(K.LEQUAL,Be.ReadWrite,[0,1]),at=Qe.disabled,ct=R.colorModeForRenderPass(),rt=R.useProgram("sky"),ht=mo(q,N);rt.draw(q,K.TRIANGLES,et,at,ct,Ze.disabled,J,null,void 0,"sky",ht.vertexBuffer,ht.indexBuffer,ht.segments)}(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[_[this.currentLayer]],N=v[R.source],q=T[R.source];this._renderTileClippingMasks(R,q,!1),this.renderLayer(this,N,R,q,z)}this.renderPass="translucent";let B=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const R=this.style._layers[_[this.currentLayer]],N=v[R.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(R,z))continue;this.opaquePassEnabledForLayer()||B||(B=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const q=(R.type==="symbol"?C:S)[R.source];this._renderTileClippingMasks(R,T[R.source],!!this.renderToTexture),this.renderLayer(this,N,R,q,z)}if(z.isRenderingGlobe&&function(R,N,q){const K=R.context,J=K.gl,et=R.useProgram("atmosphere"),at=new Be(J.LEQUAL,Be.ReadOnly,[0,1]),ct=R.transform,rt=function(Pt,Kt){const Jt=Pt.properties.get("position"),Gt=[-Jt.x,-Jt.y,-Jt.z],ce=d.am(new Float64Array(16));return Pt.properties.get("anchor")==="map"&&(d.ba(ce,ce,Kt.rollInRadians),d.bb(ce,ce,-Kt.pitchInRadians),d.ba(ce,ce,Kt.bearingInRadians),d.bb(ce,ce,Kt.center.lat*Math.PI/180),d.bD(ce,ce,-Kt.center.lng*Math.PI/180)),d.ca(Gt,Gt,ce),Gt}(q,R.transform),ht=ct.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),pt=N.properties.get("atmosphere-blend")*ht.projectionTransition;if(pt===0)return;const lt=xc(ct.worldSize,ct.center.lat),xt=ct.inverseProjectionMatrix,Dt=new Float64Array(4);Dt[3]=1,d.aB(Dt,Dt,ct.modelViewProjectionMatrix),Dt[0]/=Dt[3],Dt[1]/=Dt[3],Dt[2]/=Dt[3],Dt[3]=1,d.aB(Dt,Dt,xt),Dt[0]/=Dt[3],Dt[1]/=Dt[3],Dt[2]/=Dt[3],Dt[3]=1;const Mt=((Pt,Kt,Jt,Gt,ce)=>({u_sun_pos:Pt,u_atmosphere_blend:Kt,u_globe_position:Jt,u_globe_radius:Gt,u_inv_proj_matrix:ce}))(rt,pt,[Dt[0],Dt[1],Dt[2]],lt,xt),Et=mo(K,N);et.draw(K,J.TRIANGLES,at,Qe.disabled,Oi.alphaBlended,Ze.disabled,Mt,null,null,"atmosphere",Et.vertexBuffer,Et.indexBuffer,Et.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const R=function(N,q){let K=null;const J=Object.values(N._layers).flatMap(rt=>rt.source&&!rt.isHidden(q)?[N.tileManagers[rt.source]]:[]),et=J.filter(rt=>rt.getSource().type==="vector"),at=J.filter(rt=>rt.getSource().type!=="vector"),ct=rt=>{(!K||K.getSource().maxzoom<rt.getSource().maxzoom)&&(K=rt)};return et.forEach(rt=>ct(rt)),K||at.forEach(rt=>ct(rt)),K}(this.style,this.transform.zoom);R&&function(N,q,K){for(let J=0;J<K.length;J++)Bc(N,q,K[J])}(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const N=R.transform.padding;Aa(R,R.transform.height-(N.top||0),3,ca),Aa(R,N.bottom||0,3,Du),is(R,N.left||0,3,Es),is(R,R.transform.width-(N.right||0),3,Pu);const q=R.transform.centerPoint;(function(K,J,et,at){ea(K,J-1,et-10,2,20,at),ea(K,J-10,et-1,20,2,at)})(R,q.x,R.transform.height-q.y,po)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let f=this.terrainFacilitator.dirty;f||(f=e?!d.cd(a,u):!d.ce(a,u)),f||(f=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),f&&(d.cf(a,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,v){const T=_.context,S=T.gl,C=_.transform,z=Oi.unblended,B=new Be(S.LEQUAL,Be.ReadWrite,[0,1]),R=v.tileManager.getRenderableTiles(),N=_.useProgram("terrainDepth");T.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),T.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),T.clear({color:d.bj.transparent,depth:1});for(const q of R){const K=v.getTerrainMesh(q.tileID),J=v.getTerrainData(q.tileID),et=C.getProjectionData({overscaledTileID:q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),at={u_ele_delta:v.getMeshFrameDelta(C.zoom)};N.draw(T,S.TRIANGLES,B,Qe.disabled,z,Ze.backCCW,at,J,et,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}T.bindFramebuffer.set(null),T.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,v){const T=_.context,S=T.gl,C=_.transform,z=Oi.unblended,B=new Be(S.LEQUAL,Be.ReadWrite,[0,1]),R=v.getCoordsTexture(),N=v.tileManager.getRenderableTiles(),q=_.useProgram("terrainCoords");T.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),T.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),T.clear({color:d.bj.transparent,depth:1}),v.coordsIndex=[];for(const K of N){const J=v.getTerrainMesh(K.tileID),et=v.getTerrainData(K.tileID);T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,R.texture);const at={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(C.zoom)},ct=C.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});q.draw(T,S.TRIANGLES,B,Qe.disabled,z,Ze.backCCW,at,et,ct,"terrain",J.vertexBuffer,J.indexBuffer,J.segments),v.coordsIndex.push(K.tileID.key)}T.bindFramebuffer.set(null),T.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(e,a,u,f,_){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(f||[]).length)&&(this.id=u.id,d.cg(u)?function(v,T,S,C,z,B){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=B,N=Qe.disabled,q=v.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(K,J,et,at,ct,rt,ht,pt,lt){const xt=J.transform,Dt=J.style.map.terrain,Mt=ct==="map",Et=rt==="map";for(const Pt of K){const Kt=at.getTile(Pt),Jt=Kt.getBucket(et);if(!Jt||!Jt.text||!Jt.text.segments.get().length)continue;const Gt=d.as(Jt.textSizeData,xt.zoom),ce=d.aH(Kt,1,J.transform.zoom),me=mn(Mt,J.transform,ce),ci=et.layout.get("icon-text-fit")!=="none"&&Jt.hasIconData();if(Gt){const Ui=Math.pow(2,xt.zoom-Kt.tileID.overscaledZ),Li=Dt?(ji,Si)=>Dt.getElevation(Pt,ji,Si):null;ho(Jt,Mt,Et,lt,xt,me,Ui,Gt,ci,d.aI(xt,Kt,ht,pt),Pt.toUnwrapped(),Li)}}}(C,v,S,T,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),z),S.paint.get("icon-opacity").constantOr(1)!==0&&Cr(v,T,S,C,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),N,q,R),S.paint.get("text-opacity").constantOr(1)!==0&&Cr(v,T,S,C,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),N,q,R),T.map.showCollisionBoxes&&(Ar(v,T,S,C,!0),Ar(v,T,S,C,!1))}(e,a,u,f,this.style.placement.variableOffsets,_):d.ch(u)?function(v,T,S,C,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:B}=z,R=S.paint.get("circle-opacity"),N=S.paint.get("circle-stroke-width"),q=S.paint.get("circle-stroke-opacity"),K=!S.layout.get("circle-sort-key").isConstant();if(R.constantOr(1)===0&&(N.constantOr(1)===0||q.constantOr(1)===0))return;const J=v.context,et=J.gl,at=v.transform,ct=v.getDepthModeForSublayer(0,Be.ReadOnly),rt=Qe.disabled,ht=v.colorModeForRenderPass(),pt=[],lt=at.getCircleRadiusCorrection();for(let xt=0;xt<C.length;xt++){const Dt=C[xt],Mt=T.getTile(Dt),Et=Mt.getBucket(S);if(!Et)continue;const Pt=S.paint.get("circle-translate"),Kt=S.paint.get("circle-translate-anchor"),Jt=d.aI(at,Mt,Pt,Kt),Gt=Et.programConfigurations.get(S.id),ce=v.useProgram("circle",Gt),me=Et.layoutVertexBuffer,ci=Et.indexBuffer,Ui=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Dt),Li={programConfiguration:Gt,program:ce,layoutVertexBuffer:me,indexBuffer:ci,uniformValues:Nf(v,Mt,S,Jt,lt),terrainData:Ui,projectionData:at.getProjectionData({overscaledTileID:Dt,applyGlobeMatrix:!B,applyTerrainMatrix:!0})};if(K){const ji=Et.segments.get();for(const Si of ji)pt.push({segments:new d.aR([Si]),sortKey:Si.sortKey,state:Li})}else pt.push({segments:Et.segments,sortKey:0,state:Li})}K&&pt.sort((xt,Dt)=>xt.sortKey-Dt.sortKey);for(const xt of pt){const{programConfiguration:Dt,program:Mt,layoutVertexBuffer:Et,indexBuffer:Pt,uniformValues:Kt,terrainData:Jt,projectionData:Gt}=xt.state;Mt.draw(J,et.TRIANGLES,ct,rt,ht,Ze.backCCW,Kt,Jt,Gt,S.id,Et,Pt,xt.segments,S.paint,v.transform.zoom,Dt)}}(e,a,u,f,_):d.ci(u)?function(v,T,S,C,z){if(S.paint.get("heatmap-opacity")===0)return;const B=v.context,{isRenderingToTexture:R,isRenderingGlobe:N}=z;if(v.style.map.terrain){for(const q of C){const K=T.getTile(q);T.hasRenderableParent(q)||(v.renderPass==="offscreen"?Vr(v,K,S,q,N):v.renderPass==="translucent"&&ts(v,S,q,R,N))}B.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?function(q,K,J,et){const at=q.context,ct=at.gl,rt=q.transform,ht=Qe.disabled,pt=new Oi([ct.ONE,ct.ONE],d.bj.transparent,[!0,!0,!0,!0]);(function(lt,xt,Dt){const Mt=lt.gl;lt.activeTexture.set(Mt.TEXTURE1),lt.viewport.set([0,0,xt.width/4,xt.height/4]);let Et=Dt.heatmapFbos.get(d.c7);Et?(Mt.bindTexture(Mt.TEXTURE_2D,Et.colorAttachment.get()),lt.bindFramebuffer.set(Et.framebuffer)):(Et=Ma(lt,xt.width/4,xt.height/4),Dt.heatmapFbos.set(d.c7,Et))})(at,q,J),at.clear({color:d.bj.transparent});for(let lt=0;lt<et.length;lt++){const xt=et[lt];if(K.hasRenderableParent(xt))continue;const Dt=K.getTile(xt),Mt=Dt.getBucket(J);if(!Mt)continue;const Et=Mt.programConfigurations.get(J.id),Pt=q.useProgram("heatmap",Et),Kt=rt.getProjectionData({overscaledTileID:xt,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Jt=rt.getCircleRadiusCorrection();Pt.draw(at,ct.TRIANGLES,Be.disabled,ht,pt,Ze.backCCW,Ho(Dt,rt.zoom,J.paint.get("heatmap-intensity"),Jt),null,Kt,J.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,J.paint,rt.zoom,Et)}at.viewport.set([0,0,q.width,q.height])}(v,T,S,C):v.renderPass==="translucent"&&function(q,K){const J=q.context,et=J.gl;J.setColorMode(q.colorModeForRenderPass());const at=K.heatmapFbos.get(d.c7);at&&(J.activeTexture.set(et.TEXTURE0),et.bindTexture(et.TEXTURE_2D,at.colorAttachment.get()),J.activeTexture.set(et.TEXTURE1),Vl(J,K).bind(et.LINEAR,et.CLAMP_TO_EDGE),q.useProgram("heatmapTexture").draw(J,et.TRIANGLES,Be.disabled,Qe.disabled,q.colorModeForRenderPass(),Ze.disabled,Eh(q,K,0,1),null,null,K.id,q.viewportBuffer,q.quadTriangleIndexBuffer,q.viewportSegments,K.paint,q.transform.zoom))}(v,S)}(e,a,u,f,_):d.cj(u)?function(v,T,S,C,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:B}=z,R=S.paint.get("line-opacity"),N=S.paint.get("line-width");if(R.constantOr(1)===0||N.constantOr(1)===0)return;const q=v.getDepthModeForSublayer(0,Be.ReadOnly),K=v.colorModeForRenderPass(),J=S.paint.get("line-dasharray"),et=J.constantOr(1),at=S.paint.get("line-pattern"),ct=at.constantOr(1),rt=S.paint.get("line-gradient"),ht=S.getCrossfadeParameters();let pt;pt=ct?"linePattern":et&&rt?"lineGradientSDF":et?"lineSDF":rt?"lineGradient":"line";const lt=v.context,xt=lt.gl,Dt=v.transform;let Mt=!0;for(const Et of C){const Pt=T.getTile(Et);if(ct&&!Pt.patternsLoaded())continue;const Kt=Pt.getBucket(S);if(!Kt)continue;const Jt=Kt.programConfigurations.get(S.id),Gt=v.context.program.get(),ce=v.useProgram(pt,Jt),me=Mt||ce.program!==Gt,ci=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Et),Ui=at.constantOr(null),Li=J&&J.constantOr(null);if(Ui&&Pt.imageAtlas){const Dn=Pt.imageAtlas,on=Dn.patternPositions[Ui.to.toString()],bn=Dn.patternPositions[Ui.from.toString()];on&&bn&&Jt.setConstantPatternPositions(on,bn)}else if(Li){const Dn=S.layout.get("line-cap")==="round",on=v.lineAtlas.getDash(Li.to,Dn),bn=v.lineAtlas.getDash(Li.from,Dn);Jt.setConstantDashPositions(on,bn)}const ji=Dt.getProjectionData({overscaledTileID:Et,applyGlobeMatrix:!B,applyTerrainMatrix:!0}),Si=Dt.getPixelScale();let xn;ct?(xn=Uf(v,Pt,S,Si,ht),kc(lt,xt,Pt,Jt,ht)):et&&rt?(xn=Vf(v,Pt,S,Si,ht,Kt.lineClipsArray.length),Fi(v,T,lt,xt,S,Kt,Et,Jt,ht)):et?(xn=jf(v,Pt,S,Si,ht),kh(v,lt,xt,Jt,me,ht)):rt?(xn=Bl(v,Pt,S,Si,Kt.lineClipsArray.length),zn(v,T,lt,xt,S,Kt,Et)):xn=kl(v,Pt,S,Si);const Mi=v.stencilModeForClipping(Et);ce.draw(lt,xt.TRIANGLES,q,Mi,K,Ze.disabled,xn,ci,ji,S.id,Kt.layoutVertexBuffer,Kt.indexBuffer,Kt.segments,S.paint,v.transform.zoom,Jt,Kt.layoutVertexBuffer2),Mt=!1}}(e,a,u,f,_):d.ck(u)?function(v,T,S,C,z){const B=S.paint.get("fill-color"),R=S.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const{isRenderingToTexture:N}=z,q=v.colorModeForRenderPass(),K=S.paint.get("fill-pattern"),J=v.opaquePassEnabledForLayer()&&!K.constantOr(1)&&B.constantOr(d.bj.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===J){const et=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?Be.ReadWrite:Be.ReadOnly);es(v,T,S,C,et,q,!1,N)}if(v.renderPass==="translucent"&&S.paint.get("fill-antialias")){const et=v.getDepthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Be.ReadOnly);es(v,T,S,C,et,q,!0,N)}}(e,a,u,f,_):d.cl(u)?function(v,T,S,C,z){const B=S.paint.get("fill-extrusion-opacity");if(B===0)return;const{isRenderingToTexture:R}=z;if(v.renderPass==="translucent"){const N=new Be(v.context.gl.LEQUAL,Be.ReadWrite,v.depthRangeFor3D);if(B!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))ri(v,T,S,C,N,Qe.disabled,Oi.disabled,R),ri(v,T,S,C,N,v.stencilModeFor3D(),v.colorModeForRenderPass(),R);else{const q=v.colorModeForRenderPass();ri(v,T,S,C,N,Qe.disabled,q,R)}}}(e,a,u,f,_):d.cm(u)?function(v,T,S,C,z){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const{isRenderingToTexture:B}=z,R=v.context,N=v.style.projection.useSubdivision,q=v.getDepthModeForSublayer(0,Be.ReadOnly),K=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(J,et,at,ct,rt,ht,pt){const lt=J.context,xt=lt.gl;for(const Dt of at){const Mt=et.getTile(Dt),Et=Mt.dem;if(!Et||!Et.data||!Mt.needsHillshadePrepare)continue;const Pt=Et.dim,Kt=Et.stride,Jt=Et.getPixels();if(lt.activeTexture.set(xt.TEXTURE1),lt.pixelStoreUnpackPremultiplyAlpha.set(!1),Mt.demTexture=Mt.demTexture||J.getTileTexture(Kt),Mt.demTexture){const ce=Mt.demTexture;ce.update(Jt,{premultiply:!1}),ce.bind(xt.NEAREST,xt.CLAMP_TO_EDGE)}else Mt.demTexture=new d.T(lt,Jt,xt.RGBA,{premultiply:!1}),Mt.demTexture.bind(xt.NEAREST,xt.CLAMP_TO_EDGE);lt.activeTexture.set(xt.TEXTURE0);let Gt=Mt.fbo;if(!Gt){const ce=new d.T(lt,{width:Pt,height:Pt,data:null},xt.RGBA);ce.bind(xt.LINEAR,xt.CLAMP_TO_EDGE),Gt=Mt.fbo=lt.createFramebuffer(Pt,Pt,!0,!1),Gt.colorAttachment.set(ce.texture)}lt.bindFramebuffer.set(Gt.framebuffer),lt.viewport.set([0,0,Pt,Pt]),J.useProgram("hillshadePrepare").draw(lt,xt.TRIANGLES,rt,ht,pt,Ze.disabled,Ah(Mt.tileID,Et),null,null,ct.id,J.rasterBoundsBuffer,J.quadTriangleIndexBuffer,J.rasterBoundsSegments),Mt.needsHillshadePrepare=!1}})(v,T,C,S,q,Qe.disabled,K),R.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(N){const[J,et,at]=v.stencilConfigForOverlapTwoPass(C);Ea(v,T,S,at,J,q,K,!1,B),Ea(v,T,S,at,et,q,K,!0,B)}else{const[J,et]=v.getStencilConfigForOverlapAndUpdateStencilID(C);Ea(v,T,S,et,J,q,K,!1,B)}}(e,a,u,f,_):d.cn(u)?function(v,T,S,C,z){if(v.renderPass!=="translucent"||!C.length)return;const{isRenderingToTexture:B}=z,R=v.style.projection.useSubdivision,N=v.getDepthModeForSublayer(0,Be.ReadOnly),q=v.colorModeForRenderPass();if(R){const[K,J,et]=v.stencilConfigForOverlapTwoPass(C);yn(v,T,S,et,K,N,q,!1,B),yn(v,T,S,et,J,N,q,!0,B)}else{const[K,J]=v.getStencilConfigForOverlapAndUpdateStencilID(C);yn(v,T,S,J,K,N,q,!1,B)}}(e,a,u,f,_):d.bO(u)?function(v,T,S,C,z){if(v.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!C.length)return;const{isRenderingToTexture:B}=z,R=T.getSource(),N=v.style.projection.useSubdivision;if(R instanceof kr)fo(v,T,S,C,null,!1,!1,R.tileCoords,R.flippedWindingOrder,B);else if(N){const[q,K,J]=v.stencilConfigForOverlapTwoPass(C);fo(v,T,S,J,q,!1,!0,Zl,!1,B),fo(v,T,S,J,K,!0,!0,Zl,!1,B)}else{const[q,K]=v.getStencilConfigForOverlapAndUpdateStencilID(C);fo(v,T,S,K,q,!1,!0,Zl,!1,B)}}(e,a,u,f,_):d.co(u)?function(v,T,S,C,z){const B=S.paint.get("background-color"),R=S.paint.get("background-opacity");if(R===0)return;const{isRenderingToTexture:N}=z,q=v.context,K=q.gl,J=v.style.projection,et=v.transform,at=et.tileSize,ct=S.paint.get("background-pattern");if(v.isPatternMissing(ct))return;const rt=!ct&&B.a===1&&R===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==rt)return;const ht=Qe.disabled,pt=v.getDepthModeForSublayer(0,rt==="opaque"?Be.ReadWrite:Be.ReadOnly),lt=v.colorModeForRenderPass(),xt=v.useProgram(ct?"backgroundPattern":"background"),Dt=C||Le(et,{tileSize:at,terrain:v.style.map.terrain});ct&&(q.activeTexture.set(K.TEXTURE0),v.imageManager.bind(v.context));const Mt=S.getCrossfadeParameters();for(const Et of Dt){const Pt=et.getProjectionData({overscaledTileID:Et,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),Kt=ct?Dc(R,v,ct,{tileID:Et,tileSize:at},Mt):zc(R,B),Jt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Et),Gt=J.getMeshFromTileID(q,Et.canonical,!1,!0,"raster");xt.draw(q,K.TRIANGLES,pt,ht,lt,Ze.backCCW,Kt,Jt,Pt,S.id,Gt.vertexBuffer,Gt.indexBuffer,Gt.segments)}}(e,0,u,f,_):d.cp(u)&&function(v,T,S,C){const{isRenderingGlobe:z}=C,B=v.context,R=S.implementation,N=v.style.projection,q=v.transform,K=q.getProjectionDataForCustomLayer(z),J={farZ:q.farZ,nearZ:q.nearZ,fov:q.fov*Math.PI/180,modelViewProjectionMatrix:q.modelViewProjectionMatrix,projectionMatrix:q.projectionMatrix,shaderData:{variantName:N.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${N.shaderPreludeCode.vertexSource}`,define:N.shaderDefine},defaultProjectionData:K},et=R.renderingMode?R.renderingMode:"2d";if(v.renderPass==="offscreen"){const at=R.prerender;at&&(v.setCustomLayerDefaults(),B.setColorMode(v.colorModeForRenderPass()),at.call(R,B.gl,J),B.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),B.setColorMode(v.colorModeForRenderPass()),B.setStencilMode(Qe.disabled);const at=et==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,Be.ReadOnly);B.setDepthMode(at),R.render(B.gl,J),B.setDirty(),v.setBaseState(),B.bindFramebuffer.set(null)}}(e,0,u,_))}saveTileTexture(e){const a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const a=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!a||!u}useProgram(e,a,u=!1,f=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,v=this.style.projection,T=u?Sr.projectionMercator:v.shaderPreludeCode,S=u?gn:v.shaderDefine,C=e+(a?a.cacheKey:"")+`/${u?_n:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(f?`/${f.join("/")}`:"");return this.cache[C]||(this.cache[C]=new Of(this.context,Sr[e],a,wu[e],this._showOverdrawInspector,_,T,S,f)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var e,a;if(this._tileTextures){for(const u in this._tileTextures){const f=this._tileTextures[u];if(f)for(const _ of f)_.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((e=this.tileExtentMesh.vertexBuffer)===null||e===void 0||e.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const u in this.cache){const f=this.cache[u];f&&f.program&&this.context.gl.deleteProgram(f.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}function As(m,e){let a,u=!1,f=null,_=null;const v=()=>{f=null,u&&(m.apply(_,a),f=setTimeout(v,e),u=!1)};return(...T)=>(u=!0,_=this,a=T,f||v(),f)}class Bn{constructor(e){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let u;return a.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(u=f)}),(u&&u[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:u,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const u=a.join("/");let f=u;f.split("&").length>0&&(f=f.split("&")[0]),this._hashName&&(f=`${this._hashName}=${u}`);let _=window.location.hash.replace(f,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let v=window.location.href.replace(/(#.+)?$/,_);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=As(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const a=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,f=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,f),v=Math.round(a.lng*_)/_,T=Math.round(a.lat*_)/_,S=this._map.getBearing(),C=this._map.getPitch();let z="";if(z+=e?`/${v}/${T}/${u}`:`${u}/${T}/${v}`,(S||C)&&(z+="/"+Math.round(10*S)/10),C&&(z+=`/${Math.round(C)}`),this._hashName){const B=this._hashName;let R=!1;const N=window.location.hash.slice(1).split("&").map(q=>{const K=q.split("=")[0];return K===B?(R=!0,`${K}=${z}`):q}).filter(q=>q);return R||N.push(`${B}=${z}`),`#${N.join("&")}`}return`#${z}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new d.U(+e[2],+e[1])}catch{return!1}const a=+e[0],u=+(e[3]||0),f=+(e[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&u>=-180&&u<=180&&f>=this._map.getMinPitch()&&f<=this._map.getMaxPitch()}}const Cs={linearity:.3,easing:d.cq(0,0,.3,1)},Bh=d.e({deceleration:2500,maxSpeed:1400},Cs),Hf=d.e({deceleration:20,maxSpeed:1400},Cs),Xf=d.e({deceleration:1e3,maxSpeed:360},Cs),Oc=d.e({deceleration:1e3,maxSpeed:90},Cs),vn=d.e({deceleration:1e3,maxSpeed:360},Cs);class Gr{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:he(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,a=he();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)a.zoom+=_.zoomDelta||0,a.bearing+=_.bearingDelta||0,a.pitch+=_.pitchDelta||0,a.roll+=_.rollDelta||0,_.panDelta&&a.pan._add(_.panDelta),_.around&&(a.around=_.around),_.pinchAround&&(a.pinchAround=_.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(a.pan.mag()){const _=rs(a.pan.mag(),u,d.e({},Bh,e||{})),v=a.pan.mult(_.amount/a.pan.mag()),T=this._map.cameraHelper.handlePanInertia(v,this._map.transform);f.center=T.easingCenter,f.offset=T.easingOffset,On(f,_)}if(a.zoom){const _=rs(a.zoom,u,Hf);f.zoom=this._map.transform.zoom+_.amount,On(f,_)}if(a.bearing){const _=rs(a.bearing,u,Xf);f.bearing=this._map.transform.bearing+d.ai(_.amount,-179,179),On(f,_)}if(a.pitch){const _=rs(a.pitch,u,Oc);f.pitch=this._map.transform.pitch+_.amount,On(f,_)}if(a.roll){const _=rs(a.roll,u,vn);f.roll=this._map.transform.roll+d.ai(_.amount,-179,179),On(f,_)}if(f.zoom||f.bearing){const _=a.pinchAround===void 0?a.around:a.pinchAround;f.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),d.e(f,{noMoveStart:!0})}}function On(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function rs(m,e,a){const{maxSpeed:u,linearity:f,deceleration:_}=a,v=d.ai(m*f/(e/1e3),-u,u),T=Math.abs(v)/(_*f);return{easing:a.easing,duration:1e3*T,amount:v*(T/2)}}class Hi extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,u,f={}){u=u instanceof MouseEvent?u:new MouseEvent(e,u);const _=Ct.mousePos(a.getCanvas(),u),v=a.unproject(_);super(e,d.e({point:_,lngLat:v,originalEvent:u},f)),this._defaultPrevented=!1,this.target=a}}class as extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,u){const f=e==="touchend"?u.changedTouches:u.touches,_=Ct.touchPos(a.getCanvasContainer(),f),v=_.map(S=>a.unproject(S)),T=_.reduce((S,C,z,B)=>S.add(C.div(B.length)),new d.P(0,0));super(e,{points:_,point:T,lngLats:v,lngLat:a.unproject(T),originalEvent:u}),this._defaultPrevented=!1}}class ha extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class ap{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new ha(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new Hi(e.type,this._map,e))}mouseup(e){this._map.fire(new Hi(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Hi(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Hi(e.type,this._map,e))}mouseover(e){this._map.fire(new Hi(e.type,this._map,e))}mouseout(e){this._map.fire(new Hi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new as(e.type,this._map,e))}touchmove(e){this._map.fire(new as(e.type,this._map,e))}touchend(e){this._map.fire(new as(e.type,this._map,e))}touchcancel(e){this._map.fire(new as(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $f{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Hi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Hi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ru{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(d.P.convert(e),this._map.terrain)}}class Oh{constructor(e,a){this._map=e,this._tr=new Ru(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&(Ct.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;const u=a;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const f=this._startPos;this._lastPos=u,this._box||(this._box=Ct.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const _=Math.min(f.x,u.x),v=Math.max(f.x,u.x),T=Math.min(f.y,u.y),S=Math.max(f.y,u.y);Ct.setTransform(this._box,`translate(${_}px,${T}px)`),this._box.style.width=v-_+"px",this._box.style.height=S-T+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;const u=this._startPos,f=a;if(this.reset(),Ct.suppressClick(),u.x!==f.x||u.y!==f.y)return this._map.fire(new d.l("boxzoomend",{originalEvent:e})),{cameraAnimation:_=>_.fitScreenCoordinates(u,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Ct.remove(this._box),this._box=null),Ct.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new d.l(e,{originalEvent:a}))}}function ss(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);const a={};for(let u=0;u<m.length;u++)a[m[u].identifier]=e[u];return a}class el{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=function(f){const _=new d.P(0,0);for(const v of f)_._add(v);return _.div(f.length)}(a),this.touches=ss(u,a)))}touchmove(e,a,u){if(this.aborted||!this.centroid)return;const f=ss(u,a);for(const _ in this.touches){const v=f[_];(!v||v.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(e,a,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Zr{constructor(e){this.singleTap=new el(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,u){this.singleTap.touchstart(e,a,u)}touchmove(e,a,u){this.singleTap.touchmove(e,a,u)}touchend(e,a,u){const f=this.singleTap.touchend(e,a,u);if(f){const _=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(f)<30;if(_&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class le{constructor(e){this._tr=new Ru(e),this._zoomIn=new Zr({numTouches:1,numTaps:2}),this._zoomOut=new Zr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,u){this._zoomIn.touchstart(e,a,u),this._zoomOut.touchstart(e,a,u)}touchmove(e,a,u){this._zoomIn.touchmove(e,a,u),this._zoomOut.touchmove(e,a,u)}touchend(e,a,u){const f=this._zoomIn.touchend(e,a,u),_=this._zoomOut.touchend(e,a,u),v=this._tr;return f?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(f)},{originalEvent:e})}):_?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(_)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ca{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const f=Array.isArray(a)?a[0]:a;return!this._moved&&f.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(u,f))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&Ct.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Lu=0,ku=2,go={[Lu]:1,[ku]:2};class os{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const a=Ct.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(a,u){const f=go[u];return a.buttons===void 0||(a.buttons&f)!==f}(e,this._eventButton)}isValidEndEvent(e){return Ct.mouseButton(e)===this._eventButton}}class Fc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class il{constructor(e=new os({checkCorrectEvent:()=>!0}),a=new Fc){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(e,a,u){return e instanceof MouseEvent?a(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?u(e):void 0}startMove(e){this._executeRelevantHandler(e,a=>this.mouseMoveStateManager.startMove(a),a=>this.oneFingerTouchMoveStateManager.startMove(a))}endMove(e){this._executeRelevantHandler(e,a=>this.mouseMoveStateManager.endMove(a),a=>this.oneFingerTouchMoveStateManager.endMove(a))}isValidStartEvent(e){return this._executeRelevantHandler(e,a=>this.mouseMoveStateManager.isValidStartEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a))}isValidMoveEvent(e){return this._executeRelevantHandler(e,a=>this.mouseMoveStateManager.isValidMoveEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a))}isValidEndEvent(e){return this._executeRelevantHandler(e,a=>this.mouseMoveStateManager.isValidEndEvent(a),a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a))}}const fa=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class Nc{constructor(e,a){this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,a,u){return this._calculateTransform(e,a,u)}touchmove(e,a,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,a,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,a,u){this._calculateTransform(e,a,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,u){u.length>0&&(this._active=!0);const f=ss(u,a),_=new d.P(0,0),v=new d.P(0,0);let T=0;for(const C in f){const z=f[C],B=this._touches[C];B&&(_._add(z),v._add(z.sub(B)),T++,f[C]=z)}if(this._touches=f,this._shouldBePrevented(T)||!v.mag())return;const S=v.div(T);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(T),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,u){if(!this._firstTwoTouches)return;e.preventDefault();const[f,_]=this._firstTwoTouches,v=ls(u,a,f),T=ls(u,a,_);if(!v||!T)return;const S=this._aroundCenter?null:v.add(T).div(2);return this._move([v,T],S,e)}touchend(e,a,u){if(!this._firstTwoTouches)return;const[f,_]=this._firstTwoTouches,v=ls(u,a,f),T=ls(u,a,_);v&&T||(this._active&&Ct.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ls(m,e,a){for(let u=0;u<m.length;u++)if(m[u].identifier===a)return e[u]}function ql(m,e){return Math.log(m/e)/Math.LN2}class Bu extends Uc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ql(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ql(this._distance,u),pinchAround:a}}}function nl(m,e){return 180*m.angleWith(e)/Math.PI}class Ou extends Uc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a,u){const f=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:nl(this._vector,f),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const a=25/(Math.PI*this._minDiameter)*360,u=nl(e,this._startVector);return Math.abs(u)<a}}function Fu(m){return Math.abs(m.y)>Math.abs(m.x)}class _o extends Uc{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,u){super.touchstart(e,a,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,Fu(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const f=e[0].sub(this._lastPoints[0]),_=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,_,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(f.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,u){if(this._valid!==void 0)return this._valid;const f=e.mag()>=2,_=a.mag()>=2;if(!f&&!_)return;if(!f||!_)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const v=e.y>0==a.y>0;return Fu(e)&&Fu(a)&&v}}const Yf={panStep:100,bearingStep:15,pitchStep:10};class fr{constructor(e){this._tr=new Ru(e);const a=Yf;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,u=0,f=0,_=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),_=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),_=1);break;case 38:e.shiftKey?f=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?f=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(u=0,f=0),{cameraAnimation:T=>{const S=this._tr;T.easeTo({duration:300,easeId:"keyboardHandler",easing:_i,zoom:a?Math.round(S.zoom)+a*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+u*this._bearingStep,pitch:S.pitch+f*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _i(m){return m*(2-m)}const jc=4.000244140625,za=1/450;class Da{constructor(e,a){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new Ru(e),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=za}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=he(),f=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,a!==0&&a%jc==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(f*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Ct.mousePos(this._map.getCanvas(),e),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(d.U.convert(u.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const T=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=T),typeof this._targetZoom=="number"&&(this._targetZoom+=T)}if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>jc?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&S!==0&&(S=1/S);const C=typeof this._targetZoom!="number"?e.scale:d.al(this._targetZoom);this._targetZoom=e.applyConstrain(e.getCameraLngLat(),d.ao(C*S)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,u=this._startZoom,f=this._easing;let _,v=!1;if(this._type==="wheel"&&u&&f){const T=he()-this._lastWheelEventTime,S=Math.min((T+5)/200,1),C=f(S);_=d.F.number(u,a,C),S<1?this._frameId||(this._frameId=!0):v=!0}else _=a,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!v,zoomDelta:_-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=d.cs;if(this._prevEase){const u=this._prevEase,f=(he()-u.start)/u.duration,_=u.easing(f+.01)-u.easing(f),v=.27/Math.sqrt(_*_+1e-4)*.01,T=Math.sqrt(.0729-v*v);a=d.cq(v,T,.25,1)}return this._prevEase={start:he(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class rl{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vc{constructor(e){this._tr=new Ru(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gc{constructor(){this._tap=new Zr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,u){if(!this._swipePoint)if(this._tapTime){const f=a[0],_=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(f)<30;_&&v?u.length>0&&(this._swipePoint=f,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,a,u)}touchmove(e,a,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const f=a[0],_=f.y-this._swipePoint.y;return this._swipePoint=f,e.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(e,a,u)}touchend(e,a,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const f=this._tap.touchend(e,a,u);f&&(this._tapTime=e.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hl{constructor(e,a,u){this._el=e,this._mousePan=a,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class zr{constructor(e,a,u,f){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=a,this._mousePitch=u,this._mouseRoll=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Xl{constructor(e,a,u,f){this._el=e,this._touchZoom=a,this._touchRotate=u,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class pe{constructor(e,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=Ct.create("div","maplibregl-cooperative-gesture-screen",e);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=a,this._container.appendChild(f);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=u,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Ct.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,a){this._enabled&&(this._map.fire(new d.l("cooperativegestureprevented",{gestureType:e,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const _e=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class yo extends d.l{}function Nu(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class $l{constructor(e,a){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,_)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=f.type==="renderFrame"?void 0:f,T={needsRenderFrame:!1},S={},C={};for(const{handlerName:R,handler:N,allowed:q}of this._handlers){if(!N.isEnabled())continue;let K;if(this._blockedByActive(C,q,R))N.reset();else if(N[_||f.type]){if(d.ct(f,_||f.type)){const J=Ct.mousePos(this._map.getCanvas(),f);K=N[_||f.type](f,J)}else if(d.cu(f,_||f.type)){const J=this._getMapTouches(f.touches),et=Ct.touchPos(this._map.getCanvas(),J);K=N[_||f.type](f,et,J)}else d.cv(_||f.type)||(K=N[_||f.type](f));this.mergeHandlerResult(T,S,K,R,v),K&&K.needsRenderFrame&&this._triggerRenderFrame()}(K||N.isActive())&&(C[R]=N)}const z={};for(const R in this._previousActiveHandlers)C[R]||(z[R]=v);this._previousActiveHandlers=C,(Object.keys(z).length||Nu(T))&&(this._changes.push([T,S,z]),this._triggerRenderFrame()),(Object.keys(C).length||Nu(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=T;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Gr(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,_,v]of this._listeners)Ct.addEventListener(f,_,f===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,a,u]of this._listeners)Ct.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const a=this._map,u=a.getCanvasContainer();this._add("mapEvent",new ap(a,e));const f=a.boxZoom=new Oh(a,e);this._add("boxZoom",f),e.interactive&&e.boxZoom&&f.enable();const _=a.cooperativeGestures=new pe(a,e.cooperativeGestures);this._add("cooperativeGestures",_),e.cooperativeGestures&&_.enable();const v=new le(a),T=new Vc(a);a.doubleClickZoom=new rl(T,v),this._add("tapZoom",v),this._add("clickZoom",T),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();const S=new Gc;this._add("tapDragZoom",S);const C=a.touchPitch=new _o(a);this._add("touchPitch",C),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);const z=()=>a.project(a.getCenter()),B=function({enable:rt,clickTolerance:ht,aroundCenter:pt=!0,minPixelCenterThreshold:lt=100,rotateDegreesPerPixelMoved:xt=.8},Dt){const Mt=new os({checkCorrectEvent:Et=>Ct.mouseButton(Et)===0&&Et.ctrlKey||Ct.mouseButton(Et)===2&&!Et.ctrlKey});return new Ca({clickTolerance:ht,move:(Et,Pt)=>{const Kt=Dt();if(pt&&Math.abs(Kt.y-Et.y)>lt)return{bearingDelta:d.cr(new d.P(Et.x,Pt.y),Pt,Kt)};let Jt=(Pt.x-Et.x)*xt;return pt&&Pt.y<Kt.y&&(Jt=-Jt),{bearingDelta:Jt}},moveStateManager:Mt,enable:rt,assignEvents:fa})}(e,z),R=function({enable:rt,clickTolerance:ht,pitchDegreesPerPixelMoved:pt=-.5}){const lt=new os({checkCorrectEvent:xt=>Ct.mouseButton(xt)===0&&xt.ctrlKey||Ct.mouseButton(xt)===2});return new Ca({clickTolerance:ht,move:(xt,Dt)=>({pitchDelta:(Dt.y-xt.y)*pt}),moveStateManager:lt,enable:rt,assignEvents:fa})}(e),N=function({enable:rt,clickTolerance:ht,rollDegreesPerPixelMoved:pt=.3},lt){const xt=new os({checkCorrectEvent:Dt=>Ct.mouseButton(Dt)===2&&Dt.ctrlKey});return new Ca({clickTolerance:ht,move:(Dt,Mt)=>{const Et=lt();let Pt=(Mt.x-Dt.x)*pt;return Mt.y<Et.y&&(Pt=-Pt),{rollDelta:Pt}},moveStateManager:xt,enable:rt,assignEvents:fa})}(e,z);a.dragRotate=new zr(e,B,R,N),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",R,["mouseRotate","mouseRoll"]),this._add("mouseRoll",N,["mousePitch"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();const q=function({enable:rt,clickTolerance:ht}){const pt=new os({checkCorrectEvent:lt=>Ct.mouseButton(lt)===0&&!lt.ctrlKey});return new Ca({clickTolerance:ht,move:(lt,xt)=>({around:xt,panDelta:xt.sub(lt)}),activateOnStart:!0,moveStateManager:pt,enable:rt,assignEvents:fa})}(e),K=new Nc(e,a);a.dragPan=new Hl(u,q,K),this._add("mousePan",q),this._add("touchPan",K,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);const J=new Ou,et=new Bu;a.touchZoomRotate=new Xl(u,et,J,S),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",et,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new $f(a));const at=a.scrollZoom=new Da(a,()=>this._triggerRenderFrame());this._add("scrollZoom",at,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);const ct=a.keyboard=new fr(a);this._add("keyboard",ct),e.interactive&&e.keyboard&&a.keyboard.enable()}_add(e,a,u){this._handlers.push({handlerName:e,handler:a,allowed:u}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_e(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,u){for(const f in e)if(f!==u&&(!a||a.indexOf(f)<0))return!0;return!1}_getMapTouches(e){const a=[];for(const u of e)this._el.contains(u.target)&&a.push(u);return a}mergeHandlerResult(e,a,u,f,_){if(!u)return;d.e(e,u);const v={handlerName:f,originalEvent:u.originalEvent||_};u.zoomDelta!==void 0&&(a.zoom=v),u.panDelta!==void 0&&(a.drag=v),u.rollDelta!==void 0&&(a.roll=v),u.pitchDelta!==void 0&&(a.pitch=v),u.bearingDelta!==void 0&&(a.rotate=v)}_applyChanges(){const e={},a={},u={};for(const[f,_,v]of this._changes)f.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(f.panDelta)),f.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+f.pitchDelta),f.rollDelta&&(e.rollDelta=(e.rollDelta||0)+f.rollDelta),f.around!==void 0&&(e.around=f.around),f.pinchAround!==void 0&&(e.pinchAround=f.pinchAround),f.noInertia&&(e.noInertia=f.noInertia),d.e(a,_),d.e(u,v);this._updateMapTransform(e,a,u),this._changes=[]}_updateMapTransform(e,a,u){const f=this._map,_=f._getTransformForUpdate(),v=f.terrain;if(!(Nu(e)||v&&this._terrainMovement))return this._fireEvents(a,u,!0);f._stop(!0);let{panDelta:T,zoomDelta:S,bearingDelta:C,pitchDelta:z,rollDelta:B,around:R,pinchAround:N}=e;N!==void 0&&(R=N),R=R||f.transform.centerPoint,v&&!_.isPointOnMapSurface(R)&&(R=_.centerPoint);const q={panDelta:T,zoomDelta:S,rollDelta:B,pitchDelta:z,bearingDelta:C,around:R};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(R)&&(R=_.centerPoint);const K=R.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(T?R.sub(T):R);this._handleMapControls({terrain:v,tr:_,deltasForHelper:q,preZoomAroundLoc:K,combinedEventsInProgress:a,panDelta:T}),f._applyUpdatedTransform(_),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,u,!0)}_handleMapControls({terrain:e,tr:a,deltasForHelper:u,preZoomAroundLoc:f,combinedEventsInProgress:_,panDelta:v}){const T=this._map.cameraHelper;if(T.handleMapControlsRollPitchBearingZoom(u,a),e)return T.useGlobeControls?(this._terrainMovement||!_.drag&&!_.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void T.handleMapControlsPan(u,a,f)):this._terrainMovement||!_.drag&&!_.zoom?void(_.drag&&this._terrainMovement&&v?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(v))):T.handleMapControlsPan(u,a,f)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void T.handleMapControlsPan(u,a,f));T.handleMapControlsPan(u,a,f)}_fireEvents(e,a,u){const f=_e(this._eventsInProgress),_=_e(e),v={};for(const B in e){const{originalEvent:R}=e[B];this._eventsInProgress[B]||(v[`${B}start`]=R),this._eventsInProgress[B]=e[B]}!f&&_&&this._fireEvent("movestart",_.originalEvent);for(const B in v)this._fireEvent(B,v[B]);_&&this._fireEvent("move",_.originalEvent);for(const B in e){const{originalEvent:R}=e[B];this._fireEvent(B,R)}const T={};let S;for(const B in this._eventsInProgress){const{handlerName:R,originalEvent:N}=this._eventsInProgress[B];this._handlersById[R].isActive()||(delete this._eventsInProgress[B],S=a[R]||N,T[`${B}end`]=S)}for(const B in T)this._fireEvent(B,T[B]);const C=_e(this._eventsInProgress),z=(f||_)&&!C;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const B=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&B.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(B)}if(u&&z){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;!B||!B.essential&&ve.prefersReducedMotion?(this._map.fire(new d.l("moveend",{originalEvent:S})),R(this._map.getBearing())&&this._map.resetNorth()):(R(B.bearing||this._map.getBearing())&&(B.bearing=0),B.freezeElevation=!0,this._map.easeTo(B,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new d.l(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new yo("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ir extends d.E{constructor(e,a,u){super(),this._renderFrameCallback=()=>{const f=Math.min((he()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=u.bearingSnap,this.cameraHelper=a,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,a){e.apply(this.transform),this.transform=e,this.cameraHelper=a}getCenter(){return new d.U(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,a){return this.jumpTo({elevation:e},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,a,u){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},a),u)}panTo(e,a,u){return this.easeTo(d.e({center:e},a),u)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,u){return this.easeTo(d.e({zoom:e},a),u)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,a){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new d.l("movestart",a)).fire(new d.l("move",a)).fire(new d.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,u){return this.easeTo(d.e({bearing:e},a),u)}resetNorth(e,a){return this.rotateTo(0,d.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(d.e({bearing:0,pitch:0,roll:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}getRoll(){return this.transform.roll}setRoll(e,a){return this.jumpTo({roll:e},a),this}cameraForBounds(e,a){e=Wi.convert(e).adjustAntiMeridian();const u=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,a)}_cameraForBoxAndBearing(e,a,u,f){const _={top:0,bottom:0,right:0,left:0};if(typeof(f=d.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){const C=f.padding;f.padding={top:C,bottom:C,right:C,left:C}}const v=d.e(_,f.padding);f.padding=v;const T=this.transform,S=new Wi(e,a);return this.cameraHelper.cameraForBoxAndBearing(f,v,S,u,T)}fitBounds(e,a,u){return this._fitInternal(this.cameraForBounds(e,a),a,u)}fitScreenCoordinates(e,a,u,f,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(d.P.convert(e)),this.transform.screenPointToLocation(d.P.convert(a)),u,f),f,_)}_fitInternal(e,a,u){return e?(delete(a=d.e(e,a)).padding,a.linear?this.easeTo(a,u):this.flyTo(a,u)):this}jumpTo(e,a){this.stop();const u=this._getTransformForUpdate();let f=!1,_=!1,v=!1;const T=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,e);const S=u.zoom!==T;return"elevation"in e&&u.elevation!==+e.elevation&&u.setElevation(+e.elevation),"bearing"in e&&u.bearing!==+e.bearing&&(f=!0,u.setBearing(+e.bearing)),"pitch"in e&&u.pitch!==+e.pitch&&(_=!0,u.setPitch(+e.pitch)),"roll"in e&&u.roll!==+e.roll&&(v=!0,u.setRoll(+e.roll)),e.padding==null||u.isPaddingEqual(e.padding)||u.setPadding(e.padding),this._applyUpdatedTransform(u),this.fire(new d.l("movestart",a)).fire(new d.l("move",a)),S&&this.fire(new d.l("zoomstart",a)).fire(new d.l("zoom",a)).fire(new d.l("zoomend",a)),f&&this.fire(new d.l("rotatestart",a)).fire(new d.l("rotate",a)).fire(new d.l("rotateend",a)),_&&this.fire(new d.l("pitchstart",a)).fire(new d.l("pitch",a)).fire(new d.l("pitchend",a)),v&&this.fire(new d.l("rollstart",a)).fire(new d.l("roll",a)).fire(new d.l("rollend",a)),this.fire(new d.l("moveend",a))}calculateCameraOptionsFromTo(e,a,u,f=0){const _=d.a5.fromLngLat(e,a),v=d.a5.fromLngLat(u,f),T=v.x-_.x,S=v.y-_.y,C=v.z-_.z,z=Math.hypot(T,S,C);if(z===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(T,S),R=d.ao(this.transform.cameraToCenterDistance/z/this.transform.tileSize),N=180*Math.atan2(T,-S)/Math.PI;let q=180*Math.acos(B/z)/Math.PI;return q=C<0?90-q:90+q,{center:v.toLngLat(),elevation:f,zoom:R,pitch:q,bearing:N}}calculateCameraOptionsFromCameraLngLatAltRotation(e,a,u,f,_){const v=this.transform.calculateCenterFromCameraLngLatAlt(e,a,u,f);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:u,pitch:f,roll:_}}easeTo(e,a){this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.cs},e)).animate===!1||!e.essential&&ve.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),f=this.getBearing(),_=u.pitch,v=u.roll,T="bearing"in e?this._normalizeBearing(e.bearing,f):f,S="pitch"in e?+e.pitch:_,C="roll"in e?this._normalizeBearing(e.roll,v):v,z="padding"in e?e.padding:u.padding,B=d.P.convert(e.offset);let R,N;e.around&&(R=d.U.convert(e.around),N=u.locationToScreenPoint(R));const q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},K=this.cameraHelper.handleEaseTo(u,{bearing:T,pitch:S,roll:C,padding:z,around:R,aroundPoint:N,offsetAsPoint:B,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||f!==T,this._pitching=this._pitching||S!==_,this._rolling=this._rolling||C!==v,this._padding=!u.isPaddingEqual(z),this._zooming=this._zooming||K.isZooming,this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,q),this.terrain&&this._prepareElevation(K.elevationCenter),this._ease(J=>{K.easeFunc(J),this.terrain&&!e.freezeElevation&&this._updateElevation(J),this._applyUpdatedTransform(u),this._fireMoveEvents(a)},J=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a,J)},e),this}_prepareEase(e,a,u={}){this._moving=!0,a||u.moving||this.fire(new d.l("movestart",e)),this._zooming&&!u.zooming&&this.fire(new d.l("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new d.l("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new d.l("pitchstart",e)),this._rolling&&!u.rolling&&this.fire(new d.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(a-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.setElevation(d.F.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const a=e.getCameraLngLat(),u=e.getCameraAltitude(),f=this.terrain?this.terrain.getElevationForLngLatZoom(a,e.zoom):0;if(u<f){const _=this.calculateCameraOptionsFromTo(a,f,e.center,e.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(e){const a=[];if(a.push(f=>this._elevateCameraIfInsideTerrain(f)),this.transformCameraUpdate&&a.push(f=>this.transformCameraUpdate(f)),!a.length)return;const u=e.clone();for(const f of a){const _=u.clone(),{center:v,zoom:T,roll:S,pitch:C,bearing:z,elevation:B}=f(_);v&&_.setCenter(v),B!==void 0&&_.setElevation(B),T!==void 0&&_.setZoom(T),S!==void 0&&_.setRoll(S),C!==void 0&&_.setPitch(C),z!==void 0&&_.setBearing(z),u.apply(_)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new d.l("move",e)),this._zooming&&this.fire(new d.l("zoom",e)),this._rotating&&this.fire(new d.l("rotate",e)),this._pitching&&this.fire(new d.l("pitch",e)),this._rolling&&this.fire(new d.l("roll",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const u=this._zooming,f=this._rotating,_=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new d.l("zoomend",e)),f&&this.fire(new d.l("rotateend",e)),_&&this.fire(new d.l("pitchend",e)),v&&this.fire(new d.l("rollend",e)),this.fire(new d.l("moveend",e))}flyTo(e,a){if(!e.essential&&ve.prefersReducedMotion){const Pt=d.S(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Pt,a)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.cs},e);const u=this._getTransformForUpdate(),f=u.bearing,_=u.pitch,v=u.roll,T=u.padding,S="bearing"in e?this._normalizeBearing(e.bearing,f):f,C="pitch"in e?+e.pitch:_,z="roll"in e?this._normalizeBearing(e.roll,v):v,B="padding"in e?e.padding:u.padding,R=d.P.convert(e.offset);let N=u.centerPoint.add(R);const q=u.screenPointToLocation(N),K=this.cameraHelper.handleFlyTo(u,{bearing:S,pitch:C,roll:z,padding:B,locationAtOffset:q,offsetAsPoint:R,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let J=e.curve;const et=Math.max(u.width,u.height),at=et/K.scaleOfZoom,ct=K.pixelPathLength;typeof K.scaleOfMinZoom=="number"&&(J=Math.sqrt(et/K.scaleOfMinZoom/ct*2));const rt=J*J;function ht(Pt){const Kt=(at*at-et*et+(Pt?-1:1)*rt*rt*ct*ct)/(2*(Pt?at:et)*rt*ct);return Math.log(Math.sqrt(Kt*Kt+1)-Kt)}function pt(Pt){return(Math.exp(Pt)-Math.exp(-Pt))/2}function lt(Pt){return(Math.exp(Pt)+Math.exp(-Pt))/2}const xt=ht(!1);let Dt=function(Pt){return lt(xt)/lt(xt+J*Pt)},Mt=function(Pt){return et*((lt(xt)*(pt(Kt=xt+J*Pt)/lt(Kt))-pt(xt))/rt)/ct;var Kt},Et=(ht(!0)-xt)/J;if(Math.abs(ct)<2e-6||!isFinite(Et)){if(Math.abs(et-at)<1e-6)return this.easeTo(e,a);const Pt=at<et?-1:1;Et=Math.abs(Math.log(at/et))/J,Mt=()=>0,Dt=Kt=>Math.exp(Pt*J*Kt)}return e.duration="duration"in e?+e.duration:1e3*Et/("screenSpeed"in e?+e.screenSpeed/J:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=f!==S,this._pitching=C!==_,this._rolling=z!==v,this._padding=!u.isPaddingEqual(B),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(K.targetCenter),this._ease(Pt=>{const Kt=Pt*Et,Jt=1/Dt(Kt),Gt=Mt(Kt);this._rotating&&u.setBearing(d.F.number(f,S,Pt)),this._pitching&&u.setPitch(d.F.number(_,C,Pt)),this._rolling&&u.setRoll(d.F.number(v,z,Pt)),this._padding&&(u.interpolatePadding(T,B,Pt),N=u.centerPoint.add(R)),K.easeFunc(Pt,Jt,Gt,N),this.terrain&&!e.freezeElevation&&this._updateElevation(Pt),this._applyUpdatedTransform(u),this._fireMoveEvents(a)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,a)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,a,u){u.animate===!1||u.duration===0?(e(1),a()):(this._easeStart=he(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=d.V(e,-180,180);const u=Math.abs(e-a);return Math.abs(e-360-a)<u&&(e-=360),Math.abs(e+360-a)<u&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.U.convert(e),this.transform.tileZoom):null}}const Dr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class an{constructor(e=Dr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=Ct.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Ct.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ct.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Ct.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){const u=this._map._getUIString(`AttributionControl.${a}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(f=>typeof f!="string"?"":f)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const a=this._map.style.tileManagers;for(const f in a){const _=a[f];if(_.used||_.usedForTerrain){const v=_.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter(f=>String(f).trim()),e.sort((f,_)=>f.length-_.length),e=e.filter((f,_)=>{for(let v=_+1;v<e.length;v++)if(e[v].indexOf(f)>=0)return!1;return!0});const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=Ct.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class us{constructor(e={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const u=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=Ct.create("div","maplibregl-ctrl");const a=Ct.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ct.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Fh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){const a=this._currentlyRunning,u=a?this._queue.concat(a):this._queue;for(const f of u)if(f.id===e)return void(f.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const u of a)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Wf=d.aO([{name:"a_pos3d",type:"Int16",components:3}]);class vo extends d.E{constructor(e){super(),this._lastTilesetChange=he(),this.tileManager=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(e,a){this.tileManager.update(e,a),this._renderableTilesKeys=[];const u={};for(const f of Le(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))u[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.terrainRttPosMatrix32f=new Float64Array(16),d.c1(f.terrainRttPosMatrix32f,0,d.a3,d.a3,0,0,1),this._tiles[f.key]=new j(f,this.tileSize),this._lastTilesetChange=he());for(const f in this._tiles)u[f]||delete this._tiles[f]}freeRtt(e){for(const a in this._tiles){const u=this._tiles[a];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,a){return a?this._getTerrainCoordsForTileRanges(e,a):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const a={};for(const u of this._renderableTilesKeys){const f=this._tiles[u].tileID,_=e.clone(),v=d.be();if(f.canonical.equals(e.canonical))d.c1(v,0,d.a3,d.a3,0,0,1);else if(f.canonical.isChildOf(e.canonical)){const T=f.canonical.z-e.canonical.z,S=f.canonical.x-(f.canonical.x>>T<<T),C=f.canonical.y-(f.canonical.y>>T<<T),z=d.a3>>T;d.c1(v,0,z,z,0,0,1),d.N(v,v,[-S*z,-C*z,0])}else{if(!e.canonical.isChildOf(f.canonical))continue;{const T=e.canonical.z-f.canonical.z,S=e.canonical.x-(e.canonical.x>>T<<T),C=e.canonical.y-(e.canonical.y>>T<<T),z=d.a3>>T;d.c1(v,0,d.a3,d.a3,0,0,1),d.N(v,v,[S*z,C*z,0]),d.O(v,v,[1/2**T,1/2**T,0])}}_.terrainRttPosMatrix32f=new Float32Array(v),a[u]=_}return a}_getTerrainCoordsForTileRanges(e,a){const u={};for(const f of this._renderableTilesKeys){const _=this._tiles[f].tileID;if(!this._isWithinTileRanges(_,a))continue;const v=e.clone(),T=d.be();if(_.canonical.z===e.canonical.z){const S=e.canonical.x-_.canonical.x,C=e.canonical.y-_.canonical.y;d.c1(T,0,d.a3,d.a3,0,0,1),d.N(T,T,[S*d.a3,C*d.a3,0])}else if(_.canonical.z>e.canonical.z){const S=_.canonical.z-e.canonical.z,C=_.canonical.x-(_.canonical.x>>S<<S),z=_.canonical.y-(_.canonical.y>>S<<S),B=e.canonical.x-(_.canonical.x>>S),R=e.canonical.y-(_.canonical.y>>S),N=d.a3>>S;d.c1(T,0,N,N,0,0,1),d.N(T,T,[-C*N+B*d.a3,-z*N+R*d.a3,0])}else{const S=e.canonical.z-_.canonical.z,C=e.canonical.x-(e.canonical.x>>S<<S),z=e.canonical.y-(e.canonical.y>>S<<S),B=(e.canonical.x>>S)-_.canonical.x,R=(e.canonical.y>>S)-_.canonical.y,N=d.a3<<S;d.c1(T,0,N,N,0,0,1),d.N(T,T,[C*d.a3+B*N,z*d.a3+R*N,0])}v.terrainRttPosMatrix32f=new Float32Array(T),u[f]=v}return u}getSourceTile(e,a){const u=this.tileManager._source;let f=e.overscaledZ-this.deltaZoom;if(f>u.maxzoom&&(f=u.maxzoom),f<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(f).key);let _=this.tileManager.getTileByID(this._sourceTileCache[e.key]);if((!_||!_.dem)&&a)for(;f>=u.minzoom&&(!_||!_.dem);)_=this.tileManager.getTileByID(e.scaledTo(f--).key);return _}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,a){return a[e.canonical.z]&&e.canonical.x>=a[e.canonical.z].minTileX&&e.canonical.x<=a[e.canonical.z].maxTileX&&e.canonical.y>=a[e.canonical.z].minTileY&&e.canonical.y<=a[e.canonical.z].maxTileY}}class nr{constructor(e,a,u){this._meshCache={},this.painter=e,this.tileManager=new vo(a),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,u,f=d.a3){var _;if(!(a>=0&&a<f&&u>=0&&u<f))return 0;const v=this.getTerrainData(e),T=(_=v.tile)===null||_===void 0?void 0:_.dem;if(!T)return 0;const S=d.cw([],[a/f*d.a3,u/f*d.a3],v.u_terrain_matrix),C=[S[0]*T.dim,S[1]*T.dim],z=Math.floor(C[0]),B=Math.floor(C[1]),R=C[0]-z,N=C[1]-B;return T.get(z,B)*(1-R)*(1-N)+T.get(z+1,B)*R*(1-N)+T.get(z,B+1)*(1-R)*N+T.get(z+1,B+1)*R*N}getElevationForLngLatZoom(e,a){if(!d.cx(a,e.wrap()))return 0;const{tileID:u,mercatorX:f,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(u,f%d.a3,_%d.a3,d.a3)}getElevation(e,a,u,f=d.a3){return this.getDEMElevation(e,a,u,f)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const f=this.painter.context,_=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new d.T(f,_,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new d.T(f,new d.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.am([])}const a=this.tileManager.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const f=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new d.T(f,a.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),a.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const u=a&&a+a.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const f=this.tileManager.getSource().maxzoom;let _=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=f?_=e.canonical.z-f:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>_<<_),T=e.canonical.y-(e.canonical.y>>_<<_),S=d.cy(new Float64Array(16),[1/(d.a3<<_),1/(d.a3<<_),0]);d.N(S,S,[v*d.a3,T*d.a3,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){const a=this.painter,u=a.width/devicePixelRatio,f=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new d.T(a.context,{width:u,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new d.T(a.context,{width:u,height:f,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(u,f,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,u,f))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,v=0;_<this._coordsTextureSize;_++)for(let T=0;T<this._coordsTextureSize;T++,v+=4)a[v+0]=255&T,a[v+1]=255&_,a[v+2]=T>>8<<4|_>>8,a[v+3]=0;const u=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),f=new d.T(e,u,e.gl.RGBA,{premultiply:!1});return f.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),u=this.painter.context,f=u.gl,_=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),T=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(_,T-v-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null);const S=a[0]+(a[2]>>4<<8),C=a[1]+((15&a[2])<<8),z=this.coordsIndex[255-a[3]],B=z&&this.tileManager.getTileByID(z);if(!B)return null;const R=this._coordsTextureSize,N=(1<<B.tileID.canonical.z)*R;return new d.a5((B.tileID.canonical.x*R+S)/N+B.tileID.wrap,(B.tileID.canonical.y*R+C)/N,this.getElevation(B.tileID,S,C,R))}depthAtPoint(e){const a=new Uint8Array(4),u=this.painter.context,f=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,a),u.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(e){var a;const u=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,f=u&&e.canonical.y===0,_=u&&e.canonical.y===(1<<e.canonical.z)-1,v=`m_${f?"n":""}_${_?"s":""}`;if(this._meshCache[v])return this._meshCache[v];const T=this.painter.context,S=new d.cz,C=new d.aS,z=this.meshSize,B=d.a3/z,R=z*z;for(let lt=0;lt<=z;lt++)for(let xt=0;xt<=z;xt++)S.emplaceBack(xt*B,lt*B,0);for(let lt=0;lt<R;lt+=z+1)for(let xt=0;xt<z;xt++)C.emplaceBack(xt+lt,z+xt+lt+1,z+xt+lt+2),C.emplaceBack(xt+lt,z+xt+lt+2,xt+lt+1);const N=S.length,q=N+(z+1),K=(z+1)*z,J=f?d.bl:0,et=f?0:1,at=_?d.bm:d.a3,ct=_?0:1;for(let lt=0;lt<=z;lt++)S.emplaceBack(lt*B,J,et);for(let lt=0;lt<=z;lt++)S.emplaceBack(lt*B,at,ct);for(let lt=0;lt<z;lt++)C.emplaceBack(K+lt,q+lt,q+lt+1),C.emplaceBack(K+lt,q+lt+1,K+lt+1),C.emplaceBack(0+lt,N+lt+1,N+lt),C.emplaceBack(0+lt,0+lt+1,N+lt+1);const rt=S.length,ht=rt+2*(z+1);for(const lt of[0,1])for(let xt=0;xt<=z;xt++)for(const Dt of[0,1])S.emplaceBack(lt*d.a3,xt*B,Dt);for(let lt=0;lt<2*z;lt+=2)C.emplaceBack(rt+lt,rt+lt+1,rt+lt+3),C.emplaceBack(rt+lt,rt+lt+3,rt+lt+2),C.emplaceBack(ht+lt,ht+lt+3,ht+lt+1),C.emplaceBack(ht+lt,ht+lt+2,ht+lt+3);const pt=new Ha(T.createVertexBuffer(S,Wf.members),T.createIndexBuffer(C),d.aR.simpleSegment(0,0,S.length,C.length));return this._meshCache[v]=pt,pt}getMeshFrameDelta(e){return 2*Math.PI*d.by/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,a){var u;const{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(u=this.getMinMaxElevation(f).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const a=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return a&&a.dem&&(u.minElevation=a.dem.min*this.exaggeration,u.maxElevation=a.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,a){const u=d.a5.fromLngLat(e.wrap()),f=(1<<a)*d.a3,_=u.x*f,v=u.y*f,T=Math.floor(_/d.a3),S=Math.floor(v/d.a3);return{tileID:new d.a0(a,0,a,T,S),mercatorX:_,mercatorY:v}}}class je{constructor(e,a,u){this._context=e,this._size=a,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new d.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(u.texture),{id:e,fbo:a,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>e.id!==a),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const yi={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class cs{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new je(e.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=e._order.filter(u=>!e._layers[u].isHidden(a)),this._coordsAscending={};for(const u in e.tileManagers){this._coordsAscending[u]={};const f=e.tileManagers[u].getVisibleCoordinates(),_=e.tileManagers[u].getSource(),v=_ instanceof kr?_.terrainTileRanges:null;for(const T of f){const S=this.terrain.tileManager.getTerrainCoords(T,v);for(const C in S)this._coordsAscending[u][C]||(this._coordsAscending[u][C]=[]),this._coordsAscending[u][C].push(S[C])}}this._coordsAscendingStr={};for(const u of e._order){const f=e._layers[u],_=f.source;if(yi[f.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const v in this._coordsAscending[_])this._coordsAscendingStr[_][v]=this._coordsAscending[_][v].map(T=>T.key).sort().join()}}for(const u of this._renderableTiles)for(const f in this._coordsAscendingStr){const _=this._coordsAscendingStr[f][u.tileID.key];_&&_!==u.rttCoords[f]&&(u.rtt=[])}}renderLayer(e,a){if(e.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),f=e.type,_=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(yi[f]&&(this._prevType&&yi[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(e.id),!v))return!0;if(yi[this._prevType]||yi[f]&&v){this._prevType=f;const T=this._stacks.length-1,S=this._stacks[T]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(ns(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[T]){const B=this.pool.getObjectForId(C.rtt[T].id);if(B.stamp===C.rtt[T].stamp){this.pool.useObject(B);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),C.rtt[T]={id:z.id,stamp:z.stamp},_.context.bindFramebuffer.set(z.fbo.framebuffer),_.context.clear({color:d.bj.transparent,stencil:0}),_.currentStencilSource=void 0;for(let B=0;B<S.length;B++){const R=_.style._layers[S[B]],N=R.source?this._coordsAscending[R.source][C.tileID.key]:[C.tileID];_.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),_._renderTileClippingMasks(R,N,!0),_.renderLayer(_,_.style.tileManagers[R.source],R,N,u),R.source&&(C.rttCoords[R.source]=this._coordsAscendingStr[R.source][C.tileID.key])}}return ns(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),yi[f]}return!1}}const Fe={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},pi=wt,sn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Dr,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Yl={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class xo{constructor(e,a,u=!1){this.mousedown=_=>{this.startMove(_,Ct.mousePos(this.element,_)),Ct.addEventListener(window,"mousemove",this.mousemove),Ct.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,Ct.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHandler.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ct.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),Ct.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ct.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=Ct.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const f=new il;this._rotatePitchHandler=new Ca({clickTolerance:3,move:(_,v)=>{const T=a.getBoundingClientRect(),S=new d.P((T.bottom-T.top)/2,(T.right-T.left)/2);return{bearingDelta:d.cr(new d.P(_.x,v.y),v,S),pitchDelta:u?-.5*(v.y-_.y):void 0}},moveStateManager:f,enable:!0,assignEvents:()=>{}}),this.map=e,Ct.addEventListener(a,"mousedown",this.mousedown),Ct.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),Ct.addEventListener(a,"touchcancel",this.reset)}startMove(e,a){this._rotatePitchHandler.dragStart(e,a),Ct.disableDrag()}move(e,a){const u=this.map,{bearingDelta:f,pitchDelta:_}=this._rotatePitchHandler.dragMove(e,a)||{};f&&u.setBearing(u.getBearing()+f),_&&u.setPitch(u.getPitch()+_)}off(){const e=this.element;Ct.removeEventListener(e,"mousedown",this.mousedown),Ct.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),Ct.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ct.removeEventListener(window,"touchend",this.touchend),Ct.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){Ct.enableDrag(),Ct.removeEventListener(window,"mousemove",this.mousemove),Ct.removeEventListener(window,"mouseup",this.mouseup),Ct.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ct.removeEventListener(window,"touchend",this.touchend)}}let rr;function al(m,e,a,u=!1){if(u||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const f=new d.U(m.lng,m.lat);if(m=new d.U(m.lng,m.lat),e){const _=new d.U(m.lng-360,m.lat),v=new d.U(m.lng+360,m.lat),T=a.locationToScreenPoint(m).distSqr(e);a.locationToScreenPoint(_).distSqr(e)<T?m=_:a.locationToScreenPoint(v).distSqr(e)<T&&(m=v)}for(;Math.abs(m.lng-a.center.lng)>180;){const _=a.locationToScreenPoint(m);if(_.x>=0&&_.y>=0&&_.x<=a.width&&_.y<=a.height)break;m.lng>a.center.lng?m.lng-=360:m.lng+=360}return m.lng!==f.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(m))?m:f}const zs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ds(m,e,a){const u=m.classList;for(const f in zs)u.remove(`maplibregl-${a}-anchor-${f}`);u.add(`maplibregl-${a}-anchor-${e}`)}class Uu extends d.E{constructor(e){if(super(),this._onKeyPress=a=>{const u=a.code,f=a.charCode||a.keyCode;u!=="Space"&&u!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=a=>{const u=a.originalEvent.target,f=this._element;this._popup&&(u===f||f.contains(u))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=al(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(f=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),Ct.setTransform(this._element,`${zs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${f}`),ve.frameAsync(new AbortController).then(()=>{this._updateOpacity(a&&a.type==="moveend")}).catch(()=>{})},this._onMove=a=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.l("dragstart"))),this.fire(new d.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ct.create("div");const a=Ct.createNS("http://www.w3.org/2000/svg","svg"),u=41,f=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${u}px`),a.setAttributeNS(null,"width",`${f}px`),a.setAttributeNS(null,"viewBox",`0 0 ${f} ${u}`);const _=Ct.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const v=Ct.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const T=Ct.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(3.0, 29.0)"),T.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const et of S){const at=Ct.createNS("http://www.w3.org/2000/svg","ellipse");at.setAttributeNS(null,"opacity","0.04"),at.setAttributeNS(null,"cx","10.5"),at.setAttributeNS(null,"cy","5.80029008"),at.setAttributeNS(null,"rx",et.rx),at.setAttributeNS(null,"ry",et.ry),T.appendChild(at)}const C=Ct.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const z=Ct.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(z);const B=Ct.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const R=Ct.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(R);const N=Ct.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(6.0, 7.0)"),N.setAttributeNS(null,"fill","#FFFFFF");const q=Ct.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=Ct.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const J=Ct.createNS("http://www.w3.org/2000/svg","circle");J.setAttributeNS(null,"fill","#FFFFFF"),J.setAttributeNS(null,"cx","5.5"),J.setAttributeNS(null,"cy","5.5"),J.setAttributeNS(null,"r","5.4999962"),q.appendChild(K),q.appendChild(J),v.appendChild(T),v.appendChild(C),v.appendChild(B),v.appendChild(N),v.appendChild(q),a.appendChild(v),a.setAttributeNS(null,"height",u*this._scale+"px"),a.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(a),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),Ds(this._element,this._anchor,"marker"),e&&e.className)for(const a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Ct.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.U.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const f=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var a,u;const f=(a=this._map)===null||a===void 0?void 0:a.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!f||_){const N=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==N&&(this._element.style.opacity=N))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const v=this._map,T=v.terrain.depthAtPoint(this._pos),S=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,S)-T<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/v.transform.pixelsPerMeter,z=Math.sin(v.getPitch()*Math.PI/180)*C,B=v.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),R=v.transform.lngLatToCameraDepth(this._lngLat,S+z)-B>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&R&&this._popup.remove(),this._element.style.opacity=R?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,a){return(this._opacity===void 0||e===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Ki={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let bo=0,Ps=!1;const Zc={maxWidth:100,unit:"metric"};function ju(m,e,a){const u=a&&a.maxWidth||100,f=m._container.clientHeight/2,_=m._container.clientWidth/2,v=m.unproject([_-u/2,f]),T=m.unproject([_+u/2,f]),S=Math.round(m.project(T).x-m.project(v).x),C=Math.min(u,S,m._container.clientWidth),z=v.distanceTo(T);if(a&&a.unit==="imperial"){const B=3.2808*z;B>5280?wo(e,C,B/5280,m._getUIString("ScaleControl.Miles")):wo(e,C,B,m._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?wo(e,C,z/1852,m._getUIString("ScaleControl.NauticalMiles")):z>=1e3?wo(e,C,z/1e3,m._getUIString("ScaleControl.Kilometers")):wo(e,C,z,m._getUIString("ScaleControl.Meters"))}function wo(m,e,a,u){const f=function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let T=_/v;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(S){const C=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*C)/C}(T),v*T}(a);m.style.width=e*(f/a)+"px",m.innerHTML=`${f}&nbsp;${u}`}const Vu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Gu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function sl(m){if(m){if(typeof m=="number"){const e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,m),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-m),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(m,0),right:new d.P(-m,0)}}if(m instanceof d.P||Array.isArray(m)){const e=d.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(m.center||[0,0]),top:d.P.convert(m.top||[0,0]),"top-left":d.P.convert(m["top-left"]||[0,0]),"top-right":d.P.convert(m["top-right"]||[0,0]),bottom:d.P.convert(m.bottom||[0,0]),"bottom-left":d.P.convert(m["bottom-left"]||[0,0]),"bottom-right":d.P.convert(m["bottom-right"]||[0,0]),left:d.P.convert(m.left||[0,0]),right:d.P.convert(m.right||[0,0])}}return sl(new d.P(0,0))}const ar=wt;P.AJAXError=d.cD,P.Event=d.l,P.Evented=d.E,P.LngLat=d.U,P.MercatorCoordinate=d.a5,P.Point=d.P,P.addProtocol=d.cE,P.config=d.a,P.removeProtocol=d.cF,P.AttributionControl=an,P.BoxZoomHandler=Oh,P.CanvasSource=Cl,P.CooperativeGesturesHandler=pe,P.DoubleClickZoomHandler=rl,P.DragPanHandler=Hl,P.DragRotateHandler=zr,P.EdgeInsets=Ti,P.FullscreenControl=class extends d.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=a?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ct.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Ct.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=Ct.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Ct.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},P.GeoJSONSource=Ln,P.GeolocateControl=class extends d.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const a=new d.U(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,f=this._map.getBearing(),_=d.e({bearing:f},this.options.fitBoundsOptions),v=Wi.fromLngLat(a,u);this._map.fitBounds(v,_,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const a=new d.U(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ps)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=Ct.create("button","maplibregl-ctrl-geolocate",this._container),Ct.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ct.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Uu({element:this._dotElement}),this._circleElement=Ct.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Uu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{const u=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.l("trackuserlocationend")),this.fire(new d.l("userlocationlostfocus")))})}},this.options=d.e({},Ki,m)}onAdd(m){return this._map=m,this._container=Ct.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(rr!==void 0&&!e)return rr;if(window.navigator.permissions===void 0)return rr=!!window.navigator.geolocation,rr;try{rr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{rr=!!window.navigator.geolocation}return rr})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ct.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,bo=0,Ps=!1}_isOutOfMapMaxBounds(m){const e=this._map.getMaxBounds(),a=m.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const e=this._map.project(m),a=this._map.unproject([e.x+100,e.y]),u=m.distanceTo(a)/100,f=2*this._accuracy/u;this._circleElement.style.width=`${f.toFixed(2)}px`,this._circleElement.style.height=`${f.toFixed(2)}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":bo--,Ps=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.l("trackuserlocationstart")),this.fire(new d.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),bo++,bo>1?(m={maximumAge:6e5,timeout:0},Ps=!0):(m=this.options.positionOptions,Ps=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},P.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=Ct.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Ct.create("button","maplibregl-ctrl-globe",this._container),Ct.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Ct.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},P.Hash=Bn,P.ImageSource=kr,P.KeyboardHandler=fr,P.LngLatBounds=Wi,P.LogoControl=us,P.Map=class extends ir{constructor(m){var e,a;d.cA.mark(d.cB.create);const u=Object.assign(Object.assign(Object.assign({},sn),m),{canvasContextAttributes:Object.assign(Object.assign({},sn.canvasContextAttributes),m.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const f=new Ri,_=new Kn;if(u.minZoom!==void 0&&f.setMinZoom(u.minZoom),u.maxZoom!==void 0&&f.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&f.setMinPitch(u.minPitch),u.maxPitch!==void 0&&f.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&f.setRenderWorldCopies(u.renderWorldCopies),u.transformConstrain!==null&&f.setConstrainOverride(u.transformConstrain),super(f,_,{bearingSnap:u.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Fh,this._controls=[],this._mapId=d.ab(),this._lostContextStyle={style:null,images:null},this._contextLost=T=>{T.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const S of Object.values(this.style._layers))if(S.type==="custom"&&console.warn(`Custom layer with id '${S.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),S._listeners)for(const[C]of Object.entries(S._listeners))console.warn(`Custom layer with id '${S.id}' had event listeners for event '${C}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new d.l("webglcontextlost",{originalEvent:T}))},this._contextRestored=T=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new d.l("webglcontextrestored",{originalEvent:T}))},this._onMapScroll=T=>{if(T.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Fe),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this._zoomLevelsToOverscale=u.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=u.transformCameraUpdate,this.transformConstrain=u.transformConstrain,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,u.reduceMotion!==void 0&&(ve.prefersReducedMotion=u.reduceMotion),this._imageQueueHandle=Re.addThrottleControl(()=>this.isMoving()),this._requestManager=new En(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let T=!1;const S=As(C=>{this._trackResize&&!this._removed&&(this.resize(C),this.redraw())},50);this._resizeObserver=new ResizeObserver(C=>{T?S(C):T=!0}),this._resizeObserver.observe(this._container)}this.handlers=new $l(this,u),this._hash=u.hash&&new Bn(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,d.e({},u.fitBoundsOptions,{duration:0}))));const v=typeof u.style=="string"||((a=(e=u.style)===null||e===void 0?void 0:e.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new an(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new us,u.logoPosition),this.on("style.load",()=>{if(v||this._resizeTransform(),this.transform.unmodified){const T=d.S(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(T)}}),this.on("data",T=>{this._update(T.dataType==="style"),this.fire(new d.l(`${T.dataType}data`,T))}),this.on("dataloading",T=>{this.fire(new d.l(`${T.dataType}dataloading`,T))}),this.on("dataabort",T=>{this.fire(new d.l("sourcedataabort",T))})}_getMapId(){return this._mapId}setGlobalStateProperty(m,e){return this.style.setGlobalStateProperty(m,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new d.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=m.onAdd(this);this._controls.push(m);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(a,u.firstChild):u.appendChild(a),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new d.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return Le(this.transform,m)}calculateCameraOptionsFromTo(m,e,a,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,a,u)}resize(m,e=!0){const[a,u]=this._containerDimensions(),f=this._getClampedPixelRatio(a,u);if(this._resizeCanvas(a,u,f),this.painter.resize(a,u,f),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const T=this._getClampedPixelRatio(a,u);this._resizeCanvas(a,u,T),this.painter.resize(a,u,T)}this._resizeTransform(e);const _=!this._moving;return _&&(this.stop(),this.fire(new d.l("movestart",m)).fire(new d.l("move",m))),this.fire(new d.l("resize",m)),_&&this.fire(new d.l("moveend",m)),this}_resizeTransform(m=!0){var e;const[a,u]=this._containerDimensions();this.transform.resize(a,u,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,u,m)}_getClampedPixelRatio(m,e){const{0:a,1:u}=this._maxCanvasSize,f=this.getPixelRatio(),_=m*f,v=e*f;return Math.min(_>a?a/_:1,v>u?u/v:1)*f}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(Wi.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(d.U.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(d.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,a){if(m==="mouseenter"||m==="mouseover"){let u=!1;return{layers:e,listener:a,delegates:{mousemove:_=>{const v=e.filter(S=>this.getLayer(S)),T=v.length!==0?this.queryRenderedFeatures(_.point,{layers:v}):[];T.length?u||(u=!0,a.call(this,new Hi(m,this,_.originalEvent,{features:T}))):u=!1},mouseout:()=>{u=!1}}}}if(m==="mouseleave"||m==="mouseout"){let u=!1;return{layers:e,listener:a,delegates:{mousemove:v=>{const T=e.filter(S=>this.getLayer(S));(T.length!==0?this.queryRenderedFeatures(v.point,{layers:T}):[]).length?u=!0:u&&(u=!1,a.call(this,new Hi(m,this,v.originalEvent)))},mouseout:v=>{u&&(u=!1,a.call(this,new Hi(m,this,v.originalEvent)))}}}}{const u=f=>{const _=e.filter(T=>this.getLayer(T)),v=_.length!==0?this.queryRenderedFeatures(f.point,{layers:_}):[];v.length&&(f.features=v,a.call(this,f),delete f.features)};return{layers:e,listener:a,delegates:{[m]:u}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,a){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const u=this._delegatedListeners[m];for(let f=0;f<u.length;f++){const _=u[f];if(_.listener===a&&_.layers.length===e.length&&_.layers.every(v=>e.includes(v))){for(const v in _.delegates)this.off(v,_.delegates[v]);return void u.splice(f,1)}}}on(m,e,a){if(a===void 0)return super.on(m,e);const u=typeof e=="string"?[e]:e,f=this._createDelegatedListener(m,u,a);this._saveDelegatedListener(m,f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(m,u,a)}}}once(m,e,a){if(a===void 0)return super.once(m,e);const u=typeof e=="string"?[e]:e,f=this._createDelegatedListener(m,u,a);for(const _ in f.delegates){const v=f.delegates[_];f.delegates[_]=(...T)=>{this._removeDelegatedListener(m,u,a),v(...T)}}this._saveDelegatedListener(m,f);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(m,e,a){return a===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,a),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let a;const u=m instanceof d.P||Array.isArray(m),f=u?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:m)||{},f instanceof d.P||typeof f[0]=="number")a=[d.P.convert(f)];else{const _=d.P.convert(f[0]),v=d.P.convert(f[1]);a=[_,new d.P(v.x,_.y),v,new d.P(_.x,v.y),_]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var a,u;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,e));const f=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new xu(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,f):this.style.loadJSON(m,e,f),this):((u=(a=this.style)===null||a===void 0?void 0:a.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){const a=this._requestManager.transformRequest(m,"Style");d.j(a,new AbortController).then(u=>{this._updateDiff(u.data,e)}).catch(u=>{u&&this.fire(new d.k(u))})}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(a){d.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){const e=this.style&&this.style.tileManagers[m];if(e!==void 0)return e.loaded();this.fire(new d.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const e=this.style.tileManagers[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(const a in this.style._layers){const u=this.style._layers[a];u.type==="hillshade"&&u.source===m.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===m.source&&d.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new nr(this.painter,e,m),this.painter.renderToTexture=new cs(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var u;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=a.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new d.l("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const m=this.style&&this.style.tileManagers;for(const e in m){const a=m[e]._tiles;for(const u in a){const f=a[u];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,e,a){if(a){const u=this.getSource(a);if(!u)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);u.calculateTileZoom=Ot(Math.max(1,m),Math.max(1,e))}else for(const u in this.style.tileManagers)this.style.tileManagers[u].getSource().calculateTileZoom=Ot(Math.max(1,m),Math.max(1,e));return this._update(!0),this}refreshTiles(m,e){const a=this.style.tileManagers[m];if(!a)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);e===void 0?a.reload(!0):a.refreshTiles(e.map(u=>new d.a8(u.z,u.x,u.y)))}addImage(m,e,a={}){const{pixelRatio:u=1,sdf:f=!1,stretchX:_,stretchY:v,content:T,textFitWidth:S,textFitHeight:C}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:B,data:R}=e,N=e;return this.style.addImage(m,{data:new d.R({width:z,height:B},new Uint8Array(R)),pixelRatio:u,stretchX:_,stretchY:v,content:T,textFitWidth:S,textFitHeight:C,sdf:f,version:0,userImage:N}),N.onAdd&&N.onAdd(this,m),this}}{const{width:z,height:B,data:R}=ve.getImageData(e);this.style.addImage(m,{data:new d.R({width:z,height:B},R),pixelRatio:u,stretchX:_,stretchY:v,content:T,textFitWidth:S,textFitHeight:C,sdf:f,version:0})}}updateImage(m,e){const a=this.style.getImage(m);if(!a)return this.fire(new d.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||d.b(e)?ve.getImageData(e):e,{width:f,height:_,data:v}=u;if(f===void 0||_===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==a.data.width||_!==a.data.height)return this.fire(new d.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const T=!(e instanceof HTMLImageElement||d.b(e));return a.data.replace(v,T),this.style.updateImage(m,a),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new d.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return Re.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,a){return this.style.setLayerZoomRange(m,e,a),this._update(!0)}setFilter(m,e,a={}){return this.style.setFilter(m,e,a),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,a,u={}){return this.style.setPaintProperty(m,e,a,u),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,a,u={}){return this.style.setLayoutProperty(m,e,a,u),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,a,u=>{u||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,a=>{a||this._update(!0)}),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const e=this._canvasContainer=Ct.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=Ct.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),u=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],u);const f=this._controlContainer=Ct.create("div","maplibregl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{_[v]=Ct.create("div",`maplibregl-ctrl-${v} `,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,a){this._canvas.width=Math.floor(a*m),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{e={requestedAttributes:m},u&&(e.statusMessage=u.statusMessage,e.type=u.type)},{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!a){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new Iu(a,this.transform),Ai.testSupport(a)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new d.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,a,u,f,_;const v=this._idleTriggered?this._fadeDuration:0,T=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,R=he();this.style.zoomHistory.update(B,R);const N=new d.G(B,{now:R,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),q=N.crossFadingFactor();q===1&&q===this._crossFadingFactor||(S=!0,this._crossFadingFactor=q),this.style.update(N)}const C=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==T;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((f=this.style.projection)===null||f===void 0?void 0:f.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||C)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,C),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new d.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.cA.mark(d.cB.load),this.fire(new d.l("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,d.cA.mark(d.cB.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Re.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Ct.remove(this._canvasContainer),Ct.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),d.cA.clearMetrics(),this._removed=!0,this.fire(new d.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ve.frame(this._frameRequest,m=>{d.cA.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!d.cC(e)&&!function(a){return a.message===Ul}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return pi}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},P.MapMouseEvent=Hi,P.MapTouchEvent=as,P.MapWheelEvent=ha,P.Marker=Uu,P.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const e=this._map.getZoom(),a=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,a)=>{const u=this._map._getUIString(`NavigationControl.${a}`);e.title=u,e.setAttribute("aria-label",u)},this.options=d.e({},Yl,m),this._container=Ct.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),Ct.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),Ct.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=Ct.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new xo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ct.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){const a=Ct.create("button",m,this._container);return a.type="button",a.addEventListener("click",e),a}},P.Popup=class extends d.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Ct.remove(this._content),this._container&&(Ct.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Ct.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Ct.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=al(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const f=sl(this.options.offset);if(!u){const v=this._container.offsetWidth,T=this._container.offsetHeight;let S;S=a.y+f.bottom.y<T?["top"]:a.y>this._map.transform.height-T?["bottom"]:[],a.x<v/2?S.push("left"):a.x>this._map.transform.width-v/2&&S.push("right"),u=S.length===0?"bottom":S.join("-")}let _=a.add(f[u]);this.options.subpixelPositioning||(_=_.round()),Ct.setTransform(this._container,`${zs[u]} translate(${_.x}px,${_.y}px)`),Ds(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(Vu),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=d.U.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const e=document.createDocumentFragment(),a=document.createElement("body");let u;for(a.innerHTML=m;u=a.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ct.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ct.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Gu);m&&m.focus()}},P.RasterDEMTileSource=Ua,P.RasterTileSource=Js,P.ScaleControl=class{constructor(m){this._onMove=()=>{ju(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,ju(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Zc),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=Ct.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ct.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},P.ScrollZoomHandler=Da,P.Style=xu,P.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=Ct.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Ct.create("button","maplibregl-ctrl-terrain",this._container),Ct.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Ct.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},P.TwoFingersTouchPitchHandler=_o,P.TwoFingersTouchRotateHandler=Ou,P.TwoFingersTouchZoomHandler=Bu,P.TwoFingersTouchZoomRotateHandler=Xl,P.VectorTileSource=la,P.VideoSource=Al,P.addSourceType=(m,e)=>d._(void 0,void 0,void 0,function*(){if(zl(m))throw new Error(`A source type called "${m}" already exists.`);((a,u)=>{Va[a]=u})(m,e)}),P.clearPrewarmedResources=function(){const m=Ue;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(fe),Ue=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},P.createTileMesh=_u,P.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},P.getRTLTextPluginStatus=function(){return wr().getRTLTextPluginStatus()},P.getVersion=function(){return ar},P.getWorkerCount=function(){return Ce.workerCount},P.getWorkerUrl=function(){return d.a.WORKER_URL},P.importScriptInWorkers=function(m){return Wr().broadcast("IS",m)},P.isTimeFrozen=function(){return Ke.isFrozen()},P.now=he,P.prewarm=function(){wi().acquire(fe)},P.restoreNow=function(){Ke.restoreNow()},P.setMaxParallelImageRequests=function(m){d.a.MAX_PARALLEL_IMAGE_REQUESTS=m},P.setNow=function(m){Ke.setNow(m)},P.setRTLTextPlugin=function(m,e){return wr().setRTLTextPlugin(m,e)},P.setWorkerCount=function(m){Ce.workerCount=m},P.setWorkerUrl=function(m){d.a.WORKER_URL=m}});var ft=H;return ft})}(Hm)),Hm.exports}var f_=Cy();const d_=Mg(f_),zy=Z_({__proto__:null,default:d_},[f_]);var Qs=Uint8Array,tp=Uint16Array,Dy=Int32Array,p_=new Qs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),m_=new Qs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Py=new Qs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g_=function(V,$){for(var H=new tp(31),Z=0;Z<31;++Z)H[Z]=$+=1<<V[Z-1];for(var nt=new Dy(H[30]),Z=1;Z<30;++Z)for(var ft=H[Z];ft<H[Z+1];++ft)nt[ft]=ft-H[Z]<<5|Z;return{b:H,r:nt}},__=g_(p_,2),y_=__.b,Iy=__.r;y_[28]=258,Iy[258]=28;var Ry=g_(m_,0),Ly=Ry.b,Tg=new tp(32768);for(var Mn=0;Mn<32768;++Mn){var ph=(Mn&43690)>>1|(Mn&21845)<<1;ph=(ph&52428)>>2|(ph&13107)<<2,ph=(ph&61680)>>4|(ph&3855)<<4,Tg[Mn]=((ph&65280)>>8|(ph&255)<<8)>>1}var $p=function(V,$,H){for(var Z=V.length,nt=0,ft=new tp($);nt<Z;++nt)V[nt]&&++ft[V[nt]-1];var P=new tp($);for(nt=1;nt<$;++nt)P[nt]=P[nt-1]+ft[nt-1]<<1;var d;if(H){d=new tp(1<<$);var wt=15-$;for(nt=0;nt<Z;++nt)if(V[nt])for(var At=nt<<4|V[nt],ie=$-V[nt],jt=P[V[nt]-1]++<<ie,re=jt|(1<<ie)-1;jt<=re;++jt)d[Tg[jt]>>wt]=At}else for(d=new tp(Z),nt=0;nt<Z;++nt)V[nt]&&(d[nt]=Tg[P[V[nt]-1]++]>>15-V[nt]);return d},Wp=new Qs(288);for(var Mn=0;Mn<144;++Mn)Wp[Mn]=8;for(var Mn=144;Mn<256;++Mn)Wp[Mn]=9;for(var Mn=256;Mn<280;++Mn)Wp[Mn]=7;for(var Mn=280;Mn<288;++Mn)Wp[Mn]=8;var v_=new Qs(32);for(var Mn=0;Mn<32;++Mn)v_[Mn]=5;var ky=$p(Wp,9,1),By=$p(v_,5,1),bg=function(V){for(var $=V[0],H=1;H<V.length;++H)V[H]>$&&($=V[H]);return $},Ml=function(V,$,H){var Z=$/8|0;return(V[Z]|V[Z+1]<<8)>>($&7)&H},wg=function(V,$){var H=$/8|0;return(V[H]|V[H+1]<<8|V[H+2]<<16)>>($&7)},Oy=function(V){return(V+7)/8|0},Fy=function(V,$,H){return(H==null||H>V.length)&&(H=V.length),new Qs(V.subarray($,H))},Ny=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ks=function(V,$,H){var Z=new Error($||Ny[V]);if(Z.code=V,Error.captureStackTrace&&Error.captureStackTrace(Z,Ks),!H)throw Z;return Z},Ag=function(V,$,H,Z){var nt=V.length,ft=0;if(!nt||$.f&&!$.l)return H||new Qs(0);var P=!H,d=P||$.i!=2,wt=$.i;P&&(H=new Qs(nt*3));var At=function(Wr){var Wn=H.length;if(Wr>Wn){var ps=new Qs(Math.max(Wn*2,Wr));ps.set(H),H=ps}},ie=$.f||0,jt=$.p||0,re=$.b||0,ve=$.l,Ke=$.d,he=$.m,Ct=$.n,Ai=nt*8;do{if(!ve){ie=Ml(V,jt,1);var ti=Ml(V,jt+1,3);if(jt+=3,ti)if(ti==1)ve=ky,Ke=By,he=9,Ct=5;else if(ti==2){var un=Ml(V,jt,31)+257,Re=Ml(V,jt+10,15)+4,En=un+Ml(V,jt+5,31)+1;jt+=14;for(var $i=new Qs(En),Yn=new Qs(19),bi=0;bi<Re;++bi)Yn[Py[bi]]=Ml(V,jt+bi*3,7);jt+=Re*3;for(var Yi=bg(Yn),xr=(1<<Yi)-1,br=$p(Yn,Yi,1),bi=0;bi<En;){var Vn=br[Ml(V,jt,xr)];jt+=Vn&15;var Ee=Vn>>4;if(Ee<16)$i[bi++]=Ee;else{var Nt=0,ne=0;for(Ee==16?(ne=3+Ml(V,jt,3),jt+=2,Nt=$i[bi-1]):Ee==17?(ne=3+Ml(V,jt,7),jt+=3):Ee==18&&(ne=11+Ml(V,jt,127),jt+=7);ne--;)$i[bi++]=Nt}}var Pe=$i.subarray(0,un),ge=$i.subarray(un);he=bg(Pe),Ct=bg(ge),ve=$p(Pe,he,1),Ke=$p(ge,Ct,1)}else Ks(1);else{var Ee=Oy(jt)+4,di=V[Ee-4]|V[Ee-3]<<8,Ci=Ee+di;if(Ci>nt){wt&&Ks(0);break}d&&At(re+di),H.set(V.subarray(Ee,Ci),re),$.b=re+=di,$.p=jt=Ci*8,$.f=ie;continue}if(jt>Ai){wt&&Ks(0);break}}d&&At(re+131072);for(var oi=(1<<he)-1,vt=(1<<Ct)-1,qt=jt;;qt=jt){var Nt=ve[wg(V,jt)&oi],ae=Nt>>4;if(jt+=Nt&15,jt>Ai){wt&&Ks(0);break}if(Nt||Ks(2),ae<256)H[re++]=ae;else if(ae==256){qt=jt,ve=null;break}else{var fe=ae-254;if(ae>264){var bi=ae-257,Ce=p_[bi];fe=Ml(V,jt,(1<<Ce)-1)+y_[bi],jt+=Ce}var ze=Ke[wg(V,jt)&vt],Ue=ze>>4;ze||Ks(3),jt+=ze&15;var ge=Ly[Ue];if(Ue>3){var Ce=m_[Ue];ge+=wg(V,jt)&(1<<Ce)-1,jt+=Ce}if(jt>Ai){wt&&Ks(0);break}d&&At(re+131072);var fi=re+fe;if(re<ge){var wi=ft-ge,Lr=Math.min(ge,fi);for(wi+re<0&&Ks(3);re<Lr;++re)H[re]=Z[wi+re]}for(;re<fi;++re)H[re]=H[re-ge]}}$.l=ve,$.p=qt,$.b=re,$.f=ie,ve&&(ie=1,$.m=he,$.d=Ke,$.n=Ct)}while(!ie);return re!=H.length&&P?Fy(H,0,re):H.subarray(0,re)},Uy=new Qs(0),jy=function(V){(V[0]!=31||V[1]!=139||V[2]!=8)&&Ks(6,"invalid gzip data");var $=V[3],H=10;$&4&&(H+=(V[10]|V[11]<<8)+2);for(var Z=($>>3&1)+($>>4&1);Z>0;Z-=!V[H++]);return H+($&2)},Vy=function(V){var $=V.length;return(V[$-4]|V[$-3]<<8|V[$-2]<<16|V[$-1]<<24)>>>0},Gy=function(V,$){return((V[0]&15)!=8||V[0]>>4>7||(V[0]<<8|V[1])%31)&&Ks(6,"invalid zlib data"),(V[1]>>5&1)==1&&Ks(6,"invalid zlib data: "+(V[1]&32?"need":"unexpected")+" dictionary"),(V[1]>>3&4)+2};function Zy(V,$){return Ag(V,{i:2},$,$)}function qy(V,$){var H=jy(V);return H+8>V.length&&Ks(6,"invalid gzip data"),Ag(V.subarray(H,-8),{i:2},new Qs(Vy(V)),$)}function Hy(V,$){return Ag(V.subarray(Gy(V),-4),{i:2},$,$)}function Xy(V,$){return V[0]==31&&V[1]==139&&V[2]==8?qy(V,$):(V[0]&15)!=8||V[0]>>4>7||(V[0]<<8|V[1])%31?Zy(V,$):Hy(V,$)}var $y=typeof TextDecoder<"u"&&new TextDecoder,Yy=0;try{$y.decode(Uy,{stream:!0}),Yy=1}catch{}var Wy=Object.defineProperty,Yp=Math.pow,tn=(V,$)=>Wy(V,"name",{value:$,configurable:!0}),Yr=(V,$,H)=>new Promise((Z,nt)=>{var ft=wt=>{try{d(H.next(wt))}catch(At){nt(At)}},P=wt=>{try{d(H.throw(wt))}catch(At){nt(At)}},d=wt=>wt.done?Z(wt.value):Promise.resolve(wt.value).then(ft,P);d((H=H.apply(V,$)).next())});tn((V,$)=>{let H=!1,Z="",nt=L.GridLayer.extend({createTile:tn((ft,P)=>{let d=document.createElement("img"),wt=new AbortController,At=wt.signal;return d.cancel=()=>{wt.abort()},H||(V.getHeader().then(ie=>{ie.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):ie.tileType===2?Z="image/png":ie.tileType===3?Z="image/jpeg":ie.tileType===4?Z="image/webp":ie.tileType===5&&(Z="image/avif")}),H=!0),V.getZxy(ft.z,ft.x,ft.y,At).then(ie=>{if(ie){let jt=new Blob([ie.data],{type:Z}),re=window.URL.createObjectURL(jt);d.src=re,d.cancel=void 0,P(void 0,d)}}).catch(ie=>{if(ie.name!=="AbortError")throw ie}),d},"createTile"),_removeTile:tn(function(ft){let P=this._tiles[ft];P&&(P.el.cancel&&P.el.cancel(),P.el.width=0,P.el.height=0,P.el.deleted=!0,L.DomUtil.remove(P.el),delete this._tiles[ft],this.fire("tileunload",{tile:P.el,coords:this._keyToTileCoords(ft)}))},"_removeTile")});return new nt($)},"leafletRasterLayer");var Ky=tn(V=>($,H)=>{if(H instanceof AbortController)return V($,H);let Z=new AbortController;return V($,Z).then(nt=>H(void 0,nt.data,nt.cacheControl||"",nt.expires||""),nt=>H(nt)).catch(nt=>H(nt)),{cancel:tn(()=>Z.abort(),"cancel")}},"v3compat"),x_=class{constructor($){this.tilev4=tn((H,Z)=>Yr(this,null,function*(){if(H.type==="json"){let ve=H.url.substr(10),Ke=this.tiles.get(ve);if(Ke||(Ke=new a_(ve),this.tiles.set(ve,Ke)),this.metadata)return{data:yield Ke.getTileJson(H.url)};let he=yield Ke.getHeader();return(he.minLon>=he.maxLon||he.minLat>=he.maxLat)&&console.error(`Bounds of PMTiles archive ${he.minLon},${he.minLat},${he.maxLon},${he.maxLat} are not valid.`),{data:{tiles:[`${H.url}/{z}/{x}/{y}`],minzoom:he.minZoom,maxzoom:he.maxZoom,bounds:[he.minLon,he.minLat,he.maxLon,he.maxLat]}}}let nt=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),ft=H.url.match(nt);if(!ft)throw new Error("Invalid PMTiles protocol URL");let P=ft[1],d=this.tiles.get(P);d||(d=new a_(P),this.tiles.set(P,d));let wt=ft[2],At=ft[3],ie=ft[4],jt=yield d.getHeader(),re=yield d?.getZxy(+wt,+At,+ie,Z.signal);if(re)return{data:new Uint8Array(re.data),cacheControl:re.cacheControl,expires:re.expires};if(jt.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=Ky(this.tilev4),this.tiles=new Map,this.metadata=$?.metadata||!1,this.errorOnMissingTile=$?.errorOnMissingTile||!1}add($){this.tiles.set($.source.getKey(),$)}get($){return this.tiles.get($)}};tn(x_,"Protocol");var Qy=x_;function b_(V,$){return($>>>0)*4294967296+(V>>>0)}tn(b_,"toNum");function w_(V,$){let H=$.buf,Z=H[$.pos++],nt=(Z&112)>>4;if(Z<128||(Z=H[$.pos++],nt|=(Z&127)<<3,Z<128)||(Z=H[$.pos++],nt|=(Z&127)<<10,Z<128)||(Z=H[$.pos++],nt|=(Z&127)<<17,Z<128)||(Z=H[$.pos++],nt|=(Z&127)<<24,Z<128)||(Z=H[$.pos++],nt|=(Z&1)<<31,Z<128))return b_(V,nt);throw new Error("Expected varint not more than 10 bytes")}tn(w_,"readVarintRemainder");function Jd(V){let $=V.buf,H=$[V.pos++],Z=H&127;return H<128||(H=$[V.pos++],Z|=(H&127)<<7,H<128)||(H=$[V.pos++],Z|=(H&127)<<14,H<128)||(H=$[V.pos++],Z|=(H&127)<<21,H<128)?Z:(H=$[V.pos],Z|=(H&15)<<28,w_(Z,V))}tn(Jd,"readVarint");function Cg(V,$,H,Z){if(Z===0){H===1&&($[0]=V-1-$[0],$[1]=V-1-$[1]);let nt=$[0];$[0]=$[1],$[1]=nt}}tn(Cg,"rotate");function T_(V,$){let H=Yp(2,V),Z=$,nt=$,ft=$,P=[0,0],d=1;for(;d<H;)Z=1&ft/2,nt=1&(ft^Z),Cg(d,P,Z,nt),P[0]+=d*Z,P[1]+=d*nt,ft=ft/4,d*=2;return[V,P[0],P[1]]}tn(T_,"idOnLevel");var Jy=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function S_(V,$,H){if(V>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if($>Yp(2,V)-1||H>Yp(2,V)-1)throw new Error("tile x/y outside zoom level bounds");let Z=Jy[V],nt=Yp(2,V),ft=0,P=0,d=0,wt=[$,H],At=nt/2;for(;At>0;)ft=(wt[0]&At)>0?1:0,P=(wt[1]&At)>0?1:0,d+=At*At*(3*ft^P),Cg(At,wt,ft,P),At=At/2;return Z+d}tn(S_,"zxyToTileId");function tv(V){let $=0;for(let H=0;H<27;H++){let Z=(1<<H)*(1<<H);if($+Z>V)return T_(H,V-$);$+=Z}throw new Error("Tile zoom level exceeds max safe number limit (26)")}tn(tv,"tileIdToZxy");var ev=(V=>(V[V.Unknown=0]="Unknown",V[V.None=1]="None",V[V.Gzip=2]="Gzip",V[V.Brotli=3]="Brotli",V[V.Zstd=4]="Zstd",V))(ev||{});function $m(V,$){return Yr(this,null,function*(){if($===1||$===0)return V;if($===2){if(typeof globalThis.DecompressionStream>"u")return Xy(new Uint8Array(V));let H=new Response(V).body;if(!H)throw new Error("Failed to read response stream");let Z=H.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(Z).arrayBuffer()}throw new Error("Compression method not supported")})}tn($m,"defaultDecompress");var iv=(V=>(V[V.Unknown=0]="Unknown",V[V.Mvt=1]="Mvt",V[V.Png=2]="Png",V[V.Jpeg=3]="Jpeg",V[V.Webp=4]="Webp",V[V.Avif=5]="Avif",V))(iv||{});function M_(V){return V===1?".mvt":V===2?".png":V===3?".jpg":V===4?".webp":V===5?".avif":""}tn(M_,"tileTypeExt");var nv=127;function E_(V,$){let H=0,Z=V.length-1;for(;H<=Z;){let nt=Z+H>>1,ft=$-V[nt].tileId;if(ft>0)H=nt+1;else if(ft<0)Z=nt-1;else return V[nt]}return Z>=0&&(V[Z].runLength===0||$-V[Z].tileId<V[Z].runLength)?V[Z]:null}tn(E_,"findTile");var rv=class{constructor($){this.file=$}getKey(){return this.file.name}getBytes($,H){return Yr(this,null,function*(){return{data:yield this.file.slice($,$+H).arrayBuffer()}})}};tn(rv,"FileSource");var A_=class{constructor($,H=new Headers){this.url=$,this.customHeaders=H,this.mustReload=!1;let Z="";"navigator"in globalThis&&(Z=globalThis.navigator.userAgent||"");let nt=Z.indexOf("Windows")>-1,ft=/Chrome|Chromium|Edg|OPR|Brave/.test(Z);this.chromeWindowsNoCache=!1,nt&&ft&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders($){this.customHeaders=$}getBytes($,H,Z,nt){return Yr(this,null,function*(){let ft,P;Z?P=Z:(ft=new AbortController,P=ft.signal);let d=new Headers(this.customHeaders);d.set("range",`bytes=${$}-${$+H-1}`);let wt;this.mustReload?wt="reload":this.chromeWindowsNoCache&&(wt="no-store");let At=yield fetch(this.url,{signal:P,cache:wt,headers:d});if($===0&&At.status===416){let re=At.headers.get("Content-Range");if(!re||!re.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let ve=+re.substr(8);At=yield fetch(this.url,{signal:P,cache:"reload",headers:{range:`bytes=0-${ve-1}`}})}let ie=At.headers.get("Etag");if(ie!=null&&ie.startsWith("W/")&&(ie=null),At.status===416||nt&&ie&&ie!==nt)throw this.mustReload=!0,new Sg(`Server returned non-matching ETag ${nt} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(At.status>=300)throw new Error(`Bad response code: ${At.status}`);let jt=At.headers.get("Content-Length");if(At.status===200&&(!jt||+jt>H))throw ft&&ft.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield At.arrayBuffer(),etag:ie||void 0,cacheControl:At.headers.get("Cache-Control")||void 0,expires:At.headers.get("Expires")||void 0}})}};tn(A_,"FetchSource");var av=A_;function Lo(V,$){let H=V.getUint32($+4,!0),Z=V.getUint32($+0,!0);return H*Yp(2,32)+Z}tn(Lo,"getUint64");function C_(V,$){let H=new DataView(V),Z=H.getUint8(7);if(Z>3)throw new Error(`Archive is spec version ${Z} but this library supports up to spec version 3`);return{specVersion:Z,rootDirectoryOffset:Lo(H,8),rootDirectoryLength:Lo(H,16),jsonMetadataOffset:Lo(H,24),jsonMetadataLength:Lo(H,32),leafDirectoryOffset:Lo(H,40),leafDirectoryLength:Lo(H,48),tileDataOffset:Lo(H,56),tileDataLength:Lo(H,64),numAddressedTiles:Lo(H,72),numTileEntries:Lo(H,80),numTileContents:Lo(H,88),clustered:H.getUint8(96)===1,internalCompression:H.getUint8(97),tileCompression:H.getUint8(98),tileType:H.getUint8(99),minZoom:H.getUint8(100),maxZoom:H.getUint8(101),minLon:H.getInt32(102,!0)/1e7,minLat:H.getInt32(106,!0)/1e7,maxLon:H.getInt32(110,!0)/1e7,maxLat:H.getInt32(114,!0)/1e7,centerZoom:H.getUint8(118),centerLon:H.getInt32(119,!0)/1e7,centerLat:H.getInt32(123,!0)/1e7,etag:$}}tn(C_,"bytesToHeader");function zg(V){let $={buf:new Uint8Array(V),pos:0},H=Jd($),Z=[],nt=0;for(let ft=0;ft<H;ft++){let P=Jd($);Z.push({tileId:nt+P,offset:0,length:0,runLength:1}),nt+=P}for(let ft=0;ft<H;ft++)Z[ft].runLength=Jd($);for(let ft=0;ft<H;ft++)Z[ft].length=Jd($);for(let ft=0;ft<H;ft++){let P=Jd($);P===0&&ft>0?Z[ft].offset=Z[ft-1].offset+Z[ft-1].length:Z[ft].offset=P-1}return Z}tn(zg,"deserializeIndex");var z_=class extends Error{};tn(z_,"EtagMismatch");var Sg=z_;function Dg(V,$){return Yr(this,null,function*(){let H=yield V.getBytes(0,16384);if(new DataView(H.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let Z=H.data.slice(0,nv),nt=C_(Z,H.etag),ft=H.data.slice(nt.rootDirectoryOffset,nt.rootDirectoryOffset+nt.rootDirectoryLength),P=`${V.getKey()}|${nt.etag||""}|${nt.rootDirectoryOffset}|${nt.rootDirectoryLength}`,d=zg(yield $(ft,nt.internalCompression));return[nt,[P,d.length,d]]})}tn(Dg,"getHeaderAndRoot");function Pg(V,$,H,Z,nt){return Yr(this,null,function*(){let ft=yield V.getBytes(H,Z,void 0,nt.etag),P=yield $(ft.data,nt.internalCompression),d=zg(P);if(d.length===0)throw new Error("Empty directory is invalid");return d})}tn(Pg,"getDirectory");var sv=class{constructor($=100,H=!0,Z=$m){this.cache=new Map,this.maxCacheEntries=$,this.counter=1,this.decompress=Z}getHeader($){return Yr(this,null,function*(){let H=$.getKey(),Z=this.cache.get(H);if(Z)return Z.lastUsed=this.counter++,Z.data;let nt=yield Dg($,this.decompress);return nt[1]&&this.cache.set(nt[1][0],{lastUsed:this.counter++,data:nt[1][2]}),this.cache.set(H,{lastUsed:this.counter++,data:nt[0]}),this.prune(),nt[0]})}getDirectory($,H,Z,nt){return Yr(this,null,function*(){let ft=`${$.getKey()}|${nt.etag||""}|${H}|${Z}`,P=this.cache.get(ft);if(P)return P.lastUsed=this.counter++,P.data;let d=yield Pg($,this.decompress,H,Z,nt);return this.cache.set(ft,{lastUsed:this.counter++,data:d}),this.prune(),d})}prune(){if(this.cache.size>this.maxCacheEntries){let $=1/0,H;this.cache.forEach((Z,nt)=>{Z.lastUsed<$&&($=Z.lastUsed,H=nt)}),H&&this.cache.delete(H)}}invalidate($){return Yr(this,null,function*(){this.cache.delete($.getKey())})}};tn(sv,"ResolvedValueCache");var D_=class{constructor($=100,H=!0,Z=$m){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=$,this.counter=1,this.decompress=Z}getHeader($){return Yr(this,null,function*(){let H=$.getKey(),Z=this.cache.get(H);if(Z)return Z.lastUsed=this.counter++,yield Z.data;let nt=new Promise((ft,P)=>{Dg($,this.decompress).then(d=>{d[1]&&this.cache.set(d[1][0],{lastUsed:this.counter++,data:Promise.resolve(d[1][2])}),ft(d[0]),this.prune()}).catch(d=>{P(d)})});return this.cache.set(H,{lastUsed:this.counter++,data:nt}),nt})}getDirectory($,H,Z,nt){return Yr(this,null,function*(){let ft=`${$.getKey()}|${nt.etag||""}|${H}|${Z}`,P=this.cache.get(ft);if(P)return P.lastUsed=this.counter++,yield P.data;let d=new Promise((wt,At)=>{Pg($,this.decompress,H,Z,nt).then(ie=>{wt(ie),this.prune()}).catch(ie=>{At(ie)})});return this.cache.set(ft,{lastUsed:this.counter++,data:d}),d})}prune(){if(this.cache.size>=this.maxCacheEntries){let $=1/0,H;this.cache.forEach((Z,nt)=>{Z.lastUsed<$&&($=Z.lastUsed,H=nt)}),H&&this.cache.delete(H)}}invalidate($){return Yr(this,null,function*(){let H=$.getKey();if(this.invalidations.get(H))return yield this.invalidations.get(H);this.cache.delete($.getKey());let Z=new Promise((nt,ft)=>{this.getHeader($).then(P=>{nt(),this.invalidations.delete(H)}).catch(P=>{ft(P)})});this.invalidations.set(H,Z)})}};tn(D_,"SharedPromiseCache");var ov=D_,P_=class{constructor($,H,Z){typeof $=="string"?this.source=new av($):this.source=$,Z?this.decompress=Z:this.decompress=$m,H?this.cache=H:this.cache=new ov}getHeader(){return Yr(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt($,H,Z,nt){return Yr(this,null,function*(){let ft=S_($,H,Z),P=yield this.cache.getHeader(this.source);if($<P.minZoom||$>P.maxZoom)return;let d=P.rootDirectoryOffset,wt=P.rootDirectoryLength;for(let At=0;At<=3;At++){let ie=yield this.cache.getDirectory(this.source,d,wt,P),jt=E_(ie,ft);if(jt){if(jt.runLength>0){let re=yield this.source.getBytes(P.tileDataOffset+jt.offset,jt.length,nt,P.etag);return{data:yield this.decompress(re.data,P.tileCompression),cacheControl:re.cacheControl,expires:re.expires}}d=P.leafDirectoryOffset+jt.offset,wt=jt.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy($,H,Z,nt){return Yr(this,null,function*(){try{return yield this.getZxyAttempt($,H,Z,nt)}catch(ft){if(ft instanceof Sg)return this.cache.invalidate(this.source),yield this.getZxyAttempt($,H,Z,nt);throw ft}})}getMetadataAttempt(){return Yr(this,null,function*(){let $=yield this.cache.getHeader(this.source),H=yield this.source.getBytes($.jsonMetadataOffset,$.jsonMetadataLength,void 0,$.etag),Z=yield this.decompress(H.data,$.internalCompression),nt=new TextDecoder("utf-8");return JSON.parse(nt.decode(Z))})}getMetadata(){return Yr(this,null,function*(){try{return yield this.getMetadataAttempt()}catch($){if($ instanceof Sg)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw $}})}getTileJson($){return Yr(this,null,function*(){let H=yield this.getHeader(),Z=yield this.getMetadata(),nt=M_(H.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${$}/{z}/{x}/{y}${nt}`],vector_layers:Z.vector_layers,attribution:Z.attribution,description:Z.description,name:Z.name,version:Z.version,bounds:[H.minLon,H.minLat,H.maxLon,H.maxLat],center:[H.centerLon,H.centerLat,H.centerZoom],minzoom:H.minZoom,maxzoom:H.maxZoom}})}};tn(P_,"PMTiles");var a_=P_;const s_={osm_vector:"./styles/osm_vector.json",osm_raster:"./styles/osm_raster.json",osm_pmtiles:"./styles/osm_pmtiles.json"};let o_=!1;const lv=()=>{if(!o_){const V=new Qy;d_.addProtocol("pmtiles",V.tile),o_=!0}};function uv(){const V=De.useMemo(()=>{const ft=new URLSearchParams(window.location.search).get("style"),P=Object.keys(s_);return ft&&P.includes(ft)?ft:"osm_vector"},[]),[$,H]=De.useState(V);De.useEffect(()=>{lv()},[]);const Z=De.useCallback(nt=>{H(nt);const ft=new URLSearchParams(window.location.search);ft.set("style",nt);let P=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+ft.toString();window.location.hash&&(P+=window.location.hash),window.history.replaceState({path:P},"",P)},[]);return El.jsx("div",{style:{width:"100vw",height:"100vh"},children:El.jsxs(gy,{initialViewState:{longitude:0,latitude:0,zoom:4},hash:!0,style:{width:"100%",height:"100%"},mapStyle:s_[$],children:[El.jsx("div",{children:El.jsxs("select",{value:$,onChange:nt=>Z(nt.target.value),style:{position:"absolute",top:10,left:10,zIndex:1},children:[El.jsx("option",{value:"osm_vector",children:"OSM Vector"}),El.jsx("option",{value:"osm_raster",children:"OSM Raster"}),El.jsx("option",{value:"osm_pmtiles",children:"OSM PMTiles"})]})}),El.jsx(by,{position:"top-right"}),El.jsx(Ty,{position:"top-right",visualizePitch:!0,showZoom:!0,showCompass:!0})]})})}ey.createRoot(document.getElementById("root")).render(El.jsx($_.StrictMode,{children:El.jsx(uv,{})}));
